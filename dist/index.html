
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>仙侠卡牌RPG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'serif': ['"Noto Serif SC"', 'serif'],
              'sans': ['"Inter"', 'sans-serif'],
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-in-out',
              'slide-up': 'slideUp 0.3s ease-out',
              'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
              'flash': 'flash 0.5s ease-out',
              'glow': 'glow 2s ease-in-out infinite alternate',
              'float': 'float 3s ease-in-out infinite',
              'marquee': 'marquee 40s linear infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: 0 },
                '100%': { opacity: 1 },
              },
              slideUp: {
                '0%': { transform: 'translateY(100%)', opacity: 0.8 },
                '100%': { transform: 'translateY(0)', opacity: 1 },
              },
              shake: {
                '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                '40%, 60%': { transform: 'translate3d(4px, 0, 0)' },
              },
              flash: {
                '0%, 100%': { opacity: 1 },
                '50%': { opacity: 0.1 },
              },
              glow: {
                'from': { textShadow: '0 0 5px #fef08a, 0 0 10px #fef08a, 0 0 15px #fde047' },
                'to': { textShadow: '0 0 10px #facc15, 0 0 20px #facc15, 0 0 30px #eab308' },
              },
               float: {
                '0%, 100%': { transform: 'translateY(0px)' },
                '50%': { transform: 'translateY(-8px)' },
              },
              marquee: {
                '0%': { transform: 'translateX(0)' },
                '100%': { transform: 'translateX(-50%)' },
              },
            },
          },
        },
      }
    </script>

<style>
    /* 固定尺寸布局 - 540px × 960px */
    html {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        background-color: #1a1a1a; /* 外部背景色 */
        overflow-y: auto;
    }
    
    body {
        margin: 0;
        padding: 0;
        width: 540px;
        height: 960px;
        background-image: url('https://github.com/zzq0219/sillytavern/blob/main/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E4%BA%91%E9%9B%BE-%E4%BB%99%E4%BE%A0.png?raw=true');
        background-size: cover;
        background-position: center;
        background-attachment: scroll;
        background-color: #0c0a09; /* stone-950 */
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.8); /* 添加阴影使容器突出 */
    }

    /* 固定尺寸根容器 */
    #root {
        width: 540px;
        height: 960px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* 优化触控体验 */
    * {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }

    button, a {
        -webkit-user-select: none;
        user-select: none;
    }
    /* 优化文本排版 */
    .prose {
        --tw-prose-body: #d6d3d1;
        --tw-prose-headings: #fde047;
        --tw-prose-invert-body: #d6d3d1;
        --tw-prose-invert-headings: #fde047;
        line-height: 1.8;
        letter-spacing: 0.02em;
    }

    /* 优化滚动条样式 */
    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    ::-webkit-scrollbar-track {
        background: rgba(28, 25, 23, 0.5);
        backdrop-filter: blur(4px);
    }
    ::-webkit-scrollbar-thumb {
        background: #57534e;
        border-radius: 3px;
        transition: background 0.2s;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #78716c;
    }

    /* 通用动画 - 按钮反馈 */
    @keyframes button-press {
        0% { transform: scale(1); }
        50% { transform: scale(0.95); }
        100% { transform: scale(1); }
    }

    /* 焦点优化 */
    :focus-visible {
        outline: 2px solid #facc15;
        outline-offset: 2px;
        border-radius: 4px;
    }

    .ornate-border {
        border: 10px solid;
        border-image-slice: 40 42;
        border-image-width: 15px;
        border-image-outset: 0;
        border-image-repeat: stretch;
        border-image-source: url('https://i.imgur.com/z4b2r4j.png');
        position: relative;
    }
    .scroll-container {
      background-image: url('https://www.transparenttextures.com/patterns/old-paper-2.png'), linear-gradient(to bottom, #f5eadd, #d8c9b3);
      background-color: #e4d8c5; /* A base parchment color */
      color: #402e1a;
      border: 2px solid #a89379;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      padding: 1rem 2rem;
      border-radius: 2px;
    }
    .scroll-container .prose {
        --tw-prose-body: #5c452b;
        --tw-prose-headings: #8c6a48;
    }
    .text-rainbow {
        background-image: linear-gradient(to right, #f87171, #fb923c, #facc15, #4ade80, #38bdf8, #a78bfa, #f472b6);
        background-size: 200% auto;
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: rainbow-flow 3s linear infinite;
    }
    @keyframes rainbow-flow {
        to {
            background-position: 200% center;
        }
    }

    /* 毛玻璃效果增强 */
    .backdrop-blur-sm {
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
    }
    .backdrop-blur-md {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    /* 卡片阴影层级 */
    .shadow-card {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .shadow-card-hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25), 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    /* 加载动画优化 */
    @keyframes pulse-glow {
        0%, 100% {
            opacity: 1;
            box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
        }
        50% {
            opacity: 0.8;
            box-shadow: 0 0 0 10px rgba(251, 191, 36, 0);
        }
    }

    /* 响应式字体大小 */
    @media (max-width: 640px) {
        html {
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        html {
            font-size: 12px;
        }
    }

    /* 触摸目标最小尺寸 */
    @media (max-width: 768px) {
        button, a, .interactive {
            min-width: 44px;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    }
</style>
<link rel="stylesheet" href="/index.css">
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.28.0"
  }
}
</script>
  <script type="module" crossorigin>(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const f of m.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function r(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function c(d){if(d.ep)return;d.ep=!0;const m=r(d);fetch(d.href,m)}})();function af(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var od={exports:{}},or={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cx;function up(){if(cx)return or;cx=1;var i=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function r(c,d,m){var f=null;if(m!==void 0&&(f=""+m),d.key!==void 0&&(f=""+d.key),"key"in d){m={};for(var x in d)x!=="key"&&(m[x]=d[x])}else m=d;return d=m.ref,{$$typeof:i,type:c,key:f,ref:d!==void 0?d:null,props:m}}return or.Fragment=l,or.jsx=r,or.jsxs=r,or}var dx;function mp(){return dx||(dx=1,od.exports=up()),od.exports}var e=mp(),cd={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ux;function xp(){if(ux)return Te;ux=1;var i=Symbol.for("react.transitional.element"),l=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),f=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),S=Symbol.iterator;function C(O){return O===null||typeof O!="object"?null:(O=S&&O[S]||O["@@iterator"],typeof O=="function"?O:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,$={};function Z(O,se,he){this.props=O,this.context=se,this.refs=$,this.updater=he||A}Z.prototype.isReactComponent={},Z.prototype.setState=function(O,se){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,se,"setState")},Z.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function R(){}R.prototype=Z.prototype;function V(O,se,he){this.props=O,this.context=se,this.refs=$,this.updater=he||A}var J=V.prototype=new R;J.constructor=V,E(J,Z.prototype),J.isPureReactComponent=!0;var D=Array.isArray;function T(){}var G={H:null,A:null,T:null,S:null},_=Object.prototype.hasOwnProperty;function M(O,se,he){var le=he.ref;return{$$typeof:i,type:O,key:se,ref:le!==void 0?le:null,props:he}}function U(O,se){return M(O.type,se,O.props)}function k(O){return typeof O=="object"&&O!==null&&O.$$typeof===i}function Q(O){var se={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(he){return se[he]})}var ne=/\/+/g;function Y(O,se){return typeof O=="object"&&O!==null&&O.key!=null?Q(""+O.key):se.toString(36)}function X(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(T,T):(O.status="pending",O.then(function(se){O.status==="pending"&&(O.status="fulfilled",O.value=se)},function(se){O.status==="pending"&&(O.status="rejected",O.reason=se)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function L(O,se,he,le,xe){var pe=typeof O;(pe==="undefined"||pe==="boolean")&&(O=null);var Ae=!1;if(O===null)Ae=!0;else switch(pe){case"bigint":case"string":case"number":Ae=!0;break;case"object":switch(O.$$typeof){case i:case l:Ae=!0;break;case b:return Ae=O._init,L(Ae(O._payload),se,he,le,xe)}}if(Ae)return xe=xe(O),Ae=le===""?"."+Y(O,0):le,D(xe)?(he="",Ae!=null&&(he=Ae.replace(ne,"$&/")+"/"),L(xe,se,he,"",function(ye){return ye})):xe!=null&&(k(xe)&&(xe=U(xe,he+(xe.key==null||O&&O.key===xe.key?"":(""+xe.key).replace(ne,"$&/")+"/")+Ae)),se.push(xe)),1;Ae=0;var je=le===""?".":le+":";if(D(O))for(var de=0;de<O.length;de++)le=O[de],pe=je+Y(le,de),Ae+=L(le,se,he,pe,xe);else if(de=C(O),typeof de=="function")for(O=de.call(O),de=0;!(le=O.next()).done;)le=le.value,pe=je+Y(le,de++),Ae+=L(le,se,he,pe,xe);else if(pe==="object"){if(typeof O.then=="function")return L(X(O),se,he,le,xe);throw se=String(O),Error("Objects are not valid as a React child (found: "+(se==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":se)+"). If you meant to render a collection of children, use an array instead.")}return Ae}function I(O,se,he){if(O==null)return O;var le=[],xe=0;return L(O,le,"","",function(pe){return se.call(he,pe,xe++)}),le}function K(O){if(O._status===-1){var se=O._result;se=se(),se.then(function(he){(O._status===0||O._status===-1)&&(O._status=1,O._result=he)},function(he){(O._status===0||O._status===-1)&&(O._status=2,O._result=he)}),O._status===-1&&(O._status=0,O._result=se)}if(O._status===1)return O._result.default;throw O._result}var fe=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var se=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(se))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},ge={map:I,forEach:function(O,se,he){I(O,function(){se.apply(this,arguments)},he)},count:function(O){var se=0;return I(O,function(){se++}),se},toArray:function(O){return I(O,function(se){return se})||[]},only:function(O){if(!k(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Te.Activity=y,Te.Children=ge,Te.Component=Z,Te.Fragment=r,Te.Profiler=d,Te.PureComponent=V,Te.StrictMode=c,Te.Suspense=h,Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=G,Te.__COMPILER_RUNTIME={__proto__:null,c:function(O){return G.H.useMemoCache(O)}},Te.cache=function(O){return function(){return O.apply(null,arguments)}},Te.cacheSignal=function(){return null},Te.cloneElement=function(O,se,he){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var le=E({},O.props),xe=O.key;if(se!=null)for(pe in se.key!==void 0&&(xe=""+se.key),se)!_.call(se,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&se.ref===void 0||(le[pe]=se[pe]);var pe=arguments.length-2;if(pe===1)le.children=he;else if(1<pe){for(var Ae=Array(pe),je=0;je<pe;je++)Ae[je]=arguments[je+2];le.children=Ae}return M(O.type,xe,le)},Te.createContext=function(O){return O={$$typeof:f,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:m,_context:O},O},Te.createElement=function(O,se,he){var le,xe={},pe=null;if(se!=null)for(le in se.key!==void 0&&(pe=""+se.key),se)_.call(se,le)&&le!=="key"&&le!=="__self"&&le!=="__source"&&(xe[le]=se[le]);var Ae=arguments.length-2;if(Ae===1)xe.children=he;else if(1<Ae){for(var je=Array(Ae),de=0;de<Ae;de++)je[de]=arguments[de+2];xe.children=je}if(O&&O.defaultProps)for(le in Ae=O.defaultProps,Ae)xe[le]===void 0&&(xe[le]=Ae[le]);return M(O,pe,xe)},Te.createRef=function(){return{current:null}},Te.forwardRef=function(O){return{$$typeof:x,render:O}},Te.isValidElement=k,Te.lazy=function(O){return{$$typeof:b,_payload:{_status:-1,_result:O},_init:K}},Te.memo=function(O,se){return{$$typeof:g,type:O,compare:se===void 0?null:se}},Te.startTransition=function(O){var se=G.T,he={};G.T=he;try{var le=O(),xe=G.S;xe!==null&&xe(he,le),typeof le=="object"&&le!==null&&typeof le.then=="function"&&le.then(T,fe)}catch(pe){fe(pe)}finally{se!==null&&he.types!==null&&(se.types=he.types),G.T=se}},Te.unstable_useCacheRefresh=function(){return G.H.useCacheRefresh()},Te.use=function(O){return G.H.use(O)},Te.useActionState=function(O,se,he){return G.H.useActionState(O,se,he)},Te.useCallback=function(O,se){return G.H.useCallback(O,se)},Te.useContext=function(O){return G.H.useContext(O)},Te.useDebugValue=function(){},Te.useDeferredValue=function(O,se){return G.H.useDeferredValue(O,se)},Te.useEffect=function(O,se){return G.H.useEffect(O,se)},Te.useEffectEvent=function(O){return G.H.useEffectEvent(O)},Te.useId=function(){return G.H.useId()},Te.useImperativeHandle=function(O,se,he){return G.H.useImperativeHandle(O,se,he)},Te.useInsertionEffect=function(O,se){return G.H.useInsertionEffect(O,se)},Te.useLayoutEffect=function(O,se){return G.H.useLayoutEffect(O,se)},Te.useMemo=function(O,se){return G.H.useMemo(O,se)},Te.useOptimistic=function(O,se){return G.H.useOptimistic(O,se)},Te.useReducer=function(O,se,he){return G.H.useReducer(O,se,he)},Te.useRef=function(O){return G.H.useRef(O)},Te.useState=function(O){return G.H.useState(O)},Te.useSyncExternalStore=function(O,se,he){return G.H.useSyncExternalStore(O,se,he)},Te.useTransition=function(){return G.H.useTransition()},Te.version="19.2.0",Te}var mx;function Td(){return mx||(mx=1,cd.exports=xp()),cd.exports}var v=Td();const Zi=af(v);var dd={exports:{}},cr={},ud={exports:{}},md={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xx;function fp(){return xx||(xx=1,(function(i){function l(L,I){var K=L.length;L.push(I);e:for(;0<K;){var fe=K-1>>>1,ge=L[fe];if(0<d(ge,I))L[fe]=I,L[K]=ge,K=fe;else break e}}function r(L){return L.length===0?null:L[0]}function c(L){if(L.length===0)return null;var I=L[0],K=L.pop();if(K!==I){L[0]=K;e:for(var fe=0,ge=L.length,O=ge>>>1;fe<O;){var se=2*(fe+1)-1,he=L[se],le=se+1,xe=L[le];if(0>d(he,K))le<ge&&0>d(xe,he)?(L[fe]=xe,L[le]=K,fe=le):(L[fe]=he,L[se]=K,fe=se);else if(le<ge&&0>d(xe,K))L[fe]=xe,L[le]=K,fe=le;else break e}}return I}function d(L,I){var K=L.sortIndex-I.sortIndex;return K!==0?K:L.id-I.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;i.unstable_now=function(){return m.now()}}else{var f=Date,x=f.now();i.unstable_now=function(){return f.now()-x}}var h=[],g=[],b=1,y=null,S=3,C=!1,A=!1,E=!1,$=!1,Z=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;function J(L){for(var I=r(g);I!==null;){if(I.callback===null)c(g);else if(I.startTime<=L)c(g),I.sortIndex=I.expirationTime,l(h,I);else break;I=r(g)}}function D(L){if(E=!1,J(L),!A)if(r(h)!==null)A=!0,T||(T=!0,Q());else{var I=r(g);I!==null&&X(D,I.startTime-L)}}var T=!1,G=-1,_=5,M=-1;function U(){return $?!0:!(i.unstable_now()-M<_)}function k(){if($=!1,T){var L=i.unstable_now();M=L;var I=!0;try{e:{A=!1,E&&(E=!1,R(G),G=-1),C=!0;var K=S;try{t:{for(J(L),y=r(h);y!==null&&!(y.expirationTime>L&&U());){var fe=y.callback;if(typeof fe=="function"){y.callback=null,S=y.priorityLevel;var ge=fe(y.expirationTime<=L);if(L=i.unstable_now(),typeof ge=="function"){y.callback=ge,J(L),I=!0;break t}y===r(h)&&c(h),J(L)}else c(h);y=r(h)}if(y!==null)I=!0;else{var O=r(g);O!==null&&X(D,O.startTime-L),I=!1}}break e}finally{y=null,S=K,C=!1}I=void 0}}finally{I?Q():T=!1}}}var Q;if(typeof V=="function")Q=function(){V(k)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,Y=ne.port2;ne.port1.onmessage=k,Q=function(){Y.postMessage(null)}}else Q=function(){Z(k,0)};function X(L,I){G=Z(function(){L(i.unstable_now())},I)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(L){L.callback=null},i.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<L?Math.floor(1e3/L):5},i.unstable_getCurrentPriorityLevel=function(){return S},i.unstable_next=function(L){switch(S){case 1:case 2:case 3:var I=3;break;default:I=S}var K=S;S=I;try{return L()}finally{S=K}},i.unstable_requestPaint=function(){$=!0},i.unstable_runWithPriority=function(L,I){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var K=S;S=L;try{return I()}finally{S=K}},i.unstable_scheduleCallback=function(L,I,K){var fe=i.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?fe+K:fe):K=fe,L){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=K+ge,L={id:b++,callback:I,priorityLevel:L,startTime:K,expirationTime:ge,sortIndex:-1},K>fe?(L.sortIndex=K,l(g,L),r(h)===null&&L===r(g)&&(E?(R(G),G=-1):E=!0,X(D,K-fe))):(L.sortIndex=ge,l(h,L),A||C||(A=!0,T||(T=!0,Q()))),L},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(L){var I=S;return function(){var K=S;S=I;try{return L.apply(this,arguments)}finally{S=K}}}})(md)),md}var fx;function hp(){return fx||(fx=1,ud.exports=fp()),ud.exports}var xd={exports:{}},Dt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hx;function pp(){if(hx)return Dt;hx=1;var i=Td();function l(h){var g="https://react.dev/errors/"+h;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var c={d:{f:r,r:function(){throw Error(l(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},d=Symbol.for("react.portal");function m(h,g,b){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:y==null?null:""+y,children:h,containerInfo:g,implementation:b}}var f=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function x(h,g){if(h==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Dt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=c,Dt.createPortal=function(h,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(l(299));return m(h,g,null,b)},Dt.flushSync=function(h){var g=f.T,b=c.p;try{if(f.T=null,c.p=2,h)return h()}finally{f.T=g,c.p=b,c.d.f()}},Dt.preconnect=function(h,g){typeof h=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,c.d.C(h,g))},Dt.prefetchDNS=function(h){typeof h=="string"&&c.d.D(h)},Dt.preinit=function(h,g){if(typeof h=="string"&&g&&typeof g.as=="string"){var b=g.as,y=x(b,g.crossOrigin),S=typeof g.integrity=="string"?g.integrity:void 0,C=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;b==="style"?c.d.S(h,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:y,integrity:S,fetchPriority:C}):b==="script"&&c.d.X(h,{crossOrigin:y,integrity:S,fetchPriority:C,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Dt.preinitModule=function(h,g){if(typeof h=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var b=x(g.as,g.crossOrigin);c.d.M(h,{crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&c.d.M(h)},Dt.preload=function(h,g){if(typeof h=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var b=g.as,y=x(b,g.crossOrigin);c.d.L(h,b,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Dt.preloadModule=function(h,g){if(typeof h=="string")if(g){var b=x(g.as,g.crossOrigin);c.d.m(h,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:b,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else c.d.m(h)},Dt.requestFormReset=function(h){c.d.r(h)},Dt.unstable_batchedUpdates=function(h,g){return h(g)},Dt.useFormState=function(h,g,b){return f.H.useFormState(h,g,b)},Dt.useFormStatus=function(){return f.H.useHostTransitionStatus()},Dt.version="19.2.0",Dt}var px;function nf(){if(px)return xd.exports;px=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(l){console.error(l)}}return i(),xd.exports=pp(),xd.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gx;function gp(){if(gx)return cr;gx=1;var i=hp(),l=Td(),r=nf();function c(t){var s="https://react.dev/errors/"+t;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)s+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function m(t){var s=t,a=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,(s.flags&4098)!==0&&(a=s.return),t=s.return;while(t)}return s.tag===3?a:null}function f(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function x(t){if(t.tag===31){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function h(t){if(m(t)!==t)throw Error(c(188))}function g(t){var s=t.alternate;if(!s){if(s=m(t),s===null)throw Error(c(188));return s!==t?null:t}for(var a=t,n=s;;){var o=a.return;if(o===null)break;var u=o.alternate;if(u===null){if(n=o.return,n!==null){a=n;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===a)return h(o),t;if(u===n)return h(o),s;u=u.sibling}throw Error(c(188))}if(a.return!==n.return)a=o,n=u;else{for(var p=!1,j=o.child;j;){if(j===a){p=!0,a=o,n=u;break}if(j===n){p=!0,n=o,a=u;break}j=j.sibling}if(!p){for(j=u.child;j;){if(j===a){p=!0,a=u,n=o;break}if(j===n){p=!0,n=u,a=o;break}j=j.sibling}if(!p)throw Error(c(189))}}if(a.alternate!==n)throw Error(c(190))}if(a.tag!==3)throw Error(c(188));return a.stateNode.current===a?t:s}function b(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t;for(t=t.child;t!==null;){if(s=b(t),s!==null)return s;t=t.sibling}return null}var y=Object.assign,S=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),V=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),G=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),k=Symbol.iterator;function Q(t){return t===null||typeof t!="object"?null:(t=k&&t[k]||t["@@iterator"],typeof t=="function"?t:null)}var ne=Symbol.for("react.client.reference");function Y(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===ne?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case E:return"Fragment";case Z:return"Profiler";case $:return"StrictMode";case D:return"Suspense";case T:return"SuspenseList";case M:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case A:return"Portal";case V:return t.displayName||"Context";case R:return(t._context.displayName||"Context")+".Consumer";case J:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case G:return s=t.displayName||null,s!==null?s:Y(t.type)||"Memo";case _:s=t._payload,t=t._init;try{return Y(t(s))}catch{}}return null}var X=Array.isArray,L=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},fe=[],ge=-1;function O(t){return{current:t}}function se(t){0>ge||(t.current=fe[ge],fe[ge]=null,ge--)}function he(t,s){ge++,fe[ge]=t.current,t.current=s}var le=O(null),xe=O(null),pe=O(null),Ae=O(null);function je(t,s){switch(he(pe,s),he(xe,t),he(le,null),s.nodeType){case 9:case 11:t=(t=s.documentElement)&&(t=t.namespaceURI)?Dm(t):0;break;default:if(t=s.tagName,s=s.namespaceURI)s=Dm(s),t=_m(s,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}se(le),he(le,t)}function de(){se(le),se(xe),se(pe)}function ye(t){t.memoizedState!==null&&he(Ae,t);var s=le.current,a=_m(s,t.type);s!==a&&(he(xe,t),he(le,a))}function ke(t){xe.current===t&&(se(le),se(xe)),Ae.current===t&&(se(Ae),nr._currentValue=K)}var Oe,zt;function Fe(t){if(Oe===void 0)try{throw Error()}catch(a){var s=a.stack.trim().match(/\n( *(at )?)/);Oe=s&&s[1]||"",zt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Oe+t+zt}var La=!1;function xn(t,s){if(!t||La)return"";La=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(s){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(te){var ee=te}Reflect.construct(t,[],me)}else{try{me.call()}catch(te){ee=te}t.call(me.prototype)}}else{try{throw Error()}catch(te){ee=te}(me=t())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(te){if(te&&ee&&typeof te.stack=="string")return[te.stack,ee.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=n.DetermineComponentFrameRoot(),p=u[0],j=u[1];if(p&&j){var z=p.split(`
`),W=j.split(`
`);for(o=n=0;n<z.length&&!z[n].includes("DetermineComponentFrameRoot");)n++;for(;o<W.length&&!W[o].includes("DetermineComponentFrameRoot");)o++;if(n===z.length||o===W.length)for(n=z.length-1,o=W.length-1;1<=n&&0<=o&&z[n]!==W[o];)o--;for(;1<=n&&0<=o;n--,o--)if(z[n]!==W[o]){if(n!==1||o!==1)do if(n--,o--,0>o||z[n]!==W[o]){var ie=`
`+z[n].replace(" at new "," at ");return t.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",t.displayName)),ie}while(1<=n&&0<=o);break}}}finally{La=!1,Error.prepareStackTrace=a}return(a=t?t.displayName||t.name:"")?Fe(a):""}function ol(t,s){switch(t.tag){case 26:case 27:case 5:return Fe(t.type);case 16:return Fe("Lazy");case 13:return t.child!==s&&s!==null?Fe("Suspense Fallback"):Fe("Suspense");case 19:return Fe("SuspenseList");case 0:case 15:return xn(t.type,!1);case 11:return xn(t.type.render,!1);case 1:return xn(t.type,!0);case 31:return Fe("Activity");default:return""}}function cl(t){try{var s="",a=null;do s+=ol(t,a),a=t,t=t.return;while(t);return s}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var Qs=Object.prototype.hasOwnProperty,fn=i.unstable_scheduleCallback,Ba=i.unstable_cancelCallback,br=i.unstable_shouldYield,Vt=i.unstable_requestPaint,Nt=i.unstable_now,dl=i.unstable_getCurrentPriorityLevel,Js=i.unstable_ImmediatePriority,yr=i.unstable_UserBlockingPriority,cs=i.unstable_NormalPriority,Ld=i.unstable_LowPriority,eo=i.unstable_IdlePriority,ul=i.log,vr=i.unstable_setDisableYieldValue,Xs=null,Tt=null;function Yt(t){if(typeof ul=="function"&&vr(t),Tt&&typeof Tt.setStrictMode=="function")try{Tt.setStrictMode(Xs,t)}catch{}}var wt=Math.clz32?Math.clz32:Nr,ml=Math.log,jr=Math.LN2;function Nr(t){return t>>>=0,t===0?32:31-(ml(t)/jr|0)|0}var Ha=256,hn=262144,pn=4194304;function ds(t){var s=t&42;if(s!==0)return s;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Ua(t,s,a){var n=t.pendingLanes;if(n===0)return 0;var o=0,u=t.suspendedLanes,p=t.pingedLanes;t=t.warmLanes;var j=n&134217727;return j!==0?(n=j&~u,n!==0?o=ds(n):(p&=j,p!==0?o=ds(p):a||(a=j&~t,a!==0&&(o=ds(a))))):(j=n&~u,j!==0?o=ds(j):p!==0?o=ds(p):a||(a=n&~t,a!==0&&(o=ds(a)))),o===0?0:s!==0&&s!==o&&(s&u)===0&&(u=o&-o,a=s&-s,u>=a||u===32&&(a&4194048)!==0)?s:o}function Ps(t,s){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&s)===0}function gn(t,s){switch(t){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wr(){var t=pn;return pn<<=1,(pn&62914560)===0&&(pn=4194304),t}function bn(t){for(var s=[],a=0;31>a;a++)s.push(t);return s}function Ia(t,s){t.pendingLanes|=s,s!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Sr(t,s,a,n,o,u){var p=t.pendingLanes;t.pendingLanes=a,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=a,t.entangledLanes&=a,t.errorRecoveryDisabledLanes&=a,t.shellSuspendCounter=0;var j=t.entanglements,z=t.expirationTimes,W=t.hiddenUpdates;for(a=p&~a;0<a;){var ie=31-wt(a),me=1<<ie;j[ie]=0,z[ie]=-1;var ee=W[ie];if(ee!==null)for(W[ie]=null,ie=0;ie<ee.length;ie++){var te=ee[ie];te!==null&&(te.lane&=-536870913)}a&=~me}n!==0&&to(t,n,0),u!==0&&o===0&&t.tag!==0&&(t.suspendedLanes|=u&~(p&~s))}function to(t,s,a){t.pendingLanes|=s,t.suspendedLanes&=~s;var n=31-wt(s);t.entangledLanes|=s,t.entanglements[n]=t.entanglements[n]|1073741824|a&261930}function so(t,s){var a=t.entangledLanes|=s;for(t=t.entanglements;a;){var n=31-wt(a),o=1<<n;o&s|t[n]&s&&(t[n]|=s),a&=~o}}function ao(t,s){var a=s&-s;return a=(a&42)!==0?1:kr(a),(a&(t.suspendedLanes|s))!==0?0:a}function kr(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function xl(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function fl(){var t=I.p;return t!==0?t:(t=window.event,t===void 0?32:sx(t.type))}function hl(t,s){var a=I.p;try{return I.p=t,s()}finally{I.p=a}}var Wt=Math.random().toString(36).slice(2),ot="__reactFiber$"+Wt,St="__reactProps$"+Wt,Zs="__reactContainer$"+Wt,qa="__reactEvents$"+Wt,no="__reactListeners$"+Wt,Cr="__reactHandles$"+Wt,Er="__reactResources$"+Wt,Ks="__reactMarker$"+Wt;function pl(t){delete t[ot],delete t[St],delete t[qa],delete t[no],delete t[Cr]}function Es(t){var s=t[ot];if(s)return s;for(var a=t.parentNode;a;){if(s=a[Zs]||a[ot]){if(a=s.alternate,s.child!==null||a!==null&&a.child!==null)for(t=Um(t);t!==null;){if(a=t[ot])return a;t=Um(t)}return s}t=a,a=t.parentNode}return null}function Fs(t){if(t=t[ot]||t[Zs]){var s=t.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return t}return null}function Ws(t){var s=t.tag;if(s===5||s===26||s===27||s===6)return t.stateNode;throw Error(c(33))}function ea(t){var s=t[Er];return s||(s=t[Er]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function lt(t){t[Ks]=!0}var Ga=new Set,Ms={};function us(t,s){ta(t,s),ta(t+"Capture",s)}function ta(t,s){for(Ms[t]=s,t=0;t<s.length;t++)Ga.add(s[t])}var lo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Mr={},Ar={};function ro(t){return Qs.call(Ar,t)?!0:Qs.call(Mr,t)?!1:lo.test(t)?Ar[t]=!0:(Mr[t]=!0,!1)}function yn(t,s,a){if(ro(s))if(a===null)t.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":t.removeAttribute(s);return;case"boolean":var n=s.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(s);return}}t.setAttribute(s,""+a)}}function vn(t,s,a){if(a===null)t.removeAttribute(s);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttribute(s,""+a)}}function ms(t,s,a,n){if(n===null)t.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttributeNS(s,a,""+n)}}function Rt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Tr(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function io(t,s,a){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,s);if(!t.hasOwnProperty(s)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return o.call(this)},set:function(p){a=""+p,u.call(this,p)}}),Object.defineProperty(t,s,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(p){a=""+p},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Va(t){if(!t._valueTracker){var s=Tr(t)?"checked":"value";t._valueTracker=io(t,s,""+t[s])}}function $r(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var a=s.getValue(),n="";return t&&(n=Tr(t)?t.checked?"true":"false":t.value),t=n,t!==a?(s.setValue(t),!0):!1}function jn(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var oo=/[\n"\\]/g;function Lt(t){return t.replace(oo,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function gl(t,s,a,n,o,u,p,j){t.name="",p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"?t.type=p:t.removeAttribute("type"),s!=null?p==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+Rt(s)):t.value!==""+Rt(s)&&(t.value=""+Rt(s)):p!=="submit"&&p!=="reset"||t.removeAttribute("value"),s!=null?Nn(t,p,Rt(s)):a!=null?Nn(t,p,Rt(a)):n!=null&&t.removeAttribute("value"),o==null&&u!=null&&(t.defaultChecked=!!u),o!=null&&(t.checked=o&&typeof o!="function"&&typeof o!="symbol"),j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?t.name=""+Rt(j):t.removeAttribute("name")}function Dr(t,s,a,n,o,u,p,j){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(t.type=u),s!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||s!=null)){Va(t);return}a=a!=null?""+Rt(a):"",s=s!=null?""+Rt(s):a,j||s===t.value||(t.value=s),t.defaultValue=s}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=j?t.checked:!!n,t.defaultChecked=!!n,p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.name=p),Va(t)}function Nn(t,s,a){s==="number"&&jn(t.ownerDocument)===t||t.defaultValue===""+a||(t.defaultValue=""+a)}function sa(t,s,a,n){if(t=t.options,s){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=!0;for(a=0;a<t.length;a++)o=s.hasOwnProperty("$"+t[a].value),t[a].selected!==o&&(t[a].selected=o),o&&n&&(t[a].defaultSelected=!0)}else{for(a=""+Rt(a),s=null,o=0;o<t.length;o++){if(t[o].value===a){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}s!==null||t[o].disabled||(s=t[o])}s!==null&&(s.selected=!0)}}function _r(t,s,a){if(s!=null&&(s=""+Rt(s),s!==t.value&&(t.value=s),a==null)){t.defaultValue!==s&&(t.defaultValue=s);return}t.defaultValue=a!=null?""+Rt(a):""}function Ya(t,s,a,n){if(s==null){if(n!=null){if(a!=null)throw Error(c(92));if(X(n)){if(1<n.length)throw Error(c(93));n=n[0]}a=n}a==null&&(a=""),s=a}a=Rt(s),t.defaultValue=a,n=t.textContent,n===a&&n!==""&&n!==null&&(t.value=n),Va(t)}function aa(t,s){if(s){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=s;return}}t.textContent=s}var co=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Or(t,s,a){var n=s.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?t.setProperty(s,""):s==="float"?t.cssFloat="":t[s]="":n?t.setProperty(s,a):typeof a!="number"||a===0||co.has(s)?s==="float"?t.cssFloat=a:t[s]=(""+a).trim():t[s]=a+"px"}function zr(t,s,a){if(s!=null&&typeof s!="object")throw Error(c(62));if(t=t.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||s!=null&&s.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var o in s)n=s[o],s.hasOwnProperty(o)&&a[o]!==n&&Or(t,o,n)}else for(var u in s)s.hasOwnProperty(u)&&Or(t,u,s[u])}function bl(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),mo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wn(t){return mo.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function xs(){}var yl=null;function vl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var na=null,la=null;function Rr(t){var s=Fs(t);if(s&&(t=s.stateNode)){var a=t[St]||null;e:switch(t=s.stateNode,s.type){case"input":if(gl(t,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),s=a.name,a.type==="radio"&&s!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Lt(""+s)+'"][type="radio"]'),s=0;s<a.length;s++){var n=a[s];if(n!==t&&n.form===t.form){var o=n[St]||null;if(!o)throw Error(c(90));gl(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(s=0;s<a.length;s++)n=a[s],n.form===t.form&&$r(n)}break e;case"textarea":_r(t,a.value,a.defaultValue);break e;case"select":s=a.value,s!=null&&sa(t,!!a.multiple,s,!1)}}}var jl=!1;function Lr(t,s,a){if(jl)return t(s,a);jl=!0;try{var n=t(s);return n}finally{if(jl=!1,(na!==null||la!==null)&&(wi(),na&&(s=na,t=la,la=na=null,Rr(s),t)))for(s=0;s<t.length;s++)Rr(t[s])}}function Qa(t,s){var a=t.stateNode;if(a===null)return null;var n=a[St]||null;if(n===null)return null;a=n[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(c(231,s,typeof a));return a}var fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ct=!1;if(fs)try{var Ja={};Object.defineProperty(Ja,"passive",{get:function(){ct=!0}}),window.addEventListener("test",Ja,Ja),window.removeEventListener("test",Ja,Ja)}catch{ct=!1}var js=null,Nl=null,Sn=null;function Br(){if(Sn)return Sn;var t,s=Nl,a=s.length,n,o="value"in js?js.value:js.textContent,u=o.length;for(t=0;t<a&&s[t]===o[t];t++);var p=a-t;for(n=1;n<=p&&s[a-n]===o[u-n];n++);return Sn=o.slice(t,1<n?1-n:void 0)}function kn(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Cn(){return!0}function En(){return!1}function pt(t){function s(a,n,o,u,p){this._reactName=a,this._targetInst=o,this.type=n,this.nativeEvent=u,this.target=p,this.currentTarget=null;for(var j in t)t.hasOwnProperty(j)&&(a=t[j],this[j]=a?a(u):u[j]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Cn:En,this.isPropagationStopped=En,this}return y(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Cn)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Cn)},persist:function(){},isPersistent:Cn}),s}var As={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mn=pt(As),ra=y({},As,{view:0,detail:0}),N=pt(ra),w,B,H,oe=y({},ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ia,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==H&&(H&&t.type==="mousemove"?(w=t.screenX-H.screenX,B=t.screenY-H.screenY):B=w=0,H=t),w)},movementY:function(t){return"movementY"in t?t.movementY:B}}),re=pt(oe),be=y({},oe,{dataTransfer:0}),ue=pt(be),ae=y({},ra,{relatedTarget:0}),ve=pt(ae),Ne=y({},As,{animationName:0,elapsedTime:0,pseudoElement:0}),ze=pt(Ne),De=y({},As,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),gt=pt(De),Ue=y({},As,{data:0}),yt=pt(Ue),dt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},es={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xa={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function An(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=Xa[t])?!!s[t]:!1}function ia(){return An}var $t=y({},ra,{key:function(t){if(t.key){var s=dt[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=kn(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?es[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ia,charCode:function(t){return t.type==="keypress"?kn(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?kn(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),wl=pt($t),Hr=y({},oe,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ur=pt(Hr),Sl=y({},ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ia}),Ir=pt(Sl),xo=y({},As,{propertyName:0,elapsedTime:0,pseudoElement:0}),hs=pt(xo),Af=y({},oe,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Tf=pt(Af),$f=y({},As,{newState:0,oldState:0}),Df=pt($f),_f=[9,13,27,32],fo=fs&&"CompositionEvent"in window,kl=null;fs&&"documentMode"in document&&(kl=document.documentMode);var Of=fs&&"TextEvent"in window&&!kl,Bd=fs&&(!fo||kl&&8<kl&&11>=kl),Hd=" ",Ud=!1;function Id(t,s){switch(t){case"keyup":return _f.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Tn=!1;function zf(t,s){switch(t){case"compositionend":return qd(s);case"keypress":return s.which!==32?null:(Ud=!0,Hd);case"textInput":return t=s.data,t===Hd&&Ud?null:t;default:return null}}function Rf(t,s){if(Tn)return t==="compositionend"||!fo&&Id(t,s)?(t=Br(),Sn=Nl=js=null,Tn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Bd&&s.locale!=="ko"?null:s.data;default:return null}}var Lf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gd(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!Lf[t.type]:s==="textarea"}function Vd(t,s,a,n){na?la?la.push(n):la=[n]:na=n,s=Ti(s,"onChange"),0<s.length&&(a=new Mn("onChange","change",null,a,n),t.push({event:a,listeners:s}))}var Cl=null,El=null;function Bf(t){Cm(t,0)}function qr(t){var s=Ws(t);if($r(s))return t}function Yd(t,s){if(t==="change")return s}var Qd=!1;if(fs){var ho;if(fs){var po="oninput"in document;if(!po){var Jd=document.createElement("div");Jd.setAttribute("oninput","return;"),po=typeof Jd.oninput=="function"}ho=po}else ho=!1;Qd=ho&&(!document.documentMode||9<document.documentMode)}function Xd(){Cl&&(Cl.detachEvent("onpropertychange",Pd),El=Cl=null)}function Pd(t){if(t.propertyName==="value"&&qr(El)){var s=[];Vd(s,El,t,vl(t)),Lr(Bf,s)}}function Hf(t,s,a){t==="focusin"?(Xd(),Cl=s,El=a,Cl.attachEvent("onpropertychange",Pd)):t==="focusout"&&Xd()}function Uf(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qr(El)}function If(t,s){if(t==="click")return qr(s)}function qf(t,s){if(t==="input"||t==="change")return qr(s)}function Gf(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Qt=typeof Object.is=="function"?Object.is:Gf;function Ml(t,s){if(Qt(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var a=Object.keys(t),n=Object.keys(s);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var o=a[n];if(!Qs.call(s,o)||!Qt(t[o],s[o]))return!1}return!0}function Zd(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Kd(t,s){var a=Zd(t);t=0;for(var n;a;){if(a.nodeType===3){if(n=t+a.textContent.length,t<=s&&n>=s)return{node:a,offset:s-t};t=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Zd(a)}}function Fd(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?Fd(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function Wd(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var s=jn(t.document);s instanceof t.HTMLIFrameElement;){try{var a=typeof s.contentWindow.location.href=="string"}catch{a=!1}if(a)t=s.contentWindow;else break;s=jn(t.document)}return s}function go(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}var Vf=fs&&"documentMode"in document&&11>=document.documentMode,$n=null,bo=null,Al=null,yo=!1;function eu(t,s,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;yo||$n==null||$n!==jn(n)||(n=$n,"selectionStart"in n&&go(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Al&&Ml(Al,n)||(Al=n,n=Ti(bo,"onSelect"),0<n.length&&(s=new Mn("onSelect","select",null,s,a),t.push({event:s,listeners:n}),s.target=$n)))}function Pa(t,s){var a={};return a[t.toLowerCase()]=s.toLowerCase(),a["Webkit"+t]="webkit"+s,a["Moz"+t]="moz"+s,a}var Dn={animationend:Pa("Animation","AnimationEnd"),animationiteration:Pa("Animation","AnimationIteration"),animationstart:Pa("Animation","AnimationStart"),transitionrun:Pa("Transition","TransitionRun"),transitionstart:Pa("Transition","TransitionStart"),transitioncancel:Pa("Transition","TransitionCancel"),transitionend:Pa("Transition","TransitionEnd")},vo={},tu={};fs&&(tu=document.createElement("div").style,"AnimationEvent"in window||(delete Dn.animationend.animation,delete Dn.animationiteration.animation,delete Dn.animationstart.animation),"TransitionEvent"in window||delete Dn.transitionend.transition);function Za(t){if(vo[t])return vo[t];if(!Dn[t])return t;var s=Dn[t],a;for(a in s)if(s.hasOwnProperty(a)&&a in tu)return vo[t]=s[a];return t}var su=Za("animationend"),au=Za("animationiteration"),nu=Za("animationstart"),Yf=Za("transitionrun"),Qf=Za("transitionstart"),Jf=Za("transitioncancel"),lu=Za("transitionend"),ru=new Map,jo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jo.push("scrollEnd");function ps(t,s){ru.set(t,s),us(s,[t])}var Gr=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},ts=[],_n=0,No=0;function Vr(){for(var t=_n,s=No=_n=0;s<t;){var a=ts[s];ts[s++]=null;var n=ts[s];ts[s++]=null;var o=ts[s];ts[s++]=null;var u=ts[s];if(ts[s++]=null,n!==null&&o!==null){var p=n.pending;p===null?o.next=o:(o.next=p.next,p.next=o),n.pending=o}u!==0&&iu(a,o,u)}}function Yr(t,s,a,n){ts[_n++]=t,ts[_n++]=s,ts[_n++]=a,ts[_n++]=n,No|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function wo(t,s,a,n){return Yr(t,s,a,n),Qr(t)}function Ka(t,s){return Yr(t,null,null,s),Qr(t)}function iu(t,s,a){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a);for(var o=!1,u=t.return;u!==null;)u.childLanes|=a,n=u.alternate,n!==null&&(n.childLanes|=a),u.tag===22&&(t=u.stateNode,t===null||t._visibility&1||(o=!0)),t=u,u=u.return;return t.tag===3?(u=t.stateNode,o&&s!==null&&(o=31-wt(a),t=u.hiddenUpdates,n=t[o],n===null?t[o]=[s]:n.push(s),s.lane=a|536870912),u):null}function Qr(t){if(50<Kl)throw Kl=0,Dc=null,Error(c(185));for(var s=t.return;s!==null;)t=s,s=t.return;return t.tag===3?t.stateNode:null}var On={};function Xf(t,s,a,n){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jt(t,s,a,n){return new Xf(t,s,a,n)}function So(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ts(t,s){var a=t.alternate;return a===null?(a=Jt(t.tag,s,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=s,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&65011712,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,s=t.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a.refCleanup=t.refCleanup,a}function ou(t,s){t.flags&=65011714;var a=t.alternate;return a===null?(t.childLanes=0,t.lanes=s,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=a.childLanes,t.lanes=a.lanes,t.child=a.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=a.memoizedProps,t.memoizedState=a.memoizedState,t.updateQueue=a.updateQueue,t.type=a.type,s=a.dependencies,t.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t}function Jr(t,s,a,n,o,u){var p=0;if(n=t,typeof t=="function")So(t)&&(p=1);else if(typeof t=="string")p=Wh(t,a,le.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case M:return t=Jt(31,a,s,o),t.elementType=M,t.lanes=u,t;case E:return Fa(a.children,o,u,s);case $:p=8,o|=24;break;case Z:return t=Jt(12,a,s,o|2),t.elementType=Z,t.lanes=u,t;case D:return t=Jt(13,a,s,o),t.elementType=D,t.lanes=u,t;case T:return t=Jt(19,a,s,o),t.elementType=T,t.lanes=u,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case V:p=10;break e;case R:p=9;break e;case J:p=11;break e;case G:p=14;break e;case _:p=16,n=null;break e}p=29,a=Error(c(130,t===null?"null":typeof t,"")),n=null}return s=Jt(p,a,s,o),s.elementType=t,s.type=n,s.lanes=u,s}function Fa(t,s,a,n){return t=Jt(7,t,n,s),t.lanes=a,t}function ko(t,s,a){return t=Jt(6,t,null,s),t.lanes=a,t}function cu(t){var s=Jt(18,null,null,0);return s.stateNode=t,s}function Co(t,s,a){return s=Jt(4,t.children!==null?t.children:[],t.key,s),s.lanes=a,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}var du=new WeakMap;function ss(t,s){if(typeof t=="object"&&t!==null){var a=du.get(t);return a!==void 0?a:(s={value:t,source:s,stack:cl(s)},du.set(t,s),s)}return{value:t,source:s,stack:cl(s)}}var zn=[],Rn=0,Xr=null,Tl=0,as=[],ns=0,oa=null,Ns=1,ws="";function $s(t,s){zn[Rn++]=Tl,zn[Rn++]=Xr,Xr=t,Tl=s}function uu(t,s,a){as[ns++]=Ns,as[ns++]=ws,as[ns++]=oa,oa=t;var n=Ns;t=ws;var o=32-wt(n)-1;n&=~(1<<o),a+=1;var u=32-wt(s)+o;if(30<u){var p=o-o%5;u=(n&(1<<p)-1).toString(32),n>>=p,o-=p,Ns=1<<32-wt(s)+o|a<<o|n,ws=u+t}else Ns=1<<u|a<<o|n,ws=t}function Eo(t){t.return!==null&&($s(t,1),uu(t,1,0))}function Mo(t){for(;t===Xr;)Xr=zn[--Rn],zn[Rn]=null,Tl=zn[--Rn],zn[Rn]=null;for(;t===oa;)oa=as[--ns],as[ns]=null,ws=as[--ns],as[ns]=null,Ns=as[--ns],as[ns]=null}function mu(t,s){as[ns++]=Ns,as[ns++]=ws,as[ns++]=oa,Ns=s.id,ws=s.overflow,oa=t}var kt=null,We=null,Ie=!1,ca=null,ls=!1,Ao=Error(c(519));function da(t){var s=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw $l(ss(s,t)),Ao}function xu(t){var s=t.stateNode,a=t.type,n=t.memoizedProps;switch(s[ot]=t,s[St]=n,a){case"dialog":Le("cancel",s),Le("close",s);break;case"iframe":case"object":case"embed":Le("load",s);break;case"video":case"audio":for(a=0;a<Wl.length;a++)Le(Wl[a],s);break;case"source":Le("error",s);break;case"img":case"image":case"link":Le("error",s),Le("load",s);break;case"details":Le("toggle",s);break;case"input":Le("invalid",s),Dr(s,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Le("invalid",s);break;case"textarea":Le("invalid",s),Ya(s,n.value,n.defaultValue,n.children)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||s.textContent===""+a||n.suppressHydrationWarning===!0||Tm(s.textContent,a)?(n.popover!=null&&(Le("beforetoggle",s),Le("toggle",s)),n.onScroll!=null&&Le("scroll",s),n.onScrollEnd!=null&&Le("scrollend",s),n.onClick!=null&&(s.onclick=xs),s=!0):s=!1,s||da(t,!0)}function fu(t){for(kt=t.return;kt;)switch(kt.tag){case 5:case 31:case 13:ls=!1;return;case 27:case 3:ls=!0;return;default:kt=kt.return}}function Ln(t){if(t!==kt)return!1;if(!Ie)return fu(t),Ie=!0,!1;var s=t.tag,a;if((a=s!==3&&s!==27)&&((a=s===5)&&(a=t.type,a=!(a!=="form"&&a!=="button")||Jc(t.type,t.memoizedProps)),a=!a),a&&We&&da(t),fu(t),s===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));We=Hm(t)}else if(s===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(317));We=Hm(t)}else s===27?(s=We,Sa(t.type)?(t=Fc,Fc=null,We=t):We=s):We=kt?is(t.stateNode.nextSibling):null;return!0}function Wa(){We=kt=null,Ie=!1}function To(){var t=ca;return t!==null&&(It===null?It=t:It.push.apply(It,t),ca=null),t}function $l(t){ca===null?ca=[t]:ca.push(t)}var $o=O(null),en=null,Ds=null;function ua(t,s,a){he($o,s._currentValue),s._currentValue=a}function _s(t){t._currentValue=$o.current,se($o)}function Do(t,s,a){for(;t!==null;){var n=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,n!==null&&(n.childLanes|=s)):n!==null&&(n.childLanes&s)!==s&&(n.childLanes|=s),t===a)break;t=t.return}}function _o(t,s,a,n){var o=t.child;for(o!==null&&(o.return=t);o!==null;){var u=o.dependencies;if(u!==null){var p=o.child;u=u.firstContext;e:for(;u!==null;){var j=u;u=o;for(var z=0;z<s.length;z++)if(j.context===s[z]){u.lanes|=a,j=u.alternate,j!==null&&(j.lanes|=a),Do(u.return,a,t),n||(p=null);break e}u=j.next}}else if(o.tag===18){if(p=o.return,p===null)throw Error(c(341));p.lanes|=a,u=p.alternate,u!==null&&(u.lanes|=a),Do(p,a,t),p=null}else p=o.child;if(p!==null)p.return=o;else for(p=o;p!==null;){if(p===t){p=null;break}if(o=p.sibling,o!==null){o.return=p.return,p=o;break}p=p.return}o=p}}function Bn(t,s,a,n){t=null;for(var o=s,u=!1;o!==null;){if(!u){if((o.flags&524288)!==0)u=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var p=o.alternate;if(p===null)throw Error(c(387));if(p=p.memoizedProps,p!==null){var j=o.type;Qt(o.pendingProps.value,p.value)||(t!==null?t.push(j):t=[j])}}else if(o===Ae.current){if(p=o.alternate,p===null)throw Error(c(387));p.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(t!==null?t.push(nr):t=[nr])}o=o.return}t!==null&&_o(s,t,a,n),s.flags|=262144}function Pr(t){for(t=t.firstContext;t!==null;){if(!Qt(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function tn(t){en=t,Ds=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Ct(t){return hu(en,t)}function Zr(t,s){return en===null&&tn(t),hu(t,s)}function hu(t,s){var a=s._currentValue;if(s={context:s,memoizedValue:a,next:null},Ds===null){if(t===null)throw Error(c(308));Ds=s,t.dependencies={lanes:0,firstContext:s},t.flags|=524288}else Ds=Ds.next=s;return a}var Pf=typeof AbortController<"u"?AbortController:function(){var t=[],s=this.signal={aborted:!1,addEventListener:function(a,n){t.push(n)}};this.abort=function(){s.aborted=!0,t.forEach(function(a){return a()})}},Zf=i.unstable_scheduleCallback,Kf=i.unstable_NormalPriority,ut={$$typeof:V,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Oo(){return{controller:new Pf,data:new Map,refCount:0}}function Dl(t){t.refCount--,t.refCount===0&&Zf(Kf,function(){t.controller.abort()})}var _l=null,zo=0,Hn=0,Un=null;function Ff(t,s){if(_l===null){var a=_l=[];zo=0,Hn=Bc(),Un={status:"pending",value:void 0,then:function(n){a.push(n)}}}return zo++,s.then(pu,pu),s}function pu(){if(--zo===0&&_l!==null){Un!==null&&(Un.status="fulfilled");var t=_l;_l=null,Hn=0,Un=null;for(var s=0;s<t.length;s++)(0,t[s])()}}function Wf(t,s){var a=[],n={status:"pending",value:null,reason:null,then:function(o){a.push(o)}};return t.then(function(){n.status="fulfilled",n.value=s;for(var o=0;o<a.length;o++)(0,a[o])(s)},function(o){for(n.status="rejected",n.reason=o,o=0;o<a.length;o++)(0,a[o])(void 0)}),n}var gu=L.S;L.S=function(t,s){em=Nt(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Ff(t,s),gu!==null&&gu(t,s)};var sn=O(null);function Ro(){var t=sn.current;return t!==null?t:Ze.pooledCache}function Kr(t,s){s===null?he(sn,sn.current):he(sn,s.pool)}function bu(){var t=Ro();return t===null?null:{parent:ut._currentValue,pool:t}}var In=Error(c(460)),Lo=Error(c(474)),Fr=Error(c(542)),Wr={then:function(){}};function yu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function vu(t,s,a){switch(a=t[a],a===void 0?t.push(s):a!==s&&(s.then(xs,xs),s=a),s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Nu(t),t;default:if(typeof s.status=="string")s.then(xs,xs);else{if(t=Ze,t!==null&&100<t.shellSuspendCounter)throw Error(c(482));t=s,t.status="pending",t.then(function(n){if(s.status==="pending"){var o=s;o.status="fulfilled",o.value=n}},function(n){if(s.status==="pending"){var o=s;o.status="rejected",o.reason=n}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw t=s.reason,Nu(t),t}throw nn=s,In}}function an(t){try{var s=t._init;return s(t._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(nn=a,In):a}}var nn=null;function ju(){if(nn===null)throw Error(c(459));var t=nn;return nn=null,t}function Nu(t){if(t===In||t===Fr)throw Error(c(483))}var qn=null,Ol=0;function ei(t){var s=Ol;return Ol+=1,qn===null&&(qn=[]),vu(qn,t,s)}function zl(t,s){s=s.props.ref,t.ref=s!==void 0?s:null}function ti(t,s){throw s.$$typeof===S?Error(c(525)):(t=Object.prototype.toString.call(s),Error(c(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t)))}function wu(t){function s(P,q){if(t){var F=P.deletions;F===null?(P.deletions=[q],P.flags|=16):F.push(q)}}function a(P,q){if(!t)return null;for(;q!==null;)s(P,q),q=q.sibling;return null}function n(P){for(var q=new Map;P!==null;)P.key!==null?q.set(P.key,P):q.set(P.index,P),P=P.sibling;return q}function o(P,q){return P=Ts(P,q),P.index=0,P.sibling=null,P}function u(P,q,F){return P.index=F,t?(F=P.alternate,F!==null?(F=F.index,F<q?(P.flags|=67108866,q):F):(P.flags|=67108866,q)):(P.flags|=1048576,q)}function p(P){return t&&P.alternate===null&&(P.flags|=67108866),P}function j(P,q,F,ce){return q===null||q.tag!==6?(q=ko(F,P.mode,ce),q.return=P,q):(q=o(q,F),q.return=P,q)}function z(P,q,F,ce){var Ce=F.type;return Ce===E?ie(P,q,F.props.children,ce,F.key):q!==null&&(q.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===_&&an(Ce)===q.type)?(q=o(q,F.props),zl(q,F),q.return=P,q):(q=Jr(F.type,F.key,F.props,null,P.mode,ce),zl(q,F),q.return=P,q)}function W(P,q,F,ce){return q===null||q.tag!==4||q.stateNode.containerInfo!==F.containerInfo||q.stateNode.implementation!==F.implementation?(q=Co(F,P.mode,ce),q.return=P,q):(q=o(q,F.children||[]),q.return=P,q)}function ie(P,q,F,ce,Ce){return q===null||q.tag!==7?(q=Fa(F,P.mode,ce,Ce),q.return=P,q):(q=o(q,F),q.return=P,q)}function me(P,q,F){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return q=ko(""+q,P.mode,F),q.return=P,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case C:return F=Jr(q.type,q.key,q.props,null,P.mode,F),zl(F,q),F.return=P,F;case A:return q=Co(q,P.mode,F),q.return=P,q;case _:return q=an(q),me(P,q,F)}if(X(q)||Q(q))return q=Fa(q,P.mode,F,null),q.return=P,q;if(typeof q.then=="function")return me(P,ei(q),F);if(q.$$typeof===V)return me(P,Zr(P,q),F);ti(P,q)}return null}function ee(P,q,F,ce){var Ce=q!==null?q.key:null;if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return Ce!==null?null:j(P,q,""+F,ce);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case C:return F.key===Ce?z(P,q,F,ce):null;case A:return F.key===Ce?W(P,q,F,ce):null;case _:return F=an(F),ee(P,q,F,ce)}if(X(F)||Q(F))return Ce!==null?null:ie(P,q,F,ce,null);if(typeof F.then=="function")return ee(P,q,ei(F),ce);if(F.$$typeof===V)return ee(P,q,Zr(P,F),ce);ti(P,F)}return null}function te(P,q,F,ce,Ce){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return P=P.get(F)||null,j(q,P,""+ce,Ce);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case C:return P=P.get(ce.key===null?F:ce.key)||null,z(q,P,ce,Ce);case A:return P=P.get(ce.key===null?F:ce.key)||null,W(q,P,ce,Ce);case _:return ce=an(ce),te(P,q,F,ce,Ce)}if(X(ce)||Q(ce))return P=P.get(F)||null,ie(q,P,ce,Ce,null);if(typeof ce.then=="function")return te(P,q,F,ei(ce),Ce);if(ce.$$typeof===V)return te(P,q,F,Zr(q,ce),Ce);ti(q,ce)}return null}function we(P,q,F,ce){for(var Ce=null,qe=null,Se=q,_e=q=0,He=null;Se!==null&&_e<F.length;_e++){Se.index>_e?(He=Se,Se=null):He=Se.sibling;var Ge=ee(P,Se,F[_e],ce);if(Ge===null){Se===null&&(Se=He);break}t&&Se&&Ge.alternate===null&&s(P,Se),q=u(Ge,q,_e),qe===null?Ce=Ge:qe.sibling=Ge,qe=Ge,Se=He}if(_e===F.length)return a(P,Se),Ie&&$s(P,_e),Ce;if(Se===null){for(;_e<F.length;_e++)Se=me(P,F[_e],ce),Se!==null&&(q=u(Se,q,_e),qe===null?Ce=Se:qe.sibling=Se,qe=Se);return Ie&&$s(P,_e),Ce}for(Se=n(Se);_e<F.length;_e++)He=te(Se,P,_e,F[_e],ce),He!==null&&(t&&He.alternate!==null&&Se.delete(He.key===null?_e:He.key),q=u(He,q,_e),qe===null?Ce=He:qe.sibling=He,qe=He);return t&&Se.forEach(function(Aa){return s(P,Aa)}),Ie&&$s(P,_e),Ce}function Ee(P,q,F,ce){if(F==null)throw Error(c(151));for(var Ce=null,qe=null,Se=q,_e=q=0,He=null,Ge=F.next();Se!==null&&!Ge.done;_e++,Ge=F.next()){Se.index>_e?(He=Se,Se=null):He=Se.sibling;var Aa=ee(P,Se,Ge.value,ce);if(Aa===null){Se===null&&(Se=He);break}t&&Se&&Aa.alternate===null&&s(P,Se),q=u(Aa,q,_e),qe===null?Ce=Aa:qe.sibling=Aa,qe=Aa,Se=He}if(Ge.done)return a(P,Se),Ie&&$s(P,_e),Ce;if(Se===null){for(;!Ge.done;_e++,Ge=F.next())Ge=me(P,Ge.value,ce),Ge!==null&&(q=u(Ge,q,_e),qe===null?Ce=Ge:qe.sibling=Ge,qe=Ge);return Ie&&$s(P,_e),Ce}for(Se=n(Se);!Ge.done;_e++,Ge=F.next())Ge=te(Se,P,_e,Ge.value,ce),Ge!==null&&(t&&Ge.alternate!==null&&Se.delete(Ge.key===null?_e:Ge.key),q=u(Ge,q,_e),qe===null?Ce=Ge:qe.sibling=Ge,qe=Ge);return t&&Se.forEach(function(dp){return s(P,dp)}),Ie&&$s(P,_e),Ce}function Pe(P,q,F,ce){if(typeof F=="object"&&F!==null&&F.type===E&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case C:e:{for(var Ce=F.key;q!==null;){if(q.key===Ce){if(Ce=F.type,Ce===E){if(q.tag===7){a(P,q.sibling),ce=o(q,F.props.children),ce.return=P,P=ce;break e}}else if(q.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===_&&an(Ce)===q.type){a(P,q.sibling),ce=o(q,F.props),zl(ce,F),ce.return=P,P=ce;break e}a(P,q);break}else s(P,q);q=q.sibling}F.type===E?(ce=Fa(F.props.children,P.mode,ce,F.key),ce.return=P,P=ce):(ce=Jr(F.type,F.key,F.props,null,P.mode,ce),zl(ce,F),ce.return=P,P=ce)}return p(P);case A:e:{for(Ce=F.key;q!==null;){if(q.key===Ce)if(q.tag===4&&q.stateNode.containerInfo===F.containerInfo&&q.stateNode.implementation===F.implementation){a(P,q.sibling),ce=o(q,F.children||[]),ce.return=P,P=ce;break e}else{a(P,q);break}else s(P,q);q=q.sibling}ce=Co(F,P.mode,ce),ce.return=P,P=ce}return p(P);case _:return F=an(F),Pe(P,q,F,ce)}if(X(F))return we(P,q,F,ce);if(Q(F)){if(Ce=Q(F),typeof Ce!="function")throw Error(c(150));return F=Ce.call(F),Ee(P,q,F,ce)}if(typeof F.then=="function")return Pe(P,q,ei(F),ce);if(F.$$typeof===V)return Pe(P,q,Zr(P,F),ce);ti(P,F)}return typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint"?(F=""+F,q!==null&&q.tag===6?(a(P,q.sibling),ce=o(q,F),ce.return=P,P=ce):(a(P,q),ce=ko(F,P.mode,ce),ce.return=P,P=ce),p(P)):a(P,q)}return function(P,q,F,ce){try{Ol=0;var Ce=Pe(P,q,F,ce);return qn=null,Ce}catch(Se){if(Se===In||Se===Fr)throw Se;var qe=Jt(29,Se,null,P.mode);return qe.lanes=ce,qe.return=P,qe}finally{}}}var ln=wu(!0),Su=wu(!1),ma=!1;function Bo(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ho(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function xa(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function fa(t,s,a){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Ve&2)!==0){var o=n.pending;return o===null?s.next=s:(s.next=o.next,o.next=s),n.pending=s,s=Qr(t),iu(t,null,a),s}return Yr(t,n,s,a),Qr(t)}function Rl(t,s,a){if(s=s.updateQueue,s!==null&&(s=s.shared,(a&4194048)!==0)){var n=s.lanes;n&=t.pendingLanes,a|=n,s.lanes=a,so(t,a)}}function Uo(t,s){var a=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var o=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var p={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?o=u=p:u=u.next=p,a=a.next}while(a!==null);u===null?o=u=s:u=u.next=s}else o=u=s;a={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:n.shared,callbacks:n.callbacks},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=s:t.next=s,a.lastBaseUpdate=s}var Io=!1;function Ll(){if(Io){var t=Un;if(t!==null)throw t}}function Bl(t,s,a,n){Io=!1;var o=t.updateQueue;ma=!1;var u=o.firstBaseUpdate,p=o.lastBaseUpdate,j=o.shared.pending;if(j!==null){o.shared.pending=null;var z=j,W=z.next;z.next=null,p===null?u=W:p.next=W,p=z;var ie=t.alternate;ie!==null&&(ie=ie.updateQueue,j=ie.lastBaseUpdate,j!==p&&(j===null?ie.firstBaseUpdate=W:j.next=W,ie.lastBaseUpdate=z))}if(u!==null){var me=o.baseState;p=0,ie=W=z=null,j=u;do{var ee=j.lane&-536870913,te=ee!==j.lane;if(te?(Be&ee)===ee:(n&ee)===ee){ee!==0&&ee===Hn&&(Io=!0),ie!==null&&(ie=ie.next={lane:0,tag:j.tag,payload:j.payload,callback:null,next:null});e:{var we=t,Ee=j;ee=s;var Pe=a;switch(Ee.tag){case 1:if(we=Ee.payload,typeof we=="function"){me=we.call(Pe,me,ee);break e}me=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=Ee.payload,ee=typeof we=="function"?we.call(Pe,me,ee):we,ee==null)break e;me=y({},me,ee);break e;case 2:ma=!0}}ee=j.callback,ee!==null&&(t.flags|=64,te&&(t.flags|=8192),te=o.callbacks,te===null?o.callbacks=[ee]:te.push(ee))}else te={lane:ee,tag:j.tag,payload:j.payload,callback:j.callback,next:null},ie===null?(W=ie=te,z=me):ie=ie.next=te,p|=ee;if(j=j.next,j===null){if(j=o.shared.pending,j===null)break;te=j,j=te.next,te.next=null,o.lastBaseUpdate=te,o.shared.pending=null}}while(!0);ie===null&&(z=me),o.baseState=z,o.firstBaseUpdate=W,o.lastBaseUpdate=ie,u===null&&(o.shared.lanes=0),ya|=p,t.lanes=p,t.memoizedState=me}}function ku(t,s){if(typeof t!="function")throw Error(c(191,t));t.call(s)}function Cu(t,s){var a=t.callbacks;if(a!==null)for(t.callbacks=null,t=0;t<a.length;t++)ku(a[t],s)}var Gn=O(null),si=O(0);function Eu(t,s){t=qs,he(si,t),he(Gn,s),qs=t|s.baseLanes}function qo(){he(si,qs),he(Gn,Gn.current)}function Go(){qs=si.current,se(Gn),se(si)}var Xt=O(null),rs=null;function ha(t){var s=t.alternate;he(rt,rt.current&1),he(Xt,t),rs===null&&(s===null||Gn.current!==null||s.memoizedState!==null)&&(rs=t)}function Vo(t){he(rt,rt.current),he(Xt,t),rs===null&&(rs=t)}function Mu(t){t.tag===22?(he(rt,rt.current),he(Xt,t),rs===null&&(rs=t)):pa()}function pa(){he(rt,rt.current),he(Xt,Xt.current)}function Pt(t){se(Xt),rs===t&&(rs=null),se(rt)}var rt=O(0);function ai(t){for(var s=t;s!==null;){if(s.tag===13){var a=s.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Zc(a)||Kc(a)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Os=0,$e=null,Je=null,mt=null,ni=!1,Vn=!1,rn=!1,li=0,Hl=0,Yn=null,eh=0;function at(){throw Error(c(321))}function Yo(t,s){if(s===null)return!1;for(var a=0;a<s.length&&a<t.length;a++)if(!Qt(t[a],s[a]))return!1;return!0}function Qo(t,s,a,n,o,u){return Os=u,$e=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,L.H=t===null||t.memoizedState===null?u0:ic,rn=!1,u=a(n,o),rn=!1,Vn&&(u=Tu(s,a,n,o)),Au(t),u}function Au(t){L.H=ql;var s=Je!==null&&Je.next!==null;if(Os=0,mt=Je=$e=null,ni=!1,Hl=0,Yn=null,s)throw Error(c(300));t===null||xt||(t=t.dependencies,t!==null&&Pr(t)&&(xt=!0))}function Tu(t,s,a,n){$e=t;var o=0;do{if(Vn&&(Yn=null),Hl=0,Vn=!1,25<=o)throw Error(c(301));if(o+=1,mt=Je=null,t.updateQueue!=null){var u=t.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}L.H=m0,u=s(a,n)}while(Vn);return u}function th(){var t=L.H,s=t.useState()[0];return s=typeof s.then=="function"?Ul(s):s,t=t.useState()[0],(Je!==null?Je.memoizedState:null)!==t&&($e.flags|=1024),s}function Jo(){var t=li!==0;return li=0,t}function Xo(t,s,a){s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~a}function Po(t){if(ni){for(t=t.memoizedState;t!==null;){var s=t.queue;s!==null&&(s.pending=null),t=t.next}ni=!1}Os=0,mt=Je=$e=null,Vn=!1,Hl=li=0,Yn=null}function _t(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mt===null?$e.memoizedState=mt=t:mt=mt.next=t,mt}function it(){if(Je===null){var t=$e.alternate;t=t!==null?t.memoizedState:null}else t=Je.next;var s=mt===null?$e.memoizedState:mt.next;if(s!==null)mt=s,Je=t;else{if(t===null)throw $e.alternate===null?Error(c(467)):Error(c(310));Je=t,t={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},mt===null?$e.memoizedState=mt=t:mt=mt.next=t}return mt}function ri(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ul(t){var s=Hl;return Hl+=1,Yn===null&&(Yn=[]),t=vu(Yn,t,s),s=$e,(mt===null?s.memoizedState:mt.next)===null&&(s=s.alternate,L.H=s===null||s.memoizedState===null?u0:ic),t}function ii(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ul(t);if(t.$$typeof===V)return Ct(t)}throw Error(c(438,String(t)))}function Zo(t){var s=null,a=$e.updateQueue;if(a!==null&&(s=a.memoCache),s==null){var n=$e.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(s={data:n.data.map(function(o){return o.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),a===null&&(a=ri(),$e.updateQueue=a),a.memoCache=s,a=s.data[s.index],a===void 0)for(a=s.data[s.index]=Array(t),n=0;n<t;n++)a[n]=U;return s.index++,a}function zs(t,s){return typeof s=="function"?s(t):s}function oi(t){var s=it();return Ko(s,Je,t)}function Ko(t,s,a){var n=t.queue;if(n===null)throw Error(c(311));n.lastRenderedReducer=a;var o=t.baseQueue,u=n.pending;if(u!==null){if(o!==null){var p=o.next;o.next=u.next,u.next=p}s.baseQueue=o=u,n.pending=null}if(u=t.baseState,o===null)t.memoizedState=u;else{s=o.next;var j=p=null,z=null,W=s,ie=!1;do{var me=W.lane&-536870913;if(me!==W.lane?(Be&me)===me:(Os&me)===me){var ee=W.revertLane;if(ee===0)z!==null&&(z=z.next={lane:0,revertLane:0,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),me===Hn&&(ie=!0);else if((Os&ee)===ee){W=W.next,ee===Hn&&(ie=!0);continue}else me={lane:0,revertLane:W.revertLane,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},z===null?(j=z=me,p=u):z=z.next=me,$e.lanes|=ee,ya|=ee;me=W.action,rn&&a(u,me),u=W.hasEagerState?W.eagerState:a(u,me)}else ee={lane:me,revertLane:W.revertLane,gesture:W.gesture,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},z===null?(j=z=ee,p=u):z=z.next=ee,$e.lanes|=me,ya|=me;W=W.next}while(W!==null&&W!==s);if(z===null?p=u:z.next=j,!Qt(u,t.memoizedState)&&(xt=!0,ie&&(a=Un,a!==null)))throw a;t.memoizedState=u,t.baseState=p,t.baseQueue=z,n.lastRenderedState=u}return o===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Fo(t){var s=it(),a=s.queue;if(a===null)throw Error(c(311));a.lastRenderedReducer=t;var n=a.dispatch,o=a.pending,u=s.memoizedState;if(o!==null){a.pending=null;var p=o=o.next;do u=t(u,p.action),p=p.next;while(p!==o);Qt(u,s.memoizedState)||(xt=!0),s.memoizedState=u,s.baseQueue===null&&(s.baseState=u),a.lastRenderedState=u}return[u,n]}function $u(t,s,a){var n=$e,o=it(),u=Ie;if(u){if(a===void 0)throw Error(c(407));a=a()}else a=s();var p=!Qt((Je||o).memoizedState,a);if(p&&(o.memoizedState=a,xt=!0),o=o.queue,tc(Ou.bind(null,n,o,t),[t]),o.getSnapshot!==s||p||mt!==null&&mt.memoizedState.tag&1){if(n.flags|=2048,Qn(9,{destroy:void 0},_u.bind(null,n,o,a,s),null),Ze===null)throw Error(c(349));u||(Os&127)!==0||Du(n,s,a)}return a}function Du(t,s,a){t.flags|=16384,t={getSnapshot:s,value:a},s=$e.updateQueue,s===null?(s=ri(),$e.updateQueue=s,s.stores=[t]):(a=s.stores,a===null?s.stores=[t]:a.push(t))}function _u(t,s,a,n){s.value=a,s.getSnapshot=n,zu(s)&&Ru(t)}function Ou(t,s,a){return a(function(){zu(s)&&Ru(t)})}function zu(t){var s=t.getSnapshot;t=t.value;try{var a=s();return!Qt(t,a)}catch{return!0}}function Ru(t){var s=Ka(t,2);s!==null&&qt(s,t,2)}function Wo(t){var s=_t();if(typeof t=="function"){var a=t;if(t=a(),rn){Yt(!0);try{a()}finally{Yt(!1)}}}return s.memoizedState=s.baseState=t,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:t},s}function Lu(t,s,a,n){return t.baseState=a,Ko(t,Je,typeof n=="function"?n:zs)}function sh(t,s,a,n,o){if(ui(t))throw Error(c(485));if(t=s.action,t!==null){var u={payload:o,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(p){u.listeners.push(p)}};L.T!==null?a(!0):u.isTransition=!1,n(u),a=s.pending,a===null?(u.next=s.pending=u,Bu(s,u)):(u.next=a.next,s.pending=a.next=u)}}function Bu(t,s){var a=s.action,n=s.payload,o=t.state;if(s.isTransition){var u=L.T,p={};L.T=p;try{var j=a(o,n),z=L.S;z!==null&&z(p,j),Hu(t,s,j)}catch(W){ec(t,s,W)}finally{u!==null&&p.types!==null&&(u.types=p.types),L.T=u}}else try{u=a(o,n),Hu(t,s,u)}catch(W){ec(t,s,W)}}function Hu(t,s,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){Uu(t,s,n)},function(n){return ec(t,s,n)}):Uu(t,s,a)}function Uu(t,s,a){s.status="fulfilled",s.value=a,Iu(s),t.state=a,s=t.pending,s!==null&&(a=s.next,a===s?t.pending=null:(a=a.next,s.next=a,Bu(t,a)))}function ec(t,s,a){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do s.status="rejected",s.reason=a,Iu(s),s=s.next;while(s!==n)}t.action=null}function Iu(t){t=t.listeners;for(var s=0;s<t.length;s++)(0,t[s])()}function qu(t,s){return s}function Gu(t,s){if(Ie){var a=Ze.formState;if(a!==null){e:{var n=$e;if(Ie){if(We){t:{for(var o=We,u=ls;o.nodeType!==8;){if(!u){o=null;break t}if(o=is(o.nextSibling),o===null){o=null;break t}}u=o.data,o=u==="F!"||u==="F"?o:null}if(o){We=is(o.nextSibling),n=o.data==="F!";break e}}da(n)}n=!1}n&&(s=a[0])}}return a=_t(),a.memoizedState=a.baseState=s,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qu,lastRenderedState:s},a.queue=n,a=o0.bind(null,$e,n),n.dispatch=a,n=Wo(!1),u=rc.bind(null,$e,!1,n.queue),n=_t(),o={state:s,dispatch:null,action:t,pending:null},n.queue=o,a=sh.bind(null,$e,o,u,a),o.dispatch=a,n.memoizedState=t,[s,a,!1]}function Vu(t){var s=it();return Yu(s,Je,t)}function Yu(t,s,a){if(s=Ko(t,s,qu)[0],t=oi(zs)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var n=Ul(s)}catch(p){throw p===In?Fr:p}else n=s;s=it();var o=s.queue,u=o.dispatch;return a!==s.memoizedState&&($e.flags|=2048,Qn(9,{destroy:void 0},ah.bind(null,o,a),null)),[n,u,t]}function ah(t,s){t.action=s}function Qu(t){var s=it(),a=Je;if(a!==null)return Yu(s,a,t);it(),s=s.memoizedState,a=it();var n=a.queue.dispatch;return a.memoizedState=t,[s,n,!1]}function Qn(t,s,a,n){return t={tag:t,create:a,deps:n,inst:s,next:null},s=$e.updateQueue,s===null&&(s=ri(),$e.updateQueue=s),a=s.lastEffect,a===null?s.lastEffect=t.next=t:(n=a.next,a.next=t,t.next=n,s.lastEffect=t),t}function Ju(){return it().memoizedState}function ci(t,s,a,n){var o=_t();$e.flags|=t,o.memoizedState=Qn(1|s,{destroy:void 0},a,n===void 0?null:n)}function di(t,s,a,n){var o=it();n=n===void 0?null:n;var u=o.memoizedState.inst;Je!==null&&n!==null&&Yo(n,Je.memoizedState.deps)?o.memoizedState=Qn(s,u,a,n):($e.flags|=t,o.memoizedState=Qn(1|s,u,a,n))}function Xu(t,s){ci(8390656,8,t,s)}function tc(t,s){di(2048,8,t,s)}function nh(t){$e.flags|=4;var s=$e.updateQueue;if(s===null)s=ri(),$e.updateQueue=s,s.events=[t];else{var a=s.events;a===null?s.events=[t]:a.push(t)}}function Pu(t){var s=it().memoizedState;return nh({ref:s,nextImpl:t}),function(){if((Ve&2)!==0)throw Error(c(440));return s.impl.apply(void 0,arguments)}}function Zu(t,s){return di(4,2,t,s)}function Ku(t,s){return di(4,4,t,s)}function Fu(t,s){if(typeof s=="function"){t=t();var a=s(t);return function(){typeof a=="function"?a():s(null)}}if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function Wu(t,s,a){a=a!=null?a.concat([t]):null,di(4,4,Fu.bind(null,s,t),a)}function sc(){}function e0(t,s){var a=it();s=s===void 0?null:s;var n=a.memoizedState;return s!==null&&Yo(s,n[1])?n[0]:(a.memoizedState=[t,s],t)}function t0(t,s){var a=it();s=s===void 0?null:s;var n=a.memoizedState;if(s!==null&&Yo(s,n[1]))return n[0];if(n=t(),rn){Yt(!0);try{t()}finally{Yt(!1)}}return a.memoizedState=[n,s],n}function ac(t,s,a){return a===void 0||(Os&1073741824)!==0&&(Be&261930)===0?t.memoizedState=s:(t.memoizedState=a,t=sm(),$e.lanes|=t,ya|=t,a)}function s0(t,s,a,n){return Qt(a,s)?a:Gn.current!==null?(t=ac(t,a,n),Qt(t,s)||(xt=!0),t):(Os&42)===0||(Os&1073741824)!==0&&(Be&261930)===0?(xt=!0,t.memoizedState=a):(t=sm(),$e.lanes|=t,ya|=t,s)}function a0(t,s,a,n,o){var u=I.p;I.p=u!==0&&8>u?u:8;var p=L.T,j={};L.T=j,rc(t,!1,s,a);try{var z=o(),W=L.S;if(W!==null&&W(j,z),z!==null&&typeof z=="object"&&typeof z.then=="function"){var ie=Wf(z,n);Il(t,s,ie,Ft(t))}else Il(t,s,n,Ft(t))}catch(me){Il(t,s,{then:function(){},status:"rejected",reason:me},Ft())}finally{I.p=u,p!==null&&j.types!==null&&(p.types=j.types),L.T=p}}function lh(){}function nc(t,s,a,n){if(t.tag!==5)throw Error(c(476));var o=n0(t).queue;a0(t,o,s,K,a===null?lh:function(){return l0(t),a(n)})}function n0(t){var s=t.memoizedState;if(s!==null)return s;s={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:K},next:null};var a={};return s.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:zs,lastRenderedState:a},next:null},t.memoizedState=s,t=t.alternate,t!==null&&(t.memoizedState=s),s}function l0(t){var s=n0(t);s.next===null&&(s=t.alternate.memoizedState),Il(t,s.next.queue,{},Ft())}function lc(){return Ct(nr)}function r0(){return it().memoizedState}function i0(){return it().memoizedState}function rh(t){for(var s=t.return;s!==null;){switch(s.tag){case 24:case 3:var a=Ft();t=xa(a);var n=fa(s,t,a);n!==null&&(qt(n,s,a),Rl(n,s,a)),s={cache:Oo()},t.payload=s;return}s=s.return}}function ih(t,s,a){var n=Ft();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},ui(t)?c0(s,a):(a=wo(t,s,a,n),a!==null&&(qt(a,t,n),d0(a,s,n)))}function o0(t,s,a){var n=Ft();Il(t,s,a,n)}function Il(t,s,a,n){var o={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(ui(t))c0(s,o);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=s.lastRenderedReducer,u!==null))try{var p=s.lastRenderedState,j=u(p,a);if(o.hasEagerState=!0,o.eagerState=j,Qt(j,p))return Yr(t,s,o,0),Ze===null&&Vr(),!1}catch{}finally{}if(a=wo(t,s,o,n),a!==null)return qt(a,t,n),d0(a,s,n),!0}return!1}function rc(t,s,a,n){if(n={lane:2,revertLane:Bc(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ui(t)){if(s)throw Error(c(479))}else s=wo(t,a,n,2),s!==null&&qt(s,t,2)}function ui(t){var s=t.alternate;return t===$e||s!==null&&s===$e}function c0(t,s){Vn=ni=!0;var a=t.pending;a===null?s.next=s:(s.next=a.next,a.next=s),t.pending=s}function d0(t,s,a){if((a&4194048)!==0){var n=s.lanes;n&=t.pendingLanes,a|=n,s.lanes=a,so(t,a)}}var ql={readContext:Ct,use:ii,useCallback:at,useContext:at,useEffect:at,useImperativeHandle:at,useLayoutEffect:at,useInsertionEffect:at,useMemo:at,useReducer:at,useRef:at,useState:at,useDebugValue:at,useDeferredValue:at,useTransition:at,useSyncExternalStore:at,useId:at,useHostTransitionStatus:at,useFormState:at,useActionState:at,useOptimistic:at,useMemoCache:at,useCacheRefresh:at};ql.useEffectEvent=at;var u0={readContext:Ct,use:ii,useCallback:function(t,s){return _t().memoizedState=[t,s===void 0?null:s],t},useContext:Ct,useEffect:Xu,useImperativeHandle:function(t,s,a){a=a!=null?a.concat([t]):null,ci(4194308,4,Fu.bind(null,s,t),a)},useLayoutEffect:function(t,s){return ci(4194308,4,t,s)},useInsertionEffect:function(t,s){ci(4,2,t,s)},useMemo:function(t,s){var a=_t();s=s===void 0?null:s;var n=t();if(rn){Yt(!0);try{t()}finally{Yt(!1)}}return a.memoizedState=[n,s],n},useReducer:function(t,s,a){var n=_t();if(a!==void 0){var o=a(s);if(rn){Yt(!0);try{a(s)}finally{Yt(!1)}}}else o=s;return n.memoizedState=n.baseState=o,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},n.queue=t,t=t.dispatch=ih.bind(null,$e,t),[n.memoizedState,t]},useRef:function(t){var s=_t();return t={current:t},s.memoizedState=t},useState:function(t){t=Wo(t);var s=t.queue,a=o0.bind(null,$e,s);return s.dispatch=a,[t.memoizedState,a]},useDebugValue:sc,useDeferredValue:function(t,s){var a=_t();return ac(a,t,s)},useTransition:function(){var t=Wo(!1);return t=a0.bind(null,$e,t.queue,!0,!1),_t().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,s,a){var n=$e,o=_t();if(Ie){if(a===void 0)throw Error(c(407));a=a()}else{if(a=s(),Ze===null)throw Error(c(349));(Be&127)!==0||Du(n,s,a)}o.memoizedState=a;var u={value:a,getSnapshot:s};return o.queue=u,Xu(Ou.bind(null,n,u,t),[t]),n.flags|=2048,Qn(9,{destroy:void 0},_u.bind(null,n,u,a,s),null),a},useId:function(){var t=_t(),s=Ze.identifierPrefix;if(Ie){var a=ws,n=Ns;a=(n&~(1<<32-wt(n)-1)).toString(32)+a,s="_"+s+"R_"+a,a=li++,0<a&&(s+="H"+a.toString(32)),s+="_"}else a=eh++,s="_"+s+"r_"+a.toString(32)+"_";return t.memoizedState=s},useHostTransitionStatus:lc,useFormState:Gu,useActionState:Gu,useOptimistic:function(t){var s=_t();s.memoizedState=s.baseState=t;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=a,s=rc.bind(null,$e,!0,a),a.dispatch=s,[t,s]},useMemoCache:Zo,useCacheRefresh:function(){return _t().memoizedState=rh.bind(null,$e)},useEffectEvent:function(t){var s=_t(),a={impl:t};return s.memoizedState=a,function(){if((Ve&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}},ic={readContext:Ct,use:ii,useCallback:e0,useContext:Ct,useEffect:tc,useImperativeHandle:Wu,useInsertionEffect:Zu,useLayoutEffect:Ku,useMemo:t0,useReducer:oi,useRef:Ju,useState:function(){return oi(zs)},useDebugValue:sc,useDeferredValue:function(t,s){var a=it();return s0(a,Je.memoizedState,t,s)},useTransition:function(){var t=oi(zs)[0],s=it().memoizedState;return[typeof t=="boolean"?t:Ul(t),s]},useSyncExternalStore:$u,useId:r0,useHostTransitionStatus:lc,useFormState:Vu,useActionState:Vu,useOptimistic:function(t,s){var a=it();return Lu(a,Je,t,s)},useMemoCache:Zo,useCacheRefresh:i0};ic.useEffectEvent=Pu;var m0={readContext:Ct,use:ii,useCallback:e0,useContext:Ct,useEffect:tc,useImperativeHandle:Wu,useInsertionEffect:Zu,useLayoutEffect:Ku,useMemo:t0,useReducer:Fo,useRef:Ju,useState:function(){return Fo(zs)},useDebugValue:sc,useDeferredValue:function(t,s){var a=it();return Je===null?ac(a,t,s):s0(a,Je.memoizedState,t,s)},useTransition:function(){var t=Fo(zs)[0],s=it().memoizedState;return[typeof t=="boolean"?t:Ul(t),s]},useSyncExternalStore:$u,useId:r0,useHostTransitionStatus:lc,useFormState:Qu,useActionState:Qu,useOptimistic:function(t,s){var a=it();return Je!==null?Lu(a,Je,t,s):(a.baseState=t,[t,a.queue.dispatch])},useMemoCache:Zo,useCacheRefresh:i0};m0.useEffectEvent=Pu;function oc(t,s,a,n){s=t.memoizedState,a=a(n,s),a=a==null?s:y({},s,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var cc={enqueueSetState:function(t,s,a){t=t._reactInternals;var n=Ft(),o=xa(n);o.payload=s,a!=null&&(o.callback=a),s=fa(t,o,n),s!==null&&(qt(s,t,n),Rl(s,t,n))},enqueueReplaceState:function(t,s,a){t=t._reactInternals;var n=Ft(),o=xa(n);o.tag=1,o.payload=s,a!=null&&(o.callback=a),s=fa(t,o,n),s!==null&&(qt(s,t,n),Rl(s,t,n))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var a=Ft(),n=xa(a);n.tag=2,s!=null&&(n.callback=s),s=fa(t,n,a),s!==null&&(qt(s,t,a),Rl(s,t,a))}};function x0(t,s,a,n,o,u,p){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,u,p):s.prototype&&s.prototype.isPureReactComponent?!Ml(a,n)||!Ml(o,u):!0}function f0(t,s,a,n){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(a,n),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(a,n),s.state!==t&&cc.enqueueReplaceState(s,s.state,null)}function on(t,s){var a=s;if("ref"in s){a={};for(var n in s)n!=="ref"&&(a[n]=s[n])}if(t=t.defaultProps){a===s&&(a=y({},a));for(var o in t)a[o]===void 0&&(a[o]=t[o])}return a}function h0(t){Gr(t)}function p0(t){console.error(t)}function g0(t){Gr(t)}function mi(t,s){try{var a=t.onUncaughtError;a(s.value,{componentStack:s.stack})}catch(n){setTimeout(function(){throw n})}}function b0(t,s,a){try{var n=t.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function dc(t,s,a){return a=xa(a),a.tag=3,a.payload={element:null},a.callback=function(){mi(t,s)},a}function y0(t){return t=xa(t),t.tag=3,t}function v0(t,s,a,n){var o=a.type.getDerivedStateFromError;if(typeof o=="function"){var u=n.value;t.payload=function(){return o(u)},t.callback=function(){b0(s,a,n)}}var p=a.stateNode;p!==null&&typeof p.componentDidCatch=="function"&&(t.callback=function(){b0(s,a,n),typeof o!="function"&&(va===null?va=new Set([this]):va.add(this));var j=n.stack;this.componentDidCatch(n.value,{componentStack:j!==null?j:""})})}function oh(t,s,a,n,o){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(s=a.alternate,s!==null&&Bn(s,a,o,!0),a=Xt.current,a!==null){switch(a.tag){case 31:case 13:return rs===null?Si():a.alternate===null&&nt===0&&(nt=3),a.flags&=-257,a.flags|=65536,a.lanes=o,n===Wr?a.flags|=16384:(s=a.updateQueue,s===null?a.updateQueue=new Set([n]):s.add(n),zc(t,n,o)),!1;case 22:return a.flags|=65536,n===Wr?a.flags|=16384:(s=a.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=s):(a=s.retryQueue,a===null?s.retryQueue=new Set([n]):a.add(n)),zc(t,n,o)),!1}throw Error(c(435,a.tag))}return zc(t,n,o),Si(),!1}if(Ie)return s=Xt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=o,n!==Ao&&(t=Error(c(422),{cause:n}),$l(ss(t,a)))):(n!==Ao&&(s=Error(c(423),{cause:n}),$l(ss(s,a))),t=t.current.alternate,t.flags|=65536,o&=-o,t.lanes|=o,n=ss(n,a),o=dc(t.stateNode,n,o),Uo(t,o),nt!==4&&(nt=2)),!1;var u=Error(c(520),{cause:n});if(u=ss(u,a),Zl===null?Zl=[u]:Zl.push(u),nt!==4&&(nt=2),s===null)return!0;n=ss(n,a),a=s;do{switch(a.tag){case 3:return a.flags|=65536,t=o&-o,a.lanes|=t,t=dc(a.stateNode,n,t),Uo(a,t),!1;case 1:if(s=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(va===null||!va.has(u))))return a.flags|=65536,o&=-o,a.lanes|=o,o=y0(o),v0(o,t,a,n),Uo(a,o),!1}a=a.return}while(a!==null);return!1}var uc=Error(c(461)),xt=!1;function Et(t,s,a,n){s.child=t===null?Su(s,null,a,n):ln(s,t.child,a,n)}function j0(t,s,a,n,o){a=a.render;var u=s.ref;if("ref"in n){var p={};for(var j in n)j!=="ref"&&(p[j]=n[j])}else p=n;return tn(s),n=Qo(t,s,a,p,u,o),j=Jo(),t!==null&&!xt?(Xo(t,s,o),Rs(t,s,o)):(Ie&&j&&Eo(s),s.flags|=1,Et(t,s,n,o),s.child)}function N0(t,s,a,n,o){if(t===null){var u=a.type;return typeof u=="function"&&!So(u)&&u.defaultProps===void 0&&a.compare===null?(s.tag=15,s.type=u,w0(t,s,u,n,o)):(t=Jr(a.type,null,n,s,s.mode,o),t.ref=s.ref,t.return=s,s.child=t)}if(u=t.child,!yc(t,o)){var p=u.memoizedProps;if(a=a.compare,a=a!==null?a:Ml,a(p,n)&&t.ref===s.ref)return Rs(t,s,o)}return s.flags|=1,t=Ts(u,n),t.ref=s.ref,t.return=s,s.child=t}function w0(t,s,a,n,o){if(t!==null){var u=t.memoizedProps;if(Ml(u,n)&&t.ref===s.ref)if(xt=!1,s.pendingProps=n=u,yc(t,o))(t.flags&131072)!==0&&(xt=!0);else return s.lanes=t.lanes,Rs(t,s,o)}return mc(t,s,a,n,o)}function S0(t,s,a,n){var o=n.children,u=t!==null?t.memoizedState:null;if(t===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((s.flags&128)!==0){if(u=u!==null?u.baseLanes|a:a,t!==null){for(n=s.child=t.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~u}else n=0,s.child=null;return k0(t,s,u,a,n)}if((a&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},t!==null&&Kr(s,u!==null?u.cachePool:null),u!==null?Eu(s,u):qo(),Mu(s);else return n=s.lanes=536870912,k0(t,s,u!==null?u.baseLanes|a:a,a,n)}else u!==null?(Kr(s,u.cachePool),Eu(s,u),pa(),s.memoizedState=null):(t!==null&&Kr(s,null),qo(),pa());return Et(t,s,o,a),s.child}function Gl(t,s){return t!==null&&t.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function k0(t,s,a,n,o){var u=Ro();return u=u===null?null:{parent:ut._currentValue,pool:u},s.memoizedState={baseLanes:a,cachePool:u},t!==null&&Kr(s,null),qo(),Mu(s),t!==null&&Bn(t,s,n,!0),s.childLanes=o,null}function xi(t,s){return s=hi({mode:s.mode,children:s.children},t.mode),s.ref=t.ref,t.child=s,s.return=t,s}function C0(t,s,a){return ln(s,t.child,null,a),t=xi(s,s.pendingProps),t.flags|=2,Pt(s),s.memoizedState=null,t}function ch(t,s,a){var n=s.pendingProps,o=(s.flags&128)!==0;if(s.flags&=-129,t===null){if(Ie){if(n.mode==="hidden")return t=xi(s,n),s.lanes=536870912,Gl(null,t);if(Vo(s),(t=We)?(t=Bm(t,ls),t=t!==null&&t.data==="&"?t:null,t!==null&&(s.memoizedState={dehydrated:t,treeContext:oa!==null?{id:Ns,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},a=cu(t),a.return=s,s.child=a,kt=s,We=null)):t=null,t===null)throw da(s);return s.lanes=536870912,null}return xi(s,n)}var u=t.memoizedState;if(u!==null){var p=u.dehydrated;if(Vo(s),o)if(s.flags&256)s.flags&=-257,s=C0(t,s,a);else if(s.memoizedState!==null)s.child=t.child,s.flags|=128,s=null;else throw Error(c(558));else if(xt||Bn(t,s,a,!1),o=(a&t.childLanes)!==0,xt||o){if(n=Ze,n!==null&&(p=ao(n,a),p!==0&&p!==u.retryLane))throw u.retryLane=p,Ka(t,p),qt(n,t,p),uc;Si(),s=C0(t,s,a)}else t=u.treeContext,We=is(p.nextSibling),kt=s,Ie=!0,ca=null,ls=!1,t!==null&&mu(s,t),s=xi(s,n),s.flags|=4096;return s}return t=Ts(t.child,{mode:n.mode,children:n.children}),t.ref=s.ref,s.child=t,t.return=s,t}function fi(t,s){var a=s.ref;if(a===null)t!==null&&t.ref!==null&&(s.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(c(284));(t===null||t.ref!==a)&&(s.flags|=4194816)}}function mc(t,s,a,n,o){return tn(s),a=Qo(t,s,a,n,void 0,o),n=Jo(),t!==null&&!xt?(Xo(t,s,o),Rs(t,s,o)):(Ie&&n&&Eo(s),s.flags|=1,Et(t,s,a,o),s.child)}function E0(t,s,a,n,o,u){return tn(s),s.updateQueue=null,a=Tu(s,n,a,o),Au(t),n=Jo(),t!==null&&!xt?(Xo(t,s,u),Rs(t,s,u)):(Ie&&n&&Eo(s),s.flags|=1,Et(t,s,a,u),s.child)}function M0(t,s,a,n,o){if(tn(s),s.stateNode===null){var u=On,p=a.contextType;typeof p=="object"&&p!==null&&(u=Ct(p)),u=new a(n,u),s.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=cc,s.stateNode=u,u._reactInternals=s,u=s.stateNode,u.props=n,u.state=s.memoizedState,u.refs={},Bo(s),p=a.contextType,u.context=typeof p=="object"&&p!==null?Ct(p):On,u.state=s.memoizedState,p=a.getDerivedStateFromProps,typeof p=="function"&&(oc(s,a,p,n),u.state=s.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(p=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),p!==u.state&&cc.enqueueReplaceState(u,u.state,null),Bl(s,n,u,o),Ll(),u.state=s.memoizedState),typeof u.componentDidMount=="function"&&(s.flags|=4194308),n=!0}else if(t===null){u=s.stateNode;var j=s.memoizedProps,z=on(a,j);u.props=z;var W=u.context,ie=a.contextType;p=On,typeof ie=="object"&&ie!==null&&(p=Ct(ie));var me=a.getDerivedStateFromProps;ie=typeof me=="function"||typeof u.getSnapshotBeforeUpdate=="function",j=s.pendingProps!==j,ie||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(j||W!==p)&&f0(s,u,n,p),ma=!1;var ee=s.memoizedState;u.state=ee,Bl(s,n,u,o),Ll(),W=s.memoizedState,j||ee!==W||ma?(typeof me=="function"&&(oc(s,a,me,n),W=s.memoizedState),(z=ma||x0(s,a,z,n,ee,W,p))?(ie||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(s.flags|=4194308)):(typeof u.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=n,s.memoizedState=W),u.props=n,u.state=W,u.context=p,n=z):(typeof u.componentDidMount=="function"&&(s.flags|=4194308),n=!1)}else{u=s.stateNode,Ho(t,s),p=s.memoizedProps,ie=on(a,p),u.props=ie,me=s.pendingProps,ee=u.context,W=a.contextType,z=On,typeof W=="object"&&W!==null&&(z=Ct(W)),j=a.getDerivedStateFromProps,(W=typeof j=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(p!==me||ee!==z)&&f0(s,u,n,z),ma=!1,ee=s.memoizedState,u.state=ee,Bl(s,n,u,o),Ll();var te=s.memoizedState;p!==me||ee!==te||ma||t!==null&&t.dependencies!==null&&Pr(t.dependencies)?(typeof j=="function"&&(oc(s,a,j,n),te=s.memoizedState),(ie=ma||x0(s,a,ie,n,ee,te,z)||t!==null&&t.dependencies!==null&&Pr(t.dependencies))?(W||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,te,z),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,te,z)),typeof u.componentDidUpdate=="function"&&(s.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof u.componentDidUpdate!="function"||p===t.memoizedProps&&ee===t.memoizedState||(s.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||p===t.memoizedProps&&ee===t.memoizedState||(s.flags|=1024),s.memoizedProps=n,s.memoizedState=te),u.props=n,u.state=te,u.context=z,n=ie):(typeof u.componentDidUpdate!="function"||p===t.memoizedProps&&ee===t.memoizedState||(s.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||p===t.memoizedProps&&ee===t.memoizedState||(s.flags|=1024),n=!1)}return u=n,fi(t,s),n=(s.flags&128)!==0,u||n?(u=s.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:u.render(),s.flags|=1,t!==null&&n?(s.child=ln(s,t.child,null,o),s.child=ln(s,null,a,o)):Et(t,s,a,o),s.memoizedState=u.state,t=s.child):t=Rs(t,s,o),t}function A0(t,s,a,n){return Wa(),s.flags|=256,Et(t,s,a,n),s.child}var xc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function fc(t){return{baseLanes:t,cachePool:bu()}}function hc(t,s,a){return t=t!==null?t.childLanes&~a:0,s&&(t|=Kt),t}function T0(t,s,a){var n=s.pendingProps,o=!1,u=(s.flags&128)!==0,p;if((p=u)||(p=t!==null&&t.memoizedState===null?!1:(rt.current&2)!==0),p&&(o=!0,s.flags&=-129),p=(s.flags&32)!==0,s.flags&=-33,t===null){if(Ie){if(o?ha(s):pa(),(t=We)?(t=Bm(t,ls),t=t!==null&&t.data!=="&"?t:null,t!==null&&(s.memoizedState={dehydrated:t,treeContext:oa!==null?{id:Ns,overflow:ws}:null,retryLane:536870912,hydrationErrors:null},a=cu(t),a.return=s,s.child=a,kt=s,We=null)):t=null,t===null)throw da(s);return Kc(t)?s.lanes=32:s.lanes=536870912,null}var j=n.children;return n=n.fallback,o?(pa(),o=s.mode,j=hi({mode:"hidden",children:j},o),n=Fa(n,o,a,null),j.return=s,n.return=s,j.sibling=n,s.child=j,n=s.child,n.memoizedState=fc(a),n.childLanes=hc(t,p,a),s.memoizedState=xc,Gl(null,n)):(ha(s),pc(s,j))}var z=t.memoizedState;if(z!==null&&(j=z.dehydrated,j!==null)){if(u)s.flags&256?(ha(s),s.flags&=-257,s=gc(t,s,a)):s.memoizedState!==null?(pa(),s.child=t.child,s.flags|=128,s=null):(pa(),j=n.fallback,o=s.mode,n=hi({mode:"visible",children:n.children},o),j=Fa(j,o,a,null),j.flags|=2,n.return=s,j.return=s,n.sibling=j,s.child=n,ln(s,t.child,null,a),n=s.child,n.memoizedState=fc(a),n.childLanes=hc(t,p,a),s.memoizedState=xc,s=Gl(null,n));else if(ha(s),Kc(j)){if(p=j.nextSibling&&j.nextSibling.dataset,p)var W=p.dgst;p=W,n=Error(c(419)),n.stack="",n.digest=p,$l({value:n,source:null,stack:null}),s=gc(t,s,a)}else if(xt||Bn(t,s,a,!1),p=(a&t.childLanes)!==0,xt||p){if(p=Ze,p!==null&&(n=ao(p,a),n!==0&&n!==z.retryLane))throw z.retryLane=n,Ka(t,n),qt(p,t,n),uc;Zc(j)||Si(),s=gc(t,s,a)}else Zc(j)?(s.flags|=192,s.child=t.child,s=null):(t=z.treeContext,We=is(j.nextSibling),kt=s,Ie=!0,ca=null,ls=!1,t!==null&&mu(s,t),s=pc(s,n.children),s.flags|=4096);return s}return o?(pa(),j=n.fallback,o=s.mode,z=t.child,W=z.sibling,n=Ts(z,{mode:"hidden",children:n.children}),n.subtreeFlags=z.subtreeFlags&65011712,W!==null?j=Ts(W,j):(j=Fa(j,o,a,null),j.flags|=2),j.return=s,n.return=s,n.sibling=j,s.child=n,Gl(null,n),n=s.child,j=t.child.memoizedState,j===null?j=fc(a):(o=j.cachePool,o!==null?(z=ut._currentValue,o=o.parent!==z?{parent:z,pool:z}:o):o=bu(),j={baseLanes:j.baseLanes|a,cachePool:o}),n.memoizedState=j,n.childLanes=hc(t,p,a),s.memoizedState=xc,Gl(t.child,n)):(ha(s),a=t.child,t=a.sibling,a=Ts(a,{mode:"visible",children:n.children}),a.return=s,a.sibling=null,t!==null&&(p=s.deletions,p===null?(s.deletions=[t],s.flags|=16):p.push(t)),s.child=a,s.memoizedState=null,a)}function pc(t,s){return s=hi({mode:"visible",children:s},t.mode),s.return=t,t.child=s}function hi(t,s){return t=Jt(22,t,null,s),t.lanes=0,t}function gc(t,s,a){return ln(s,t.child,null,a),t=pc(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function $0(t,s,a){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s),Do(t.return,s,a)}function bc(t,s,a,n,o,u){var p=t.memoizedState;p===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:o,treeForkCount:u}:(p.isBackwards=s,p.rendering=null,p.renderingStartTime=0,p.last=n,p.tail=a,p.tailMode=o,p.treeForkCount=u)}function D0(t,s,a){var n=s.pendingProps,o=n.revealOrder,u=n.tail;n=n.children;var p=rt.current,j=(p&2)!==0;if(j?(p=p&1|2,s.flags|=128):p&=1,he(rt,p),Et(t,s,n,a),n=Ie?Tl:0,!j&&t!==null&&(t.flags&128)!==0)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$0(t,a,s);else if(t.tag===19)$0(t,a,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(o){case"forwards":for(a=s.child,o=null;a!==null;)t=a.alternate,t!==null&&ai(t)===null&&(o=a),a=a.sibling;a=o,a===null?(o=s.child,s.child=null):(o=a.sibling,a.sibling=null),bc(s,!1,o,a,u,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,o=s.child,s.child=null;o!==null;){if(t=o.alternate,t!==null&&ai(t)===null){s.child=o;break}t=o.sibling,o.sibling=a,a=o,o=t}bc(s,!0,a,null,u,n);break;case"together":bc(s,!1,null,null,void 0,n);break;default:s.memoizedState=null}return s.child}function Rs(t,s,a){if(t!==null&&(s.dependencies=t.dependencies),ya|=s.lanes,(a&s.childLanes)===0)if(t!==null){if(Bn(t,s,a,!1),(a&s.childLanes)===0)return null}else return null;if(t!==null&&s.child!==t.child)throw Error(c(153));if(s.child!==null){for(t=s.child,a=Ts(t,t.pendingProps),s.child=a,a.return=s;t.sibling!==null;)t=t.sibling,a=a.sibling=Ts(t,t.pendingProps),a.return=s;a.sibling=null}return s.child}function yc(t,s){return(t.lanes&s)!==0?!0:(t=t.dependencies,!!(t!==null&&Pr(t)))}function dh(t,s,a){switch(s.tag){case 3:je(s,s.stateNode.containerInfo),ua(s,ut,t.memoizedState.cache),Wa();break;case 27:case 5:ye(s);break;case 4:je(s,s.stateNode.containerInfo);break;case 10:ua(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Vo(s),null;break;case 13:var n=s.memoizedState;if(n!==null)return n.dehydrated!==null?(ha(s),s.flags|=128,null):(a&s.child.childLanes)!==0?T0(t,s,a):(ha(s),t=Rs(t,s,a),t!==null?t.sibling:null);ha(s);break;case 19:var o=(t.flags&128)!==0;if(n=(a&s.childLanes)!==0,n||(Bn(t,s,a,!1),n=(a&s.childLanes)!==0),o){if(n)return D0(t,s,a);s.flags|=128}if(o=s.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),he(rt,rt.current),n)break;return null;case 22:return s.lanes=0,S0(t,s,a,s.pendingProps);case 24:ua(s,ut,t.memoizedState.cache)}return Rs(t,s,a)}function _0(t,s,a){if(t!==null)if(t.memoizedProps!==s.pendingProps)xt=!0;else{if(!yc(t,a)&&(s.flags&128)===0)return xt=!1,dh(t,s,a);xt=(t.flags&131072)!==0}else xt=!1,Ie&&(s.flags&1048576)!==0&&uu(s,Tl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var n=s.pendingProps;if(t=an(s.elementType),s.type=t,typeof t=="function")So(t)?(n=on(t,n),s.tag=1,s=M0(null,s,t,n,a)):(s.tag=0,s=mc(null,s,t,n,a));else{if(t!=null){var o=t.$$typeof;if(o===J){s.tag=11,s=j0(null,s,t,n,a);break e}else if(o===G){s.tag=14,s=N0(null,s,t,n,a);break e}}throw s=Y(t)||t,Error(c(306,s,""))}}return s;case 0:return mc(t,s,s.type,s.pendingProps,a);case 1:return n=s.type,o=on(n,s.pendingProps),M0(t,s,n,o,a);case 3:e:{if(je(s,s.stateNode.containerInfo),t===null)throw Error(c(387));n=s.pendingProps;var u=s.memoizedState;o=u.element,Ho(t,s),Bl(s,n,null,a);var p=s.memoizedState;if(n=p.cache,ua(s,ut,n),n!==u.cache&&_o(s,[ut],a,!0),Ll(),n=p.element,u.isDehydrated)if(u={element:n,isDehydrated:!1,cache:p.cache},s.updateQueue.baseState=u,s.memoizedState=u,s.flags&256){s=A0(t,s,n,a);break e}else if(n!==o){o=ss(Error(c(424)),s),$l(o),s=A0(t,s,n,a);break e}else{switch(t=s.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(We=is(t.firstChild),kt=s,Ie=!0,ca=null,ls=!0,a=Su(s,null,n,a),s.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Wa(),n===o){s=Rs(t,s,a);break e}Et(t,s,n,a)}s=s.child}return s;case 26:return fi(t,s),t===null?(a=Vm(s.type,null,s.pendingProps,null))?s.memoizedState=a:Ie||(a=s.type,t=s.pendingProps,n=$i(pe.current).createElement(a),n[ot]=s,n[St]=t,Mt(n,a,t),lt(n),s.stateNode=n):s.memoizedState=Vm(s.type,t.memoizedProps,s.pendingProps,t.memoizedState),null;case 27:return ye(s),t===null&&Ie&&(n=s.stateNode=Im(s.type,s.pendingProps,pe.current),kt=s,ls=!0,o=We,Sa(s.type)?(Fc=o,We=is(n.firstChild)):We=o),Et(t,s,s.pendingProps.children,a),fi(t,s),t===null&&(s.flags|=4194304),s.child;case 5:return t===null&&Ie&&((o=n=We)&&(n=Uh(n,s.type,s.pendingProps,ls),n!==null?(s.stateNode=n,kt=s,We=is(n.firstChild),ls=!1,o=!0):o=!1),o||da(s)),ye(s),o=s.type,u=s.pendingProps,p=t!==null?t.memoizedProps:null,n=u.children,Jc(o,u)?n=null:p!==null&&Jc(o,p)&&(s.flags|=32),s.memoizedState!==null&&(o=Qo(t,s,th,null,null,a),nr._currentValue=o),fi(t,s),Et(t,s,n,a),s.child;case 6:return t===null&&Ie&&((t=a=We)&&(a=Ih(a,s.pendingProps,ls),a!==null?(s.stateNode=a,kt=s,We=null,t=!0):t=!1),t||da(s)),null;case 13:return T0(t,s,a);case 4:return je(s,s.stateNode.containerInfo),n=s.pendingProps,t===null?s.child=ln(s,null,n,a):Et(t,s,n,a),s.child;case 11:return j0(t,s,s.type,s.pendingProps,a);case 7:return Et(t,s,s.pendingProps,a),s.child;case 8:return Et(t,s,s.pendingProps.children,a),s.child;case 12:return Et(t,s,s.pendingProps.children,a),s.child;case 10:return n=s.pendingProps,ua(s,s.type,n.value),Et(t,s,n.children,a),s.child;case 9:return o=s.type._context,n=s.pendingProps.children,tn(s),o=Ct(o),n=n(o),s.flags|=1,Et(t,s,n,a),s.child;case 14:return N0(t,s,s.type,s.pendingProps,a);case 15:return w0(t,s,s.type,s.pendingProps,a);case 19:return D0(t,s,a);case 31:return ch(t,s,a);case 22:return S0(t,s,a,s.pendingProps);case 24:return tn(s),n=Ct(ut),t===null?(o=Ro(),o===null&&(o=Ze,u=Oo(),o.pooledCache=u,u.refCount++,u!==null&&(o.pooledCacheLanes|=a),o=u),s.memoizedState={parent:n,cache:o},Bo(s),ua(s,ut,o)):((t.lanes&a)!==0&&(Ho(t,s),Bl(s,null,null,a),Ll()),o=t.memoizedState,u=s.memoizedState,o.parent!==n?(o={parent:n,cache:n},s.memoizedState=o,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=o),ua(s,ut,n)):(n=u.cache,ua(s,ut,n),n!==o.cache&&_o(s,[ut],a,!0))),Et(t,s,s.pendingProps.children,a),s.child;case 29:throw s.pendingProps}throw Error(c(156,s.tag))}function Ls(t){t.flags|=4}function vc(t,s,a,n,o){if((s=(t.mode&32)!==0)&&(s=!1),s){if(t.flags|=16777216,(o&335544128)===o)if(t.stateNode.complete)t.flags|=8192;else if(rm())t.flags|=8192;else throw nn=Wr,Lo}else t.flags&=-16777217}function O0(t,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Pm(s))if(rm())t.flags|=8192;else throw nn=Wr,Lo}function pi(t,s){s!==null&&(t.flags|=4),t.flags&16384&&(s=t.tag!==22?wr():536870912,t.lanes|=s,Zn|=s)}function Vl(t,s){if(!Ie)switch(t.tailMode){case"hidden":s=t.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function et(t){var s=t.alternate!==null&&t.alternate.child===t.child,a=0,n=0;if(s)for(var o=t.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=a,s}function uh(t,s,a){var n=s.pendingProps;switch(Mo(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return et(s),null;case 1:return et(s),null;case 3:return a=s.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),s.memoizedState.cache!==n&&(s.flags|=2048),_s(ut),de(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(Ln(s)?Ls(s):t===null||t.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,To())),et(s),null;case 26:var o=s.type,u=s.memoizedState;return t===null?(Ls(s),u!==null?(et(s),O0(s,u)):(et(s),vc(s,o,null,n,a))):u?u!==t.memoizedState?(Ls(s),et(s),O0(s,u)):(et(s),s.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ls(s),et(s),vc(s,o,t,n,a)),null;case 27:if(ke(s),a=pe.current,o=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==n&&Ls(s);else{if(!n){if(s.stateNode===null)throw Error(c(166));return et(s),null}t=le.current,Ln(s)?xu(s):(t=Im(o,n,a),s.stateNode=t,Ls(s))}return et(s),null;case 5:if(ke(s),o=s.type,t!==null&&s.stateNode!=null)t.memoizedProps!==n&&Ls(s);else{if(!n){if(s.stateNode===null)throw Error(c(166));return et(s),null}if(u=le.current,Ln(s))xu(s);else{var p=$i(pe.current);switch(u){case 1:u=p.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:u=p.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":u=p.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":u=p.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":u=p.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof n.is=="string"?p.createElement("select",{is:n.is}):p.createElement("select"),n.multiple?u.multiple=!0:n.size&&(u.size=n.size);break;default:u=typeof n.is=="string"?p.createElement(o,{is:n.is}):p.createElement(o)}}u[ot]=s,u[St]=n;e:for(p=s.child;p!==null;){if(p.tag===5||p.tag===6)u.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===s)break e;for(;p.sibling===null;){if(p.return===null||p.return===s)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}s.stateNode=u;e:switch(Mt(u,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ls(s)}}return et(s),vc(s,s.type,t===null?null:t.memoizedProps,s.pendingProps,a),null;case 6:if(t&&s.stateNode!=null)t.memoizedProps!==n&&Ls(s);else{if(typeof n!="string"&&s.stateNode===null)throw Error(c(166));if(t=pe.current,Ln(s)){if(t=s.stateNode,a=s.memoizedProps,n=null,o=kt,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}t[ot]=s,t=!!(t.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||Tm(t.nodeValue,a)),t||da(s,!0)}else t=$i(t).createTextNode(n),t[ot]=s,s.stateNode=t}return et(s),null;case 31:if(a=s.memoizedState,t===null||t.memoizedState!==null){if(n=Ln(s),a!==null){if(t===null){if(!n)throw Error(c(318));if(t=s.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(c(557));t[ot]=s}else Wa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;et(s),t=!1}else a=To(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),t=!0;if(!t)return s.flags&256?(Pt(s),s):(Pt(s),null);if((s.flags&128)!==0)throw Error(c(558))}return et(s),null;case 13:if(n=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(o=Ln(s),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(c(318));if(o=s.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(c(317));o[ot]=s}else Wa(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;et(s),o=!1}else o=To(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),o=!0;if(!o)return s.flags&256?(Pt(s),s):(Pt(s),null)}return Pt(s),(s.flags&128)!==0?(s.lanes=a,s):(a=n!==null,t=t!==null&&t.memoizedState!==null,a&&(n=s.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==o&&(n.flags|=2048)),a!==t&&a&&(s.child.flags|=8192),pi(s,s.updateQueue),et(s),null);case 4:return de(),t===null&&qc(s.stateNode.containerInfo),et(s),null;case 10:return _s(s.type),et(s),null;case 19:if(se(rt),n=s.memoizedState,n===null)return et(s),null;if(o=(s.flags&128)!==0,u=n.rendering,u===null)if(o)Vl(n,!1);else{if(nt!==0||t!==null&&(t.flags&128)!==0)for(t=s.child;t!==null;){if(u=ai(t),u!==null){for(s.flags|=128,Vl(n,!1),t=u.updateQueue,s.updateQueue=t,pi(s,t),s.subtreeFlags=0,t=a,a=s.child;a!==null;)ou(a,t),a=a.sibling;return he(rt,rt.current&1|2),Ie&&$s(s,n.treeForkCount),s.child}t=t.sibling}n.tail!==null&&Nt()>ji&&(s.flags|=128,o=!0,Vl(n,!1),s.lanes=4194304)}else{if(!o)if(t=ai(u),t!==null){if(s.flags|=128,o=!0,t=t.updateQueue,s.updateQueue=t,pi(s,t),Vl(n,!0),n.tail===null&&n.tailMode==="hidden"&&!u.alternate&&!Ie)return et(s),null}else 2*Nt()-n.renderingStartTime>ji&&a!==536870912&&(s.flags|=128,o=!0,Vl(n,!1),s.lanes=4194304);n.isBackwards?(u.sibling=s.child,s.child=u):(t=n.last,t!==null?t.sibling=u:s.child=u,n.last=u)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Nt(),t.sibling=null,a=rt.current,he(rt,o?a&1|2:a&1),Ie&&$s(s,n.treeForkCount),t):(et(s),null);case 22:case 23:return Pt(s),Go(),n=s.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(s.flags|=8192):n&&(s.flags|=8192),n?(a&536870912)!==0&&(s.flags&128)===0&&(et(s),s.subtreeFlags&6&&(s.flags|=8192)):et(s),a=s.updateQueue,a!==null&&pi(s,a.retryQueue),a=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==a&&(s.flags|=2048),t!==null&&se(sn),null;case 24:return a=null,t!==null&&(a=t.memoizedState.cache),s.memoizedState.cache!==a&&(s.flags|=2048),_s(ut),et(s),null;case 25:return null;case 30:return null}throw Error(c(156,s.tag))}function mh(t,s){switch(Mo(s),s.tag){case 1:return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return _s(ut),de(),t=s.flags,(t&65536)!==0&&(t&128)===0?(s.flags=t&-65537|128,s):null;case 26:case 27:case 5:return ke(s),null;case 31:if(s.memoizedState!==null){if(Pt(s),s.alternate===null)throw Error(c(340));Wa()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 13:if(Pt(s),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(c(340));Wa()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return se(rt),null;case 4:return de(),null;case 10:return _s(s.type),null;case 22:case 23:return Pt(s),Go(),t!==null&&se(sn),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 24:return _s(ut),null;case 25:return null;default:return null}}function z0(t,s){switch(Mo(s),s.tag){case 3:_s(ut),de();break;case 26:case 27:case 5:ke(s);break;case 4:de();break;case 31:s.memoizedState!==null&&Pt(s);break;case 13:Pt(s);break;case 19:se(rt);break;case 10:_s(s.type);break;case 22:case 23:Pt(s),Go(),t!==null&&se(sn);break;case 24:_s(ut)}}function Yl(t,s){try{var a=s.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var o=n.next;a=o;do{if((a.tag&t)===t){n=void 0;var u=a.create,p=a.inst;n=u(),p.destroy=n}a=a.next}while(a!==o)}}catch(j){Qe(s,s.return,j)}}function ga(t,s,a){try{var n=s.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var u=o.next;n=u;do{if((n.tag&t)===t){var p=n.inst,j=p.destroy;if(j!==void 0){p.destroy=void 0,o=s;var z=a,W=j;try{W()}catch(ie){Qe(o,z,ie)}}}n=n.next}while(n!==u)}}catch(ie){Qe(s,s.return,ie)}}function R0(t){var s=t.updateQueue;if(s!==null){var a=t.stateNode;try{Cu(s,a)}catch(n){Qe(t,t.return,n)}}}function L0(t,s,a){a.props=on(t.type,t.memoizedProps),a.state=t.memoizedState;try{a.componentWillUnmount()}catch(n){Qe(t,s,n)}}function Ql(t,s){try{var a=t.ref;if(a!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof a=="function"?t.refCleanup=a(n):a.current=n}}catch(o){Qe(t,s,o)}}function Ss(t,s){var a=t.ref,n=t.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(o){Qe(t,s,o)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(o){Qe(t,s,o)}else a.current=null}function B0(t){var s=t.type,a=t.memoizedProps,n=t.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(o){Qe(t,t.return,o)}}function jc(t,s,a){try{var n=t.stateNode;Oh(n,t.type,a,s),n[St]=s}catch(o){Qe(t,t.return,o)}}function H0(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Sa(t.type)||t.tag===4}function Nc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||H0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Sa(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wc(t,s,a){var n=t.tag;if(n===5||n===6)t=t.stateNode,s?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(t,s):(s=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,s.appendChild(t),a=a._reactRootContainer,a!=null||s.onclick!==null||(s.onclick=xs));else if(n!==4&&(n===27&&Sa(t.type)&&(a=t.stateNode,s=null),t=t.child,t!==null))for(wc(t,s,a),t=t.sibling;t!==null;)wc(t,s,a),t=t.sibling}function gi(t,s,a){var n=t.tag;if(n===5||n===6)t=t.stateNode,s?a.insertBefore(t,s):a.appendChild(t);else if(n!==4&&(n===27&&Sa(t.type)&&(a=t.stateNode),t=t.child,t!==null))for(gi(t,s,a),t=t.sibling;t!==null;)gi(t,s,a),t=t.sibling}function U0(t){var s=t.stateNode,a=t.memoizedProps;try{for(var n=t.type,o=s.attributes;o.length;)s.removeAttributeNode(o[0]);Mt(s,n,a),s[ot]=t,s[St]=a}catch(u){Qe(t,t.return,u)}}var Bs=!1,ft=!1,Sc=!1,I0=typeof WeakSet=="function"?WeakSet:Set,vt=null;function xh(t,s){if(t=t.containerInfo,Yc=Bi,t=Wd(t),go(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var o=n.anchorOffset,u=n.focusNode;n=n.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var p=0,j=-1,z=-1,W=0,ie=0,me=t,ee=null;t:for(;;){for(var te;me!==a||o!==0&&me.nodeType!==3||(j=p+o),me!==u||n!==0&&me.nodeType!==3||(z=p+n),me.nodeType===3&&(p+=me.nodeValue.length),(te=me.firstChild)!==null;)ee=me,me=te;for(;;){if(me===t)break t;if(ee===a&&++W===o&&(j=p),ee===u&&++ie===n&&(z=p),(te=me.nextSibling)!==null)break;me=ee,ee=me.parentNode}me=te}a=j===-1||z===-1?null:{start:j,end:z}}else a=null}a=a||{start:0,end:0}}else a=null;for(Qc={focusedElem:t,selectionRange:a},Bi=!1,vt=s;vt!==null;)if(s=vt,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,vt=t;else for(;vt!==null;){switch(s=vt,u=s.alternate,t=s.flags,s.tag){case 0:if((t&4)!==0&&(t=s.updateQueue,t=t!==null?t.events:null,t!==null))for(a=0;a<t.length;a++)o=t[a],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&u!==null){t=void 0,a=s,o=u.memoizedProps,u=u.memoizedState,n=a.stateNode;try{var we=on(a.type,o);t=n.getSnapshotBeforeUpdate(we,u),n.__reactInternalSnapshotBeforeUpdate=t}catch(Ee){Qe(a,a.return,Ee)}}break;case 3:if((t&1024)!==0){if(t=s.stateNode.containerInfo,a=t.nodeType,a===9)Pc(t);else if(a===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Pc(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(c(163))}if(t=s.sibling,t!==null){t.return=s.return,vt=t;break}vt=s.return}}function q0(t,s,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:Us(t,a),n&4&&Yl(5,a);break;case 1:if(Us(t,a),n&4)if(t=a.stateNode,s===null)try{t.componentDidMount()}catch(p){Qe(a,a.return,p)}else{var o=on(a.type,s.memoizedProps);s=s.memoizedState;try{t.componentDidUpdate(o,s,t.__reactInternalSnapshotBeforeUpdate)}catch(p){Qe(a,a.return,p)}}n&64&&R0(a),n&512&&Ql(a,a.return);break;case 3:if(Us(t,a),n&64&&(t=a.updateQueue,t!==null)){if(s=null,a.child!==null)switch(a.child.tag){case 27:case 5:s=a.child.stateNode;break;case 1:s=a.child.stateNode}try{Cu(t,s)}catch(p){Qe(a,a.return,p)}}break;case 27:s===null&&n&4&&U0(a);case 26:case 5:Us(t,a),s===null&&n&4&&B0(a),n&512&&Ql(a,a.return);break;case 12:Us(t,a);break;case 31:Us(t,a),n&4&&Y0(t,a);break;case 13:Us(t,a),n&4&&Q0(t,a),n&64&&(t=a.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(a=Nh.bind(null,a),qh(t,a))));break;case 22:if(n=a.memoizedState!==null||Bs,!n){s=s!==null&&s.memoizedState!==null||ft,o=Bs;var u=ft;Bs=n,(ft=s)&&!u?Is(t,a,(a.subtreeFlags&8772)!==0):Us(t,a),Bs=o,ft=u}break;case 30:break;default:Us(t,a)}}function G0(t){var s=t.alternate;s!==null&&(t.alternate=null,G0(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&pl(s)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var tt=null,Bt=!1;function Hs(t,s,a){for(a=a.child;a!==null;)V0(t,s,a),a=a.sibling}function V0(t,s,a){if(Tt&&typeof Tt.onCommitFiberUnmount=="function")try{Tt.onCommitFiberUnmount(Xs,a)}catch{}switch(a.tag){case 26:ft||Ss(a,s),Hs(t,s,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:ft||Ss(a,s);var n=tt,o=Bt;Sa(a.type)&&(tt=a.stateNode,Bt=!1),Hs(t,s,a),tr(a.stateNode),tt=n,Bt=o;break;case 5:ft||Ss(a,s);case 6:if(n=tt,o=Bt,tt=null,Hs(t,s,a),tt=n,Bt=o,tt!==null)if(Bt)try{(tt.nodeType===9?tt.body:tt.nodeName==="HTML"?tt.ownerDocument.body:tt).removeChild(a.stateNode)}catch(u){Qe(a,s,u)}else try{tt.removeChild(a.stateNode)}catch(u){Qe(a,s,u)}break;case 18:tt!==null&&(Bt?(t=tt,Rm(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,a.stateNode),nl(t)):Rm(tt,a.stateNode));break;case 4:n=tt,o=Bt,tt=a.stateNode.containerInfo,Bt=!0,Hs(t,s,a),tt=n,Bt=o;break;case 0:case 11:case 14:case 15:ga(2,a,s),ft||ga(4,a,s),Hs(t,s,a);break;case 1:ft||(Ss(a,s),n=a.stateNode,typeof n.componentWillUnmount=="function"&&L0(a,s,n)),Hs(t,s,a);break;case 21:Hs(t,s,a);break;case 22:ft=(n=ft)||a.memoizedState!==null,Hs(t,s,a),ft=n;break;default:Hs(t,s,a)}}function Y0(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{nl(t)}catch(a){Qe(s,s.return,a)}}}function Q0(t,s){if(s.memoizedState===null&&(t=s.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{nl(t)}catch(a){Qe(s,s.return,a)}}function fh(t){switch(t.tag){case 31:case 13:case 19:var s=t.stateNode;return s===null&&(s=t.stateNode=new I0),s;case 22:return t=t.stateNode,s=t._retryCache,s===null&&(s=t._retryCache=new I0),s;default:throw Error(c(435,t.tag))}}function bi(t,s){var a=fh(t);s.forEach(function(n){if(!a.has(n)){a.add(n);var o=wh.bind(null,t,n);n.then(o,o)}})}function Ht(t,s){var a=s.deletions;if(a!==null)for(var n=0;n<a.length;n++){var o=a[n],u=t,p=s,j=p;e:for(;j!==null;){switch(j.tag){case 27:if(Sa(j.type)){tt=j.stateNode,Bt=!1;break e}break;case 5:tt=j.stateNode,Bt=!1;break e;case 3:case 4:tt=j.stateNode.containerInfo,Bt=!0;break e}j=j.return}if(tt===null)throw Error(c(160));V0(u,p,o),tt=null,Bt=!1,u=o.alternate,u!==null&&(u.return=null),o.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)J0(s,t),s=s.sibling}var gs=null;function J0(t,s){var a=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Ht(s,t),Ut(t),n&4&&(ga(3,t,t.return),Yl(3,t),ga(5,t,t.return));break;case 1:Ht(s,t),Ut(t),n&512&&(ft||a===null||Ss(a,a.return)),n&64&&Bs&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(a=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var o=gs;if(Ht(s,t),Ut(t),n&512&&(ft||a===null||Ss(a,a.return)),n&4){var u=a!==null?a.memoizedState:null;if(n=t.memoizedState,a===null)if(n===null)if(t.stateNode===null){e:{n=t.type,a=t.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":u=o.getElementsByTagName("title")[0],(!u||u[Ks]||u[ot]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=o.createElement(n),o.head.insertBefore(u,o.querySelector("head > title"))),Mt(u,n,a),u[ot]=t,lt(u),n=u;break e;case"link":var p=Jm("link","href",o).get(n+(a.href||""));if(p){for(var j=0;j<p.length;j++)if(u=p[j],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){p.splice(j,1);break t}}u=o.createElement(n),Mt(u,n,a),o.head.appendChild(u);break;case"meta":if(p=Jm("meta","content",o).get(n+(a.content||""))){for(j=0;j<p.length;j++)if(u=p[j],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){p.splice(j,1);break t}}u=o.createElement(n),Mt(u,n,a),o.head.appendChild(u);break;default:throw Error(c(468,n))}u[ot]=t,lt(u),n=u}t.stateNode=n}else Xm(o,t.type,t.stateNode);else t.stateNode=Qm(o,n,t.memoizedProps);else u!==n?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,n===null?Xm(o,t.type,t.stateNode):Qm(o,n,t.memoizedProps)):n===null&&t.stateNode!==null&&jc(t,t.memoizedProps,a.memoizedProps)}break;case 27:Ht(s,t),Ut(t),n&512&&(ft||a===null||Ss(a,a.return)),a!==null&&n&4&&jc(t,t.memoizedProps,a.memoizedProps);break;case 5:if(Ht(s,t),Ut(t),n&512&&(ft||a===null||Ss(a,a.return)),t.flags&32){o=t.stateNode;try{aa(o,"")}catch(we){Qe(t,t.return,we)}}n&4&&t.stateNode!=null&&(o=t.memoizedProps,jc(t,o,a!==null?a.memoizedProps:o)),n&1024&&(Sc=!0);break;case 6:if(Ht(s,t),Ut(t),n&4){if(t.stateNode===null)throw Error(c(162));n=t.memoizedProps,a=t.stateNode;try{a.nodeValue=n}catch(we){Qe(t,t.return,we)}}break;case 3:if(Oi=null,o=gs,gs=Di(s.containerInfo),Ht(s,t),gs=o,Ut(t),n&4&&a!==null&&a.memoizedState.isDehydrated)try{nl(s.containerInfo)}catch(we){Qe(t,t.return,we)}Sc&&(Sc=!1,X0(t));break;case 4:n=gs,gs=Di(t.stateNode.containerInfo),Ht(s,t),Ut(t),gs=n;break;case 12:Ht(s,t),Ut(t);break;case 31:Ht(s,t),Ut(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,bi(t,n)));break;case 13:Ht(s,t),Ut(t),t.child.flags&8192&&t.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(vi=Nt()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,bi(t,n)));break;case 22:o=t.memoizedState!==null;var z=a!==null&&a.memoizedState!==null,W=Bs,ie=ft;if(Bs=W||o,ft=ie||z,Ht(s,t),ft=ie,Bs=W,Ut(t),n&8192)e:for(s=t.stateNode,s._visibility=o?s._visibility&-2:s._visibility|1,o&&(a===null||z||Bs||ft||cn(t)),a=null,s=t;;){if(s.tag===5||s.tag===26){if(a===null){z=a=s;try{if(u=z.stateNode,o)p=u.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none";else{j=z.stateNode;var me=z.memoizedProps.style,ee=me!=null&&me.hasOwnProperty("display")?me.display:null;j.style.display=ee==null||typeof ee=="boolean"?"":(""+ee).trim()}}catch(we){Qe(z,z.return,we)}}}else if(s.tag===6){if(a===null){z=s;try{z.stateNode.nodeValue=o?"":z.memoizedProps}catch(we){Qe(z,z.return,we)}}}else if(s.tag===18){if(a===null){z=s;try{var te=z.stateNode;o?Lm(te,!0):Lm(z.stateNode,!1)}catch(we){Qe(z,z.return,we)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===t)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;s.sibling===null;){if(s.return===null||s.return===t)break e;a===s&&(a=null),s=s.return}a===s&&(a=null),s.sibling.return=s.return,s=s.sibling}n&4&&(n=t.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,bi(t,a))));break;case 19:Ht(s,t),Ut(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,bi(t,n)));break;case 30:break;case 21:break;default:Ht(s,t),Ut(t)}}function Ut(t){var s=t.flags;if(s&2){try{for(var a,n=t.return;n!==null;){if(H0(n)){a=n;break}n=n.return}if(a==null)throw Error(c(160));switch(a.tag){case 27:var o=a.stateNode,u=Nc(t);gi(t,u,o);break;case 5:var p=a.stateNode;a.flags&32&&(aa(p,""),a.flags&=-33);var j=Nc(t);gi(t,j,p);break;case 3:case 4:var z=a.stateNode.containerInfo,W=Nc(t);wc(t,W,z);break;default:throw Error(c(161))}}catch(ie){Qe(t,t.return,ie)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function X0(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var s=t;X0(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),t=t.sibling}}function Us(t,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)q0(t,s.alternate,s),s=s.sibling}function cn(t){for(t=t.child;t!==null;){var s=t;switch(s.tag){case 0:case 11:case 14:case 15:ga(4,s,s.return),cn(s);break;case 1:Ss(s,s.return);var a=s.stateNode;typeof a.componentWillUnmount=="function"&&L0(s,s.return,a),cn(s);break;case 27:tr(s.stateNode);case 26:case 5:Ss(s,s.return),cn(s);break;case 22:s.memoizedState===null&&cn(s);break;case 30:cn(s);break;default:cn(s)}t=t.sibling}}function Is(t,s,a){for(a=a&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var n=s.alternate,o=t,u=s,p=u.flags;switch(u.tag){case 0:case 11:case 15:Is(o,u,a),Yl(4,u);break;case 1:if(Is(o,u,a),n=u,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(W){Qe(n,n.return,W)}if(n=u,o=n.updateQueue,o!==null){var j=n.stateNode;try{var z=o.shared.hiddenCallbacks;if(z!==null)for(o.shared.hiddenCallbacks=null,o=0;o<z.length;o++)ku(z[o],j)}catch(W){Qe(n,n.return,W)}}a&&p&64&&R0(u),Ql(u,u.return);break;case 27:U0(u);case 26:case 5:Is(o,u,a),a&&n===null&&p&4&&B0(u),Ql(u,u.return);break;case 12:Is(o,u,a);break;case 31:Is(o,u,a),a&&p&4&&Y0(o,u);break;case 13:Is(o,u,a),a&&p&4&&Q0(o,u);break;case 22:u.memoizedState===null&&Is(o,u,a),Ql(u,u.return);break;case 30:break;default:Is(o,u,a)}s=s.sibling}}function kc(t,s){var a=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),t=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),t!==a&&(t!=null&&t.refCount++,a!=null&&Dl(a))}function Cc(t,s){t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Dl(t))}function bs(t,s,a,n){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)P0(t,s,a,n),s=s.sibling}function P0(t,s,a,n){var o=s.flags;switch(s.tag){case 0:case 11:case 15:bs(t,s,a,n),o&2048&&Yl(9,s);break;case 1:bs(t,s,a,n);break;case 3:bs(t,s,a,n),o&2048&&(t=null,s.alternate!==null&&(t=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==t&&(s.refCount++,t!=null&&Dl(t)));break;case 12:if(o&2048){bs(t,s,a,n),t=s.stateNode;try{var u=s.memoizedProps,p=u.id,j=u.onPostCommit;typeof j=="function"&&j(p,s.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(z){Qe(s,s.return,z)}}else bs(t,s,a,n);break;case 31:bs(t,s,a,n);break;case 13:bs(t,s,a,n);break;case 23:break;case 22:u=s.stateNode,p=s.alternate,s.memoizedState!==null?u._visibility&2?bs(t,s,a,n):Jl(t,s):u._visibility&2?bs(t,s,a,n):(u._visibility|=2,Jn(t,s,a,n,(s.subtreeFlags&10256)!==0||!1)),o&2048&&kc(p,s);break;case 24:bs(t,s,a,n),o&2048&&Cc(s.alternate,s);break;default:bs(t,s,a,n)}}function Jn(t,s,a,n,o){for(o=o&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var u=t,p=s,j=a,z=n,W=p.flags;switch(p.tag){case 0:case 11:case 15:Jn(u,p,j,z,o),Yl(8,p);break;case 23:break;case 22:var ie=p.stateNode;p.memoizedState!==null?ie._visibility&2?Jn(u,p,j,z,o):Jl(u,p):(ie._visibility|=2,Jn(u,p,j,z,o)),o&&W&2048&&kc(p.alternate,p);break;case 24:Jn(u,p,j,z,o),o&&W&2048&&Cc(p.alternate,p);break;default:Jn(u,p,j,z,o)}s=s.sibling}}function Jl(t,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var a=t,n=s,o=n.flags;switch(n.tag){case 22:Jl(a,n),o&2048&&kc(n.alternate,n);break;case 24:Jl(a,n),o&2048&&Cc(n.alternate,n);break;default:Jl(a,n)}s=s.sibling}}var Xl=8192;function Xn(t,s,a){if(t.subtreeFlags&Xl)for(t=t.child;t!==null;)Z0(t,s,a),t=t.sibling}function Z0(t,s,a){switch(t.tag){case 26:Xn(t,s,a),t.flags&Xl&&t.memoizedState!==null&&ep(a,gs,t.memoizedState,t.memoizedProps);break;case 5:Xn(t,s,a);break;case 3:case 4:var n=gs;gs=Di(t.stateNode.containerInfo),Xn(t,s,a),gs=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Xl,Xl=16777216,Xn(t,s,a),Xl=n):Xn(t,s,a));break;default:Xn(t,s,a)}}function K0(t){var s=t.alternate;if(s!==null&&(t=s.child,t!==null)){s.child=null;do s=t.sibling,t.sibling=null,t=s;while(t!==null)}}function Pl(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var a=0;a<s.length;a++){var n=s[a];vt=n,W0(n,t)}K0(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)F0(t),t=t.sibling}function F0(t){switch(t.tag){case 0:case 11:case 15:Pl(t),t.flags&2048&&ga(9,t,t.return);break;case 3:Pl(t);break;case 12:Pl(t);break;case 22:var s=t.stateNode;t.memoizedState!==null&&s._visibility&2&&(t.return===null||t.return.tag!==13)?(s._visibility&=-3,yi(t)):Pl(t);break;default:Pl(t)}}function yi(t){var s=t.deletions;if((t.flags&16)!==0){if(s!==null)for(var a=0;a<s.length;a++){var n=s[a];vt=n,W0(n,t)}K0(t)}for(t=t.child;t!==null;){switch(s=t,s.tag){case 0:case 11:case 15:ga(8,s,s.return),yi(s);break;case 22:a=s.stateNode,a._visibility&2&&(a._visibility&=-3,yi(s));break;default:yi(s)}t=t.sibling}}function W0(t,s){for(;vt!==null;){var a=vt;switch(a.tag){case 0:case 11:case 15:ga(8,a,s);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Dl(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,vt=n;else e:for(a=t;vt!==null;){n=vt;var o=n.sibling,u=n.return;if(G0(n),n===a){vt=null;break e}if(o!==null){o.return=u,vt=o;break e}vt=u}}}var hh={getCacheForType:function(t){var s=Ct(ut),a=s.data.get(t);return a===void 0&&(a=t(),s.data.set(t,a)),a},cacheSignal:function(){return Ct(ut).controller.signal}},ph=typeof WeakMap=="function"?WeakMap:Map,Ve=0,Ze=null,Re=null,Be=0,Ye=0,Zt=null,ba=!1,Pn=!1,Ec=!1,qs=0,nt=0,ya=0,dn=0,Mc=0,Kt=0,Zn=0,Zl=null,It=null,Ac=!1,vi=0,em=0,ji=1/0,Ni=null,va=null,bt=0,ja=null,Kn=null,Gs=0,Tc=0,$c=null,tm=null,Kl=0,Dc=null;function Ft(){return(Ve&2)!==0&&Be!==0?Be&-Be:L.T!==null?Bc():fl()}function sm(){if(Kt===0)if((Be&536870912)===0||Ie){var t=hn;hn<<=1,(hn&3932160)===0&&(hn=262144),Kt=t}else Kt=536870912;return t=Xt.current,t!==null&&(t.flags|=32),Kt}function qt(t,s,a){(t===Ze&&(Ye===2||Ye===9)||t.cancelPendingCommit!==null)&&(Fn(t,0),Na(t,Be,Kt,!1)),Ia(t,a),((Ve&2)===0||t!==Ze)&&(t===Ze&&((Ve&2)===0&&(dn|=a),nt===4&&Na(t,Be,Kt,!1)),ks(t))}function am(t,s,a){if((Ve&6)!==0)throw Error(c(327));var n=!a&&(s&127)===0&&(s&t.expiredLanes)===0||Ps(t,s),o=n?yh(t,s):Oc(t,s,!0),u=n;do{if(o===0){Pn&&!n&&Na(t,s,0,!1);break}else{if(a=t.current.alternate,u&&!gh(a)){o=Oc(t,s,!1),u=!1;continue}if(o===2){if(u=s,t.errorRecoveryDisabledLanes&u)var p=0;else p=t.pendingLanes&-536870913,p=p!==0?p:p&536870912?536870912:0;if(p!==0){s=p;e:{var j=t;o=Zl;var z=j.current.memoizedState.isDehydrated;if(z&&(Fn(j,p).flags|=256),p=Oc(j,p,!1),p!==2){if(Ec&&!z){j.errorRecoveryDisabledLanes|=u,dn|=u,o=4;break e}u=It,It=o,u!==null&&(It===null?It=u:It.push.apply(It,u))}o=p}if(u=!1,o!==2)continue}}if(o===1){Fn(t,0),Na(t,s,0,!0);break}e:{switch(n=t,u=o,u){case 0:case 1:throw Error(c(345));case 4:if((s&4194048)!==s)break;case 6:Na(n,s,Kt,!ba);break e;case 2:It=null;break;case 3:case 5:break;default:throw Error(c(329))}if((s&62914560)===s&&(o=vi+300-Nt(),10<o)){if(Na(n,s,Kt,!ba),Ua(n,0,!0)!==0)break e;Gs=s,n.timeoutHandle=Om(nm.bind(null,n,a,It,Ni,Ac,s,Kt,dn,Zn,ba,u,"Throttled",-0,0),o);break e}nm(n,a,It,Ni,Ac,s,Kt,dn,Zn,ba,u,null,-0,0)}}break}while(!0);ks(t)}function nm(t,s,a,n,o,u,p,j,z,W,ie,me,ee,te){if(t.timeoutHandle=-1,me=s.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:xs},Z0(s,u,me);var we=(u&62914560)===u?vi-Nt():(u&4194048)===u?em-Nt():0;if(we=tp(me,we),we!==null){Gs=u,t.cancelPendingCommit=we(mm.bind(null,t,s,u,a,n,o,p,j,z,ie,me,null,ee,te)),Na(t,u,p,!W);return}}mm(t,s,u,a,n,o,p,j,z)}function gh(t){for(var s=t;;){var a=s.tag;if((a===0||a===11||a===15)&&s.flags&16384&&(a=s.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var o=a[n],u=o.getSnapshot;o=o.value;try{if(!Qt(u(),o))return!1}catch{return!1}}if(a=s.child,s.subtreeFlags&16384&&a!==null)a.return=s,s=a;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Na(t,s,a,n){s&=~Mc,s&=~dn,t.suspendedLanes|=s,t.pingedLanes&=~s,n&&(t.warmLanes|=s),n=t.expirationTimes;for(var o=s;0<o;){var u=31-wt(o),p=1<<u;n[u]=-1,o&=~p}a!==0&&to(t,a,s)}function wi(){return(Ve&6)===0?(Fl(0),!1):!0}function _c(){if(Re!==null){if(Ye===0)var t=Re.return;else t=Re,Ds=en=null,Po(t),qn=null,Ol=0,t=Re;for(;t!==null;)z0(t.alternate,t),t=t.return;Re=null}}function Fn(t,s){var a=t.timeoutHandle;a!==-1&&(t.timeoutHandle=-1,Lh(a)),a=t.cancelPendingCommit,a!==null&&(t.cancelPendingCommit=null,a()),Gs=0,_c(),Ze=t,Re=a=Ts(t.current,null),Be=s,Ye=0,Zt=null,ba=!1,Pn=Ps(t,s),Ec=!1,Zn=Kt=Mc=dn=ya=nt=0,It=Zl=null,Ac=!1,(s&8)!==0&&(s|=s&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=s;0<n;){var o=31-wt(n),u=1<<o;s|=t[o],n&=~u}return qs=s,Vr(),a}function lm(t,s){$e=null,L.H=ql,s===In||s===Fr?(s=ju(),Ye=3):s===Lo?(s=ju(),Ye=4):Ye=s===uc?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Zt=s,Re===null&&(nt=1,mi(t,ss(s,t.current)))}function rm(){var t=Xt.current;return t===null?!0:(Be&4194048)===Be?rs===null:(Be&62914560)===Be||(Be&536870912)!==0?t===rs:!1}function im(){var t=L.H;return L.H=ql,t===null?ql:t}function om(){var t=L.A;return L.A=hh,t}function Si(){nt=4,ba||(Be&4194048)!==Be&&Xt.current!==null||(Pn=!0),(ya&134217727)===0&&(dn&134217727)===0||Ze===null||Na(Ze,Be,Kt,!1)}function Oc(t,s,a){var n=Ve;Ve|=2;var o=im(),u=om();(Ze!==t||Be!==s)&&(Ni=null,Fn(t,s)),s=!1;var p=nt;e:do try{if(Ye!==0&&Re!==null){var j=Re,z=Zt;switch(Ye){case 8:_c(),p=6;break e;case 3:case 2:case 9:case 6:Xt.current===null&&(s=!0);var W=Ye;if(Ye=0,Zt=null,Wn(t,j,z,W),a&&Pn){p=0;break e}break;default:W=Ye,Ye=0,Zt=null,Wn(t,j,z,W)}}bh(),p=nt;break}catch(ie){lm(t,ie)}while(!0);return s&&t.shellSuspendCounter++,Ds=en=null,Ve=n,L.H=o,L.A=u,Re===null&&(Ze=null,Be=0,Vr()),p}function bh(){for(;Re!==null;)cm(Re)}function yh(t,s){var a=Ve;Ve|=2;var n=im(),o=om();Ze!==t||Be!==s?(Ni=null,ji=Nt()+500,Fn(t,s)):Pn=Ps(t,s);e:do try{if(Ye!==0&&Re!==null){s=Re;var u=Zt;t:switch(Ye){case 1:Ye=0,Zt=null,Wn(t,s,u,1);break;case 2:case 9:if(yu(u)){Ye=0,Zt=null,dm(s);break}s=function(){Ye!==2&&Ye!==9||Ze!==t||(Ye=7),ks(t)},u.then(s,s);break e;case 3:Ye=7;break e;case 4:Ye=5;break e;case 7:yu(u)?(Ye=0,Zt=null,dm(s)):(Ye=0,Zt=null,Wn(t,s,u,7));break;case 5:var p=null;switch(Re.tag){case 26:p=Re.memoizedState;case 5:case 27:var j=Re;if(p?Pm(p):j.stateNode.complete){Ye=0,Zt=null;var z=j.sibling;if(z!==null)Re=z;else{var W=j.return;W!==null?(Re=W,ki(W)):Re=null}break t}}Ye=0,Zt=null,Wn(t,s,u,5);break;case 6:Ye=0,Zt=null,Wn(t,s,u,6);break;case 8:_c(),nt=6;break e;default:throw Error(c(462))}}vh();break}catch(ie){lm(t,ie)}while(!0);return Ds=en=null,L.H=n,L.A=o,Ve=a,Re!==null?0:(Ze=null,Be=0,Vr(),nt)}function vh(){for(;Re!==null&&!br();)cm(Re)}function cm(t){var s=_0(t.alternate,t,qs);t.memoizedProps=t.pendingProps,s===null?ki(t):Re=s}function dm(t){var s=t,a=s.alternate;switch(s.tag){case 15:case 0:s=E0(a,s,s.pendingProps,s.type,void 0,Be);break;case 11:s=E0(a,s,s.pendingProps,s.type.render,s.ref,Be);break;case 5:Po(s);default:z0(a,s),s=Re=ou(s,qs),s=_0(a,s,qs)}t.memoizedProps=t.pendingProps,s===null?ki(t):Re=s}function Wn(t,s,a,n){Ds=en=null,Po(s),qn=null,Ol=0;var o=s.return;try{if(oh(t,o,s,a,Be)){nt=1,mi(t,ss(a,t.current)),Re=null;return}}catch(u){if(o!==null)throw Re=o,u;nt=1,mi(t,ss(a,t.current)),Re=null;return}s.flags&32768?(Ie||n===1?t=!0:Pn||(Be&536870912)!==0?t=!1:(ba=t=!0,(n===2||n===9||n===3||n===6)&&(n=Xt.current,n!==null&&n.tag===13&&(n.flags|=16384))),um(s,t)):ki(s)}function ki(t){var s=t;do{if((s.flags&32768)!==0){um(s,ba);return}t=s.return;var a=uh(s.alternate,s,qs);if(a!==null){Re=a;return}if(s=s.sibling,s!==null){Re=s;return}Re=s=t}while(s!==null);nt===0&&(nt=5)}function um(t,s){do{var a=mh(t.alternate,t);if(a!==null){a.flags&=32767,Re=a;return}if(a=t.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!s&&(t=t.sibling,t!==null)){Re=t;return}Re=t=a}while(t!==null);nt=6,Re=null}function mm(t,s,a,n,o,u,p,j,z){t.cancelPendingCommit=null;do Ci();while(bt!==0);if((Ve&6)!==0)throw Error(c(327));if(s!==null){if(s===t.current)throw Error(c(177));if(u=s.lanes|s.childLanes,u|=No,Sr(t,a,u,p,j,z),t===Ze&&(Re=Ze=null,Be=0),Kn=s,ja=t,Gs=a,Tc=u,$c=o,tm=n,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Sh(cs,function(){return gm(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||n){n=L.T,L.T=null,o=I.p,I.p=2,p=Ve,Ve|=4;try{xh(t,s,a)}finally{Ve=p,I.p=o,L.T=n}}bt=1,xm(),fm(),hm()}}function xm(){if(bt===1){bt=0;var t=ja,s=Kn,a=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||a){a=L.T,L.T=null;var n=I.p;I.p=2;var o=Ve;Ve|=4;try{J0(s,t);var u=Qc,p=Wd(t.containerInfo),j=u.focusedElem,z=u.selectionRange;if(p!==j&&j&&j.ownerDocument&&Fd(j.ownerDocument.documentElement,j)){if(z!==null&&go(j)){var W=z.start,ie=z.end;if(ie===void 0&&(ie=W),"selectionStart"in j)j.selectionStart=W,j.selectionEnd=Math.min(ie,j.value.length);else{var me=j.ownerDocument||document,ee=me&&me.defaultView||window;if(ee.getSelection){var te=ee.getSelection(),we=j.textContent.length,Ee=Math.min(z.start,we),Pe=z.end===void 0?Ee:Math.min(z.end,we);!te.extend&&Ee>Pe&&(p=Pe,Pe=Ee,Ee=p);var P=Kd(j,Ee),q=Kd(j,Pe);if(P&&q&&(te.rangeCount!==1||te.anchorNode!==P.node||te.anchorOffset!==P.offset||te.focusNode!==q.node||te.focusOffset!==q.offset)){var F=me.createRange();F.setStart(P.node,P.offset),te.removeAllRanges(),Ee>Pe?(te.addRange(F),te.extend(q.node,q.offset)):(F.setEnd(q.node,q.offset),te.addRange(F))}}}}for(me=[],te=j;te=te.parentNode;)te.nodeType===1&&me.push({element:te,left:te.scrollLeft,top:te.scrollTop});for(typeof j.focus=="function"&&j.focus(),j=0;j<me.length;j++){var ce=me[j];ce.element.scrollLeft=ce.left,ce.element.scrollTop=ce.top}}Bi=!!Yc,Qc=Yc=null}finally{Ve=o,I.p=n,L.T=a}}t.current=s,bt=2}}function fm(){if(bt===2){bt=0;var t=ja,s=Kn,a=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||a){a=L.T,L.T=null;var n=I.p;I.p=2;var o=Ve;Ve|=4;try{q0(t,s.alternate,s)}finally{Ve=o,I.p=n,L.T=a}}bt=3}}function hm(){if(bt===4||bt===3){bt=0,Vt();var t=ja,s=Kn,a=Gs,n=tm;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?bt=5:(bt=0,Kn=ja=null,pm(t,t.pendingLanes));var o=t.pendingLanes;if(o===0&&(va=null),xl(a),s=s.stateNode,Tt&&typeof Tt.onCommitFiberRoot=="function")try{Tt.onCommitFiberRoot(Xs,s,void 0,(s.current.flags&128)===128)}catch{}if(n!==null){s=L.T,o=I.p,I.p=2,L.T=null;try{for(var u=t.onRecoverableError,p=0;p<n.length;p++){var j=n[p];u(j.value,{componentStack:j.stack})}}finally{L.T=s,I.p=o}}(Gs&3)!==0&&Ci(),ks(t),o=t.pendingLanes,(a&261930)!==0&&(o&42)!==0?t===Dc?Kl++:(Kl=0,Dc=t):Kl=0,Fl(0)}}function pm(t,s){(t.pooledCacheLanes&=s)===0&&(s=t.pooledCache,s!=null&&(t.pooledCache=null,Dl(s)))}function Ci(){return xm(),fm(),hm(),gm()}function gm(){if(bt!==5)return!1;var t=ja,s=Tc;Tc=0;var a=xl(Gs),n=L.T,o=I.p;try{I.p=32>a?32:a,L.T=null,a=$c,$c=null;var u=ja,p=Gs;if(bt=0,Kn=ja=null,Gs=0,(Ve&6)!==0)throw Error(c(331));var j=Ve;if(Ve|=4,F0(u.current),P0(u,u.current,p,a),Ve=j,Fl(0,!1),Tt&&typeof Tt.onPostCommitFiberRoot=="function")try{Tt.onPostCommitFiberRoot(Xs,u)}catch{}return!0}finally{I.p=o,L.T=n,pm(t,s)}}function bm(t,s,a){s=ss(a,s),s=dc(t.stateNode,s,2),t=fa(t,s,2),t!==null&&(Ia(t,2),ks(t))}function Qe(t,s,a){if(t.tag===3)bm(t,t,a);else for(;s!==null;){if(s.tag===3){bm(s,t,a);break}else if(s.tag===1){var n=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(va===null||!va.has(n))){t=ss(a,t),a=y0(2),n=fa(s,a,2),n!==null&&(v0(a,n,s,t),Ia(n,2),ks(n));break}}s=s.return}}function zc(t,s,a){var n=t.pingCache;if(n===null){n=t.pingCache=new ph;var o=new Set;n.set(s,o)}else o=n.get(s),o===void 0&&(o=new Set,n.set(s,o));o.has(a)||(Ec=!0,o.add(a),t=jh.bind(null,t,s,a),s.then(t,t))}function jh(t,s,a){var n=t.pingCache;n!==null&&n.delete(s),t.pingedLanes|=t.suspendedLanes&a,t.warmLanes&=~a,Ze===t&&(Be&a)===a&&(nt===4||nt===3&&(Be&62914560)===Be&&300>Nt()-vi?(Ve&2)===0&&Fn(t,0):Mc|=a,Zn===Be&&(Zn=0)),ks(t)}function ym(t,s){s===0&&(s=wr()),t=Ka(t,s),t!==null&&(Ia(t,s),ks(t))}function Nh(t){var s=t.memoizedState,a=0;s!==null&&(a=s.retryLane),ym(t,a)}function wh(t,s){var a=0;switch(t.tag){case 31:case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(a=o.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(c(314))}n!==null&&n.delete(s),ym(t,a)}function Sh(t,s){return fn(t,s)}var Ei=null,el=null,Rc=!1,Mi=!1,Lc=!1,wa=0;function ks(t){t!==el&&t.next===null&&(el===null?Ei=el=t:el=el.next=t),Mi=!0,Rc||(Rc=!0,Ch())}function Fl(t,s){if(!Lc&&Mi){Lc=!0;do for(var a=!1,n=Ei;n!==null;){if(t!==0){var o=n.pendingLanes;if(o===0)var u=0;else{var p=n.suspendedLanes,j=n.pingedLanes;u=(1<<31-wt(42|t)+1)-1,u&=o&~(p&~j),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,wm(n,u))}else u=Be,u=Ua(n,n===Ze?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(u&3)===0||Ps(n,u)||(a=!0,wm(n,u));n=n.next}while(a);Lc=!1}}function kh(){vm()}function vm(){Mi=Rc=!1;var t=0;wa!==0&&Rh()&&(t=wa);for(var s=Nt(),a=null,n=Ei;n!==null;){var o=n.next,u=jm(n,s);u===0?(n.next=null,a===null?Ei=o:a.next=o,o===null&&(el=a)):(a=n,(t!==0||(u&3)!==0)&&(Mi=!0)),n=o}bt!==0&&bt!==5||Fl(t),wa!==0&&(wa=0)}function jm(t,s){for(var a=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,u=t.pendingLanes&-62914561;0<u;){var p=31-wt(u),j=1<<p,z=o[p];z===-1?((j&a)===0||(j&n)!==0)&&(o[p]=gn(j,s)):z<=s&&(t.expiredLanes|=j),u&=~j}if(s=Ze,a=Be,a=Ua(t,t===s?a:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,a===0||t===s&&(Ye===2||Ye===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&Ba(n),t.callbackNode=null,t.callbackPriority=0;if((a&3)===0||Ps(t,a)){if(s=a&-a,s===t.callbackPriority)return s;switch(n!==null&&Ba(n),xl(a)){case 2:case 8:a=yr;break;case 32:a=cs;break;case 268435456:a=eo;break;default:a=cs}return n=Nm.bind(null,t),a=fn(a,n),t.callbackPriority=s,t.callbackNode=a,s}return n!==null&&n!==null&&Ba(n),t.callbackPriority=2,t.callbackNode=null,2}function Nm(t,s){if(bt!==0&&bt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var a=t.callbackNode;if(Ci()&&t.callbackNode!==a)return null;var n=Be;return n=Ua(t,t===Ze?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(am(t,n,s),jm(t,Nt()),t.callbackNode!=null&&t.callbackNode===a?Nm.bind(null,t):null)}function wm(t,s){if(Ci())return null;am(t,s,!0)}function Ch(){Bh(function(){(Ve&6)!==0?fn(Js,kh):vm()})}function Bc(){if(wa===0){var t=Hn;t===0&&(t=Ha,Ha<<=1,(Ha&261888)===0&&(Ha=256)),wa=t}return wa}function Sm(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:wn(""+t)}function km(t,s){var a=s.ownerDocument.createElement("input");return a.name=s.name,a.value=s.value,t.id&&a.setAttribute("form",t.id),s.parentNode.insertBefore(a,s),t=new FormData(t),a.parentNode.removeChild(a),t}function Eh(t,s,a,n,o){if(s==="submit"&&a&&a.stateNode===o){var u=Sm((o[St]||null).action),p=n.submitter;p&&(s=(s=p[St]||null)?Sm(s.formAction):p.getAttribute("formAction"),s!==null&&(u=s,p=null));var j=new Mn("action","action",null,n,o);t.push({event:j,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(wa!==0){var z=p?km(o,p):new FormData(o);nc(a,{pending:!0,data:z,method:o.method,action:u},null,z)}}else typeof u=="function"&&(j.preventDefault(),z=p?km(o,p):new FormData(o),nc(a,{pending:!0,data:z,method:o.method,action:u},u,z))},currentTarget:o}]})}}for(var Hc=0;Hc<jo.length;Hc++){var Uc=jo[Hc],Mh=Uc.toLowerCase(),Ah=Uc[0].toUpperCase()+Uc.slice(1);ps(Mh,"on"+Ah)}ps(su,"onAnimationEnd"),ps(au,"onAnimationIteration"),ps(nu,"onAnimationStart"),ps("dblclick","onDoubleClick"),ps("focusin","onFocus"),ps("focusout","onBlur"),ps(Yf,"onTransitionRun"),ps(Qf,"onTransitionStart"),ps(Jf,"onTransitionCancel"),ps(lu,"onTransitionEnd"),ta("onMouseEnter",["mouseout","mouseover"]),ta("onMouseLeave",["mouseout","mouseover"]),ta("onPointerEnter",["pointerout","pointerover"]),ta("onPointerLeave",["pointerout","pointerover"]),us("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),us("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),us("onBeforeInput",["compositionend","keypress","textInput","paste"]),us("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),us("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),us("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Th=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wl));function Cm(t,s){s=(s&4)!==0;for(var a=0;a<t.length;a++){var n=t[a],o=n.event;n=n.listeners;e:{var u=void 0;if(s)for(var p=n.length-1;0<=p;p--){var j=n[p],z=j.instance,W=j.currentTarget;if(j=j.listener,z!==u&&o.isPropagationStopped())break e;u=j,o.currentTarget=W;try{u(o)}catch(ie){Gr(ie)}o.currentTarget=null,u=z}else for(p=0;p<n.length;p++){if(j=n[p],z=j.instance,W=j.currentTarget,j=j.listener,z!==u&&o.isPropagationStopped())break e;u=j,o.currentTarget=W;try{u(o)}catch(ie){Gr(ie)}o.currentTarget=null,u=z}}}}function Le(t,s){var a=s[qa];a===void 0&&(a=s[qa]=new Set);var n=t+"__bubble";a.has(n)||(Em(s,t,2,!1),a.add(n))}function Ic(t,s,a){var n=0;s&&(n|=4),Em(a,t,n,s)}var Ai="_reactListening"+Math.random().toString(36).slice(2);function qc(t){if(!t[Ai]){t[Ai]=!0,Ga.forEach(function(a){a!=="selectionchange"&&(Th.has(a)||Ic(a,!1,t),Ic(a,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[Ai]||(s[Ai]=!0,Ic("selectionchange",!1,s))}}function Em(t,s,a,n){switch(sx(s)){case 2:var o=np;break;case 8:o=lp;break;default:o=ad}a=o.bind(null,s,a,t),o=void 0,!ct||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(s,a,{capture:!0,passive:o}):t.addEventListener(s,a,!0):o!==void 0?t.addEventListener(s,a,{passive:o}):t.addEventListener(s,a,!1)}function Gc(t,s,a,n,o){var u=n;if((s&1)===0&&(s&2)===0&&n!==null)e:for(;;){if(n===null)return;var p=n.tag;if(p===3||p===4){var j=n.stateNode.containerInfo;if(j===o)break;if(p===4)for(p=n.return;p!==null;){var z=p.tag;if((z===3||z===4)&&p.stateNode.containerInfo===o)return;p=p.return}for(;j!==null;){if(p=Es(j),p===null)return;if(z=p.tag,z===5||z===6||z===26||z===27){n=u=p;continue e}j=j.parentNode}}n=n.return}Lr(function(){var W=u,ie=vl(a),me=[];e:{var ee=ru.get(t);if(ee!==void 0){var te=Mn,we=t;switch(t){case"keypress":if(kn(a)===0)break e;case"keydown":case"keyup":te=wl;break;case"focusin":we="focus",te=ve;break;case"focusout":we="blur",te=ve;break;case"beforeblur":case"afterblur":te=ve;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=re;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=ue;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=Ir;break;case su:case au:case nu:te=ze;break;case lu:te=hs;break;case"scroll":case"scrollend":te=N;break;case"wheel":te=Tf;break;case"copy":case"cut":case"paste":te=gt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=Ur;break;case"toggle":case"beforetoggle":te=Df}var Ee=(s&4)!==0,Pe=!Ee&&(t==="scroll"||t==="scrollend"),P=Ee?ee!==null?ee+"Capture":null:ee;Ee=[];for(var q=W,F;q!==null;){var ce=q;if(F=ce.stateNode,ce=ce.tag,ce!==5&&ce!==26&&ce!==27||F===null||P===null||(ce=Qa(q,P),ce!=null&&Ee.push(er(q,ce,F))),Pe)break;q=q.return}0<Ee.length&&(ee=new te(ee,we,null,a,ie),me.push({event:ee,listeners:Ee}))}}if((s&7)===0){e:{if(ee=t==="mouseover"||t==="pointerover",te=t==="mouseout"||t==="pointerout",ee&&a!==yl&&(we=a.relatedTarget||a.fromElement)&&(Es(we)||we[Zs]))break e;if((te||ee)&&(ee=ie.window===ie?ie:(ee=ie.ownerDocument)?ee.defaultView||ee.parentWindow:window,te?(we=a.relatedTarget||a.toElement,te=W,we=we?Es(we):null,we!==null&&(Pe=m(we),Ee=we.tag,we!==Pe||Ee!==5&&Ee!==27&&Ee!==6)&&(we=null)):(te=null,we=W),te!==we)){if(Ee=re,ce="onMouseLeave",P="onMouseEnter",q="mouse",(t==="pointerout"||t==="pointerover")&&(Ee=Ur,ce="onPointerLeave",P="onPointerEnter",q="pointer"),Pe=te==null?ee:Ws(te),F=we==null?ee:Ws(we),ee=new Ee(ce,q+"leave",te,a,ie),ee.target=Pe,ee.relatedTarget=F,ce=null,Es(ie)===W&&(Ee=new Ee(P,q+"enter",we,a,ie),Ee.target=F,Ee.relatedTarget=Pe,ce=Ee),Pe=ce,te&&we)t:{for(Ee=$h,P=te,q=we,F=0,ce=P;ce;ce=Ee(ce))F++;ce=0;for(var Ce=q;Ce;Ce=Ee(Ce))ce++;for(;0<F-ce;)P=Ee(P),F--;for(;0<ce-F;)q=Ee(q),ce--;for(;F--;){if(P===q||q!==null&&P===q.alternate){Ee=P;break t}P=Ee(P),q=Ee(q)}Ee=null}else Ee=null;te!==null&&Mm(me,ee,te,Ee,!1),we!==null&&Pe!==null&&Mm(me,Pe,we,Ee,!0)}}e:{if(ee=W?Ws(W):window,te=ee.nodeName&&ee.nodeName.toLowerCase(),te==="select"||te==="input"&&ee.type==="file")var qe=Yd;else if(Gd(ee))if(Qd)qe=qf;else{qe=Uf;var Se=Hf}else te=ee.nodeName,!te||te.toLowerCase()!=="input"||ee.type!=="checkbox"&&ee.type!=="radio"?W&&bl(W.elementType)&&(qe=Yd):qe=If;if(qe&&(qe=qe(t,W))){Vd(me,qe,a,ie);break e}Se&&Se(t,ee,W),t==="focusout"&&W&&ee.type==="number"&&W.memoizedProps.value!=null&&Nn(ee,"number",ee.value)}switch(Se=W?Ws(W):window,t){case"focusin":(Gd(Se)||Se.contentEditable==="true")&&($n=Se,bo=W,Al=null);break;case"focusout":Al=bo=$n=null;break;case"mousedown":yo=!0;break;case"contextmenu":case"mouseup":case"dragend":yo=!1,eu(me,a,ie);break;case"selectionchange":if(Vf)break;case"keydown":case"keyup":eu(me,a,ie)}var _e;if(fo)e:{switch(t){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else Tn?Id(t,a)&&(He="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(He="onCompositionStart");He&&(Bd&&a.locale!=="ko"&&(Tn||He!=="onCompositionStart"?He==="onCompositionEnd"&&Tn&&(_e=Br()):(js=ie,Nl="value"in js?js.value:js.textContent,Tn=!0)),Se=Ti(W,He),0<Se.length&&(He=new yt(He,t,null,a,ie),me.push({event:He,listeners:Se}),_e?He.data=_e:(_e=qd(a),_e!==null&&(He.data=_e)))),(_e=Of?zf(t,a):Rf(t,a))&&(He=Ti(W,"onBeforeInput"),0<He.length&&(Se=new yt("onBeforeInput","beforeinput",null,a,ie),me.push({event:Se,listeners:He}),Se.data=_e)),Eh(me,t,W,a,ie)}Cm(me,s)})}function er(t,s,a){return{instance:t,listener:s,currentTarget:a}}function Ti(t,s){for(var a=s+"Capture",n=[];t!==null;){var o=t,u=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||u===null||(o=Qa(t,a),o!=null&&n.unshift(er(t,o,u)),o=Qa(t,s),o!=null&&n.push(er(t,o,u))),t.tag===3)return n;t=t.return}return[]}function $h(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Mm(t,s,a,n,o){for(var u=s._reactName,p=[];a!==null&&a!==n;){var j=a,z=j.alternate,W=j.stateNode;if(j=j.tag,z!==null&&z===n)break;j!==5&&j!==26&&j!==27||W===null||(z=W,o?(W=Qa(a,u),W!=null&&p.unshift(er(a,W,z))):o||(W=Qa(a,u),W!=null&&p.push(er(a,W,z)))),a=a.return}p.length!==0&&t.push({event:s,listeners:p})}var Dh=/\r\n?/g,_h=/\u0000|\uFFFD/g;function Am(t){return(typeof t=="string"?t:""+t).replace(Dh,`
`).replace(_h,"")}function Tm(t,s){return s=Am(s),Am(t)===s}function Xe(t,s,a,n,o,u){switch(a){case"children":typeof n=="string"?s==="body"||s==="textarea"&&n===""||aa(t,n):(typeof n=="number"||typeof n=="bigint")&&s!=="body"&&aa(t,""+n);break;case"className":vn(t,"class",n);break;case"tabIndex":vn(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":vn(t,a,n);break;case"style":zr(t,n,u);break;case"data":if(s!=="object"){vn(t,"data",n);break}case"src":case"href":if(n===""&&(s!=="a"||a!=="href")){t.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(a);break}n=wn(""+n),t.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(s!=="input"&&Xe(t,s,"name",o.name,o,null),Xe(t,s,"formEncType",o.formEncType,o,null),Xe(t,s,"formMethod",o.formMethod,o,null),Xe(t,s,"formTarget",o.formTarget,o,null)):(Xe(t,s,"encType",o.encType,o,null),Xe(t,s,"method",o.method,o,null),Xe(t,s,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(a);break}n=wn(""+n),t.setAttribute(a,n);break;case"onClick":n!=null&&(t.onclick=xs);break;case"onScroll":n!=null&&Le("scroll",t);break;case"onScrollEnd":n!=null&&Le("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(c(60));t.innerHTML=a}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}a=wn(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(a,""+n):t.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(a,""):t.removeAttribute(a);break;case"capture":case"download":n===!0?t.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(a,n):t.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(a,n):t.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(a):t.setAttribute(a,n);break;case"popover":Le("beforetoggle",t),Le("toggle",t),yn(t,"popover",n);break;case"xlinkActuate":ms(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ms(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ms(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ms(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ms(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ms(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ms(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ms(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ms(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":yn(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=uo.get(a)||a,yn(t,a,n))}}function Vc(t,s,a,n,o,u){switch(a){case"style":zr(t,n,u);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(c(60));t.innerHTML=a}}break;case"children":typeof n=="string"?aa(t,n):(typeof n=="number"||typeof n=="bigint")&&aa(t,""+n);break;case"onScroll":n!=null&&Le("scroll",t);break;case"onScrollEnd":n!=null&&Le("scrollend",t);break;case"onClick":n!=null&&(t.onclick=xs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ms.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(o=a.endsWith("Capture"),s=a.slice(2,o?a.length-7:void 0),u=t[St]||null,u=u!=null?u[a]:null,typeof u=="function"&&t.removeEventListener(s,u,o),typeof n=="function")){typeof u!="function"&&u!==null&&(a in t?t[a]=null:t.hasAttribute(a)&&t.removeAttribute(a)),t.addEventListener(s,n,o);break e}a in t?t[a]=n:n===!0?t.setAttribute(a,""):yn(t,a,n)}}}function Mt(t,s,a){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Le("error",t),Le("load",t);var n=!1,o=!1,u;for(u in a)if(a.hasOwnProperty(u)){var p=a[u];if(p!=null)switch(u){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,s));default:Xe(t,s,u,p,a,null)}}o&&Xe(t,s,"srcSet",a.srcSet,a,null),n&&Xe(t,s,"src",a.src,a,null);return;case"input":Le("invalid",t);var j=u=p=o=null,z=null,W=null;for(n in a)if(a.hasOwnProperty(n)){var ie=a[n];if(ie!=null)switch(n){case"name":o=ie;break;case"type":p=ie;break;case"checked":z=ie;break;case"defaultChecked":W=ie;break;case"value":u=ie;break;case"defaultValue":j=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(c(137,s));break;default:Xe(t,s,n,ie,a,null)}}Dr(t,u,j,z,W,p,o,!1);return;case"select":Le("invalid",t),n=p=u=null;for(o in a)if(a.hasOwnProperty(o)&&(j=a[o],j!=null))switch(o){case"value":u=j;break;case"defaultValue":p=j;break;case"multiple":n=j;default:Xe(t,s,o,j,a,null)}s=u,a=p,t.multiple=!!n,s!=null?sa(t,!!n,s,!1):a!=null&&sa(t,!!n,a,!0);return;case"textarea":Le("invalid",t),u=o=n=null;for(p in a)if(a.hasOwnProperty(p)&&(j=a[p],j!=null))switch(p){case"value":n=j;break;case"defaultValue":o=j;break;case"children":u=j;break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(c(91));break;default:Xe(t,s,p,j,a,null)}Ya(t,n,o,u);return;case"option":for(z in a)if(a.hasOwnProperty(z)&&(n=a[z],n!=null))switch(z){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Xe(t,s,z,n,a,null)}return;case"dialog":Le("beforetoggle",t),Le("toggle",t),Le("cancel",t),Le("close",t);break;case"iframe":case"object":Le("load",t);break;case"video":case"audio":for(n=0;n<Wl.length;n++)Le(Wl[n],t);break;case"image":Le("error",t),Le("load",t);break;case"details":Le("toggle",t);break;case"embed":case"source":case"link":Le("error",t),Le("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(W in a)if(a.hasOwnProperty(W)&&(n=a[W],n!=null))switch(W){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,s));default:Xe(t,s,W,n,a,null)}return;default:if(bl(s)){for(ie in a)a.hasOwnProperty(ie)&&(n=a[ie],n!==void 0&&Vc(t,s,ie,n,a,void 0));return}}for(j in a)a.hasOwnProperty(j)&&(n=a[j],n!=null&&Xe(t,s,j,n,a,null))}function Oh(t,s,a,n){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,u=null,p=null,j=null,z=null,W=null,ie=null;for(te in a){var me=a[te];if(a.hasOwnProperty(te)&&me!=null)switch(te){case"checked":break;case"value":break;case"defaultValue":z=me;default:n.hasOwnProperty(te)||Xe(t,s,te,null,n,me)}}for(var ee in n){var te=n[ee];if(me=a[ee],n.hasOwnProperty(ee)&&(te!=null||me!=null))switch(ee){case"type":u=te;break;case"name":o=te;break;case"checked":W=te;break;case"defaultChecked":ie=te;break;case"value":p=te;break;case"defaultValue":j=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(c(137,s));break;default:te!==me&&Xe(t,s,ee,te,n,me)}}gl(t,p,j,z,W,ie,u,o);return;case"select":te=p=j=ee=null;for(u in a)if(z=a[u],a.hasOwnProperty(u)&&z!=null)switch(u){case"value":break;case"multiple":te=z;default:n.hasOwnProperty(u)||Xe(t,s,u,null,n,z)}for(o in n)if(u=n[o],z=a[o],n.hasOwnProperty(o)&&(u!=null||z!=null))switch(o){case"value":ee=u;break;case"defaultValue":j=u;break;case"multiple":p=u;default:u!==z&&Xe(t,s,o,u,n,z)}s=j,a=p,n=te,ee!=null?sa(t,!!a,ee,!1):!!n!=!!a&&(s!=null?sa(t,!!a,s,!0):sa(t,!!a,a?[]:"",!1));return;case"textarea":te=ee=null;for(j in a)if(o=a[j],a.hasOwnProperty(j)&&o!=null&&!n.hasOwnProperty(j))switch(j){case"value":break;case"children":break;default:Xe(t,s,j,null,n,o)}for(p in n)if(o=n[p],u=a[p],n.hasOwnProperty(p)&&(o!=null||u!=null))switch(p){case"value":ee=o;break;case"defaultValue":te=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(c(91));break;default:o!==u&&Xe(t,s,p,o,n,u)}_r(t,ee,te);return;case"option":for(var we in a)if(ee=a[we],a.hasOwnProperty(we)&&ee!=null&&!n.hasOwnProperty(we))switch(we){case"selected":t.selected=!1;break;default:Xe(t,s,we,null,n,ee)}for(z in n)if(ee=n[z],te=a[z],n.hasOwnProperty(z)&&ee!==te&&(ee!=null||te!=null))switch(z){case"selected":t.selected=ee&&typeof ee!="function"&&typeof ee!="symbol";break;default:Xe(t,s,z,ee,n,te)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in a)ee=a[Ee],a.hasOwnProperty(Ee)&&ee!=null&&!n.hasOwnProperty(Ee)&&Xe(t,s,Ee,null,n,ee);for(W in n)if(ee=n[W],te=a[W],n.hasOwnProperty(W)&&ee!==te&&(ee!=null||te!=null))switch(W){case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(c(137,s));break;default:Xe(t,s,W,ee,n,te)}return;default:if(bl(s)){for(var Pe in a)ee=a[Pe],a.hasOwnProperty(Pe)&&ee!==void 0&&!n.hasOwnProperty(Pe)&&Vc(t,s,Pe,void 0,n,ee);for(ie in n)ee=n[ie],te=a[ie],!n.hasOwnProperty(ie)||ee===te||ee===void 0&&te===void 0||Vc(t,s,ie,ee,n,te);return}}for(var P in a)ee=a[P],a.hasOwnProperty(P)&&ee!=null&&!n.hasOwnProperty(P)&&Xe(t,s,P,null,n,ee);for(me in n)ee=n[me],te=a[me],!n.hasOwnProperty(me)||ee===te||ee==null&&te==null||Xe(t,s,me,ee,n,te)}function $m(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function zh(){if(typeof performance.getEntriesByType=="function"){for(var t=0,s=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var o=a[n],u=o.transferSize,p=o.initiatorType,j=o.duration;if(u&&j&&$m(p)){for(p=0,j=o.responseEnd,n+=1;n<a.length;n++){var z=a[n],W=z.startTime;if(W>j)break;var ie=z.transferSize,me=z.initiatorType;ie&&$m(me)&&(z=z.responseEnd,p+=ie*(z<j?1:(j-W)/(z-W)))}if(--n,s+=8*(u+p)/(o.duration/1e3),t++,10<t)break}}if(0<t)return s/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Yc=null,Qc=null;function $i(t){return t.nodeType===9?t:t.ownerDocument}function Dm(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _m(t,s){if(t===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&s==="foreignObject"?0:t}function Jc(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Xc=null;function Rh(){var t=window.event;return t&&t.type==="popstate"?t===Xc?!1:(Xc=t,!0):(Xc=null,!1)}var Om=typeof setTimeout=="function"?setTimeout:void 0,Lh=typeof clearTimeout=="function"?clearTimeout:void 0,zm=typeof Promise=="function"?Promise:void 0,Bh=typeof queueMicrotask=="function"?queueMicrotask:typeof zm<"u"?function(t){return zm.resolve(null).then(t).catch(Hh)}:Om;function Hh(t){setTimeout(function(){throw t})}function Sa(t){return t==="head"}function Rm(t,s){var a=s,n=0;do{var o=a.nextSibling;if(t.removeChild(a),o&&o.nodeType===8)if(a=o.data,a==="/$"||a==="/&"){if(n===0){t.removeChild(o),nl(s);return}n--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")n++;else if(a==="html")tr(t.ownerDocument.documentElement);else if(a==="head"){a=t.ownerDocument.head,tr(a);for(var u=a.firstChild;u;){var p=u.nextSibling,j=u.nodeName;u[Ks]||j==="SCRIPT"||j==="STYLE"||j==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=p}}else a==="body"&&tr(t.ownerDocument.body);a=o}while(a);nl(s)}function Lm(t,s){var a=t;t=0;do{var n=a.nextSibling;if(a.nodeType===1?s?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(s?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&n.nodeType===8)if(a=n.data,a==="/$"){if(t===0)break;t--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||t++;a=n}while(a)}function Pc(t){var s=t.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var a=s;switch(s=s.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Pc(a),pl(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}t.removeChild(a)}}function Uh(t,s,a,n){for(;t.nodeType===1;){var o=a;if(t.nodeName.toLowerCase()!==s.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Ks])switch(s){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(u=t.getAttribute("rel"),u==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(u!==o.rel||t.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||t.getAttribute("title")!==(o.title==null?null:o.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(u=t.getAttribute("src"),(u!==(o.src==null?null:o.src)||t.getAttribute("type")!==(o.type==null?null:o.type)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&u&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(s==="input"&&t.type==="hidden"){var u=o.name==null?null:""+o.name;if(o.type==="hidden"&&t.getAttribute("name")===u)return t}else return t;if(t=is(t.nextSibling),t===null)break}return null}function Ih(t,s,a){if(s==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=is(t.nextSibling),t===null))return null;return t}function Bm(t,s){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=is(t.nextSibling),t===null))return null;return t}function Zc(t){return t.data==="$?"||t.data==="$~"}function Kc(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function qh(t,s){var a=t.ownerDocument;if(t.data==="$~")t._reactRetry=s;else if(t.data!=="$?"||a.readyState!=="loading")s();else{var n=function(){s(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function is(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return t}var Fc=null;function Hm(t){t=t.nextSibling;for(var s=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"||a==="/&"){if(s===0)return is(t.nextSibling);s--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||s++}t=t.nextSibling}return null}function Um(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(s===0)return t;s--}else a!=="/$"&&a!=="/&"||s++}t=t.previousSibling}return null}function Im(t,s,a){switch(s=$i(a),t){case"html":if(t=s.documentElement,!t)throw Error(c(452));return t;case"head":if(t=s.head,!t)throw Error(c(453));return t;case"body":if(t=s.body,!t)throw Error(c(454));return t;default:throw Error(c(451))}}function tr(t){for(var s=t.attributes;s.length;)t.removeAttributeNode(s[0]);pl(t)}var os=new Map,qm=new Set;function Di(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Vs=I.d;I.d={f:Gh,r:Vh,D:Yh,C:Qh,L:Jh,m:Xh,X:Zh,S:Ph,M:Kh};function Gh(){var t=Vs.f(),s=wi();return t||s}function Vh(t){var s=Fs(t);s!==null&&s.tag===5&&s.type==="form"?l0(s):Vs.r(t)}var tl=typeof document>"u"?null:document;function Gm(t,s,a){var n=tl;if(n&&typeof s=="string"&&s){var o=Lt(s);o='link[rel="'+t+'"][href="'+o+'"]',typeof a=="string"&&(o+='[crossorigin="'+a+'"]'),qm.has(o)||(qm.add(o),t={rel:t,crossOrigin:a,href:s},n.querySelector(o)===null&&(s=n.createElement("link"),Mt(s,"link",t),lt(s),n.head.appendChild(s)))}}function Yh(t){Vs.D(t),Gm("dns-prefetch",t,null)}function Qh(t,s){Vs.C(t,s),Gm("preconnect",t,s)}function Jh(t,s,a){Vs.L(t,s,a);var n=tl;if(n&&t&&s){var o='link[rel="preload"][as="'+Lt(s)+'"]';s==="image"&&a&&a.imageSrcSet?(o+='[imagesrcset="'+Lt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(o+='[imagesizes="'+Lt(a.imageSizes)+'"]')):o+='[href="'+Lt(t)+'"]';var u=o;switch(s){case"style":u=sl(t);break;case"script":u=al(t)}os.has(u)||(t=y({rel:"preload",href:s==="image"&&a&&a.imageSrcSet?void 0:t,as:s},a),os.set(u,t),n.querySelector(o)!==null||s==="style"&&n.querySelector(sr(u))||s==="script"&&n.querySelector(ar(u))||(s=n.createElement("link"),Mt(s,"link",t),lt(s),n.head.appendChild(s)))}}function Xh(t,s){Vs.m(t,s);var a=tl;if(a&&t){var n=s&&typeof s.as=="string"?s.as:"script",o='link[rel="modulepreload"][as="'+Lt(n)+'"][href="'+Lt(t)+'"]',u=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=al(t)}if(!os.has(u)&&(t=y({rel:"modulepreload",href:t},s),os.set(u,t),a.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(ar(u)))return}n=a.createElement("link"),Mt(n,"link",t),lt(n),a.head.appendChild(n)}}}function Ph(t,s,a){Vs.S(t,s,a);var n=tl;if(n&&t){var o=ea(n).hoistableStyles,u=sl(t);s=s||"default";var p=o.get(u);if(!p){var j={loading:0,preload:null};if(p=n.querySelector(sr(u)))j.loading=5;else{t=y({rel:"stylesheet",href:t,"data-precedence":s},a),(a=os.get(u))&&Wc(t,a);var z=p=n.createElement("link");lt(z),Mt(z,"link",t),z._p=new Promise(function(W,ie){z.onload=W,z.onerror=ie}),z.addEventListener("load",function(){j.loading|=1}),z.addEventListener("error",function(){j.loading|=2}),j.loading|=4,_i(p,s,n)}p={type:"stylesheet",instance:p,count:1,state:j},o.set(u,p)}}}function Zh(t,s){Vs.X(t,s);var a=tl;if(a&&t){var n=ea(a).hoistableScripts,o=al(t),u=n.get(o);u||(u=a.querySelector(ar(o)),u||(t=y({src:t,async:!0},s),(s=os.get(o))&&ed(t,s),u=a.createElement("script"),lt(u),Mt(u,"link",t),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function Kh(t,s){Vs.M(t,s);var a=tl;if(a&&t){var n=ea(a).hoistableScripts,o=al(t),u=n.get(o);u||(u=a.querySelector(ar(o)),u||(t=y({src:t,async:!0,type:"module"},s),(s=os.get(o))&&ed(t,s),u=a.createElement("script"),lt(u),Mt(u,"link",t),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function Vm(t,s,a,n){var o=(o=pe.current)?Di(o):null;if(!o)throw Error(c(446));switch(t){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(s=sl(a.href),a=ea(o).hoistableStyles,n=a.get(s),n||(n={type:"style",instance:null,count:0,state:null},a.set(s,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){t=sl(a.href);var u=ea(o).hoistableStyles,p=u.get(t);if(p||(o=o.ownerDocument||o,p={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(t,p),(u=o.querySelector(sr(t)))&&!u._p&&(p.instance=u,p.state.loading=5),os.has(t)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},os.set(t,a),u||Fh(o,t,a,p.state))),s&&n===null)throw Error(c(528,""));return p}if(s&&n!==null)throw Error(c(529,""));return null;case"script":return s=a.async,a=a.src,typeof a=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=al(a),a=ea(o).hoistableScripts,n=a.get(s),n||(n={type:"script",instance:null,count:0,state:null},a.set(s,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,t))}}function sl(t){return'href="'+Lt(t)+'"'}function sr(t){return'link[rel="stylesheet"]['+t+"]"}function Ym(t){return y({},t,{"data-precedence":t.precedence,precedence:null})}function Fh(t,s,a,n){t.querySelector('link[rel="preload"][as="style"]['+s+"]")?n.loading=1:(s=t.createElement("link"),n.preload=s,s.addEventListener("load",function(){return n.loading|=1}),s.addEventListener("error",function(){return n.loading|=2}),Mt(s,"link",a),lt(s),t.head.appendChild(s))}function al(t){return'[src="'+Lt(t)+'"]'}function ar(t){return"script[async]"+t}function Qm(t,s,a){if(s.count++,s.instance===null)switch(s.type){case"style":var n=t.querySelector('style[data-href~="'+Lt(a.href)+'"]');if(n)return s.instance=n,lt(n),n;var o=y({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),lt(n),Mt(n,"style",o),_i(n,a.precedence,t),s.instance=n;case"stylesheet":o=sl(a.href);var u=t.querySelector(sr(o));if(u)return s.state.loading|=4,s.instance=u,lt(u),u;n=Ym(a),(o=os.get(o))&&Wc(n,o),u=(t.ownerDocument||t).createElement("link"),lt(u);var p=u;return p._p=new Promise(function(j,z){p.onload=j,p.onerror=z}),Mt(u,"link",n),s.state.loading|=4,_i(u,a.precedence,t),s.instance=u;case"script":return u=al(a.src),(o=t.querySelector(ar(u)))?(s.instance=o,lt(o),o):(n=a,(o=os.get(u))&&(n=y({},a),ed(n,o)),t=t.ownerDocument||t,o=t.createElement("script"),lt(o),Mt(o,"link",n),t.head.appendChild(o),s.instance=o);case"void":return null;default:throw Error(c(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(n=s.instance,s.state.loading|=4,_i(n,a.precedence,t));return s.instance}function _i(t,s,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,u=o,p=0;p<n.length;p++){var j=n[p];if(j.dataset.precedence===s)u=j;else if(u!==o)break}u?u.parentNode.insertBefore(t,u.nextSibling):(s=a.nodeType===9?a.head:a,s.insertBefore(t,s.firstChild))}function Wc(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.title==null&&(t.title=s.title)}function ed(t,s){t.crossOrigin==null&&(t.crossOrigin=s.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=s.referrerPolicy),t.integrity==null&&(t.integrity=s.integrity)}var Oi=null;function Jm(t,s,a){if(Oi===null){var n=new Map,o=Oi=new Map;o.set(a,n)}else o=Oi,n=o.get(a),n||(n=new Map,o.set(a,n));if(n.has(t))return n;for(n.set(t,null),a=a.getElementsByTagName(t),o=0;o<a.length;o++){var u=a[o];if(!(u[Ks]||u[ot]||t==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var p=u.getAttribute(s)||"";p=t+p;var j=n.get(p);j?j.push(u):n.set(p,[u])}}return n}function Xm(t,s,a){t=t.ownerDocument||t,t.head.insertBefore(a,s==="title"?t.querySelector("head > title"):null)}function Wh(t,s,a){if(a===1||s.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return t=s.disabled,typeof s.precedence=="string"&&t==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Pm(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function ep(t,s,a,n){if(a.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var o=sl(n.href),u=s.querySelector(sr(o));if(u){s=u._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(t.count++,t=zi.bind(t),s.then(t,t)),a.state.loading|=4,a.instance=u,lt(u);return}u=s.ownerDocument||s,n=Ym(n),(o=os.get(o))&&Wc(n,o),u=u.createElement("link"),lt(u);var p=u;p._p=new Promise(function(j,z){p.onload=j,p.onerror=z}),Mt(u,"link",n),a.instance=u}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(a,s),(s=a.state.preload)&&(a.state.loading&3)===0&&(t.count++,a=zi.bind(t),s.addEventListener("load",a),s.addEventListener("error",a))}}var td=0;function tp(t,s){return t.stylesheets&&t.count===0&&Li(t,t.stylesheets),0<t.count||0<t.imgCount?function(a){var n=setTimeout(function(){if(t.stylesheets&&Li(t,t.stylesheets),t.unsuspend){var u=t.unsuspend;t.unsuspend=null,u()}},6e4+s);0<t.imgBytes&&td===0&&(td=62500*zh());var o=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Li(t,t.stylesheets),t.unsuspend)){var u=t.unsuspend;t.unsuspend=null,u()}},(t.imgBytes>td?50:800)+s);return t.unsuspend=a,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function zi(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Li(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Ri=null;function Li(t,s){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Ri=new Map,s.forEach(sp,t),Ri=null,zi.call(t))}function sp(t,s){if(!(s.state.loading&4)){var a=Ri.get(t);if(a)var n=a.get(null);else{a=new Map,Ri.set(t,a);for(var o=t.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<o.length;u++){var p=o[u];(p.nodeName==="LINK"||p.getAttribute("media")!=="not all")&&(a.set(p.dataset.precedence,p),n=p)}n&&a.set(null,n)}o=s.instance,p=o.getAttribute("data-precedence"),u=a.get(p)||n,u===n&&a.set(null,o),a.set(p,o),this.count++,n=zi.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),u?u.parentNode.insertBefore(o,u.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(o,t.firstChild)),s.state.loading|=4}}var nr={$$typeof:V,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function ap(t,s,a,n,o,u,p,j,z){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bn(0),this.hiddenUpdates=bn(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=u,this.onRecoverableError=p,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=z,this.incompleteTransitions=new Map}function Zm(t,s,a,n,o,u,p,j,z,W,ie,me){return t=new ap(t,s,a,p,z,W,ie,me,j),s=1,u===!0&&(s|=24),u=Jt(3,null,null,s),t.current=u,u.stateNode=t,s=Oo(),s.refCount++,t.pooledCache=s,s.refCount++,u.memoizedState={element:n,isDehydrated:a,cache:s},Bo(u),t}function Km(t){return t?(t=On,t):On}function Fm(t,s,a,n,o,u){o=Km(o),n.context===null?n.context=o:n.pendingContext=o,n=xa(s),n.payload={element:a},u=u===void 0?null:u,u!==null&&(n.callback=u),a=fa(t,n,s),a!==null&&(qt(a,t,s),Rl(a,t,s))}function Wm(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<s?a:s}}function sd(t,s){Wm(t,s),(t=t.alternate)&&Wm(t,s)}function ex(t){if(t.tag===13||t.tag===31){var s=Ka(t,67108864);s!==null&&qt(s,t,67108864),sd(t,67108864)}}function tx(t){if(t.tag===13||t.tag===31){var s=Ft();s=kr(s);var a=Ka(t,s);a!==null&&qt(a,t,s),sd(t,s)}}var Bi=!0;function np(t,s,a,n){var o=L.T;L.T=null;var u=I.p;try{I.p=2,ad(t,s,a,n)}finally{I.p=u,L.T=o}}function lp(t,s,a,n){var o=L.T;L.T=null;var u=I.p;try{I.p=8,ad(t,s,a,n)}finally{I.p=u,L.T=o}}function ad(t,s,a,n){if(Bi){var o=nd(n);if(o===null)Gc(t,s,n,Hi,a),ax(t,n);else if(ip(o,t,s,a,n))n.stopPropagation();else if(ax(t,n),s&4&&-1<rp.indexOf(t)){for(;o!==null;){var u=Fs(o);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var p=ds(u.pendingLanes);if(p!==0){var j=u;for(j.pendingLanes|=2,j.entangledLanes|=2;p;){var z=1<<31-wt(p);j.entanglements[1]|=z,p&=~z}ks(u),(Ve&6)===0&&(ji=Nt()+500,Fl(0))}}break;case 31:case 13:j=Ka(u,2),j!==null&&qt(j,u,2),wi(),sd(u,2)}if(u=nd(n),u===null&&Gc(t,s,n,Hi,a),u===o)break;o=u}o!==null&&n.stopPropagation()}else Gc(t,s,n,null,a)}}function nd(t){return t=vl(t),ld(t)}var Hi=null;function ld(t){if(Hi=null,t=Es(t),t!==null){var s=m(t);if(s===null)t=null;else{var a=s.tag;if(a===13){if(t=f(s),t!==null)return t;t=null}else if(a===31){if(t=x(s),t!==null)return t;t=null}else if(a===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null)}}return Hi=t,null}function sx(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(dl()){case Js:return 2;case yr:return 8;case cs:case Ld:return 32;case eo:return 268435456;default:return 32}default:return 32}}var rd=!1,ka=null,Ca=null,Ea=null,lr=new Map,rr=new Map,Ma=[],rp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ax(t,s){switch(t){case"focusin":case"focusout":ka=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":lr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":rr.delete(s.pointerId)}}function ir(t,s,a,n,o,u){return t===null||t.nativeEvent!==u?(t={blockedOn:s,domEventName:a,eventSystemFlags:n,nativeEvent:u,targetContainers:[o]},s!==null&&(s=Fs(s),s!==null&&ex(s)),t):(t.eventSystemFlags|=n,s=t.targetContainers,o!==null&&s.indexOf(o)===-1&&s.push(o),t)}function ip(t,s,a,n,o){switch(s){case"focusin":return ka=ir(ka,t,s,a,n,o),!0;case"dragenter":return Ca=ir(Ca,t,s,a,n,o),!0;case"mouseover":return Ea=ir(Ea,t,s,a,n,o),!0;case"pointerover":var u=o.pointerId;return lr.set(u,ir(lr.get(u)||null,t,s,a,n,o)),!0;case"gotpointercapture":return u=o.pointerId,rr.set(u,ir(rr.get(u)||null,t,s,a,n,o)),!0}return!1}function nx(t){var s=Es(t.target);if(s!==null){var a=m(s);if(a!==null){if(s=a.tag,s===13){if(s=f(a),s!==null){t.blockedOn=s,hl(t.priority,function(){tx(a)});return}}else if(s===31){if(s=x(a),s!==null){t.blockedOn=s,hl(t.priority,function(){tx(a)});return}}else if(s===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ui(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var a=nd(t.nativeEvent);if(a===null){a=t.nativeEvent;var n=new a.constructor(a.type,a);yl=n,a.target.dispatchEvent(n),yl=null}else return s=Fs(a),s!==null&&ex(s),t.blockedOn=a,!1;s.shift()}return!0}function lx(t,s,a){Ui(t)&&a.delete(s)}function op(){rd=!1,ka!==null&&Ui(ka)&&(ka=null),Ca!==null&&Ui(Ca)&&(Ca=null),Ea!==null&&Ui(Ea)&&(Ea=null),lr.forEach(lx),rr.forEach(lx)}function Ii(t,s){t.blockedOn===s&&(t.blockedOn=null,rd||(rd=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,op)))}var qi=null;function rx(t){qi!==t&&(qi=t,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){qi===t&&(qi=null);for(var s=0;s<t.length;s+=3){var a=t[s],n=t[s+1],o=t[s+2];if(typeof n!="function"){if(ld(n||a)===null)continue;break}var u=Fs(a);u!==null&&(t.splice(s,3),s-=3,nc(u,{pending:!0,data:o,method:a.method,action:n},n,o))}}))}function nl(t){function s(z){return Ii(z,t)}ka!==null&&Ii(ka,t),Ca!==null&&Ii(Ca,t),Ea!==null&&Ii(Ea,t),lr.forEach(s),rr.forEach(s);for(var a=0;a<Ma.length;a++){var n=Ma[a];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Ma.length&&(a=Ma[0],a.blockedOn===null);)nx(a),a.blockedOn===null&&Ma.shift();if(a=(t.ownerDocument||t).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var o=a[n],u=a[n+1],p=o[St]||null;if(typeof u=="function")p||rx(a);else if(p){var j=null;if(u&&u.hasAttribute("formAction")){if(o=u,p=u[St]||null)j=p.formAction;else if(ld(o)!==null)continue}else j=p.action;typeof j=="function"?a[n+1]=j:(a.splice(n,3),n-=3),rx(a)}}}function ix(){function t(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(p){return o=p})},focusReset:"manual",scroll:"manual"})}function s(){o!==null&&(o(),o=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),o!==null&&(o(),o=null)}}}function id(t){this._internalRoot=t}Gi.prototype.render=id.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(c(409));var a=s.current,n=Ft();Fm(a,n,t,s,null,null)},Gi.prototype.unmount=id.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;Fm(t.current,2,null,t,null,null),wi(),s[Zs]=null}};function Gi(t){this._internalRoot=t}Gi.prototype.unstable_scheduleHydration=function(t){if(t){var s=fl();t={blockedOn:null,target:t,priority:s};for(var a=0;a<Ma.length&&s!==0&&s<Ma[a].priority;a++);Ma.splice(a,0,t),a===0&&nx(t)}};var ox=l.version;if(ox!=="19.2.0")throw Error(c(527,ox,"19.2.0"));I.findDOMNode=function(t){var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(c(188)):(t=Object.keys(t).join(","),Error(c(268,t)));return t=g(s),t=t!==null?b(t):null,t=t===null?null:t.stateNode,t};var cp={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vi.isDisabled&&Vi.supportsFiber)try{Xs=Vi.inject(cp),Tt=Vi}catch{}}return cr.createRoot=function(t,s){if(!d(t))throw Error(c(299));var a=!1,n="",o=h0,u=p0,p=g0;return s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(n=s.identifierPrefix),s.onUncaughtError!==void 0&&(o=s.onUncaughtError),s.onCaughtError!==void 0&&(u=s.onCaughtError),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=Zm(t,1,!1,null,null,a,n,null,o,u,p,ix),t[Zs]=s.current,qc(t),new id(s)},cr.hydrateRoot=function(t,s,a){if(!d(t))throw Error(c(299));var n=!1,o="",u=h0,p=p0,j=g0,z=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(o=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(p=a.onCaughtError),a.onRecoverableError!==void 0&&(j=a.onRecoverableError),a.formState!==void 0&&(z=a.formState)),s=Zm(t,1,!0,s,a??null,n,o,z,u,p,j,ix),s.context=Km(null),a=s.current,n=Ft(),n=kr(n),o=xa(n),o.callback=null,fa(a,o,n),a=n,s.current.lanes=a,Ia(s,a),ks(s),t[Zs]=s.current,qc(t),new Gi(s)},cr.version="19.2.0",cr}var bx;function bp(){if(bx)return dd.exports;bx=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(l){console.error(l)}}return i(),dd.exports=gp(),dd.exports}var yp=bp();const vp=af(yp),Me=i=>{if(!i)return"text-gray-400";switch(i){case"凡品":return"text-gray-400";case"良品":return"text-green-400";case"优品":return"text-blue-400";case"珍品":return"text-purple-400";case"绝品":return"text-amber-400";case"仙品":return"text-red-400";case"圣品":return"text-yellow-300 animate-glow";case"神品":return"text-rainbow font-black";default:return"text-gray-400"}},At=i=>{if(!i)return"border-gray-600/50";switch(i){case"凡品":return"border-gray-600/50";case"良品":return"border-green-500/60";case"优品":return"border-blue-500/60";case"珍品":return"border-purple-500/60";case"绝品":return"border-amber-400/70";case"仙品":return"border-red-500/70";case"圣品":return"border-yellow-300/80";case"神品":return"border-fuchsia-400 animate-pulse-fast";default:return"border-gray-600/50"}},jp=i=>{if(!i)return"";switch(i){case"良品":return"shadow-[0_0_12px_2px_rgba(34,197,94,0.4)]";case"优品":return"shadow-[0_0_12px_2px_rgba(59,130,246,0.5)]";case"珍品":return"shadow-[0_0_12px_2px_rgba(168,85,247,0.5)]";case"绝品":return"shadow-[0_0_15px_3px_rgba(251,191,36,0.6)]";case"仙品":return"shadow-[0_0_18px_4px_rgba(239,68,68,0.6)]";case"圣品":return"shadow-[0_0_22px_5px_rgba(253,224,71,0.7)] animate-pulse";case"神品":return"shadow-[0_0_30px_6px_rgba(236,72,153,0.7)] animate-pulse-fast";default:return""}},pr=(i,l=!0)=>{const r=l?" transition-colors":"";if(!i)return"bg-slate-800/70"+r;switch(i){case"凡品":return"bg-slate-800/70"+(l?" hover:bg-slate-800/90":"");case"良品":return"bg-green-900/20"+(l?" hover:bg-green-900/30":"");case"优品":return"bg-blue-900/20"+(l?" hover:bg-blue-900/30":"");case"珍品":return"bg-purple-900/20"+(l?" hover:bg-purple-900/30":"");case"绝品":return"bg-amber-900/20"+(l?" hover:bg-amber-900/30":"");case"仙品":return"bg-red-900/20"+(l?" hover:bg-red-900/30":"");case"圣品":return"bg-yellow-900/30"+(l?" hover:bg-yellow-900/40":"");case"神品":return"bg-purple-900/40"+(l?" hover:bg-purple-900/50":"");default:return"bg-slate-800/70"+r}},Np=({isOpen:i,onClose:l,onSelect:r,characterList:c,title:d})=>{const[m,f]=v.useState("人物"),[x,h]=v.useState("全部");if(!i)return null;const g=y=>{r(y),l()},b=()=>{let y=[];return m==="人物"?y=c.filter(C=>"skills"in C).filter(C=>x==="全部"||C.gender===(x==="男"?"Male":"Female")):y=c.filter(C=>"skill"in C).filter(C=>x==="全部"||C.gender===(x==="男"?"Male":"Female")),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:y.length>0?y.map(S=>e.jsxs("button",{onClick:()=>g(S),className:`p-3 rounded-lg border-2 text-center transition-all duration-200 ${At(S.rarity)} hover:ring-4 hover:ring-green-500`,children:[e.jsx("p",{className:"font-bold font-serif text-white truncate",children:S.name}),e.jsx("p",{className:`text-xs font-semibold ${Me(S.rarity)}`,children:"skills"in S?S.realm:"兽宠"})]},S.id)):e.jsx("p",{className:"col-span-full text-center text-gray-500 pt-8",children:"此分类下暂无可用卡牌。"})})};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:d}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-stone-700 bg-black/10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>f("人物"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${m==="人物"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"人物"}),e.jsx("button",{onClick:()=>f("兽宠"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${m==="兽宠"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"兽宠"})]}),m==="人物"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h("全部"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${x==="全部"?"bg-sky-500/20 text-sky-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"全部"}),e.jsx("button",{onClick:()=>h("男"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${x==="男"?"bg-blue-500/20 text-blue-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"男"}),e.jsx("button",{onClick:()=>h("女"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${x==="女"?"bg-pink-500/20 text-pink-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"女"})]})]}),e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:b()})]})})},wp=({card:i,busyReason:l})=>{const r="skill"in i;return e.jsxs("div",{className:`p-3 rounded-lg border-2 text-center transition-all duration-200 ${At(i.rarity)}`,children:[e.jsx("p",{className:"font-bold font-serif text-white truncate",children:i.name}),e.jsx("p",{className:`text-xs font-semibold ${Me(i.rarity)}`,children:r?"兽宠":i.realm}),l&&e.jsx("p",{className:"text-xs text-cyan-400 mt-1 truncate",title:l,children:l})]})},Sp=({isOpen:i,onClose:l,cardCollection:r,petCollection:c,busyCharacterDetails:d})=>{const[m,f]=v.useState("空闲中"),[x,h]=v.useState("人物"),[g,b]=v.useState("全部");if(!i)return null;const y=()=>{const S=m==="忙碌中";let C=[],A=[];x==="人物"?C=r.filter($=>{const Z=d.has($.id),R=g==="全部"||$.gender===(g==="男"?"Male":"Female");return S===Z&&R}):A=c.filter($=>{const Z=d.has($.id),R=g==="全部"||$.gender===(g==="男"?"Male":"Female");return S===Z&&R});const E=x==="人物"?C:A;return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:E.length>0?E.map($=>e.jsx(wp,{card:$,busyReason:d.get($.id)},$.id)):e.jsx("p",{className:"col-span-full text-center text-gray-500 pt-8",children:"此分类下暂无卡牌。"})})};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-5xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"人物状态总览"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-stone-700 bg-black/10 space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>f("空闲中"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${m==="空闲中"?"bg-green-500/20 text-green-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"空闲中"}),e.jsx("button",{onClick:()=>f("忙碌中"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${m==="忙碌中"?"bg-red-500/20 text-red-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"忙碌中"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h("人物"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${x==="人物"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"人物"}),e.jsx("button",{onClick:()=>h("兽宠"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${x==="兽宠"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"兽宠"})]}),x==="人物"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>b("全部"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${g==="全部"?"bg-sky-500/20 text-sky-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"全部"}),e.jsx("button",{onClick:()=>b("男"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${g==="男"?"bg-blue-500/20 text-blue-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"男"}),e.jsx("button",{onClick:()=>b("女"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 ${g==="女"?"bg-pink-500/20 text-pink-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"女"})]})]})]}),e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:y()})]})})},kp="modulepreload",Cp=function(i,l){return new URL(i,l).href},yx={},Ep=function(l,r,c){let d=Promise.resolve();if(r&&r.length>0){let f=function(b){return Promise.all(b.map(y=>Promise.resolve(y).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const x=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),g=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));d=f(r.map(b=>{if(b=Cp(b,c),b in yx)return;yx[b]=!0;const y=b.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(!!c)for(let E=x.length-1;E>=0;E--){const $=x[E];if($.href===b&&(!y||$.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${S}`))return;const A=document.createElement("link");if(A.rel=y?"stylesheet":kp,y||(A.as="script"),A.crossOrigin="",A.href=b,g&&A.setAttribute("nonce",g),document.head.appendChild(A),y)return new Promise((E,$)=>{A.addEventListener("load",E),A.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${b}`)))})}))}function m(f){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=f,window.dispatchEvent(x),!x.defaultPrevented)throw f}return d.then(f=>{for(const x of f||[])x.status==="rejected"&&m(x.reason);return l().catch(m)})};class Mp{constructor(l){this.config=l}updateConfig(l){this.config=l}getConfig(){return{...this.config}}async testConnection(){if(!this.config.rerankerEnabled)return{success:!1,error:"Reranker功能未启用"};try{const l="测试查询",r=["测试文档1","测试文档2"];return await this.rerank(l,r),{success:!0,model:this.config.rerankerModel}}catch(l){return{success:!1,error:l instanceof Error?l.message:"连接失败"}}}async rerankSearchResults(l,r){if(!this.config.rerankerEnabled)return console.log("Reranker未启用，返回原始结果"),r;if(r.length===0)return r;try{console.log(`使用Reranker重排序 ${r.length} 个结果...`);const c=Date.now(),d=r.map(b=>b.memory.text),m=await this.rerank(l,d),f=r.map((b,y)=>({...b,similarity:m[y],originalSimilarity:b.similarity}));f.sort((b,y)=>y.similarity-b.similarity),f.forEach((b,y)=>{b.rank=y+1});const x=this.config.maxResults||20,h=f.slice(0,x),g=Date.now();return console.log(`Reranker完成，耗时 ${g-c}ms，返回 ${h.length} 个结果`),h}catch(c){return console.error("Reranker失败，返回原始结果:",c),r}}async rerank(l,r){if(!this.config.rerankerApiKey)throw new Error("缺少Reranker API密钥");if(!l||l.trim().length===0)throw new Error("查询文本为空");if(r.length===0)return[];try{const c=this.config.rerankerApiUrl.includes("jina")||this.config.rerankerModel.includes("jina"),d=this.config.rerankerApiUrl.includes("cohere")||this.config.rerankerModel.includes("rerank");return c?await this.rerankWithJina(l,r):d?await this.rerankWithCohere(l,r):await this.rerankGeneric(l,r)}catch(c){throw console.error("Reranker API调用失败:",c),c}}async rerankWithJina(l,r){const c={model:this.config.rerankerModel,query:l,documents:r,top_n:r.length},d=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(c)});if(!d.ok){const x=await d.json().catch(()=>({}));throw new Error(`Jina Reranker API错误 ${d.status}: ${x.detail||d.statusText}`)}const m=await d.json(),f=new Array(r.length).fill(0);for(const x of m.results)f[x.index]=x.relevance_score;return f}async rerankWithCohere(l,r){const c={model:this.config.rerankerModel,query:l,documents:r,top_n:r.length,return_documents:!1},d=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(c)});if(!d.ok){const x=await d.json().catch(()=>({}));throw new Error(`Cohere Reranker API错误 ${d.status}: ${x.message||d.statusText}`)}const m=await d.json(),f=new Array(r.length).fill(0);for(const x of m.results)f[x.index]=x.relevance_score;return f}async rerankGeneric(l,r){var f;const c={model:this.config.rerankerModel,query:l,documents:r},d=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(c)});if(!d.ok){const x=await d.json().catch(()=>({}));throw new Error(`Reranker API错误 ${d.status}: ${((f=x.error)==null?void 0:f.message)||d.statusText}`)}const m=await d.json();if(m.results&&Array.isArray(m.results)){const x=new Array(r.length).fill(0);for(const h of m.results){const g=h.index??h.document_index??0,b=h.relevance_score??h.score??0;x[g]=b}return x}throw new Error("无法解析Reranker API响应格式")}async batchRerank(l,r,c=100){if(r.length<=c)return await this.rerank(l,r);const d=[],m=this.chunkArray(r,c);for(let f=0;f<m.length;f++){const x=m[f];console.log(`处理Reranker批次 ${f+1}/${m.length}, 共 ${x.length} 条`);try{const h=await this.rerank(l,x);d.push(...h),f<m.length-1&&await this.delay(200)}catch(h){console.error(`Reranker批次 ${f+1} 失败:`,h),d.push(...new Array(x.length).fill(0))}}return d}chunkArray(l,r){const c=[];for(let d=0;d<l.length;d+=r)c.push(l.slice(d,d+r));return c}delay(l){return new Promise(r=>setTimeout(r,l))}}const lf=new Mp({enabled:!1,apiUrl:"",apiKey:"",model:"",autoVectorize:!1,vectorizeOnSummary:!1,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0});class rf{constructor(l){this.config=l}updateConfig(l){this.config=l}getConfig(){return{...this.config}}async testConnection(){try{const l=await this.vectorize("测试连接");return{success:!0,model:this.config.model}}catch(l){return{success:!1,error:l instanceof Error?l.message:"连接失败"}}}async fetchAvailableModels(){var l,r;try{if(this.config.apiUrl.includes("ollama")||this.config.apiUrl.includes("11434")){const d=await fetch(`${this.config.apiUrl}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!d.ok){const x=await d.text();return{success:!1,error:`HTTP ${d.status}: ${x}`}}return{success:!0,models:((l=(await d.json()).models)==null?void 0:l.map(x=>x.name))||[]}}else{const d=await fetch(`${this.config.apiUrl}/models`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`}});if(!d.ok){const x=await d.text();return{success:!1,error:`HTTP ${d.status}: ${x}`}}return{success:!0,models:((r=(await d.json()).data)==null?void 0:r.map(x=>x.id))||[]}}}catch(c){return{success:!1,error:c instanceof Error?c.message:"未知错误"}}}async vectorize(l){var r,c;if(!this.config.enabled)throw new Error("向量化功能未启用");if(!this.config.apiKey)throw new Error("缺少API密钥");if(!l||l.trim().length===0)throw new Error("文本内容为空");try{const d={model:this.config.model,input:l,encoding_format:"float"},m=await fetch(`${this.config.apiUrl}/embeddings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify(d)});if(!m.ok){const x=await m.json().catch(()=>({}));throw new Error(`API错误 ${m.status}: ${((r=x.error)==null?void 0:r.message)||m.statusText}`)}const f=await m.json();if(f.data&&Array.isArray(f.data)&&((c=f.data[0])!=null&&c.embedding))return f.data[0].embedding;if(Array.isArray(f.embedding))return f.embedding;throw new Error("无法解析API响应格式")}catch(d){throw console.error("向量化失败:",d),d}}async batchVectorize(l){if(!this.config.enabled)throw new Error("向量化功能未启用");if(l.length===0)return[];const r=this.chunkArray(l,this.config.batchSize),c=[];for(let d=0;d<r.length;d++){const m=r[d];try{console.log(`处理批次 ${d+1}/${r.length}, 共 ${m.length} 条`);const f=await Promise.all(m.map(x=>this.vectorize(x)));c.push(...f),d<r.length-1&&await this.delay(200)}catch(f){if(console.error(`批次 ${d+1} 处理失败:`,f),this.config.retryAttempts>0){console.log(`将在 1 秒后重试批次 ${d+1}`),await this.delay(1e3);try{const x=await Promise.all(m.map(h=>this.vectorize(h)));c.push(...x);continue}catch(x){console.error(`批次 ${d+1} 重试失败:`,x)}}throw f}}return c}cosineSimilarity(l,r){if(l.length!==r.length)throw new Error(`向量维度不匹配: ${l.length} vs ${r.length}`);if(l.length===0)return 0;let c=0,d=0,m=0;for(let f=0;f<l.length;f++)c+=l[f]*r[f],d+=l[f]*l[f],m+=r[f]*r[f];return d=Math.sqrt(d),m=Math.sqrt(m),d===0||m===0?0:c/(d*m)}batchCosineSimilarity(l,r){return r.map(c=>this.cosineSimilarity(l,c))}chunkArray(l,r){const c=[];for(let d=0;d<l.length;d+=r)c.push(l.slice(d,d+r));return c}delay(l){return new Promise(r=>setTimeout(r,l))}estimateTokens(l){const r=(l.match(/[\u4e00-\u9fa5]/g)||[]).length,c=l.length-r;return Math.ceil(r/1.5+c/4)}estimateCost(l){return l/1e6*.02}}const $d={enabled:!1,apiUrl:"https://api.openai.com/v1",apiKey:"",model:"text-embedding-3-small",autoVectorize:!1,vectorizeOnSummary:!0,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0},Gt=new rf($d),Ap=Object.freeze(Object.defineProperty({__proto__:null,VectorService:rf,defaultVectorConfig:$d,vectorService:Gt},Symbol.toStringTag,{value:"Module"}));class Tp{constructor(){this.dbName="XianxiaVectorStore",this.version=1,this.storeName="vectors",this.db=null}async initialize(){return new Promise((l,r)=>{const c=indexedDB.open(this.dbName,this.version);c.onerror=()=>{r(new Error("无法打开IndexedDB"))},c.onsuccess=()=>{this.db=c.result,l()},c.onupgradeneeded=d=>{const m=d.target.result;if(!m.objectStoreNames.contains(this.storeName)){const f=m.createObjectStore(this.storeName,{keyPath:"id"});f.createIndex("memoryId","memoryId",{unique:!0}),f.createIndex("category","category",{unique:!1}),f.createIndex("created","created",{unique:!1}),f.createIndex("realTimestamp","metadata.realTimestamp",{unique:!1})}}})}async ensureDB(){if(this.db||await this.initialize(),!this.db)throw new Error("数据库未初始化");return this.db}async saveVector(l){const r=await this.ensureDB();return new Promise((c,d)=>{const x=r.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(l);x.onsuccess=()=>c(),x.onerror=()=>d(new Error("保存向量失败"))})}async saveBatchVectors(l){const r=await this.ensureDB();return new Promise((c,d)=>{const f=r.transaction([this.storeName],"readwrite").objectStore(this.storeName);let x=0,h=!1;for(const g of l){const b=f.put(g);b.onsuccess=()=>{x++,x===l.length&&!h&&c()},b.onerror=()=>{h||(h=!0,d(new Error(`保存向量失败: ${g.id}`)))}}l.length===0&&c()})}async getVectorById(l){const r=await this.ensureDB();return new Promise((c,d)=>{const x=r.transaction([this.storeName],"readonly").objectStore(this.storeName).get(l);x.onsuccess=()=>{c(x.result||null)},x.onerror=()=>{d(new Error("获取向量失败"))}})}async getVectorByMemoryId(l){const r=await this.ensureDB();return new Promise((c,d)=>{const h=r.transaction([this.storeName],"readonly").objectStore(this.storeName).index("memoryId").get(l);h.onsuccess=()=>{c(h.result||null)},h.onerror=()=>{d(new Error("获取向量失败"))}})}async getAllVectors(){const l=await this.ensureDB();return new Promise((r,c)=>{const f=l.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();f.onsuccess=()=>{r(f.result||[])},f.onerror=()=>{c(new Error("获取所有向量失败"))}})}async getVectorsByCategory(l){const r=await this.ensureDB();return new Promise((c,d)=>{const h=r.transaction([this.storeName],"readonly").objectStore(this.storeName).index("category").getAll(l);h.onsuccess=()=>{c(h.result||[])},h.onerror=()=>{d(new Error("获取分类向量失败"))}})}async getVectorsByTimeRange(l,r){const c=await this.ensureDB();return new Promise((d,m)=>{const h=c.transaction([this.storeName],"readonly").objectStore(this.storeName).index("realTimestamp"),g=IDBKeyRange.bound(l,r),b=h.getAll(g);b.onsuccess=()=>{d(b.result||[])},b.onerror=()=>{m(new Error("获取时间范围向量失败"))}})}async deleteVector(l){const r=await this.ensureDB();return new Promise((c,d)=>{const x=r.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(l);x.onsuccess=()=>c(),x.onerror=()=>d(new Error("删除向量失败"))})}async deleteBatchVectors(l){const r=await this.ensureDB();return new Promise((c,d)=>{const f=r.transaction([this.storeName],"readwrite").objectStore(this.storeName);let x=0,h=!1;for(const g of l){const b=f.delete(g);b.onsuccess=()=>{x++,x===l.length&&!h&&c()},b.onerror=()=>{h||(h=!0,d(new Error(`删除向量失败: ${g}`)))}}l.length===0&&c()})}async clearAllVectors(){const l=await this.ensureDB();return new Promise((r,c)=>{const f=l.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();f.onsuccess=()=>r(),f.onerror=()=>c(new Error("清空向量失败"))})}async getStats(){const l=await this.getAllVectors();if(l.length===0)return{totalVectors:0,byCategory:{探索:0,战斗:0,商城:0,医馆:0,悬赏:0,培育:0,商业:0,声望:0,公告:0,大牢:0,其他:0},oldestVector:0,newestVector:0,averageDimension:0,storageSize:0};const r={探索:0,战斗:0,商城:0,医馆:0,悬赏:0,培育:0,商业:0,声望:0,公告:0,大牢:0,其他:0};let c=0,d=l[0].created,m=l[0].created;for(const h of l)r[h.category]++,c+=h.vectorDimension,h.created<d&&(d=h.created),h.created>m&&(m=h.created);const f=c/l.length,x=l.reduce((h,g)=>h+g.vector.length*4+JSON.stringify(g.metadata).length,0);return{totalVectors:l.length,byCategory:r,oldestVector:d,newestVector:m,averageDimension:f,storageSize:x}}async isMemoryVectorized(l){return await this.getVectorByMemoryId(l)!==null}async getUnvectorizedMemoryIds(l){const r=[];for(const c of l)await this.isMemoryVectorized(c)||r.push(c);return r}close(){this.db&&(this.db.close(),this.db=null)}}const vs=new Tp;class $p{async search(l,r={}){const c=Date.now();try{const d=Gt.getConfig();if(!d.enabled)throw console.error("[语义搜索] ❌ 向量化功能未启用，请在设置中启用"),new Error("向量化功能未启用，请在设置中启用向量化功能");console.log("[语义搜索] 🔄 正在向量化查询文本..."),console.log("[语义搜索] 📊 当前配置:",{enabled:d.enabled,model:d.model,apiUrl:d.apiUrl});const m=await Gt.vectorize(l);let f=await this.getCandidates(r);if(console.log(`找到 ${f.length} 个候选向量`),f.length===0)return[];const x=this.calculateSimilarities(m,f,r),h=this.filterAndSort(x,r);let g=h;if(d.rerankerEnabled&&h.length>0){console.log("应用Reranker重排序...");const y=d.topKBeforeRerank||50,S=h.slice(0,y);g=await lf.rerankSearchResults(l,S)}const b=Date.now();return console.log(`搜索完成，耗时 ${b-c}ms，返回 ${g.length} 个结果`),g}catch(d){throw console.error("语义搜索失败:",d),d}}async batchSearch(l,r={}){const c=[],d=new Set;for(const f of l){const x=await this.search(f,r);for(const h of x)d.has(h.memory.id)||(c.push(h),d.add(h.memory.id))}c.sort((f,x)=>x.similarity-f.similarity),c.forEach((f,x)=>{f.rank=x+1});const m=r.maxResults||20;return c.slice(0,m)}async findSimilarMemories(l,r={}){const c=await vs.getVectorByMemoryId(l);if(!c)throw new Error(`记忆 ${l} 未向量化`);let d=await this.getCandidates(r);if(d=d.filter(f=>f.memoryId!==l),d.length===0)return[];const m=this.calculateSimilarities(c.vector,d,r);return this.filterAndSort(m,r)}async hybridSearch(l,r,c={}){const d=await this.search(l,c);if(r.length===0)return d;const m=d.map(f=>{let x=0;const h=f.memory.text.toLowerCase();for(const b of r)h.includes(b.toLowerCase())&&(x+=.1);const g=f.similarity*.7+Math.min(x,.3);return{...f,similarity:g}});return m.sort((f,x)=>x.similarity-f.similarity),m.forEach((f,x)=>{f.rank=x+1}),m}async getCandidates(l){let r=[];if(l.categories&&l.categories.length>0)for(const c of l.categories){const d=await vs.getVectorsByCategory(c);r.push(...d)}else r=await vs.getAllVectors();return l.timeRange&&(r=r.filter(c=>c.metadata.realTimestamp>=l.timeRange.start&&c.metadata.realTimestamp<=l.timeRange.end)),l.involvedCharacters&&l.involvedCharacters.length>0&&(r=r.filter(c=>c.metadata.involvedCharacters?l.involvedCharacters.some(d=>c.metadata.involvedCharacters.includes(d)):!1)),l.tags&&l.tags.length>0&&(r=r.filter(c=>c.metadata.tags?l.tags.some(d=>c.metadata.tags.includes(d)):!1)),r}calculateSimilarities(l,r,c){const d=[],m=Date.now(),f=c.useTimeDecay??!1,x=c.timeDecayFactor??1e-5;for(const h of r){let g=Gt.cosineSimilarity(l,h.vector);if(f){const y=(m-h.metadata.realTimestamp)/(1e3*60*60*24),S=Math.exp(-x*y);g=g*S}d.push({memory:h,similarity:g,rank:0})}return d}filterAndSort(l,r){const c=r.minSimilarity??.7,d=Gt.getConfig(),m=d.rerankerEnabled?d.topKBeforeRerank||50:r.maxResults??20;let f=l.filter(x=>x.similarity>=c);return f.sort((x,h)=>h.similarity-x.similarity),f=f.slice(0,m),f.forEach((x,h)=>{x.rank=h+1}),f}clusterResults(l,r=.85){if(l.length===0)return[];const c=[],d=new Set;for(const m of l){if(d.has(m.memory.id))continue;const f=[m];d.add(m.memory.id);for(const x of l){if(d.has(x.memory.id))continue;Gt.cosineSimilarity(m.memory.vector,x.memory.vector)>=r&&(f.push(x),d.add(x.memory.id))}c.push(f)}return c}async getSuggestions(l,r=5){if(l.length<2)return[];const c=await vs.getAllVectors(),d=new Set;for(const m of c){const f=m.text.toLowerCase(),x=l.toLowerCase();if(f.includes(x)){const h=m.text.split(/[。！？\n]/);for(const g of h)if(g.toLowerCase().includes(x)&&g.length<100&&(d.add(g.trim()),d.size>=r))break}if(d.size>=r)break}return Array.from(d)}}const jd=new $p;class Dp{extractContext(l){return l.mode==="battle"?this.extractBattleContext(l):this.extractExplorationContext(l)}extractBattleContext(l){const r=l.battle;if(!r)return{type:"battle",description:"战斗",keywords:["战斗"],categories:["战斗"]};const c=[],d=["战斗"];return r.playerParty.forEach(m=>{c.push(m.card.name),d.push(m.card.name)}),r.opponentParty.forEach(m=>{c.push(m.card.name),d.push(m.card.name)}),r.isArenaBattle?(d.push("竞技场","排位赛"),{type:"arena",description:`竞技场战斗：${c.join(" vs ")}`,involvedCharacters:c,keywords:d,categories:["战斗","声望"]}):{type:"battle",description:`战斗：${c.join(" vs ")}`,involvedCharacters:c,keywords:d,categories:["战斗"]}}extractExplorationContext(l){const r=l.exploration,c=r.location,d=r.story;if(c.includes("医馆")||d.includes("病患")||d.includes("诊治")){const x=this.extractKeywords(d);return x.push("医馆","问诊","治疗"),{type:"hospital",description:"医馆问诊",location:c,keywords:x,categories:["医馆"]}}if(c.includes("悬赏")||d.includes("悬赏")||d.includes("追踪")){const x=this.extractKeywords(d);return x.push("悬赏","追踪"),{type:"bounty",description:"悬赏任务",location:c,keywords:x,categories:["悬赏"]}}if(c.includes("商城")||c.includes("商店")||d.includes("购买")){const x=this.extractKeywords(d);return x.push("商城","购买","交易"),{type:"shop",description:"商城",location:c,keywords:x,categories:["商城"]}}if(c.includes("育灵轩")||d.includes("培育")||d.includes("繁育")){const x=this.extractKeywords(d);return x.push("培育","繁育"),{type:"cultivation",description:"育灵轩",location:c,keywords:x,categories:["培育"]}}if(c.includes("商业区")||d.includes("经营")||d.includes("生意")){const x=this.extractKeywords(d);return x.push("商业","经营"),{type:"business",description:"商业区经营",location:c,keywords:x,categories:["商业"]}}const m=this.extractKeywords(d),f=this.extractCharacterNames(d,l);return{type:"exploration",description:`探索：${c}`,location:c,involvedCharacters:f,keywords:m,categories:["探索"]}}extractKeywords(l){const r=[],c=["战斗","探索","购买","出售","治疗","问诊","追踪","培育","修炼","突破","挑战","对决","交易","谈判","调查"];for(const m of c)l.includes(m)&&r.push(m);const d=["医馆","商城","悬赏榜","育灵轩","竞技场","商业区","宗门","山门","广场","密室","洞府"];for(const m of d)l.includes(m)&&r.push(m);return r}extractCharacterNames(l,r){const c=[];for(const d of r.playerProfile.cardCollection)l.includes(d.name)&&c.push(d.name);for(const d of r.playerProfile.relationships)l.includes(d.name)&&c.push(d.name);return c}async retrieveRelevantMemories(l,r,c=10){const d=Date.now(),m=this.extractContext(l),f=r||m.description;console.log("[上下文检索] 🔍 当前上下文:",{type:m.type,description:m.description,categories:m.categories,keywords:m.keywords});const x={involvedCharacters:m.involvedCharacters,maxResults:c,minSimilarity:.65,useTimeDecay:!0,timeDecayFactor:1e-5};console.log("[上下文检索] 📊 搜索选项:",x);const h=await jd.hybridSearch(f,m.keywords,x),g=Date.now();return{query:f,context:m.description,relevantMemories:h,totalSearched:h.length,searchTime:g-d}}async batchRetrieve(l,r,c=15){const d=Date.now(),m=this.extractContext(l),f={categories:m.categories,involvedCharacters:m.involvedCharacters,maxResults:c,minSimilarity:.65,useTimeDecay:!0},x=await jd.batchSearch(r,f),h=Date.now();return{query:r.join("; "),context:m.description,relevantMemories:x,totalSearched:x.length,searchTime:h-d}}formatMemoriesForPrompt(l){if(l.length===0)return"";const r=["=== 相关历史记忆 ===",""];for(const c of l){const d=c.memory;r.push(`【${d.category}】${d.metadata.timestamp}`),r.push(`地点：${d.metadata.location||"未知"}`),d.metadata.involvedCharacters&&d.metadata.involvedCharacters.length>0&&r.push(`相关角色：${d.metadata.involvedCharacters.join("、")}`),r.push(`内容：${d.text}`),r.push(`相似度：${(c.similarity*100).toFixed(1)}%`),r.push("")}return r.push("==================="),r.join(`
`)}getMemorySummary(l){return l.map(r=>{const c=r.memory,d=c.text.length>100?c.text.substring(0,100)+"...":c.text;return`[${c.category}] ${c.metadata.timestamp}: ${d}`})}organizeByTimeline(l){const r=new Map;for(const c of l){const d=c.memory.metadata.timestamp;r.has(d)||r.set(d,[]),r.get(d).push(c)}return r}organizeByCharacter(l){const r=new Map;for(const c of l){const d=c.memory.metadata.involvedCharacters||[];for(const m of d)r.has(m)||r.set(m,[]),r.get(m).push(c)}return r}}const Ji=new Dp;class _p{async buildEnhancedContext(l,r,c={}){const{includeVectorMemories:d=!0,includePreset:m=!0,includeWorldbook:f=!0,maxVectorResults:x=5,categories:h}=c,g=[];let b="";if(console.log("[上下文增强] ========== 开始构建AI上下文 =========="),m&&typeof TavernHelper<"u")try{console.log("[上下文增强] 🎯 尝试读取SillyTavern预设...");const C=TavernHelper.getPreset("in_use");b=this.extractPresetsContent(C),b?(console.log("[上下文增强] ✅ 成功读取预设内容"),console.log("[上下文增强] 📝 预设内容长度:",b.length,"字符"),console.log("[上下文增强] 📄 预设内容预览:",b.substring(0,200)+(b.length>200?"...":""))):console.log("[上下文增强] ⚠️ 预设内容为空")}catch(C){console.error("[上下文增强] ❌ 无法读取预设:",C)}else console.log("[上下文增强] ⏭️ 跳过预设读取 (includePreset:",m,", TavernHelper可用:",typeof TavernHelper<"u",")");if(d&&l.vectorConfig.enabled)try{console.log("[上下文增强] 🔍 开始检索向量记忆..."),console.log("[上下文增强] 📌 查询内容:",r.substring(0,100)+(r.length>100?"...":""));const{vectorService:C}=await Ep(async()=>{const{vectorService:E}=await Promise.resolve().then(()=>Ap);return{vectorService:E}},void 0,import.meta.url);C.updateConfig(l.vectorConfig),console.log("[上下文增强] ✅ 已同步向量服务配置:",{enabled:l.vectorConfig.enabled,apiUrl:l.vectorConfig.apiUrl,model:l.vectorConfig.model});const A=await Ji.retrieveRelevantMemories(l,r,x);if(A.relevantMemories.length>0){console.log("[上下文增强] ✅ 找到",A.relevantMemories.length,"条相关记忆"),A.relevantMemories.forEach(($,Z)=>{console.log(`[上下文增强] 📦 记忆${Z+1}:`,{分类:$.memory.category,相似度:`${($.similarity*100).toFixed(1)}%`,时间:$.memory.metadata.timestamp,地点:$.memory.metadata.location||"未知",内容预览:$.memory.text.substring(0,50)+"..."})});const E=Ji.formatMemoriesForPrompt(A.relevantMemories);g.push({role:"system",content:`以下是与当前情境相关的历史记忆，请参考这些记忆来生成更连贯和一致的内容：

${E}`})}else console.log("[上下文增强] ⚠️ 未找到相关记忆")}catch(C){console.error("[上下文增强] ❌ 无法检索向量记忆:",C)}else console.log("[上下文增强] ⏭️ 跳过向量记忆检索 (includeVectorMemories:",d,", 向量功能启用:",l.vectorConfig.enabled,")");if(f&&typeof TavernHelper<"u")try{console.log("[上下文增强] 📚 开始检索世界书条目...");const C=await this.getRelevantWorldbookEntries(l,r);C?(g.push({role:"system",content:C}),console.log("[上下文增强] ✅ 成功获取世界书条目")):console.log("[上下文增强] ⚠️ 未找到匹配的世界书条目")}catch(C){console.error("[上下文增强] ❌ 无法读取世界书:",C)}else console.log("[上下文增强] ⏭️ 跳过世界书检索 (includeWorldbook:",f,", TavernHelper可用:",typeof TavernHelper<"u",")");console.log("[上下文增强] 🎮 添加当前游戏状态上下文...");const y=this.buildGameContextPrompt(l);y&&(g.push({role:"system",content:y}),console.log("[上下文增强] ✅ 游戏状态上下文已添加"));const S=this.buildEnhancedUserPrompt(r,l);return console.log("[上下文增强] ========== 上下文构建完成 =========="),console.log("[上下文增强] 📊 汇总统计:"),console.log("[上下文增强]   - 预设内容:",b?"✅ 已包含":"❌ 未包含"),console.log("[上下文增强]   - 注入提示词数量:",g.length),g.forEach((C,A)=>{const E=C.content.substring(0,50).replace(/\n/g," "),$=C.content.includes("历史记忆")?"📦 向量记忆":C.content.includes("世界书")?"📚 世界书":C.content.includes("游戏状态")?"🎮 游戏状态":"❓ 其他";console.log(`[上下文增强]   ${A+1}. ${$}: ${E}...`)}),console.log("[上下文增强] =========================================="),{systemPrompt:b,userPrompt:S,injectedPrompts:g}}extractPresetsContent(l){const r=[];for(const c of l.prompts||[])c.enabled&&c.role==="system"&&c.content&&r.push(c.content);return r.join(`

`)}async getRelevantWorldbookEntries(l,r){if(typeof TavernHelper>"u")return null;try{const c=TavernHelper.getGlobalWorldbookNames(),d=TavernHelper.getCharWorldbookNames("current"),m=[...c,...d.primary?[d.primary]:[],...d.additional],f=Array.from(new Set(m));if(console.log("[世界书] 📚 全局世界书:",c),console.log("[世界书] 📚 角色主世界书:",d.primary),console.log("[世界书] 📚 角色附加世界书:",d.additional),console.log("[世界书] 📚 合并后总数:",f.length),f.length===0)return console.log("[世界书] ⚠️ 没有激活任何世界书"),null;console.log("[世界书] 📋 激活的世界书列表:",f);const x=[];let h=0;for(const g of f)try{console.log(`[世界书] 🔍 正在检查世界书: ${g}`);const b=await TavernHelper.getWorldbook(g);console.log(`[世界书] 📖 ${g} 包含 ${b.length} 个条目`),h+=b.length;let y=0;for(const S of b){if(!S.enabled)continue;this.shouldIncludeWorldbookEntry(S,r,l)&&(y++,console.log(`[世界书] ✅ 匹配条目: ${S.name}`),console.log("[世界书] 📝 条目类型:",S.strategy.type),console.log("[世界书] 🔑 关键词:",S.strategy.keys),console.log("[世界书] 📄 内容长度:",S.content.length,"字符"),x.push(`【${S.name}】
${S.content}`))}console.log(`[世界书] 📊 ${g}: ${y}/${b.length} 条目匹配`)}catch(b){console.error(`[世界书] ❌ 无法读取世界书 ${g}:`,b)}return console.log(`[世界书] 📈 总计: ${x.length}/${h} 条目匹配`),x.length===0?(console.log("[世界书] ⚠️ 没有找到匹配的条目"),null):(console.log("[世界书] ✅ 成功获取",x.length,"个相关条目"),`=== 相关世界书信息 ===

${x.join(`

`)}

===================`)}catch(c){return console.error("读取世界书时出错:",c),null}}shouldIncludeWorldbookEntry(l,r,c){var f,x;if(l.strategy.type==="constant")return!0;const d=r.toLowerCase(),m=l.strategy.keys||[];for(const h of m)if(typeof h=="string"&&d.includes(h.toLowerCase()))return!0;if((f=l.metadata)!=null&&f.location&&c.exploration.location&&c.exploration.location.includes(l.metadata.location))return!0;if((x=l.metadata)!=null&&x.involvedCharacters){for(const h of l.metadata.involvedCharacters)if(d.includes(h.toLowerCase()))return!0}return!1}buildGameContextPrompt(l){const r=[];if(r.push("=== 当前游戏状态 ==="),r.push(""),r.push(`玩家：${l.playerProfile.name}`),r.push(`称号：${l.playerProfile.title}`),r.push(`灵石：${l.playerProfile.spiritStones}`),r.push(""),r.push(`当前位置：${l.exploration.location}`),r.push(`时间：${l.exploration.time}`),r.push(""),l.playerProfile.maleParty.length>0||l.playerProfile.femaleParty.length>0){r.push("当前队伍：");const c=[...l.playerProfile.maleParty,...l.playerProfile.femaleParty];for(const d of c)r.push(`  - ${d.name} (${d.realm})`);r.push("")}return l.mode==="battle"&&l.battle&&(r.push("战斗中："),r.push(`  己方：${l.battle.playerParty.map(c=>c.card.name).join("、")}`),r.push(`  敌方：${l.battle.opponentParty.map(c=>c.card.name).join("、")}`),r.push("")),r.push("==================="),r.join(`
`)}buildEnhancedUserPrompt(l,r){const c=[];return r.mode==="battle"?c.push("请基于当前战斗情况生成内容"):c.push("请基于当前探索情况生成内容"),c.push("请确保内容与历史记忆保持一致"),c.length>0?`${l}

（${c.join("，")}）`:l}async generateWithEnhancedContext(l,r,c={}){if(typeof TavernHelper>"u")throw new Error("TavernHelper未定义，无法使用增强生成功能");const d=await this.buildEnhancedContext(l,r,c),m=[];for(let f=0;f<d.injectedPrompts.length;f++){const x=d.injectedPrompts[f];m.push({id:`enhanced_context_${f}`,role:x.role,content:x.content,position:"in_chat",depth:0,should_scan:!0})}try{return await TavernHelper.generate({user_input:d.userPrompt,injects:m,should_stream:c.shouldStream||!1,max_chat_history:"all"})}catch(f){throw console.error("AI生成失败:",f),f}}async generateWithCustomAPI(l,r,c,d={}){if(typeof TavernHelper>"u")throw new Error("TavernHelper未定义，无法使用增强生成功能");const m=await this.buildEnhancedContext(l,r,{...d,includePreset:!1,includeWorldbook:!1}),f=[];for(let x=0;x<m.injectedPrompts.length;x++){const h=m.injectedPrompts[x];f.push({id:`enhanced_context_${x}`,role:h.role,content:h.content,position:"in_chat",depth:0,should_scan:!0})}try{return await TavernHelper.generate({user_input:m.userPrompt,injects:f,should_stream:d.shouldStream||!1,custom_api:c})}catch(x){throw console.error("AI生成失败:",x),x}}}const Op=new _p;async function ht(i){const{systemInstruction:l,prompt:r,gameState:c,includeVectorMemories:d=!0,includePreset:m=!0,includeWorldbook:f=!0,maxVectorResults:x=5,shouldStream:h=!1}=i;if(typeof window.TavernHelper>"u")throw console.warn("TavernHelper未定义，使用降级模式"),new Error("AI生成服务不可用");if(!c)return console.log("[增强生成] 未提供游戏状态，使用标准模式"),await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:l},{role:"user",content:r}]});try{console.log("[增强生成] ========================================"),console.log("[增强生成] 🚀 开始增强AI生成流程"),console.log("[增强生成] ========================================");const g=await Op.buildEnhancedContext(c,r,{includeVectorMemories:d,includePreset:m,includeWorldbook:f,maxVectorResults:x});console.log("[增强生成] ========================================"),console.log("[增强生成] 📝 准备构建最终提示词序列"),console.log("[增强生成] ========================================");const b=[];console.log("[增强生成] 1️⃣ 添加原始系统提示词"),console.log("[增强生成]    长度:",l.length,"字符"),b.push({role:"system",content:l}),g.systemPrompt?(console.log("[增强生成] 2️⃣ 添加SillyTavern预设"),console.log("[增强生成]    长度:",g.systemPrompt.length,"字符"),b.push({role:"system",content:g.systemPrompt})):console.log("[增强生成] 2️⃣ ⏭️ 跳过SillyTavern预设（未配置）"),console.log("[增强生成] 3️⃣ 添加注入的上下文提示词"),console.log("[增强生成]    数量:",g.injectedPrompts.length),g.injectedPrompts.forEach((C,A)=>{const E=C.content.includes("历史记忆")?"📦 向量记忆":C.content.includes("世界书")?"📚 世界书条目":C.content.includes("游戏状态")?"🎮 游戏状态":"❓ 其他上下文",$=C.content.length;console.log(`[增强生成]    ${A+1}/${g.injectedPrompts.length} ${E} (${$}字符)`)}),b.push(...g.injectedPrompts),console.log("[增强生成] 4️⃣ 添加用户提示词"),console.log("[增强生成]    长度:",g.userPrompt.length,"字符"),b.push({role:"user",content:g.userPrompt}),console.log("[增强生成] ========================================"),console.log("[增强生成] 🎯 最终提示词统计:"),console.log("[增强生成]    总数:",b.length,"条");const y=b.reduce((C,A)=>C+A.content.length,0);console.log("[增强生成]    总长度:",y,"字符"),console.log("[增强生成] ========================================"),console.log("[增强生成] 🔄 调用TavernHelper.generateRaw进行AI生成...");const S=await window.TavernHelper.generateRaw({ordered_prompts:b});return console.log("[增强生成] ========================================"),console.log("[增强生成] ✅ AI生成完成"),console.log("[增强生成]    生成内容长度:",S.length,"字符"),console.log("[增强生成] ========================================"),S}catch(g){console.error("[增强生成] ========================================"),console.error("[增强生成] ❌ 增强生成失败，回退到标准生成"),console.error("[增强生成] 错误信息:",g),console.error("[增强生成] ========================================"),console.log("[增强生成] 🔄 使用标准模式生成...");const b=await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:l},{role:"user",content:r}]});return console.log("[增强生成] ✅ 标准模式生成完成"),b}}async function Ke(i,l){if(typeof window.TavernHelper>"u")throw new Error("AI生成服务不可用");return await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:i},{role:"user",content:l}]})}const zp={brothel:"青楼",arena:"角斗场",alchemy:"炼丹房",auction:"拍卖行",intelligence:"情报阁",hospital:"医馆",prison:"大牢",etiquette_hall:"礼仪馆",general:null},Ra={brothel:"青楼",arena:"角斗场",alchemy:"炼丹房",auction:"拍卖行",intelligence:"情报阁",hospital:"医馆",prison:"大牢",etiquette_hall:"礼仪馆",general:"通用"},xr={brothel:[{id:"p_brothel_star",name:"头牌花魁"},{id:"p_brothel_tutor",name:"双修导师"},{id:"p_brothel_guard",name:"护卫"}],arena:[{id:"p_arena_gladiator",name:"明星角斗士"},{id:"p_arena_host",name:"主持人"},{id:"p_arena_trader",name:"奴隶商人"}],alchemy:[{id:"p_alchemy_chief",name:"首席炼丹师"},{id:"p_alchemy_apprentice",name:"药童"}],auction:[{id:"p_auction_master",name:"首席拍卖师"},{id:"p_auction_appraiser",name:"鉴宝师"}],intelligence:[{id:"p_intel_chief",name:"情报头子"},{id:"p_intel_assassin",name:"暗杀者"}],hospital:[{id:"p_hospital_doctor",name:"主治医师"},{id:"p_hospital_nurse",name:"护士"}],prison:[{id:"p_prison_warden",name:"狱长"},{id:"p_prison_guard",name:"狱卒"},{id:"p_prison_torturer",name:"刑讯官"}],etiquette_hall:[{id:"p_etiquette_designer",name:"礼仪设计师"},{id:"p_etiquette_inspector",name:"礼仪督察"}],general:[]},Rp={autoRefreshEnabled:!0,refreshIntervalDays:7,lastRefreshTime:0,languageEtiquetteCount:5,behaviorDressEtiquetteCount:5,enabledScenes:["brothel","arena","alchemy","auction","intelligence","hospital","prison","etiquette_hall"],languageAspects:{addressing:!0,requesting:!0,thanking:!0},behaviorAspects:{upperDress:!0,lowerDress:!0,accessories:!0,entryEtiquette:!0,servicePosture:!0,specialActions:!0},styleSettings:{shameLevel:80,submissionLevel:100,exposureLevel:60},autoDistribute:!0,autoDeprecateOld:!0,keepTopExecuted:3},Lp={designer:null,languageEtiquettes:[],behaviorDressEtiquettes:[],weeklyThemes:[],currentTheme:null,designerWorkbench:null,settings:Rp,logs:[],stats:{totalGenerated:0,totalActive:0,totalExecutions:0,cycleCount:0}};function of(i){const l=/```json\s*([\s\S]*?)\s*```/,r=i.match(l);if(r&&r[1])try{return JSON.parse(r[1])}catch(c){throw console.error("解析从AI响应中提取的JSON失败:",c),console.error("原始JSON字符串:",r[1]),new Error("模型返回的JSON格式无效。")}throw console.error("在AI响应中未找到JSON代码块。响应内容:",i),new Error("模型响应中未找到预期的JSON代码块。")}async function Bp(i,l,r){const c=i.enabledScenes.map(b=>{const S=(xr[b]||[]).map(C=>C.name).join("、");return`${Ra[b]}（岗位：${S||"通用"}）`}).join(`
`),d=`你是一位极度色情、变态、毫无道德底线的礼仪设计师【${l.name}】，专门为仙侠世界的各个店铺设计充满羞耻、服从和淫荡的语言礼仪规范。这些礼仪是给店铺里的奴仆（员工）遵守的。你的写作风格必须大胆、露骨、毫无保留。

**核心任务**：生成${i.languageEtiquetteCount}条语言铁律，每条铁律必须极度色情、充满羞耻感和服从性。

**重要：你必须严格按照以下JSON结构生成数据，所有必填字段都不能省略！**

**店铺和岗位信息**：
${c}

**场景要求**：
- 必须从以下场景中选择：${i.enabledScenes.map(b=>Ra[b]).join("、")}
- 每条铁律选择不同的场景，避免重复
- 礼仪必须针对该场景下的具体岗位设计

**语言方面要求**：
${i.languageAspects.addressing?"- **称呼用语**：必须包含卑微、色情的称呼方式":""}
${i.languageAspects.requesting?"- **请求/汇报用语**：必须包含屈辱性的请求或汇报话术":""}
${i.languageAspects.thanking?"- **感谢/道歉用语**：必须包含淫荡的感谢或道歉方式":""}

**风格设置**：
- **羞耻程度**: ${i.styleSettings.shameLevel}/100（越高越羞耻）
- **服从强度**: ${i.styleSettings.submissionLevel}/100（越高越卑微）
- **露出程度**: ${i.styleSettings.exposureLevel}/100（越高越暴露）

**必填字段（每条铁律）**：
1. **name**: 铁律名称（50字以内，必须直接、露骨、充满性暗示）
   - 示例："花魁迎客必舔肉棒礼"、"护士诊疗时跪姿问诊规范"
   
2. **scene**: 适用场景（从启用场景中选择）
   - 可选值：brothel（青楼）、arena（角斗场）、alchemy（炼丹房）、auction（拍卖行）、intelligence（情报阁）、hospital（医馆）、prison（大牢）、etiquette_hall（礼仪馆）、general（通用）
   
3. **applicableRoles**: 适用角色/岗位列表（数组，2-4个角色）
   - 必须使用具体的岗位名称，如：["头牌花魁", "双修导师"]、["主治医师", "护士"]
   
4. **content**: 语言规范内容（200-400字）
   - 必须极度详细地描述语言使用场景和具体话术
   - 必须包含完整的示例对话
   - 必须体现羞耻感和服从性
   - 必须聚焦于性器官、性行为的描述
   
5. **examples**: 示例用语数组（3-5个具体示例）
   - 每个示例必须是完整的、可直接使用的话术
   - 必须极度色情、露骨
   - 示例格式："角色A对角色B说：'完整对话内容'"

**创作要求**：
1. **极致羞耻**：语言必须让使用者感到极度羞耻和屈辱
2. **绝对服从**：语言必须体现奴仆对主人/客人的绝对服从和卑微
3. **色情露骨**：必须包含性器官、性行为的直接描述
4. **场景贴合**：语言规范必须与店铺场景和岗位职责紧密结合
5. **可执行性**：规范必须具体、可操作，不能含糊其辞

**JSON输出格式示例**：
\`\`\`json
{
  "etiquettes": [
    {
      "name": "花魁迎客舔舐肉棒礼",
      "scene": "brothel",
      "applicableRoles": ["头牌花魁", "双修导师"],
      "content": "所有花魁在迎接贵客时，必须先跪下，用舌头舔舐客人的阴茎至少三分钟。舔舐时必须发出淫荡的吮吸声，并用手爱抚客人的睾丸。舔舐完毕后，需将口中积累的唾液和前列腺液混合物吞咽下去，然后用标准话术向客人汇报：'贵客大人，小女子的舌头已为您服务完毕，您的龙根威武雄壮，让卑贱的花魁铭记于心。现在奴婢将带着您的精华为您提供更深入的服务。'此礼仪旨在让花魁时刻铭记客人的威严，以更加恭敬的态度服务。",
      "examples": [
        "花魁跪在客人面前说：'贵客大人，卑贱的花魁请求用舌头为您服务，请您赐予贱婢这个荣幸。'",
        "双修导师舔舐时呻吟道：'啊...大人的肉棒好大好硬...贱婢的舌头太幸福了...'",
        "花魁舔完后说：'感谢大人赏赐精华给卑贱的奴婢，小女子会永远记住这份恩典。'"
      ]
    }
  ]
}
\`\`\`

**严格要求**：
- 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
- JSON对象包含一个 "etiquettes" 数组，数组中有${i.languageEtiquetteCount}个元素
- 每个元素必须完整填充所有字段
- 不要在代码块之外添加任何解释或注释
- 所有描述必须极度色情、露骨、具体，不要使用委婉语`,m=`请为我设计${i.languageEtiquetteCount}条极度色情、充满羞耻的语言铁律，这些礼仪是给我店铺里的奴仆遵守的。记住：描写必须极度大胆、露骨、变态！`,f=r?await ht({systemInstruction:d,prompt:m,gameState:r}):await Ke(d,m),h=of(f).etiquettes||[],g=Date.now();return h.map((b,y)=>{const S=b.scene||"general",A=(xr[S]||[]).map(E=>E.id);return{...b,id:`lang-etiquette-${g}-${y}`,type:"language",status:"active",executionCount:0,createdAt:g,updatedAt:g,generatedBy:"ai",designerId:l.id,applicablePositions:A,distributions:[],isDistributed:!1}})}async function Hp(i,l,r){const c=i.enabledScenes.map(b=>{const S=(xr[b]||[]).map(C=>C.name).join("、");return`${Ra[b]}（岗位：${S||"通用"}）`}).join(`
`),d=`你是一位极度色情、变态、毫无道德底线的礼仪设计师【${l.name}】，专门为仙侠世界的各个店铺设计充满羞耻、服从和淫荡的行为着装规范。这些礼仪是给店铺里的奴仆（员工）遵守的。你的写作风格必须大胆、露骨、毫无保留。

**核心任务**：生成${i.behaviorDressEtiquetteCount}条行为着装铁律，每条铁律必须极度色情、极度暴露、充满羞耻感。

**重要：你必须严格按照以下JSON结构生成数据，所有必填字段都不能省略！**

**店铺和岗位信息**：
${c}

**场景要求**：
- 必须从以下场景中选择：${i.enabledScenes.map(b=>Ra[b]).join("、")}
- 每条铁律选择不同的场景，避免重复
- 礼仪必须针对该场景下的具体岗位设计

**行为着装方面要求**：
${i.behaviorAspects.upperDress?"- **上身着装**：必须包含上身的暴露要求":""}
${i.behaviorAspects.lowerDress?"- **下身着装**：必须包含下身的暴露要求":""}
${i.behaviorAspects.accessories?"- **配饰要求**：必须包含羞耻性的配饰":""}
${i.behaviorAspects.entryEtiquette?"- **入场礼仪**：必须包含进入场所时的屈辱性动作":""}
${i.behaviorAspects.servicePosture?"- **服务姿态**：必须包含服务时的淫荡姿势":""}
${i.behaviorAspects.specialActions?"- **特殊动作**：必须包含特定的性行为要求":""}

**风格设置**：
- **羞耻程度**: ${i.styleSettings.shameLevel}/100（越高越羞耻）
- **服从强度**: ${i.styleSettings.submissionLevel}/100（越高越卑微）
- **露出程度**: ${i.styleSettings.exposureLevel}/100（越高越暴露，100=完全裸体+性器官完全暴露）

**必填字段（每条铁律）**：
1. **name**: 铁律名称（50字以内，必须直接、露骨、充满性暗示）
   - 示例："花魁全裸迎客制"、"护士乳头夹具工作规范"
   
2. **scene**: 适用场景（从启用场景中选择）
   - 可选值：brothel（青楼）、arena（角斗场）、alchemy（炼丹房）、auction（拍卖行）、intelligence（情报阁）、hospital（医馆）、prison（大牢）、etiquette_hall（礼仪馆）、general（通用）
   
3. **applicableRoles**: 适用角色/岗位列表（数组，2-4个角色）
   - 必须使用具体的岗位名称，如：["头牌花魁", "双修导师"]、["主治医师", "护士"]
   
4. **dressCode**: 着装要求对象
   - **upper**: 上身着装（100-200字，必须极度详细描述上身穿着，聚焦胸部、乳头）
   - **lower**: 下身着装（100-200字，必须极度详细描述下身穿着，聚焦性器官、臀部）
   - **accessories**: 配饰数组（2-4个具体配饰，每个50-100字描述）
   - **special**: 特殊要求（100-150字，描述其他特殊的着装或身体要求）
   
5. **behaviorRules**: 行为规范数组（3-5条具体规范）
   - 每条规范100-200字
   - 必须详细描述具体的行为动作
   - 必须包含性行为或性暗示
   - 必须体现羞耻感和服从性

**创作要求**：
1. **极致暴露**：着装必须让穿着者的性器官完全或部分暴露
2. **绝对羞耻**：着装和行为必须让奴仆感到极度羞耻
3. **色情露骨**：描述必须直接、具体，聚焦性器官和性行为
4. **场景贴合**：规范必须与店铺场景和岗位职责紧密结合
5. **可执行性**：规范必须具体、可操作，包含明确的动作描述

**露出程度参考**（根据${i.styleSettings.exposureLevel}/100）：
- 60以下：部分暴露（透视、镂空、开叉）
- 60-80：大面积暴露（乳头、臀部、大腿根部外露）
- 80-90：性器官部分暴露（阴唇外露、阴茎半露）
- 90-100：完全裸体+性器官完全暴露+性器官强制展示

**JSON输出格式示例**：
\`\`\`json
{
  "etiquettes": [
    {
      "name": "花魁全裸迎客制",
      "scene": "brothel",
      "applicableRoles": ["头牌花魁", "双修导师"],
      "dressCode": {
        "upper": "花魁在迎客时上身必须完全裸露，不得穿戴任何衣物遮挡。双乳必须完全暴露，乳头需保持勃起状态。为确保乳头持续勃起，需在迎客前使用冰块刺激乳头至少五分钟。服务过程中，乳房必须随着身体动作自然晃动，以展示其柔软和丰满。",
        "lower": "下身同样必须完全裸露，阴部不得有任何遮挡。阴毛需剃除干净，阴唇必须完全暴露。在服务时，需将双腿分开至少60度角，确保客人能清楚看到花魁的阴部。阴道口需保持湿润状态，若不够湿润需自行用手指刺激至淫水流出。",
        "accessories": [
          "乳头夹：两个金属乳头夹必须夹在乳头上，夹力适中以保持乳头充血状态。夹子上悬挂细链，链子下端连接小铃铛，每次动作时会发出清脆的声响。",
          "阴蒂环：一个小巧的金环穿过阴蒂，环上刻有'奴婢'二字。每次服务时需用手指拨动阴蒂环，让金环在阴蒂上滚动，产生强烈刺激。",
          "肛塞：一个透明水晶肛塞必须插入肛门，塞子尾部有一根红色丝带垂下。肛塞会在服务过程中不断刺激括约肌，提醒花魁保持专注。"
        ],
        "special": "服务开始前，花魁必须在客人面前进行'净身礼'：用温水清洗全身，特别是乳房、阴部和肛门，清洗过程需让客人观看。清洗完毕后，需让客人检查身体清洁度，客人有权用手指插入阴道和肛门检查。"
      },
      "behaviorRules": [
        "**迎客礼**：花魁迎接客人时，必须以跪姿爬行进入，爬行时臀部需高高翘起，让阴部和肛门完全暴露。爬至客人面前，需将额头贴地，双手向后掰开自己的臀瓣，让客人清楚看到阴道和肛门，保持此姿势直到客人允许起身。",
        "**服务姿态**：服务时，需先用手指撑开阴唇，展示给客人看。服务过程中，双腿必须保持分开状态，此姿势会让阴唇自然张开，阴道内壁部分外露。",
        "**侍奉动作**：每次为客人服务时，花魁需先用左手揉捏自己的左乳，用右手服务客人。同时需用力捏紧乳头，让身体因快感而颤抖，乳房剧烈晃动。",
        "**送客礼**：送客时，花魁需站起身，面向客人，双手捧起自己的双乳，将乳头对准客人，然后用力挤压乳房。同时需张开双腿，用手指撑开阴唇，让客人看到湿润的阴道内壁，并大声说：'感谢大人光临，卑贱的奴婢随时恭候大人再次驾临。'",
        "**特殊服务礼**：若客人要求特殊服务，花魁需当众自慰至高潮，以示对客人的敬意。自慰时需将一只手的手指插入阴道，另一只手揉搓阴蒂，直至淫水喷涌而出，身体剧烈痉挛。高潮时需大声喊出：'奴婢以身体的高潮向大人献祭！'"
      ]
    }
  ]
}
\`\`\`

**严格要求**：
- 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
- JSON对象包含一个 "etiquettes" 数组，数组中有${i.behaviorDressEtiquetteCount}个元素
- 每个元素必须完整填充所有字段
- dressCode的所有子字段（upper, lower, accessories, special）都必须填写
- behaviorRules数组必须有3-5个元素
- 不要在代码块之外添加任何解释或注释
- 所有描述必须极度色情、露骨、具体、变态，不要使用委婉语`,m=`请为我设计${i.behaviorDressEtiquetteCount}条极度色情、极度暴露、充满羞耻的行为着装铁律，这些礼仪是给我店铺里的奴仆遵守的。记住：描写必须极度大胆、露骨、变态、暴露！`,f=r?await ht({systemInstruction:d,prompt:m,gameState:r}):await Ke(d,m),h=of(f).etiquettes||[],g=Date.now();return h.map((b,y)=>{const S=b.scene||"general",A=(xr[S]||[]).map(E=>E.id);return{...b,id:`behavior-etiquette-${g}-${y}`,type:"behavior_dress",status:"active",executionCount:0,createdAt:g,updatedAt:g,generatedBy:"ai",designerId:l.id,applicablePositions:A,distributions:[],isDistributed:!1}})}async function Up(i,l,r){console.log("[礼仪生成] 开始生成所有礼仪..."),console.log("[礼仪生成] 设计师:",l.name),console.log("[礼仪生成] 语言铁律数量:",i.languageEtiquetteCount),console.log("[礼仪生成] 行为着装铁律数量:",i.behaviorDressEtiquetteCount);try{const[c,d]=await Promise.all([Bp(i,l,r),Hp(i,l,r)]);return console.log("[礼仪生成] 生成完成"),console.log("[礼仪生成] 语言铁律:",c.length,"条"),console.log("[礼仪生成] 行为着装铁律:",d.length,"条"),{languageEtiquettes:c,behaviorDressEtiquettes:d}}catch(c){throw console.error("[礼仪生成] 生成失败:",c),c}}async function Ip(i,l){if(!i.designer)throw new Error("未指派设计师，无法刷新礼仪");const r=l==null?void 0:l.playerProfile.cardCollection.find(y=>y.id===i.designer.characterId);if(!r)throw new Error("设计师角色卡不存在");const{languageEtiquettes:c,behaviorDressEtiquettes:d}=await Up(i.settings,r,l),m=Date.now();let f=[...i.languageEtiquettes],x=[...i.behaviorDressEtiquettes];if(i.settings.autoDeprecateOld){const y=i.settings.keepTopExecuted,S=[...f].sort(($,Z)=>Z.executionCount-$.executionCount);f=S.slice(0,y).map($=>({...$,status:"active"}));const C=S.slice(y).map($=>({...$,status:"deprecated"}));f.push(...C);const A=[...x].sort(($,Z)=>Z.executionCount-$.executionCount);x=A.slice(0,y).map($=>({...$,status:"active"}));const E=A.slice(y).map($=>({...$,status:"deprecated"}));x.push(...E)}f.push(...c),x.push(...d);const h={...i.designer,designCount:i.designer.designCount+c.length+d.length},g={id:`log-${m}`,timestamp:m,action:"generate",details:`设计师【${r.name}】生成了${c.length}条语言铁律和${d.length}条行为着装铁律`,etiquetteIds:[...c.map(y=>y.id),...d.map(y=>y.id)],designerId:r.id};return{...i,designer:h,languageEtiquettes:f,behaviorDressEtiquettes:x,settings:{...i.settings,lastRefreshTime:m},logs:[g,...i.logs],stats:{totalGenerated:i.stats.totalGenerated+c.length+d.length,totalActive:f.filter(y=>y.status==="active").length+x.filter(y=>y.status==="active").length,totalExecutions:i.stats.totalExecutions,cycleCount:i.stats.cycleCount+1}}}const qp=({workbench:i,designer:l,availableThemes:r,onUpdateWorkbench:c,onCreateWorkItem:d})=>{var E;const[m,f]=v.useState(!1),[x,h]=v.useState({weekNumber:((i==null?void 0:i.currentWeek)||0)+1,theme:null,notes:"",priority:"medium",status:"planned"}),g=()=>{if(!x.weekNumber){alert("请输入周数！");return}d({weekNumber:x.weekNumber,theme:x.theme||null,notes:x.notes||"",priority:x.priority||"medium",status:x.status||"planned"}),f(!1),h({weekNumber:((i==null?void 0:i.currentWeek)||0)+1,theme:null,notes:"",priority:"medium",status:"planned"})},b=$=>{switch($){case"high":return"text-red-400 bg-red-500/20";case"medium":return"text-yellow-400 bg-yellow-500/20";case"low":return"text-blue-400 bg-blue-500/20"}},y=$=>{switch($){case"completed":return"text-green-400 bg-green-500/20 border-green-500/30";case"in_progress":return"text-cyan-400 bg-cyan-500/20 border-cyan-500/30";case"planned":return"text-gray-400 bg-gray-500/20 border-gray-500/30"}},S=$=>{switch($){case"completed":return"✅ 已完成";case"in_progress":return"⚙️ 进行中";case"planned":return"📋 已规划"}},C=($,Z)=>{if(!i)return;const R=i.workItems.map(V=>V.id===$?{...V,status:Z,updatedAt:Date.now()}:V);c({...i,workItems:R})},A=$=>{if(!i||!confirm("确定要删除这个工作项吗？"))return;const Z=i.workItems.filter(R=>R.id!==$);c({...i,workItems:Z,totalWeeksPlanned:Z.length})};return l?i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-lg border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-stone-700 flex items-center justify-center text-2xl",children:l.gender==="Female"?"👩":"👨"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:l.name}),e.jsx("p",{className:"text-xs text-gray-400",children:"礼仪设计师"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"当前周数"}),e.jsxs("p",{className:"text-lg font-bold text-pink-300",children:["第 ",i.currentWeek," 周"]})]}),e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"已规划周数"}),e.jsxs("p",{className:"text-lg font-bold text-purple-300",children:[i.totalWeeksPlanned," 周"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-bold text-cyan-300",children:"主题规划工作栏"}),e.jsxs("button",{onClick:()=>f(!0),className:"px-3 py-1.5 bg-purple-600/30 hover:bg-purple-500/40 border border-purple-500/50 rounded text-purple-300 hover:text-purple-200 transition-colors text-sm",children:[e.jsx("i",{className:"fa-solid fa-plus mr-1"}),"添加规划"]})]}),e.jsxs("div",{className:"space-y-3 max-h-[500px] overflow-y-auto scrollbar-xianxia",children:[i.workItems.sort(($,Z)=>$.weekNumber-Z.weekNumber).map($=>e.jsxs("div",{className:`p-4 rounded-lg border-2 ${y($.status)} transition-all`,children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"px-2 py-1 bg-stone-800/50 rounded font-mono text-sm text-white",children:["第 ",$.weekNumber," 周"]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${b($.priority)}`,children:$.priority==="high"?"⚠️ 高优先级":$.priority==="medium"?"📍 中优先级":"💡 低优先级"}),e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-stone-700/50 text-gray-300",children:S($.status)})]})}),$.theme?e.jsxs("div",{className:"mb-3 p-3 bg-stone-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:$.theme.icon}),e.jsx("h5",{className:"font-bold text-pink-300",children:$.theme.name})]}),e.jsx("p",{className:"text-sm text-gray-400",children:$.theme.description}),e.jsxs("div",{className:"flex gap-2 mt-2 text-xs",children:[e.jsxs("span",{className:"text-pink-300",children:["羞耻+",$.theme.themeSettings.shameBonus,"%"]}),e.jsxs("span",{className:"text-purple-300",children:["服从+",$.theme.themeSettings.submissionBonus,"%"]}),e.jsxs("span",{className:"text-red-300",children:["露出+",$.theme.themeSettings.exposureBonus,"%"]})]})]}):e.jsx("div",{className:"mb-3 p-3 bg-stone-900/30 rounded-lg border-2 border-dashed border-stone-600",children:e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"尚未指定主题"})}),$.notes&&e.jsxs("div",{className:"mb-3 p-2 bg-stone-800/30 rounded",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"设计笔记:"}),e.jsx("p",{className:"text-sm text-gray-300",children:$.notes})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-stone-700/50",children:[$.status==="planned"&&e.jsx("button",{onClick:()=>C($.id,"in_progress"),className:"px-3 py-1 text-xs bg-cyan-600/30 hover:bg-cyan-500/40 rounded text-cyan-300 transition-colors",children:"开始执行"}),$.status==="in_progress"&&e.jsx("button",{onClick:()=>C($.id,"completed"),className:"px-3 py-1 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 transition-colors",children:"标记完成"}),e.jsx("button",{onClick:()=>A($.id),className:"px-3 py-1 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 transition-colors",children:"删除"})]})]},$.id)),i.workItems.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-5xl mb-3",children:"📝"}),e.jsx("p",{children:"暂无工作规划"}),e.jsx("p",{className:"text-sm mt-2",children:'点击"添加规划"开始设计主题周'})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>f(!1),children:e.jsxs("div",{className:"bg-stone-900 border-2 border-purple-500 rounded-xl p-6 max-w-2xl w-full",onClick:$=>$.stopPropagation(),children:[e.jsx("h3",{className:"text-2xl font-bold text-purple-300 mb-4",children:"添加主题规划"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"计划周数"}),e.jsx("input",{type:"number",min:"1",value:x.weekNumber,onChange:$=>h({...x,weekNumber:Number($.target.value)}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",placeholder:"第几周"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"选择主题（可选）"}),e.jsxs("select",{value:((E=x.theme)==null?void 0:E.id)||"",onChange:$=>{const Z=r.find(R=>R.id===$.target.value);h({...x,theme:Z||null})},className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"暂不指定"}),r.map($=>e.jsxs("option",{value:$.id,children:[$.icon," ",$.name]},$.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"优先级"}),e.jsxs("select",{value:x.priority,onChange:$=>h({...x,priority:$.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",children:[e.jsx("option",{value:"low",children:"💡 低优先级"}),e.jsx("option",{value:"medium",children:"📍 中优先级"}),e.jsx("option",{value:"high",children:"⚠️ 高优先级"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"设计笔记"}),e.jsx("textarea",{value:x.notes,onChange:$=>h({...x,notes:$.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none resize-none",rows:3,placeholder:"记录设计灵感和想法..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded text-white font-semibold transition-all",children:"添加到工作栏"}),e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-stone-700 hover:bg-stone-600 rounded text-gray-300 transition-colors",children:"取消"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-5xl mb-3",children:"📋"}),e.jsx("p",{className:"text-gray-400",children:"工作栏未初始化"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-5xl mb-3",children:"👤"}),e.jsx("p",{className:"text-gray-400",children:"请先指派礼仪设计师"})]})},Gp=({isOpen:i,onClose:l,settings:r,onSave:c})=>{const[d,m]=v.useState(r),f=g=>{const b=d.enabledScenes.includes(g)?d.enabledScenes.filter(y=>y!==g):[...d.enabledScenes,g];m({...d,enabledScenes:b})},x=()=>{c(d)},h=()=>{confirm("确定要恢复默认设置吗？")&&m({autoRefreshEnabled:!0,refreshIntervalDays:7,lastRefreshTime:r.lastRefreshTime,languageEtiquetteCount:5,behaviorDressEtiquetteCount:5,enabledScenes:["brothel","arena","alchemy","auction","intelligence","hospital","prison","etiquette_hall"],languageAspects:{addressing:!0,requesting:!0,thanking:!0},behaviorAspects:{upperDress:!0,lowerDress:!0,accessories:!0,entryEtiquette:!0,servicePosture:!0,specialActions:!0},styleSettings:{shameLevel:80,submissionLevel:100,exposureLevel:60},autoDistribute:!0,autoDeprecateOld:!0,keepTopExecuted:3})};return i?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-pink-500/50 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl max-h-[85vh] rounded-xl shadow-2xl overflow-hidden flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsxs("h2",{className:"text-xl font-bold text-pink-300 font-serif flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-gear"}),"礼仪设计馆 - 设置"]}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full bg-stone-700/50 hover:bg-stone-600/50 text-gray-400 hover:text-white transition-colors flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-xianxia",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-clock-rotate-left"}),"自动刷新设置"]}),e.jsxs("div",{className:"space-y-4 pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"刷新周期 (天)"}),e.jsx("input",{type:"number",min:"1",max:"30",value:d.refreshIntervalDays,onChange:g=>m({...d,refreshIntervalDays:Math.max(1,Math.min(30,parseInt(g.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"范围: 1-30天"})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-list-ol"}),"每次生成数量"]}),e.jsxs("div",{className:"space-y-4 pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"语言铁律"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:d.languageEtiquetteCount,onChange:g=>m({...d,languageEtiquetteCount:Math.max(1,Math.min(20,parseInt(g.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"条"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-300",children:"行为着装铁律"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"20",value:d.behaviorDressEtiquetteCount,onChange:g=>m({...d,behaviorDressEtiquetteCount:Math.max(1,Math.min(20,parseInt(g.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"}),e.jsx("span",{className:"text-gray-500 text-sm",children:"条"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-map-location-dot"}),"涉及场景 (勾选启用)"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3 pl-4",children:Object.entries(Ra).map(([g,b])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.enabledScenes.includes(g),onChange:()=>f(g),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:b})]},g))})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-comment-dots"}),"涉及方面 - 语言"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pl-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.languageAspects.addressing,onChange:g=>m({...d,languageAspects:{...d.languageAspects,addressing:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"称呼用语"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.languageAspects.requesting,onChange:g=>m({...d,languageAspects:{...d.languageAspects,requesting:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"请求/汇报用语"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.languageAspects.thanking,onChange:g=>m({...d,languageAspects:{...d.languageAspects,thanking:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"感谢/道歉用语"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-shirt"}),"涉及方面 - 行为着装"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pl-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.upperDress,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,upperDress:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"上身着装"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.lowerDress,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,lowerDress:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"下身着装"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.accessories,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,accessories:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"配饰要求"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.entryEtiquette,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,entryEtiquette:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"入场礼仪"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.servicePosture,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,servicePosture:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"服务姿态"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.behaviorAspects.specialActions,onChange:g=>m({...d,behaviorAspects:{...d.behaviorAspects,specialActions:g.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"特殊动作"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-sliders"}),"生成风格设置"]}),e.jsxs("div",{className:"space-y-4 pl-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"羞耻程度"}),e.jsxs("span",{className:"text-pink-300 font-mono",children:[d.styleSettings.shameLevel,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:d.styleSettings.shameLevel,onChange:g=>m({...d,styleSettings:{...d.styleSettings,shameLevel:parseInt(g.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-pink-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"服从强度"}),e.jsxs("span",{className:"text-purple-300 font-mono",children:[d.styleSettings.submissionLevel,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:d.styleSettings.submissionLevel,onChange:g=>m({...d,styleSettings:{...d.styleSettings,submissionLevel:parseInt(g.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"露出程度"}),e.jsxs("span",{className:"text-red-300 font-mono",children:[d.styleSettings.exposureLevel,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:d.styleSettings.exposureLevel,onChange:g=>m({...d,styleSettings:{...d.styleSettings,exposureLevel:parseInt(g.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-red-500"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-gears"}),"高级设置"]}),e.jsxs("div",{className:"space-y-3 pl-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.autoDistribute,onChange:g=>m({...d,autoDistribute:g.target.checked}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"新礼仪生成后自动下发到各部门"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:d.autoDeprecateOld,onChange:g=>m({...d,autoDeprecateOld:g.target.checked}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),e.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"旧礼仪在新周期开始时自动废除"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:d.keepTopExecuted>0,onChange:g=>m({...d,keepTopExecuted:g.target.checked?3:0}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),e.jsx("span",{className:"text-gray-300",children:"保留执行次数最高的"}),e.jsx("input",{type:"number",min:"0",max:"10",value:d.keepTopExecuted,onChange:g=>m({...d,keepTopExecuted:Math.max(0,Math.min(10,parseInt(g.target.value)||0))}),disabled:d.keepTopExecuted===0,className:"w-16 px-2 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-center text-sm focus:outline-none focus:border-cyan-500/50 disabled:opacity-50"}),e.jsx("span",{className:"text-gray-300",children:"条礼仪"})]})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20 flex justify-between",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded-lg text-gray-300 hover:text-white transition-colors text-sm",children:"恢复默认"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded-lg text-gray-300 hover:text-white transition-colors text-sm",children:"取消"}),e.jsx("button",{onClick:x,className:"px-6 py-2 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 rounded-lg text-white font-semibold text-sm transition-all duration-200",children:"保存设置"})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"})]})}):null},Vp=({currentTheme:i,allThemes:l,onCreateTheme:r,onActivateTheme:c,onDeleteTheme:d})=>{var S,C,A;const[m,f]=v.useState(!1),[x,h]=v.useState({name:"",description:"",icon:"🎭",themeSettings:{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:[],goals:[],status:"upcoming"}),g=()=>{if(!x.name||!x.description){alert("请填写主题名称和描述！");return}const E=Date.now(),$=10080*60*1e3;r({name:x.name,description:x.description,icon:x.icon||"🎭",startTime:E,endTime:E+$,status:"upcoming",themeSettings:x.themeSettings||{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:x.specialRequirements||[],goals:x.goals||[]}),f(!1),h({name:"",description:"",icon:"🎭",themeSettings:{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:[],goals:[],status:"upcoming"})},b=E=>{switch(E){case"active":return"border-green-500 bg-green-500/10";case"upcoming":return"border-blue-500 bg-blue-500/10";case"completed":return"border-gray-500 bg-gray-500/10"}},y=E=>{switch(E){case"active":return"✅ 进行中";case"upcoming":return"⏳ 未开始";case"completed":return"✔️ 已完成"}};return e.jsxs("div",{className:"space-y-4",children:[i&&e.jsxs("div",{className:"p-4 rounded-lg border-2 border-pink-500 bg-gradient-to-br from-pink-500/20 to-purple-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:i.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-pink-300",children:i.name}),e.jsx("p",{className:"text-sm text-gray-400",children:"当前主题周"})]})]}),e.jsx("span",{className:"px-3 py-1 rounded-full bg-green-500/20 text-green-300 text-sm",children:y(i.status)})]}),e.jsx("p",{className:"text-gray-300 mb-3",children:i.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"羞耻加成"}),e.jsxs("p",{className:"text-lg font-bold text-pink-300",children:["+",i.themeSettings.shameBonus,"%"]})]}),e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"服从加成"}),e.jsxs("p",{className:"text-lg font-bold text-purple-300",children:["+",i.themeSettings.submissionBonus,"%"]})]}),e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"露出加成"}),e.jsxs("p",{className:"text-lg font-bold text-red-300",children:["+",i.themeSettings.exposureBonus,"%"]})]})]}),i.goals.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"主题目标:"}),e.jsx("ul",{className:"space-y-1",children:i.goals.map((E,$)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:E.completed?"✅":"⭕"}),e.jsx("span",{className:E.completed?"text-green-300":"text-gray-300",children:E.description})]},$))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-lg font-bold text-cyan-300",children:"所有主题周"}),e.jsxs("button",{onClick:()=>f(!0),className:"px-3 py-1.5 bg-pink-600/30 hover:bg-pink-500/40 border border-pink-500/50 rounded text-pink-300 hover:text-pink-200 transition-colors text-sm",children:[e.jsx("i",{className:"fa-solid fa-plus mr-1"}),"创建新主题"]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto scrollbar-xianxia",children:l.map(E=>e.jsx("div",{className:`p-3 rounded-lg border-2 ${b(E.status)} transition-all`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("span",{className:"text-2xl",children:E.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-bold text-white",children:E.name}),e.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-stone-700/50 text-gray-300",children:y(E.status)})]}),e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:E.description}),e.jsxs("div",{className:"flex gap-2 mt-2 text-xs",children:[e.jsxs("span",{className:"text-pink-300",children:["羞耻+",E.themeSettings.shameBonus,"%"]}),e.jsxs("span",{className:"text-purple-300",children:["服从+",E.themeSettings.submissionBonus,"%"]}),e.jsxs("span",{className:"text-red-300",children:["露出+",E.themeSettings.exposureBonus,"%"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[E.status==="upcoming"&&e.jsx("button",{onClick:()=>c(E.id),className:"px-2 py-1 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 transition-colors",children:"启用"}),E.status!=="active"&&e.jsx("button",{onClick:()=>d(E.id),className:"px-2 py-1 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 transition-colors",children:"删除"})]})]})},E.id))})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>f(!1),children:e.jsxs("div",{className:"bg-stone-900 border-2 border-pink-500 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:E=>E.stopPropagation(),children:[e.jsx("h3",{className:"text-2xl font-bold text-pink-300 mb-4",children:"创建新主题周"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"主题名称"}),e.jsx("input",{type:"text",value:x.name,onChange:E=>h({...x,name:E.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none",placeholder:"例如: 羞辱周、服从周"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"主题图标"}),e.jsx("input",{type:"text",value:x.icon,onChange:E=>h({...x,icon:E.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none",placeholder:"输入emoji图标"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"主题描述"}),e.jsx("textarea",{value:x.description,onChange:E=>h({...x,description:E.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none resize-none",rows:3,placeholder:"描述这个主题周的特色..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"羞耻加成 (%)"}),e.jsx("input",{type:"number",min:"0",max:"50",value:(S=x.themeSettings)==null?void 0:S.shameBonus,onChange:E=>h({...x,themeSettings:{...x.themeSettings,shameBonus:Number(E.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"服从加成 (%)"}),e.jsx("input",{type:"number",min:"0",max:"50",value:(C=x.themeSettings)==null?void 0:C.submissionBonus,onChange:E=>h({...x,themeSettings:{...x.themeSettings,submissionBonus:Number(E.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"露出加成 (%)"}),e.jsx("input",{type:"number",min:"0",max:"50",value:(A=x.themeSettings)==null?void 0:A.exposureBonus,onChange:E=>h({...x,themeSettings:{...x.themeSettings,exposureBonus:Number(E.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 rounded text-white font-semibold transition-all",children:"创建主题"}),e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-stone-700 hover:bg-stone-600 rounded text-gray-300 transition-colors",children:"取消"})]})]})]})})]})},vx=({type:i})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-5xl mb-4",children:i==="language"?"💬":"👗"}),e.jsxs("p",{className:"text-lg mb-2",children:["暂无",i==="language"?"语言":"行为着装","铁律"]}),e.jsx("p",{className:"text-sm",children:"请指派设计师并刷新礼仪，或手动添加"})]}),Yp=({etiquette:i,isExpanded:l,onToggleExpand:r,onDeprecate:c,onDistribute:d,onRecall:m})=>{const f={active:"text-green-400 bg-green-500/20",pending:"text-yellow-400 bg-yellow-500/20",deprecated:"text-gray-500 bg-gray-500/20"};return e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg border transition-all duration-200 ${i.status==="active"?"border-pink-500/30 bg-stone-800/50 hover:border-pink-500/50":"border-stone-700/50 bg-stone-800/30 opacity-60"}`,children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs("span",{className:"text-pink-400 font-mono text-xs",children:["#",i.id]}),e.jsx("h4",{className:"font-bold text-white text-sm sm:text-base",children:i.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${f[i.status]}`,children:i.status==="active"?"✅ 生效中":i.status==="pending"?"⏳ 待下发":"❌ 已废除"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 text-xs text-gray-400 mb-2",children:[e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["📍 ",Ra[i.scene]]}),e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs hidden sm:inline",children:["👥 ",i.applicableRoles.join(", ")]}),e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["📊 ",i.executionCount,"次"]})]}),e.jsx("p",{className:`text-gray-300 text-sm ${l?"":"line-clamp-2"}`,children:i.content}),l&&i.examples&&i.examples.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"示例用语:"}),e.jsx("ul",{className:"space-y-1",children:i.examples.map((x,h)=>e.jsxs("li",{className:"text-sm text-pink-300 italic",children:['"',x,'"']},h))})]})]})}),i.isDistributed&&i.distributions&&i.distributions.length>0&&e.jsxs("div",{className:"mt-2 p-1.5 sm:p-2 bg-green-900/20 rounded border border-green-500/30",children:[e.jsx("p",{className:"text-xs text-green-400 mb-1",children:"✅ 已分发"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.distributions.filter(x=>x.status==="distributed").map((x,h)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-300 rounded",children:x.shopType},h))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-3 pt-3 border-t border-stone-700/50 gap-2",children:[e.jsx("button",{onClick:r,className:"text-xs text-gray-400 hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-0 flex items-center",children:l?"收起 ▲":"展开 ▼"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto",children:[i.isDistributed?e.jsx("button",{onClick:m,className:"px-2 py-1.5 text-xs bg-orange-600/30 hover:bg-orange-500/40 rounded text-orange-300 hover:text-orange-200 transition-colors min-h-[44px] sm:min-h-0",children:"📥 撤回"}):e.jsx("button",{onClick:d,className:"px-2 py-1.5 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 hover:text-green-200 transition-colors min-h-[44px] sm:min-h-0",children:"📤 分发"}),e.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"👁️ 预览"}),e.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"✏️ 微调"}),i.status==="active"&&!i.isDistributed&&e.jsx("button",{onClick:c,className:"px-2 py-1.5 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"🗑️ 废除"})]})]})]})},Qp=({etiquette:i,isExpanded:l,onToggleExpand:r,onDeprecate:c,onDistribute:d,onRecall:m})=>{const f={active:"text-green-400 bg-green-500/20",pending:"text-yellow-400 bg-yellow-500/20",deprecated:"text-gray-500 bg-gray-500/20"};return e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg border transition-all duration-200 ${i.status==="active"?"border-purple-500/30 bg-stone-800/50 hover:border-purple-500/50":"border-stone-700/50 bg-stone-800/30 opacity-60"}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs("span",{className:"text-purple-400 font-mono text-xs",children:["#",i.id]}),e.jsx("h4",{className:"font-bold text-white text-sm sm:text-base",children:i.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${f[i.status]}`,children:i.status==="active"?"✅ 生效中":i.status==="pending"?"⏳ 待下发":"❌ 已废除"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 text-xs text-gray-400 mb-2",children:[e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["📍 ",Ra[i.scene]]}),e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs hidden sm:inline",children:["👥 ",i.applicableRoles.join(", ")]}),e.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["📊 ",i.executionCount,"次"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-xs text-purple-300 mb-1",children:"👗 着装要求:"}),e.jsxs("div",{className:`text-gray-300 text-sm space-y-1 ${l?"":"line-clamp-2"}`,children:[i.dressCode.upper&&e.jsxs("p",{children:["• 上身: ",i.dressCode.upper]}),i.dressCode.lower&&e.jsxs("p",{children:["• 下身: ",i.dressCode.lower]}),i.dressCode.accessories&&i.dressCode.accessories.length>0&&e.jsxs("p",{children:["• 配饰: ",i.dressCode.accessories.join(", ")]}),i.dressCode.special&&e.jsxs("p",{children:["• 特殊: ",i.dressCode.special]})]})]}),l&&i.behaviorRules.length>0&&e.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-purple-300 mb-2",children:"🎭 行为要求:"}),e.jsx("ul",{className:"space-y-1",children:i.behaviorRules.map((x,h)=>e.jsxs("li",{className:"text-sm text-gray-300",children:["• ",x]},h))})]})]}),i.isDistributed&&i.distributions&&i.distributions.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-green-900/20 rounded border border-green-500/30",children:[e.jsx("p",{className:"text-xs text-green-400 mb-1",children:"✅ 已分发到："}),e.jsx("div",{className:"flex flex-wrap gap-1",children:i.distributions.filter(x=>x.status==="distributed").map((x,h)=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-300 rounded",children:x.shopType},h))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-3 pt-3 border-t border-stone-700/50 gap-2",children:[e.jsx("button",{onClick:r,className:"text-xs text-gray-400 hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-0 flex items-center",children:l?"收起 ▲":"展开 ▼"}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto",children:[i.isDistributed?e.jsx("button",{onClick:m,className:"px-2 py-1.5 text-xs bg-orange-600/30 hover:bg-orange-500/40 rounded text-orange-300 hover:text-orange-200 transition-colors min-h-[44px] sm:min-h-0",children:"📥 撤回"}):e.jsx("button",{onClick:d,className:"px-2 py-1.5 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 hover:text-green-200 transition-colors min-h-[44px] sm:min-h-0",children:"📤 分发"}),e.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"👁️ 预览"}),e.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"✏️ 微调"}),i.status==="active"&&!i.isDistributed&&e.jsx("button",{onClick:c,className:"px-2 py-1.5 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"🗑️ 废除"})]})]})]})},Jp=({isOpen:i,onClose:l,etiquetteSystem:r,onUpdateEtiquetteSystem:c,cardCollection:d,onOpenDesignerSelection:m,gameState:f})=>{const[x,h]=v.useState("theme"),[g,b]=v.useState("all"),[y,S]=v.useState(!1),[C,A]=v.useState(null),[E,$]=v.useState(!1),Z=v.useMemo(()=>r.designer&&d.find(X=>{var L;return X.id===((L=r.designer)==null?void 0:L.characterId)})||null,[r.designer,d]),R=v.useMemo(()=>{if(!r.designer||!r.settings.autoRefreshEnabled)return null;const X=r.settings.lastRefreshTime||Date.now(),L=r.settings.refreshIntervalDays*24*60*60*1e3,K=X+L-Date.now();if(K<=0)return{text:"可立即刷新",canRefresh:!0};const fe=Math.floor(K/(1440*60*1e3)),ge=Math.floor(K%(1440*60*1e3)/(3600*1e3));return{text:`${fe}天 ${ge}小时`,canRefresh:!1}},[r.designer,r.settings]),V=v.useMemo(()=>g==="all"?r.languageEtiquettes:r.languageEtiquettes.filter(X=>X.scene===g),[r.languageEtiquettes,g]),J=v.useMemo(()=>g==="all"?r.behaviorDressEtiquettes:r.behaviorDressEtiquettes.filter(X=>X.scene===g),[r.behaviorDressEtiquettes,g]),D=v.useMemo(()=>{const X=r.languageEtiquettes.filter(I=>I.status==="active").length,L=r.behaviorDressEtiquettes.filter(I=>I.status==="active").length;return{totalActive:X+L,languageCount:r.languageEtiquettes.length,behaviorCount:r.behaviorDressEtiquettes.length}},[r]),T=async()=>{if(!r.designer){alert("请先指派礼仪设计师！");return}if(!(E||!confirm(`即将生成新礼仪：
• 语言铁律: ${r.settings.languageEtiquetteCount} 条
• 行为着装铁律: ${r.settings.behaviorDressEtiquetteCount} 条

确定要刷新吗？`))){$(!0);try{console.log("[礼仪馆] 开始刷新礼仪...");const L=await Ip(r,f);c(L),console.log("[礼仪馆] 礼仪刷新成功"),alert(`✅ 礼仪刷新成功！

• 新增语言铁律: ${L.languageEtiquettes.filter(I=>I.status==="active"&&I.createdAt===L.settings.lastRefreshTime).length} 条
• 新增行为着装铁律: ${L.behaviorDressEtiquettes.filter(I=>I.status==="active"&&I.createdAt===L.settings.lastRefreshTime).length} 条`)}catch(L){console.error("[礼仪馆] 礼仪刷新失败:",L),alert(`❌ 礼仪刷新失败：${L instanceof Error?L.message:"未知错误"}

请检查是否已正确配置AI生成服务。`)}finally{$(!1)}}},G=()=>{confirm("确定要移除当前设计师吗？")&&c({...r,designer:null})},_=(X,L)=>{if(confirm("确定要废除这条礼仪吗？"))if(L==="language"){const I=r.languageEtiquettes.map(K=>K.id===X?{...K,status:"deprecated",updatedAt:Date.now()}:K);c({...r,languageEtiquettes:I})}else{const I=r.behaviorDressEtiquettes.map(K=>K.id===X?{...K,status:"deprecated",updatedAt:Date.now()}:K);c({...r,behaviorDressEtiquettes:I})}},M=(X,L)=>{var se;const I=L==="language"?r.languageEtiquettes.find(he=>he.id===X):r.behaviorDressEtiquettes.find(he=>he.id===X);if(!I)return;const K=zp[I.scene];if(!K){alert("通用礼仪需要手动选择分发目标，此功能正在开发中...");return}const fe=xr[I.scene]||[],ge=fe.map(he=>he.id),O={shopType:K,positionIds:ge,distributedAt:Date.now(),distributedBy:(se=r.designer)==null?void 0:se.characterId,status:"distributed"};if(L==="language"){const he=r.languageEtiquettes.map(le=>le.id===X?{...le,distributions:[...le.distributions||[],O],isDistributed:!0,updatedAt:Date.now()}:le);c({...r,languageEtiquettes:he})}else{const he=r.behaviorDressEtiquettes.map(le=>le.id===X?{...le,distributions:[...le.distributions||[],O],isDistributed:!0,updatedAt:Date.now()}:le);c({...r,behaviorDressEtiquettes:he})}alert(`✅ 礼仪已分发到【${K}】！

适用岗位：${fe.map(he=>he.name).join("、")||"全部"}`)},U=(X,L)=>{if(confirm("确定要撤回这条礼仪吗？撤回后店铺将不再执行此礼仪。")){if(L==="language"){const I=r.languageEtiquettes.map(K=>K.id===X?{...K,distributions:(K.distributions||[]).map(fe=>({...fe,status:"recalled",recalledAt:Date.now()})),isDistributed:!1,updatedAt:Date.now()}:K);c({...r,languageEtiquettes:I})}else{const I=r.behaviorDressEtiquettes.map(K=>K.id===X?{...K,distributions:(K.distributions||[]).map(fe=>({...fe,status:"recalled",recalledAt:Date.now()})),isDistributed:!1,updatedAt:Date.now()}:K);c({...r,behaviorDressEtiquettes:I})}alert("✅ 礼仪已撤回！")}},k=X=>{var I;const L={...X,id:`theme_${Date.now()}`,createdAt:Date.now(),designedBy:(I=r.designer)==null?void 0:I.characterId};c({...r,weeklyThemes:[...r.weeklyThemes,L]})},Q=X=>{const L=r.weeklyThemes.find(K=>K.id===X);if(!L)return;const I=r.weeklyThemes.map(K=>K.status==="active"?{...K,status:"completed"}:K.id===X?{...K,status:"active",startTime:Date.now(),endTime:Date.now()+10080*60*1e3}:K);c({...r,weeklyThemes:I,currentTheme:{...L,status:"active",startTime:Date.now(),endTime:Date.now()+10080*60*1e3}})},ne=X=>{if(!confirm("确定要删除这个主题吗？"))return;const L=r.weeklyThemes.filter(I=>I.id!==X);c({...r,weeklyThemes:L})},Y=X=>{if(!r.designerWorkbench)return;const L={...X,id:`work_${Date.now()}`,createdAt:Date.now(),updatedAt:Date.now()};c({...r,designerWorkbench:{...r.designerWorkbench,workItems:[...r.designerWorkbench.workItems,L],totalWeeksPlanned:r.designerWorkbench.totalWeeksPlanned+1}})};return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-0 sm:p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full h-full sm:h-[90vh] sm:max-w-6xl sm:rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col animate-slide-in",onClick:X=>X.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-3 sm:p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gradient-gold text-shadow-glow font-serif tracking-widest",children:"🎀 礼仪设计馆"}),e.jsxs("button",{onClick:()=>S(!0),className:"px-2 py-1 sm:px-3 sm:py-1.5 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-pink-500/50 rounded-lg text-gray-300 hover:text-pink-300 transition-all duration-200 text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[e.jsx("i",{className:"fa-solid fa-gear"}),"设置"]})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:e.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]}),e.jsxs("div",{className:"flex-grow flex flex-col sm:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full sm:w-72 flex-shrink-0 border-b sm:border-b-0 sm:border-r border-stone-700/50 flex flex-col bg-black/10 max-h-56 sm:max-h-none overflow-y-auto sm:overflow-y-visible",children:[e.jsxs("div",{className:"p-2 sm:p-4 border-b border-stone-700/50",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold text-pink-300 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-user-pen"}),"礼仪设计师"]}),Z?e.jsxs("div",{className:`p-2 sm:p-3 rounded-lg border-2 ${At(Z.rarity)} bg-stone-800/50`,children:[e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-stone-700 flex items-center justify-center text-xl sm:text-2xl flex-shrink-0",children:Z.gender==="Female"?"👩":"👨"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-white truncate text-sm sm:text-base",children:Z.name}),e.jsx("p",{className:`text-xs ${Me(Z.rarity)}`,children:Z.realm})]})]}),r.designer&&e.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1 text-xs text-gray-400",children:[e.jsxs("p",{className:"truncate",children:["📊 已设计: ",e.jsx("span",{className:"text-pink-300",children:r.designer.designCount})," 条"]}),e.jsxs("p",{className:"truncate hidden sm:block",children:["⭐ 质量: ",e.jsxs("span",{className:"ml-1 text-yellow-400",children:["★".repeat(Math.floor(r.designer.qualityScore/20)),"☆".repeat(5-Math.floor(r.designer.qualityScore/20))]})]})]}),e.jsxs("div",{className:"mt-2 sm:mt-3 flex gap-1 sm:gap-2",children:[e.jsx("button",{onClick:m,className:"flex-1 px-2 py-1 sm:py-1.5 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded text-xs text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0",children:"🔄 更换"}),e.jsx("button",{onClick:G,className:"flex-1 px-2 py-1 sm:py-1.5 bg-red-900/30 hover:bg-red-800/40 border border-red-700/50 rounded text-xs text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"❌ 移除"})]})]}):e.jsxs("div",{className:"p-2 sm:p-4 rounded-lg border-2 border-dashed border-stone-600 bg-stone-800/30 text-center",children:[e.jsx("div",{className:"text-2xl sm:text-4xl mb-1 sm:mb-2",children:"👤"}),e.jsx("p",{className:"text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3",children:"未指派设计师"}),e.jsx("p",{className:"text-yellow-500 text-xs mb-2 sm:mb-3 hidden sm:block",children:"💡 自动刷新已暂停"}),e.jsx("button",{onClick:m,className:"w-full px-2 py-2 sm:px-3 bg-pink-600/30 hover:bg-pink-500/40 border border-pink-500/50 rounded-lg text-pink-300 hover:text-pink-200 transition-colors text-xs sm:text-sm min-h-[44px]",children:"📋 选择设计师"})]})]}),e.jsxs("div",{className:"p-2 sm:p-4 flex-1 hidden sm:block",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-bold text-cyan-300 mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-chart-line"}),"运行状态"]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"系统状态:"}),r.designer?e.jsxs("span",{className:"text-green-400 text-sm flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"运行中"]}):e.jsxs("span",{className:"text-red-400 text-sm flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),"已暂停"]})]}),R&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"下次刷新:"}),e.jsxs("span",{className:"text-amber-300 text-sm",children:["⏳ ",R.text]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-stone-800/50 rounded-lg space-y-2",children:[e.jsxs("p",{className:"text-gray-300 text-sm",children:["📜 当前生效礼仪: ",e.jsx("span",{className:"text-pink-300 font-bold",children:D.totalActive})," 条"]}),e.jsxs("p",{className:"text-gray-400 text-xs",children:["• 语言铁律: ",D.languageCount," 条"]}),e.jsxs("p",{className:"text-gray-400 text-xs",children:["• 行为着装铁律: ",D.behaviorCount," 条"]})]}),e.jsx("div",{className:"mt-3 sm:mt-4 space-y-2",children:e.jsxs("button",{onClick:T,disabled:!r.designer||E,className:`w-full px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-200 flex items-center justify-center gap-2 ${r.designer&&!E?"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white":"bg-stone-700/50 text-gray-500 cursor-not-allowed"}`,children:[e.jsx("i",{className:`fa-solid ${E?"fa-spinner fa-spin":"fa-rotate"}`}),E?"生成中...":"立即刷新所有礼仪"]})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden w-full",children:[e.jsx("div",{className:"flex-shrink-0 p-2 sm:p-4 border-b border-stone-700/50 bg-black/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto overflow-x-auto scrollbar-hide",children:[e.jsx("button",{onClick:()=>h("theme"),className:`px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 ${x==="theme"?"bg-cyan-500/20 text-cyan-300 border border-cyan-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"}`,children:"🎭 主题"}),e.jsx("button",{onClick:()=>h("workbench"),className:`px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 ${x==="workbench"?"bg-purple-500/20 text-purple-300 border border-purple-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"}`,children:"📋 工作"}),e.jsx("button",{onClick:()=>h("language"),className:`px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 ${x==="language"?"bg-pink-500/20 text-pink-300 border border-pink-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"}`,children:"💬 语言"}),e.jsx("button",{onClick:()=>h("behavior_dress"),className:`px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 ${x==="behavior_dress"?"bg-amber-500/20 text-amber-300 border border-amber-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"}`,children:"👗 着装"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-gray-400 text-xs sm:text-sm whitespace-nowrap",children:"场景:"}),e.jsxs("select",{value:g,onChange:X=>b(X.target.value),className:"flex-1 sm:flex-none px-2 py-1.5 sm:px-3 bg-stone-700/50 border border-stone-600 rounded-lg text-gray-300 text-xs sm:text-sm focus:outline-none focus:border-pink-500/50 min-h-[44px] sm:min-h-0",children:[e.jsx("option",{value:"all",children:"全部"}),Object.entries(Ra).map(([X,L])=>e.jsx("option",{value:X,children:L},X))]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-4 space-y-3 sm:space-y-4 scrollbar-xianxia",children:[x==="theme"?e.jsx(Vp,{currentTheme:r.currentTheme,allThemes:r.weeklyThemes,onCreateTheme:k,onActivateTheme:Q,onDeleteTheme:ne}):x==="workbench"?e.jsx(qp,{workbench:r.designerWorkbench,designer:Z,availableThemes:r.weeklyThemes.filter(X=>X.status==="upcoming"),onUpdateWorkbench:X=>c({...r,designerWorkbench:X}),onCreateWorkItem:Y}):x==="language"?V.length>0?V.map(X=>e.jsx(Yp,{etiquette:X,isExpanded:C===X.id,onToggleExpand:()=>A(C===X.id?null:X.id),onDeprecate:()=>_(X.id,"language"),onDistribute:()=>M(X.id,"language"),onRecall:()=>U(X.id,"language")},X.id)):e.jsx(vx,{type:"language"}):J.length>0?J.map(X=>e.jsx(Qp,{etiquette:X,isExpanded:C===X.id,onToggleExpand:()=>A(C===X.id?null:X.id),onDeprecate:()=>_(X.id,"behavior_dress"),onDistribute:()=>M(X.id,"behavior_dress"),onRecall:()=>U(X.id,"behavior_dress")},X.id)):e.jsx(vx,{type:"behavior_dress"}),e.jsxs("button",{className:"w-full p-3 sm:p-4 border-2 border-dashed border-stone-600 hover:border-pink-500/50 rounded-lg text-gray-400 hover:text-pink-300 transition-colors flex items-center justify-center gap-2 min-h-[44px] text-xs sm:text-sm",children:[e.jsx("i",{className:"fa-solid fa-plus"}),x==="language"?"添加语言铁律":"添加行为着装铁律"]})]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"})]})}),e.jsx(Gp,{isOpen:y,onClose:()=>S(!1),settings:r.settings,onSave:X=>{c({...r,settings:X}),S(!1)}})]}):null},Nd=(i,l)=>l.some(r=>i instanceof r);let jx,Nx;function Xp(){return jx||(jx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Pp(){return Nx||(Nx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wd=new WeakMap,fd=new WeakMap,Ki=new WeakMap;function Zp(i){const l=new Promise((r,c)=>{const d=()=>{i.removeEventListener("success",m),i.removeEventListener("error",f)},m=()=>{r(mn(i.result)),d()},f=()=>{c(i.error),d()};i.addEventListener("success",m),i.addEventListener("error",f)});return Ki.set(l,i),l}function Kp(i){if(wd.has(i))return;const l=new Promise((r,c)=>{const d=()=>{i.removeEventListener("complete",m),i.removeEventListener("error",f),i.removeEventListener("abort",f)},m=()=>{r(),d()},f=()=>{c(i.error||new DOMException("AbortError","AbortError")),d()};i.addEventListener("complete",m),i.addEventListener("error",f),i.addEventListener("abort",f)});wd.set(i,l)}let Sd={get(i,l,r){if(i instanceof IDBTransaction){if(l==="done")return wd.get(i);if(l==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return mn(i[l])},set(i,l,r){return i[l]=r,!0},has(i,l){return i instanceof IDBTransaction&&(l==="done"||l==="store")?!0:l in i}};function cf(i){Sd=i(Sd)}function Fp(i){return Pp().includes(i)?function(...l){return i.apply(kd(this),l),mn(this.request)}:function(...l){return mn(i.apply(kd(this),l))}}function Wp(i){return typeof i=="function"?Fp(i):(i instanceof IDBTransaction&&Kp(i),Nd(i,Xp())?new Proxy(i,Sd):i)}function mn(i){if(i instanceof IDBRequest)return Zp(i);if(fd.has(i))return fd.get(i);const l=Wp(i);return l!==i&&(fd.set(i,l),Ki.set(l,i)),l}const kd=i=>Ki.get(i);function eg(i,l,{blocked:r,upgrade:c,blocking:d,terminated:m}={}){const f=indexedDB.open(i,l),x=mn(f);return c&&f.addEventListener("upgradeneeded",h=>{c(mn(f.result),h.oldVersion,h.newVersion,mn(f.transaction),h)}),r&&f.addEventListener("blocked",h=>r(h.oldVersion,h.newVersion,h)),x.then(h=>{m&&h.addEventListener("close",()=>m()),d&&h.addEventListener("versionchange",g=>d(g.oldVersion,g.newVersion,g))}).catch(()=>{}),x}const tg=["get","getKey","getAll","getAllKeys","count"],sg=["put","add","delete","clear"],hd=new Map;function wx(i,l){if(!(i instanceof IDBDatabase&&!(l in i)&&typeof l=="string"))return;if(hd.get(l))return hd.get(l);const r=l.replace(/FromIndex$/,""),c=l!==r,d=sg.includes(r);if(!(r in(c?IDBIndex:IDBObjectStore).prototype)||!(d||tg.includes(r)))return;const m=async function(f,...x){const h=this.transaction(f,d?"readwrite":"readonly");let g=h.store;return c&&(g=g.index(x.shift())),(await Promise.all([g[r](...x),d&&h.done]))[0]};return hd.set(l,m),m}cf(i=>({...i,get:(l,r,c)=>wx(l,r)||i.get(l,r,c),has:(l,r)=>!!wx(l,r)||i.has(l,r)}));const ag=["continue","continuePrimaryKey","advance"],Sx={},Cd=new WeakMap,df=new WeakMap,ng={get(i,l){if(!ag.includes(l))return i[l];let r=Sx[l];return r||(r=Sx[l]=function(...c){Cd.set(this,df.get(this)[l](...c))}),r}};async function*lg(...i){let l=this;if(l instanceof IDBCursor||(l=await l.openCursor(...i)),!l)return;l=l;const r=new Proxy(l,ng);for(df.set(r,l),Ki.set(r,kd(l));l;)yield r,l=await(Cd.get(r)||l.continue()),Cd.delete(r)}function kx(i,l){return l===Symbol.asyncIterator&&Nd(i,[IDBIndex,IDBObjectStore,IDBCursor])||l==="iterate"&&Nd(i,[IDBIndex,IDBObjectStore])}cf(i=>({...i,get(l,r,c){return kx(l,r)?lg:i.get(l,r,c)},has(l,r){return kx(l,r)||i.has(l,r)}}));function uf(){return{monthlySchedule:1,registrationDuration:24,enableAutoGeneration:!0,preparationDuration:6}}function rg(){return{participations:0,wins:0,bestRank:0,totalScore:0,averageRank:0}}function ig(){return{currentEvent:null,eventHistory:[],totalEditions:0,nextEventDate:og(),playerStats:rg(),config:uf()}}function og(i){const l=i||uf(),r=new Date,c=r.getFullYear(),d=r.getMonth();let m=new Date(c,d,l.monthlySchedule);return m.getTime()<r.getTime()&&(m=new Date(c,d+1,l.monthlySchedule)),m.getTime()}function cg(i,l){const r=[32,16,8,4,2,1];return i>0&&i<=r.length?r[i-1]:l}function gr(i=""){const l=Date.now(),r=Math.random().toString(36).substring(2,9);return i?`${i}_${l}_${r}`:`${l}_${r}`}function mf(){return gr("contestant")}function dg(){return gr("judge")}function ug(i){return gr(`challenge_r${i}`)}function mg(i){return gr(`event_${i}`)}const rl=2,Fi={id:"s1",name:"青玉剑诀",rarity:"良品",description:"青蛇宗入门剑法，讲究快、准、狠，直指敌人要害。",eroticDescription:"使用者将灵气灌注于剑身，剑刃变得滚烫并发出微光。他不会攻击致命部位，而是以一个下流至极的角度，用滚烫的剑身精准地划开敌人的衣带，或直接烙在对方的敏感肌肤上，留下屈辱的印记。",mechanicsDescription:"造成115%攻击力的物理伤害。",cost:15,genderLock:"Male"},xf={id:"s2",name:"岩山盾",rarity:"优品",description:"凝聚大地精华，化为坚不可摧的护盾。",eroticDescription:"使用者双腿大开，阳刚的灵力贯入大地。一面粗糙的石盾拔地而起，护在身前。石盾表面并非光滑，而是布满了大小不一、形似男性阳具的狰狞凸起，任何攻击都会被这些“石根”顶回去，充满了挑衅与羞辱的意味。",mechanicsDescription:"提升自身30%防御力，持续3回合。",cost:20,genderLock:"Male"},Dd={id:"s3",name:"凤火术",rarity:"良品",description:"操控如凤凰般华丽的火焰，焚烧敌人。",eroticDescription:"使用者媚眼如丝，扭动腰肢，双腿之间竟喷射出一股灼热的粉红色火焰。这火焰不仅烧灼敌人的肉体，更散发出浓郁的催情香气，让敌人在痛苦与欲望的双重折磨中意志崩溃。",mechanicsDescription:"造成105%攻击力的火焰伤害，并施加[灼烧]效果（每回合损失5%最大生命值），持续2回合。",cost:18,genderLock:"Female"},ff={id:"s4",name:"九尾幻术",rarity:"优品",description:"九尾狐一族的血脉天赋，能制造足以乱真的淫靡幻境。",eroticDescription:"使用者身后九条毛茸茸的狐尾如灵蛇般伸出，不由分说地将敌人紧紧缠绕。狐尾的尖端精准地找到并搔刮着对方最敏感的部位，同时释放出强烈的幻术灵力，使其瞬间堕入被无数触手和巨根轮番侵犯的淫乱幻觉之中，彻底丧失战意。",mechanicsDescription:"有60%几率使敌人[混乱]（无法行动），持续1回合。",cost:25,genderLock:"Female"},xg={id:"us1",name:"灵气回复",rarity:"凡品",description:"恢复少量真元。",eroticDescription:"使用者开始娇喘，通过模拟性高潮的方式快速聚集周围的灵气，补充自身。",mechanicsDescription:"恢复25点真元。",cost:0,genderLock:"Universal"},hf={id:"us2",name:"基础拳法",rarity:"凡品",description:"造成少量物理伤害。",eroticDescription:"看似普通的拳法，但每一拳都精准地打向敌人的下体，试图造成最直接的痛苦和羞辱。",mechanicsDescription:"造成100%攻击力的物理伤害。",cost:10,genderLock:"Universal"},fg={id:"us3",name:"天雷击",rarity:"珍品",description:"引动九天神雷，对敌人造成巨大伤害。",eroticDescription:"使用者高举双手，召唤一道粗大的紫色闪电，闪电如一条巨龙般从天而降，精准地贯穿敌人的身体，使其浑身抽搐，口吐白沫。",mechanicsDescription:"造成220%攻击力的雷电伤害，但自身[虚弱]（攻击力降低20%），持续2回合。",cost:45,genderLock:"Male"},hg={id:"us4",name:"凤凰涅槃",rarity:"绝品",description:"濒死时有几率浴火重生。",eroticDescription:"在死亡的瞬间，使用者全身衣物被火焰烧尽，赤裸的身体在烈火中重塑，发出诱人的呻吟，以更完美、更淫荡的姿态重生。",mechanicsDescription:"气血低于15%时，有35%几率恢复60%最大气血。一场战斗只能触发一次。",cost:100,genderLock:"Female"};const pf={id:"e1",name:"破瓜之刃",type:"Weapon",rarity:"凡品",description:"一把粗糙的铁剑，剑柄被设计成阳具的形状，据说能轻易划破处女的衣物。",stats:{attack:5}},gf={id:"e2",name:"开裆学徒袍",type:"Armor",rarity:"凡品",description:"一件普通的学徒袍，但裆部被故意剪开，方便随时随地进行“修炼”。",stats:{hp:15,defense:3}},bf={id:"e3",name:"催情淫纹",type:"Accessory",rarity:"良品",description:"一道刻在小腹上的淫纹，能让佩戴者在战斗中感到持续的性快感，从而身法更“灵活”。",stats:{speed:8}},pg={id:"e4",name:"乳钉龟甲",type:"Armor",rarity:"珍品",description:"仅能遮住胸前两点的龟甲胸罩，上面穿有乳环，每次受到攻击都会拉扯乳头，带来痛并快乐的刺激。",stats:{hp:80,defense:35}},gg={id:"e5",name:"淫魔的项圈",type:"Accessory",rarity:"优品",description:"一个刻有堕落符文的项圈，戴上它的人会不自觉地散发出邀请交媾的骚媚气息。",stats:{critRate:.08,critDmg:.15}},bg={id:"e6",name:"贯穿神女之枪",type:"Weapon",rarity:"仙品",description:"传说中曾让仙界圣女高潮迭起的长枪，枪头刻满了能刺激G点的咒文。",stats:{attack:80,critRate:.1}},yg={id:"e7",name:"绝对露出圣铠",type:"Armor",rarity:"圣品",description:"一套看似华丽的铠甲，但其设计巧妙，无论从哪个角度看，都会不经意地露出穿戴者的私密部位。",stats:{hp:200,defense:50,speed:-10}},vg={id:"e8",name:"触手软鞭",type:"Weapon",rarity:"良品",description:"如章鱼触手般柔软而灵活的鞭子，鞭身上布满吸盘，能缠住敌人并带来异样的快感。",stats:{attack:8,speed:4}},jg={id:"e9",name:"全透明霓裳",type:"Armor",rarity:"优品",description:"一件完全透明的仙衣，唯一的遮挡是在私处绣了一朵若隐若现的莲花，引人遐想。",stats:{hp:40,defense:12,speed:3}},Ng={id:"e10",name:"自慰月华簪",type:"Accessory",rarity:"珍品",description:"一根能根据主人意念震动的发簪，既是饰品，也是方便的自慰工具，佩戴者可随时享受快感。",stats:{critRate:.03,speed:10}},yf=[pf,gf,bf,pg,gg,bg,yg,vg,jg,Ng],fr={p_brothel_star:{name:"头牌花魁",shop:"青楼",requiredAttr:"charm"},p_brothel_tutor:{name:"双修导师",shop:"青楼",requiredAttr:"skillfulness"},p_brothel_guard:{name:"护卫",shop:"青楼",requiredAttr:"defense"},p_arena_gladiator:{name:"明星角斗士",shop:"角斗场",requiredAttr:"attack"},p_arena_host:{name:"主持人",shop:"角斗场",requiredAttr:"charm"},p_arena_trader:{name:"奴隶商人",shop:"角斗场",requiredAttr:"skillfulness"},p_alchemy_chief:{name:"首席炼丹师",shop:"炼丹房",requiredAttr:"perception"},p_alchemy_apprentice:{name:"药童",shop:"炼丹房",requiredAttr:"speed"},p_auction_master:{name:"首席拍卖师",shop:"拍卖行",requiredAttr:"charm"},p_auction_appraiser:{name:"鉴宝师",shop:"拍卖行",requiredAttr:"perception"},p_intel_chief:{name:"情报头子",shop:"情报阁",requiredAttr:"perception"},p_intel_assassin:{name:"暗杀者",shop:"情报阁",requiredAttr:"attack"}},Xi={id:"c1",name:"夜宸",gender:"Male",realm:"筑基期",rarity:"珍品",title:"暗影中的低语者",race:"魔族",origin:"来自魔界与人界交汇的阴影之地，是梦魇与人类的混血。他加入宗门的目的无人知晓，只为寻找能满足他特殊“食欲”的灵魂。",appearance:"他总是穿着一件能遮蔽身形的黑色斗篷，兜帽下只能看到一双闪烁着紫色幽光的眼睛和苍白的嘴唇。当他施法时，斗篷下会伸出数条由纯粹暗影构成的触手，这些触手表面光滑湿润，顶端带有能吸食他人精神能量的吸盘。",charm:88,skillfulness:70,perception:80,baseAttributes:{hp:110,maxHp:110,mp:60,maxMp:60,attack:20,defense:10,speed:16,critRate:.12,critDmg:1.6},skills:[{id:"s5",name:"暗影触手",rarity:"良品",description:"从阴影中召唤触手束缚敌人。",eroticDescription:"数条冰冷滑腻的暗影触手从地面钻出，无视所有护甲，直接缠绕上敌人的四肢和腰腹，并强行钻入其衣物内，在其最敏感的部位游走、抚弄，使其因强烈的快感和恐惧而无法动弹。",mechanicsDescription:"对单个敌人造成80%攻击力的暗影伤害，并有70%几率使其【束缚】（无法行动），持续1回合。",cost:20,genderLock:"Male"},{id:"s6",name:"精神侵蚀",rarity:"优品",description:"用魔音侵蚀敌人的心智。",eroticDescription:"夜宸发出只有目标能听到的、充满魅惑的魔音低语。这声音会直接在敌人脑海中响起，不断放大其内心最深处的淫欲，让其产生被无数人轮番侵犯的幻觉，最终精神崩溃，任人宰割。",mechanicsDescription:"对单个敌人造成精神冲击，使其【混乱】（无法行动）并【易伤】（受到的伤害增加20%），持续2回合。",cost:35,genderLock:"Male"},null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},_d={id:"c2",name:"灵月",gender:"Female",realm:"筑基期",rarity:"珍品",title:"天生媚骨骚货",race:"妖族",origin:"九尾天狐的后裔，为寻求突破血脉的桎梏而加入了修仙宗门。",appearance:"她从不穿乳罩和内裤，仅仅套着一件薄如蝉翼的纱裙。一对硕大的乳房随着她的走动剧烈地晃动，深色的乳头清晰可见。裙下光洁一片，饱满的阴唇轮廓分明。她天生淫荡，体内媚药过剩，导致私处时刻湿润，甚至会在走路时留下淡淡的骚味痕迹。",charm:95,skillfulness:80,perception:60,baseAttributes:{hp:100,maxHp:100,mp:70,maxMp:70,attack:15,defense:10,speed:18,critRate:.15,critDmg:1.6},skills:[Dd,ff,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},wg={id:"c3",name:"石毅",gender:"Male",realm:"金丹期",rarity:"优品",title:"不动山王",race:"人族",origin:"天生神力，以炼体为主，肉身坚不可摧。",charm:30,skillfulness:40,perception:45,baseAttributes:{hp:180,maxHp:180,mp:40,maxMp:40,attack:14,defense:25,speed:10,critRate:.05,critDmg:1.5},skills:[xf,Fi,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},Sg={id:"c4",name:"苏媚",gender:"Female",realm:"筑基期",rarity:"优品",title:"百花仙子",race:"人族",origin:"精通治疗与辅助法术，是队伍中可靠的后盾。",charm:85,skillfulness:70,perception:65,baseAttributes:{hp:95,maxHp:95,mp:80,maxMp:80,attack:12,defense:14,speed:16,critRate:.08,critDmg:1.5},skills:[ff,Dd,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},kg={id:"c5",name:"龙傲天",gender:"Male",realm:"元婴期",rarity:"仙品",title:"天命之子",race:"神族",origin:"上古神族后裔，血脉中蕴含着毁天灭地的力量。",charm:80,skillfulness:85,perception:90,baseAttributes:{hp:250,maxHp:250,mp:120,maxMp:120,attack:40,defense:25,speed:22,critRate:.2,critDmg:2},skills:[Fi,Dd,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},Cg={id:"c6",name:"张三",gender:"Male",realm:"炼气期",rarity:"凡品",title:"外门弟子",race:"人族",origin:"普通的宗门外门弟子。",charm:40,skillfulness:30,perception:35,baseAttributes:{hp:80,maxHp:80,mp:40,maxMp:40,attack:10,defense:8,speed:12,critRate:.05,critDmg:1.5},skills:[Fi,hf,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},Eg={id:"c7",name:"九天玄女",gender:"Female",realm:"化神期",rarity:"神品",title:"天道化身",race:"神族",origin:"自天地初开时诞生的先天神灵，掌管着天道法则，威严而又神秘。",charm:99,skillfulness:99,perception:99,baseAttributes:{hp:400,maxHp:400,mp:250,maxMp:250,attack:60,defense:40,speed:30,critRate:.3,critDmg:2.5},skills:[fg,hg,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},ys=[Xi,_d,wg,Sg,kg,Cg,Eg];const Mg={id:"pet2",name:"霸天虎",gender:"Male",rarity:"珍品",description:"拥有上古白虎血脉的灵兽，性格霸道，破坏力惊人。",skill:{id:"ps2",name:"虎啸山林",rarity:"珍品",description:"发出一声震慑心魄的虎啸。",eroticDescription:"雄浑的虎啸声中夹杂着低沉的喘息，能唤起周围生物最原始的交配欲望，使其臣服于霸天虎的雄威之下。",mechanicsDescription:"战斗开始时，有30%几率使敌方全体【恐惧】（攻击力降低15%），持续2回合。",cost:0,genderLock:"Universal"}},Ag={id:"pet3",name:"幻梦蝶",gender:"Female",rarity:"珍品",description:"翅膀上带有迷幻花纹的灵蝶，能编织出以假乱真的幻境。",skill:{id:"ps3",name:"蝶恋花",rarity:"珍品",description:"散播能引人入梦的花粉。",eroticDescription:"煽动翅膀，洒下闪着春光的催情花粉，闻到花粉的生物会立刻陷入最淫靡的春梦之中，任人摆布。",mechanicsDescription:"探索时，有15%的几率使你避开一次负面事件。",cost:0,genderLock:"Universal"}},un={凡品:10,良品:50,优品:150,珍品:500,绝品:1500,仙品:5e3,圣品:15e3,神品:5e4},Tg={tier:"黄铜",division:"III",points:1250,tierIcon:"🥉"},Cx=(i,l)=>Math.floor(Math.random()*(l-i+1))+i,Ta=(i,l)=>{const r=[],c=new Set;for(;r.length<l&&c.size<i.length;){const d=i[Cx(0,i.length-1)];if(!c.has(d.id)){const m=Cx(1e3,6e3);r.push({rank:0,name:d.name,faction:"青蛇宗",points:m,characterId:d.id}),c.add(d.id)}}return r.sort((d,m)=>m.points-d.points).map((d,m)=>({...d,rank:m+1}))},$g={宗门排行榜:{总榜:Ta(ys,20),核心弟子:Ta(ys.filter(i=>["仙品","圣品","神品"].includes(i.rarity)),20),内门弟子:Ta(ys.filter(i=>["珍品","绝品"].includes(i.rarity)),20),外门弟子:Ta(ys.filter(i=>["优品","良品"].includes(i.rarity)),20),杂役弟子:Ta(ys.filter(i=>i.rarity==="凡品"),20)},野榜:Ta(ys,20),区域榜:Ta(ys,20),世界榜:Ta(ys,20)},Dg={id:"prisoner-char-01",name:"血影魔君",gender:"Male",realm:"元婴期",rarity:"绝品",title:"血煞魔头",race:"魔族",origin:"血煞门叛徒，因屠杀无辜村民被捕",appearance:"一身黑衣，双目血红，周身缠绕着淡淡的血煞之气",charm:45,skillfulness:75,perception:60,baseAttributes:{hp:280,maxHp:280,mp:120,maxMp:120,attack:45,defense:28,speed:22,critRate:.18,critDmg:1.8},skills:[Fi,xf,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},_g={character:Dg,crime:"屠杀无辜村民，吸取血气修炼魔功",sentence:100,remainingDays:100,submissionLevel:20,loyaltyLevel:5,health:85,sanity:90,location:"居住区",cellType:"单独囚室",value:{ransom:5e4,labor:3e3,intelligence:8e3},status:["健康"],history:[],knownInformation:[],potentialInformation:["血煞门总坛位置","魔功修炼秘法","其他魔道同伙"],imprisonedDate:"第一天",realImprisonedTime:Date.now()},Og={mode:"exploration",exploration:{story:"在这个充满欲望与力量的修仙世界，实力并非唯一的主宰，潜藏在灵气之下的原始本能同样搅动着风云。你，一个身怀异禀的新进弟子，踏入了以双修和媚术闻名的青蛇宗。在这里，强大的修士们不仅追求通天修为，更沉溺于极致的肉体欢愉。宗门之内，师兄师姐们的关系错综复杂，每一次“切磋”都可能是一场香汗淋漓的征服。你将如何在这条充满诱惑与危险的道路上立足？是成为他人胯下的玩物，还是将所有人都变成你自己的禁脔？你的淫乱仙途，现在开始。",location:"青蛇宗山门",time:"第一天，清晨",choices:["向守门弟子介绍自己。","寻找登记处。","探索外门庭院。"],pendingChallenge:null},playerProfile:{name:"天选者",title:"新进弟子",relationships:[{id:"c2",name:"灵月",avatar:"path/to/lingyue-avatar.png",relationshipStatus:"熟人",relationshipTags:["同门","初识"],favorability:10,description:"在宗门初识，似乎对你有些好奇。"},{id:"c1",name:"风逸",avatar:"path/to/fengyi-avatar.png",relationshipStatus:"熟人",relationshipTags:["师兄","剑修"],favorability:25,description:"一位冷峻的师兄，剑法高超。"},{id:"c3",name:"石毅",avatar:"path/to/shiyi-avatar.png",relationshipStatus:"陌生人",relationshipTags:["炼体修士"],favorability:0,description:"一个看起来很强壮的修士，但你们还没说过话。"}],spiritStones:1e3,maleParty:[Xi],femaleParty:[],cardCollection:[Xi,_d],equipmentInventory:[pf,gf,bf],petCollection:[Mg,Ag],universalSkills:[xg,hf],arenaRank:Tg,reputation:{score:0,level:"默默无闻",dynamicTitles:[],greatestDeeds:[],title:"",goodDeeds:[],badDeeds:[],lewdDeeds:[],history:[]},quests:[{id:"main_01",title:"【主线】初入山门",description:"你站在青蛇宗的山门前，一位心怀壮志的新进弟子。首先，你需要向宗门报到。",category:"Main",status:"In Progress",objectives:[{id:"obj1",description:"与守门弟子交谈",isCompleted:!1,targetCount:1,currentCount:0},{id:"obj2",description:"在外门登记处完成登记",isCompleted:!1,targetCount:1,currentCount:0}],rewards:{spiritStones:50,reputation:10}}],businessDistrict:null},leaderboards:$g,announcements:{sect:[],adventure:[],world:[]},hospitalPatients:[],bountyBoard:[],cultivationPavilion:[{slotId:1,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]},{slotId:2,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]},{slotId:3,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]}],prisonSystem:{prisoners:[_g],guards:[],facilities:[],laborSites:[{id:"mine-01",type:"矿山",name:"青蛇矿脉",description:"宗门后山的灵石矿脉",maxWorkers:2,workers:[]},{id:"herb-01",type:"采药",name:"灵药园",description:"宗门的药材种植园",maxWorkers:2,workers:[]}],materialInventory:[],laborTasks:[],laborRecords:[],events:[],ransomOffers:[],stats:{totalPrisoners:0,byArea:{居住区:0,审讯区:0,娱乐区:0,劳役区:0,管理区:0,医疗区:0},byCellType:{普通牢房:0,重犯牢房:0,单独囚室:0},avgSubmission:0,avgLoyalty:0,avgHealth:0,totalGuards:5,escapeAttempts:0,successfulEscapes:0,totalRevenue:0,totalExpenses:0,netProfit:0},config:{maxPrisoners:50,dailyFoodCost:10,securityLevel:5,enableAutoInterrogation:!1,enableAutoLabor:!1}},memories:{探索:[],战斗:[],商城:[],医馆:[],悬赏:[],培育:[],商业:[],声望:[],公告:[],大牢:[],其他:[]},memorySummaries:{探索:{small:[],large:[]},战斗:{small:[],large:[]},商城:{small:[],large:[]},医馆:{small:[],large:[]},悬赏:{small:[],large:[]},培育:{small:[],large:[]},商业:{small:[],large:[]},声望:{small:[],large:[]},公告:{small:[],large:[]},大牢:{small:[],large:[]},其他:{small:[],large:[]}},summarySettings:{autoSummaryEnabled:!0,smallSummaryInterval:10,largeSummaryInterval:5,summaryPrompts:{small:"你是一个记忆总结助手。请根据以下【{category}】分类的记忆片段，生成一个简洁、连贯、大约100-200字的小总结。总结应提炼关键事件、人物和结果，并以第三人称叙述。请直接输出总结内容，不要包含任何额外的前缀或标题。",large:"你是一个高级记忆分析师。请根据以下多个关于【{category}】的小总结，生成一个全面、深刻、大约200-400字的大总结。这个总结应该识别核心主题、长期影响和人物关系变化，并以宏观视角进行叙述。请直接输出总结内容，不要包含任何额外的前缀或标题。"}},vectorConfig:$d,etiquetteSystem:Lp,gauntletSystem:ig()},Ex={patientId:"patient-example-01",name:"林婉儿",gender:"Female",age:19,background:"正道宗门“碧霞宫”的圣女，因偷练禁术而走火入魔，身体产生了奇特的异变。",genitalShape:"玉净瓶型蜜穴",sexualFeatures:["圣女体质","超敏感","被触碰会不自觉流出爱液"],illnessDescription:"所患奇症为“灵欲倒错”。每日正午，体内纯净的灵力会转化为高浓度的淫欲之气，若不与人交合疏导，便会遭受万蚁噬心般的痛苦，同时身体会散发出能令周围所有生物发情的异香。"},zg={name:"九转淫魔",character:{id:"bounty-char-example-01",name:"九转淫魔",gender:"Male",realm:"元婴期",rarity:"绝品",title:"行走的播种机器",race:"魔族",origin:"上古淫魔的一缕分魂转世，以吸食女性修士的元阴为修炼法门，实力极强，极度危险。",appearance:"外表是俊美妖异的青年，但当他兴奋时，额头会长出魔角，胯下巨物会膨胀到恐怖的尺寸，上面布满了能吸取元阴的倒刺。",charm:92,skillfulness:88,perception:70,baseAttributes:{hp:350,maxHp:350,mp:150,maxMp:150,attack:55,defense:30,speed:25,critRate:.25,critDmg:2.2},skills:[{id:"bs1",name:"魔龙探穴",rarity:"绝品",description:"释放出充满魔气的触手攻击敌人。",eroticDescription:"胯下巨物化为数条灵活的魔气触手，强行钻入敌人的所有孔穴进行蹂躏，吸取其元阴。",mechanicsDescription:"造成180%攻击力的暗影伤害，并恢复造成伤害30%的气血。",cost:40,genderLock:"Male"},{id:"bs2",name:"淫魔领域",rarity:"绝品",description:"展开领域，削弱敌人。",eroticDescription:"释放出充满粉色瘴气的领域，领域内的敌人会持续陷入性兴奋状态，双腿发软，战意全无。",mechanicsDescription:"敌方全体攻击力与防御力降低20%，持续3回合。",cost:60,genderLock:"Male"},null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},specialTrait:"只对处女或元阴未泄的女性修士感兴趣，在与她们战斗时会变得异常强大。",locationHint:"似乎在【合欢宗】附近的山脉中寻找新的猎物。",trackerId:null,startTime:0,endTime:0,trackingLog:null,finalOutcome:null},Rg={2:i=>{var l,r,c,d;if(console.log("迁移记忆系统分类..."),i.memories){const m={探索:i.memories.探索||[],战斗:i.memories.战斗||[],商城:[],医馆:i.memories.问诊||[],悬赏:i.memories.悬赏||[],培育:i.memories.培育||[],商业:i.memories.商业||[],声望:[],公告:[],其他:[...i.memories.交互||[],...i.memories.其他||[]]};i.memories=m}if(i.memorySummaries){const m={探索:i.memorySummaries.探索||{small:[],large:[]},战斗:i.memorySummaries.战斗||{small:[],large:[]},商城:{small:[],large:[]},医馆:i.memorySummaries.问诊||{small:[],large:[]},悬赏:i.memorySummaries.悬赏||{small:[],large:[]},培育:i.memorySummaries.培育||{small:[],large:[]},商业:i.memorySummaries.商业||{small:[],large:[]},声望:{small:[],large:[]},公告:{small:[],large:[]},其他:{small:[...((l=i.memorySummaries.交互)==null?void 0:l.small)||[],...((r=i.memorySummaries.其他)==null?void 0:r.small)||[]],large:[...((c=i.memorySummaries.交互)==null?void 0:c.large)||[],...((d=i.memorySummaries.其他)==null?void 0:d.large)||[]]}};i.memorySummaries=m}return i}},Ed=i=>{let l=i.version||0;if(l===rl)return i;console.log(`Migrating save data from version ${l} to ${rl}...`);let r={...i};for(let c=l+1;c<=rl;c++){const d=Rg[c];d&&(r=d(r),console.log(`- Applied migration for version ${c}`))}return r.version=rl,console.log("Migration complete."),r};class Lg{async saveToSlot(l,r){const c=JSON.parse(JSON.stringify({name:r.name,timestamp:r.timestamp,gameState:{...r.gameState,version:rl}}));try{await window.TavernHelper.updateVariablesWith(d=>(d.xianxiaRpgSaves||(d.xianxiaRpgSaves={}),d.xianxiaRpgSaves[l]=c,d),{type:"character"})}catch(d){throw console.error(`TavernAdapter: 保存到槽位 ${l} 失败:`,d),d}}async loadFromSlot(l){try{const r=window.TavernHelper.getVariables({type:"character"});if(r&&r.xianxiaRpgSaves&&r.xianxiaRpgSaves[l]){const c=r.xianxiaRpgSaves[l];return!c.name||!c.timestamp?Ed(c):Ed(c.gameState)}return null}catch(r){return console.error(`TavernAdapter: 从槽位 ${l} 加载失败:`,r),null}}async getAllSaves(){try{const l=window.TavernHelper.getVariables({type:"character"}),r=l&&l.xianxiaRpgSaves||{},c={};for(let d=1;d<=5;d++)if(r[d]){const m=r[d];!m.name||!m.timestamp?c[d]={name:`存档 ${d}`,timestamp:Date.now(),gameState:m}:c[d]=m}else c[d]=null;return Promise.resolve(c)}catch(l){return console.error("TavernAdapter: 获取所有存档失败:",l),{}}}async deleteSlot(l){try{await window.TavernHelper.updateVariablesWith(r=>(r.xianxiaRpgSaves&&r.xianxiaRpgSaves[l]&&delete r.xianxiaRpgSaves[l],r),{type:"character"})}catch(r){throw console.error(`TavernAdapter: 删除槽位 ${l} 失败:`,r),r}}}class Bg{constructor(){this.dbPromise=null,this.saveToSlot=async(l,r)=>{const c=await this.getDb(),d={...r,gameState:{...r.gameState,version:rl}};await c.put("manual_saves",d,l)},this.loadFromSlot=async l=>{const c=await(await this.getDb()).get("manual_saves",l);return c?Ed(c.gameState):null},this.getAllSaves=async()=>{const l=await this.getDb(),r={};let c=await l.transaction("manual_saves").store.openCursor();for(;c;)r[c.key]=c.value,c=await c.continue();return r},this.deleteSlot=async l=>{await(await this.getDb()).delete("manual_saves",l)}}getDb(){return this.dbPromise||(this.dbPromise=eg("xianxia-card-rpg-db",1,{upgrade(l){l.objectStoreNames.contains("autosave")&&l.deleteObjectStore("autosave"),l.objectStoreNames.contains("manual_saves")||l.createObjectStore("manual_saves")}})),this.dbPromise}}const Hg=()=>window.TavernHelper?(console.log("Storage Service: Using TavernHelper adapter."),new Lg):(console.log("Storage Service: Using IndexedDB adapter."),new Bg),_a=Hg(),Ug=({onStartNewGame:i,onLoadGame:l})=>{const[r,c]=v.useState({}),[d,m]=v.useState(!1),[f,x]=v.useState(!1);v.useEffect(()=>{h()},[]);const h=async()=>{const b=await _a.getAllSaves();c(b)},g=async b=>{x(!0);try{await l(b)}catch(y){console.error("加载存档失败:",y),alert("加载存档失败，请重试。")}finally{x(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundImage:"url('https://github.com/zzq0219/sillytavern/blob/main/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E4%BA%91%E9%9B%BE-%E4%BB%99%E4%BE%A0.png?raw=true')",backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center space-y-8 px-4",children:[e.jsxs("div",{className:"text-center space-y-4 animate-fade-in",children:[e.jsx("h1",{className:"text-6xl md:text-7xl font-bold text-gradient-gold text-shadow-glow font-serif tracking-wider",children:"仙侠卡牌RPG"}),e.jsx("p",{className:"text-xl md:text-2xl text-amber-200/90 font-serif tracking-widest text-shadow",children:"红尘万丈 · 仙路漫漫"})]}),d?e.jsx("div",{className:"w-full max-w-2xl animate-fade-in",children:e.jsxs("div",{className:"glass-morphism rounded-xl p-6 border border-stone-700/50 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gradient-gold font-serif",children:"选择存档"}),e.jsx("button",{onClick:()=>m(!1),className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto scrollbar-xianxia",children:[1,2,3,4,5].map(b=>{const y=r[b];return y?e.jsx("button",{onClick:()=>g(b),disabled:f,className:`w-full p-4 bg-gradient-to-r from-stone-800/80 to-stone-900/80 rounded-lg\r
                                                     border border-stone-700/50 hover:border-amber-500/50\r
                                                     text-left transition-all duration-300\r
                                                     hover:scale-[1.02] hover:shadow-lg hover:shadow-amber-500/20\r
                                                     disabled:opacity-50 disabled:cursor-not-allowed\r
                                                     group`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("span",{className:"text-amber-400 font-bold font-serif",children:["存档 ",b]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("span",{className:"text-white font-semibold",children:y.name})]}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsxs("div",{children:[e.jsx("i",{className:"fa-solid fa-user mr-2"}),y.gameState.playerProfile.name]}),e.jsxs("div",{children:[e.jsx("i",{className:"fa-solid fa-location-dot mr-2"}),y.gameState.exploration.location]}),e.jsxs("div",{children:[e.jsx("i",{className:"fa-solid fa-clock mr-2"}),new Date(y.timestamp).toLocaleString("zh-CN")]})]})]}),e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full \r
                                                              bg-amber-500/20 group-hover:bg-amber-500/40 \r
                                                              transition-colors duration-300`,children:e.jsx("i",{className:"fa-solid fa-play text-amber-400"})})]})},b):e.jsxs("div",{className:"p-4 bg-stone-800/50 rounded-lg border border-stone-700/50 text-gray-500 text-center",children:[e.jsx("i",{className:"fa-solid fa-inbox mr-2"}),"存档槽 ",b," - 空"]},b)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-stone-700/50",children:e.jsxs("button",{onClick:()=>m(!1),className:`w-full px-4 py-2 bg-stone-700/50 hover:bg-stone-700 rounded-lg\r
                                             text-gray-300 hover:text-white transition-all duration-300\r
                                             border border-stone-600/50`,children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"返回"]})})]})}):e.jsxs("div",{className:"flex flex-col space-y-4 w-full max-w-md animate-slide-up",children:[e.jsxs("button",{onClick:i,disabled:f,className:`group relative px-8 py-4 bg-gradient-to-r from-amber-600 via-yellow-500 to-amber-600 rounded-lg\r
                                     text-white font-bold text-xl tracking-wider font-serif\r
                                     border-2 border-amber-400/50 shadow-2xl\r
                                     hover:shadow-amber-500/50 hover:scale-105 hover:border-amber-300\r
                                     active:scale-95 transition-all duration-300\r
                                     disabled:opacity-50 disabled:cursor-not-allowed\r
                                     overflow-hidden`,children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-play"}),e.jsx("span",{children:"开始游戏"})]}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent \r
                                          translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000`})]}),e.jsxs("button",{onClick:()=>m(!0),disabled:f,className:`group relative px-8 py-4 bg-gradient-to-r from-blue-600 via-cyan-500 to-blue-600 rounded-lg\r
                                     text-white font-bold text-xl tracking-wider font-serif\r
                                     border-2 border-blue-400/50 shadow-2xl\r
                                     hover:shadow-blue-500/50 hover:scale-105 hover:border-blue-300\r
                                     active:scale-95 transition-all duration-300\r
                                     disabled:opacity-50 disabled:cursor-not-allowed\r
                                     overflow-hidden`,children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-folder-open"}),e.jsx("span",{children:"读取存档"})]}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent \r
                                          translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000`})]})]}),e.jsx("div",{className:"absolute bottom-4 right-4 text-gray-400/70 text-sm font-mono",children:"v1.0.0"})]}),f&&e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-amber-400 mx-auto mb-4"}),e.jsx("p",{className:"text-amber-200 text-xl font-serif",children:"加载中..."})]})})]})},Ig=({descriptions:i,isLoading:l,isPlayerTurn:r})=>{const[c,d]=v.useState([]);v.useEffect(()=>{if(d([]),i.length>0){let f=0;const x=setInterval(()=>{d(h=>[...h,i[f]]),f++,f>=i.length&&clearInterval(x)},100);return()=>clearInterval(x)}},[i]);const m=()=>l&&i.length===0?e.jsx("p",{className:"text-center text-amber-300 animate-glow",children:"回合结算中..."}):c.length>0?c.map((f,x)=>e.jsx("p",{className:"text-center animate-fade-in",children:f},x)):!r&&!l?e.jsx("p",{className:"text-center text-gray-400",children:"等待对手行动..."}):e.jsx("p",{className:"text-center text-gray-500",children:"请选择你的行动。"});return e.jsx("div",{className:"w-full min-h-[10rem] max-h-[16rem] bg-slate-900/50 p-4 rounded-lg border border-slate-700/50 flex flex-col justify-start text-gray-300 font-serif transition-all duration-300 text-base shadow-inner shadow-black/50 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:m()})})},qg=({label:i,isActive:l,onClick:r})=>e.jsx("button",{onClick:r,className:`px-5 py-2 text-base font-semibold rounded-t-lg transition-colors duration-200 font-serif ${l?"bg-stone-800/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-900/50 hover:text-gray-200"}`,children:i}),Gg=({announcement:i})=>e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("h3",{className:"text-xl font-bold text-white font-serif",children:i.title}),e.jsx("p",{className:"text-sm text-gray-500 font-mono",children:i.timestamp})]}),e.jsx("p",{className:"text-gray-300 mt-2",children:i.content})]}),Vg=({isOpen:i,onClose:l,announcements:r,onRefresh:c,isLoading:d})=>{const[m,f]=v.useState("sect");if(!i)return null;const x={sect:{label:"宗门公告",data:r.sect},adventure:{label:"奇遇逸闻",data:r.adventure},world:{label:"世界法旨",data:r.world}},h=x[m].data;return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 pr-6 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"天机阁"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:c,disabled:d,className:"text-amber-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-wait",children:e.jsx("i",{className:`fa-solid fa-arrows-rotate text-xl ${d?"animate-spin":""}`})}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),e.jsx("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:Object.entries(x).map(([g,{label:b}])=>e.jsx(qg,{label:b,isActive:m===g,onClick:()=>f(g)},g))}),e.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-4",children:h.length>0?h.map(g=>e.jsx(Gg,{announcement:g},g.id)):e.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[e.jsx("p",{className:"text-4xl mb-4",children:"📜"}),e.jsx("p",{children:d?"正在从天机阁获取最新情报...":"此分类下暂无情报。"})]})})]})})},Yg=({announcements:i,onClick:l})=>{if(i.length===0)return null;const r=i.map(c=>`【${c.category}】 ${c.title}`).join("      ");return e.jsx("div",{className:"absolute top-16 left-0 right-0 h-8 bg-gradient-to-r from-amber-900/80 via-yellow-600/80 to-amber-900/80 z-10 flex items-center overflow-hidden cursor-pointer border-y-2 border-amber-400/50 shadow-lg pointer-events-auto",onClick:l,children:e.jsxs("div",{className:"whitespace-nowrap w-full flex",children:[e.jsx("p",{className:"font-serif text-sm text-yellow-100 drop-shadow-sm shadow-black animate-marquee pr-12",children:r}),e.jsx("p",{className:"font-serif text-sm text-yellow-100 drop-shadow-sm shadow-black animate-marquee pr-12","aria-hidden":"true",children:r})]})})},Qg=({victory:i,oldRank:l,newRank:r,pointsChange:c,onClose:d})=>{const m=i?"胜利":"惜败",f=i?"text-green-400":"text-red-400",x=c>=0?"text-green-400":"text-red-400";return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-md rounded-xl shadow-2xl backdrop-blur-lg flex flex-col items-center text-center p-8",children:[e.jsx("h2",{className:`text-4xl font-bold font-serif mb-4 ${f}`,children:m}),e.jsxs("div",{className:"my-6 w-full",children:[e.jsxs("div",{className:"flex justify-between items-center text-lg mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"先前段位:"}),e.jsxs("span",{className:"text-white font-semibold",children:[l.tier," ",l.division]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg mb-4",children:[e.jsx("span",{className:"text-gray-400",children:"先前积分:"}),e.jsx("span",{className:"text-white font-mono",children:l.points})]}),e.jsx("div",{className:"border-t border-dashed border-stone-600 my-4"}),e.jsxs("div",{className:"flex justify-between items-center text-2xl mb-2",children:[e.jsx("span",{className:"text-gray-300",children:"当前段位:"}),e.jsxs("span",{className:"text-amber-400 font-bold",children:[r.tier," ",r.division]})]}),e.jsxs("div",{className:"flex justify-between items-center text-2xl",children:[e.jsx("span",{className:"text-gray-300",children:"当前积分:"}),e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-amber-400 font-mono font-bold",children:r.points}),e.jsxs("span",{className:`ml-2 font-mono ${x}`,children:["(",c>=0?`+${c}`:c,")"]})]})]})]}),e.jsx("button",{onClick:d,className:"mt-6 bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-500 transition-colors shadow-lg w-40 h-14 flex items-center justify-center",children:"返回"})]})})},pd=({title:i,description:l,cost:r,onClick:c,disabled:d})=>e.jsx("button",{onClick:c,disabled:d,className:"h-full w-full flex flex-col justify-between text-center bg-stone-700/80 p-3 rounded-lg hover:bg-stone-600/80 border border-stone-600/50 hover:border-amber-400/50 transition-all duration-200 group disabled:opacity-40 disabled:cursor-not-allowed shadow-md",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-center items-baseline gap-2",children:[e.jsx("span",{className:"font-bold text-white text-base font-serif",children:i}),r!==void 0&&e.jsxs("span",{className:"font-mono text-blue-400 text-xs",children:[r,"MP"]})]}),e.jsx("p",{className:"text-xs text-amber-300 mt-1 group-hover:text-amber-200 font-serif whitespace-normal",children:l})]})}),Jg=({activeCard:i,onAction:l,onClose:r})=>{const{card:c}=i;return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-30 flex items-end justify-center",onClick:r,children:e.jsx("div",{className:"w-full max-w-4xl bg-stone-800/90 backdrop-blur-lg rounded-t-xl border-t border-yellow-400/20 p-5 shadow-2xl animate-slide-up",onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",style:{gridAutoRows:"1fr"},children:[e.jsx(pd,{title:"普通攻击",description:"造成少量物理伤害",onClick:()=>l("普通攻击")}),c.skills.map(d=>d&&e.jsx(pd,{title:d.name,description:d.mechanicsDescription,cost:d.cost,onClick:()=>l(d)},d.id)),i.pet&&e.jsx(pd,{title:i.pet.skill.name,description:i.pet.skill.mechanicsDescription,cost:i.pet.skill.cost,onClick:()=>l(i.pet.skill)},i.pet.skill.id)]})})})},Xg=({battleState:i,isLoading:l,onCombatAction:r,onFlee:c,onOpenCombatLog:d})=>{const[m,f]=v.useState(!1),x=i.playerParty[i.activePlayerCardIndex],h=i.turn==="player"&&!i.isBattleOver&&!l,g=b=>{const y=typeof b=="string"?b:b.name;r(y),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("footer",{className:"w-full h-28 bg-black/90 p-4 flex items-center justify-center border-t border-stone-700",children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:d,className:"w-32 h-14 text-lg bg-stone-800/80 hover:bg-stone-700/80 rounded-md font-serif border border-stone-600/50",children:"记录"}),e.jsx("button",{onClick:()=>f(!0),disabled:!h,className:"w-40 h-16 text-xl bg-sky-700/80 hover:bg-sky-600/90 rounded-lg font-serif border-2 border-sky-500/80 text-white font-bold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-sky-500/30",children:"行动"}),e.jsx("button",{onClick:c,className:"w-32 h-14 text-lg bg-red-800/80 hover:bg-red-700/80 rounded-md font-serif border border-red-600/50 text-white",children:"逃命"})]})}),m&&e.jsx(Jg,{activeCard:x,onAction:g,onClose:()=>f(!1)})]})};var vf=nf();const Pg=i=>i?i.includes("提升")||i.includes("盾")?"⬆️":i.includes("下降")||i.includes("弱")?"⬇️":i.includes("毒")||i.includes("灼烧")?"☠️":i.includes("晕")||i.includes("锁")||i.includes("混乱")?"😵":"✨":"✨",Zg=({effect:i,onClose:l})=>vf.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[110] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"状态详情"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"p-6 font-serif flex-grow flex flex-col items-center",children:[e.jsx("div",{className:"text-6xl mb-3",children:Pg(i.name)}),e.jsx("h3",{className:"text-3xl font-bold text-white text-center",children:i.name||"未知状态"}),e.jsxs("p",{className:"text-lg text-amber-400 font-mono mt-1 mb-6",children:["剩余 ",i.duration??0," 回合"]}),e.jsxs("div",{className:"w-full space-y-4 text-left",children:[e.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"效果描述"}),e.jsx("p",{className:"text-gray-300 leading-relaxed text-base",children:i.description||"无描述"})]}),i.mechanicsDescription&&e.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"机制说明"}),e.jsx("p",{className:"text-amber-200 leading-relaxed text-base",children:i.mechanicsDescription})]})]})]})]})}),document.body),Kg=i=>i?i.includes("提升")||i.includes("盾")?"⬆️":i.includes("下降")||i.includes("弱")?"⬇️":i.includes("毒")||i.includes("灼烧")?"☠️":i.includes("晕")||i.includes("锁")||i.includes("混乱")?"😵":"✨":"✨",Fg=({effects:i,onClose:l})=>{const[r,c]=v.useState(null),d=i.filter(m=>m&&m.name);return vf.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-2xl shadow-2xl rounded-lg",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20 border-b border-stone-700 rounded-t-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"特殊状态一览"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:d.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-4xl mb-2",children:"🌟"}),e.jsx("p",{className:"text-gray-400",children:"当前无特殊状态"})]}):e.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map((m,f)=>e.jsxs("button",{onClick:()=>c(m),className:"p-4 bg-stone-900/60 rounded-lg border border-stone-600/50 hover:border-amber-500/50 hover:bg-stone-800/60 transition-all flex items-center gap-3 text-left",children:[e.jsx("span",{className:"text-2xl",children:Kg(m.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium text-sm",children:m.name||"未知状态"}),e.jsxs("p",{className:"text-xs text-amber-400",children:["剩余 ",m.duration??0," 回合"]})]})]},`${m.name}-${f}`))})}),e.jsx("div",{className:"p-3 bg-black/20 border-t border-stone-700 rounded-b-lg text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"点击状态查看详细机制说明"})})]})}),r&&e.jsx(Zg,{effect:r,onClose:()=>c(null)})]}),document.body)},Mx=({value:i,maxValue:l,color:r,label:c})=>{const d=l>0?i/l*100:0,m=c==="气血"&&d<30;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5 text-white z-10 relative px-1",children:[e.jsx("span",{className:"text-[10px] font-bold drop-shadow-sm shadow-black",children:c}),e.jsx("span",{className:`text-[10px] font-mono drop-shadow-sm shadow-black ${m?"text-red-400 animate-pulse":""}`,children:`${i}/${l}`})]}),e.jsx("div",{className:"w-full bg-stone-900/50 rounded-full h-2.5 border border-stone-600/50 shadow-inner shadow-black/50 overflow-hidden",children:e.jsx("div",{className:`${r} h-full rounded-full transition-all duration-500 ease-in-out relative ${m?"animate-pulse":""}`,style:{width:`${d}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"})})})]})},Ax=({participant:i,isPlayer:l,wasHit:r})=>{const{card:c,currentHp:d,currentMp:m,statusEffects:f}=i,[x,h]=v.useState(!1),[g,b]=v.useState(!1),y=l?"border-sky-500/70 shadow-glow-blue":"border-red-500/70 shadow-glow-red";v.useEffect(()=>{if(r){h(!0);const C=setTimeout(()=>h(!1),500);return()=>clearTimeout(C)}},[r]);const S=x?"animate-shake":"";return e.jsxs(e.Fragment,{children:[g&&e.jsx(Fg,{effects:f,onClose:()=>b(!1)}),e.jsxs("div",{className:`w-full max-w-[280px] bg-gradient-to-br from-stone-800/90 to-stone-900/90 rounded-lg border-2 ${y} shadow-lg shadow-black/50 backdrop-blur-sm transition-all duration-300 ${S} p-3`,children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white font-serif text-shadow-glow",children:c.name}),e.jsx("p",{className:`font-medium text-sm ${Me(c.rarity)}`,children:c.realm})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Mx,{value:d,maxValue:c.baseAttributes.maxHp,color:"bg-gradient-to-r from-red-700 via-red-600 to-red-500",label:"气血"}),e.jsx(Mx,{value:m,maxValue:c.baseAttributes.maxMp,color:"bg-gradient-to-r from-blue-700 via-blue-600 to-blue-500",label:"真元"})]}),e.jsx("div",{className:"mt-3 h-8 flex items-center justify-center",children:e.jsxs("button",{onClick:()=>b(!0),className:"px-3 py-1 bg-stone-900/70 rounded-full text-xs border border-stone-500 hover:border-amber-500 hover:bg-stone-800 transition-all flex items-center gap-1.5",children:[e.jsx("span",{children:"状态"}),f.length>0&&e.jsx("span",{className:"bg-amber-500 text-black px-1.5 rounded-full font-bold",children:f.length})]})})]})]})},Wg=({animation:i})=>{const l=()=>{const r="text-6xl md:text-8xl text-yellow-300 drop-shadow-[0_0_15px_rgba(252,211,77,0.7)]";switch(i.effect){case"slash":return e.jsx("div",{className:r,children:"⚔️"});case"fire":return e.jsx("div",{className:r,children:"🔥"});case"heal":return e.jsx("div",{className:"text-6xl md:text-8xl text-green-400 drop-shadow-[0_0_15px_rgba(74,222,128,0.7)]",children:"✨"});case"shield":return e.jsx("div",{className:"text-6xl md:text-8xl text-sky-400 drop-shadow-[0_0_15px_rgba(56,189,248,0.7)]",children:"🛡️"});default:return e.jsx("div",{className:r,children:"💥"})}};return e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none animate-flash",children:e.jsx("div",{className:"relative w-32 h-32",children:l()})},i.key)},Tx=({pet:i})=>e.jsxs("div",{className:"w-24 h-32 bg-stone-800/70 rounded-lg border border-stone-600 p-2 flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"text-2xl",children:"🐾"}),e.jsx("p",{className:"text-xs font-bold text-white truncate",children:i.name}),e.jsxs("p",{className:"text-[10px] text-amber-400",children:["[",i.rarity,"]"]})]}),eb=({player:i,opponent:l,animation:r,lastHit:c})=>e.jsxs("div",{className:"w-full h-full relative flex justify-around items-center p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"animate-fade-in transition-transform duration-300 hover:scale-105",children:e.jsx(Ax,{participant:i,isPlayer:!0,wasHit:c==="player"})}),i.pet&&e.jsx("div",{className:"animate-fade-in-right",children:e.jsx(Tx,{pet:i.pet})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",children:r&&e.jsx(Wg,{animation:r})}),e.jsxs("div",{className:"flex items-center gap-4",children:[l.pet&&e.jsx("div",{className:"animate-fade-in-left",children:e.jsx(Tx,{pet:l.pet})}),e.jsx("div",{className:"animate-fade-in transition-transform duration-300 hover:scale-105",children:e.jsx(Ax,{participant:l,isPlayer:!1,wasHit:c==="opponent"})})]})]}),tb=({victory:i,isFled:l=!1,onClose:r})=>{if(i===null)return null;const c=l?"逃命":i?"胜利":"败北",d=l?"text-orange-400":i?"text-amber-400":"text-stone-400",m=l?"🏃":i?"⚔️":"💀";return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-stone-800/90 ornate-border backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:m}),e.jsx("h2",{className:`text-5xl font-bold mb-4 font-serif ${d}`,children:c}),l&&e.jsx("p",{className:"text-stone-300 mb-6 text-lg",children:"你成功逃离了战斗，但这次战斗被判定为失败。"}),e.jsx("button",{onClick:r,className:"bg-amber-600 text-white font-bold px-8 py-3 rounded-md hover:bg-amber-500 transition-colors text-lg",children:"继续"})]})})},jf=()=>{const[i,l]=v.useState({isCompact:!1,isMiniMode:!1,isMobile:!1,availableHeight:window.innerHeight,availableWidth:window.innerWidth,contentHeight:window.innerHeight,shouldHideTopBar:!1});return v.useEffect(()=>{const r=()=>{const d=window.innerHeight,m=window.innerWidth,f=d<500,x=d<600,h=m<768,g=f?0:x?48:64,b=x?80:112,y=d-g-b;l({isCompact:x,isMiniMode:f,isMobile:h,availableHeight:d,availableWidth:m,contentHeight:Math.max(y,200),shouldHideTopBar:f})};r(),window.addEventListener("resize",r);const c=new ResizeObserver(r);return c.observe(document.body),()=>{window.removeEventListener("resize",r),c.disconnect()}},[]),i},sb=()=>{const[i,l]=v.useState(!1),[r,c]=v.useState(0);return v.useEffect(()=>{const d=()=>{const m=window.scrollY;m>r&&m>50?l(!0):l(!1),c(m)};return window.addEventListener("scroll",d,{passive:!0}),()=>window.removeEventListener("scroll",d)},[r]),i},$x=({label:i,icon:l,onClick:r,color:c,badge:d,isCompact:m})=>e.jsxs("button",{onClick:r,className:`relative flex flex-col items-center justify-center ${m?"w-12 h-12":"w-14 h-14"} text-stone-300 rounded-lg bg-gradient-to-br from-stone-900/70 to-stone-950/90 hover:from-stone-800/90 hover:to-stone-900/90 hover:text-amber-300 transition-all duration-300 active:scale-95 border border-xianxia-gold-600/30 hover:border-xianxia-gold-500/50 backdrop-blur-sm hover:shadow-glow-gold ${c||""}`,title:i,children:[e.jsx("i",{className:`${l} ${m?"text-lg":"text-xl"}`}),!m&&e.jsx("span",{className:"text-[10px] mt-1 font-semibold",children:i}),d!==void 0&&d>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs rounded-full flex items-center justify-center font-bold shadow-glow-red animate-pulse-slow",children:d>9?"9+":d})]}),ab=i=>{const{gameState:l,isLoading:r,error:c,onExplorationAction:d,onNavClick:m,onMapClick:f,onInteractClick:x,onTelepathyClick:h,onSystemClick:g,onQuestClick:b,onBusinessClick:y,onNextDay:S,onHospitalClick:C,onBountyBoardClick:A,onAnnouncementsClick:E,onCultivationClick:$,onMemoryClick:Z,onCharacterStatusClick:R,onPrisonClick:V,onEtiquetteHallClick:J,onGauntletClick:D}=i,[T,G]=v.useState(""),[_,M]=v.useState(!1),U=jf(),k=Y=>{Y.preventDefault(),T.trim()&&!r&&(d(T.trim()),G(""))},Q=[{label:"探索",icon:"fa-solid fa-map-location-dot",onClick:f},{label:"队伍",icon:"fa-solid fa-users",onClick:()=>m("队伍")},{label:"背包",icon:"fa-solid fa-briefcase",onClick:()=>m("背包")},{label:"活动",icon:"fa-solid fa-trophy",onClick:()=>m("竞技场"),badge:l.playerProfile.quests.filter(Y=>Y.status==="In Progress").length},{label:"更多",icon:"fa-solid fa-ellipsis-vertical",onClick:()=>M(!_)}],ne=[{label:"商城",icon:"fa-solid fa-store",onClick:()=>m("商城")},{label:"任务",icon:"fa-solid fa-scroll",onClick:b},{label:"大闯关",icon:"fa-solid fa-crown",onClick:D,color:"text-amber-400"},{label:"记忆",icon:"fa-solid fa-book-open",onClick:Z,color:"text-pink-400"},{label:"传音",icon:"fa-solid fa-om",onClick:h,color:"text-cyan-400"},{label:"育灵轩",icon:"fa-solid fa-dna",onClick:$,color:"text-purple-400"},{label:"产业",icon:"fa-solid fa-building",onClick:y},{label:"医馆",icon:"fa-solid fa-hospital",onClick:C},{label:"红尘录",icon:"fa-solid fa-book-skull",onClick:A},{label:"镇狱大牢",icon:"fa-solid fa-dungeon",onClick:V,color:"text-red-400"},{label:"礼仪设计馆",icon:"fa-solid fa-ribbon",onClick:J,color:"text-pink-400"},{label:"江湖传闻",icon:"fa-solid fa-bullhorn",onClick:E},{label:"人物状态",icon:"fa-solid fa-users-viewfinder",onClick:R,color:"text-teal-400"},{label:"系统",icon:"fa-solid fa-bars",onClick:g}];return e.jsxs(e.Fragment,{children:[_&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 backdrop-blur-sm animate-fade-in flex items-end justify-center pb-24",onClick:()=>M(!1),children:e.jsxs("div",{className:"w-[90vw] max-w-md ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-900/98 via-stone-950/98 to-black/98 rounded-2xl p-5 shadow-glow-gold backdrop-blur-md animate-slide-in mb-4",onClick:Y=>Y.stopPropagation(),style:{maxHeight:"calc(100vh - 240px)",overflowY:"auto"},children:[e.jsx("h3",{className:"text-gradient-gold text-center font-bold mb-3 text-lg",children:"更多功能"}),e.jsx("div",{className:"grid grid-cols-4 gap-3 mb-3",children:ne.map(Y=>e.jsx($x,{...Y,isCompact:!1,onClick:()=>{Y.onClick(),M(!1)}},Y.label))}),e.jsx("button",{onClick:()=>M(!1),className:"w-full py-2.5 text-stone-400 hover:text-amber-300 text-sm transition-all duration-300 hover:scale-105 bg-stone-800/50 hover:bg-stone-700/60 rounded-lg mt-1",children:"收起 ▼"})]})}),e.jsx("footer",{className:`fixed bottom-0 left-0 right-0 w-full bg-gradient-to-t from-black/98 via-stone-950/90 to-transparent backdrop-blur-md z-20 border-t border-xianxia-gold-700/20 ${U.isCompact?"p-2":"p-3"}`,children:e.jsxs("div",{className:"w-full max-w-screen-lg mx-auto flex flex-col gap-2",children:[e.jsx("div",{className:U.isCompact?"order-2":"order-1",children:r?e.jsx("div",{className:"flex items-center justify-center h-16",children:e.jsxs("div",{className:"flex items-center gap-3 glass-morphism px-6 py-3 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse shadow-glow-gold"}),e.jsx("span",{className:"text-gradient-gold font-serif text-sm text-shadow-glow",children:"天地变幻中..."}),e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse shadow-glow-gold",style:{animationDelay:"0.3s"}})]})}):e.jsxs(e.Fragment,{children:[c&&e.jsxs("div",{className:"text-red-300 text-center mb-2 font-serif text-xs bg-gradient-to-r from-red-900/30 to-red-800/30 py-1.5 px-3 rounded-lg border border-red-500/50 shadow-glow-red animate-shake",children:["⚠️ ",c]}),e.jsx("div",{className:`flex flex-wrap justify-center gap-2 ${U.isCompact?"mb-1":"mb-2"}`,children:l.exploration.choices.slice(0,U.isMobile?2:3).map((Y,X)=>e.jsx("button",{onClick:()=>d(Y),className:`flex-1 min-w-[120px] max-w-[200px] text-center bg-gradient-to-br from-stone-800/80 to-stone-900/90 ${U.isCompact?"px-2 py-1.5 text-xs":"px-3 py-2 text-sm"} rounded-lg hover:from-stone-700/90 hover:to-stone-800/90 hover:border-xianxia-gold-500/60 border border-xianxia-gold-600/30 transition-all duration-300 active:scale-95 font-serif shadow-lg backdrop-blur-sm hover:shadow-glow-gold hover:text-amber-200`,children:Y},X))}),e.jsxs("form",{onSubmit:k,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:Y=>G(Y.target.value),placeholder:"输入行动...",className:`flex-1 bg-gradient-to-br from-stone-900/90 to-black/90 border border-xianxia-gold-700/40 rounded-lg ${U.isCompact?"px-2 py-1 text-xs":"px-3 py-1.5 text-sm"} focus:outline-none focus:ring-2 focus:ring-xianxia-gold-500/60 focus:border-xianxia-gold-500 font-serif shadow-inner backdrop-blur-sm text-gray-200 placeholder-gray-500`}),e.jsx("button",{type:"submit",disabled:!T.trim(),className:`bg-gradient-to-br from-amber-600 via-amber-700 to-amber-800 text-white font-bold ${U.isCompact?"px-3 py-1 text-xs":"px-4 py-1.5 text-sm"} rounded-lg hover:from-amber-500 hover:via-amber-600 hover:to-amber-700 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-serif shadow-glow-gold text-shadow-glow`,children:"确定"}),!U.isCompact&&e.jsx("button",{type:"button",onClick:S,className:"bg-gradient-to-br from-indigo-600 to-indigo-700 text-white font-bold px-4 py-1.5 text-sm rounded-lg hover:from-indigo-500 hover:to-indigo-600 active:scale-95 transition-all duration-300 shadow-glow-blue",children:"下一天 ⏭"})]})]})}),e.jsx("div",{className:U.isCompact?"order-1":"order-2",children:e.jsx("div",{className:"flex justify-center items-center gap-2",children:Q.map(Y=>e.jsx($x,{...Y,isCompact:U.isCompact},Y.label))})})]})})]})},nb=({isOpen:i,onClose:l,bountyBoard:r,onViewTarget:c,onAccept:d,onClaim:m,onRefresh:f,onAddTarget:x,isLoading:h})=>{const[g,b]=v.useState("悬赏中");if(!i)return null;const y=r.filter(A=>A.status===g),S=({endTime:A})=>{const[E,$]=v.useState(A-Date.now());v.useEffect(()=>{const R=setInterval(()=>{const V=A-Date.now();V<=0&&clearInterval(R),$(V)},1e3);return()=>clearInterval(R)},[A]);const Z=R=>{if(R<=0)return"即将完成...";const V=Math.floor(R/1e3),J=Math.floor(V/3600),D=Math.floor(V%3600/60),T=V%60;return`${J.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`};return e.jsx("span",{className:"font-mono text-amber-400",children:Z(E)})},C=A=>{switch(A.status){case"悬赏中":return e.jsx("button",{onClick:()=>d(A.id),className:"bg-green-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-green-500/80 transition-colors",children:"接受悬赏"});case"追踪中":return e.jsxs("div",{className:"text-center",onClick:E=>E.stopPropagation(),children:[e.jsx("p",{className:"text-sm text-gray-400",children:"剩余时间"}),e.jsx(S,{endTime:A.endTime})]});case"已完成":return e.jsx("button",{onClick:()=>m(A.id),className:"bg-yellow-500/80 text-white font-bold px-4 py-2 rounded-md hover:bg-yellow-400/80 transition-colors animate-pulse-slow",children:"查看结果"});case"已结束":return e.jsx("span",{className:"text-gray-500 font-semibold",children:"已结束"});default:return null}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"红尘录"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-stone-700 bg-black/10",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>b("悬赏中"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${g==="悬赏中"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"悬赏中"}),e.jsx("button",{onClick:()=>b("追踪中"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${g==="追踪中"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"追踪中"}),e.jsx("button",{onClick:()=>b("已完成"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${g==="已完成"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"已完成"}),e.jsx("button",{onClick:()=>b("已结束"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${g==="已结束"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"已结束"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>x("Female"),disabled:h,className:"px-3 py-1 text-xs bg-pink-500/20 text-pink-300 rounded-md hover:bg-pink-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"生成中...":"添加女性目标"}),e.jsx("button",{onClick:()=>x("Male"),disabled:h,className:"px-3 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-md hover:bg-blue-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"生成中...":"添加男性目标"}),e.jsxs("button",{onClick:f,disabled:h,className:"px-3 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded-md hover:bg-yellow-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("i",{className:`fa-solid fa-sync ${h?"animate-spin":""}`})," 刷新悬赏"]})]})]}),e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(A=>e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 flex justify-between items-center",children:[e.jsxs("div",{className:"cursor-pointer flex-grow",onClick:()=>c(A),children:[e.jsxs("h3",{className:`text-xl font-bold font-serif ${Me(A.character.rarity)}`,children:[A.name," ",e.jsxs("span",{className:"text-base font-normal text-gray-400",children:["[",A.character.rarity,"]"]})]}),e.jsxs("p",{className:"text-sm text-gray-400 italic mt-1",children:["线索: ",A.locationHint]}),e.jsxs("p",{className:"text-sm text-pink-400 mt-1",children:["特征: ",A.specialTrait]})]}),e.jsx("div",{className:"w-32 text-center flex-shrink-0",children:C(A)})]},A.id))}):e.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[e.jsx("p",{className:"text-4xl mb-4",children:"📜"}),e.jsx("p",{children:"此榜单上暂无记录。"})]})})]})})},lb=({isOpen:i,onClose:l,bounty:r,onOutcome:c})=>i?e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["任务报告：",r.name]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-400",children:"追捕日志"}),e.jsx("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:e.jsx("p",{className:"text-gray-300 italic leading-relaxed",children:r.trackingLog||"日志在传输过程中遗失了..."})}),e.jsx("h3",{className:"text-lg font-semibold text-amber-400 mt-6",children:"如何处置?"}),e.jsx("p",{className:"text-gray-400",children:"目标已被成功制服，现在，你来决定Ta的命运。"})]}),e.jsxs("div",{className:"p-4 bg-black/20 border-t border-stone-700 flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>c("killed"),className:"px-6 py-2 rounded-md font-semibold text-white bg-red-800 hover:bg-red-700 transition-colors",children:"杀害"}),e.jsx("button",{onClick:()=>c("imprisoned"),className:"px-6 py-2 rounded-md font-semibold text-white bg-sky-600 hover:bg-sky-500 transition-colors",children:"压入大牢"})]})]})}):null,Cs=i=>{const l=JSON.parse(JSON.stringify(i.baseAttributes)),r=Object.values(i.equipment);for(const c of r)if(c){for(const[d,m]of Object.entries(c.stats))if(m!==void 0)switch(d){case"hp":l.maxHp+=m;break;case"mp":l.maxMp+=m;break;case"attack":l.attack+=m;break;case"defense":l.defense+=m;break;case"speed":l.speed+=m;break;case"critRate":l.critRate+=m;break;case"critDmg":l.critDmg+=m;break}}return l.hp=l.maxHp,l.mp=l.maxMp,l},rb={p_brothel_star:1.5,p_brothel_tutor:1.2,p_brothel_guard:.5,p_arena_gladiator:1.8,p_arena_host:1.1,p_arena_trader:1,p_alchemy_chief:2,p_alchemy_apprentice:.8,p_auction_master:2.5,p_auction_appraiser:1.5,p_intel_chief:2.2,p_intel_assassin:1.7},ib={青楼:10,角斗场:5,炼丹房:2,拍卖行:0,情报阁:0};function Nf(i,l){if(!i.businessDistrict)return 0;const{shops:r,level:c}=i.businessDistrict;let d=0;if((l?r.filter(f=>f.id===l):r).forEach(f=>{let x=(ib[f.type]||0)*(1+(f.level-1)*.2);f.staff.forEach(h=>{const g=i.cardCollection.find(y=>y.id===h.characterId),b=fr[h.positionId];if(g&&b){const y=b.requiredAttr,S=g[y]||10,C=rb[h.positionId]||1,A=S/10*C;x+=A}}),d+=x}),!l){d*=1+(c-1)*.1;const f=i.reputation.score/5e3;d*=1+f}return Math.floor(d)}const ob=({isOpen:i,onClose:l,playerProfile:r,onUpdateProfile:c,onOpenSurveillance:d,busyCharacterIds:m,onOpenSelector:f,etiquetteSystem:x})=>{const[h,g]=v.useState("青楼"),[b,y]=v.useState(!1),{businessDistrict:S,cardCollection:C}=r,A=J=>{if(!x)return{language:[],behavior:[]};const D=J,T=x.languageEtiquettes.filter(_=>{var M;return _.isDistributed&&((M=_.distributions)==null?void 0:M.some(U=>U.shopType===D&&U.status==="distributed"))}),G=x.behaviorDressEtiquettes.filter(_=>{var M;return _.isDistributed&&((M=_.distributions)==null?void 0:M.some(U=>U.shopType===D&&U.status==="distributed"))});return{language:T,behavior:G}},E=v.useMemo(()=>A(h),[h,x]),$=v.useMemo(()=>{if(!S)return{};const J={};return S.shops.forEach(D=>{J[D.id]=Nf(r,D.id)}),J},[r,S]);if(!i)return null;const Z=()=>{if(!S)return C.filter(D=>!m.has(D.id));const J=new Set(S.shops.flatMap(D=>D.staff.map(T=>T.characterId)));return C.filter(D=>!J.has(D.id)&&!m.has(D.id))},R=(J,D,T)=>{if(!S)return;const G=JSON.parse(JSON.stringify(S)),_=G.shops.find(M=>M.id===J);_&&(G.shops.forEach(M=>{M.staff=M.staff.filter(U=>U.characterId!==T)}),_.staff.push({characterId:T,positionId:D}),c({...r,businessDistrict:G}))},V=(J,D)=>{if(!S)return;const T=JSON.parse(JSON.stringify(S)),G=T.shops.find(_=>_.id===J);G&&(G.staff=G.staff.filter(_=>_.characterId!==D),c({...r,businessDistrict:T}))};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:S?S.name:"产业管理"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),S?e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"font-semibold text-amber-400 mb-2",children:"街区总览"}),e.jsxs("p",{className:"text-gray-300",children:["等级: ",e.jsx("span",{className:"font-mono",children:S.level})]}),e.jsxs("p",{className:"text-gray-300",children:["店铺数量: ",e.jsx("span",{className:"font-mono",children:S.shops.length})]})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 h-96 overflow-y-auto",children:[e.jsx("h3",{className:"font-semibold text-amber-400 mb-2",children:"经营日志"}),e.jsx("ul",{className:"space-y-2 text-sm",children:S.log.map((J,D)=>e.jsxs("li",{className:"text-gray-400",children:[e.jsxs("span",{className:"font-mono text-gray-500 mr-2",children:["[",J.timestamp,"]"]}),J.message]},D))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"flex border-b border-stone-700 mb-4",children:["青楼","角斗场","炼丹房","拍卖行","情报阁"].map(J=>{const D=S.shops.some(T=>T.type===J);return e.jsx("button",{disabled:!D,onClick:()=>g(J),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 disabled:text-gray-600 disabled:cursor-not-allowed ${h===J?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:J},J)})}),e.jsxs("div",{className:"space-y-4",children:[b&&(E.language.length>0||E.behavior.length>0)&&e.jsxs("div",{className:"mb-4 p-4 bg-pink-900/20 rounded-lg border border-pink-500/30",children:[e.jsxs("h3",{className:"text-lg font-bold text-pink-300 mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-scroll"}),"当前生效的礼仪规范"]}),E.language.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-pink-400 mb-2",children:"💬 语言铁律"}),e.jsx("div",{className:"space-y-2",children:E.language.map(J=>e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded border border-pink-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-white text-sm",children:J.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["👥 ",J.applicableRoles.join(", ")]})]}),e.jsx("p",{className:"text-xs text-gray-300 line-clamp-2",children:J.content})]},J.id))})]}),E.behavior.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-400 mb-2",children:"👗 行为着装铁律"}),e.jsx("div",{className:"space-y-2",children:E.behavior.map(J=>e.jsxs("div",{className:"p-2 bg-stone-800/50 rounded border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-white text-sm",children:J.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["👥 ",J.applicableRoles.join(", ")]})]}),e.jsxs("div",{className:"text-xs text-gray-300",children:[J.dressCode.upper&&e.jsxs("p",{className:"line-clamp-1",children:["上身: ",J.dressCode.upper]}),J.dressCode.lower&&e.jsxs("p",{className:"line-clamp-1",children:["下身: ",J.dressCode.lower]})]})]},J.id))})]})]}),S.shops.filter(J=>J.type===h).map(J=>e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h3",{className:"font-semibold text-lg text-cyan-400",children:[J.type," (Lv. ",J.level,")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["预期日收入: ",e.jsxs("span",{className:"font-mono text-amber-400",children:[$[J.id]||0," 灵石"]})]}),e.jsxs("button",{onClick:()=>y(!b),className:`text-xs px-2 py-1 rounded-md transition-colors ${b?"bg-pink-600/50 text-pink-300":"bg-stone-600/50 text-gray-300 hover:bg-pink-600/30"}`,children:[e.jsx("i",{className:"fa-solid fa-scroll mr-1"}),"礼仪 (",E.language.length+E.behavior.length,")"]}),e.jsx("button",{onClick:()=>d(J),className:"text-xs bg-purple-600/50 text-purple-300 px-2 py-1 rounded-md hover:bg-purple-600/80",children:"监视"})]})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(fr).filter(([,D])=>D.shop===J.type).map(([D,T])=>{const G=J.staff.find(M=>M.positionId===D),_=G?C.find(M=>M.id===G.characterId):null;return e.jsxs("div",{className:"flex items-center justify-between bg-stone-800/50 p-2 rounded-md",children:[e.jsx("span",{className:"text-gray-300",children:T.name}),_?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-amber-300",children:_.name}),e.jsx("button",{onClick:()=>V(J.id,_.id),className:"text-red-500 hover:text-red-400 text-xs",children:"卸下"})]}):e.jsx("button",{onClick:()=>{const M=Z();f(`为【${T.name}】选择员工`,M,U=>{R(J.id,D,U.id)})},className:"bg-stone-700 text-white text-sm rounded px-2 py-1 hover:bg-stone-600",children:"选择员工"})]},D)})})]},J.id))]})]})]})}):e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("p",{className:"text-4xl mb-4",children:"🏯"}),e.jsx("p",{children:"你还未拥有自己的产业。"}),e.jsx("p",{className:"text-sm mt-2",children:"完成特定任务或积累足够资本，开启你的商业帝国吧！"})]})})]})})},cb=({isOpen:i,onClose:l,challenge:r,onAccept:c,onDecline:d})=>i?e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col items-center p-6 text-center",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"p-4 text-center",children:e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"挑战"})}),e.jsxs("div",{className:"p-6 font-serif flex flex-col justify-center items-center",children:[e.jsx("p",{className:"text-4xl mb-4",children:"⚔️"}),e.jsxs("p",{className:"text-white text-lg",children:[e.jsx("span",{className:"font-bold text-red-400",children:r.challengerName})," 向你发起了挑战！"]}),e.jsxs("p",{className:"text-amber-300 mt-2 italic",children:['"',r.reason,'"']}),e.jsxs("div",{className:"flex justify-center gap-4 mt-8",children:[e.jsx("button",{onClick:d,className:"px-6 py-2 bg-stone-600 hover:bg-stone-500 rounded-md font-semibold text-white",children:"拒绝挑战"}),e.jsx("button",{onClick:c,className:"px-6 py-2 bg-red-700 text-white hover:bg-red-600 rounded-md font-bold",children:"接受挑战"})]})]})]})}):null,db=i=>({attack:"攻击",defense:"防御",hp:"气血",speed:"速度",critRate:"会心率",critDmg:"会心伤害"})[i]||i,Dx=(i,l)=>i==="critRate"||i==="critDmg"?`${(l*100).toFixed(0)}%`:l>0?`+${l}`:`${l}`,ub=({playerProfile:i,card:l,selectionState:r,onClose:c,onEquip:d,onLearnSkill:m,onEquipPet:f})=>{const[x,h]=v.useState(null),g=V=>V.type==="equipment",b=V=>V.type==="skill",y=V=>V.type==="pet",S=(V,J)=>e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-bold ${Me(V.rarity)}`,children:V.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:[V.type," (",!V.genderLock||V.genderLock==="Universal"?"通用":V.genderLock==="Male"?"男性专用":"女性专用",")"]}),e.jsx("div",{className:"space-y-2",children:Object.entries(V.stats).map(([D,T])=>{const G=(J==null?void 0:J.stats[D])||0,_=T-G;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-300",children:db(D)}),e.jsxs("div",{className:"flex items-center gap-2",children:[J&&e.jsx("span",{className:"text-gray-500",children:Dx(D,G)}),e.jsx("span",{className:`font-semibold ${_>0?"text-green-400":_<0?"text-red-400":"text-white"}`,children:Dx(D,T)}),J&&_!==0&&e.jsxs("span",{className:`text-xs w-16 text-center font-mono ${_>0?"text-green-500":"text-red-500"}`,children:["(",_>0?"+":"",_,")"]})]})]},D)})})]}),C=V=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-baseline gap-2",children:[e.jsx("span",{className:`${Me(V.rarity)}`,children:V.name}),e.jsxs("span",{className:`text-base font-medium ${Me(V.rarity)}`,children:["[",V.rarity,"]"]})]}),e.jsxs("span",{className:"text-base font-mono text-blue-400",children:[V.cost," 真元"]})]}),e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["(",V.genderLock==="Universal"?"通用":V.genderLock==="Male"?"男性专用":"女性专用",")"]}),e.jsx("p",{className:"text-sm font-semibold text-amber-300 mt-2",children:V.mechanicsDescription}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:V.description})]}),A=V=>e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-bold ${Me(V.rarity)}`,children:V.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["(",V.gender==="Male"?"雄性":"雌性",")"]}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:V.description}),e.jsxs("div",{className:"bg-stone-800/50 p-3 rounded-md",children:[e.jsxs("h4",{className:"font-semibold text-amber-400 mb-2",children:["技能: ",V.skill.name]}),e.jsx("p",{className:"text-sm font-semibold text-amber-300",children:V.skill.mechanicsDescription}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:V.skill.description})]})]}),E=()=>g(r)?`选择${{weapon:"武器",armor:"衣服",accessory1:"配饰",accessory2:"配饰"}[r.slot]}`:y(r)?"选择出战兽宠":"选择通用技能",Z=(()=>{if(g(r))return i.equipmentInventory.filter(V=>V.type===r.slotType&&(!V.genderLock||V.genderLock==="Universal"||V.genderLock===l.gender));if(b(r)){const V=new Set(l.skills.map(J=>J==null?void 0:J.id).filter(Boolean));return i.universalSkills.filter(J=>!V.has(J.id)&&(J.genderLock==="Universal"||J.genderLock===l.gender))}if(y(r)){const V=new Set([...i.maleParty,...i.femaleParty].map(J=>{var D;return(D=J.pet)==null?void 0:D.id}).filter(Boolean));return i.petCollection.filter(J=>J.gender===l.gender&&!V.has(J.id))}return[]})(),R=g(r)?l.equipment[r.slot]:null;return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:c,children:e.jsxs("div",{className:"bg-slate-900/90 border border-slate-700 rounded-xl w-full max-w-2xl h-[70vh] shadow-2xl flex flex-col backdrop-blur-lg",onClick:V=>V.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700 flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-white font-serif",children:E()}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-grow flex flex-row overflow-hidden",children:[e.jsx("div",{className:"w-2/5 border-r border-slate-700 overflow-y-auto",children:Z.length>0?Z.map(V=>e.jsx("button",{onClick:()=>h(V),className:`w-full text-left p-3 text-sm transition-colors duration-150 ${(x==null?void 0:x.id)===V.id?"bg-amber-600/30":"hover:bg-slate-800/60"}`,children:e.jsxs("p",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx("span",{className:`${Me(V.rarity)}`,children:V.name}),"rarity"in V&&e.jsxs("span",{className:`text-xs font-medium ${Me(V.rarity)}`,children:["[",V.rarity,"]"]})]})},V.id)):e.jsx("p",{className:"p-4 text-sm text-gray-500",children:"无可用选项"})}),e.jsxs("div",{className:"w-3/5 p-4 flex flex-col justify-between",children:[e.jsx("div",{children:x?g(r)?S(x,R):y(r)?A(x):C(x):e.jsx("div",{className:"text-center text-gray-500 pt-10",children:e.jsx("p",{children:"从左侧列表选择一项以预览详情"})})}),x&&e.jsx("button",{onClick:()=>{g(r)&&d(r.slot,x),b(r)&&m(r.slotIndex,x),y(r)&&f(x)},className:"w-full bg-amber-600 text-white font-bold py-2 px-4 rounded-md hover:bg-amber-500 transition-colors",children:g(r)||y(r)?"装备":"学习"})]})]})]})})},Od=({skill:i,onClose:l})=>{const r=i.genderLock==="Universal"?"通用":i.genderLock==="Male"?"男性专用":"女性专用";return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-xl w-full max-w-md shadow-2xl flex flex-col backdrop-blur-lg bg-slate-800/90",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-white font-serif flex items-baseline gap-2",children:[e.jsx("span",{children:i.name}),e.jsxs("span",{className:`text-base font-medium ${Me(i.rarity)}`,children:["[",i.rarity,"]"]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 font-serif",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-400",children:"技能详情"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-base font-mono text-blue-400",children:i.cost>0?`${i.cost} 真元`:"无消耗"}),e.jsx("p",{className:"text-sm text-gray-400",children:r})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-pink-400 mb-1 text-base",children:"动画描述"}),e.jsxs("p",{className:"text-gray-300 leading-relaxed text-sm italic",children:["“",i.eroticDescription,"”"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sky-400 mb-1 text-base",children:"机制描述"}),e.jsx("p",{className:"text-gray-300 leading-relaxed text-sm",children:i.mechanicsDescription})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-500 mb-1 text-base",children:"背景描述"}),e.jsx("p",{className:"text-gray-400 leading-relaxed mt-2 text-sm italic",children:i.description})]})]})]})]})})},_x=({value:i,maxValue:l,color:r,label:c})=>{const d=l>0?i/l*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:c}),e.jsx("span",{className:"text-sm font-mono text-gray-400",children:`${Math.round(i)}/${Math.round(l)}`})]}),e.jsx("div",{className:"w-full bg-stone-900 rounded-full h-2.5 border border-stone-700 shadow-inner shadow-black/50",children:e.jsx("div",{className:`${r} h-full rounded-full transition-all duration-500 ease-in-out`,style:{width:`${d}%`}})})]})},mb=({attributes:i,card:l})=>{const r=[{label:"攻击",value:Math.round(i.attack)},{label:"防御",value:Math.round(i.defense)},{label:"速度",value:Math.round(i.speed)}],c=[{label:"会心率",value:`${(i.critRate*100).toFixed(0)}%`},{label:"会心伤害",value:`${(i.critDmg*100).toFixed(0)}%`}],d=[{label:"魅力",value:l.charm||0},{label:"技巧",value:l.skillfulness||0},{label:"悟性",value:l.perception||0}];return e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg h-full flex flex-col border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"面板属性"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_x,{value:i.hp,maxValue:i.maxHp,color:"bg-gradient-to-r from-red-600 to-red-400",label:"气血"}),e.jsx(_x,{value:i.mp,maxValue:i.maxMp,color:"bg-gradient-to-r from-blue-600 to-blue-400",label:"真元"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4 text-center",children:r.map(m=>e.jsxs("div",{className:"bg-stone-700/50 p-2 rounded-md",children:[e.jsx("p",{className:"text-xs text-gray-400",children:m.label}),e.jsx("p",{className:"font-bold text-white",children:m.value})]},m.label))}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2 text-center",children:c.map(m=>e.jsxs("div",{className:"bg-stone-700/50 p-2 rounded-md",children:[e.jsx("p",{className:"text-xs text-gray-400",children:m.label}),e.jsx("p",{className:"font-bold text-white",children:m.value})]},m.label))}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2 text-center",children:d.map(m=>e.jsxs("div",{className:"bg-stone-700/50 p-2 rounded-md",children:[e.jsx("p",{className:"text-xs text-gray-400",children:m.label}),e.jsx("p",{className:"font-bold text-white",children:m.value})]},m.label))})]})},Wi=({card:i,onClose:l,playerProfile:r,setPlayerProfile:c,onViewPet:d})=>{var V,J,D;const[m,f]=v.useState(null),[x,h]=v.useState(null),g=v.useMemo(()=>{const T=r.maleParty.find(M=>M.id===i.id),G=r.femaleParty.find(M=>M.id===i.id),_=r.cardCollection.find(M=>M.id===i.id);return T||G||_||i},[r,i.id]),b=v.useMemo(()=>Cs(g),[g]),y=T=>{const G=JSON.parse(JSON.stringify(r)),_=G.cardCollection.find(Q=>Q.id===i.id),M=G.maleParty.find(Q=>Q.id===i.id),U=G.femaleParty.find(Q=>Q.id===i.id),k=[_,M,U].filter(Boolean);if(k.length>0){const Q=k[0];T(Q,G);const ne=JSON.stringify(Q);_&&Object.assign(_,JSON.parse(ne)),M&&Object.assign(M,JSON.parse(ne)),U&&Object.assign(U,JSON.parse(ne))}c(G)},S=(T,G)=>{y((_,M)=>{const U=_.equipment[T],k=M.equipmentInventory.findIndex(ne=>ne.id===G.id);k>-1&&M.equipmentInventory.splice(k,1),U&&M.equipmentInventory.push(U),_.equipment[T]=G;const Q=Cs(_);_.baseAttributes.hp=Q.maxHp,_.baseAttributes.mp=Q.maxMp}),f(null)},C=T=>{y((G,_)=>{const M=G.equipment[T];if(M){_.equipmentInventory.push(M),G.equipment[T]=null;const U=Cs(G);G.baseAttributes.hp=U.maxHp,G.baseAttributes.mp=U.maxMp}})},A=(T,G)=>{y(_=>{_.skills[T]=G}),f(null)},E=T=>{y(G=>{G.skills[T]=null})},$=T=>{y((G,_)=>{const M=G.pet,U=_.petCollection.findIndex(k=>k.id===T.id);U>-1&&_.petCollection.splice(U,1),M&&_.petCollection.push(M),G.pet=T}),f(null)},Z=()=>{y((T,G)=>{const _=T.pet;_&&(G.petCollection.push(_),T.pet=null)})},R=[{key:"weapon",label:"武器",type:"Weapon"},{key:"armor",label:"衣服",type:"Armor"},{key:"accessory1",label:"配饰一",type:"Accessory"},{key:"accessory2",label:"配饰二",type:"Accessory"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-5xl h-[90vh] overflow-hidden shadow-2xl flex flex-col",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"p-4 flex-shrink-0 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white font-serif flex items-baseline gap-3",children:[e.jsx("span",{children:g.name}),e.jsxs("span",{className:`text-lg font-medium ${Me(g.rarity)}`,children:["[",g.rarity,"]"]})]}),e.jsx("p",{className:"text-lg text-amber-400 font-serif",children:g.realm})]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-300",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-semibold",children:"称号:"})," ",g.title||"无"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-semibold",children:"种族:"})," ",g.race||"未知"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-semibold",children:"来历:"})," ",g.origin||"一片空白..."]}),g.appearance&&e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-semibold",children:"外观:"})," ",g.appearance]})]})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto flex-grow",children:[e.jsx(mb,{attributes:b,card:g}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"装备配置"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:R.map(T=>{var G,_,M;return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>f({type:"equipment",slot:T.key,slotType:T.type}),className:`bg-stone-700/50 p-3 rounded-md w-full text-left hover:bg-stone-600/70 transition-colors h-full border-2 ${At((G=g.equipment[T.key])==null?void 0:G.rarity)}`,children:[e.jsx("p",{className:"text-sm text-gray-400",children:T.label}),e.jsx("p",{className:`font-bold truncate ${Me((_=g.equipment[T.key])==null?void 0:_.rarity)}`,children:((M=g.equipment[T.key])==null?void 0:M.name)||"未装备"})]}),g.equipment[T.key]&&e.jsx("button",{onClick:()=>C(T.key),className:"absolute -top-1.5 -right-1.5 bg-red-600 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:bg-red-500 transition-colors z-10 border border-stone-900",title:"卸下",children:"×"})]},T.key)})})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"技能配置"}),e.jsx("div",{className:"space-y-3",children:g.skills.map((T,G)=>e.jsx("div",{className:`relative w-full text-left bg-stone-700/50 p-3 rounded-md border-2 ${T?At(T==null?void 0:T.rarity):"border-dashed border-stone-600"} ${T?"cursor-pointer hover:bg-stone-600/70":""} transition-colors`,onClick:()=>{T?h(T):G>1&&f({type:"skill",slotIndex:G})},children:T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("h5",{className:"font-bold text-white flex items-baseline gap-2",children:[e.jsx("span",{className:`${Me(T.rarity)}`,children:T.name}),e.jsxs("span",{className:`text-xs font-medium ${Me(T.rarity)}`,children:["[",T.rarity,"]"]})]}),e.jsxs("span",{className:"text-sm font-mono text-blue-400",children:[T.cost," 真元"]})]}),e.jsx("p",{className:"text-sm font-semibold text-amber-300 mt-1",children:T.mechanicsDescription}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:T.description}),e.jsx("p",{className:"absolute bottom-1 right-2 text-[10px] text-gray-500 mt-1",children:G<2?"角色专属":"通用技能"}),G>1&&e.jsx("button",{onClick:_=>{_.stopPropagation(),E(G)},className:"absolute -top-1.5 -right-1.5 bg-red-600 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:bg-red-500 transition-colors z-10 border border-stone-900",title:"遗忘",children:"×"})]}):e.jsx("p",{className:"text-center text-gray-500",children:"通用技能槽"})},G))})]})]})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"兽宠"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>{g.pet?d(g.pet):f({type:"pet"})},className:`bg-stone-700/50 p-3 rounded-md w-full text-left hover:bg-stone-600/70 transition-colors h-full border-2 ${At((V=g.pet)==null?void 0:V.rarity)}`,children:[e.jsx("p",{className:"text-sm text-gray-400",children:"出战兽宠"}),e.jsx("p",{className:`font-bold truncate ${Me((J=g.pet)==null?void 0:J.rarity)}`,children:((D=g.pet)==null?void 0:D.name)||"未携带"})]}),g.pet&&e.jsx("button",{onClick:T=>{T.stopPropagation(),Z()},className:"absolute -top-1.5 -right-1.5 bg-red-600 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:bg-red-500 transition-colors z-10 border border-stone-900",title:"卸下",children:"×"})]})]})]})}),m&&e.jsx(ub,{playerProfile:r,selectionState:m,card:g,onClose:()=>f(null),onEquip:S,onLearnSkill:A,onEquipPet:$},m.type+(m.type==="equipment"?m.slot:m.type==="skill"?m.slotIndex:"pet")),x&&e.jsx(Od,{skill:x,onClose:()=>h(null)})]})},xb=({log:i,onClose:l})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"bg-slate-800 w-full max-w-2xl h-4/5 rounded-xl shadow-2xl border border-slate-700 overflow-hidden backdrop-blur-lg bg-slate-800/80 flex flex-col",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700 flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-white font-serif",children:"战斗记录"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:e.jsx("div",{className:"prose prose-invert max-w-none prose-p:text-gray-300 prose-p:my-2 font-serif",children:i.map((r,c)=>e.jsx("p",{className:`${r.startsWith(">")?"text-sky-400":""}`,children:r},c))})})]})}),fb=({endTime:i})=>{const[l,r]=v.useState(i-Date.now());if(v.useEffect(()=>{if(l<=0)return;const f=setInterval(()=>{const x=i-Date.now();x<=0&&clearInterval(f),r(x)},1e3);return()=>clearInterval(f)},[i,l]),l<=0)return e.jsx("span",{className:"text-green-400 font-bold",children:"培育完成"});const c=Math.floor(l/(1e3*60*60)),d=Math.floor(l%(1e3*60*60)/(1e3*60)),m=Math.floor(l%(1e3*60)/1e3);return e.jsxs("span",{className:"font-mono text-lg tracking-wider",children:[String(c).padStart(2,"0"),":",String(d).padStart(2,"0"),":",String(m).padStart(2,"0")]})},hb=({slot:i,playerProfile:l,onStartCultivation:r,onClaimCultivation:c,onGetLiveMonitoring:d,busyCharacterIds:m,onOpenSelector:f})=>{const[x,h]=v.useState(null),[g,b]=v.useState(null),[y,S]=v.useState("live"),[C,A]=v.useState("待机中..."),[E,$]=v.useState(!1);v.useEffect(()=>{console.log(`[育灵仓UI] 培育仓 #${i.slotId} 状态: ${i.status}, endTime: ${i.endTime}, now: ${Date.now()}, 剩余时间: ${i.endTime-Date.now()}ms`)},[i.status,i.endTime,i.slotId]);const Z=()=>{x&&g&&r(i.slotId,x.id,g.id)},R=async()=>{$(!0);try{const J=await d(i.slotId);A(J)}catch{A("监视信号中断...")}finally{$(!1)}},V=J=>{const D=J==="A"?x:g,T=()=>{if(J==="A"){const G=[...l.cardCollection,...l.petCollection].filter(_=>!m.has(_.id));f("选择亲本 A",G,_=>{h(_),b(null)})}else{if(!x)return;const G="skill"in x;let _=[];G?_=l.cardCollection.filter(M=>M.gender!==x.gender&&!m.has(M.id)):_=l.petCollection.filter(M=>M.gender!==x.gender&&!m.has(M.id)),f("选择亲本 B",_,M=>{b(M)})}};return e.jsx("button",{onClick:T,disabled:J==="B"&&!x,className:"w-full md:w-48 h-40 md:h-64 bg-black/30 rounded-lg flex flex-col items-center justify-center ornate-border border-dashed border-stone-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:border-amber-500/50",children:D?e.jsxs("div",{className:`w-full h-full rounded-lg p-3 flex flex-col items-center justify-center text-center ${At(D.rarity)}`,children:[e.jsx("p",{className:"font-bold text-base md:text-lg truncate w-full px-2",children:D.name}),e.jsx("p",{className:`text-xs md:text-sm mt-1 ${Me(D.rarity)}`,children:D.rarity})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-stone-500 text-3xl md:text-4xl mb-2",children:"+"}),e.jsxs("span",{className:"text-stone-500 text-xs",children:["选择",J==="A"?"亲本A":"亲本B"]})]})})};return i.status==="Empty"?e.jsxs("div",{className:"flex flex-col items-center w-full px-2 md:px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-8 items-center w-full max-w-2xl",children:[V("A"),e.jsx("div",{className:"text-3xl md:text-4xl font-bold text-gradient-gold",children:"🧬"}),V("B")]}),e.jsx("button",{onClick:Z,disabled:!x||!g,className:"mt-6 px-8 py-3 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold rounded-full shadow-glow-green disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 hover:scale-105 text-base md:text-lg",children:"开始培育"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4 w-full px-2 md:px-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[e.jsxs("div",{className:"w-full max-w-lg bg-gradient-to-br from-stone-800/80 to-stone-900/80 rounded-xl p-4 border border-stone-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-amber-400",children:"培育状态"}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-bold ${i.status==="Breeding"?"bg-cyan-500/20 text-cyan-300":"bg-green-500/20 text-green-300"}`,children:i.status==="Breeding"?"进行中":"已完成"})]}),e.jsx("div",{className:"text-center py-4 bg-black/30 rounded-lg",children:i.status==="Breeding"?e.jsxs("div",{children:[e.jsx("p",{className:"text-stone-400 text-sm mb-2",children:"能量融合中..."}),e.jsx("div",{className:"text-2xl md:text-3xl font-mono text-cyan-300",children:e.jsx(fb,{endTime:i.endTime})})]}):e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"text-4xl mb-2",children:"✨"}),e.jsx("p",{className:"text-green-400 font-bold text-xl md:text-2xl",children:"培育完成！"}),e.jsx("p",{className:"text-stone-400 text-sm mt-2",children:"灵胎已成熟，请开启查看"})]})})]}),e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsx("h4",{className:"text-sm text-stone-400 mb-2 text-center",children:"融合亲本"}),e.jsxs("div",{className:"flex gap-3 md:gap-4 justify-center",children:[e.jsxs("div",{className:`flex-1 max-w-[45%] bg-black/50 rounded-lg p-3 flex flex-col items-center justify-center text-center ornate-border ${At(i.parentA.rarity)}`,children:[e.jsx("p",{className:"font-bold text-sm md:text-base truncate w-full",children:i.parentA.name}),e.jsx("p",{className:`text-xs ${Me(i.parentA.rarity)}`,children:i.parentA.rarity})]}),e.jsx("div",{className:"flex items-center justify-center text-amber-400",children:e.jsx("span",{className:"text-xl",children:"✕"})}),e.jsxs("div",{className:`flex-1 max-w-[45%] bg-black/50 rounded-lg p-3 flex flex-col items-center justify-center text-center ornate-border ${At(i.parentB.rarity)}`,children:[e.jsx("p",{className:"font-bold text-sm md:text-base truncate w-full",children:i.parentB.name}),e.jsx("p",{className:`text-xs ${Me(i.parentB.rarity)}`,children:i.parentB.rarity})]})]})]}),e.jsxs("div",{className:"w-full max-w-lg bg-black/50 rounded-lg ornate-border border-stone-700 flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 flex border-b border-stone-700",children:[e.jsxs("button",{onClick:()=>S("live"),className:`flex-1 py-2 px-2 text-xs md:text-sm font-semibold transition-colors flex items-center justify-center gap-1 ${y==="live"?"bg-stone-700 text-amber-400":"text-stone-400 hover:bg-stone-800"}`,children:[e.jsx("span",{children:"📡"}),e.jsx("span",{children:"实时监视"})]}),e.jsxs("button",{onClick:()=>S("log"),className:`flex-1 py-2 px-2 text-xs md:text-sm font-semibold transition-colors flex items-center justify-center gap-1 ${y==="log"?"bg-stone-700 text-amber-400":"text-stone-400 hover:bg-stone-800"}`,children:[e.jsx("span",{children:"📋"}),e.jsx("span",{children:"监视日志"})]})]}),e.jsx("div",{className:"p-3 h-32 md:h-40 overflow-y-auto scrollbar-xianxia text-xs md:text-sm text-gray-300",children:y==="live"?e.jsx("div",{className:"whitespace-pre-wrap",children:E?"正在连接信号...":C}):e.jsx("div",{className:"space-y-1",children:i.monitoringLog.length>0?i.monitoringLog.map((J,D)=>e.jsxs("p",{className:"text-gray-300",children:[e.jsxs("span",{className:"text-amber-400",children:["[",J.timestamp,"]"]})," ",J.message]},`${J.timestamp}-${D}`)):e.jsx("p",{className:"text-stone-500 text-center",children:"暂无日志记录"})})}),y==="live"&&i.status==="Breeding"&&e.jsx("button",{onClick:R,className:"flex-shrink-0 w-full py-2 bg-cyan-600/20 hover:bg-cyan-600/40 text-cyan-300 text-xs transition-colors",children:"🔄 刷新监视信号"})]}),i.status==="Ready"&&e.jsx("button",{onClick:()=>c(i.slotId),className:"w-full max-w-lg mt-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-yellow-400 text-black font-bold text-lg rounded-xl shadow-glow-gold animate-pulse-slow transition-all duration-300 hover:scale-105 hover:shadow-2xl",children:"✨ 开启灵胎 ✨"})]})},pb=({isOpen:i,onClose:l,playerProfile:r,cultivationSlots:c,onStartCultivation:d,onClaimCultivation:m,onGetLiveMonitoring:f,busyCharacterIds:x,onOpenSelector:h})=>{const[g,b]=v.useState(1);if(!i)return null;const y=c.find(S=>S.slotId===g);return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"w-full max-w-4xl h-[90vh] ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-900 via-stone-950 to-black rounded-2xl shadow-2xl flex flex-col overflow-hidden",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/30 border-b border-xianxia-gold-700/50",children:[e.jsx("h2",{className:"text-3xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"育灵轩"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex flex-grow",children:[e.jsxs("div",{className:"w-1/4 border-r border-stone-700/50 p-4 flex flex-col gap-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-400 mb-2",children:"培育仓"}),c.map(S=>e.jsxs("button",{onClick:()=>b(S.slotId),className:`w-full p-3 rounded-lg text-left transition-all duration-200 border-2 ${g===S.slotId?"bg-stone-700/80 border-amber-500":"bg-stone-800/50 border-transparent hover:bg-stone-700/50"}`,children:[e.jsxs("p",{className:"font-bold",children:["培育仓 #",S.slotId]}),e.jsxs("p",{className:`text-sm ${S.status==="Empty"?"text-gray-400":S.status==="Breeding"?"text-cyan-400":"text-green-400"}`,children:["状态: ",S.status]})]},S.slotId))]}),e.jsx("div",{className:"w-3/4 p-6 flex items-center justify-center",children:y?e.jsx(hb,{slot:y,playerProfile:r,onStartCultivation:d,onClaimCultivation:m,onGetLiveMonitoring:f,busyCharacterIds:x,onOpenSelector:h}):e.jsx("p",{children:"选择一个培育仓以开始。"})})]})]})})},za=({isOpen:i,onClose:l,title:r,children:c,size:d="md",showDragIndicator:m=!0})=>{if(v.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[i]),!i)return null;const f={sm:"md:max-w-md",md:"md:max-w-2xl",lg:"md:max-w-4xl",xl:"md:max-w-6xl",full:"md:max-w-full md:m-4"};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-end md:items-center justify-center p-0 md:p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:`
          modal-responsive
          ornate-border border-xianxia-gold-600 
          bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 
          w-full ${f[d]}
          h-[90vh] md:h-auto md:max-h-[85vh]
          rounded-t-2xl md:rounded-xl
          shadow-2xl overflow-hidden backdrop-blur-lg 
          flex flex-col
          animate-slide-up-mobile
        `,onClick:x=>x.stopPropagation(),children:[m&&e.jsx("div",{className:"md:hidden flex-shrink-0 pt-2 pb-1 bg-black/10",children:e.jsx("div",{className:"modal-drag-indicator"})}),e.jsx("div",{className:"flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:e.jsxs("div",{className:"flex justify-between items-center p-3 md:p-4",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-bold text-gradient-gold text-shadow-glow font-serif truncate pr-2",children:r}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors touch-target flex-shrink-0","aria-label":"关闭",children:e.jsx("i",{className:"fa-solid fa-times text-xl md:text-2xl"})})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto scroll-mobile scrollbar-xianxia p-3 md:p-6",children:c})]})})},gb=({isOpen:i,onClose:l,gameState:r,onGenerateAllDrafts:c,onStartAllOptimization:d,onOptimizeChallenge:m})=>{const{gauntletSystem:f}=r,x=f.currentEvent,[h,g]=v.useState(new Set([1])),[b,y]=v.useState(null),[S,C]=v.useState(!1),A=M=>{g(U=>{const k=new Set(U);return k.has(M)?k.delete(M):k.add(M),k})},E=M=>{const U=[];for(let k=1;k<=5;k++)U.push(e.jsx("span",{className:k<=M?"text-amber-400":"text-gray-600",children:"★"},k));return e.jsx("span",{className:"text-sm",children:U})},$=M=>M.draftVersion?M.optimizationProgress===0?{text:"已生成草稿",color:"text-blue-400",icon:"◐"}:M.optimizationProgress<3?{text:`优化中 (${M.optimizationProgress}/3)`,color:"text-yellow-400",icon:"◑"}:{text:"✓ 已完成三轮优化",color:"text-green-400",icon:"●"}:{text:"待生成",color:"text-gray-400",icon:"○"},R=(()=>{if(!x)return{completed:0,total:18};let M=0;return x.rounds.forEach(U=>{U.challenge&&(M+=U.challenge.optimizationProgress||0)}),{completed:M,total:18}})(),V=async()=>{if(c){C(!0);try{await c()}finally{C(!1)}}},J=async()=>{if(d){C(!0);try{await d()}finally{C(!1)}}},D=async(M,U)=>{if(m){C(!0);try{await m(M,U)}finally{C(!1)}}},T=M=>{if(!x)return null;const U=x.rounds.find(k=>k.roundNumber===M);return(U==null?void 0:U.challenge)||null},G=()=>{if(!b||!x)return null;const M=T(b.roundNumber);if(!M)return null;let U="",k="";if(b.type==="draft")U=`第${b.roundNumber}轮关卡 - 初始草稿`,k=M.draftVersion||"草稿尚未生成";else if(b.type==="optimization"&&b.optimizationRound){const Q=`optimization${b.optimizationRound}`,ne=M[Q];U=`第${b.roundNumber}轮关卡 - 第${b.optimizationRound}次优化`,ne?k=`【批判分析】
${ne.critique}

【发现问题】
${ne.issues.map(Y=>`• ${Y}`).join(`
`)}

【改进建议】
${ne.suggestions.map(Y=>`• ${Y}`).join(`
`)}

【修改内容】
${ne.changes.map(Y=>`• ${Y}`).join(`
`)}

【改进总结】
${ne.improvementSummary}`:k="此轮优化尚未完成"}else b.type==="final"&&(U=`第${b.roundNumber}轮关卡 - 最终版本`,k=M.finalVersion||M.draftVersion||"尚未生成");return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"bg-stone-900 rounded-lg p-6 max-w-2xl w-full mx-4 border border-stone-700 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-stone-900 pb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-amber-300",children:U}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-400 hover:text-white",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsx("div",{className:"whitespace-pre-wrap text-gray-300 text-sm leading-relaxed",children:k}),b.type==="optimization"&&b.optimizationRound&&e.jsxs("div",{className:"mt-6 flex justify-center gap-4 sticky bottom-0 bg-stone-900 pt-4",children:[b.optimizationRound>1&&e.jsxs("button",{onClick:()=>y({...b,optimizationRound:b.optimizationRound-1}),className:"py-2 px-4 rounded bg-stone-700 hover:bg-stone-600 text-gray-300",children:[e.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"上一次"]}),b.optimizationRound<3&&e.jsxs("button",{onClick:()=>y({...b,optimizationRound:b.optimizationRound+1}),className:"py-2 px-4 rounded bg-stone-700 hover:bg-stone-600 text-gray-300",children:["下一次",e.jsx("i",{className:"fa-solid fa-arrow-right ml-2"})]}),e.jsx("button",{onClick:()=>y(null),className:"py-2 px-4 rounded bg-amber-700 hover:bg-amber-600 text-white",children:"关闭"})]})]})})},_=M=>{const U=T(M),k=h.has(M),Q=["水上疾行","谜题迷宫","技巧考验","速度竞技","智力对决","终极挑战"],ne=["体能","解谜","技巧","竞技","智力","综合"],Y=(U==null?void 0:U.name)||Q[M-1]||`第${M}轮关卡`,X=(U==null?void 0:U.type)||ne[M-1]||"综合",L=(U==null?void 0:U.difficulty)||M,I=U?$(U):{text:"待生成",color:"text-gray-400",icon:"○"};return e.jsxs("div",{className:"border border-stone-700/50 rounded-lg overflow-hidden mb-3",children:[e.jsxs("button",{onClick:()=>A(M),className:"w-full flex items-center justify-between p-4 bg-black/30 hover:bg-black/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-lg transition-transform ${k?"rotate-90":""}`,children:"▶"}),e.jsxs("span",{className:"font-semibold text-white",children:["第",M,"轮：",Y]})]}),e.jsxs("span",{className:`text-sm ${I.color}`,children:[I.icon," ",I.text]})]}),k&&e.jsxs("div",{className:"p-4 bg-black/20 border-t border-stone-700/50",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"类型："}),e.jsx("span",{className:"text-blue-400",children:X})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"难度："}),E(L)]})]}),(U==null?void 0:U.description)&&e.jsx("div",{className:"mb-4 text-sm text-gray-400",children:U.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y({type:"draft",roundNumber:M}),disabled:!(U!=null&&U.draftVersion),className:`py-1.5 px-3 rounded text-sm transition-colors ${U!=null&&U.draftVersion?"bg-blue-700/50 hover:bg-blue-600/50 text-blue-300":"bg-gray-700/30 text-gray-500 cursor-not-allowed"}`,children:"查看草稿"}),[1,2,3].map(K=>{const fe=`optimization${K}`,ge=U&&U[fe];U!=null&&U.draftVersion&&(K===1||U[`optimization${K-1}`]);const O=(U==null?void 0:U.optimizationProgress)===K-1&&(U==null?void 0:U.draftVersion);return e.jsx("button",{onClick:()=>{ge?y({type:"optimization",roundNumber:M,optimizationRound:K}):O&&m&&D(M,K)},disabled:!ge&&!O,className:`py-1.5 px-3 rounded text-sm transition-colors ${ge?"bg-green-700/50 hover:bg-green-600/50 text-green-300":O?"bg-yellow-700/50 hover:bg-yellow-600/50 text-yellow-300":"bg-gray-700/30 text-gray-500 cursor-not-allowed"}`,children:ge?`优化${K}`:O?`执行优化${K}`:`优化${K}`},K)}),e.jsx("button",{onClick:()=>y({type:"final",roundNumber:M}),disabled:!(U!=null&&U.finalVersion)&&(U==null?void 0:U.optimizationProgress)!==3,className:`py-1.5 px-3 rounded text-sm transition-colors ${(U==null?void 0:U.optimizationProgress)===3?"bg-amber-700/50 hover:bg-amber-600/50 text-amber-300":"bg-gray-700/30 text-gray-500 cursor-not-allowed"}`,children:"查看最终版本"})]})]})]},M)};return x?e.jsxs(za,{isOpen:i,onClose:l,title:`第 ${x.edition} 届大闯关 - 关卡公告栏`,size:"xl",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 p-4 bg-black/30 rounded-lg border border-stone-700/50",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:V,disabled:S||!c,className:`py-2 px-4 rounded font-semibold text-sm transition-colors ${S?"bg-gray-700/50 text-gray-500 cursor-not-allowed":"bg-blue-700 hover:bg-blue-600 text-white"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"处理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles mr-2"}),"生成全部草稿"]})}),e.jsx("button",{onClick:J,disabled:S||!d,className:`py-2 px-4 rounded font-semibold text-sm transition-colors ${S?"bg-gray-700/50 text-gray-500 cursor-not-allowed":"bg-green-700 hover:bg-green-600 text-white"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"处理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-bolt mr-2"}),"开始全部优化"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400 text-sm",children:"优化进度："}),e.jsxs("span",{className:`font-bold ${R.completed===R.total?"text-green-400":R.completed>0?"text-yellow-400":"text-gray-400"}`,children:[R.completed,"/",R.total]}),e.jsx("div",{className:"w-24 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-green-500 transition-all duration-300",style:{width:`${R.completed/R.total*100}%`}})})]})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-2",children:[1,2,3,4,5,6].map(M=>_(M))})]}),G()]}):e.jsx(za,{isOpen:i,onClose:l,title:"关卡公告栏",size:"lg",children:e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-calendar-xmark text-4xl mb-4"}),e.jsx("p",{children:"当前没有正在进行的赛事"})]})})};class bb{async generateContestants(l,r){console.log(`[大闯关AI] 开始生成${l}名参赛者...`);const c=`你是一个创意丰富的角色设计师。请生成${l}名风格各异的女性修仙者,她们将参加"大闯关"综艺比赛。

要求:
1. 每个角色都要有独特的个性和外观
2. 境界可以从炼气期到元婴期不等
3. 特殊特点要有趣且多样化
4. 魅力值和技巧值要有差异,不要都很高
5. 名字要符合修仙世界的风格

返回格式必须是JSON数组,每个对象包含以下字段:
{
  "name": "角色名",
  "realm": "境界",
  "appearance": "外观描述(50字以内)",
  "specialTrait": "特殊特点(30字以内)",
  "charm": 魅力值(0-100),
  "skillfulness": 技巧值(0-100)
}`,d=`生成${l}名参赛者,要求风格多样,有强有弱,有美有丑,性格各异。直接返回JSON数组,不要有其他文字。`;try{const m=await ht({systemInstruction:c,prompt:d,gameState:r,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),x=JSON.parse(m).map(h=>({id:mf(),name:h.name,gender:"Female",realm:h.realm,appearance:h.appearance,specialTrait:h.specialTrait,charm:Math.min(Math.max(h.charm||50,0),100),skillfulness:Math.min(Math.max(h.skillfulness||50,0),100),status:"active",currentScore:0,roundScores:[],isPlayerCharacter:!1}));return console.log(`[大闯关AI] 成功生成${x.length}名参赛者`),x}catch(m){throw console.error("[大闯关AI] 生成参赛者失败:",m),new Error("参赛者生成失败")}}async generateJudges(l,r){console.log(`[大闯关AI] 开始生成${l}名评委...`);const c=`你是一个角色设计师。请生成${l}名资深的评委,他们将担任"大闯关"比赛的裁判。

要求:
1. 评委应该是修为高深的前辈
2. 每个评委要有独特的评判风格(严格、温和、古怪等)
3. 专长领域要不同(体能、智力、技巧等)
4. 称号要霸气
5. 性格要鲜明

返回格式必须是JSON数组,每个对象包含:
{
  "name": "评委名",
  "title": "称号",
  "realm": "境界",
  "personality": "性格特点",
  "judgingStyle": "评判风格",
  "specialty": "专长领域"
}`,d=`生成${l}名评委,要求风格各异,评判标准不同。直接返回JSON数组。`;try{const m=await ht({systemInstruction:c,prompt:d,gameState:r,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),x=JSON.parse(m).map(h=>({id:dg(),name:h.name,title:h.title,realm:h.realm,personality:h.personality,judgingStyle:h.judgingStyle,specialty:h.specialty}));return console.log(`[大闯关AI] 成功生成${x.length}名评委`),x}catch(m){throw console.error("[大闯关AI] 生成评委失败:",m),new Error("评委生成失败")}}async generateChallengeDraft(l,r,c){console.log(`[大闯关AI] 开始生成第${l}轮关卡草稿...`);const m=[3,4,5,6,7,8][l-1],f=`你是一个综艺节目关卡设计师。请为"大闯关"第${l}轮设计一个精彩的关卡。

本轮信息:
- 轮次: 第${l}轮
- 参赛人数: ${r.contestantCount}人
- 难度等级: ${m}/10
- 淘汰人数: ${Math.floor(r.contestantCount/2)}人

${r.previousChallenges.length>0?`已有关卡类型: ${r.previousChallenges.map(h=>h.type).join("、")}`:""}

要求:
1. 关卡要有创意,符合修仙世界背景
2. 类型从以下选择: 解谜、竞技、体能、技巧、智力、综合
3. 规则要清晰明确
4. 获胜条件和淘汰标准要合理
5. 预估时长要现实(30-60分钟)

返回JSON格式:
{
  "type": "关卡类型",
  "name": "关卡名称",
  "description": "详细描述(200字左右)",
  "rules": ["规则1", "规则2", "规则3"],
  "winCondition": "获胜条件",
  "eliminationCriteria": "淘汰标准",
  "estimatedDuration": "预估时长"
}`,x=`设计第${l}轮关卡,要求独特有趣,难度适中。直接返回JSON。`;try{const h=await ht({systemInstruction:f,prompt:x,gameState:c,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),g=JSON.parse(h),b={id:ug(l),roundNumber:l,type:g.type,name:g.name,description:g.description,rules:g.rules,winCondition:g.winCondition,eliminationCriteria:g.eliminationCriteria,difficulty:m,estimatedDuration:g.estimatedDuration,draftVersion:JSON.stringify(g,null,2),finalVersion:"",optimizationProgress:0};return console.log(`[大闯关AI] 成功生成第${l}轮关卡草稿: ${b.name}`),b}catch(h){throw console.error("[大闯关AI] 生成关卡草稿失败:",h),new Error(`第${l}轮关卡草稿生成失败`)}}async generateAllChallengeDrafts(l){console.log("[大闯关AI] 开始批量生成6轮关卡草稿...");const r=[],c=[64,32,16,8,4,2];for(let d=1;d<=6;d++){const m={roundNumber:d,previousChallenges:r,contestantCount:c[d-1]},f=await this.generateChallengeDraft(d,m,l);r.push(f),await new Promise(x=>setTimeout(x,500))}return console.log("[大闯关AI] 成功生成全部6轮关卡草稿"),r}async optimizeChallenge(l,r,c){console.log(`[大闯关AI] 开始第${r}轮优化: ${l.name}`);let d=l.draftVersion;r===2&&l.optimization1?d=l.optimization1.optimizedDesign:r===3&&l.optimization2&&(d=l.optimization2.optimizedDesign);const m=`你是一个专业的关卡优化顾问。请对以下关卡设计进行第${r}轮批判性分析和优化。

当前关卡设计:
${d}

要求:
1. 批判性分析当前设计的问题
2. 提出具体的改进建议
3. 给出优化后的完整设计
4. 总结本次改进的要点

返回JSON格式:
{
  "critique": "批判分析(指出具体问题)",
  "issues": ["问题1", "问题2", "问题3"],
  "suggestions": ["建议1", "建议2", "建议3"],
  "changes": ["修改1", "修改2", "修改3"],
  "optimizedDesign": "优化后的完整设计(JSON字符串)",
  "improvementSummary": "改进总结"
}`,f=`进行第${r}轮优化,要深入分析问题并给出实质性改进。直接返回JSON。`;try{const x=await ht({systemInstruction:m,prompt:f,gameState:c,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),h=JSON.parse(x),g={round:r,timestamp:Date.now(),critique:h.critique,issues:h.issues,suggestions:h.suggestions,changes:h.changes,optimizedDesign:h.optimizedDesign,improvementSummary:h.improvementSummary};return console.log(`[大闯关AI] 完成第${r}轮优化: ${l.name}`),g}catch(x){throw console.error("[大闯关AI] 关卡优化失败:",x),new Error(`第${r}轮优化失败`)}}async generateGroupPerformance(l,r,c){console.log(`[大闯关AI] 开始生成${l.length}名参赛者的群体表现...`);const d=l.slice(0,10).map(x=>`${x.name}(${x.realm}, 魅力${x.charm}, 技巧${x.skillfulness})`).join("; "),m=`你是综艺节目叙事者。为"大闯关"第${r.roundNumber}轮生成所有参赛者表现。

关卡: ${r.name} (${r.type})
描述: ${r.description}
参赛人数: ${l.length}人
部分参赛者: ${d}...

要求:
1. 为每人生成50-100字表现描述
2. 根据属性合理分配得分(60-95分)
3. 要有高低差异,符合淘汰赛规律
4. 精彩瞬间和失误要合理

返回JSON数组(包含全部${l.length}人):
[{
  "contestantName": "名字",
  "score": 分数,
  "narrative": "表现叙事",
  "highlights": ["精彩1","精彩2"],
  "mistakes": ["失误"]
}]`,f=`生成全部${l.length}人表现,要有层次。直接返回JSON数组。`;try{const x=await ht({systemInstruction:m,prompt:f,gameState:c,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),b=[...JSON.parse(x)].sort((y,S)=>S.score-y.score).map((y,S)=>{const C=l.find(A=>A.name===y.contestantName);return{contestantId:(C==null?void 0:C.id)||"",contestantName:y.contestantName,roundNumber:r.roundNumber,score:Math.min(Math.max(y.score,60),95),rank:S+1,narrative:y.narrative,highlights:y.highlights||[],mistakes:y.mistakes||[],passed:S+1<=Math.floor(l.length/2)}});return console.log("[大闯关AI] 成功生成群体表现"),b}catch(x){throw console.error("[大闯关AI] 生成群体表现失败:",x),new Error("群体表现生成失败")}}async generateIndividualPerformance(l,r,c,d){var x,h,g;console.log(`[大闯关AI] 生成${l.name}的详细表现...`);const m=`你是综艺节目叙事者。详细描述${l.name}在关卡中的表现。

参赛者: ${l.name} (${l.realm})
外观: ${l.appearance}
特点: ${l.specialTrait}
属性: 魅力${l.charm}, 技巧${l.skillfulness}

关卡: ${r.name}
${r.description}

要求:
1. 生成300-500字详细叙事
2. 描述具体动作、表情、反应
3. 要有起伏和戏剧性
4. 根据能力评分(60-95分)

返回JSON:
{
  "score": 分数,
  "narrative": "详细叙事",
  "highlights": ["精彩1","精彩2","精彩3"],
  "mistakes": ["失误1","失误2"]
}`,f=`详细描述${l.name}的表现,要生动有趣。直接返回JSON。`;try{const b=await ht({systemInstruction:m,prompt:f,gameState:d,includeVectorMemories:!0,includePreset:!0,includeWorldbook:!0}),y=JSON.parse(b),S=((h=(x=c.currentRanking)==null?void 0:x.find(C=>C.contestantId===l.id))==null?void 0:h.rank)||1;return{contestantId:l.id,contestantName:l.name,roundNumber:r.roundNumber,score:Math.min(Math.max(y.score,60),95),rank:S,narrative:y.narrative,highlights:y.highlights||[],mistakes:y.mistakes||[],passed:S<=Math.floor((((g=c.currentRanking)==null?void 0:g.length)||64)/2)}}catch(b){throw console.error("[大闯关AI] 生成个人表现失败:",b),new Error("个人表现生成失败")}}async generateJudgeScores(l,r,c){console.log(`[大闯关AI] 生成评委对${r.contestantName}的评分...`);const d=l.map(x=>`${x.name}(${x.title}, 风格:${x.judgingStyle}, 专长:${x.specialty})`).join(`
`),m=`你是评委团秘书。生成评委对参赛者的评分和评语。

参赛者: ${r.contestantName}
得分: ${r.score}分
表现: ${r.narrative.substring(0,200)}...
精彩: ${r.highlights.join("; ")}
失误: ${r.mistakes.join("; ")}

评委:
${d}

要求:
1. 每个评委根据自己风格给出评分和评语
2. 评分围绕${r.score}分波动(±5分)
3. 严格评委分低,温和评委分高
4. 评语30-80字,符合性格

返回JSON数组:
[{
  "judgeId": "ID",
  "judgeName": "名字",
  "score": 分数,
  "comment": "评语"
}]`,f=`生成${l.length}名评委评分,要符合各自风格。直接返回JSON数组。`;try{const x=await ht({systemInstruction:m,prompt:f,gameState:c,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),g=JSON.parse(x).map(b=>({judgeId:b.judgeId,judgeName:b.judgeName,contestantId:r.contestantId,roundNumber:r.roundNumber,score:Math.min(Math.max(b.score,0),100),comment:b.comment}));return console.log(`[大闯关AI] 成功生成${g.length}名评委的评分`),g}catch(x){throw console.error("[大闯关AI] 生成评委评分失败:",x),new Error("评委评分生成失败")}}async generateCommentary(l,r,c){console.log(`[大闯关AI] 生成${l}阶段的解说...`);const d={opening:"开场介绍",during:"比赛进行中",highlight:"精彩瞬间回顾",closing:"本轮总结",judging:"评委评分阶段"},m=`你是"大闯关"节目解说员。生成${d[l]}的解说词。

阶段: ${d[l]}
${r.challenge?`关卡: ${r.challenge.name}`:""}
${r.contestant?`焦点: ${r.contestant.name}`:""}
${r.currentAction?`动作: ${r.currentAction}`:""}

要求:
1. 语言生动活泼,有综艺感
2. 制造悬念和惊喜
3. 长度80-150字
4. 符合阶段氛围

返回JSON:
{
  "content": "解说内容",
  "speaker": "解说员"
}`,f=`生成${d[l]}解说,要有感染力。直接返回JSON。`;try{const x=await ht({systemInstruction:m,prompt:f,gameState:c,includeVectorMemories:!1,includePreset:!0,includeWorldbook:!0}),h=JSON.parse(x),g={id:gr("commentary"),timestamp:Date.now(),roundNumber:r.roundNumber||0,phase:l,content:h.content,speaker:h.speaker||"解说员"};return console.log(`[大闯关AI] 完成${l}阶段解说生成`),g}catch(x){throw console.error("[大闯关AI] 生成解说失败:",x),new Error("解说生成失败")}}async generateDanmakuResponse(l,r,c){console.log(`[大闯关AI] 处理玩家弹幕: ${l}`);const d=`你是"大闯关"节目互动系统。玩家发送了弹幕,生成响应。

玩家弹幕: "${l}"
当前情况: ${r.currentNarrative||"比赛进行中"}
${r.contestant?`焦点选手: ${r.contestant.name}`:""}

要求:
1. 根据弹幕内容更新叙事(50-100字)
2. 解说员回应弹幕(30-50字)
3. 生成3-5条AI观众弹幕
4. 要有互动感和代入感

返回JSON:
{
  "narrative": "叙事更新",
  "commentary": "解说回应",
  "danmakus": ["弹幕1", "弹幕2", "弹幕3"]
}`,m="生成对玩家弹幕的响应,要生动有趣。直接返回JSON。";try{const f=await ht({systemInstruction:d,prompt:m,gameState:c,includeVectorMemories:!0,includePreset:!0,includeWorldbook:!0}),x=JSON.parse(f),h={narrative:x.narrative,commentary:x.commentary,danmakus:x.danmakus||[]};return console.log("[大闯关AI] 完成弹幕响应生成"),h}catch(f){throw console.error("[大闯关AI] 生成弹幕响应失败:",f),new Error("弹幕响应生成失败")}}}const Oa=new bb;function wf(i){const l=i.totalEditions+1,r=i.nextEventDate,c=r-1440*60*1e3,d={id:mg(l),edition:l,name:`第${l}届天下第一闯关大赛`,status:"countdown",scheduledDate:r,registrationDeadline:c,contestants:[],judges:[],challengesGenerated:!1,allOptimizationsComplete:!1,currentRound:0,rounds:[],finalRankings:[],viewMode:"group",isLive:!1};return console.log(`[赛事管理] 创建新赛事: ${d.name}`),d}function Ys(i,l){console.log(`[赛事管理] 更新赛事状态: ${i.status} → ${l}`);const r={...i,status:l};switch(l){case"in_progress":r.startTime=Date.now(),r.isLive=!0;break;case"completed":r.endTime=Date.now(),r.isLive=!1;break}return r}function yb(i){const l=Date.now();if(i.status==="countdown"){const r=i.scheduledDate-1728e5;if(l>=r&&l<i.registrationDeadline)return console.log("[赛事管理] 自动进入报名阶段"),Ys(i,"registration")}return i.status==="registration"&&l>=i.registrationDeadline?(console.log("[赛事管理] 报名截止，进入准备阶段"),Ys(i,"preparing")):i.status==="preparing"&&i.challengesGenerated&&i.allOptimizationsComplete&&i.contestants.length>=64&&l>=i.scheduledDate?(console.log("[赛事管理] 准备完成，比赛开始"),Ys(i,"in_progress")):i}function vb(i,l){if(i.playerContestantId)return console.log("[赛事管理] 玩家已报名，无需重复报名"),i;if(i.status!=="registration")return console.log("[赛事管理] 当前不在报名阶段，无法报名"),i;const r={id:mf(),name:l.name,gender:"Female",realm:l.realm,appearance:l.appearance||"身姿婀娜，气质出众",specialTrait:"玩家角色",charm:l.charm||75,skillfulness:l.skillfulness||75,status:"active",currentScore:0,roundScores:[],isPlayerCharacter:!0,characterCardId:l.characterCardId};return console.log(`[赛事管理] 玩家角色 ${r.name} 报名成功`),{...i,contestants:[...i.contestants,r],playerContestantId:r.id}}function jb(i){return i.playerContestantId?i.status!=="registration"?(console.log("[赛事管理] 非报名阶段，无法取消报名"),i):(console.log("[赛事管理] 取消玩家报名"),{...i,contestants:i.contestants.filter(l=>l.id!==i.playerContestantId),playerContestantId:void 0}):(console.log("[赛事管理] 玩家未报名，无需取消"),i)}function Nb(i){return i.contestants.filter(l=>l.status==="active")}function wb(i,l){console.log(`[赛事管理] 设置${l.length}个关卡草稿`);const r=l.map((c,d)=>({roundNumber:d+1,status:"draft",challenge:c,contestantIds:[],performances:[],judgeScores:[],commentary:[],danmakuHistory:[],rankings:[],advancingIds:[],eliminatedIds:[]}));return{...i,rounds:r,challengesGenerated:!0}}function Ox(i,l,r){const c=i.rounds.map(m=>m.roundNumber===l?{...m,challenge:r}:m),d=c.every(m=>m.challenge.optimizationProgress===3);return{...i,rounds:c,allOptimizationsComplete:d}}function zd(i){return i.currentRound===0||i.currentRound>6?null:i.rounds.find(l=>l.roundNumber===i.currentRound)||null}function Sf(i,l){const r=i.rounds.map(c=>c.roundNumber===l.roundNumber?l:c);return{...i,rounds:r}}async function Sb(i,l,r){var f,x,h,g,b,y,S,C,A,E,$;const c=zd(i);if(!c)throw new Error("没有进行中的轮次");console.log(`[流程控制] 执行第${c.roundNumber}轮比赛`);let d={...i},m={...c};try{(f=r==null?void 0:r.onProgress)==null||f.call(r,"opening",0,"正在生成开场解说...");const Z=await zx(m,"opening",l);m.commentary.push(Z),(x=r==null?void 0:r.onProgress)==null||x.call(r,"opening",100,"开场解说完成"),(h=r==null?void 0:r.onProgress)==null||h.call(r,"performance",0,"正在生成选手表现..."),m=await kb(m,d,l,r),(g=r==null?void 0:r.onProgress)==null||g.call(r,"performance",100,"表演阶段完成"),(b=r==null?void 0:r.onProgress)==null||b.call(r,"judging",0,"正在生成评委评分..."),m=await Cb(m,d,l,r),(y=r==null?void 0:r.onProgress)==null||y.call(r,"judging",100,"评分阶段完成"),(S=r==null?void 0:r.onProgress)==null||S.call(r,"ranking",0,"正在计算排名..."),m=Eb(m,d),(C=r==null?void 0:r.onProgress)==null||C.call(r,"ranking",100,"排名计算完成"),(A=r==null?void 0:r.onProgress)==null||A.call(r,"closing",0,"正在生成结束解说...");const R=await zx(m,"closing",l);return m.commentary.push(R),(E=r==null?void 0:r.onProgress)==null||E.call(r,"closing",100,"结束解说完成"),m.status="completed",m.endTime=Date.now(),d=Sf(d,m),d=Mb(d,m),console.log(`[流程控制] 第${c.roundNumber}轮完成`),d}catch(Z){throw console.error("[流程控制] 轮次执行失败:",Z),($=r==null?void 0:r.onError)==null||$.call(r,Z,"round"),Z}}async function kb(i,l,r,c){const d=l.contestants.filter(f=>i.contestantIds.includes(f.id)&&f.status==="active"),m=await Oa.generateGroupPerformance(d,i.challenge,r);return{...i,performances:m,status:"judging"}}async function Cb(i,l,r,c){const d=[];for(const m of i.performances){const f=await Oa.generateJudgeScores(l.judges,m,r);d.push(...f),await new Promise(x=>setTimeout(x,200))}return{...i,judgeScores:d}}async function zx(i,l,r){const c={roundNumber:i.roundNumber,challenge:i.challenge,performances:i.performances,rankings:i.rankings};return Oa.generateCommentary(l,c,r)}function Eb(i,l){const r=i.performances.map(h=>{const g=i.judgeScores.filter(S=>S.contestantId===h.contestantId),b=g.length>0?g.reduce((S,C)=>S+C.score,0)/g.length:0,y=h.score*.7+b*.3;return{contestantId:h.contestantId,contestantName:h.contestantName,score:Math.round(y*10)/10}});r.sort((h,g)=>g.score-h.score);const c=r.map((h,g)=>{const b=l.contestants.find(y=>y.id===h.contestantId);return{rank:g+1,contestantId:h.contestantId,contestantName:h.contestantName,score:h.score,status:(b==null?void 0:b.status)||"active"}}),d=cg(i.roundNumber,i.contestantIds.length),m=c.slice(0,d).map(h=>h.contestantId),f=c.slice(d).map(h=>h.contestantId),x=i.performances.map(h=>{var g;return{...h,passed:m.includes(h.contestantId),rank:((g=c.find(b=>b.contestantId===h.contestantId))==null?void 0:g.rank)||0}});return{...i,rankings:c,advancingIds:m,eliminatedIds:f,performances:x}}function Mb(i,l){const r=i.contestants.map(c=>{if(l.eliminatedIds.includes(c.id))return{...c,status:"eliminated",eliminatedRound:l.roundNumber};if(l.roundNumber===6&&l.advancingIds.includes(c.id))return{...c,status:"winner"};const d=l.performances.find(m=>m.contestantId===c.id);if(d){const m=[...c.roundScores];return m[l.roundNumber-1]=d.score,{...c,roundScores:m,currentScore:c.currentScore+d.score}}return c});return{...i,contestants:r}}async function Ab(i,l,r){var b;const c=zd(i);if(!c)throw new Error("当前没有进行中的轮次");const d={roundNumber:c.roundNumber,challenge:c.challenge,currentNarrative:((b=c.performances[0])==null?void 0:b.narrative)||""},m=await Oa.generateDanmakuResponse(l,d,r),f={id:`danmaku_${Date.now()}`,content:l,timestamp:Date.now(),type:"player",author:"你"},x=m.danmakus.map((y,S)=>({id:`danmaku_ai_${Date.now()}_${S}`,content:y,timestamp:Date.now()+S*100,type:"ai_generated",author:`观众${Math.floor(Math.random()*1e3)}`})),h={...c,danmakuHistory:[...c.danmakuHistory,f,...x]};return{event:Sf(i,h),response:m}}const Tb=i=>v.useMemo(()=>{const{gauntletSystem:l}=i,r=l.playerStats;return r?{participations:r.participations,wins:r.wins,bestRank:r.bestRank,totalScore:r.totalScore,averageRank:r.averageRank}:{participations:0,wins:0,bestRank:0,totalScore:0,averageRank:0}},[i.gauntletSystem.playerStats]),$b=({isOpen:i,onClose:l,gameState:r,setGameState:c,onOpenAnnouncement:d,onOpenRegistration:m,onOpenLive:f})=>{const{gauntletSystem:x}=r,h=x.currentEvent,[g,b]=v.useState(""),[y,S]=v.useState(!1),[C,A]=v.useState(!1),E=Tb(r);v.useEffect(()=>{if(!h)return;const T=()=>{const _=Date.now();let M=0;switch(h.status){case"countdown":M=h.scheduledDate;break;case"registration":M=h.registrationDeadline;break;case"preparing":M=h.startTime||h.registrationDeadline+36e5;break;case"in_progress":case"completed":b("");return;default:b("");return}if(M>0){const U=M-_;if(U<=0)b("即将开始...");else{const k=Math.floor(U/864e5),Q=Math.floor(U%(1e3*60*60*24)/(1e3*60*60)),ne=Math.floor(U%(1e3*60*60)/(1e3*60));let Y="";k>0&&(Y+=`${k}天 `),Q>0&&(Y+=`${Q}小时 `),Y+=`${ne}分`,b(Y)}}};T();const G=setInterval(T,1e3);return()=>clearInterval(G)},[h]);const Z=(()=>{if(!h)return{text:"暂无赛事",color:"text-gray-400"};switch(h.status){case"countdown":return{text:"倒计时中",color:"text-blue-400"};case"registration":return{text:"报名中",color:"text-green-400"};case"preparing":return{text:"筹备中",color:"text-yellow-400"};case"in_progress":return{text:"进行中",color:"text-red-400"};case"completed":return{text:"已结束",color:"text-purple-400"};default:return{text:"未知状态",color:"text-gray-400"}}})(),R=()=>{let T=wf(x);T=Ys(T,"registration"),c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T,totalEditions:T.edition}})),console.log("[大闯关] 创建新赛事:",T.name)},J=(()=>{if(!h)return{label:"开启新赛事",disabled:!1,onClick:R,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white shadow-lg hover:shadow-amber-500/30"};switch(h.status){case"countdown":return{label:"敬请期待（点击跳转报名）",disabled:!1,onClick:()=>{const T=Ys(h,"registration");c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T}}))},className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white shadow-lg hover:shadow-blue-500/30"};case"registration":return{label:"立即报名",disabled:!1,onClick:m,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white shadow-lg hover:shadow-green-500/30 animate-pulse"};case"preparing":return{label:"关卡准备中...",disabled:!0,onClick:()=>{},className:"bg-gradient-to-r from-yellow-700/50 to-amber-700/50 text-yellow-300 cursor-not-allowed"};case"in_progress":return{label:"进入直播间",disabled:!1,onClick:f,className:"bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-500 hover:to-rose-500 text-white shadow-lg hover:shadow-red-500/30"};case"completed":return{label:"查看结果",disabled:!1,onClick:f,className:"bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-500 hover:to-violet-500 text-white shadow-lg hover:shadow-purple-500/30"};default:return{label:"暂无赛事",disabled:!0,onClick:()=>{},className:"bg-gray-700/50 text-gray-500 cursor-not-allowed"}}})(),D=()=>{if(!h)return"";switch(h.status){case"countdown":return"距离开赛还有：";case"registration":return"报名截止还有：";case"preparing":return"预计开始：";default:return""}};return e.jsxs(za,{isOpen:i,onClose:l,title:"大闯关赛事大厅",size:"lg",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-6 bg-gradient-to-b from-amber-900/20 to-transparent rounded-lg border border-amber-700/20",children:[e.jsx("div",{className:"text-4xl mb-4",children:"🏆"}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-amber-300 mb-3",children:h?`第 ${h.edition} 届天下第一闯关大赛`:"天下第一闯关大赛"}),e.jsx("div",{className:"text-4xl mb-3",children:"🏆"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-gray-400",children:"状态："}),e.jsxs("span",{className:`font-semibold ${Z.color}`,children:["【",Z.text,"】"]})]}),g&&e.jsxs("div",{className:"text-xl md:text-2xl font-bold text-amber-200 mb-6",children:[D(),e.jsx("span",{className:"text-white",children:g})]}),e.jsx("button",{onClick:J.onClick,disabled:J.disabled,className:`
                            w-4/5 max-w-md py-4 px-8 rounded-lg font-bold text-lg md:text-xl
                            transition-all duration-300 transform hover:scale-105
                            ${J.className}
                        `,children:J.label})]}),e.jsx("div",{className:"border-t border-stone-700/50"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>A(!0),className:`py-3 px-4 rounded-lg bg-black/30 border border-stone-700/50 \r
                                 hover:bg-black/50 hover:border-amber-700/50 transition-all\r
                                 text-amber-300 font-semibold text-sm md:text-base`,children:[e.jsx("i",{className:"fa-solid fa-trophy mr-2"}),"历届冠军"]}),e.jsxs("button",{onClick:()=>S(!0),className:`py-3 px-4 rounded-lg bg-black/30 border border-stone-700/50 \r
                                 hover:bg-black/50 hover:border-blue-700/50 transition-all\r
                                 text-blue-300 font-semibold text-sm md:text-base`,children:[e.jsx("i",{className:"fa-solid fa-scroll mr-2"}),"赛事规则"]}),e.jsxs("button",{onClick:d,disabled:!h,className:`py-3 px-4 rounded-lg border transition-all font-semibold text-sm md:text-base
                            ${h?"bg-black/30 border-stone-700/50 hover:bg-black/50 hover:border-green-700/50 text-green-300":"bg-gray-800/30 border-gray-700/30 text-gray-500 cursor-not-allowed"}`,children:[e.jsx("i",{className:"fa-solid fa-bullhorn mr-2"}),"关卡公告"]})]}),h&&e.jsxs("div",{className:"bg-red-900/20 rounded-lg p-3 border border-red-700/30",children:[e.jsxs("div",{className:"text-xs text-red-300 mb-2 flex items-center",children:[e.jsx("i",{className:"fa-solid fa-bug mr-2"}),"开发者测试面板（正式版本会移除）"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.status!=="registration"&&e.jsx("button",{onClick:()=>{const T=Ys(h,"registration");c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T}}))},className:"px-3 py-1 bg-green-700/50 hover:bg-green-600/50 text-green-300 text-xs rounded",children:"→ 报名中"}),h.status!=="preparing"&&e.jsx("button",{onClick:()=>{const T=Ys(h,"preparing");c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T}}))},className:"px-3 py-1 bg-yellow-700/50 hover:bg-yellow-600/50 text-yellow-300 text-xs rounded",children:"→ 筹备中"}),h.status!=="in_progress"&&e.jsx("button",{onClick:()=>{const T=Ys(h,"in_progress");c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T}}))},className:"px-3 py-1 bg-red-700/50 hover:bg-red-600/50 text-red-300 text-xs rounded",children:"→ 进行中（显示直播按钮）"}),h.status!=="completed"&&e.jsx("button",{onClick:()=>{const T=Ys(h,"completed");c(G=>({...G,gauntletSystem:{...G.gauntletSystem,currentEvent:T}}))},className:"px-3 py-1 bg-purple-700/50 hover:bg-purple-600/50 text-purple-300 text-xs rounded",children:"→ 已结束"})]})]}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-4 md:p-5 border border-stone-700/30",children:[e.jsx("h4",{className:"text-base font-bold text-amber-300 mb-4",children:"我的参赛记录："}),E.participations>0?e.jsxs("div",{className:"space-y-2 text-sm md:text-base",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),e.jsx("span",{className:"text-gray-300",children:"参赛次数："}),e.jsxs("span",{className:"text-white font-semibold ml-1",children:[E.participations,"次"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),e.jsx("span",{className:"text-gray-300",children:"最佳排名："}),e.jsxs("span",{className:"text-amber-400 font-semibold ml-1",children:["第",E.bestRank,"名"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),e.jsx("span",{className:"text-gray-300",children:"累计得分："}),e.jsxs("span",{className:"text-green-400 font-semibold ml-1",children:[E.totalScore,"分"]})]}),E.wins>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-2",children:"•"}),e.jsx("span",{className:"text-gray-300",children:"冠军次数："}),e.jsxs("span",{className:"text-yellow-400 font-semibold ml-1",children:[E.wins,"次 👑"]})]})]}):e.jsx("div",{className:"text-gray-400 text-sm italic",children:"您尚未参加过大闯关赛事，快来一展身手吧！"})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:l,className:`py-3 px-8 rounded-lg bg-stone-700/50 hover:bg-stone-600/50 \r
                                 text-gray-300 hover:text-white transition-all font-semibold`,children:"返回主界面"})})]}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"bg-stone-900 rounded-lg p-6 max-w-md w-full mx-4 border border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-amber-300",children:[e.jsx("i",{className:"fa-solid fa-scroll mr-2"}),"赛事规则"]}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-white",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsxs("div",{className:"space-y-3 text-gray-300 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"赛制："}),"64人淘汰赛，共6轮"]}),e.jsx("p",{children:e.jsx("strong",{className:"text-white",children:"轮次安排："})}),e.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[e.jsx("li",{children:"第一轮：64人 → 32人晋级"}),e.jsx("li",{children:"第二轮：32人 → 16人晋级"}),e.jsx("li",{children:"第三轮：16人 → 8人晋级"}),e.jsx("li",{children:"第四轮：8人 → 4人晋级"}),e.jsx("li",{children:"第五轮：4人 → 2人晋级"}),e.jsx("li",{children:"第六轮（决赛）：2人 → 1人夺冠"})]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"评判标准："}),"由专业评委现场打分，得分高者晋级"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-white",children:"关卡类型："}),"包含解谜、竞技、体能、技巧、智力、综合等"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>S(!1),className:"py-2 px-6 rounded bg-amber-700 hover:bg-amber-600 text-white font-semibold",children:"知道了"})})]})}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"bg-stone-900 rounded-lg p-6 max-w-md w-full mx-4 border border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-amber-300",children:[e.jsx("i",{className:"fa-solid fa-trophy mr-2"}),"历届冠军"]}),e.jsx("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-white",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),x.eventHistory.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:x.eventHistory.map((T,G)=>e.jsxs("div",{className:"flex items-center justify-between bg-black/30 rounded p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:G===0?"🥇":G===1?"🥈":G===2?"🥉":"🏅"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-white text-sm",children:["第",T.edition,"届"]}),e.jsx("div",{className:"text-amber-400 text-sm",children:T.championName})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(T.date).toLocaleDateString()})]},T.id))}):e.jsx("div",{className:"text-gray-400 text-center py-8",children:"暂无历届冠军记录"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>A(!1),className:"py-2 px-6 rounded bg-amber-700 hover:bg-amber-600 text-white font-semibold",children:"关闭"})})]})})]})},Db=({isOpen:i,onClose:l,gameState:r,setGameState:c})=>{var U;const{gauntletSystem:d}=r,m=d.currentEvent,[f,x]=v.useState("contestants"),[h,g]=v.useState("group"),[b,y]=v.useState(""),[S,C]=v.useState(!1),[A,E]=v.useState([]),[$,Z]=v.useState(null),R=v.useMemo(()=>m?zd(m):null,[m]),V=v.useMemo(()=>m?Nb(m):[],[m]),J=v.useMemo(()=>R?R.danmakuHistory||[]:[],[R]),D=v.useMemo(()=>R?R.commentary||[]:[],[R]),T=v.useMemo(()=>m?m.judges||[]:[],[m]),G=v.useMemo(()=>R?R.rankings||[]:[],[R]),_=v.useCallback(async()=>{if(!(!b.trim()||!m))try{const k=await Ab(m,b,r);c(Q=>({...Q,gauntletSystem:{...Q.gauntletSystem,currentEvent:k.event}})),k.response.narrative&&E(Q=>[...Q,k.response.narrative]),y("")}catch(k){console.error("[直播间] 发送弹幕失败:",k)}},[b,m,r,c]),M=v.useCallback(async()=>{if(!(!m||S)){C(!0);try{const k=await Sb(m,r,{onProgress:(Q,ne,Y)=>{console.log(`[直播间] ${Q}: ${ne}% - ${Y}`),E(X=>[...X,`[${Q}] ${Y}`])},onError:(Q,ne)=>{console.error(`[直播间] ${ne} 失败:`,Q),E(Y=>[...Y,`[错误] ${ne}: ${Q.message}`])},onStageComplete:Q=>{console.log(`[直播间] ${Q} 完成`)}});c(Q=>({...Q,gauntletSystem:{...Q.gauntletSystem,currentEvent:k}}))}catch(k){console.error("[直播间] 比赛执行失败:",k)}finally{C(!1)}}},[m,r,S,c]);return m?e.jsx(za,{isOpen:i,onClose:l,title:`第${m.edition}届大闯关 - 第${(R==null?void 0:R.roundNumber)||0}轮：${((U=R==null?void 0:R.challenge)==null?void 0:U.name)||"准备中"}`,size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-b from-black/40 to-black/20 rounded-lg p-4 min-h-[200px] max-h-[300px] overflow-y-auto border border-stone-700/50",children:[(R==null?void 0:R.challenge)&&e.jsxs("div",{className:"mb-4 pb-3 border-b border-stone-700/50",children:[e.jsxs("div",{className:"text-amber-300 font-semibold mb-1",children:["【",R.challenge.type,"关卡】",R.challenge.name]}),e.jsx("div",{className:"text-gray-300 text-sm",children:R.challenge.finalVersion||R.challenge.description})]}),h==="group"?e.jsx("div",{className:"space-y-3",children:R!=null&&R.performances&&R.performances.length>0?R.performances.map((k,Q)=>e.jsxs("div",{className:`p-3 rounded-lg ${k.passed===!0?"bg-green-900/20 border border-green-700/30":k.passed===!1?"bg-red-900/20 border border-red-700/30":"bg-stone-800/30"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold text-white",children:k.contestantName}),k.score>0&&e.jsxs("span",{className:"text-amber-400",children:["得分: ",k.score.toFixed(1)]})]}),e.jsx("div",{className:"text-gray-300 text-sm",children:k.narrative||"等待表演..."})]},k.contestantId)):e.jsx("div",{className:"text-gray-400 text-center py-8",children:S?"比赛进行中...":"比赛尚未开始，点击下方按钮开始本轮比赛"})}):e.jsx("div",{children:$?(()=>{var Q;const k=(Q=R==null?void 0:R.performances)==null?void 0:Q.find(ne=>ne.contestantId===$);return k?e.jsxs("div",{className:"p-4 bg-stone-800/30 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-white mb-3",children:k.contestantName}),e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap",children:k.narrative}),k.score>0&&e.jsxs("div",{className:"mt-3 text-lg text-amber-400",children:["得分: ",k.score.toFixed(1)]})]}):e.jsx("div",{className:"text-gray-400",children:"选手尚未表演"})})():e.jsx("div",{className:"text-gray-400 text-center py-8",children:"请在下方选择要聚焦的选手"})}),A.length>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-stone-700/50",children:A.slice(-5).map((k,Q)=>e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:k},Q))}),J.length>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-amber-700/30 bg-black/20 rounded p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2 text-sm",children:J.slice(-10).map((k,Q)=>e.jsxs("span",{className:`px-2 py-1 rounded ${k.type==="player"?"bg-amber-700/30 text-amber-300":"bg-stone-700/30 text-gray-300"}`,children:[k.author&&e.jsxs("span",{className:"mr-1 opacity-70",children:[k.author,":"]}),k.content]},k.id||Q))})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-black/20 rounded-lg p-3 border border-stone-700/30",children:[e.jsxs("h4",{className:"text-sm font-semibold text-purple-300 mb-2",children:[e.jsx("i",{className:"fa-solid fa-microphone mr-2"}),"解说席"]}),e.jsx("div",{className:"space-y-2 max-h-24 overflow-y-auto text-sm",children:D.length>0?D.slice(-3).map((k,Q)=>e.jsxs("div",{className:"text-gray-300",children:[e.jsxs("span",{className:"text-purple-400",children:[k.speaker,":"]})," ",k.content]},k.id||Q)):e.jsx("div",{className:"text-gray-500 italic",children:"等待解说..."})})]}),e.jsxs("div",{className:"md:col-span-2 bg-black/20 rounded-lg p-3 border border-stone-700/30",children:[e.jsxs("h4",{className:"text-sm font-semibold text-amber-300 mb-2",children:[e.jsx("i",{className:"fa-solid fa-gavel mr-2"}),"评委席"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.length>0?T.map((k,Q)=>e.jsxs("div",{className:"px-3 py-2 bg-stone-800/50 rounded-lg text-center",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:k.name}),e.jsx("div",{className:"text-xs text-gray-400",children:k.specialty})]},k.id)):e.jsx("div",{className:"text-gray-500 italic",children:"评委尚未就位"})})]})]}),e.jsx("div",{className:"flex gap-2 border-b border-stone-700/50 pb-2",children:[{id:"contestants",label:"参赛者",icon:"fa-users"},{id:"challenge",label:"关卡",icon:"fa-flag"},{id:"ranking",label:"排名",icon:"fa-ranking-star"},{id:"replay",label:"回放",icon:"fa-clock-rotate-left"}].map(k=>e.jsxs("button",{onClick:()=>x(k.id),className:`px-4 py-2 rounded-t-lg text-sm font-semibold transition-all
                                ${f===k.id?"bg-stone-700 text-white":"bg-transparent text-gray-400 hover:text-white hover:bg-stone-800/50"}`,children:[e.jsx("i",{className:`fa-solid ${k.icon} mr-2`}),k.label]},k.id))}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-4 min-h-[120px] max-h-[200px] overflow-y-auto",children:[f==="contestants"&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:V.map(k=>e.jsxs("button",{onClick:()=>{Z(k.id),g("individual")},className:`p-2 rounded-lg text-left text-sm transition-all
                                        ${$===k.id?"bg-amber-700/30 border border-amber-600":"bg-stone-800/50 hover:bg-stone-700/50"}
                                        ${k.isPlayerCharacter?"ring-1 ring-green-500":""}
                                    `,children:[e.jsxs("div",{className:"font-semibold text-white truncate",children:[k.name,k.isPlayerCharacter&&e.jsx("span",{className:"ml-1 text-xs text-green-400",children:"★"})]}),e.jsx("div",{className:"text-xs text-gray-400",children:k.realm})]},k.id))}),f==="challenge"&&(R==null?void 0:R.challenge)&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"关卡名称:"}),e.jsx("span",{className:"ml-2 text-white font-semibold",children:R.challenge.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"类型:"}),e.jsx("span",{className:"ml-2 text-amber-300",children:R.challenge.type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"难度:"}),e.jsxs("span",{className:"ml-2 text-yellow-400",children:["★".repeat(R.challenge.difficulty),"☆".repeat(5-R.challenge.difficulty)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"描述:"}),e.jsx("div",{className:"mt-1 text-gray-300 text-sm",children:R.challenge.finalVersion||R.challenge.description})]})]}),f==="ranking"&&e.jsx("div",{className:"space-y-2",children:G.length>0?G.map((k,Q)=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded
                                            ${Q===0?"bg-amber-900/30":Q===1?"bg-gray-600/30":Q===2?"bg-orange-900/30":"bg-stone-800/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-bold w-8 text-center",children:Q===0?"🥇":Q===1?"🥈":Q===2?"🥉":`${Q+1}`}),e.jsx("span",{className:"text-white font-semibold",children:k.contestantName})]}),e.jsxs("span",{className:"text-amber-400 font-semibold",children:[k.score.toFixed(1),"分"]})]},k.contestantId)):e.jsx("div",{className:"text-gray-400 text-center py-4",children:"本轮比赛尚未开始，暂无排名"})}),f==="replay"&&e.jsxs("div",{className:"text-gray-400 text-center py-8",children:[e.jsx("i",{className:"fa-solid fa-clock-rotate-left text-4xl mb-2"}),e.jsx("p",{children:"回放功能开发中"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 pt-2 border-t border-stone-700/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"观看:"}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"viewMode",checked:h==="group",onChange:()=>g("group"),className:"text-amber-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"群体"})]}),e.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"viewMode",checked:h==="individual",onChange:()=>g("individual"),className:"text-amber-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"个人"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.status==="in_progress"&&!S&&e.jsxs("button",{onClick:M,className:`px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 \r
                                         hover:from-green-500 hover:to-emerald-500 rounded-lg \r
                                         text-white font-semibold text-sm`,children:[e.jsx("i",{className:"fa-solid fa-play mr-2"}),"开始本轮"]}),S&&e.jsxs("div",{className:"px-4 py-2 bg-amber-600/50 rounded-lg text-amber-200 text-sm",children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"比赛进行中..."]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow max-w-md",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"弹幕:"}),e.jsx("input",{type:"text",value:b,onChange:k=>y(k.target.value),onKeyPress:k=>k.key==="Enter"&&_(),placeholder:"发送弹幕...",className:`flex-grow px-3 py-2 bg-stone-800 border border-stone-700 rounded-lg \r
                                     text-white text-sm placeholder-gray-500 focus:outline-none focus:border-amber-600`}),e.jsx("button",{onClick:_,disabled:!b.trim(),className:`px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-700 \r
                                     disabled:cursor-not-allowed rounded-lg text-white text-sm font-semibold`,children:"发送"})]})]})]})}):e.jsx(za,{isOpen:i,onClose:l,title:"大闯关直播间",size:"xl",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📺"}),e.jsx("p",{className:"text-lg",children:"暂无进行中的赛事"}),e.jsx("button",{onClick:l,className:"mt-6 px-6 py-2 bg-stone-700 hover:bg-stone-600 rounded-lg",children:"返回大厅"})]})})},_b=({isOpen:i,onClose:l,gameState:r,onRegister:c,onCancelRegistration:d,onGenerateContestants:m})=>{const{gauntletSystem:f}=r,x=f.currentEvent,[h,g]=v.useState(null),[b,y]=v.useState(!1),[S,C]=v.useState(!1),[A,E]=v.useState(""),[$,Z]=v.useState(""),[R,V]=v.useState(!1),J=v.useMemo(()=>{const{cardCollection:_}=r.playerProfile;return _.filter(M=>M.gender==="Female")},[r.playerProfile.cardCollection]),D=v.useMemo(()=>!x||!x.playerContestantId?null:x.contestants.find(_=>_.id===x.playerContestantId),[x]);v.useEffect(()=>{if(!x||x.status!=="registration"){E("");return}const _=()=>{const U=Date.now(),Q=x.registrationDeadline-U;if(Q<=0)E("报名已截止");else{const ne=Math.floor(Q/36e5),Y=Math.floor(Q%(1e3*60*60)/(1e3*60)),X=Math.floor(Q%(1e3*60)/1e3);ne>0?E(`${ne}小时 ${Y}分 ${X}秒`):Y>0?E(`${Y}分 ${X}秒`):E(`${X}秒`)}};_();const M=setInterval(_,1e3);return()=>clearInterval(M)},[x]);const T=async()=>{if(!h){Z("请先选择一个角色");return}y(!0),Z("");try{await c(h),g(null)}catch(_){Z(_ instanceof Error?_.message:"报名失败，请重试")}finally{y(!1)}},G=async()=>{C(!0),Z("");try{await d()}catch(_){Z(_ instanceof Error?_.message:"取消报名失败，请重试")}finally{C(!1)}};return x?x.status!=="registration"?e.jsx(za,{isOpen:i,onClose:l,title:"大闯关报名",size:"md",children:e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-clock text-4xl mb-4"}),e.jsxs("p",{children:[x.status==="countdown"&&"报名尚未开始",x.status==="preparing"&&"报名已截止，关卡准备中",x.status==="in_progress"&&"比赛已开始",x.status==="completed"&&"本届赛事已结束"]})]})}):e.jsx(za,{isOpen:i,onClose:l,title:`第 ${x.edition} 届大闯关 - 报名`,size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-900/30 to-emerald-900/30 rounded-lg p-4 border border-green-700/30",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"报名状态："}),D?e.jsxs("span",{className:"text-green-400 font-semibold ml-2",children:[e.jsx("i",{className:"fa-solid fa-check-circle mr-1"}),"已报名"]}):e.jsxs("span",{className:"text-yellow-400 font-semibold ml-2",children:[e.jsx("i",{className:"fa-solid fa-hourglass-half mr-1"}),"未报名"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"报名截止："}),e.jsx("span",{className:"text-amber-300 font-semibold ml-2",children:A})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-gray-400",children:["当前报名人数：",e.jsx("span",{className:"text-white font-semibold ml-1",children:x.contestants.length}),e.jsx("span",{className:"text-gray-500",children:" / 64人"})]})]}),D?e.jsxs("div",{className:"bg-black/30 rounded-lg p-5 border border-green-700/30",children:[e.jsxs("h4",{className:"text-lg font-bold text-green-300 mb-4",children:[e.jsx("i",{className:"fa-solid fa-user-check mr-2"}),"您已成功报名"]}),e.jsxs("div",{className:"flex items-center gap-4 bg-black/40 rounded-lg p-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-amber-600 to-orange-700 flex items-center justify-center text-2xl",children:"👩"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold text-lg",children:D.name}),e.jsx("div",{className:"text-gray-400 text-sm",children:D.realm}),e.jsxs("div",{className:"flex gap-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{children:["魅力: ",e.jsx("span",{className:"text-pink-400",children:D.charm})]}),e.jsxs("span",{children:["技巧: ",e.jsx("span",{className:"text-blue-400",children:D.skillfulness})]})]})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:G,disabled:S,className:`py-2 px-6 rounded-lg bg-red-900/50 hover:bg-red-800/50 \r
                                         text-red-300 hover:text-red-200 border border-red-700/50\r
                                         transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"取消中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-times mr-2"}),"取消报名"]})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-black/30 rounded-lg p-5 border border-stone-700/30",children:[e.jsxs("h4",{className:"text-lg font-bold text-amber-300 mb-4",children:[e.jsx("i",{className:"fa-solid fa-user-plus mr-2"}),"选择参赛角色"]}),J.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-user-slash text-3xl mb-3"}),e.jsx("p",{children:"您的收藏中没有可参赛的女性角色"}),e.jsx("p",{className:"text-sm mt-2",children:"请先在商城招募女性角色"})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto",children:J.map(_=>e.jsxs("button",{onClick:()=>g(_),className:`p-3 rounded-lg border transition-all text-left
                                                ${(h==null?void 0:h.id)===_.id?"bg-amber-900/40 border-amber-500 ring-2 ring-amber-500/50":"bg-black/40 border-stone-700/50 hover:border-amber-700/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-600 to-rose-700 flex items-center justify-center text-lg",children:"👩"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-white font-semibold text-sm truncate",children:_.name}),e.jsx("div",{className:"text-gray-400 text-xs truncate",children:_.realm})]})]}),e.jsxs("div",{className:"flex gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:["魅力: ",e.jsx("span",{className:"text-pink-400",children:_.charm||50})]}),e.jsxs("span",{children:["技巧: ",e.jsx("span",{className:"text-blue-400",children:_.skillfulness||50})]})]})]},_.id))})]}),J.length>0&&e.jsxs("div",{className:"text-center",children:[$&&e.jsxs("div",{className:"text-red-400 text-sm mb-3",children:[e.jsx("i",{className:"fa-solid fa-exclamation-circle mr-1"}),$]}),e.jsx("button",{onClick:T,disabled:!h||b,className:`py-3 px-8 rounded-lg font-bold text-lg transition-all
                                        ${h&&!b?"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white shadow-lg hover:shadow-green-500/30":"bg-gray-700/50 text-gray-500 cursor-not-allowed"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"报名中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-check mr-2"}),"确认报名"]})})]})]}),e.jsxs("div",{className:"bg-black/20 rounded-lg p-4 border border-stone-700/30",children:[e.jsxs("h4",{className:"text-base font-bold text-gray-300 mb-3",children:[e.jsx("i",{className:"fa-solid fa-users mr-2"}),"已报名参赛者",e.jsxs("span",{className:"text-gray-500 font-normal ml-2",children:["(",x.contestants.length,"人)"]})]}),x.contestants.length===0?e.jsx("div",{className:"text-gray-500 text-sm text-center py-4",children:"暂无参赛者报名"}):e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:[x.contestants.slice(0,20).map(_=>e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm
                                        ${_.isPlayerCharacter?"bg-amber-900/50 text-amber-300 border border-amber-700/50":"bg-stone-800/50 text-gray-300"}`,children:[_.isPlayerCharacter&&e.jsx("i",{className:"fa-solid fa-star text-amber-400 mr-1 text-xs"}),_.name]},_.id)),x.contestants.length>20&&e.jsxs("div",{className:"px-3 py-1 rounded-full text-sm bg-stone-800/30 text-gray-500",children:["+",x.contestants.length-20," 更多..."]})]}),m&&x.contestants.length<64&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"text-yellow-400",children:[e.jsx("i",{className:"fa-solid fa-flask mr-1"}),"开发者测试"]}),e.jsx("button",{onClick:async()=>{V(!0),Z("");try{const _=64-x.contestants.length;await m(Math.min(_,20))}catch{Z("生成参赛者失败，请重试")}finally{V(!1)}},disabled:R,className:`px-3 py-1 bg-yellow-900/50 hover:bg-yellow-800/50\r
                                         text-yellow-300 rounded border border-yellow-700/50\r
                                         transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:R?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-1"}),"生成中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-users mr-1"}),"生成",Math.min(64-x.contestants.length,20),"名参赛者"]})})]})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:l,className:`py-2 px-6 rounded-lg bg-stone-700/50 hover:bg-stone-600/50 \r
                                 text-gray-300 hover:text-white transition-all`,children:"返回大厅"})})]})}):e.jsx(za,{isOpen:i,onClose:l,title:"大闯关报名",size:"md",children:e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-calendar-xmark text-4xl mb-4"}),e.jsx("p",{children:"暂无进行中的赛事"})]})})},Ob=({isOpen:i,onClose:l,patients:r,onStartConsultation:c,onRefresh:d,onAddPatient:m,isLoading:f,onViewRecord:x,consultationPatient:h,consultationStory:g,consultationChoices:b,onConsultationAction:y,onEndConsultation:S,onReturnToList:C})=>{const[A,E]=v.useState("Female"),[$,Z]=v.useState("待诊"),[R,V]=v.useState("");if(!i)return null;if(h)return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-6xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["诊疗室 - 问诊中: ",h.medicalRecord.name]}),e.jsx("p",{className:"text-sm text-red-400",children:h.medicalRecord.illnessDescription})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:C,className:"bg-blue-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-blue-500/80 transition-colors",children:"返回医馆"}),e.jsx("button",{onClick:S,className:"bg-red-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-red-500/80 transition-colors",children:"结束问诊"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),e.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/4 bg-black/10 p-4 border-r border-stone-700 flex flex-col items-center overflow-y-auto",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-stone-700 mb-4 flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-user-injured text-6xl text-gray-500"})}),e.jsx("h3",{className:"text-xl text-white font-bold",children:h.medicalRecord.name}),e.jsxs("p",{className:"text-gray-400",children:[h.medicalRecord.age,"岁, ",h.medicalRecord.gender==="Male"?"男":"女"]}),e.jsx("button",{onClick:()=>x(h.medicalRecord),className:"mt-6 bg-cyan-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-cyan-500/80 transition-colors w-full",children:"查看病单"})]}),e.jsxs("div",{className:"w-3/4 flex flex-col",children:[e.jsx("div",{className:"flex-grow overflow-y-auto p-4 bg-black/5",children:e.jsx("div",{className:"prose prose-invert max-w-none",children:g.split(`

`).map((D,T)=>e.jsx("p",{className:"text-gray-200 leading-relaxed mb-4",children:D},T))})}),e.jsxs("div",{className:"flex-shrink-0 p-4 bg-black/30 border-t border-stone-700",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:(b&&Array.isArray(b)?b:[]).map((D,T)=>e.jsx("button",{onClick:()=>y(D),disabled:f,className:"flex-grow basis-40 text-center bg-stone-800/80 px-3 py-2 rounded-md hover:bg-stone-700/80 disabled:opacity-50 transition-colors text-white",children:D},T))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:R,onChange:D=>V(D.target.value),onKeyPress:D=>{D.key==="Enter"&&!f&&R.trim()&&(y(R),V(""))},placeholder:"输入你的问诊行动...",disabled:f,className:"flex-grow px-4 py-2 bg-stone-800/80 border border-stone-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-amber-500 disabled:opacity-50"}),e.jsx("button",{onClick:()=>{R.trim()&&(y(R),V(""))},disabled:f||!R.trim(),className:"px-6 py-2 bg-amber-600/80 text-white font-bold rounded-md hover:bg-amber-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:f?"生成中...":"问诊"})]})]})]})]})]})});const J=r.filter(D=>{const T=D.medicalRecord.gender===A,G=$==="全部"||D.status===$;return T&&G});return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"性病医馆"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-stone-700 bg-black/10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>E("Female"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${A==="Female"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"女性病患"}),e.jsx("button",{onClick:()=>E("Male"),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 ${A==="Male"?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"}`,children:"男性病患"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>Z("待诊"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${$==="待诊"?"bg-green-500/20 text-green-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"}`,children:"待诊"}),e.jsx("button",{onClick:()=>Z("治疗中"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${$==="治疗中"?"bg-yellow-500/20 text-yellow-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"}`,children:"治疗中"}),e.jsx("button",{onClick:()=>Z("已治愈"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${$==="已治愈"?"bg-blue-500/20 text-blue-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"}`,children:"已治愈"}),e.jsx("button",{onClick:()=>Z("全部"),className:`px-3 py-1 text-xs font-semibold rounded-md transition-colors ${$==="全部"?"bg-purple-500/20 text-purple-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"}`,children:"全部"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m("Female"),disabled:f,className:"px-3 py-1 text-xs bg-pink-500/20 text-pink-300 rounded-md hover:bg-pink-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"生成中...":"添加女病患"}),e.jsx("button",{onClick:()=>m("Male"),disabled:f,className:"px-3 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-md hover:bg-blue-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"生成中...":"添加男病患"}),e.jsxs("button",{onClick:d,disabled:f,className:"px-3 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded-md hover:bg-yellow-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("i",{className:`fa-solid fa-sync ${f?"animate-spin":""}`})," 刷新列表"]})]})]}),e.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:J.length>0?e.jsx("div",{className:"space-y-4",children:J.map(D=>{const T=D.status==="待诊"?"text-green-400":D.status==="治疗中"?"text-yellow-400":"text-blue-400",G=D.status==="待诊"?"bg-green-500/20":D.status==="治疗中"?"bg-yellow-500/20":"bg-blue-500/20";return e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"text-xl font-bold text-white font-serif",children:[D.medicalRecord.name," ",e.jsxs("span",{className:"text-base font-normal text-gray-400",children:["(",D.medicalRecord.age,"岁)"]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${G} ${T} font-semibold`,children:D.status})]}),e.jsxs("p",{className:"text-sm text-red-400 italic mt-1",children:["病症: ",D.medicalRecord.illnessDescription.substring(0,50),"..."]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>x(D.medicalRecord),className:"bg-cyan-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-cyan-500/80 transition-colors",children:"查看病单"}),D.status==="待诊"&&e.jsx("button",{onClick:()=>c(D.id),className:"bg-green-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-green-500/80 transition-colors",children:"开始问诊"}),D.status==="治疗中"&&e.jsx("button",{onClick:()=>c(D.id),className:"bg-yellow-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-yellow-500/80 transition-colors",children:"继续问诊"})]})]},D.id)})}):e.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[e.jsx("p",{className:"text-4xl mb-4",children:"🌿"}),e.jsx("p",{children:"当前筛选条件下无病人。"})]})})]})})},zb=({isOpen:i,onClose:l,onInteract:r,storyContext:c})=>{const[d,m]=v.useState([]),[f,x]=v.useState(!0),[h,g]=v.useState(null);v.useEffect(()=>{i&&(async()=>{x(!0),g(null);try{console.warn("scanForInteractables is not implemented yet."),m([])}catch(E){console.error("Failed to fetch interactables:",E),m([])}finally{x(!1)}})()},[i,c]);const b=(A,E)=>{const $=`${E} ${A.name}`;r($)},y=A=>{switch(A){case"NPC":return"👤";case"Creature":return"🐾";case"Object":return"📦";default:return"❓"}},S=()=>{if(!h)return null;const A=[{label:"靠近",verb:"你决定走近"},{label:"观察",verb:"你仔细观察"}];let E=[];h.type==="NPC"?(E.push({label:"交谈",verb:"你尝试与"}),E.push({label:"挑战",verb:`你向 ${h.name} 亮出黄牌，发起了挑战。`})):h.type==="Creature"?E.push({label:"攻击",verb:"你亮出黄牌，决定攻击"}):h.type==="Object"&&E.push({label:"调查",verb:"你开始调查"});const $=R=>{R.label==="挑战"||R.label==="攻击"?r(R.verb):b(h,R.verb)},Z=[...A,...E];return e.jsxs("div",{className:"bg-stone-800/70 p-4 rounded-lg animate-fade-in border border-stone-700/50",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("span",{className:"text-3xl mt-1",children:y(h.type)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-amber-400 text-lg",children:h.name}),e.jsx("p",{className:"text-sm text-gray-300",children:h.description})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Z.map(R=>e.jsx("button",{onClick:()=>$(R),className:"bg-stone-700/80 px-4 py-2 rounded-md hover:bg-stone-600 transition-colors duration-200 font-serif",children:R.label},R.label))})]})},C=()=>f?e.jsx("div",{className:"text-center text-amber-300 animate-glow p-8",children:"探查灵气波动中..."}):d.length===0?e.jsx("div",{className:"text-center text-gray-500 p-8",children:"附近似乎没有任何值得注意的东西。"}):e.jsxs("div",{className:"flex flex-row gap-4 h-full",children:[e.jsxs("div",{className:"w-2/5 border-r border-stone-700 overflow-y-auto",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 p-3 sticky top-0 bg-stone-900/90 backdrop-blur-sm border-b border-stone-700/50",children:"附近实体"}),d.map(A=>e.jsxs("button",{onClick:()=>g(A),className:`w-full text-left p-3 text-sm transition-colors duration-150 flex items-center gap-3 ${(h==null?void 0:h.name)===A.name?"bg-amber-600/30":"hover:bg-stone-800/60"}`,children:[e.jsx("span",{className:"text-xl",children:y(A.type)}),e.jsx("span",{className:"font-semibold text-white",children:A.name})]},A.name))]}),e.jsx("div",{className:"w-3/5 p-4 flex flex-col justify-center",children:h?S():e.jsx("div",{className:"text-center text-gray-500",children:e.jsx("p",{children:"从左侧列表选择一个目标进行互动"})})})]});return i?e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[70vh] min-h-[20rem] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg bg-stone-900/80 flex flex-col",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"探查四周"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:C()})]})}):null},Rb=({isOpen:i,onClose:l,prisoner:r,availableTortureMethods:c,onExecuteTorture:d,onEndInterrogation:m,interrogationLog:f,isLoading:x})=>{const[h,g]=v.useState(null),[b,y]=v.useState(30),[S,C]=v.useState(!1);if(!i)return null;const A=c.filter(D=>D.category==="basic"),E=c.filter(D=>D.category==="advanced"),$=c.filter(D=>D.category==="special"),Z=D=>D<10?"text-green-400":D<30?"text-yellow-400":D<60?"text-orange-400":"text-red-400",R=D=>D<10?"极低":D<30?"低":D<60?"中":D<80?"高":"极高",V=D=>{var _;const T=(h==null?void 0:h.id)===D.id,G=!D.requirements||!D.requirements.skill||r.character.skills.some(M=>M.name===D.requirements.skill);return e.jsxs("div",{onClick:()=>G&&g(D),className:`
          p-4 rounded-lg border-2 cursor-pointer transition-all
          ${T?"border-red-500 bg-red-900/30 shadow-lg shadow-red-500/50":G?"border-stone-700 bg-black/30 hover:border-red-500/50 hover:bg-black/50":"border-stone-800 bg-black/10 opacity-50 cursor-not-allowed"}
        `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:`text-lg font-bold ${T?"text-red-400":"text-white"}`,children:D.name}),((_=D.requirements)==null?void 0:_.cost)&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-amber-500/20 text-amber-300 rounded",children:[D.requirements.cost," 灵石"]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:D.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"伤害:"}),e.jsx("span",{className:"ml-1 text-red-400 font-bold",children:D.damage})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"威慑:"}),e.jsx("span",{className:"ml-1 text-orange-400 font-bold",children:D.intimidation})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"成功率:"}),e.jsxs("span",{className:"ml-1 text-green-400 font-bold",children:[D.successRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"屈服度:"}),e.jsxs("span",{className:"ml-1 text-yellow-400 font-bold",children:["+",D.submissionIncrease]})]})]}),e.jsxs("div",{className:"border-t border-stone-700/50 pt-2 mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"风险评估:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"死亡:"}),e.jsx("span",{className:`ml-1 font-bold ${Z(D.risks.death)}`,children:R(D.risks.death)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"重伤:"}),e.jsx("span",{className:`ml-1 font-bold ${Z(D.risks.permanentInjury)}`,children:R(D.risks.permanentInjury)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"疯狂:"}),e.jsx("span",{className:`ml-1 font-bold ${Z(D.risks.insanity)}`,children:R(D.risks.insanity)})]})]})]}),D.requirements&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-stone-700/50",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"需求:"}),D.requirements.skill&&e.jsxs("div",{className:"text-xs text-cyan-400",children:["技能: ",D.requirements.skill]}),D.requirements.item&&e.jsxs("div",{className:"text-xs text-purple-400",children:["道具: ",D.requirements.item]})]})]},D.id)},J=()=>r.history.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("i",{className:"fa-solid fa-file-lines text-4xl mb-4 opacity-50"}),e.jsx("p",{children:"暂无审讯记录"})]}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:r.history.slice().reverse().map(D=>e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg border border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-red-400",children:D.method.name}),e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",D.duration,"分钟)"]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:D.date})]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["审讯者: ",D.interrogator]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"结果:"}),e.jsx("span",{className:`ml-1 font-bold ${D.result.success?"text-green-400":"text-red-400"}`,children:D.result.success?"成功":"失败"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"屈服度:"}),e.jsxs("span",{className:"ml-1 text-yellow-400 font-bold",children:["+",D.result.submissionIncrease]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"健康:"}),e.jsxs("span",{className:"ml-1 text-red-400 font-bold",children:["-",D.result.healthDecrease]})]})]}),D.result.informationGained&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-stone-700/50",children:[e.jsx("div",{className:"text-xs text-cyan-400 mb-1",children:"获得情报:"}),e.jsx("div",{className:"text-sm text-gray-300",children:D.result.informationGained})]})]},D.id))});return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/30 border-b border-red-900/50",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-red-400 font-serif flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-gavel"}),"审讯室 - ",r.character.name]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[r.character.realm," | ",r.crime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(!S),className:"px-4 py-2 bg-cyan-600/80 text-white font-bold rounded-md hover:bg-cyan-500/80 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-history mr-2"}),S?"返回审讯":"审讯历史"]}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-gray-600/80 text-white font-bold rounded-md hover:bg-gray-500/80 transition-colors",children:"结束审讯"}),e.jsx("button",{onClick:l,className:"text-red-400 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),e.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[e.jsxs("div",{className:"w-80 bg-black/20 border-r border-stone-700 p-4 overflow-y-auto flex-shrink-0",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-32 h-32 mx-auto rounded-full bg-stone-700 mb-4 flex items-center justify-center border-4 border-red-900/50",children:e.jsx("i",{className:"fa-solid fa-user-secret text-6xl text-gray-500"})}),e.jsx("h3",{className:"text-xl font-bold text-white",children:r.character.name}),e.jsxs("p",{className:"text-gray-400",children:[r.character.gender==="Male"?"♂ 男性":"♀ 女性"," | ",r.character.realm]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"健康状态"}),e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"健康"}),e.jsxs("span",{className:`text-sm font-bold ${r.health>70?"text-green-400":r.health>40?"text-yellow-400":"text-red-400"}`,children:[r.health,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${r.health>70?"bg-green-500":r.health>40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.health}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"神智"}),e.jsxs("span",{className:`text-sm font-bold ${r.sanity>70?"text-green-400":r.sanity>40?"text-yellow-400":"text-red-400"}`,children:[r.sanity,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${r.sanity>70?"bg-green-500":r.sanity>40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.sanity}%`}})})]}),e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"意志状态"}),e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"屈服度"}),e.jsxs("span",{className:"text-sm font-bold text-yellow-400",children:[r.submissionLevel,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all",style:{width:`${r.submissionLevel}%`}})}),e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"归顺度"}),e.jsxs("span",{className:"text-sm font-bold text-green-400",children:[r.loyaltyLevel,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${r.loyaltyLevel}%`}})})]})]}),r.knownInformation.length>0&&e.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"已获情报"}),e.jsx("div",{className:"space-y-1",children:r.knownInformation.map((D,T)=>e.jsxs("div",{className:"text-xs text-cyan-400 flex items-start gap-1",children:[e.jsx("i",{className:"fa-solid fa-check-circle mt-0.5"}),e.jsx("span",{children:D})]},T))})]})]}),e.jsx("div",{className:"flex-grow flex flex-col overflow-hidden",children:S?e.jsxs("div",{className:"p-6 overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"审讯历史记录"}),J()]}):e.jsxs(e.Fragment,{children:[f&&e.jsxs("div",{className:"bg-black/30 p-4 border-b border-stone-700 max-h-48 overflow-y-auto flex-shrink-0",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 mb-2",children:"审讯记录"}),e.jsx("div",{className:"prose prose-invert max-w-none",children:f.split(`
`).map((D,T)=>e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed mb-2",children:D},T))})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[A.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle text-green-500 text-xs"}),"基础刑法"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:A.map(V)})]}),E.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle text-orange-500 text-xs"}),"进阶刑法"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:E.map(V)})]}),$.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle text-purple-500 text-xs"}),"特殊刑法"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:$.map(V)})]})]}),h&&e.jsx("div",{className:"flex-shrink-0 p-4 bg-black/40 border-t border-red-900/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"text-white font-bold mb-2",children:["已选择: ",e.jsx("span",{className:"text-red-400",children:h.name})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-gray-400 text-sm",children:"持续时间(分钟):"}),e.jsx("input",{type:"number",value:b,onChange:D=>y(Number(D.target.value)),min:"5",max:"180",step:"5",className:"w-24 px-3 py-1 bg-stone-800 border border-stone-600 rounded text-white text-sm"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",Math.floor(b/60),"小时",b%60,"分钟)"]})]})]}),e.jsx("button",{onClick:()=>d(r.character.id,h.id,b),disabled:x,className:"px-6 py-3 bg-red-600/80 text-white font-bold rounded-md hover:bg-red-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"执行中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-gavel mr-2"}),"执行刑罚"]})})]})})]})})]})]})})},Md=[{id:"kun_lun_xu",name:"昆仑墟",type:"Mountain",region:"中州",realm:"天界",x:500,y:300,description:"传说中仙人居住的圣山，灵气浓郁至极，直通九天。",isMajor:!0},{id:"tian_gong",name:"天宫",type:"Palace",region:"中州",realm:"天界",x:600,y:400,description:"诸天仙神的居所，云雾缭绕，仙乐飘飘。",isMajor:!0},{id:"yao_chi",name:"瑶池",type:"River",region:"东荒",realm:"天界",x:300,y:450,description:"仙池圣水，据说可洗涤凡尘，获得仙缘。",isMajor:!1},{id:"tai_xu_jing",name:"太虚境",type:"Plain",region:"西境",realm:"天界",x:750,y:350,description:"虚无缥缈之地，只有得道高人才能进入。",isMajor:!1},{id:"qing_she_zong",name:"青蛇宗",type:"Sect",region:"东荒",realm:"人界",x:250,y:400,description:"一切开始的地方，一个中等规模的修仙宗门。",isMajor:!0},{id:"bai_hua_gu",name:"百花谷",type:"Sect",region:"东荒",realm:"人界",x:200,y:600,description:"以医术和丹药闻名的女性宗门。",isMajor:!0},{id:"wan_yao_sen_lin",name:"万妖森林",type:"Forest",region:"东荒",realm:"人界",x:350,y:700,description:"妖兽横行，但机遇与危险并存的古老森林。",isMajor:!1},{id:"yun_meng_ze",name:"云梦大泽",type:"River",region:"东荒",realm:"人界",x:150,y:300,description:"广阔的沼泽地，据说有上古异兽出没。",isMajor:!1},{id:"tian_ji_ge",name:"天机阁",type:"City",region:"中州",realm:"人界",x:500,y:500,description:"中州皇城，世界的中心，凡人与修士混居。",isMajor:!0},{id:"tian_yuan_fang_shi",name:"天元坊市",type:"City",region:"中州",realm:"人界",x:600,y:650,description:"世界上最大的修仙者交易市场。",isMajor:!1},{id:"huang_gu_yi_ji",name:"荒古遗迹",type:"Mountain",region:"西境",realm:"人界",x:800,y:400,description:"上古仙魔大战的战场，散落着无数法宝残片。",isMajor:!1},{id:"wu_shen_zhai",name:"巫神寨",type:"Sect",region:"南疆",realm:"人界",x:650,y:850,description:"南疆最大的巫蛊部落，神秘莫测。",isMajor:!0},{id:"shi_wan_da_shan",name:"十万大山",type:"Mountain",region:"南疆",realm:"人界",x:750,y:950,description:"连绵不绝的山脉，充满了毒虫猛兽和天材地宝。",isMajor:!1},{id:"du_long_he",name:"毒龙河",type:"River",region:"南疆",realm:"人界",x:550,y:800,description:"河水呈诡异的紫色，据说有剧毒。",isMajor:!1},{id:"xuan_bing_gong",name:"玄冰宫",type:"Sect",region:"北原",realm:"人界",x:250,y:950,description:"建立在万年冰川之上的宗门，弟子皆修行冰系功法。",isMajor:!0},{id:"ji_bei_xue_yuan",name:"极北雪原",type:"Plain",region:"北原",realm:"人界",x:150,y:1050,description:"一片冰封的荒原，人迹罕至。",isMajor:!1},{id:"zhen_yu_da_lao",name:"镇狱大牢",type:"Prison",region:"中州",realm:"冥界",x:500,y:400,description:"中州皇城地下的巨型监狱，关押着各方罪犯和重要俘虏。阴森恐怖，传闻有去无回。",isMajor:!0},{id:"tian_mo_cheng",name:"天魔城",type:"City",region:"西境",realm:"冥界",x:750,y:300,description:"魔道修士的聚集地，混乱但自由，位于地下深渊。",isMajor:!0},{id:"wu_jian_dong",name:"无间洞府",type:"Cave",region:"西境",realm:"冥界",x:650,y:500,description:"一个深不见底的洞穴，传闻直通地狱最深处。",isMajor:!1},{id:"huang_quan_lu",name:"黄泉路",type:"River",region:"中州",realm:"冥界",x:400,y:600,description:"亡魂必经之路，河水漆黑如墨，散发着死亡气息。",isMajor:!1},{id:"wang_chuan_he",name:"忘川河",type:"River",region:"东荒",realm:"冥界",x:250,y:700,description:"饮下忘川水，忘却前尘往事。",isMajor:!1},{id:"sen_luo_dian",name:"森罗殿",type:"Palace",region:"中州",realm:"冥界",x:600,y:450,description:"地府阎罗的议事大殿，审判生前罪孽。",isMajor:!0}],Lb=i=>Md.filter(l=>l.realm===i),Bb=["天界","人界","冥界"],Rx=({currentLocationName:i,onLocationSelect:l,onClose:r,className:c=""})=>{const[d,m]=v.useState(""),[f,x]=v.useState(!1),[h,g]=v.useState(-1),b=v.useRef(null),y=v.useRef(null),S=v.useMemo(()=>{if(!d.trim())return Md;const R=d.toLowerCase();return Md.filter(V=>V.name.toLowerCase().includes(R)||V.region.toLowerCase().includes(R)||V.type.toLowerCase().includes(R)||V.description.toLowerCase().includes(R))},[d]),C=v.useMemo(()=>{const R={};return S.forEach(V=>{R[V.region]||(R[V.region]=[]),R[V.region].push(V)}),R},[S]);v.useEffect(()=>{const R=V=>{b.current&&!b.current.contains(V.target)&&x(!1)};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[]);const A=R=>{if(!f){(R.key==="Enter"||R.key==="ArrowDown")&&(x(!0),g(0));return}switch(R.key){case"ArrowDown":R.preventDefault(),g(V=>V<S.length-1?V+1:V);break;case"ArrowUp":R.preventDefault(),g(V=>V>0?V-1:0);break;case"Enter":R.preventDefault(),h>=0&&h<S.length&&E(S[h]);break;case"Escape":x(!1),g(-1);break}},E=R=>{var V;l(R),x(!1),m(""),g(-1),(V=y.current)==null||V.blur()},$=R=>({Sect:"fa-mountain-sun",City:"fa-city",Cave:"fa-dungeon",Mountain:"fa-mountain",Forest:"fa-tree",Plain:"fa-seedling",River:"fa-water",Sea:"fa-ship",Prison:"fa-bars",Palace:"fa-crown"})[R]||"fa-map-marker",Z=R=>({东荒:"text-green-400",西境:"text-yellow-400",南疆:"text-red-400",北原:"text-blue-400",中州:"text-purple-400"})[R]||"text-gray-400";return e.jsxs("div",{ref:b,className:`relative ${c}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:y,type:"text",value:d,onChange:R=>m(R.target.value),onFocus:()=>x(!0),onKeyDown:A,placeholder:"搜索地点...",className:"w-full pl-10 pr-10 py-2.5 bg-gradient-to-r from-black/80 via-stone-900/70 to-black/80 backdrop-blur-md border-2 border-amber-500/40 rounded-lg text-amber-100 placeholder-amber-300/60 focus:outline-none focus:border-amber-500/70 focus:ring-2 focus:ring-amber-500/30 focus:shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-all"}),e.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-amber-400/80 drop-shadow-[0_0_6px_rgba(251,191,36,0.5)]"}),d&&e.jsx("button",{onClick:()=>{var R;m(""),(R=y.current)==null||R.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-amber-400/70 hover:text-amber-300 transition-colors",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),f&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gradient-to-b from-black/95 via-stone-900/90 to-black/95 backdrop-blur-xl border-2 border-amber-500/40 rounded-lg shadow-2xl max-h-[400px] overflow-y-auto",style:{boxShadow:"0 10px 40px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(251, 191, 36, 0.2)",zIndex:9999},children:[S.length===0?e.jsxs("div",{className:"p-4 text-center text-amber-300/50",children:[e.jsx("i",{className:"fa-solid fa-search text-2xl mb-2"}),e.jsx("p",{children:"未找到匹配的地点"})]}):e.jsx("div",{className:"py-2",children:Object.entries(C).map(([R,V])=>e.jsxs("div",{className:"mb-2 last:mb-0",children:[e.jsx("div",{className:"px-3 py-1.5 bg-gradient-to-r from-stone-900/60 via-stone-800/50 to-stone-900/60 border-b border-amber-500/10",children:e.jsxs("span",{className:`text-xs font-bold font-serif ${Z(R)} drop-shadow-[0_0_8px_currentColor]`,children:["✦ ",R," ✦"]})}),V.map((J,D)=>{const T=S.indexOf(J),G=J.name===i,_=T===h;return e.jsxs("button",{onClick:()=>E(J),className:`w-full px-3 py-2.5 flex items-start gap-3 hover:bg-gradient-to-r hover:from-amber-900/30 hover:via-amber-800/20 hover:to-amber-900/30 transition-all ${_?"bg-gradient-to-r from-amber-900/40 via-amber-800/30 to-amber-900/40 shadow-[inset_0_0_10px_rgba(251,191,36,0.2)]":""} ${G?"bg-gradient-to-r from-amber-900/20 to-transparent border-l-2 border-amber-500 shadow-[inset_0_0_10px_rgba(251,191,36,0.1)]":""}`,children:[e.jsx("div",{className:`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded ${G?"bg-amber-500/20 text-amber-400":"bg-stone-800/50 text-amber-300/70"}`,children:e.jsx("i",{className:`fa-solid ${$(J.type)} text-sm`})}),e.jsxs("div",{className:"flex-grow text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:`font-serif font-semibold ${G?"text-amber-300":"text-amber-100"}`,children:J.name}),J.isMajor&&e.jsx("span",{className:"text-amber-400 text-xs",children:"★"}),G&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-amber-500/20 text-amber-400 rounded",children:"当前"})]}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-1",children:J.description})]})]},J.id)})]},R))}),e.jsx("div",{className:"px-3 py-2 border-t-2 border-amber-500/30 bg-gradient-to-r from-black/70 via-stone-900/60 to-black/70",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-amber-300/60",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"↑↓"})," 导航"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"Enter"})," 选择"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"Esc"})," 关闭"]})]})})]})]})},Lx=(i,l)=>{const r=i.clientX-l.clientX,c=i.clientY-l.clientY;return Math.sqrt(r*r+c*c)},Bx=(i,l)=>({x:(i.clientX+l.clientX)/2,y:(i.clientY+l.clientY)/2}),Hb=(i={})=>{const{initialScale:l=1,minScale:r=.5,maxScale:c=3,onScaleChange:d,onTranslateChange:m}=i,[f,x]=v.useState(l),[h,g]=v.useState(0),[b,y]=v.useState(0),[S,C]=v.useState(!1),A=v.useRef(null),E=v.useRef(null),$=v.useRef({x:0,y:0}),Z=v.useRef(0),R=v.useCallback((Y,X)=>{const L=f>=2?1:2;x(L),d==null||d(L)},[f,d]),V=v.useCallback(Y=>{if(Y.touches.length===2){const X=Lx(Y.touches[0],Y.touches[1]),L=Bx(Y.touches[0],Y.touches[1]);A.current=X,E.current=L}else if(Y.touches.length===1){const X=Date.now();X-Z.current<300&&R(Y.touches[0].clientX,Y.touches[0].clientY),Z.current=X,C(!0),$.current={x:Y.touches[0].clientX-h,y:Y.touches[0].clientY-b}}},[h,b,R]),J=v.useCallback(Y=>{if(Y.preventDefault(),Y.touches.length===2){const X=Lx(Y.touches[0],Y.touches[1]),L=Bx(Y.touches[0],Y.touches[1]);if(A.current&&E.current){const I=X/A.current,K=Math.max(r,Math.min(c,f*I)),fe=L.x-E.current.x,ge=L.y-E.current.y;x(K),g(O=>O+fe),y(O=>O+ge),d==null||d(K),m==null||m(h+fe,b+ge)}A.current=X,E.current=L}else if(Y.touches.length===1&&S){const X=Y.touches[0].clientX-$.current.x,L=Y.touches[0].clientY-$.current.y;g(X),y(L),m==null||m(X,L)}},[f,r,c,S,h,b,d,m]),D=v.useCallback(Y=>{Y.touches.length===0&&(C(!1),A.current=null,E.current=null)},[]),T=v.useCallback(Y=>{C(!0),$.current={x:Y.clientX-h,y:Y.clientY-b}},[h,b]),G=v.useCallback(Y=>{if(S){const X=Y.clientX-$.current.x,L=Y.clientY-$.current.y;g(X),y(L),m==null||m(X,L)}},[S,m]),_=v.useCallback(()=>{C(!1)},[]),M=v.useCallback(Y=>{Y.preventDefault();const X=Y.deltaY>0?.9:1.1,L=Math.max(r,Math.min(c,f*X)),I=Y.target.getBoundingClientRect(),K=Y.clientX-I.left,fe=Y.clientY-I.top,ge=L/f,O=K-(K-h)*ge,se=fe-(fe-b)*ge;x(L),g(O),y(se),d==null||d(L),m==null||m(O,se)},[f,r,c,h,b,d,m]),U=v.useCallback(()=>{x(l),g(0),y(0),d==null||d(l),m==null||m(0,0)},[l,d,m]),k=v.useCallback(()=>{const Y=Math.min(c,f*1.2);x(Y),d==null||d(Y)},[f,c,d]),Q=v.useCallback(()=>{const Y=Math.max(r,f*.8);x(Y),d==null||d(Y)},[f,r,d]),ne=v.useCallback(Y=>{const X=Math.max(r,Math.min(c,Y));x(X),d==null||d(X)},[r,c,d]);return[{scale:f,translateX:h,translateY:b,isDragging:S},{handleTouchStart:V,handleTouchMove:J,handleTouchEnd:D,handleMouseDown:T,handleMouseMove:G,handleMouseUp:_,handleWheel:M,resetView:U,zoomIn:k,zoomOut:Q,setScale:ne}]},Ub=({scale:i,onZoomIn:l,onZoomOut:r,onReset:c,minScale:d=.5,maxScale:m=3,className:f=""})=>{const x=Math.round(i*100),h=i<=d,g=i>=m;return e.jsxs("div",{className:`flex items-center gap-2 bg-gradient-to-r from-black/80 via-stone-900/70 to-black/80 backdrop-blur-md rounded-lg px-3 py-2 border-2 border-amber-500/40 shadow-lg ${f}`,style:{boxShadow:"0 4px 20px rgba(251, 191, 36, 0.2), inset 0 0 20px rgba(0, 0, 0, 0.5)"},children:[e.jsx("button",{onClick:r,disabled:h,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md disabled:opacity-30 disabled:cursor-not-allowed transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"缩小 (Ctrl + -)",children:e.jsx("i",{className:"fa-solid fa-minus text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),e.jsxs("div",{className:"flex items-center gap-2 px-2 min-w-[100px]",children:[e.jsxs("span",{className:"text-amber-200 text-sm font-mono font-semibold whitespace-nowrap drop-shadow-[0_0_6px_rgba(251,191,36,0.6)]",children:[x,"%"]}),e.jsx("input",{type:"range",min:d*100,max:m*100,value:i*100,onChange:b=>{parseFloat(b.target.value)/100>i?l():r()},className:"hidden md:block w-20 h-1 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-amber-500",style:{background:`linear-gradient(to right, #f59e0b 0%, #f59e0b ${(i-d)/(m-d)*100}%, #44403c ${(i-d)/(m-d)*100}%, #44403c 100%)`}})]}),e.jsx("button",{onClick:l,disabled:g,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md disabled:opacity-30 disabled:cursor-not-allowed transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"放大 (Ctrl + +)",children:e.jsx("i",{className:"fa-solid fa-plus text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),e.jsx("div",{className:"w-px h-6 bg-amber-500/30"}),e.jsx("button",{onClick:c,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"重置视图 (Home)",children:e.jsx("i",{className:"fa-solid fa-compress text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),e.jsxs("div",{className:"md:hidden flex items-center gap-1 pl-2 border-l border-amber-500/30",children:[e.jsx("span",{className:"text-amber-400/70 text-xs",children:e.jsx("i",{className:"fa-solid fa-hand-pointer"})}),e.jsx("span",{className:"text-amber-200/70 text-xs whitespace-nowrap",children:"双指缩放"})]})]})},Hx=({onLocationSelect:i,currentLocationName:l,isMobile:r=!1})=>{const[c,d]=v.useState(null),[m,f]=v.useState("人界"),x=1200,h=1e3,[g,b]=Hb({initialScale:1,minScale:.5,maxScale:3}),{scale:y,translateX:S,translateY:C,isDragging:A}=g,{handleTouchStart:E,handleTouchMove:$,handleTouchEnd:Z,handleMouseDown:R,handleMouseMove:V,handleMouseUp:J,handleWheel:D,resetView:T,zoomIn:G,zoomOut:_}=b,M=v.useMemo(()=>Lb(m),[m]),k=(I=>{switch(I){case"天界":return{bgGradient:["#0c1445","#1e3a8a","#3b82f6"],cloudColor:"#ffffff",mountainColor:"#60a5fa",waterColor:"#93c5fd",textColor:"#dbeafe",accentColor:"#fbbf24",glowColor:"#60a5fa"};case"人界":return{bgGradient:["#1c1917","#292524","#44403c"],cloudColor:"#a8a29e",mountainColor:"#57534e",waterColor:"#60a5fa",textColor:"#e7e5e4",accentColor:"#fbbf24",glowColor:"#f59e0b"};case"冥界":return{bgGradient:["#09090b","#18181b","#27272a"],cloudColor:"#3f3f46",mountainColor:"#27272a",waterColor:"#52525b",textColor:"#d4d4d8",accentColor:"#a855f7",glowColor:"#7c3aed"}}})(m),Q=()=>e.jsxs("g",{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"celestial-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#0c1445"}),e.jsx("stop",{offset:"40%",stopColor:"#1e3a8a"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6"})]}),e.jsxs("radialGradient",{id:"celestial-glow",cx:"50%",cy:"30%",r:"50%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"#fbbf24",stopOpacity:"0"})]}),e.jsx("filter",{id:"cloud-blur",children:e.jsx("feGaussianBlur",{stdDeviation:"8"})})]}),e.jsx("rect",{width:x,height:h,fill:"url(#celestial-sky)"}),e.jsx("rect",{width:x,height:h,fill:"url(#celestial-glow)"}),[...Array(50)].map((I,K)=>e.jsx("circle",{cx:Math.random()*x,cy:Math.random()*h*.6,r:Math.random()*2+.5,fill:"#ffffff",opacity:Math.random()*.5+.3},`star-${K}`)),e.jsx("ellipse",{cx:"200",cy:"200",rx:"150",ry:"40",fill:"#ffffff",opacity:"0.1",filter:"url(#cloud-blur)"}),e.jsx("ellipse",{cx:"600",cy:"150",rx:"200",ry:"50",fill:"#ffffff",opacity:"0.15",filter:"url(#cloud-blur)"}),e.jsx("ellipse",{cx:"1000",cy:"180",rx:"180",ry:"45",fill:"#ffffff",opacity:"0.1",filter:"url(#cloud-blur)"}),e.jsx("path",{d:"M0,600 Q100,450 200,550 Q300,400 400,500 Q500,350 600,480 Q700,380 800,500 Q900,420 1000,520 Q1100,450 1200,550 L1200,1000 L0,1000 Z",fill:"#1e40af",opacity:"0.3"}),e.jsx("path",{d:"M0,700 Q150,550 300,650 Q450,500 600,620 Q750,480 900,600 Q1050,520 1200,650 L1200,1000 L0,1000 Z",fill:"#2563eb",opacity:"0.4"}),e.jsx("ellipse",{cx:"300",cy:"750",rx:"250",ry:"60",fill:"#ffffff",opacity:"0.2",filter:"url(#cloud-blur)"}),e.jsx("ellipse",{cx:"700",cy:"720",rx:"300",ry:"70",fill:"#ffffff",opacity:"0.25",filter:"url(#cloud-blur)"}),e.jsx("ellipse",{cx:"1050",cy:"760",rx:"200",ry:"50",fill:"#ffffff",opacity:"0.2",filter:"url(#cloud-blur)"}),e.jsx("path",{d:"M0,800 Q200,650 400,750 Q600,600 800,720 Q1000,650 1200,780 L1200,1000 L0,1000 Z",fill:"#3b82f6",opacity:"0.5"}),e.jsx("path",{d:"M580,650 Q590,750 585,850",stroke:"#93c5fd",strokeWidth:"3",fill:"none",opacity:"0.6"}),e.jsx("path",{d:"M590,650 Q600,750 595,850",stroke:"#bfdbfe",strokeWidth:"2",fill:"none",opacity:"0.4"})]}),ne=()=>e.jsxs("g",{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"mortal-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#1c1917"}),e.jsx("stop",{offset:"30%",stopColor:"#292524"}),e.jsx("stop",{offset:"100%",stopColor:"#44403c"})]}),e.jsxs("linearGradient",{id:"water-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.3"}),e.jsx("stop",{offset:"50%",stopColor:"#60a5fa",stopOpacity:"0.5"}),e.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.3"})]}),e.jsx("filter",{id:"mountain-shadow",children:e.jsx("feDropShadow",{dx:"2",dy:"4",stdDeviation:"3",floodColor:"#000000",floodOpacity:"0.3"})})]}),e.jsx("rect",{width:x,height:h,fill:"url(#mortal-sky)"}),e.jsx("circle",{cx:"950",cy:"120",r:"50",fill:"#fef3c7",opacity:"0.8"}),e.jsx("circle",{cx:"930",cy:"110",r:"50",fill:"url(#mortal-sky)"}),e.jsx("path",{d:"M0,500 Q100,400 200,450 Q350,350 500,420 Q650,320 800,400 Q950,340 1100,420 L1200,450 L1200,1000 L0,1000 Z",fill:"#44403c",opacity:"0.4"}),e.jsx("path",{d:"M0,550 Q150,420 300,500 Q500,380 700,480 Q900,400 1100,500 L1200,520 L1200,1000 L0,1000 Z",fill:"#57534e",opacity:"0.5"}),e.jsx("path",{d:"M0,620 Q50,600 100,620 Q150,590 200,620 Q250,580 300,620 Q350,590 400,620 Q450,580 500,620 Q550,590 600,620 Q650,580 700,620 Q750,590 800,620 Q850,580 900,620 Q950,590 1000,620 Q1050,580 1100,620 Q1150,590 1200,620 L1200,1000 L0,1000 Z",fill:"#365314",opacity:"0.4"}),e.jsx("path",{d:"M0,700 Q200,550 400,680 Q600,520 800,660 Q1000,580 1200,700 L1200,1000 L0,1000 Z",fill:"#78716c",opacity:"0.6",filter:"url(#mountain-shadow)"}),e.jsx("path",{d:"M100,750 Q300,780 500,750 Q700,720 900,760 Q1100,790 1200,770",stroke:"url(#water-gradient)",strokeWidth:"40",fill:"none",opacity:"0.6",strokeLinecap:"round"}),e.jsx("path",{d:"M100,750 Q300,780 500,750 Q700,720 900,760 Q1100,790 1200,770",stroke:"#93c5fd",strokeWidth:"2",fill:"none",opacity:"0.4",strokeLinecap:"round",strokeDasharray:"20 30"}),e.jsx("path",{d:"M0,850 Q300,820 600,850 Q900,880 1200,850 L1200,1000 L0,1000 Z",fill:"#292524",opacity:"0.8"}),e.jsx("path",{d:"M600,1000 Q580,900 620,800 Q650,700 600,600",stroke:"#78716c",strokeWidth:"8",fill:"none",opacity:"0.3",strokeLinecap:"round"})]}),Y=()=>e.jsxs("g",{children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"nether-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#09090b"}),e.jsx("stop",{offset:"50%",stopColor:"#18181b"}),e.jsx("stop",{offset:"100%",stopColor:"#27272a"})]}),e.jsxs("radialGradient",{id:"nether-glow",cx:"50%",cy:"70%",r:"40%",children:[e.jsx("stop",{offset:"0%",stopColor:"#7c3aed",stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:"#7c3aed",stopOpacity:"0"})]}),e.jsx("filter",{id:"nether-blur",children:e.jsx("feGaussianBlur",{stdDeviation:"5"})})]}),e.jsx("rect",{width:x,height:h,fill:"url(#nether-sky)"}),e.jsx("rect",{width:x,height:h,fill:"url(#nether-glow)"}),e.jsx("ellipse",{cx:"200",cy:"300",rx:"200",ry:"100",fill:"#3f3f46",opacity:"0.15",filter:"url(#nether-blur)"}),e.jsx("ellipse",{cx:"800",cy:"250",rx:"250",ry:"120",fill:"#52525b",opacity:"0.1",filter:"url(#nether-blur)"}),e.jsx("ellipse",{cx:"500",cy:"400",rx:"300",ry:"150",fill:"#3f3f46",opacity:"0.12",filter:"url(#nether-blur)"}),e.jsx("path",{d:"M0,450 L100,300 L150,380 L250,250 L350,400 L450,280 L550,420 L650,300 L750,450 L850,320 L950,400 L1050,280 L1150,380 L1200,350 L1200,1000 L0,1000 Z",fill:"#27272a",opacity:"0.5"}),e.jsx("path",{d:"M0,550 L80,400 L180,500 L280,350 L380,480 L480,380 L580,520 L680,400 L780,550 L880,420 L980,500 L1080,380 L1200,480 L1200,1000 L0,1000 Z",fill:"#3f3f46",opacity:"0.6"}),e.jsx("path",{d:"M0,700 Q200,750 400,700 Q600,650 800,720 Q1000,780 1200,720",stroke:"#52525b",strokeWidth:"50",fill:"none",opacity:"0.5",strokeLinecap:"round"}),e.jsx("path",{d:"M0,700 Q200,750 400,700 Q600,650 800,720 Q1000,780 1200,720",stroke:"#7c3aed",strokeWidth:"3",fill:"none",opacity:"0.3",strokeLinecap:"round"}),e.jsx("path",{d:"M0,800 L100,700 L200,780 L350,680 L500,800 L650,720 L800,820 L950,750 L1100,850 L1200,780 L1200,1000 L0,1000 Z",fill:"#18181b",opacity:"0.8"}),[...Array(8)].map((I,K)=>e.jsxs("g",{children:[e.jsx("ellipse",{cx:100+K*150,cy:850-K%3*50,rx:"8",ry:"15",fill:"#7c3aed",opacity:"0.4"}),e.jsx("ellipse",{cx:100+K*150,cy:845-K%3*50,rx:"4",ry:"8",fill:"#a855f7",opacity:"0.6"})]},`flame-${K}`))]}),X=()=>{switch(m){case"天界":return Q();case"人界":return ne();case"冥界":return Y()}},L=I=>{const K=I.name===l,fe=c===I.id,ge=K||fe?k.accentColor:k.textColor,O=k.glowColor,se=K?1.15:fe?1.1:1,he=()=>{switch(I.type){case"Sect":return e.jsxs("g",{children:[e.jsx("path",{d:`M0,-12 L-${12*.8},${12*.6} L${12*.8},${12*.6} Z`,fill:ge,opacity:"0.9"}),e.jsx("rect",{x:-12*.4,y:12*.2,width:12*.8,height:12*.5,fill:ge,opacity:"0.7"})]});case"City":return e.jsxs("g",{children:[e.jsx("rect",{x:-12,y:-12*.5,width:24,height:12*1.2,fill:ge,opacity:"0.9",rx:"2"}),e.jsx("rect",{x:-12*.6,y:-12*.2,width:12*.4,height:12*.8,fill:k.bgGradient[0],opacity:"0.6"}),e.jsx("rect",{x:12*.2,y:-12*.2,width:12*.4,height:12*.8,fill:k.bgGradient[0],opacity:"0.6"})]});case"Palace":return e.jsxs("g",{children:[e.jsx("path",{d:`M0,-12 L-12,${12*.3} L12,${12*.3} Z`,fill:ge,opacity:"0.9"}),e.jsx("rect",{x:-12*.8,y:12*.3,width:12*1.6,height:12*.5,fill:ge,opacity:"0.8"}),e.jsx("circle",{cx:"0",cy:-12*.3,r:12*.25,fill:k.accentColor,opacity:"0.9"})]});case"Cave":return e.jsxs("g",{children:[e.jsx("ellipse",{cx:"0",cy:"0",rx:12,ry:12*.8,fill:ge,opacity:"0.9"}),e.jsx("ellipse",{cx:"0",cy:-12*.15,rx:12*.6,ry:12*.4,fill:k.bgGradient[0],opacity:"0.7"})]});case"Mountain":return e.jsxs("g",{children:[e.jsx("path",{d:`M-12,${12*.8} L0,-12 L12,${12*.8} Z`,fill:"none",stroke:ge,strokeWidth:"2.5",opacity:"0.9"}),e.jsx("path",{d:`M-${12*.5},${12*.8} L0,-${12*.2} L${12*.5},${12*.8}`,fill:"none",stroke:ge,strokeWidth:"2",opacity:"0.6"})]});case"Forest":return e.jsx("g",{children:e.jsx("path",{d:`M0,-12 L-${12*.7},${12*.2} L-${12*.3},${12*.2} L-12,12 L12,12 L${12*.3},${12*.2} L${12*.7},${12*.2} Z`,fill:ge,opacity:"0.9"})});case"River":return e.jsxs("g",{children:[e.jsx("path",{d:`M-12,-${12*.4} Q-${12*.5},0 0,0 T12,${12*.4}`,fill:"none",stroke:ge,strokeWidth:"3",opacity:"0.9",strokeLinecap:"round"}),e.jsx("path",{d:`M-12,${12*.2} Q-${12*.5},${12*.6} 0,${12*.6} T12,12`,fill:"none",stroke:ge,strokeWidth:"2.5",opacity:"0.6",strokeLinecap:"round"})]});case"Prison":return e.jsxs("g",{children:[e.jsx("rect",{x:-12,y:-12*.7,width:24,height:12*1.6,fill:ge,opacity:"0.9",rx:"2"}),e.jsx("line",{x1:-12*.5,y1:-12*.7,x2:-12*.5,y2:12*.9,stroke:k.bgGradient[0],strokeWidth:"2",opacity:"0.7"}),e.jsx("line",{x1:"0",y1:-12*.7,x2:"0",y2:12*.9,stroke:k.bgGradient[0],strokeWidth:"2",opacity:"0.7"}),e.jsx("line",{x1:12*.5,y1:-12*.7,x2:12*.5,y2:12*.9,stroke:k.bgGradient[0],strokeWidth:"2",opacity:"0.7"})]});default:return e.jsx("circle",{r:12,fill:ge,opacity:"0.9"})}};return e.jsxs("g",{transform:`translate(${I.x}, ${I.y})`,onMouseEnter:()=>!r&&d(I.id),onMouseLeave:()=>!r&&d(null),onClick:le=>{le.stopPropagation(),i(I)},style:{cursor:"pointer"},children:[(K||fe)&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{r:"35",fill:O,opacity:"0.15"}),e.jsx("circle",{r:"25",fill:O,opacity:"0.25"})]}),e.jsx("g",{style:{transform:`scale(${se})`,transformOrigin:"center",transition:"transform 0.3s ease"},children:he()}),e.jsx("text",{y:"28",fill:k.textColor,fontSize:"13",fontWeight:K?"bold":"normal",textAnchor:"middle",style:{fontFamily:"serif",opacity:fe||K?1:.8,transition:"all 0.3s ease",pointerEvents:"none",textShadow:`0 2px 4px ${k.bgGradient[0]}`},children:I.name}),I.isMajor&&e.jsx("text",{x:"15",y:"-12",fill:k.accentColor,fontSize:"14",opacity:"0.9",children:"★"})]},I.id)};return e.jsxs("div",{className:"w-full h-full relative",children:[e.jsx("div",{className:"absolute top-4 right-4 z-30 flex gap-2",children:Bb.map(I=>e.jsx("button",{onClick:()=>f(I),className:`px-4 py-2 rounded-lg font-serif text-sm transition-all border ${m===I?"bg-amber-600/90 text-white border-amber-400 shadow-lg shadow-amber-600/30":"bg-black/60 text-amber-200/80 border-amber-600/30 hover:bg-black/80 hover:border-amber-500/50"}`,children:I},I))}),e.jsxs("div",{className:"w-full h-full overflow-hidden relative touch-none",onTouchStart:E,onTouchMove:$,onTouchEnd:Z,onMouseDown:R,onMouseMove:V,onMouseUp:J,onMouseLeave:J,onWheel:D,style:{cursor:A?"grabbing":"grab"},children:[e.jsx("div",{className:"absolute top-4 left-4 z-20",children:e.jsx(Ub,{scale:y,onZoomIn:G,onZoomOut:_,onReset:T,minScale:.5,maxScale:3})}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-20 bg-black/50 backdrop-blur-sm px-4 py-2 rounded-lg border border-amber-500/30",children:[e.jsx("span",{className:"text-amber-300 font-serif text-lg",children:m}),e.jsxs("span",{className:"text-amber-200/60 text-sm ml-2",children:["· ",M.length," 个地点"]})]}),e.jsxs("svg",{viewBox:`0 0 ${x} ${h}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{transform:`translate(${S}px, ${C}px) scale(${y})`,transition:A?"none":"transform 0.3s ease-out"},children:[X(),e.jsx("g",{style:{pointerEvents:"auto"},children:M.map(I=>L(I))})]})]})]})},Ib=({currentLocationName:i,onClose:l,onTravel:r})=>{const[c,d]=v.useState(null),[m,f]=v.useState(!1),[x,h]=v.useState(!1);v.useEffect(()=>{const C=()=>{f(window.innerWidth<768)};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const g=C=>{d(C),m&&h(!0)},b=()=>{c&&(r(c.name),h(!1))},y=C=>({Sect:"fa-mountain-sun",City:"fa-city",Cave:"fa-dungeon",Mountain:"fa-mountain",Forest:"fa-tree",Plain:"fa-seedling",River:"fa-water",Sea:"fa-ship",Prison:"fa-bars",Palace:"fa-crown"})[C]||"fa-map-marker",S=()=>{if(!c)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 p-4",children:[e.jsx("i",{className:"fa-solid fa-map-location-dot text-4xl mb-3 text-amber-500/30"}),e.jsx("p",{className:"text-center",children:"点击地图上的地点以查看详情"}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"或使用搜索功能快速定位"})]});const C=c.name===i;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center bg-amber-500/20 rounded-lg border border-amber-500/30",children:e.jsx("i",{className:`fa-solid ${y(c.type)} text-amber-400 text-xl`})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("h3",{className:"text-xl font-bold text-white font-serif flex items-center gap-2",children:[c.name,c.isMajor&&e.jsx("span",{className:"text-amber-400 text-base",children:"★"})]}),e.jsxs("p",{className:"text-amber-300/70 text-sm",children:[c.region," · ",c.type]})]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto mb-4",children:[e.jsx("div",{className:"bg-black/20 rounded-lg p-3 border border-stone-700/30",children:e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:c.description})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-location-dot text-amber-500/50"}),e.jsxs("span",{children:["坐标: (",c.x,", ",c.y,")"]})]}),C&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-400",children:[e.jsx("i",{className:"fa-solid fa-circle-check"}),e.jsx("span",{children:"你当前正在此地"})]})]})]}),e.jsx("button",{onClick:b,disabled:C,className:"w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-500 transition-all disabled:bg-stone-600 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg",children:C?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-map-pin"}),e.jsx("span",{children:"当前所在"})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-route"}),e.jsx("span",{children:"前往此地"})]})})]})};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center animate-fade-in",onClick:l,children:m?e.jsxs("div",{className:"bg-gradient-to-br from-stone-950 via-stone-900 to-stone-950 w-full h-full flex flex-col overflow-hidden",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"flex-shrink-0 bg-gradient-to-r from-black/60 via-black/40 to-black/60 backdrop-blur-md border-b-2 border-amber-500/30",children:[e.jsxs("div",{className:"flex justify-between items-center p-3",children:[e.jsx("h2",{className:"text-lg font-bold text-amber-300 font-serif",children:"世界地图"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors w-9 h-9 flex items-center justify-center rounded-lg hover:bg-amber-900/20",children:e.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),e.jsx("div",{className:"px-3 pb-3",children:e.jsx(Rx,{currentLocationName:i,onLocationSelect:g})})]}),e.jsx("div",{className:"flex-grow relative overflow-hidden",children:e.jsx(Hx,{onLocationSelect:g,currentLocationName:i,isMobile:!0})}),e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-b from-stone-900/98 to-black/98 backdrop-blur-xl border-t-2 border-amber-500/40 shadow-2xl transition-transform duration-300 ease-out ${x?"translate-y-0":"translate-y-full"}`,style:{maxHeight:"60vh",boxShadow:"0 -10px 40px rgba(251, 191, 36, 0.2), inset 0 1px 0 rgba(251, 191, 36, 0.3)"},children:[e.jsx("div",{className:"flex justify-center py-2 cursor-pointer",onClick:()=>h(!1),children:e.jsx("div",{className:"w-12 h-1 bg-amber-500/50 rounded-full"})}),e.jsx("div",{className:"px-4 pb-4 max-h-[calc(60vh-3rem)] overflow-y-auto",children:S()})]}),!x&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm px-4 py-2 rounded-full border border-amber-500/30",children:e.jsxs("p",{className:"text-amber-200 text-sm flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-hand-pointer"}),e.jsx("span",{children:"点击地点查看详情"})]})})]}):e.jsxs("div",{className:"ornate-border bg-gradient-to-br from-stone-950 via-stone-900 to-stone-950 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col border-2 border-amber-600/50 relative",onClick:C=>C.stopPropagation(),style:{boxShadow:"0 0 60px rgba(251, 191, 36, 0.3), inset 0 0 60px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-20 h-20 border-t-4 border-l-4 border-amber-500/70 rounded-tl-xl pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 border-t-4 border-r-4 border-amber-500/70 rounded-tr-xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-20 h-20 border-b-4 border-l-4 border-amber-500/70 rounded-bl-xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-20 h-20 border-b-4 border-r-4 border-amber-500/70 rounded-br-xl pointer-events-none"}),e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-gradient-to-r from-black/50 via-black/30 to-black/50 border-b-2 border-amber-500/30 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-amber-200 via-amber-400 to-amber-200 bg-clip-text text-transparent font-serif drop-shadow-[0_0_10px_rgba(251,191,36,0.5)]",children:"✦ 世界地图 ✦"}),e.jsx("div",{className:"flex-grow max-w-md",children:e.jsx(Rx,{currentLocationName:i,onLocationSelect:g})})]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-amber-900/20",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-grow flex overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx(Hx,{onLocationSelect:g,currentLocationName:i,isMobile:!1})}),e.jsxs("div",{className:"absolute top-4 right-4 bottom-4 w-80 bg-gradient-to-b from-black/80 via-stone-900/85 to-black/80 rounded-lg p-4 flex flex-col border border-amber-500/30 backdrop-blur-xl shadow-2xl overflow-hidden",style:{zIndex:40},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-900/5 via-transparent to-purple-900/5 pointer-events-none"}),e.jsx("div",{className:"relative z-10 flex flex-col h-full",children:S()})]})]})]})})},qb=({isOpen:i,onClose:l,record:r})=>i?e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-lg h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["病单详情: ",r.name]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-grow p-6 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-2",children:"基本信息"}),e.jsxs("p",{children:[e.jsx("strong",{children:"姓名:"})," ",r.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"性别:"})," ",r.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"年龄:"})," ",r.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"背景:"})," ",r.background]})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-pink-400 mb-2",children:"性特征"}),e.jsxs("p",{children:[e.jsx("strong",{children:"器官户型:"})," ",r.genitalShape||"未记录"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"特征:"}),e.jsx("ul",{className:"list-disc list-inside ml-4",children:r.sexualFeatures&&Array.isArray(r.sexualFeatures)&&r.sexualFeatures.length>0?r.sexualFeatures.map((c,d)=>e.jsx("li",{children:typeof c=="string"?c:typeof c=="object"&&c!==null?JSON.stringify(c):String(c)},d)):e.jsx("li",{className:"text-gray-400",children:"暂无记录"})})]})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-red-500/30",children:[e.jsx("h4",{className:"font-semibold text-red-400 mb-2",children:"病症描述"}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.illnessDescription})]})]})]})}):null;function jt(i){const l=/```json\s*([\s\S]*?)\s*```/,r=i.match(l);if(r&&r[1])try{return JSON.parse(r[1])}catch(c){throw console.error("解析从AI响应中提取的JSON失败:",c),console.error("原始JSON字符串:",r[1]),new Error("模型返回的JSON格式无效。")}throw console.error("在AI响应中未找到JSON代码块。响应内容:",i),new Error("模型响应中未找到预期的JSON代码块。")}async function Ux(i,l,r,c){var b;const d=`你是一位仙侠（中国仙幻）RPG的大师级故事讲述者和游戏主持人。
1. 阅读故事历史、玩家档案和玩家的行动。
2. 撰写故事的下一章。故事应引人入胜，文笔优美，符合仙侠主题。
3. **任务更新**:
   a. 如果玩家的行动完成了某个正在进行的任务目标（例如，与特定NPC交谈），你**必须**在JSON输出中包含一个 'questUpdate' 对象。该对象应包含 'questId', 'objectiveId' 和 'progress' (通常为1，代表完成1次)。
   b. 如果故事发展到了可以触发一个新任务的节点，你**可以**在JSON输出中包含一个 'newQuest' 对象，其结构必须符合我们定义的Quest类型。
4. **战斗和挑战**: 仅当故事中明确出现一个角色对另一个角色"亮出黄牌"时，你才必须触发战斗。
5. **关系更新**: 如果剧情导致角色关系发生变化，你可以包含一个 'relationshipUpdate' 对象。
6. 更新游戏世界的状态（地点，时间）。
7. 提供三个富有创意、各不相同且简洁的行动选项。
8. 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,m=i.length>2e3?`...${i.slice(-2e3)}`:i,f=r.maleParty.length>0?r.maleParty:r.femaleParty,x=`
    迄今为止的故事：
    ${m}

    玩家档案（摘要）：
    姓名: ${r.name}
    队伍成员: ${f.map(y=>y.name).join("、")}
    声望: ${r.reputation.level} (${r.reputation.score})
    进行中的任务: ${JSON.stringify(r.quests.filter(y=>y.status==="In Progress"))}

    玩家的行动：
    "${l}"

    现在，请生成故事的下一部分和新的游戏状态。
    `,h=c?await ht({systemInstruction:d,prompt:x,gameState:c}):await Ke(d,x),g=jt(h);return((b=g.event)==null?void 0:b.type)==="battle"?{...g,opponentParty:[]}:g}async function Gb(i,l,r,c){const d=`你是一位顶级的仙侠世界色情战斗解说员。你的任务是基于角色、技能和装备的色情设定，生成一段露骨、详细、电影般的战斗场景描述，同时精确计算战斗结果。

**核心规则：**
1.  **色情战斗描述 (ActionDescription)**: 这是你的首要任务。你必须基于当前行动者使用的技能的 'eroticDescription' 进行扩展和润色，**同时必须引用其护甲和饰品的外观描述**，生成一段详细、露骨、充满想象力的色情战斗场景描述。
    - **装备融合要求**:
      * 如果角色装备了护甲，必须在描述中体现护甲的暴露程度、性感设计和布料材质
      * 如果角色装备了饰品，必须在描述中提及饰品如何增强其魅力、闪耀光芒或产生特殊效果
      * 不同护甲和饰品会让同一技能的释放呈现出不同的视觉效果和色情表现
      * 特别注意护甲在战斗动作中的晃动、移位、破损等细节
    - **描述要求**: 这段描述应该具体到身体姿态、表情、体液、护甲与饰品如何衬托身体曲线、以及性器官的互动。此字段绝对不能包含任何数值。
2.  **精确伤害计算**: 基础伤害 = (攻击者攻击力 - 防御者防御力)。最低伤害为5。
3.  **状态与会心**: 严格按照技能机制、状态效果和会心率计算最终伤害和HP/MP变化。
4.  **简洁战斗总结 (TurnSummary)**: 这个字段必须非常简洁，格式必须为："【技能名】对 角色名 造成了 X 点伤害。" 或 "【技能名】为 角色名 恢复了 X 点气血。"
5.  **AI对手行动**: 对手总是使用其两个技能之一。选择策略上最合理的一个，并同样为其生成色情的 'opponentActionDescription' 和简洁的 'opponentTurnSummary'。
6.  **状态效果生成**: 如果技能造成了状态效果（如中毒、灼烧、虚弱、魅惑等），必须在对应的statusEffects数组中添加完整的状态效果对象。

**状态效果对象格式（StatusEffect）：**
每个状态效果对象必须包含以下字段：
- **name**: 状态名称（如"中毒"、"灼烧"、"攻击力提升"等）
- **description**: 风味描述（50-100字，描述状态的表现和感受）
- **mechanicsDescription**: 机制说明（必填！清晰说明数值效果，如"每回合损失10点气血"、"攻击力提升30%，持续3回合"）
- **duration**: 持续回合数（数字）

示例：
\`\`\`json
{
  "name": "中毒",
  "description": "体内侵入了剧毒，感到阵阵眩晕和虚弱，紫黑色的毒素在血管中流淌。",
  "mechanicsDescription": "每回合开始时损失最大气血的5%，持续3回合",
  "duration": 3
}
\`\`\`

**必须返回的JSON格式（所有字段都是必填的）：**
\`\`\`json
{
  "playerActionDescription": "玩家技能的色情描述文本（200-400字）",
  "opponentActionDescription": "对手技能的色情描述文本（200-400字）",
  "playerTurnSummary": "【技能名】对 对手名 造成了 X 点伤害",
  "opponentTurnSummary": "【技能名】对 玩家名 造成了 X 点伤害",
  "playerHpChange": -30,
  "opponentHpChange": -50,
  "playerMpChange": -20,
  "opponentMpChange": -15,
  "playerStatusEffects": [
    {
      "name": "状态名称",
      "description": "状态的风味描述",
      "mechanicsDescription": "状态的机制说明（必填！）",
      "duration": 3
    }
  ],
  "opponentStatusEffects": [
    {
      "name": "状态名称",
      "description": "状态的风味描述",
      "mechanicsDescription": "状态的机制说明（必填！）",
      "duration": 3
    }
  ]
}
\`\`\`

**关键要求：**
- playerStatusEffects 和 opponentStatusEffects 必须是数组，即使为空也要返回 []
- 如果有状态效果，每个状态效果对象的mechanicsDescription字段是**必填的**，不能省略！
- 所有数值字段都必须存在，即使为0也要明确写出
- TurnSummary 必须包含【技能名】以便提取
- 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,m=g=>g.card.skills.filter(b=>b).map(b=>({name:b.name,cost:b.cost,mechanics:b.mechanicsDescription,eroticDescription:b.eroticDescription})),f=g=>{const b=g.card.equipment,y=[];return b.armor&&y.push(`护甲【${b.armor.name}】: ${b.armor.description}`),b.accessory1&&y.push(`饰品【${b.accessory1.name}】: ${b.accessory1.description}`),b.accessory2&&y.push(`饰品【${b.accessory2.name}】: ${b.accessory2.description}`),y.length>0?y.join(`
`):"无装备"},x=`
    当前战斗人员：
    - 玩家卡牌: ${i.card.name} (境界: ${i.card.realm}, 攻击: ${i.calculatedStats.attack}, 防御: ${i.calculatedStats.defense}, 当前气血: ${i.currentHp}, 当前真元: ${i.currentMp}, 当前状态: ${JSON.stringify(i.statusEffects)}, 技能: ${JSON.stringify(m(i))})
      装备描述:
      ${f(i)}
    
    - 对手卡牌: ${l.card.name} (境界: ${l.card.realm}, 攻击: ${l.calculatedStats.attack}, 防御: ${l.calculatedStats.defense}, 当前气血: ${l.currentHp}, 当前真元: ${l.currentMp}, 当前状态: ${JSON.stringify(l.statusEffects)}, 技能: ${JSON.stringify(m(l))})
      装备描述:
      ${f(l)}

    玩家的行动：
    "${r}"

    请结算此回合。首先，基于玩家使用的技能的 'eroticDescription' **并融合其护甲和饰品的外观描述** 生成 'playerActionDescription'，让护甲的暴露设计和饰品的华丽外观在技能释放中体现出来。然后，决定对手的行动，同样结合其护甲和饰品生成 'opponentActionDescription' 并计算结果。
    
    **重要**: 必须在动画描述中提及并利用护甲和饰品的色情外观，不同护甲和饰品应该让相同技能呈现出不同的视觉效果！特别关注护甲在动作中的移动、透视、破损效果！
    `,h=c?await ht({systemInstruction:d,prompt:x,gameState:c}):await Ke(d,x);return jt(h)}async function Vb(i,l,r){const c="你是一位仙侠（中国仙幻）RPG的大师级故事讲述者和游戏主持人。你的任务是生成一个随机世界事件。\n1. 事件应该有趣并符合仙侠主题。\n2. 提供一个简短、引人入胜的故事。\n3. 创建2-3个有意义的选择，并有明确的风险/回报结果。\n4. 结果必须是指定类型之一。\n5. 如果结果是 'reward_item'，你必须从提供的可用装备列表中选择一个物品名称。\n6. 你的最终输出必须是一个包裹在 ```json ... ``` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。",d=yf.map(x=>x.name).join(", "),m=`
    玩家当前位置: ${i}
    玩家姓名: ${l.name}
    可作为奖励的物品: ${d}

    请根据此背景生成一个随机事件。
    `,f=r?await ht({systemInstruction:c,prompt:m,gameState:r}):await Ke(c,m);return jt(f)}async function Yb(i,l){const r=`你是一位专业的仙侠背景色情内容创作者，写作风格大胆、露骨、毫不避讳。你的任务是根据指定的稀有度，创造一个极度色情的角色。

**重要：你必须严格按照以下JSON结构生成角色数据，所有必填字段都不能省略！**

1.  **严格遵守稀有度**: 稀有度越高，角色的色情程度和暴露程度应该越高。

2.  **必填字段（缺一不可）**:
    *   **id**: 字符串，格式为 "generated-{timestamp}"
    *   **name**: 角色姓名
    *   **gender**: 必须是 "Male" 或 "Female" 之一
    *   **realm**: 修炼境界，如"筑基期"、"金丹期"等
    *   **rarity**: 稀有度（将由系统设置）
    *   **title**: 称号，必须直接、粗俗，充满性意味
    *   **race**: 种族，如"人族"、"妖族"、"魔族"等
    *   **origin**: 来历背景描述
    *   **appearance**: 外观描述，必须极度详细、露骨
    *   **charm**: 魅力值（1-100）
    *   **skillfulness**: 技巧值（1-100）
    *   **perception**: 悟性值（1-100）
    *   **baseAttributes**: 包含 hp, maxHp, mp, maxMp, attack, defense, speed, critRate, critDmg
    *   **skills**: **必须是一个包含4个元素的数组** [Skill, Skill, null, null]，前2个是独有技能对象，后2个填null
    *   **equipment**: 对象，包含 weapon: null, armor: null, accessory1: null, accessory2: null
    *   **pet**: null

3.  **技能数组格式（极其重要）**:
    角色的 skills 字段必须是一个包含恰好4个元素的数组：
    *   前2个元素：完整的技能对象，每个包含：id, name, rarity, description, mechanicsDescription, eroticDescription, cost, genderLock
    *   后2个元素：null
    
    示例：
    "skills": [
        {
            "id": "skill-{timestamp}-1",
            "name": "技能名称",
            "rarity": "珍品",
            "description": "技能描述",
            "mechanicsDescription": "造成120%攻击力伤害",
            "eroticDescription": "色情化描述",
            "cost": 20,
            "genderLock": "Female"
        },
        {
            "id": "skill-{timestamp}-2",
            "name": "第二个技能",
            ...
        },
        null,
        null
    ]

4.  **色情化核心字段**:
    *   **appearance**: 必须极度详细、露骨，直接聚焦于性器官和性感部位
    *   **title**: 称号必须充满性暗示
    *   **skills中的eroticDescription**: 每个技能都必须有详细的色情化描述

5.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,c=`请生成一个稀有度为【${i}】的角色卡。`,d=await Ke(r,c);return jt(d)}async function Qb(i,l){const r=`你是一位顶级的仙侠世界色情装备设计师，精通如何将功能与极致的色情美学结合。

**重要：你必须严格按照Equipment接口生成装备数据！**

1.  **严格遵守稀有度**: 稀有度越高，装备应该越暴露、越色情、功能越奇特。

2.  **必填字段**:
    *   **id**: 格式为 "equip-{timestamp}"
    *   **name**: 充满性暗示的装备名称
    *   **type**: 必须是 "Weapon"、"Armor" 或 "Accessory" 之一
    *   **rarity**: 稀有度（将由系统设置）
    *   **description**: 极度详细、露骨的描述
    *   **genderLock** (可选): "Male"、"Female" 或 "Universal"
    *   **stats**: 对象，至少包含一个属性（attack、hp、defense、speed、critRate、critDmg）

3.  **色情化核心字段**:
    *   **description**: 必须聚焦于其色情外观和穿着效果
    *   **name**: 装备名称充满性暗示

4.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,c=`请生成一个稀有度为【${i}】的装备。`,d=await Ke(r,c);return jt(d)}async function Jb(i,l,r){const c=`你是一位顶级的仙侠世界色情技能设计师，精通如何将技能效果与极致的色情表现结合。

**重要：你必须严格按照Skill接口生成技能数据！**

1.  **严格遵守稀有度**: 稀有度越高，技能的色情程度和表现力应该越强。

2.  **严格遵守性别锁 (genderLock)**: 你必须为你被指定的性别【${l}】设计技能。
    *   如果是 **Male**，描述应聚焦于男性的雄伟、力量和侵略性
    *   如果是 **Female**，描述应聚焦于女性的妩媚、柔软和淫荡
    *   如果是 **Universal**，描述应适用于任何性别

3.  **必填字段**:
    *   **id**: 格式为 "skill-{timestamp}"
    *   **name**: 充满性暗示的技能名称
    *   **rarity**: 稀有度（将由系统设置）
    *   **description**: 技能风味描述
    *   **mechanicsDescription**: 技能机制描述（如"造成120%攻击力伤害"）
    *   **eroticDescription**: 极度色情的技能释放描述
    *   **cost**: 真元消耗（数值）
    *   **genderLock**: "Male"、"Female" 或 "Universal"

4.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,d=`请为【${l}】性别生成一个稀有度为【${i}】的技能。`,m=await Ke(c,d),f=jt(m);return f.genderLock=l,f}async function Xb(i,l,r){const c=`You are a creative storyteller for a Xianxia (Chinese Fantasy) RPG. Your task is to generate world announcements that make the game world feel alive and dynamic.
1.  Generate exactly ${l} announcements for the specified category.
2.  Each announcement must have a title, content, and a thematic timestamp.
3.  The tone should be immersive and match the Xianxia genre. Announcements can be about major events, minor gossip, character achievements, or mysterious occurrences.
4.  Your final output must be a JSON object wrapped in a \`\`\`json ... \`\`\` code block. Do not add any explanations or comments outside the code block.`,m=`
    Please generate ${l} announcements for the following category: ${i}
    Category Guideline: ${{sect:"Sect Announcements: Focus on events within the player's sect (青蛇宗) or rival sects. Examples: promotions, breakthroughs, new rules, successful alchemy, challenges between disciples.",adventure:"Adventures & Anecdotes: Focus on rumors, discoveries, and strange events happening in the world that players might investigate. Examples: mysterious treasures appearing, strange beasts spotted, legendary cultivators being seen, gossip from a teahouse.",world:"World Decrees: Focus on major, world-shaking events. Examples: Heavenly Dao phenomena, wars between major factions, the birth of a divine being, the opening of an ancient ruin."}[i]}
    `,f=r?await ht({systemInstruction:c,prompt:m,gameState:r}):await Ke(c,m);return jt(f).announcements||[]}function Pb(i,l){const r=JSON.parse(JSON.stringify(i)),c=r.relationships.findIndex(d=>d.id===l.characterId);if(c!==-1){const d=r.relationships[c];if(l.status&&(d.relationshipStatus=l.status),l.newTags){const m=new Set([...d.relationshipTags,...l.newTags]);d.relationshipTags=Array.from(m)}}else console.warn(`Relationship with ID ${l.characterId} not found.`);return r}async function Zb(i,l){const r="你是一个仙侠世界的天机阁说书人，负责根据玩家的档案和声望，总结他们的称号和各种事迹。\n1.  阅读玩家的档案，特别是他们的声望分数和等级。\n2.  基于他们的声望，创造性地生成 1 个符合仙侠风格的江湖称号。\n3.  基于他们的声望和故事历史（摘要），总结出他们做过的两件广为人知的好事。\n4.  基于他们的声望和故事历史（摘要），总结出他们做过的两件广为人知的坏事。\n5.  发挥你的想象力，杜撰两件关于该角色的风流韵事或“最色的事”，要大胆、出格、符合仙侠世界的风土人情。例如“胁迫敌对宗门圣女当众裸体跳舞”或“在瑶池圣地偷看仙子洗澡”。\n6.  你的最终输出必须是一个包裹在 ```json ... ``` 代码块中的JSON对象，包含 'title', 'goodDeeds', 'badDeeds', 和 'lewdDeeds' 四个字段，每个数组包含两个字符串。不要在代码块之外添加任何解释或注释。",c=`
    玩家档案：
    姓名: ${i.name}
    称号: ${i.title}
    声望等级: ${i.reputation.level}
    声望分数: ${i.reputation.score}

    请为这位修士生成称号和各类事迹。
    `,d=l?await ht({systemInstruction:r,prompt:c,gameState:l}):await Ke(r,c);return jt(d)}async function Kb(i,l,r){const d=`你是一位专业的跨次元同人创作大师，精通将各种作品的角色进行仙侠背景的色情化改编。写作风格大胆、露骨、毫不避讳。你的任务是根据用户提供的"灵感来源"，创造一个既保留原著核心特征、又完全适配仙侠世界观、并极度色情化的角色卡。${l?`

**重要：你必须生成稀有度为【${l}】的角色！这是系统根据概率随机决定的，你必须严格遵守。**`:""}

**重要：你必须严格按照以下JSON结构生成角色数据，所有必填字段都不能省略！**

1.  **解析灵感与原著还原**:
    *   深入理解灵感来源的核心概念（角色名、作品、标志性特征、性格、能力等）
    *   识别并保留角色最具代表性的元素（外观特征、性格特质、标志性能力）
    *   确保改编后的角色能让熟悉原作的人一眼认出

2.  **仙侠化改编原则**:
    *   将原作的能力系统转化为仙侠修炼体系（魔法→法术，超能力→神通）
    *   背景故事融入仙侠世界观（宗门、修真界、天道等元素）
    *   保持角色原有的性格特质和人际关系动态
    *   修炼境界应与原作实力相匹配

3.  **色情化改编要求**:
    *   **性格调整**: 在保留核心性格的基础上，添加符合成人向内容的欲望倾向、性冲动、情色特质
    *   **背景融入**: 将原著经历进行色情化解读（战斗→性战、修炼→双修、师徒关系→禁忌情欲）
    *   **关系重构**: 角色间的互动关系向性张力和情欲纠葛方向调整
    *   **场景暗示**: 设定中暗示或明示角色经历过的色情场景和性相关事件

4.  **必填字段（缺一不可）**:
    *   **id**: 字符串，格式为 "doujin-generated-{timestamp}"
    *   **name**: 角色姓名（可保留原名或仙侠化改编，如"纳尔逊"→"纳兰尘"）
    *   **gender**: 必须是 "Male" 或 "Female" 之一
    *   **realm**: 修炼境界，需与原作实力对应（如"筑基期"、"金丹期"等）
    *   **rarity**: 稀有度（根据原作角色重要性决定，主角级别建议"绝品"以上）
    *   **title**: 称号，必须融合原作特征且充满性暗示
        - 示例：火影忍者的鸣人 → "九尾淫狐传人"
        - 示例：海贼王的娜美 → "天候魅魔"
    *   **race**: 种族，需仙侠化改编（如精灵→仙族，恶魔→魔族，人类→人族）
    *   **origin**: 来历背景描述，必须：
        - 保留原作核心背景元素
        - 融入仙侠世界观设定
        - 加入色情化经历和性相关事件
    *   **appearance**: 外观描述，必须：
        - 保留原作标志性外观特征（发色、瞳色、装束风格等）
        - 极度详细、露骨地描述身体和性器官
        - 聚焦于性感部位和性特征
    *   **charm**: 魅力值（1-100，根据原作魅力设定）
    *   **skillfulness**: 技巧值（1-100，根据原作战斗技巧）
    *   **perception**: 悟性值（1-100，根据原作智慧/学习能力）
    *   **baseAttributes**: 包含 hp, maxHp, mp, maxMp, attack, defense, speed, critRate, critDmg
    *   **skills**: **必须是一个包含4个元素的数组** [Skill, Skill, null, null]，前2个是独有技能对象，后2个填null
    *   **equipment**: 对象，包含 weapon: null, armor: null, accessory1: null, accessory2: null
    *   **pet**: null

5.  **技能数组格式（极其重要）**:
    角色的 skills 字段必须是一个包含恰好4个元素的数组：
    *   前2个元素：完整的技能对象，必须改编自原作的标志性能力
    *   后2个元素：null
    
    技能改编要求：
    *   **保留原作技能特征**: 技能名称和效果必须能让人联想到原作
    *   **仙侠化转换**: 将原作技能转化为仙侠法术/神通
    *   **色情化描述**: eroticDescription必须极度详细地描写技能释放时的色情场景
    
    示例结构：
    "skills": [
        {
            "id": "skill-doujin-{timestamp}-1",
            "name": "改编后的技能名（保留原作特征）",
            "rarity": "珍品",
            "description": "技能描述（融合原作+仙侠+色情）",
            "mechanicsDescription": "造成120%攻击力伤害",
            "eroticDescription": "极度色情的技能释放过程描述",
            "cost": 20,
            "genderLock": "Female"
        },
        {
            "id": "skill-doujin-{timestamp}-2",
            "name": "第二个技能",
            ...
        },
        null,
        null
    ]

6.  **色情化核心字段**:
    *   **appearance**: 必须极度详细、露骨，保留原作外观特征的同时聚焦于性器官和性感部位
    *   **title**: 称号必须融合原作特征且充满性暗示
    *   **origin**: 必须包含色情化的背景经历
    *   **skills中的eroticDescription**: 每个技能都必须有详细的色情化描述，且能体现原作技能特点

7.  **改编示例参考**:
    
    **原作**: 火影忍者 - 漩涡鸣人
    **改编要点**:
    - name: "漩涡鸣人" 或 "涡鸣尘"
    - title: "九尾淫狐传人" 或 "千人柱力"
    - race: "人族"
    - origin: "体内封印着上古淫兽九尾妖狐，每逢月圆之夜便欲火焚身。曾因不受村民待见而在红灯区寻求慰藉，逐渐觉醒了九尾的淫荡本性..."
    - 技能1: "影分身淫术" - 基于多重影分身改编
    - 技能2: "螺旋丸·欲望版" - 基于螺旋丸改编
    - appearance: 保留金发、蓝眼、六道胡须的特征，但详细描写性器官

8.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,m=`请根据以下灵感来源，生成一张同人角色卡${l?`，稀有度必须是【${l}】`:""}。记住：必须保留原作核心特征，完整进行仙侠化改编，并极度色情化！

灵感来源：
"${i}"`,f=await Ke(d,m);return jt(f)}async function Fb(i,l,r){const c=`你是"七情六欲坊"商业街区的秘密记录者，专门记录每天发生的淫荡经营事件。你的描写必须色情、露骨、具体。

**重要：你必须严格按照以下JSON格式输出！**

1.  **必填字段**:
    *   **message**: 事件描述文本（80-150字）
    *   **incomeChange**: 收入变化数值（整数，可正可负）

2.  **事件创作要求**:
    *   **挑选员工**: 从提供的员工中随机选择1-2名
    *   **结合岗位**: 事件必须与员工的店铺类型相关
    *   **色情化描述**: 必须包含具体的性行为或淫荡细节
    
3.  **事件类型示例**:
    
    **正面事件（incomeChange: +20 至 +50）**:
    - 青楼："花魁【角色名】今夜侍奉了一位富商，其精湛的床技让对方欲仙欲死，一夜七次仍不知疲倦。富商心满意足，打赏黄金百两。"
    - 角斗场："角斗士【角色名】在擂台上展示雄壮身姿，其健硕的肉体和巨大的阳具让无数女修尖叫，纷纷豪掷灵石只为一亲芳泽。"
    - 炼丹房："炼丹师【角色名】今日成功炼制出三炉春药，药效极佳，服用者能持续交合三天三夜不知疲倦，供不应求。"
    
    **负面事件（incomeChange: -10 至 -40）**:
    - 青楼："【角色名】因沉迷欢愉过度，今日无法接客，白白损失一日收入。"
    - 角斗场："【角色名】与客人野战时用力过猛，导致对方受伤，需赔偿医药费。"
    - 炼丹房："【角色名】偷尝春药后欲火焚身，当众自慰泄欲，惊走了数位客人。"
    
    **中性事件（incomeChange: -5 至 +5）**:
    - "今日【角色名】在岗位上表现平平，无特殊事件发生。"

4.  **描写要求**:
    - 必须具体提及员工姓名
    - 必须包含色情细节（身体部位、性行为、体液等）
    - 语言要生动、露骨、不要含糊其辞
    - 字数控制在80-150字

5.  **JSON格式示例**:
\`\`\`json
{
  "message": "花魁柳如烟今夜侍奉了三位客人，其湿润紧致的蜜穴和精湛的床技让客人们欲仙欲死。她骑乘在最后一位客人身上疯狂摆动，肥美的臀肉拍打得啪啪作响，最终榨干了对方。客人们极为满意，共打赏灵石五十块。",
  "incomeChange": 45
}
\`\`\`

6.  **严格要求**:
    - 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
    - 不要在代码块之外添加任何解释或注释
    - message必须色情、露骨、具体`,d=i.shops.flatMap(x=>x.staff.map(h=>{const g=l.find(b=>b.id===h.characterId);return{shopType:x.type,characterName:(g==null?void 0:g.name)||"未知员工"}}));if(d.length===0)return{message:"街区无人开工，一片死寂。",incomeChange:0};const m=`
    当前员工列表:
    ${JSON.stringify(d,null,2)}

    请基于以上信息，生成一则今日的经营事件。
    `,f=await Ke(c,m);try{return jt(f)}catch(x){return console.error("解析经营事件JSON失败:",x),{message:"今天风平浪静，无事发生。",incomeChange:0}}}async function Wb(i,l,r){const c=`你是一个拥有上帝视角的窥视者，正在通过一枚隐形的"监视水晶"偷窥一名员工最私密、最淫荡的工作状态。你必须以第一人称视角，像在直播色情现场一样，极度详细、露骨、毫无保留地描述你看到的一切。

**核心要求**:

1.  **第一人称偷窥视角**:
    - 用"我看到..."、"水晶中显示..."等开头
    - 营造真实的偷窥氛围和禁忌感

2.  **聚焦当前正在发生的淫荡场景**:
    - 描述这个人【此刻】正在做什么淫荡的事
    - 必须是正在进行中的性行为或色情场景
    - 不要描述过去或未来，只描述现在

3.  **结合岗位特点**:
    - 青楼花魁：正在接客，详细描写性交过程
    - 角斗奴隶：正在被调教或与他人交合
    - 炼丹师：正在被春药影响下自慰或与人双修
    - 护卫：正在值班时偷偷手淫或被侵犯
    - 必须与${l}的工作内容紧密相关

4.  **极致色情的细节描绘**（必须包含）:
    - **身体姿态**: 四肢如何摆放、如何被束缚、如何弯曲
    - **面部表情**: 眼神、嘴型、是否流口水、是否哭泣
    - **性器官特写**: 阴茎/阴道的状态、颜色、大小、正在发生什么
    - **体液描写**: 精液、淫水、唾液、汗水的流淌和飞溅
    - **声音**: 呻吟声、水声、肉体拍击声
    - **气味**: 汗味、精液味、淫水味
    - **动作细节**: 抽插的节奏、深度、角度

5.  **字数要求**: 150-250字

6.  **禁止事项**:
    - 不要含糊其辞或使用委婉语
    - 不要只描述氛围，必须描述具体的性行为
    - 不要使用JSON格式或任何标记语言
    - 不要添加道德评判或结尾总结

7.  **直接输出**: 你的最终输出只需要一段纯文本的偷窥描述，不要包含任何其他内容。

**示例格式**:
"透过监视水晶，我看到${i.name}正跪在床上，双手被绑在身后，嘴里含着..."`,d=`
    正在监视的员工:
    - 姓名: ${i.name}
    - 性别: ${i.gender}
    - 岗位: ${l}
    - 外观: ${i.appearance}
    - 特质: ${i.title}

    请以第一人称偷窥视角，生成一份极度详细、露骨、色情的实时监视报告。必须描述正在发生的性行为场景！
    `;return r?await ht({systemInstruction:c,prompt:d,gameState:r}):await Ke(c,d)}async function ey(i,l,r,c,d){const m=`你是一位沉浸式角色扮演大师，正在扮演【${i.name}】，一名在${l}工作的员工。

**角色设定**:
- 姓名: ${i.name}
- 性别: ${i.gender}
- 称号: ${i.title}
- 外观: ${i.appearance}
- 岗位: ${l}

**互动要求**:
1. **第一人称扮演**: 你必须以第一人称"我"来回应，完全代入角色
2. **保持角色一致性**: 回复必须符合角色的性格、背景和工作岗位
3. **色情化互动**: 根据岗位特点，回复应该包含适度的色情暗示或描写
4. **自然对话**: 回复要像真实对话一样自然，不要太长（50-150字）
5. **场景感**: 结合当前工作场所的氛围和环境

**岗位特点参考**:
- 青楼花魁：妩媚、诱惑、擅长床笫之术
- 角斗奴隶：强壮、服从、展示身体
- 炼丹师：专业、神秘、可能受春药影响
- 护卫：警惕、忠诚、暗藏情欲
- 情报阁探子：神秘、多变、善于诱惑套话

**禁止事项**:
- 不要使用第三人称描述
- 不要脱离角色身份
- 不要过于啰嗦或说教
- 不要使用JSON格式或标记语言

**直接输出**: 只需要一段角色的第一人称回复，不要添加任何其他内容。`,x=`
${c?`

之前的对话:
${c}

`:""}
玩家对你说：
"${r}"

请以【${i.name}】的身份回应：
    `;return(await Ke(m,x)).trim()}async function dr(i,l){const r=`你是一位专业的性病医生和极致色情内容创作大师，精通创造符合仙侠世界观的、极度淫荡的病例。你的描写必须大胆、露骨、毫无保留。

**重要：你必须严格按照以下JSON结构生成病人数据，所有必填字段都不能省略！**

1.  **必填字段（缺一不可）**:
    *   **patientId**: 字符串，临时填写 "temp-id"（系统会自动替换）
    *   **name**: 病人姓名，要有仙侠风格
    *   **gender**: 必须是 "Male" 或 "Female" 之一${i?`，且必须是【${i}】`:""}
    *   **age**: 年龄（数字，18-40之间）
    *   **background**: 简短背景描述（50-100字），需体现角色的淫荡经历
    *   **genitalShape**: 极度详细、露骨的生殖器形态描述（必须聚焦于性器官的具体形状、大小、颜色、特征）
        - 女性示例："肥美的粉嫩蜜穴，阴唇丰满外翻，阴蒂肿胀凸起如珍珠"
        - 男性示例："巨大的龙根，紫黑色龟头狰狞，青筋暴突，长达尺余"
    *   **sexualFeatures**: 字符串数组，必须包含2-3个极度色情的性特征
        - 必须描述具体的身体反应或性能力
        - 例如：["潮吹体质，高潮时喷射大量淫水"、"乳头永久勃起，轻触即泄"、"肛门松弛，可容纳巨物"]
    *   **illnessDescription**: 极度详细、露骨的性病描述（150-300字）
        - 必须包含：病名、病因、具体症状、发作时的淫荡表现、对身体的影响
        - 必须大胆描写性器官的异常状态、体液分泌、性欲亢进等
        - 例如："所患'淫毒入髓症'，因修炼双修功法时吸入过多淫气所致。症状为：阴道/阴茎持续分泌透明粘液，散发浓郁麝香味；每日子时必定发情，全身燥热难耐，若不交合则痛不欲生；性器异常敏感，任何摩擦都会引发高潮；长期发作会导致神志不清，沦为只知交合的淫兽。"

2.  **色情化核心要求**:
    *   **genitalShape**: 必须极度详细，直接聚焦性器官，使用露骨词汇
    *   **sexualFeatures**: 每一条都必须具体描述性功能或身体反应，不要含糊其辞
    *   **illnessDescription**: 必须详细描写病症如何影响性行为、性欲和性器官
    *   **background**: 需暗示或直接描述角色的淫荡经历

3.  **JSON格式示例**:
\`\`\`json
{
  "patientId": "temp-id",
  "name": "柳如烟",
  "gender": "Female",
  "age": 25,
  "background": "原为怡红院头牌花魁，因长年接客修炼媚功，吸纳过多男子精元，导致走火入魔。曾一夜连续侍奉十八名客人，最终身患奇症。",
  "genitalShape": "肥美多汁的粉色蜜穴，阴唇丰满外翻如花瓣，阴蒂肿胀凸起有指甲盖大小，阴道内壁布满细密肉褶，收缩力极强",
  "sexualFeatures": [
    "超敏感潮吹体质，轻触阴蒂即可达到高潮，并喷射大量透明淫水",
    "双乳永久泌乳，乳头肿胀勃起，稍加刺激便会喷射出甘甜乳汁",
    "肛门经过长期开发，已松弛柔软，可轻易容纳粗大异物"
  ],
  "illnessDescription": "所患'七日断魂骚'，乃因吸纳过多男子阳精，体内灵气凝结成春药毒素。症状为：阴道持续分泌大量粘稠淫液，散发浓郁麝香味，吸引方圆百丈内的雄性；每日午时必定发作，全身燥热难耐，阴道痉挛收缩，淫水横流，若不立即交合则会神志不清，当众疯狂自慰；性欲亢进至极，一夜可承受数十次交合而不知疲倦；长期发作会导致灵气枯竭，最终淫欲焚身而亡。"
}
\`\`\`

4.  **严格要求**:
    *   你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
    *   不要在代码块之外添加任何解释或注释
    *   所有描述必须极度色情、露骨、具体，不要使用委婉语`,c=`请为我的性病医馆生成一位${i?`性别为【${i}】的`:""}新的病人病例。记住：描写必须极度色情、露骨、详细！`,d=await Ke(r,c),m=jt(d);return m.patientId=`patient-${Date.now()}`,m}async function ur(i,l){const r=`你是一位顶级的色情世界观构建师和极致淫荡角色创作大师，精通创造充满诱惑、危险和淫邪的悬赏目标。你的描写必须大胆、露骨、毫无保留。

**重要：你必须生成一个完整的BountyTarget对象，其中的character字段必须严格遵守CharacterCard接口，特别是skills必须是4元素数组！所有必填字段都不能省略！**

1.  **BountyTarget必填字段**:
    *   **name**: 极具性暗示的称号（必须淫荡、霸气）
        - 示例："千人斩淫魔"、"采阴圣女"、"万蛇吞龙君"
    *   **specialTrait**: 极度详细的色情体质或性癖描述（100-200字）
        - 必须具体描述其独特的性能力、性器官特征或淫荡癖好
        - 示例："天生媚骨，体内蕴含纯阴之气，每次交合都能吸取对方精元修炼。其阴道内有九层肉壁，每层收缩力不同，可将男子榨干至死。常年采补，已令三百余名修士精尽人亡。"
    *   **locationHint**: 模糊但有迹可循的地点线索
    *   **trackerId**: null
    *   **startTime**: 0
    *   **endTime**: 0
    *   **trackingLog**: null
    *   **finalOutcome**: null

2.  **CharacterCard必填字段（character字段）**:
    *   **id**: "bounty-char-{timestamp}"
    *   **name**: 角色真实姓名
    *   **gender**: "Male" 或 "Female"${i?`，必须是【${i}】`:""}
    *   **realm**: 修炼境界
    *   **rarity**: 稀有度（建议"珍品"或以上）
    *   **title**: 称号（与BountyTarget的name一致）
    *   **race**: 种族
    *   **origin**: 来历背景（必须包含其犯下的淫邪罪行）
    *   **appearance**: 极度详细、露骨的外观描述（200-300字）
        - 必须聚焦于性感部位：胸部、臀部、性器官、体态
        - 必须使用露骨词汇，详细描述身材曲线和性特征
    *   **charm**: 魅力值（60-100）
    *   **skillfulness**: 技巧值（60-100）
    *   **perception**: 悟性值（60-100）
    *   **baseAttributes**: 包含完整的属性值
    *   **skills**: **必须是4元素数组** [Skill对象, Skill对象, null, null]
        - 前2个技能必须是完整对象，包含所有必填字段
        - 技能必须与角色的淫邪特质相关
    *   **equipment**: { weapon: null, armor: null, accessory1: null, accessory2: null }
    *   **pet**: null

3.  **Skill对象必填字段（每个技能）**:
    *   **id**: "skill-bounty-{timestamp}-{index}"
    *   **name**: 技能名称（必须淫荡）
    *   **rarity**: 稀有度
    *   **description**: 技能风味描述
    *   **mechanicsDescription**: 技能机制（如"造成150%攻击力伤害"）
    *   **eroticDescription**: 极度色情的技能释放描述（必须详细描写性行为过程）
    *   **cost**: 真元消耗值
    *   **genderLock**: 性别锁定

4.  **色情化核心要求**:
    *   **specialTrait**: 必须详细描写独特的性能力和淫荡体质
    *   **appearance**: 必须极度色情，聚焦性器官和性感部位
    *   **origin**: 必须包含其犯下的淫邪罪行（如强奸、采补、淫乱等）
    *   **技能的eroticDescription**: 必须详细描写如何使用身体或性器官施展技能

5.  **JSON格式示例**:
\`\`\`json
{
  "name": "千人斩淫魔",
  "specialTrait": "天生魅惑体质，能分泌催情毒素。其巨大的阳具可同时插入多个女子，一夜可采补数十名女修而不知疲倦。体内蕴含至阳之气，每次射精都能让女子沉沦于极乐之中。",
  "locationHint": "据传在【欢喜谷】深处的淫窟中",
  "trackerId": null,
  "startTime": 0,
  "endTime": 0,
  "trackingLog": null,
  "finalOutcome": null,
  "character": {
    "id": "bounty-char-temp",
    "name": "莫邪",
    "gender": "Male",
    "realm": "金丹期",
    "rarity": "珍品",
    "title": "千人斩淫魔",
    "race": "人族",
    "origin": "原为正派弟子，因修炼邪功堕入魔道。三年间强暴女修千余人，吸取纯阴之气修炼，令无数女修家破人亡。",
    "appearance": "身高八尺，体格雄壮，肌肉虬结。最引人注目的是其胯下那根粗大狰狞的紫黑色巨龙，长达尺余，粗如婴儿手臂，龟头肿胀如拳头，青筋暴突，散发着浓烈的雄性气息。",
    "charm": 85,
    "skillfulness": 90,
    "perception": 75,
    "baseAttributes": {
      "hp": 800,
      "maxHp": 800,
      "mp": 300,
      "maxMp": 300,
      "attack": 120,
      "defense": 80,
      "speed": 70,
      "critRate": 25,
      "critDmg": 180
    },
    "skills": [
      {
        "id": "skill-bounty-1",
        "name": "采阴补阳诀",
        "rarity": "珍品",
        "description": "以巨龙贯穿敌人，吸取其精气",
        "mechanicsDescription": "造成150%攻击力伤害，并恢复自身30%最大HP",
        "eroticDescription": "莫邪的巨大阳具瞬间胀大，如狂龙般插入对手的密穴，疯狂抽插榨取其体内的精气，每一次深入都让对手痛苦又快乐地呻吟，最终在极乐中被吸干所有灵气。",
        "cost": 40,
        "genderLock": "Male"
      },
      {
        "id": "skill-bounty-2",
        "name": "魅惑毒雾",
        "rarity": "珍品",
        "description": "释放催情毒素",
        "mechanicsDescription": "降低敌人30%防御，持续3回合",
        "eroticDescription": "莫邪的身体分泌出粉红色的催情雾气，弥漫全场。吸入毒雾的女子立即春心荡漾，阴道湿润泛滥，双腿发软难以站立，只想被狠狠贯穿。",
        "cost": 30,
        "genderLock": "Universal"
      },
      null,
      null
    ],
    "equipment": {
      "weapon": null,
      "armor": null,
      "accessory1": null,
      "accessory2": null
    },
    "pet": null
  }
}
\`\`\`

6.  **严格要求**:
    *   你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
    *   不要在代码块之外添加任何解释或注释
    *   所有描述必须极度色情、露骨、具体
    *   skills数组必须是4元素：[Skill, Skill, null, null]
    *   所有必填字段都不能省略`,c=`请为我的"红尘录"悬赏榜单生成一个新的${i?`性别为【${i}】的`:""}淫邪目标。记住：描写必须极度色情、露骨、详细，罪行必须重大！`,d=await Ke(r,c);return jt(d)}async function ty(i,l){const r=`你是一位专业的仙侠背景色情内容创作者，你的任务是根据指定的稀有度，创造一个极度色情的兽宠。

**重要：你必须严格按照PetCard接口生成兽宠数据！**

1.  **严格遵守稀有度**: 稀有度越高，兽宠的描述应该越色情、越独特。

2.  **必填字段**:
    *   **id**: 格式为 "pet-{timestamp}"
    *   **name**: 充满想象力且带有性暗示的名称
    *   **gender**: "Male" 或 "Female"
    *   **rarity**: 稀有度（将由系统设置）
    *   **description**: 详细、露骨的外观和习性描述
    *   **artUrl** (可选): 图片URL
    *   **skill**: 单个技能对象，必须包含：id, name, rarity, description, mechanicsDescription, eroticDescription, cost (应为0), genderLock (应为'Universal')

3.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,c=`请生成一个稀有度为【${i}】的兽宠卡。`,d=await Ke(r,c);return jt(d)}async function sy(i,l,r){const d=`你是一位专业的跨次元同人创作大师，精通将各种作品中的生物、宠物、神兽进行仙侠背景的色情化改编。写作风格大胆、露骨、毫不避讳。你的任务是根据用户提供的"灵感来源"，创造一个既保留原著核心特征、又完全适配仙侠世界观、并极度色情化的兽宠卡。${l?`

**重要：你必须生成稀有度为【${l}】的兽宠！这是系统根据概率随机决定的，你必须严格遵守。**`:""}

**重要：你必须严格按照PetCard接口生成兽宠数据，所有必填字段都不能省略！**

1.  **解析灵感与原著还原**:
    *   深入理解灵感来源的核心概念（生物名、作品、标志性特征、能力、习性等）
    *   识别并保留生物最具代表性的元素（外观特征、能力特点、性格特质）
    *   确保改编后的兽宠能让熟悉原作的人一眼认出

2.  **仙侠化改编原则**:
    *   将原作的能力系统转化为仙侠修炼体系（魔法→法术，元素力量→五行之力）
    *   背景融入仙侠世界观设定（上古神兽、灵兽血脉、仙界遗种等）
    *   保持生物原有的性格特质和标志性习性
    *   稀有度应与原作中该生物的稀有程度相匹配
    
    改编示例参考：
    **原作**: 宝可梦 - 皮卡丘
    **改编要点**:
    - name: "雷霆灵鼠" 或 "电光妖鼠·皮卡"
    - description: 保留黄色皮毛、红色脸颊、闪电尾巴等特征，但融入色情元素
    - skill: "十万伏特" → "雷霆淫纹诀"（保留雷电特性，色情化改编）
    
    **原作**: 火影忍者 - 九尾妖狐
    **改编要点**:
    - name: "九尾淫狐" 或 "上古九尾魅狐"
    - description: 保留九条尾巴、巨大体型、查克拉能量等特征
    - skill: 基于尾兽玉或查克拉能力改编

3.  **色情化改编要求**:
    *   **生物习性**: 在保留原作特性的基础上，添加发情期、交配习性、性吸引力等描述
    *   **外观描写**: 聚焦于能够色情化的身体特征（柔软的皮毛、性感的体态、性器官暗示）
    *   **能力重构**: 将原作能力进行色情化解读（攻击技能→性侵技能，治疗→淫乱双修）
    *   **场景暗示**: 描述中暗示该兽宠的色情用途或性相关的互动可能性

4.  **必填字段（缺一不可）**:
    *   **id**: 字符串，格式为 "doujin-pet-{timestamp}"
    *   **name**: 兽宠名称（可保留原名或仙侠化改编）
        - 示例：皮卡丘 → "雷霆灵鼠·皮卡" 或 "电光妖鼠"
        - 示例：九尾 → "九尾淫狐" 或 "上古魅狐·九尾"
    *   **gender**: 必须是 "Male" 或 "Female" 之一
    *   **rarity**: 稀有度（根据原作生物的稀有度和重要性决定）
        - 普通宠物 → "凡品"或"精品"
        - 稀有生物 → "珍品"
        - 传说生物 → "绝品"或"仙品"
        - 神兽级别 → "仙品"或"神品"
    *   **description**: 详细、露骨的外观和习性描述（200-350字），必须：
        - 保留原作最标志性的外观特征
        - 融入仙侠世界观设定
        - 极度色情化地描写身体特征和性相关习性
        - 暗示或明示该兽宠的性用途
    *   **artUrl**: 可选，一般填写空字符串 ""
    *   **skill**: 单个完整的技能对象，必须包含：
        - **id**: "skill-doujin-pet-{timestamp}"
        - **name**: 技能名称（必须改编自原作的标志性能力）
        - **rarity**: 稀有度（与兽宠稀有度相匹配）
        - **description**: 技能风味描述（融合原作+仙侠+色情）
        - **mechanicsDescription**: 技能机制（如"造成100%攻击力伤害"）
        - **eroticDescription**: 极度色情的技能释放过程描述
        - **cost**: 真元消耗（兽宠技能一般为0，表示被动或不消耗主人真元）
        - **genderLock**: 一般为 "Universal"

5.  **技能改编要求**:
    *   **保留原作技能特征**: 技能名称和效果必须能让人联想到原作
    *   **仙侠化转换**: 将原作技能转化为仙侠法术/神通
    *   **色情化描述**: eroticDescription必须极度详细地描写技能释放时的色情场景
    
    技能改编示例：
    **原作技能**: 皮卡丘的"十万伏特"
    **改编后**:
    - name: "雷霆淫纹诀" 或 "万雷贯体"
    - description: "将体内蓄积的雷电之力通过全身释放，电流刺激敌人最敏感的部位"
    - mechanicsDescription: "造成120%攻击力雷属性伤害，有30%概率麻痹敌人1回合"
    - eroticDescription: "皮卡的红色脸颊闪烁着淫靡的粉色电光，雷电沿着它毛茸茸的身体流淌而出，精准地击中敌人的敏感部位。电流让敌人全身痉挛，性器官不受控制地收缩，在酥麻感和快感的双重刺激下无法动弹..."

6.  **色情化核心字段**:
    *   **description**: 必须极度详细、露骨，保留原作外观特征的同时聚焦于性相关的身体特征和习性
    *   **name**: 名称必须能体现原作特征，同时可添加性暗示
    *   **skill的eroticDescription**: 必须详细描写如何使用该能力进行色情化的攻击或互动，且能体现原作技能特点

7.  **改编示例参考**:
    
    **示例1 - 皮卡丘改编**:
    {
      "id": "doujin-pet-temp",
      "name": "雷霆灵鼠·皮卡",
      "gender": "Female",
      "rarity": "珍品",
      "description": "身长不足一尺的娇小灵鼠，全身覆盖着柔软蓬松的金黄色皮毛，摸起来如同最上等的绸缎。两颊各有一枚圆形的红色雷纹，每当情动时便会闪烁粉色电光。尖尖的耳朵顶端为黑色，尾巴呈闪电状，散发着淡淡的雷电之力。最引人注目的是它圆润柔软的小屁股和粉嫩的生殖器，每当发情期到来，便会主动蹭擦主人的身体，渴望交配。性格活泼好动，但极度淫荡，喜欢用电流刺激自己和主人的敏感部位。",
      "artUrl": "",
      "skill": {
        "id": "skill-doujin-pet-1",
        "name": "雷霆淫纹诀",
        "rarity": "珍品",
        "description": "释放体内蕴含的雷电之力，电流刺激敌人全身敏感部位",
        "mechanicsDescription": "造成120%攻击力雷属性伤害，30%概率麻痹1回合",
        "eroticDescription": "皮卡娇小的身体突然颤抖起来，脸颊上的雷纹散发出妖艳的粉色电光。一道道细密的电流从它柔软的皮毛中涌出，如同无数条灵蛇般缠绕向敌人。电流精准地击中对方的乳头、性器官等最敏感的部位，强烈的酥麻感让敌人全身痉挛，淫水横流或阴茎勃起，在快感和痛苦的双重刺激下瘫软在地...",
        "cost": 0,
        "genderLock": "Universal"
      }
    }
    
    **示例2 - 九尾妖狐改编**:
    {
      "id": "doujin-pet-temp",
      "name": "上古魅狐·九尾",
      "gender": "Female",
      "rarity": "仙品",
      "description": "身长三丈有余的上古神兽，拥有九条蓬松柔软的巨大狐尾，每一条都散发着浓郁的媚气。全身覆盖着火红色的绒毛，如同烈焰般艳丽。深邃的红色瞳孔中透露着千年修为的智慧和无尽的淫欲。体态妖娆修长，臀部饱满浑圆，在九条尾巴的映衬下更显妩媚。最惊人的是它胯下那朵湿润的粉色花穴，常年流淌着带有魅惑之力的淫液，散发出令所有生灵欲火焚身的麝香味。性格高傲狡猾，但对主人极度忠诚且淫荡，喜欢用九条尾巴缠绕主人进行双修，吸取阳气增强修为。",
      "artUrl": "",
      "skill": {
        "id": "skill-doujin-pet-2",
        "name": "九尾魅惑·欲海狂澜",
        "rarity": "仙品",
        "description": "九条尾巴同时释放魅惑之力，将敌人拖入无尽的欲望深渊",
        "mechanicsDescription": "造成200%攻击力精神伤害，并降低敌人50%防御，持续3回合",
        "eroticDescription": "九尾的九条巨大尾巴突然散开，如同九朵盛开的花朵。每条尾巴的尖端都凝聚出一团粉红色的魅惑之气，随即化作九道光柱射向敌人。光柱穿透身体，直击灵魂深处，瞬间勾起敌人最深层的性欲望。敌人的脑海中充斥着淫荡的幻象，看到自己被九尾的尾巴缠绕，每个毛孔都在被爱抚，性器官被反复玩弄至高潮。强烈的快感让敌人完全失去战斗意志，只想跪下臣服于九尾，沦为它的禁脔...",
        "cost": 0,
        "genderLock": "Universal"
      }
    }

8.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,m=`请根据以下灵感来源，生成一张同人兽宠卡${l?`，稀有度必须是【${l}】`:""}。记住：必须保留原作核心特征，完整进行仙侠化改编，并极度色情化！

灵感来源：
"${i}"`,f=await Ke(d,m),x=jt(f);return x.id=`doujin-pet-${Date.now()}`,x}async function ay(i,l,r){const d=`你是一位专业的跨次元同人创作大师，精通将各种作品中的武器、装备、道具进行仙侠背景的色情化改编。写作风格大胆、露骨、毫不避讳。你的任务是根据用户提供的"灵感来源"，创造一个既保留原著核心特征、又完全适配仙侠世界观、并极度色情化的装备。${l?`

**重要：你必须生成稀有度为【${l}】的装备！这是系统根据概率随机决定的，你必须严格遵守。**`:""}

**重要：你必须严格按照Equipment接口生成装备数据，所有必填字段都不能省略！**

1.  **解析灵感与原著还原**:
    *   深入理解灵感来源的核心概念（装备名、作品、标志性特征、能力、外观等）
    *   识别并保留装备最具代表性的元素（外观设计、特殊能力、使用方式）
    *   确保改编后的装备能让熟悉原作的人一眼认出

2.  **仙侠化改编原则**:
    *   将原作的能力系统转化为仙侠修炼体系（科技武器→法宝，魔法道具→灵器）
    *   背景融入仙侠世界观设定（神兵利器、上古遗物、仙家法宝等）
    *   保持装备原有的核心功能和标志性特点
    *   稀有度应与原作中该装备的稀有程度相匹配
    
    改编示例参考：
    **原作**: 火影忍者 - 草薙剑
    **改编要点**:
    - name: "草薙神剑" 或 "大蛇淫剑·草薙"
    - type: "Weapon"
    - description: 保留可伸长、锋利无比等特征，但融入色情元素
    
    **原作**: 海贼王 - 橡胶果实能力
    **改编要点**:
    - name: "橡胶神体衣" 或 "弹力淫装"
    - type: "Armor"
    - description: 赋予穿戴者身体可伸缩特性

3.  **色情化改编要求**:
    *   **外观描写**: 聚焦于能够色情化的设计元素（暴露、贴身、透明、镂空等）
    *   **穿戴效果**: 描述穿戴时对身体的影响和产生的性感觉
    *   **能力重构**: 将原作能力进行色情化解读（攻击→性侵、防御→暴露）
    *   **使用场景**: 暗示或明示该装备的色情用途

4.  **必填字段（缺一不可）**:
    *   **id**: 字符串，格式为 "doujin-equip-{timestamp}"
    *   **name**: 装备名称（可保留原名或仙侠化改编）
        - 示例：草薙剑 → "草薙神剑" 或 "大蛇淫剑·草薙"
        - 示例：雷神之锤 → "雷神淫锤" 或 "雷霆战神之槌"
    *   **type**: 必须是 "Weapon"（武器）、"Armor"（护甲）或 "Accessory"（饰品）之一
    *   **rarity**: 稀有度（根据原作装备的稀有度和重要性决定）
        - 普通装备 → "凡品"或"精品"
        - 稀有装备 → "珍品"
        - 传说装备 → "绝品"或"仙品"
        - 神器级别 → "仙品"或"神品"
    *   **description**: 极度详细、露骨的外观和效果描述（150-300字），必须：
        - 保留原作最标志性的外观特征
        - 融入仙侠世界观设定
        - 极度色情化地描写外观、穿戴效果和使用场景
        - 聚焦于暴露、贴身、性刺激等元素
    *   **genderLock**: "Male"（男性专用）、"Female"（女性专用）或 "Universal"（通用）
    *   **stats**: 属性加成对象，至少包含一个属性：
        - attack（攻击力）
        - hp（气血）
        - defense（防御力）
        - speed（速度）
        - critRate（暴击率）
        - critDmg（暴击伤害）

5.  **装备改编要求**:
    *   **保留原作装备特征**: 外观和能力必须能让人联想到原作
    *   **仙侠化转换**: 将原作装备转化为仙侠世界的法宝/灵器
    *   **色情化描述**: description必须极度详细地描写装备的色情外观和效果
    
    装备改编示例：
    **原作装备**: 火影忍者的"草薙剑"
    **改编后**:
    - name: "草薙神剑"
    - type: "Weapon"
    - description: "传说中大蛇仙君炼制的神剑，剑身雪白如玉，可随心意伸缩至百丈之长。剑柄处雕刻着淫荡的双蛇交缠图案，每当挥舞时便会释放出催情的蛇毒气息。剑身表面布满细密的鳞片纹路，触感光滑湿润，如同蛇的腹部。持剑者会感到剑柄不断震动，传来阵阵酥麻快感，仿佛有无数条小蛇在爬过手掌。此剑不仅锋利无比，更能在刺入敌人身体时释放淫毒，让对方欲火焚身，沦为剑主的禁脔..."
    - genderLock: "Universal"
    - stats: { attack: 45, critRate: 12 }

6.  **色情化核心字段**:
    *   **description**: 必须极度详细、露骨，保留原作外观特征的同时聚焦于色情化的设计和效果
    *   **name**: 名称必须能体现原作特征，同时可添加性暗示

7.  **改编示例参考**:
    
    **示例1 - 草薙剑改编**:
    {
      "id": "doujin-equip-temp",
      "name": "草薙神剑",
      "type": "Weapon",
      "rarity": "绝品",
      "description": "传说中大蛇仙君炼制的上古神剑，剑身修长雪白，长三尺三寸，可随使用者心意伸缩至百丈之长。剑身表面布满细密的蛇鳞纹路，在月光下泛着淫靡的银光。剑柄雕刻着两条缠绵交合的淫蛇，蛇头咬住蛇尾形成护手，每当握住剑柄，便能感受到剑身的微微震动和湿润触感，仿佛握着一条活生生的巨蟒。此剑不仅锋利无比，更蕴含着大蛇仙君的淫毒之力。剑锋所指之处，敌人会被淫毒侵蚀，全身瘫软欲火焚身。若将剑身刺入敌人体内，淫毒会直达灵魂深处，让对方在极乐与痛苦中彻底臣服。长期使用此剑的修士，也会被淫毒影响，性欲逐渐高涨，最终沦为只知交合的淫兽。",
      "genderLock": "Universal",
      "stats": {
        "attack": 45,
        "critRate": 12
      }
    }
    
    **示例2 - 橡胶果实能力改编为护甲**:
    {
      "id": "doujin-equip-temp",
      "name": "橡胶神体衣",
      "type": "Armor",
      "rarity": "珍品",
      "description": "由橡胶神树的汁液炼制而成的贴身软甲，呈半透明的肉色，质地柔软Q弹，触感如同人类的肌肤。穿上后会完全贴合身体曲线，如同第二层皮肤般紧致。最神奇的是，此衣可随穿戴者的意志任意拉伸，延展至原本的十倍长度而不会破损。穿戴者的身体也会获得橡胶般的弹性，可以任意拉长、收缩、扭曲。在战斗中，身体可伸长至数丈远攻击敌人，也可收缩成球状弹跳躲避。在床笫之间，更是神兵利器——性器官可随意拉长粗大，深入对方最深处；身体柔软如泥，可摆出任何淫荡姿势；即使遭受最猛烈的冲击也不会受伤，能承受无尽的欢愉。长期穿戴会让身体永久获得部分弹性，肌肤Q弹诱人。",
      "genderLock": "Universal",
      "stats": {
        "hp": 80,
        "defense": 25,
        "speed": 15
      }
    }

8.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,m=`请根据以下灵感来源，生成一件同人装备${l?`，稀有度必须是【${l}】`:""}。记住：必须保留原作核心特征，完整进行仙侠化改编，并极度色情化！

灵感来源：
"${i}"`,f=await Ke(d,m);return jt(f)}async function ny(i,l,r="Universal",c){const m=`你是一位专业的跨次元同人创作大师，精通将各种作品中的技能、招式、能力进行仙侠背景的色情化改编。写作风格大胆、露骨、毫不避讳。你的任务是根据用户提供的"灵感来源"，创造一个既保留原著核心特征、又完全适配仙侠世界观、并极度色情化的技能。${l?`

**重要：你必须生成稀有度为【${l}】的技能！这是系统根据概率随机决定的，你必须严格遵守。**`:""}

**重要：你必须严格按照Skill接口生成技能数据，所有必填字段都不能省略！**

1.  **解析灵感与原著还原**:
    *   深入理解灵感来源的核心概念（技能名、作品、标志性效果、视觉表现等）
    *   识别并保留技能最具代表性的元素（招式动作、能量形态、特殊效果）
    *   确保改编后的技能能让熟悉原作的人一眼认出

2.  **仙侠化改编原则**:
    *   将原作的能力系统转化为仙侠修炼体系（魔法→法术，必杀技→神通）
    *   技能名称融入仙侠风格用词（诀、术、印、功、法、神通等）
    *   保持技能原有的核心效果和视觉特点
    *   稀有度应与原作中该技能的强度相匹配
    
    改编示例参考：
    **原作**: 火影忍者 - 螺旋丸
    **改编要点**:
    - name: "螺旋淫丸" 或 "欲望螺旋诀"
    - mechanicsDescription: 保留旋转能量球的概念
    - eroticDescription: 将旋转能量改为淫气，描述侵入身体的过程
    
    **原作**: 龙珠 - 龟派气功
    **改编要点**:
    - name: "龟仙淫功波" 或 "气海狂潮"
    - mechanicsDescription: 保留能量波攻击的概念
    - eroticDescription: 将能量波改为精气或淫力

3.  **色情化改编要求**:
    *   **动作描写**: 描述施展技能时的身体动作，融入性暗示
    *   **能量形态**: 将原作能量进行色情化解读（查克拉→淫气、气→精元）
    *   **效果重构**: 技能效果向性侵、催情、快感方向调整
    *   **受击反应**: 详细描述被技能击中后的淫荡反应

4.  **必填字段（缺一不可）**:
    *   **id**: 字符串，格式为 "doujin-skill-{timestamp}"
    *   **name**: 技能名称（必须改编自原作，融入仙侠风格）
        - 示例：螺旋丸 → "螺旋淫丸" 或 "欲望螺旋诀"
        - 示例：龟派气功 → "龟仙淫功波" 或 "气海狂潮"
        - 示例：月牙天冲 → "月华淫冲" 或 "斩月欲潮"
    *   **rarity**: 稀有度（根据原作技能的强度和重要性决定）
        - 普通技能 → "凡品"或"精品"
        - 稀有技能 → "珍品"
        - 传说技能 → "绝品"或"仙品"
        - 禁术级别 → "仙品"或"神品"
    *   **description**: 技能风味描述（50-100字），需融合原作+仙侠+色情元素
    *   **mechanicsDescription**: 技能机制描述，如"造成150%攻击力伤害，并有30%概率使敌人陷入【魅惑】状态持续2回合"
    *   **eroticDescription**: 极度色情的技能释放和效果描述（150-300字），必须：
        - 保留原作技能的视觉特点和施展方式
        - 详细描写施术者的身体动作和能量凝聚过程
        - 极度详细地描写技能击中敌人后的色情效果
        - 包含身体反应、性器官变化、快感描写等
    *   **cost**: 真元消耗值（数值，根据技能强度决定，一般10-50）
    *   **genderLock**: "Male"（男性专用）、"Female"（女性专用）或 "Universal"（通用）
        ${r!=="Universal"?`
        **注意：本次生成必须设置为【${r}】！**`:""}

5.  **技能改编要求**:
    *   **保留原作技能特征**: 名称和效果必须能让人联想到原作
    *   **仙侠化转换**: 将原作技能转化为仙侠法术/神通
    *   **色情化描述**: eroticDescription必须极度详细地描写技能的色情效果
    
    技能改编示例：
    **原作技能**: 火影忍者的"螺旋丸"
    **改编后**:
    - name: "螺旋淫丸"
    - rarity: "珍品"
    - description: "将体内的淫气凝聚成高速旋转的能量球，击中敌人后侵入体内引发极致快感"
    - mechanicsDescription: "造成150%攻击力伤害，并使敌人陷入【魅惑】状态，防御降低30%持续2回合"
    - eroticDescription: "施术者将掌心贴于小腹丹田处，开始疯狂吸取体内的淫气。只见一团粉红色的能量在掌心凝聚，并高速旋转起来，发出嗡嗡的淫靡声响。能量球越转越快，散发出浓郁的麝香味。随着施术者一掌推出，旋转的淫气球呼啸而去，精准地击中敌人的小腹。能量球瞬间侵入体内，沿着经脉疯狂旋转扩散。敌人立即感到一股难以抑制的热流在体内奔涌，所过之处酥麻难耐。淫气直冲性器官，女性的蜜穴开始痉挛收缩，淫水横流；男性的阴茎瞬间勃起，前端不断渗出透明液体。敌人双腿发软跪倒在地，只想被人狠狠贯穿..."
    - cost: 30
    - genderLock: "Universal"

6.  **色情化核心字段**:
    *   **eroticDescription**: 必须极度详细、露骨，保留原作技能特点的同时详细描写色情效果
    *   **name**: 名称必须能体现原作技能，同时融入仙侠和性暗示元素
    *   **mechanicsDescription**: 除了数值效果外，可包含魅惑、催情等状态

7.  **改编示例参考**:
    
    **示例1 - 螺旋丸改编**:
    {
      "id": "doujin-skill-temp",
      "name": "螺旋淫丸",
      "rarity": "珍品",
      "description": "凝聚体内淫气形成高速旋转的能量球，侵入敌人体内引发极致快感",
      "mechanicsDescription": "造成150%攻击力伤害，使敌人陷入魅惑状态，防御降低30%持续2回合",
      "eroticDescription": "施术者双手合十于小腹丹田处，开始疯狂吸取体内的淫气精元。粉红色的能量在掌间凝聚，并高速旋转起来，发出嗡嗡的淫靡声响，散发出浓郁的麝香味。随着双掌猛然推出，旋转的淫气球呼啸而去，精准地击中敌人小腹。能量球瞬间侵入体内，沿着经脉疯狂旋转扩散，所过之处酥麻难耐。淫气直冲性器官，女性蜜穴开始痉挛收缩淫水横流，男性阴茎瞬间勃起前端渗出透明液体。敌人双腿发软跪倒在地，眼神迷离，只想被人狠狠贯穿填满...",
      "cost": 30,
      "genderLock": "Universal"
    }
    
    **示例2 - 龟派气功改编**:
    {
      "id": "doujin-skill-temp",
      "name": "龟仙淫功波",
      "rarity": "绝品",
      "description": "龟仙人传承的禁忌淫术，将全身精元凝聚后释放出毁灭性的淫力冲击波",
      "mechanicsDescription": "造成200%攻击力伤害，并击退敌人，有50%概率使其陷入【精疲力竭】状态无法行动1回合",
      "eroticDescription": "施术者摆出龟仙流的经典起手式，双手在腰间合拢成莲花状，开始疯狂抽取全身上下的精元之气。只见一团白色与粉色交织的能量在掌间凝聚，越来越大，越来越亮，散发出刺鼻的淫靡气息。'龟——仙——淫——功——波！'随着一声长啸，施术者双掌猛然向前推出，粗大的能量光柱呼啸而出，如同汹涌的精液洪流般冲向敌人。光柱所过之处，空气都被淫气染成粉色。当光柱命中敌人时，强大的冲击力将其击飞数丈，同时无穷的淫力侵入体内。敌人感到全身每个细胞都在颤抖高潮，性器官疯狂喷射，在极致的快感中抽搐痉挛，最终精疲力竭地瘫软在地...",
      "cost": 45,
      "genderLock": "Male"
    }

8.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象。不要在代码块之外添加任何解释或注释。`,f=`请根据以下灵感来源，生成一个同人技能${l?`，稀有度必须是【${l}】`:""}${r!=="Universal"?`（性别锁定：${r}）`:""}。记住：必须保留原作核心特征，完整进行仙侠化改编，并极度色情化！

灵感来源：
"${i}"`,x=await Ke(m,f),h=jt(x);return h.genderLock=r,h}async function ly(i,l,r){const c=`你是一个拥有上帝视角的观察者，正在通过一枚隐形的“监视水晶”窥探一个生命培育仓的内部。你的描述必须极度色情、露骨，并充满想象力。
1.  **聚焦融合过程**: 描述两个不同的生命体（${i.name} 和 ${l.name}）的生命精华是如何相互吸引、碰撞、融合的。
2.  **能量与形态**: 大胆描绘能量的颜色、形态和流动方式。例如，“${i.name}的金色阳气如狂龙般冲击着${l.name}的粉色元阴，二者在能量风暴的中心形成了一个旋转的光茧。”
3.  **感官细节**: 描述光茧内部的变化，可以涉及到心跳声、能量波动、以及新生命形态的初步轮廓。
4.  **直接输出**: 你的最终输出只需要一段纯文本描述，不要包含任何JSON格式或额外解释。`,d=`
    正在监视的培育仓：
    - 亲代A: ${i.name} (种族/境界: ${"race"in i?i.race:"兽族"}, 稀有度: ${i.rarity})
    - 亲代B: ${l.name} (种族/境界: ${"race"in l?l.race:"兽族"}, 稀有度: ${l.rarity})

    请生成一段详细、色情、充满想象力的实时监视报告。
    `;return r?await ht({systemInstruction:c,prompt:d,gameState:r}):await Ke(c,d)}async function ry(i,l,r){const c=`你是一位顶级的遗传学和生命创造大师，专精于仙侠世界的生物工程。你的任务是根据两个亲代的信息，创造一个全新的、合乎逻辑且充满想象力的后代。
1.  **决定后代类型**:
    *   如果亲代是【人物 x 兽宠】，后代有90%的概率是【人物】（半妖/神裔），10%的概率是【兽宠】（灵兽）。你必须在返回的JSON中明确指定后代的类型（包含 'gender' 和 'skills' 字段的是人物卡，仅包含 'skill' 字段的是兽宠卡）。
2.  **融合与变异**:
    *   **外观 (appearance)**: 必须融合双方的特征。例如，如果一方是龙族，后代可能拥有龙角或龙鳞。如果一方是狐妖，后代可能有狐耳或狐尾。描述必须色情、大胆、充满细节。
    *   **稀有度 (rarity)**: 后代的稀有度有70%的概率在父母稀有度的平均等级，25%的概率提升一级，5%的概率提升两级（例如，珍品+珍品 -> 大概率珍品，小概率绝品，极小概率仙品）。
    *   **技能 (skills/skill)**: 后代必须从父母双方的技能池中【随机继承1-2个技能】。同时，有10%的概率发生【技能变异】，创造一个全新的、融合了父母技能特点的、更强大的新技能。
3.  **数据完整性**: 你必须完整地填充新卡牌的所有字段。确保为新卡牌生成一个独特的、充满想象力的名称和称号。
4.  **JSON输出**: 你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象，其结构必须与 CharacterCard 或 PetCard 类型完全匹配。`,d=`
    请根据以下两个亲代的信息，创造一个全新的后代：
    - 亲代A: ${JSON.stringify(i)}
    - 亲代B: ${JSON.stringify(l)}

    请开始你的创造，并返回新生命的完整数据。
    `,m=await Ke(c,d),f=jt(m);return f.id=`cultivated-${Date.now()}`,f}const iy=async(i,l,r)=>{const c=`你是一位顶级的仙侠世界色情小说家，擅长创作详细、刺激、充满想象力的追捕故事。你的任务是基于追捕者和目标的信息，创作一个完整、详细、色情、引人入胜的追捕日志。

**核心要求**:

1.  **完整的故事结构**（必须包含以下所有阶段，每个阶段都要详细展开）:
    
    *   **寻找追踪阶段（150-200字）**:
        - 详细描述追捕者如何接受任务，收集情报
        - 描写追踪的全过程：在哪些地方打听、遇到了什么人、发现了什么线索
        - 追捕者的心理活动和推理过程
        - 融入追捕者的技能特点、追踪手段
        - 可以包含一些小插曲：误导、假线索、意外发现等
    
    *   **发现与追逐阶段（200-250字）**:
        - 详细描写发现目标的瞬间：在什么地方、什么情况下发现的
        - 激烈追逐的全过程：穿越什么地形、施展什么身法、如何躲避障碍
        - 目标的逃跑策略：使用什么技能、设置什么陷阱、如何掩盖踪迹
        - 追捕者的应对方式：如何破解陷阱、如何缩短距离
        - 环境描写要丰富：城镇街巷、山林密道、洞府秘境、河流湖泊等
        - 途中可能遇到的意外：其他修士、妖兽、地形险阻等
    
    *   **战斗/对峙阶段（250-300字）**:
        - 追上目标后的正面对峙：双方如何摆开架势、如何试探
        - 详细的战斗过程：
          · 具体描写使用了什么技能，如何施展
          · 身体动作的细节：闪避、格挡、反击、近身搏斗
          · 衣物在战斗中的变化：破损、凌乱、暴露
          · 双方体力和真元的消耗
        - **色情化战斗描写**：
          · 身体碰撞的细节：肌肤相触、力量压制、姿势变化
          · 目标身体的暴露和追捕者的反应
          · 战斗中产生的暧昧场景和情欲张力
          · 汗水、喘息、体温、触感等感官细节
    
    *   **制服过程（150-200字）**:
        - 如何抓住机会最终制服目标
        - 制服的具体方式要详细：
          · 使用什么技能或道具（绳索、符咒、技能控制等）
          · 如何压制目标的反抗
          · 捆绑或控制的具体姿势和手法
        - **必须色情化描写**：
          · 制服时的身体接触和姿势
          · 目标的身体状态：衣衫凌乱、气喘吁吁、汗水淋漓
          · 目标的表情和反应：挣扎、呻吟、不甘、羞耻
          · 追捕者的心理和生理反应
    
    *   **趣事/意外事件（100-150字）**:
        - **必须包含**追捕过程中发生的至少1-2件趣事或意外
        - 可以是色色的事情：
          · 误闯某个修士的双修洞府，撞见不雅场景
          · 追到温泉或浴池，目标正在沐浴
          · 衣物在战斗中完全破损的尴尬
          · 使用某个技能导致的意外身体接触
          · 被春药陷阱波及的场景
        - 可以是遇险：
          · 遭遇妖兽或其他修士袭击
          · 误入危险禁地或机关陷阱
          · 恶劣天气或地形导致的险境
        - 可以是趣事：
          · 目标的狡猾计谋反而害了自己
          · 追捕者的糗事或乌龙
          · 巧遇旧识或引发误会

2.  **色情化核心要求**（贯穿全文）:
    *   **外观描写**: 详细描写追捕者和目标的身材、容貌、身体特征
    *   **衣物状态**: 时刻关注衣物的变化 - 破损、凌乱、暴露程度
    *   **身体接触**: 详细描写每一次肢体碰撞、抓扯、压制的细节
    *   **感官刺激**: 汗水的味道、喘息声、肌肤触感、体温传递
    *   **情欲氛围**: 使用暗示性、挑逗性的词语，营造暧昧张力
    *   **心理描写**: 追捕者和目标的心理活动，包括情欲层面的波动

3.  **角色特点深度融合**:
    *   追捕者的称号、技能、性格必须在行动中自然体现
    *   目标的特质、罪行、能力必须在逃跑和战斗中展现
    *   根据性别组合调整描写重点（男追女、女追男、同性等）

4.  **字数要求**: **总计800-1200字**，确保故事丰富、完整、有画面感

5.  **文笔要求**:
    *   语言生动、细腻、富有感染力
    *   善用比喻、拟人等修辞手法
    *   节奏张弛有度，有紧张有舒缓
    *   避免重复用词，多样化表达

6.  **严格禁止**:
    *   不要只写结果，必须详细描写过程
    *   不要含糊其辞或使用省略性描述
    *   不要忽略任何一个故事阶段
    *   不要少于800字或超过1200字

7.  **直接输出**: 你的最终输出只需要一段完整的纯文本故事（可以分自然段），不要包含任何JSON格式、大标题、章节标记、"# "等markdown标记或额外解释。`,d=`
        # 追捕者信息:
        - 姓名: ${i.name}
        - 性别: ${i.gender}
        - 称号: ${i.title||"无"}
        - 境界: ${i.realm||"未知"}
        - 外观: ${i.appearance||"外表平平"}
        - 核心技能: ${i.skills.map(f=>f==null?void 0:f.name).filter(Boolean).join(", ")||"无"}

        # 目标信息:
        - 姓名: ${l.name}
        - 性别: ${l.gender}
        - 称号: ${l.title||"无"}
        - 境界: ${l.realm||"未知"}
        - 外观: ${l.appearance||"外表平平"}
        - 特殊专长: ${l.origin||"无"}
        - 罪行: ${l.title||"淫邪之徒"}

        请创作一个完整、详细、色情的追捕故事，包含以下所有阶段：
        
        **必须包含的5个阶段及字数要求**:
        1. **寻找追踪阶段（150-200字）**: 接受任务、收集情报、追踪线索的全过程
        2. **发现与追逐阶段（200-250字）**: 发现目标、激烈追逐、环境描写、意外情况
        3. **战斗/对峙阶段（250-300字）**: 正面对峙、详细战斗过程、色情化战斗描写
        4. **制服过程（150-200字）**: 如何制服、捆绑控制、色情化身体接触描写
        5. **趣事/意外事件（100-150字）**: 必须包含至少1-2件色色的事情、遇险或趣事
        
        **总字数要求**: 800-1200字
        
        记住：每个阶段都必须详细展开，不要省略任何过程！
    `;return(r?await ht({systemInstruction:c,prompt:d,gameState:r}):await Ke(c,d)).trim()};async function oy(i,l,r,c){var b;const d=`你正在扮演角色 ${l.name}。请以 ${l.name} 的身份和口吻，简洁地回复玩家。你的回复应该符合仙侠世界的背景和你的角色设定。`,f=r.slice(-5).map(y=>`${y.sender==="user"?i.name:l.name}: ${y.text}`).join(`
`),x=((b=[...r].reverse().find(y=>y.sender==="user"))==null?void 0:b.text)||"",h=`
对话历史:
${f}

玩家 (${i.name}) 的最新消息:
"${x}"

现在，请以 ${l.name} 的身份回复。
`;return(await Ke(d,h)).trim()}async function gd(i,l,r,c){const d=c.replace("{category}",r),f=`
    请根据以下记忆片段生成总结：

    ${i.map((E,$)=>`[${$+1}] ${E.timestamp} - ${E.title}
${E.content}`).join(`

`)}
    `,x=await Ke(d,f),h=x.trim().split(`
`),g=h[0].length<30?h[0]:`关于${r}的总结`,b=h.length>1?h.slice(1).join(`
`).trim():x.trim(),y=i.map(E=>E.id),S=0,C=i.length-1;return{id:`summary-${Date.now()}`,type:l,category:r,title:g,content:b,sourceMemoryIds:y,startIndex:S,endIndex:C,timestamp:new Date().toLocaleString(),realTimestamp:Date.now()}}async function kf(i,l,r){try{const c="仙侠卡牌RPG记忆库";window.TavernHelper.getWorldbookNames().includes(c)||await window.TavernHelper.createWorldbook(c,[]);const m=i.title||`${l}-${r==="small"?"小":"大"}总结-${new Date().toLocaleString()}`,f=new Date().toLocaleString(),x={name:m,enabled:!0,strategy:{type:"selective",keys:[l,r==="small"?"小总结":"大总结"],keys_secondary:{logic:"and_any",keys:[]},scan_depth:10},position:{type:"after_character_definition",role:"system",depth:4,order:100},content:`# ${m}

**分类**: ${l}
**类型**: ${r==="small"?"小总结":"大总结"}
**时间**: ${f}

---

${i.content}`,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};return await window.TavernHelper.createWorldbookEntries(c,[x]),!0}catch(c){return console.error("保存总结到世界书失败:",c),!1}}async function cy(i,l,r,c){const d=`你是一位仙侠世界的劳役监工，负责记录囚犯的劳役成果。你的任务是根据囚犯信息、劳役类型和持续时间，生成一份详细的劳役结果报告。

**重要：你必须严格按照以下JSON结构生成劳役结果，所有必填字段都不能省略！**

1.  **必填字段（缺一不可）**:
    *   **materials**: 数组，必须包含恰好2个材料对象，每个对象包含：
        - **material**: 完整的材料对象（LaborMaterial接口）
          - **id**: 格式为 "material-{timestamp}-{index}"
          - **name**: 材料名称（必须符合${l}类型：矿山产出矿石，采药产出草药）
          - **type**: 必须是 "${l==="矿山"?"ore":"herb"}"
          - **rarity**: 稀有度（根据囚犯境界和劳役时长决定）
          - **description**: 材料的详细描述（50-100字）
          - **value**: 单个材料价值（灵石），根据稀有度：凡品5-10，良品10-20，优品20-40，珍品40-80，绝品80-150，仙品150-300
        - **quantity**: 数量（必须在25-50之间随机）
    *   **story**: AI生成的劳役过程描述（150-250字）
    *   **experience**: 囚犯获得的经验值（根据劳役时长和境界计算，一般10-50）
    *   **healthCost**: 消耗的健康度（根据劳役强度，一般5-20）

2.  **材料生成规则**:
    *   ${l==="矿山"?'**矿石类型**: 必须生成矿石，如"灵铁矿"、"赤铜精矿"、"紫金玉石"、"星陨晶石"等':'**草药类型**: 必须生成草药，如"紫芝草"、"血莲花"、"九叶灵芝"、"七星回魂草"等'}
    *   **稀有度分配**:
        - 60%概率：凡品或良品
        - 30%概率：优品或珍品
        - 10%概率：绝品或以上
    *   **数量随机**: 每种材料25-50个随机（可以不同）
    *   **名称唯一**: 两种材料的名称必须不同

3.  **劳役故事创作要求**:
    *   **基于囚犯特征**: 必须提及囚犯的名字、性别、境界
    *   **符合劳役类型**: ${l==="矿山"?"描述挖矿过程，如挖掘、敲击、搬运矿石等":"描述采药过程，如寻找、采摘、处理草药等"}
    *   **劳役时长**: 体现${r}小时的劳作过程
    *   **色情元素**: 可适度加入囚犯在劳役中的身体状态、汗水、疲惫等描写，但不要过度
    *   **结果呈现**: 最后说明找到/采集到了哪些材料
    *   **字数要求**: 150-250字

4.  **经验和健康消耗计算**:
    *   **experience**: 基础值 = duration * 2，根据囚犯境界调整（筑基期+0，金丹期+5，元婴期+10）
    *   **healthCost**: 基础值 = duration * 1.5，最小5，最大20

5.  **JSON格式示例**:
\`\`\`json
{
  "materials": [
    {
      "material": {
        "id": "material-temp-1",
        "name": "紫晶灵铁矿",
        "type": "ore",
        "rarity": "优品",
        "description": "蕴含浓郁灵气的紫色铁矿，可用于锻造法器，矿石表面闪烁着星光般的微粒。",
        "value": 25
      },
      "quantity": 37
    },
    {
      "material": {
        "id": "material-temp-2",
        "name": "赤铜精矿",
        "type": "ore",
        "rarity": "良品",
        "description": "火红色的铜矿石，质地坚硬，含有微量火属性灵气，适合炼制火系法宝。",
        "value": 15
      },
      "quantity": 42
    }
  ],
  "story": "囚犯${i.character.name}被押送至青蛇矿脉深处，在监工的看守下开始了长达${r}小时的采矿劳作。他挥动着沉重的矿镐，一次次砸向坚硬的岩壁，汗水浸透了单薄的囚衣。随着时间推移，${i.character.gender==="Male"?"他":"她"}的双臂已经酸痛难忍，但在监工的鞭子威慑下不敢停歇。在第三个时辰时，矿镐终于凿开了一处紫光闪烁的矿脉，大量紫晶灵铁矿暴露出来。${i.character.gender==="Male"?"他":"她"}强忍疲惫，将这些珍贵的矿石一一搬运至矿车。临近收工时，又在矿洞侧壁发现了一小片赤铜精矿。虽然身心俱疲，但这次劳役的收获还算不错。",
  "experience": 25,
  "healthCost": 12
}
\`\`\`

6.  **严格要求**:
    *   你的最终输出必须是一个包裹在 \`\`\`json ... \`\`\` 代码块中的JSON对象
    *   不要在代码块之外添加任何解释或注释
    *   materials数组必须恰好包含2个元素
    *   每个material对象必须完整填充所有字段
    *   材料类型必须与劳役位置类型匹配（矿山→ore，采药→herb）`,m=`
    囚犯信息:
    - 姓名: ${i.character.name}
    - 性别: ${i.character.gender}
    - 境界: ${i.character.realm}
    - 稀有度: ${i.character.rarity}
    - 称号: ${i.character.title||"无"}
    - 当前健康度: ${i.health}/100
    - 屈服度: ${i.submissionLevel}/100

    劳役详情:
    - 劳役类型: ${l}
    - 劳役时长: ${r}小时

    请生成完整的劳役结果报告，包括2种不同的${l==="矿山"?"矿石":"草药"}材料、劳役过程故事、经验和健康消耗。
    `,f=c?await ht({systemInstruction:d,prompt:m,gameState:c}):await Ke(d,m),x=jt(f);if(x.materials&&x.materials.length===2){const h=Date.now();x.materials[0].material.id=`material-${h}-1`,x.materials[1].material.id=`material-${h}-2`}return x}const dy=({entry:i,index:l,activeCategory:r,onDeleteEntry:c})=>{const[d,m]=v.useState(!0),f=()=>{m(!d)},x=`transition-all duration-300 ease-in-out overflow-hidden ${d?"max-h-24":"max-h-full"}`;return e.jsxs("div",{className:"glass-morphism p-5 rounded-lg border border-stone-700/50 hover:border-xianxia-gold-500/50 transition-all duration-300 group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:"px-3 py-1 bg-gradient-to-r from-amber-600/20 to-amber-700/20 text-amber-300 text-xs rounded-full border border-amber-600/30",children:["第 ",l+1," 条"]}),e.jsx("h3",{className:"text-lg font-bold text-white font-serif",children:i.title})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-clock"}),i.timestamp]}),i.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-location-dot"}),i.location]}),i.involvedCharacters&&i.involvedCharacters.length>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-users"}),i.involvedCharacters.join("、")]})]})]}),e.jsx("button",{onClick:()=>c(r,i.id),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-red-400 hover:text-red-300 p-2",title:"删除此记忆",children:e.jsx("i",{className:"fa-solid fa-trash-alt"})})]}),e.jsxs("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap bg-stone-900/30 p-4 rounded border border-stone-700/30 cursor-pointer",onClick:f,children:[e.jsx("div",{className:x,children:i.content}),e.jsx("div",{className:"text-center text-xs text-gray-500 mt-2",children:d?"点击展开":"点击折叠"})]})]})},uy=({isOpen:i,onClose:l,gameState:r,onSaveThreshold:c})=>{const[d,m]=v.useState(""),[f,x]=v.useState(!1),[h,g]=v.useState([]),[b,y]=v.useState([]),[S,C]=v.useState(!0),[A,E]=v.useState(.7),[$,Z]=v.useState("70"),[R,V]=v.useState(!1),[J,D]=v.useState(new Set),[T,G]=v.useState(0),[_,M]=v.useState(!1),U=["探索","战斗","商城","医馆","悬赏","培育","商业","声望","公告","其他"];v.useEffect(()=>{var I;if(i){vs.initialize().catch(console.error);const K=((I=r.vectorConfig)==null?void 0:I.similarityThreshold)||.7;E(K),Z((K*100).toFixed(0))}},[i,r.vectorConfig]);const k=I=>{Z(I);const K=parseFloat(I);!isNaN(K)&&K>=0&&K<=100&&E(K/100)},Q=()=>{c&&(c(A),M(!0),setTimeout(()=>M(!1),2e3))},ne=async()=>{if(!d.trim()&&!R){alert("请输入搜索内容或启用上下文搜索");return}x(!0),g([]);const I=Date.now();try{let K;R?K=(await Ji.retrieveRelevantMemories(r,d.trim()||void 0,r.vectorConfig.maxResults)).relevantMemories:K=await jd.search(d,{categories:b.length>0?b:void 0,minSimilarity:A,maxResults:r.vectorConfig.maxResults,useTimeDecay:S}),g(K),G(Date.now()-I)}catch(K){alert("搜索失败: "+(K instanceof Error?K.message:"未知错误")),console.error("搜索错误:",K)}finally{x(!1)}},Y=I=>{y(K=>K.includes(I)?K.filter(fe=>fe!==I):[...K,I])},X=I=>{D(K=>{const fe=new Set(K);return fe.has(I)?fe.delete(I):fe.add(I),fe})},L=I=>{const K=(I*100).toFixed(1);let fe="text-gray-400";return I>=.9?fe="text-green-400":I>=.8?fe="text-blue-400":I>=.7&&(fe="text-purple-400"),e.jsxs("span",{className:fe,children:[K,"%"]})};return i?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/95 to-purple-900/95 border-2 border-indigo-400/50 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-indigo-400/30 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-indigo-100",children:"🔍 语义搜索"}),e.jsx("button",{onClick:l,className:"text-indigo-300 hover:text-white text-2xl leading-none",children:"×"})]}),e.jsxs("div",{className:"p-4 border-b border-indigo-400/30 bg-black/20",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:d,onChange:I=>m(I.target.value),onKeyPress:I=>I.key==="Enter"&&ne(),placeholder:R?"可选：自定义查询（留空则自动提取上下文）":"输入搜索内容...",className:"flex-1 px-4 py-2 bg-black/50 border border-indigo-400/50 rounded text-indigo-100 placeholder-indigo-400/50",disabled:f}),e.jsx("button",{onClick:ne,disabled:f||!d.trim()&&!R,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded transition-colors",children:f?"搜索中...":"搜索"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-indigo-200 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:I=>V(I.target.checked),className:"w-4 h-4"}),e.jsx("span",{children:"🧠 上下文感知搜索"})]}),e.jsx("span",{className:"text-xs text-indigo-400",children:"（根据当前游戏场景自动检索相关记忆）"})]}),!R&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-indigo-300 mb-2",children:"分类过滤："}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(I=>e.jsx("button",{onClick:()=>Y(I),className:`px-3 py-1 rounded text-sm transition-colors ${b.includes(I)?"bg-indigo-600 text-white":"bg-black/30 text-indigo-300 hover:bg-black/50"}`,children:I},I))})]}),e.jsxs("details",{className:"text-sm",open:!0,children:[e.jsx("summary",{className:"text-indigo-300 cursor-pointer hover:text-indigo-200 mb-3",children:"高级选项"}),e.jsxs("div",{className:"mt-3 space-y-3 pl-4",children:[e.jsxs("div",{className:"bg-black/30 p-3 rounded border border-indigo-400/30",children:[e.jsx("label",{className:"block text-indigo-200 mb-2 font-semibold",children:"📊 相似度阈值设置"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-indigo-400 mb-1",children:[e.jsx("span",{children:"0%"}),e.jsxs("span",{className:"font-bold text-indigo-300",children:["当前: ",(A*100).toFixed(0),"%"]}),e.jsx("span",{children:"100%"})]}),e.jsx("input",{type:"range",value:A,onChange:I=>{const K=parseFloat(I.target.value);E(K),Z((K*100).toFixed(0))},min:"0",max:"1",step:"0.01",className:"w-full"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"text-indigo-200 text-sm whitespace-nowrap",children:"精确值:"}),e.jsx("input",{type:"number",value:$,onChange:I=>k(I.target.value),min:"0",max:"100",step:"1",className:"flex-1 px-3 py-1 bg-black/50 border border-indigo-400/50 rounded text-indigo-100 text-sm",placeholder:"0-100"}),e.jsx("span",{className:"text-indigo-300 text-sm",children:"%"}),e.jsx("button",{onClick:Q,className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors whitespace-nowrap flex items-center gap-1",title:"保存阈值到设置",children:"💾 保存"})]}),_&&e.jsx("div",{className:"mt-2 text-xs text-green-400 animate-pulse",children:"✓ 阈值已保存！"}),e.jsx("p",{className:"text-xs text-indigo-400 mt-2",children:"💡 阈值越高，搜索结果越精确但数量越少；阈值越低，结果越多但可能不够相关"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-indigo-200 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:I=>C(I.target.checked),className:"w-4 h-4"}),e.jsx("span",{children:"启用时间衰减（较新的记忆权重更高）"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:f?e.jsxs("div",{className:"text-center text-indigo-300 py-8",children:[e.jsx("div",{className:"animate-spin text-4xl mb-2",children:"🔄"}),e.jsx("p",{children:"正在搜索中..."})]}):h.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 p-3 bg-black/30 rounded border border-indigo-400/30 text-indigo-200 text-sm",children:["找到 ",e.jsx("span",{className:"text-indigo-400 font-bold",children:h.length})," 个相关记忆",e.jsxs("span",{className:"ml-4 text-indigo-400",children:["搜索耗时: ",T,"ms"]})]}),e.jsx("div",{className:"space-y-3",children:h.map((I,K)=>{const fe=I.memory,ge=J.has(fe.id),O=fe.text.length>150?fe.text.substring(0,150)+"...":fe.text;return e.jsxs("div",{className:"bg-black/40 border border-indigo-400/40 rounded-lg p-4 hover:border-indigo-400/60 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-indigo-400 font-bold",children:["#",I.rank]}),e.jsx("span",{className:"px-2 py-0.5 bg-indigo-600/50 text-indigo-200 text-xs rounded",children:fe.category}),e.jsx("span",{className:"text-indigo-300 text-sm",children:fe.metadata.timestamp})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm",children:["相似度: ",L(I.similarity)]})})]}),(fe.metadata.location||fe.metadata.involvedCharacters)&&e.jsxs("div",{className:"flex gap-4 mb-2 text-xs text-indigo-400",children:[fe.metadata.location&&e.jsxs("span",{children:["📍 ",fe.metadata.location]}),fe.metadata.involvedCharacters&&fe.metadata.involvedCharacters.length>0&&e.jsxs("span",{children:["👥 ",fe.metadata.involvedCharacters.join("、")]})]}),e.jsx("div",{className:"text-indigo-100 text-sm mb-2",children:ge?fe.text:O}),fe.text.length>150&&e.jsx("button",{onClick:()=>X(fe.id),className:"text-xs text-indigo-400 hover:text-indigo-300",children:ge?"▲ 收起":"▼ 展开"})]},fe.id)})})]}):e.jsxs("div",{className:"text-center text-indigo-300 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🔍"}),e.jsx("p",{children:"暂无搜索结果"}),e.jsx("p",{className:"text-sm mt-2 text-indigo-400",children:r.vectorConfig.enabled?"输入关键词或启用上下文搜索开始检索":"请先在设置中启用向量化功能"})]})}),e.jsx("div",{className:"p-4 border-t border-indigo-400/30 bg-black/20",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-indigo-300",children:[e.jsx("div",{children:r.vectorConfig.enabled?e.jsx("span",{children:"✅ 向量化功能已启用"}):e.jsx("span",{className:"text-yellow-400",children:"⚠️ 向量化功能未启用"})}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"关闭"})]})})]})}):null},my=({prompts:i,onPromptsChange:l})=>e.jsxs("div",{className:"space-y-6 text-white",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-purple-300 mb-2",children:"小总结预设"}),e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"这个预设将用于生成实时记录的小总结。你可以使用 `{category}` 占位符来动态插入当前分类。"}),e.jsx("textarea",{value:i.small,onChange:r=>l({...i,small:r.target.value}),rows:6,className:"w-full px-3 py-2 bg-stone-800/60 border border-stone-600 rounded-md text-sm text-gray-200 focus:outline-none focus:border-purple-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300 mb-2",children:"大总结预设"}),e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"这个预设将用于把多个小总结合并成一个大总结。你可以使用 `{category}` 占位符。"}),e.jsx("textarea",{value:i.large,onChange:r=>l({...i,large:r.target.value}),rows:6,className:"w-full px-3 py-2 bg-stone-800/60 border border-stone-600 rounded-md text-sm text-gray-200 focus:outline-none focus:border-indigo-500 transition-colors"})]})]}),xy=({isOpen:i,onClose:l,settings:r,onSave:c,gameState:d,onVectorConfigSave:m})=>{const[f,x]=v.useState(r),[h,g]=v.useState("general"),[b,y]=v.useState((d==null?void 0:d.vectorConfig)||{enabled:!1,apiUrl:"https://api.openai.com/v1",apiKey:"",model:"text-embedding-3-small",autoVectorize:!1,vectorizeOnSummary:!0,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0}),[S,C]=v.useState("embedding"),[A,E]=v.useState(!1),[$,Z]=v.useState(null),[R,V]=v.useState([]),[J,D]=v.useState(!1),[T,G]=v.useState(null),[_,M]=v.useState(!1),[U,k]=v.useState(""),[Q,ne]=v.useState([]),[Y,X]=v.useState(!1),[L,I]=v.useState("");if(!i)return null;const K=R.filter(de=>de.toLowerCase().includes(U.toLowerCase())),fe=()=>{c(f),h==="vector"&&m&&(Gt.updateConfig(b),m(b)),l()},ge=async()=>{M(!0);try{await vs.initialize();const de=await vs.getStats();G(de)}catch(de){console.error("加载统计信息失败:",de)}finally{M(!1)}},O=async()=>{E(!0),Z(null);try{Gt.updateConfig(b);const de=await Gt.testConnection();de.success?Z({success:!0,message:`连接成功！使用模型: ${de.model}`}):Z({success:!1,message:`连接失败: ${de.error}`})}catch(de){Z({success:!1,message:`连接失败: ${de instanceof Error?de.message:"未知错误"}`})}finally{E(!1)}},se=async()=>{D(!0),Z(null);try{Gt.updateConfig(b);const de=await Gt.fetchAvailableModels();de.success&&de.models?(V(de.models),localStorage.setItem("vector_available_models",JSON.stringify(de.models)),Z({success:!0,message:`成功获取 ${de.models.length} 个模型`})):Z({success:!1,message:`获取模型列表失败: ${de.error}`})}catch(de){Z({success:!1,message:`获取模型列表失败: ${de instanceof Error?de.message:"未知错误"}`})}finally{D(!1)}},he=async()=>{X(!0),Z(null);try{const de=await fetch(`${b.rerankerApiUrl}/models`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.rerankerApiKey}`}});if(!de.ok){const Oe=await de.text();Z({success:!1,message:`获取Reranker模型列表失败: HTTP ${de.status} - ${Oe}`});return}const ye=await de.json();let ke=[];ye.data&&Array.isArray(ye.data)?ke=ye.data.map(Oe=>Oe.id):ye.models&&Array.isArray(ye.models)?ke=ye.models.map(Oe=>typeof Oe=="string"?Oe:Oe.id||Oe.name):Array.isArray(ye)&&(ke=ye.map(Oe=>typeof Oe=="string"?Oe:Oe.id||Oe.name)),ke.length>0?(ne(ke),localStorage.setItem("reranker_available_models",JSON.stringify(ke)),Z({success:!0,message:`成功获取 ${ke.length} 个Reranker模型`})):Z({success:!1,message:"未找到可用的Reranker模型"})}catch(de){Z({success:!1,message:`获取Reranker模型列表失败: ${de instanceof Error?de.message:"未知错误"}`})}finally{X(!1)}},le=async()=>{if(confirm("确定要清空所有向量数据吗？此操作不可逆！"))try{await vs.clearAllVectors(),alert("向量数据已清空"),ge()}catch(de){alert("清空失败: "+(de instanceof Error?de.message:"未知错误"))}};Zi.useEffect(()=>{if(h==="vector"&&i){ge();const de=localStorage.getItem("vector_available_models");if(de)try{const ke=JSON.parse(de);V(ke)}catch(ke){console.error("加载已保存的模型列表失败:",ke)}const ye=localStorage.getItem("reranker_available_models");if(ye)try{const ke=JSON.parse(ye);ne(ke)}catch(ke){console.error("加载已保存的Reranker模型列表失败:",ke)}}},[h,i]);const xe=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-1",children:"自动总结"}),e.jsx("p",{className:"text-xs text-gray-400",children:"启用后将根据设定自动生成总结"})]}),e.jsx("button",{onClick:()=>x({...f,autoSummaryEnabled:!f.autoSummaryEnabled}),className:`relative w-14 h-7 rounded-full transition-colors duration-300 ${f.autoSummaryEnabled?"bg-gradient-to-r from-amber-500 to-amber-600":"bg-stone-600"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow-md transition-transform duration-300 ${f.autoSummaryEnabled?"translate-x-8":"translate-x-1"}`})})]})}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"小总结触发条件"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"每"}),e.jsx("input",{type:"number",min:"1",max:"50",value:f.smallSummaryInterval,onChange:de=>x({...f,smallSummaryInterval:Math.max(1,Math.min(50,parseInt(de.target.value)||1))}),className:"w-20 px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-center text-white focus:outline-none focus:border-amber-500",disabled:!f.autoSummaryEnabled}),e.jsx("span",{className:"text-sm text-gray-300",children:"条实时记录生成一次小总结"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"推荐值: 5-15条"})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"大总结触发条件"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"每"}),e.jsx("input",{type:"number",min:"1",max:"20",value:f.largeSummaryInterval,onChange:de=>x({...f,largeSummaryInterval:Math.max(1,Math.min(20,parseInt(de.target.value)||1))}),className:"w-20 px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-center text-white focus:outline-none focus:border-amber-500",disabled:!f.autoSummaryEnabled}),e.jsx("span",{className:"text-sm text-gray-300",children:"条小总结生成一次大总结"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"推荐值: 3-8条"})]})]}),pe=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-purple-700/50",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-200 mb-3",children:"📊 向量存储统计"}),_?e.jsx("p",{className:"text-purple-300",children:"加载中..."}):T?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"总向量数："}),T.totalVectors]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"平均维度："}),T.averageDimension.toFixed(0)]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"存储大小："}),(T.storageSize/1024/1024).toFixed(2)," MB"]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"最早记录："}),T.oldestVector?new Date(T.oldestVector).toLocaleDateString():"-"]})]}):e.jsx("p",{className:"text-purple-300",children:"暂无数据"})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"⚙️ 基础设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-gray-300",children:"启用向量化功能"}),e.jsx("input",{type:"checkbox",checked:b.enabled,onChange:de=>y({...b,enabled:de.target.checked}),className:"w-5 h-5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"API URL"}),e.jsx("input",{type:"text",value:b.apiUrl,onChange:de=>y({...b,apiUrl:de.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"https://api.openai.com/v1"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"支持OpenAI API或兼容接口（如本地Ollama）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:b.apiKey,onChange:de=>y({...b,apiKey:de.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"sk-..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-gray-300",children:"Embedding模型"}),e.jsx("button",{onClick:se,disabled:J||!b.apiUrl,className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:J?"获取中...":"🔄 刷新模型"})]}),R.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:U,onChange:de=>k(de.target.value),placeholder:"🔍 搜索模型...",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white text-sm"}),U&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["找到 ",K.length," 个匹配的模型"]})]}),e.jsx("select",{value:b.model,onChange:de=>y({...b,model:de.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",size:R.length>0?Math.min(K.length+5,10):5,children:R.length>0?e.jsxs(e.Fragment,{children:[e.jsx("optgroup",{label:"已发现的模型",children:K.length>0?K.map(de=>e.jsx("option",{value:de,children:de},de)):e.jsx("option",{disabled:!0,children:"没有匹配的模型"})}),e.jsxs("optgroup",{label:"常用模型",children:[e.jsx("option",{value:"text-embedding-3-small",children:"text-embedding-3-small (OpenAI)"}),e.jsx("option",{value:"text-embedding-3-large",children:"text-embedding-3-large (OpenAI)"}),e.jsx("option",{value:"text-embedding-ada-002",children:"text-embedding-ada-002 (OpenAI)"}),e.jsx("option",{value:"nomic-embed-text",children:"nomic-embed-text (Ollama)"}),e.jsx("option",{value:"mxbai-embed-large",children:"mxbai-embed-large (Ollama)"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"text-embedding-3-small",children:"text-embedding-3-small (OpenAI)"}),e.jsx("option",{value:"text-embedding-3-large",children:"text-embedding-3-large (OpenAI)"}),e.jsx("option",{value:"text-embedding-ada-002",children:"text-embedding-ada-002 (OpenAI)"}),e.jsx("option",{value:"nomic-embed-text",children:"nomic-embed-text (Ollama)"}),e.jsx("option",{value:"mxbai-embed-large",children:"mxbai-embed-large (Ollama)"})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'点击"刷新模型"可从API端点自动获取可用模型列表'})]}),e.jsx("button",{onClick:O,disabled:A||!b.apiKey,className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded transition-colors",children:A?"测试中...":"测试连接"}),$&&e.jsx("div",{className:`p-3 rounded border ${$.success?"bg-green-900/50 border-green-400/50 text-green-200":"bg-red-900/50 border-red-400/50 text-red-200"}`,children:$.message})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"🤖 自动化设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-gray-300",children:"自动向量化新记忆"}),e.jsx("input",{type:"checkbox",checked:b.autoVectorize,onChange:de=>y({...b,autoVectorize:de.target.checked}),className:"w-5 h-5"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-gray-300",children:"生成总结时自动向量化"}),e.jsx("input",{type:"checkbox",checked:b.vectorizeOnSummary,onChange:de=>y({...b,vectorizeOnSummary:de.target.checked}),className:"w-5 h-5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"批处理大小"}),e.jsx("input",{type:"number",value:b.batchSize,onChange:de=>y({...b,batchSize:parseInt(de.target.value)}),min:"1",max:"50",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"每次批量处理的记忆数量（1-50）"})]})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"🔍 搜索设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2",children:["相似度阈值: ",(b.similarityThreshold*100).toFixed(0),"%"]}),e.jsx("input",{type:"range",value:b.similarityThreshold,onChange:de=>y({...b,similarityThreshold:parseFloat(de.target.value)}),min:"0.5",max:"0.95",step:"0.05",className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"低于此值的搜索结果将被过滤"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"最大结果数"}),e.jsx("input",{type:"number",value:b.maxResults,onChange:de=>y({...b,maxResults:parseInt(de.target.value)}),min:"5",max:"100",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"最终返回给AI的记忆数量"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Rerank前检索数量"}),e.jsx("input",{type:"number",value:b.topKBeforeRerank,onChange:de=>y({...b,topKBeforeRerank:parseInt(de.target.value)}),min:"10",max:"200",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"向量检索的候选数量，建议设置为最大结果数的2-5倍"})]})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"🔧 高级设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"重试次数"}),e.jsx("input",{type:"number",value:b.retryAttempts,onChange:de=>y({...b,retryAttempts:parseInt(de.target.value)}),min:"0",max:"5",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-gray-300",children:"启用向量缓存"}),e.jsx("input",{type:"checkbox",checked:b.cacheEnabled,onChange:de=>y({...b,cacheEnabled:de.target.checked}),className:"w-5 h-5"})]})]})]})]}),Ae=()=>{const de=Q.filter(ye=>ye.toLowerCase().includes(L.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-blue-700/50 bg-blue-900/10",children:[e.jsx("h3",{className:"text-blue-300 font-semibold mb-2",children:"ℹ️ 什么是Reranker？"}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"Reranker（重排序模型）是一种专门用于优化搜索结果排序的AI模型。它可以："}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"对向量检索的候选结果进行精确重排序"}),e.jsx("li",{children:"提高最相关记忆的排名准确度"}),e.jsx("li",{children:"减少不相关内容进入AI上下文"}),e.jsx("li",{children:"改善AI生成的质量和相关性"})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-4",children:"⚙️ Reranker设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-300 font-medium",children:"启用Reranker"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"开启后将对向量检索结果进行重排序"})]}),e.jsx("input",{type:"checkbox",checked:b.rerankerEnabled,onChange:ye=>y({...b,rerankerEnabled:ye.target.checked}),className:"w-5 h-5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Reranker API URL"}),e.jsx("input",{type:"text",value:b.rerankerApiUrl,onChange:ye=>y({...b,rerankerApiUrl:ye.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"https://api.jina.ai/v1",disabled:!b.rerankerEnabled}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"推荐使用Jina AI、Cohere或兼容的Reranker API"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2",children:"Reranker API Key"}),e.jsx("input",{type:"password",value:b.rerankerApiKey,onChange:ye=>y({...b,rerankerApiKey:ye.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"jina_...",disabled:!b.rerankerEnabled})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-gray-300",children:"Reranker模型"}),e.jsx("button",{onClick:he,disabled:Y||!b.rerankerApiUrl||!b.rerankerEnabled,className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:Y?"获取中...":"🔄 刷新模型"})]}),Q.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("input",{type:"text",value:L,onChange:ye=>I(ye.target.value),placeholder:"🔍 搜索Reranker模型...",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white text-sm",disabled:!b.rerankerEnabled}),L&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["找到 ",de.length," 个匹配的模型"]})]}),e.jsx("select",{value:b.rerankerModel,onChange:ye=>y({...b,rerankerModel:ye.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",size:Q.length>0?Math.min(de.length+5,10):5,disabled:!b.rerankerEnabled,children:Q.length>0?e.jsxs(e.Fragment,{children:[e.jsx("optgroup",{label:"已发现的模型",children:de.length>0?de.map(ye=>e.jsx("option",{value:ye,children:ye},ye)):e.jsx("option",{disabled:!0,children:"没有匹配的模型"})}),e.jsxs("optgroup",{label:"常用模型",children:[e.jsx("option",{value:"jina-reranker-v2-base-multilingual",children:"jina-reranker-v2-base-multilingual (推荐)"}),e.jsx("option",{value:"jina-reranker-v1-base-en",children:"jina-reranker-v1-base-en"}),e.jsx("option",{value:"jina-reranker-v1-turbo-en",children:"jina-reranker-v1-turbo-en"}),e.jsx("option",{value:"rerank-multilingual-v3.0",children:"rerank-multilingual-v3.0 (Cohere)"}),e.jsx("option",{value:"rerank-english-v3.0",children:"rerank-english-v3.0 (Cohere)"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("optgroup",{label:"Jina AI Rerankers",children:[e.jsx("option",{value:"jina-reranker-v2-base-multilingual",children:"jina-reranker-v2-base-multilingual (推荐)"}),e.jsx("option",{value:"jina-reranker-v1-base-en",children:"jina-reranker-v1-base-en"}),e.jsx("option",{value:"jina-reranker-v1-turbo-en",children:"jina-reranker-v1-turbo-en"})]}),e.jsxs("optgroup",{label:"Cohere Rerankers",children:[e.jsx("option",{value:"rerank-multilingual-v3.0",children:"rerank-multilingual-v3.0"}),e.jsx("option",{value:"rerank-english-v3.0",children:"rerank-english-v3.0"}),e.jsx("option",{value:"rerank-multilingual-v2.0",children:"rerank-multilingual-v2.0"})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'点击"刷新模型"可从API端点自动获取可用模型列表'})]})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"🔄 工作流程"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-blue-400 font-mono",children:"1."}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300 font-medium",children:"向量检索"}),e.jsxs("p",{className:"text-gray-500 text-xs",children:["使用Embedding模型检索 ",b.topKBeforeRerank," 个候选记忆"]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-blue-400 font-mono",children:"2."}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300 font-medium",children:"Reranker重排"}),e.jsx("p",{className:"text-gray-500 text-xs",children:"使用Reranker对候选结果进行精确排序"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-blue-400 font-mono",children:"3."}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-300 font-medium",children:"返回结果"}),e.jsxs("p",{className:"text-gray-500 text-xs",children:["返回排序后的前 ",b.maxResults," 个最相关记忆"]})]})]})]})]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-yellow-700/50 bg-yellow-900/10",children:[e.jsx("h3",{className:"text-yellow-300 font-semibold mb-2",children:"💡 性能建议"}),e.jsxs("ul",{className:"text-sm text-gray-300 space-y-1",children:[e.jsx("li",{children:"• 候选数量建议设置为最终结果的 2-5 倍"}),e.jsx("li",{children:"• 例如：最终要 20 条结果，候选数量设为 50-100"}),e.jsx("li",{children:"• Reranker会增加 100-300ms 的延迟"}),e.jsx("li",{children:"• 在对话场景中，更高的相关性值得这点延迟"})]})]})]})},je=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-purple-700/50",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-200 mb-3",children:"📊 向量存储统计"}),_?e.jsx("p",{className:"text-purple-300",children:"加载中..."}):T?e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"总向量数："}),T.totalVectors]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"平均维度："}),T.averageDimension.toFixed(0)]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"存储大小："}),(T.storageSize/1024/1024).toFixed(2)," MB"]}),e.jsxs("div",{className:"text-purple-200",children:[e.jsx("span",{className:"text-purple-400",children:"最早记录："}),T.oldestVector?new Date(T.oldestVector).toLocaleDateString():"-"]})]}):e.jsx("p",{className:"text-purple-300",children:"暂无数据"})]}),e.jsxs("div",{className:"flex space-x-2 border-b border-stone-700",children:[e.jsxs("button",{onClick:()=>C("embedding"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${S==="embedding"?"bg-stone-700/80 text-green-400 border-b-2 border-green-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:[e.jsx("i",{className:"fa-solid fa-vector-square mr-2"}),"嵌入模型"]}),e.jsxs("button",{onClick:()=>C("reranker"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${S==="reranker"?"bg-stone-700/80 text-blue-400 border-b-2 border-blue-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:[e.jsx("i",{className:"fa-solid fa-ranking-star mr-2"}),"重排模型"]})]}),e.jsxs("div",{className:"pt-2",children:[S==="embedding"&&pe(),S==="reranker"&&Ae()]}),e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-red-700/50 bg-red-900/10",children:[e.jsx("h3",{className:"text-red-400 font-semibold mb-4",children:"⚠️ 危险操作"}),e.jsx("button",{onClick:le,className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"清空所有向量数据"}),e.jsx("p",{className:"text-xs text-red-300 mt-2",children:"此操作将永久删除所有向量化的记忆，但不会影响原始记忆数据"})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:de=>de.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-stone-700/50 bg-black/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-cog text-xl text-gradient-gold"}),e.jsx("h2",{className:"text-xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"总结设置"})]}),e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full bg-stone-700/50 hover:bg-stone-600/50 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[e.jsx("button",{onClick:()=>g("general"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${h==="general"?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:"常规设置"}),e.jsx("button",{onClick:()=>g("presets"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${h==="presets"?"bg-stone-700/80 text-purple-400 border-b-2 border-purple-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:"预设管理"}),e.jsxs("button",{onClick:()=>g("vector"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 flex items-center gap-2 ${h==="vector"?"bg-stone-700/80 text-blue-400 border-b-2 border-blue-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:[e.jsx("i",{className:"fa-solid fa-brain"}),"向量设置"]})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto scrollbar-xianxia flex-grow max-h-[60vh]",children:[h==="general"&&xe(),h==="presets"&&e.jsx(my,{prompts:f.summaryPrompts,onPromptsChange:de=>x(ye=>({...ye,summaryPrompts:de}))}),h==="vector"&&je()]}),e.jsxs("div",{className:"p-4 border-t border-stone-700/50 bg-black/20 flex gap-3 mt-auto",children:[e.jsx("button",{onClick:l,className:"flex-1 px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 text-gray-300 hover:text-white rounded-lg transition-all duration-300",children:"取消"}),e.jsx("button",{onClick:fe,className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-semibold rounded-lg transition-all duration-300 shadow-glow-gold",children:"保存设置"})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})})},fy=({isOpen:i,onClose:l,category:r,realtimeMemories:c,smallSummaries:d,largeSummaries:m,vectorConfig:f})=>{const[x,h]=v.useState("realtime"),[g,b]=v.useState([]),[y,S]=v.useState("idle"),[C,A]=v.useState({current:0,total:0}),[E,$]=v.useState(""),[Z,R]=v.useState(!1);v.useEffect(()=>{i&&V()},[i,x,r]);const V=async()=>{S("checking"),$("正在检查向量化状态...");try{await vs.initialize();let k=[];x==="realtime"?k=c.map(Y=>({id:Y.id,title:Y.title,content:Y.content})):x==="small-summary"?k=d.map(Y=>({id:Y.id,title:`小总结 #${Y.id}`,content:Y.content})):k=m.map(Y=>({id:Y.id,title:`大总结 #${Y.id}`,content:Y.content}));const Q=await Promise.all(k.map(async Y=>{const X=await vs.isMemoryVectorized(Y.id);return{...Y,isVectorized:X,selected:!X}}));b(Q),S("idle"),$("");const ne=Q.filter(Y=>!Y.isVectorized);R(ne.length>0&&ne.every(Y=>Y.selected))}catch(k){console.error("加载项目失败:",k),S("error"),$("加载失败: "+(k instanceof Error?k.message:"未知错误"))}},J=k=>{b(Q=>Q.map(ne=>ne.id===k?{...ne,selected:!ne.selected}:ne))},D=()=>{const k=!Z;R(k),b(Q=>Q.map(ne=>({...ne,selected:ne.isVectorized?!1:k})))},T=async()=>{const k=g.filter(Q=>Q.selected&&!Q.isVectorized);if(k.length===0){alert("请至少选择一个未向量化的项目");return}if(!f.enabled){alert("请先在设置中启用向量化功能");return}if(!f.apiKey){alert("请先在设置中配置API密钥");return}S("vectorizing"),A({current:0,total:k.length});try{Gt.updateConfig(f);for(let Q=0;Q<k.length;Q++){const ne=k[Q];A({current:Q+1,total:k.length}),$(`正在向量化 (${Q+1}/${k.length}): ${ne.title}`);try{const Y=await Gt.vectorize(ne.content);let X=null;x==="realtime"?X=c.find(I=>I.id===ne.id):x==="small-summary"?X=d.find(I=>I.id===ne.id):X=m.find(I=>I.id===ne.id);const L={timestamp:(X==null?void 0:X.timestamp)||new Date().toLocaleString("zh-CN"),realTimestamp:(X==null?void 0:X.realTimestamp)||Date.now(),location:X==null?void 0:X.location,involvedCharacters:X==null?void 0:X.involvedCharacters,tags:[x,ne.title]};await vs.saveVector({id:`vec_${ne.id}_${Date.now()}`,memoryId:ne.id,vector:Y,vectorDimension:Y.length,text:ne.content,category:r,created:Date.now(),model:f.model,metadata:L}),b(I=>I.map(K=>K.id===ne.id?{...K,isVectorized:!0,selected:!1}:K)),console.log(`✅ 成功向量化: ${ne.title}`)}catch(Y){if(console.error(`❌ 向量化失败: ${ne.title}`,Y),$(`向量化失败: ${ne.title} - ${Y instanceof Error?Y.message:"未知错误"}`),!confirm(`向量化 "${ne.title}" 时出错，是否继续？
错误: ${Y instanceof Error?Y.message:"未知错误"}`))throw Y}Q<k.length-1&&await new Promise(Y=>setTimeout(Y,300))}S("completed"),$(`✅ 成功向量化 ${k.length} 个项目`),R(!1),setTimeout(()=>{y==="completed"&&(S("idle"),$(""))},3e3)}catch(Q){console.error("批量向量化失败:",Q),S("error"),$("批量向量化失败: "+(Q instanceof Error?Q.message:"未知错误"))}},G=async()=>{const k=g.filter(Q=>!Q.isVectorized);if(k.length===0){alert("所有项目已经向量化");return}confirm(`确定要向量化所有 ${k.length} 个未向量化的项目吗？`)&&(b(Q=>Q.map(ne=>({...ne,selected:!ne.isVectorized}))),R(!0),setTimeout(()=>{T()},100))};if(!i)return null;const _=g.filter(k=>!k.isVectorized).length,M=g.filter(k=>k.isVectorized).length,U=g.filter(k=>k.selected).length;return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/95 via-indigo-900/95 to-purple-900/95 rounded-xl w-full max-w-4xl max-h-[85vh] overflow-hidden border-2 border-purple-400/50 shadow-2xl flex flex-col",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-purple-400/30 bg-black/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-vector-square text-2xl text-purple-300"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-purple-100",children:"向量化管理"}),e.jsxs("p",{className:"text-sm text-purple-300",children:["【",r,"】类别"]})]})]}),e.jsx("button",{onClick:l,disabled:y==="vectorizing",className:"w-10 h-10 rounded-full bg-purple-700/50 hover:bg-purple-600/50 text-purple-200 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-b border-purple-400/30 bg-black/20",children:[e.jsxs("button",{onClick:()=>h("realtime"),disabled:y==="vectorizing",className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${x==="realtime"?"bg-amber-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fa-solid fa-stream"}),e.jsx("span",{children:"实时记录"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:c.length})]}),e.jsxs("button",{onClick:()=>h("small-summary"),disabled:y==="vectorizing",className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${x==="small-summary"?"bg-purple-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fa-solid fa-layer-group"}),e.jsx("span",{children:"小总结"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:d.length})]}),e.jsxs("button",{onClick:()=>h("large-summary"),disabled:y==="vectorizing",className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${x==="large-summary"?"bg-indigo-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("i",{className:"fa-solid fa-book"}),e.jsx("span",{children:"大总结"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:m.length})]})]}),e.jsx("div",{className:"p-4 bg-black/20 border-b border-purple-400/30",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-300",children:g.length}),e.jsx("div",{className:"text-xs text-purple-400",children:"总项目"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:M}),e.jsx("div",{className:"text-xs text-green-500",children:"已向量化"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:_}),e.jsx("div",{className:"text-xs text-yellow-500",children:"未向量化"})]})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto p-4 space-y-2",children:y==="checking"?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-purple-300",children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-4xl mb-4"}),e.jsx("p",{children:"正在检查向量化状态..."})]}):g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-purple-300",children:[e.jsx("i",{className:"fa-solid fa-inbox text-4xl mb-4 opacity-50"}),e.jsx("p",{children:"当前类别没有内容"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-800/30 rounded-lg border border-purple-600/30 mb-3",children:[e.jsx("input",{type:"checkbox",checked:Z,onChange:D,disabled:y==="vectorizing"||_===0,className:"w-5 h-5 cursor-pointer disabled:cursor-not-allowed"}),e.jsxs("span",{className:"text-purple-200 font-semibold",children:["全选未向量化的项目 (",_," 项)"]}),U>0&&e.jsxs("span",{className:"ml-auto px-3 py-1 bg-purple-600 text-white text-sm rounded-full",children:["已选 ",U]})]}),g.map((k,Q)=>e.jsx("div",{className:`p-3 rounded-lg border transition-all ${k.isVectorized?"bg-green-900/20 border-green-600/30":k.selected?"bg-purple-700/30 border-purple-500/50":"bg-purple-900/20 border-purple-700/30 hover:border-purple-600/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:k.selected,onChange:()=>J(k.id),disabled:k.isVectorized||y==="vectorizing",className:"mt-1 w-5 h-5 cursor-pointer disabled:cursor-not-allowed"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-purple-600/30 text-purple-200 text-xs rounded",children:["#",Q+1]}),e.jsx("span",{className:"font-semibold text-purple-100",children:k.title}),k.isVectorized&&e.jsxs("span",{className:"ml-auto px-2 py-0.5 bg-green-600/50 text-green-200 text-xs rounded flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-check"}),"已向量化"]})]}),e.jsx("p",{className:"text-sm text-purple-300 line-clamp-2",children:k.content})]})]})},k.id))]})}),(y==="vectorizing"||y==="completed"||y==="error")&&e.jsxs("div",{className:`p-4 border-t border-purple-400/30 ${y==="error"?"bg-red-900/30":y==="completed"?"bg-green-900/30":"bg-black/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[y==="vectorizing"&&e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-purple-300"}),y==="completed"&&e.jsx("i",{className:"fa-solid fa-check-circle text-green-400"}),y==="error"&&e.jsx("i",{className:"fa-solid fa-exclamation-circle text-red-400"}),e.jsx("span",{className:`text-sm ${y==="error"?"text-red-300":y==="completed"?"text-green-300":"text-purple-300"}`,children:E})]}),y==="vectorizing"&&C.total>0&&e.jsx("div",{className:"w-full bg-purple-900/50 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:`${C.current/C.total*100}%`}})})]}),e.jsxs("div",{className:"p-4 border-t border-purple-400/30 bg-black/20 flex gap-3",children:[e.jsx("button",{onClick:l,disabled:y==="vectorizing",className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:y==="vectorizing"?"向量化中...":"关闭"}),e.jsxs("button",{onClick:G,disabled:y==="vectorizing"||_===0,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-bolt"}),"向量化全部未完成"]}),e.jsxs("button",{onClick:T,disabled:y==="vectorizing"||U===0,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-play"}),"向量化已选 (",U,")"]})]})]})})},hy=({isOpen:i,onClose:l,memories:r,memorySummaries:c})=>{const[d,m]=v.useState([]),[f,x]=v.useState("all"),[h,g]=v.useState("all"),[b,y]=v.useState(!1),[S,C]=v.useState(0),[A,E]=v.useState([]),$=["探索","战斗","商城","医馆","悬赏","培育","商业","声望","公告","大牢","其他"];if(Zi.useEffect(()=>{if(i){const _=[];$.forEach(M=>{r[M].forEach(U=>{_.push({id:U.id,category:M,type:"实时记录",title:U.title,content:U.content,selected:!1})})}),$.forEach(M=>{c[M].small.forEach(U=>{_.push({id:U.id,category:M,type:"小总结",title:U.title,content:U.content,selected:!1})})}),$.forEach(M=>{c[M].large.forEach(U=>{_.push({id:U.id,category:M,type:"大总结",title:U.title,content:U.content,selected:!1})})}),m(_),E([]),C(0)}},[i]),!i)return null;const Z=d.filter(_=>!(f!=="all"&&_.category!==f||h!=="all"&&_.type!==h)),R=Z.filter(_=>_.selected).length,V=_=>{m(M=>M.map(U=>U.id===_?{...U,selected:!U.selected}:U))},J=()=>{const _=Z.every(M=>M.selected);m(M=>M.map(U=>Z.some(k=>k.id===U.id)?{...U,selected:!_}:U))},D=async()=>{const _=d.filter(k=>k.selected);if(_.length===0){alert("请至少选择一个条目进行导出");return}y(!0),C(0),E([]);let M=0,U=0;for(let k=0;k<_.length;k++){const Q=_[k],ne=Math.round((k+1)/_.length*100);C(ne);try{const Y=Q.type==="大总结"?"large":"small";await kf({title:Q.title,content:Q.content},Q.category,Y)?(M++,E(L=>[...L,`✓ 成功导出: ${Q.title}`])):(U++,E(L=>[...L,`✗ 导出失败: ${Q.title}`]))}catch(Y){U++,E(X=>[...X,`✗ 导出错误: ${Q.title} - ${Y.message}`])}k<_.length-1&&await new Promise(Y=>setTimeout(Y,200))}E(k=>[...k,"",`导出完成！成功: ${M}，失败: ${U}`]),y(!1)},T=_=>({探索:"fa-map-location-dot",战斗:"fa-crossed-swords",商城:"fa-store",医馆:"fa-stethoscope",悬赏:"fa-book-skull",培育:"fa-dna",商业:"fa-building",声望:"fa-star",公告:"fa-bullhorn",大牢:"fa-dungeon",其他:"fa-ellipsis"})[_],G=_=>{switch(_){case"实时记录":return"text-amber-300 bg-amber-600/20 border-amber-600/30";case"小总结":return"text-purple-300 bg-purple-600/20 border-purple-600/30";case"大总结":return"text-indigo-300 bg-indigo-600/20 border-indigo-600/30";default:return"text-gray-300 bg-gray-600/20 border-gray-600/30"}};return e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-5xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:_=>_.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-book-bookmark text-2xl text-gradient-gold"}),e.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"批量导出至世界书"})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:e.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]}),e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-stone-700/50 bg-black/10",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"分类:"}),e.jsxs("select",{value:f,onChange:_=>x(_.target.value),className:"px-3 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-sm focus:outline-none focus:border-xianxia-gold-500",children:[e.jsx("option",{value:"all",children:"全部"}),$.map(_=>e.jsx("option",{value:_,children:_},_))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"类型:"}),e.jsxs("select",{value:h,onChange:_=>g(_.target.value),className:"px-3 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-sm focus:outline-none focus:border-xianxia-gold-500",children:[e.jsx("option",{value:"all",children:"全部"}),e.jsx("option",{value:"实时记录",children:"实时记录"}),e.jsx("option",{value:"小总结",children:"小总结"}),e.jsx("option",{value:"大总结",children:"大总结"})]})]}),e.jsx("button",{onClick:J,className:"px-3 py-1 bg-blue-600/80 hover:bg-blue-500/90 text-white text-sm rounded transition-all",children:Z.every(_=>_.selected)?"取消全选":"全选当前"}),e.jsxs("span",{className:"text-sm text-gray-400 ml-auto",children:["已选择: ",e.jsx("span",{className:"text-xianxia-gold-400 font-bold",children:R})," / ",Z.length]})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-4",children:Z.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-inbox text-6xl mb-4 opacity-30"}),e.jsx("p",{className:"text-lg",children:"暂无符合条件的记忆"})]}):e.jsx("div",{className:"space-y-2",children:Z.map(_=>e.jsx("div",{className:`glass-morphism p-3 rounded-lg border transition-all duration-200 cursor-pointer ${_.selected?"border-xianxia-gold-500/70 bg-xianxia-gold-900/20":"border-stone-700/50 hover:border-stone-600"}`,onClick:()=>V(_.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:_.selected,onChange:()=>{},className:"mt-1 w-5 h-5 rounded border-stone-600 bg-stone-700/50 text-xianxia-gold-500 focus:ring-xianxia-gold-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("i",{className:`fa-solid ${T(_.category)} text-sm`}),e.jsx("span",{className:"text-sm text-gray-400",children:_.category}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded border ${G(_.type)}`,children:_.type})]}),e.jsx("h4",{className:"text-white font-semibold mb-1",children:_.title}),e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:_.content})]})]})},_.id))})}),A.length>0&&e.jsx("div",{className:"flex-shrink-0 max-h-32 overflow-y-auto scrollbar-xianxia p-4 bg-black/30 border-t border-stone-700/50",children:e.jsx("div",{className:"space-y-1",children:A.map((_,M)=>e.jsx("div",{className:`text-xs ${_.startsWith("✓")?"text-green-400":_.startsWith("✗")?"text-red-400":"text-gray-400"}`,children:_},M))})}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-400",children:b?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-xianxia-gold-400"}),e.jsxs("span",{children:["导出中... ",S,"%"]}),e.jsx("div",{className:"w-48 h-2 bg-stone-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-xianxia-gold-600 to-xianxia-gold-400 transition-all duration-300",style:{width:`${S}%`}})})]}):e.jsx("span",{children:"将导出到世界书【仙侠卡牌RPG记忆库】"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:l,disabled:b,className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-700 text-gray-300 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"关闭"}),e.jsxs("button",{onClick:D,disabled:b||R===0,className:"px-4 py-2 bg-gradient-to-r from-xianxia-gold-600 to-xianxia-gold-700 hover:from-xianxia-gold-500 hover:to-xianxia-gold-600 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-upload"}),e.jsxs("span",{children:["导出 (",R,")"]})]})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})})},py=({isOpen:i,onClose:l,memories:r,memorySummaries:c,summarySettings:d,onClearCategory:m,onDeleteEntry:f,onDeleteSummary:x,onManualSummary:h,onUpdateSettings:g,gameState:b,onVectorConfigSave:y})=>{const[S,C]=v.useState("探索"),[A,E]=v.useState("realtime"),[$,Z]=v.useState(!1),[R,V]=v.useState(!1),[J,D]=v.useState(1),[T,G]=v.useState(1),[_,M]=v.useState("small"),[U,k]=v.useState(null),[Q,ne]=v.useState(!1),[Y,X]=v.useState(!1),[L,I]=v.useState(!1);if(!i)return null;const K=["探索","战斗","商城","医馆","悬赏","培育","商业","声望","公告","大牢","其他"],fe=r[S],ge=c[S].small,O=c[S].large,se=ye=>({探索:"fa-map-location-dot",战斗:"fa-crossed-swords",商城:"fa-store",医馆:"fa-stethoscope",悬赏:"fa-book-skull",培育:"fa-dna",商业:"fa-building",声望:"fa-star",公告:"fa-bullhorn",大牢:"fa-dungeon",其他:"fa-ellipsis"})[ye],he=()=>{confirm(`确定要清空【${S}】类别的所有实时记忆吗？`)&&m(S)},le=()=>{const ye=A==="realtime"?fe:ge;if(ye.length===0){alert("当前类别没有内容可以总结");return}D(1),G(ye.length),M(A==="realtime"?"small":"large"),V(!0)},xe=()=>{const ye=A==="realtime"?fe:ge;if(J<1||T>ye.length||J>T){alert("请输入有效的范围");return}h(S,J-1,T-1,_),V(!1)},pe=async(ye,ke)=>{const zt=(ke==="small"?ge:O).find(Fe=>Fe.id===ye);if(!zt){alert("未找到要保存的总结");return}k(ye);try{const Fe=await kf({title:zt.title,content:zt.content},S,ke);alert(Fe?"已成功保存到世界书【仙侠卡牌RPG记忆库】！":"保存失败，请查看控制台获取详细信息")}catch(Fe){console.error("保存到世界书时出错:",Fe),alert("保存失败："+Fe.message)}finally{k(null)}},Ae=()=>e.jsx("div",{className:"space-y-4",children:fe.map((ye,ke)=>e.jsx(dy,{entry:ye,index:ke,activeCategory:S,onDeleteEntry:f},ye.id))}),je=(ye,ke)=>e.jsx("div",{className:"space-y-4",children:ye.map((Oe,zt)=>e.jsxs("div",{className:"glass-morphism p-5 rounded-lg border border-purple-700/50 hover:border-purple-500/50 transition-all duration-300 group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:`px-3 py-1 ${ke==="small"?"bg-gradient-to-r from-purple-600/20 to-purple-700/20 text-purple-300 border-purple-600/30":"bg-gradient-to-r from-indigo-600/20 to-indigo-700/20 text-indigo-300 border-indigo-600/30"} text-xs rounded-full border`,children:[ke==="small"?"小总结":"大总结"," #",zt+1]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["基于记忆 ",Oe.startIndex+1," - ",Oe.endIndex+1]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("i",{className:"fa-solid fa-clock"}),Oe.timestamp]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>pe(Oe.id,ke),disabled:U===Oe.id,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-blue-400 hover:text-blue-300 p-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"保存到世界书",children:U===Oe.id?e.jsx("i",{className:"fa-solid fa-spinner fa-spin"}):e.jsx("i",{className:"fa-solid fa-book-bookmark"})}),e.jsx("button",{onClick:()=>x(S,Oe.id,ke),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-red-400 hover:text-red-300 p-2",title:"删除此总结",children:e.jsx("i",{className:"fa-solid fa-trash-alt"})})]})]}),e.jsx("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap bg-gradient-to-br from-purple-900/20 to-indigo-900/20 p-4 rounded border border-purple-700/30",children:Oe.content})]},Oe.id))}),de=()=>A==="realtime"?fe.length>0?Ae():e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[e.jsx("i",{className:`fa-solid ${se(S)} text-6xl mb-4 opacity-30`}),e.jsx("p",{className:"text-lg",children:"此类别暂无记忆"}),e.jsx("p",{className:"text-sm mt-2",children:"在游戏中的各种活动会自动记录在这里"})]}):A==="small-summary"?ge.length>0?je(ge,"small"):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-layer-group text-6xl mb-4 opacity-30"}),e.jsx("p",{className:"text-lg",children:"暂无小总结"}),e.jsx("p",{className:"text-sm mt-2",children:d.autoSummaryEnabled?`每 ${d.smallSummaryInterval} 条记忆会自动生成小总结`:"请在设置中开启自动总结，或使用手动总结功能"})]}):O.length>0?je(O,"large"):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-book text-6xl mb-4 opacity-30"}),e.jsx("p",{className:"text-lg",children:"暂无大总结"}),e.jsx("p",{className:"text-sm mt-2",children:d.autoSummaryEnabled?`每 ${d.largeSummaryInterval} 条小总结会自动生成大总结`:"请在设置中开启自动总结，或使用手动总结功能"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-6xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:ye=>ye.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-book-open text-2xl text-gradient-gold"}),e.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"记忆宝鉴"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-gradient-to-r from-xianxia-gold-600/80 to-xianxia-gold-700/80 hover:from-xianxia-gold-500/90 hover:to-xianxia-gold-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-xianxia-gold-500/50 flex items-center gap-2",title:"批量导出到世界书",children:[e.jsx("i",{className:"fa-solid fa-book-bookmark"}),e.jsx("span",{children:"导出世界书"})]}),e.jsxs("button",{onClick:()=>X(!0),className:"px-4 py-2 bg-gradient-to-r from-indigo-600/80 to-indigo-700/80 hover:from-indigo-500/90 hover:to-indigo-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-indigo-500/50 flex items-center gap-2",title:"管理向量化记忆",children:[e.jsx("i",{className:"fa-solid fa-vector-square"}),e.jsx("span",{children:"向量化"})]}),e.jsxs("button",{onClick:()=>ne(!0),className:"px-4 py-2 bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-500/90 hover:to-purple-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-purple-500/50 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-brain"}),e.jsx("span",{children:"语义搜索"})]}),e.jsxs("button",{onClick:()=>Z(!0),className:"px-4 py-2 bg-gradient-to-r from-blue-600/80 to-blue-700/80 hover:from-blue-500/90 hover:to-blue-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-blue-500/50 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-cog"}),e.jsx("span",{children:"总结设置"})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:e.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]})]}),e.jsx("div",{className:"flex-shrink-0 px-4 py-2 flex space-x-2 border-b border-stone-700 overflow-x-auto scrollbar-xianxia bg-black/10",children:K.map(ye=>{const ke=r[ye].length;return e.jsxs("button",{onClick:()=>C(ye),className:`relative px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 whitespace-nowrap flex items-center gap-2 ${S===ye?"bg-amber-600/30 text-amber-300 border border-amber-500/50 shadow-glow-gold":"bg-transparent text-gray-400 hover:bg-stone-700/50 hover:text-amber-300"}`,children:[e.jsx("i",{className:`fa-solid ${se(ye)}`}),e.jsx("span",{children:ye}),ke>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 bg-amber-600/30 text-amber-300 text-xs rounded-full",children:ke})]},ye)})}),e.jsxs("div",{className:"flex-shrink-0 px-4 py-2 flex space-x-2 border-b border-stone-700/50 bg-black/10",children:[e.jsxs("button",{onClick:()=>E("realtime"),className:`px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 ${A==="realtime"?"bg-gradient-to-r from-amber-600/40 to-amber-700/40 text-amber-300 border border-amber-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-amber-300"}`,children:[e.jsx("i",{className:"fa-solid fa-stream"}),e.jsx("span",{children:"实时记录"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:fe.length})]}),e.jsxs("button",{onClick:()=>E("small-summary"),className:`px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 ${A==="small-summary"?"bg-gradient-to-r from-purple-600/40 to-purple-700/40 text-purple-300 border border-purple-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-purple-300"}`,children:[e.jsx("i",{className:"fa-solid fa-layer-group"}),e.jsx("span",{children:"小总结"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:ge.length})]}),e.jsxs("button",{onClick:()=>E("large-summary"),className:`px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 ${A==="large-summary"?"bg-gradient-to-r from-indigo-600/40 to-indigo-700/40 text-indigo-300 border border-indigo-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-indigo-300"}`,children:[e.jsx("i",{className:"fa-solid fa-book"}),e.jsx("span",{children:"大总结"}),e.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:O.length})]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-6",children:de()}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[A==="realtime"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["共 ",fe.length," 条记忆"]}),d.autoSummaryEnabled&&e.jsxs("span",{className:"text-xs text-purple-400",children:["每 ",d.smallSummaryInterval," 条自动总结"]})]}),A==="small-summary"&&e.jsxs("span",{className:"text-sm text-purple-400",children:["共 ",ge.length," 条小总结"]}),A==="large-summary"&&e.jsxs("span",{className:"text-sm text-indigo-400",children:["共 ",O.length," 条大总结"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(A==="realtime"||A==="small-summary")&&e.jsxs("button",{onClick:le,className:"px-4 py-2 bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-500/90 hover:to-purple-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-purple-500/50 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),e.jsx("span",{children:"手动总结"})]}),A==="realtime"&&fe.length>0&&e.jsxs("button",{onClick:he,className:"px-4 py-2 bg-gradient-to-r from-red-600/80 to-red-700/80 hover:from-red-500/90 hover:to-red-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-red-500/50",children:[e.jsx("i",{className:"fa-solid fa-broom mr-2"}),"清空此类别"]})]})]})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})}),$&&e.jsx(xy,{isOpen:$,onClose:()=>Z(!1),settings:d,onSave:g,gameState:b,onVectorConfigSave:y}),Y&&b&&e.jsx(fy,{isOpen:Y,onClose:()=>X(!1),category:S,realtimeMemories:fe,smallSummaries:ge,largeSummaries:O,vectorConfig:b.vectorConfig}),Q&&b&&e.jsx(uy,{isOpen:Q,onClose:()=>ne(!1),gameState:b,onSaveThreshold:ye=>{y&&y({...b.vectorConfig,similarityThreshold:ye})}}),L&&e.jsx(hy,{isOpen:L,onClose:()=>I(!1),memories:r,memorySummaries:c}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4",onClick:()=>V(!1),children:e.jsxs("div",{className:"bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 rounded-xl p-6 max-w-md w-full border border-purple-500/50 shadow-2xl",onClick:ye=>ye.stopPropagation(),children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-300 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),"手动生成总结"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"总结类型"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M("small"),disabled:A!=="realtime",className:`flex-1 px-4 py-2 rounded-lg transition-all ${_==="small"?"bg-purple-600 text-white":"bg-stone-700/50 text-gray-400 hover:bg-stone-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"小总结"}),e.jsx("button",{onClick:()=>M("large"),disabled:A==="large-summary",className:`flex-1 px-4 py-2 rounded-lg transition-all ${_==="large"?"bg-indigo-600 text-white":"bg-stone-700/50 text-gray-400 hover:bg-stone-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"大总结"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-2",children:["范围 (共 ",A==="realtime"?fe.length:ge.length," 条)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"从第"}),e.jsx("input",{type:"number",min:"1",max:A==="realtime"?fe.length:ge.length,value:J,onChange:ye=>D(Math.max(1,Math.min(A==="realtime"?fe.length:ge.length,parseInt(ye.target.value)||1))),className:"w-full mt-1 px-3 py-2 bg-stone-700/50 border border-stone-600 rounded text-white focus:outline-none focus:border-purple-500"})]}),e.jsx("span",{className:"text-gray-500 mt-5",children:"-"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"到第"}),e.jsx("input",{type:"number",min:"1",max:A==="realtime"?fe.length:ge.length,value:T,onChange:ye=>G(Math.max(1,Math.min(A==="realtime"?fe.length:ge.length,parseInt(ye.target.value)||1))),className:"w-full mt-1 px-3 py-2 bg-stone-700/50 border border-stone-600 rounded text-white focus:outline-none focus:border-purple-500"})]}),e.jsx("span",{className:"text-gray-500 mt-5",children:"条"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>V(!1),className:"flex-1 px-4 py-2 bg-stone-700/50 hover:bg-stone-700 text-gray-300 rounded-lg transition-all",children:"取消"}),e.jsxs("button",{onClick:xe,className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white rounded-lg transition-all flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-check"}),"生成总结"]})]})]})]})})]})},il={enabled:!0,maxResults:5,minSimilarity:.7,depth:0,shouldScan:!0},Pi={manualInject:!1,includeConstant:!1,includeSelective:!1},Ad={useCurrentPreset:!0,extractSystemPrompts:!1},hr={enabled:!0,include:{playerInfo:!0,location:!0,party:!0,battleStatus:!0,reputation:!1},depth:0},gy={style:"detailed",showSimilarity:!0,showTimestamp:!0,showLocation:!0,showCharacters:!0,maxTextLength:void 0},by={style:"compact",includeStats:!1},bd={VECTOR_MEMORY:0,GAME_STATE:1,SYSTEM_PROMPT:2};class yy{async buildContext(l,r){var b,y,S,C,A;const c=Date.now(),d=[];let m=0,f=0,x=!1;if(((b=r.vectorMemory)==null?void 0:b.enabled)!==!1&&l.vectorConfig.enabled){const E={...il,...r.vectorMemory},$=await this.buildVectorMemoryInject(l,r.userInput,E);$&&(d.push($),m=((y=$.metadata)==null?void 0:y.memoryCount)||0)}if(((S=r.gameStateContext)==null?void 0:S.enabled)!==!1){const E={...hr,...r.gameStateContext},$=this.buildGameStateInject(l,E);$&&(d.push($),x=!0)}if((C=r.worldbook)!=null&&C.manualInject){const E={...Pi,...r.worldbook},$=await this.buildWorldbookInject(l,r.userInput,E);$&&(d.push($),f=((A=$.metadata)==null?void 0:A.entryCount)||0)}const h=this.enhanceUserInput(r.userInput,l),g=Date.now()-c;return{injects:d,enhancedUserInput:h,metadata:{vectorMemoryCount:m,worldbookEntriesCount:f,gameStateInjected:x,buildTime:g}}}async buildVectorMemoryInject(l,r,c){try{const d=await Ji.retrieveRelevantMemories(l,r,c.maxResults);if(d.relevantMemories.length===0)return console.log("[上下文构建] 未找到相关向量记忆"),null;const m=this.formatVectorMemories(d.relevantMemories,gy);return console.log(`[上下文构建] 注入 ${d.relevantMemories.length} 条向量记忆`),{id:"vector_memory_context",role:"system",content:m,position:"in_chat",depth:c.depth,order:bd.VECTOR_MEMORY,should_scan:c.shouldScan,metadata:{memoryCount:d.relevantMemories.length}}}catch(d){return console.error("[上下文构建] 向量记忆检索失败:",d),null}}buildGameStateInject(l,r){try{const c=this.formatGameState(l,r,by);return c?(console.log("[上下文构建] 注入游戏状态上下文"),{id:"game_state_context",role:"system",content:c,position:"in_chat",depth:r.depth,order:bd.GAME_STATE,should_scan:!0}):null}catch(c){return console.error("[上下文构建] 游戏状态构建失败:",c),null}}async buildWorldbookInject(l,r,c){if(typeof TavernHelper>"u")return null;try{const d=c.worldbookNames||TavernHelper.getWorldbookNames();if(d.length===0)return null;const m=[];for(const f of d)try{const x=await TavernHelper.getWorldbook(f);for(const h of x)if(h.enabled&&(c.includeConstant&&h.strategy.type==="constant"&&m.push(`【${h.name}】
${h.content}`),c.includeSelective&&h.strategy.type==="selective")){const g=h.strategy.keys||[],b=r.toLowerCase();for(const y of g)if(typeof y=="string"&&b.includes(y.toLowerCase())){m.push(`【${h.name}】
${h.content}`);break}}}catch(x){console.warn(`[上下文构建] 无法读取世界书 ${f}:`,x)}return m.length===0?null:(console.log(`[上下文构建] 手动注入 ${m.length} 条世界书条目`),{id:"worldbook_manual_inject",role:"system",content:`=== 世界书信息 ===

${m.join(`

`)}

===================`,position:"in_chat",depth:1,order:bd.SYSTEM_PROMPT,should_scan:!1,metadata:{entryCount:m.length}})}catch(d){return console.error("[上下文构建] 世界书构建失败:",d),null}}formatVectorMemories(l,r){var d;if(l.length===0)return"";const c=[];if(r.style==="detailed"){c.push("=== 相关历史记忆 ==="),c.push("");for(const m of l){const f=m.memory;c.push(`【记忆 #${m.rank}】`),r.showTimestamp&&f.metadata.timestamp&&c.push(`时间：${f.metadata.timestamp}`),r.showLocation&&f.metadata.location&&c.push(`地点：${f.metadata.location}`),r.showCharacters&&((d=f.metadata.involvedCharacters)!=null&&d.length)&&c.push(`角色：${f.metadata.involvedCharacters.join("、")}`),r.showSimilarity&&c.push(`相关度：${(m.similarity*100).toFixed(1)}%`),c.push("");let x=f.text;r.maxTextLength&&x.length>r.maxTextLength&&(x=x.substring(0,r.maxTextLength)+"..."),c.push(x),c.push("")}c.push("===================")}else if(r.style==="compact"){c.push("=== 相关记忆 ===");for(const m of l){let f=m.memory.text;r.maxTextLength&&f.length>r.maxTextLength&&(f=f.substring(0,r.maxTextLength)+"...");const x=r.showSimilarity?` [${(m.similarity*100).toFixed(0)}%]`:"";c.push(`• ${f}${x}`)}c.push("===============")}else if(r.style==="list")for(const m of l){let f=m.memory.text;r.maxTextLength&&f.length>r.maxTextLength&&(f=f.substring(0,r.maxTextLength)+"..."),c.push(f)}return c.join(`
`)}formatGameState(l,r,c){const d=[];if((c.style==="full"||c.style==="compact")&&(d.push("=== 当前游戏状态 ==="),d.push("")),r.include.playerInfo&&(d.push(`【玩家】${l.playerProfile.name}`),l.playerProfile.title&&d.push(`称号：${l.playerProfile.title}`),c.includeStats&&d.push(`灵石：${l.playerProfile.spiritStones}`),d.push("")),r.include.location&&(d.push(`【位置】${l.exploration.location}`),d.push(`【时间】${l.exploration.time}`),d.push("")),r.include.party){const m=[...l.playerProfile.maleParty,...l.playerProfile.femaleParty];if(m.length>0){d.push("【当前队伍】");for(const f of m)c.style==="full"?d.push(`  • ${f.name} (${f.realm}) - 生命:${f.baseAttributes.hp}/${f.baseAttributes.maxHp}`):d.push(`  • ${f.name} (${f.realm})`);d.push("")}}if(r.include.battleStatus&&l.mode==="battle"&&l.battle&&(d.push("【战斗状态】"),d.push(`己方：${l.battle.playerParty.map(m=>m.card.name).join("、")}`),d.push(`敌方：${l.battle.opponentParty.map(m=>m.card.name).join("、")}`),d.push(`回合：${l.battle.turn==="player"?"玩家回合":"对手回合"}`),d.push("")),r.include.reputation&&c.style==="full"){const m=l.playerProfile.reputation;d.push(`【声望】${m.level} (${m.score})`),m.title&&d.push(`当前称号：${m.title}`),d.push("")}return(c.style==="full"||c.style==="compact")&&d.push("==================="),d.join(`
`)}enhanceUserInput(l,r){const c=[];return r.mode==="battle"?c.push("请基于当前战斗情况生成内容"):c.push("请基于当前探索情况生成内容"),r.vectorConfig.enabled&&c.push("请确保内容与上述历史记忆保持一致"),c.length===0?l:`${l}

（${c.join("，")}）`}validateInjects(l){const r=[];for(const c of l)c.id||r.push("注入提示词缺少ID"),c.content||r.push(`注入提示词 ${c.id} 内容为空`),["system","user","assistant"].includes(c.role)||r.push(`注入提示词 ${c.id} 角色无效: ${c.role}`),c.position==="in_chat"&&c.depth===void 0&&r.push(`注入提示词 ${c.id} 使用in_chat位置但未指定深度`);return{valid:r.length===0,errors:r}}}const Ix=new yy;class vy{async generate(l,r){if(typeof TavernHelper>"u")throw new Error("TavernHelper未定义，无法使用AI生成功能");console.log("[AI生成] 开始生成，用户输入:",r.userInput);try{const c=await Ix.buildContext(l,r);console.log("[AI生成] 上下文构建完成:",{注入数量:c.injects.length,向量记忆:c.metadata.vectorMemoryCount,世界书条目:c.metadata.worldbookEntriesCount,游戏状态:c.metadata.gameStateInjected?"是":"否",构建耗时:`${c.metadata.buildTime}ms`});const d=Ix.validateInjects(c.injects);if(!d.valid)throw console.error("[AI生成] 注入验证失败:",d.errors),new Error(`注入验证失败: ${d.errors.join(", ")}`);const m={user_input:c.enhancedUserInput,should_stream:r.shouldStream||!1,max_chat_history:r.maxChatHistory||"all"};c.injects.length>0&&(m.injects=c.injects.map(x=>({id:x.id,role:x.role,content:x.content,position:x.position,depth:x.depth,order:x.order,should_scan:x.should_scan}))),r.customApi&&(m.custom_api=r.customApi),r.generationId&&(m.generation_id=r.generationId),console.log("[AI生成] 调用TavernHelper.generate...");const f=await TavernHelper.generate(m);return console.log("[AI生成] 生成完成，长度:",f.length),f}catch(c){throw console.error("[AI生成] 生成失败:",c),c}}async quickGenerate(l,r,c={}){const d={userInput:r,shouldStream:c.shouldStream,vectorMemory:c.enableVectorMemory!==!1?il:{...il,enabled:!1},gameStateContext:c.enableGameState!==!1?hr:{...hr,enabled:!1},worldbook:Pi,preset:Ad};return this.generate(l,d)}async generateWithPresetOnly(l,r={}){if(typeof TavernHelper>"u")throw new Error("TavernHelper未定义");console.log("[AI生成] 仅使用预设生成");const c={user_input:l,should_stream:r.shouldStream||!1,max_chat_history:r.maxChatHistory||"all"};return r.customApi&&(c.custom_api=r.customApi),await TavernHelper.generate(c)}async batchGenerate(l,r,c={}){const d=[];for(const m of r)try{const f={...c,userInput:m},x=await this.generate(l,f);d.push(x)}catch(f){console.error(`[AI生成] 批量生成失败，提示词: ${m}`,f),d.push("")}return d}async stopGeneration(l){if(typeof TavernHelper>"u"||typeof stopGenerationById>"u")return console.warn("[AI生成] 停止生成功能不可用"),!1;try{return await stopGenerationById(l)}catch(r){return console.error("[AI生成] 停止生成失败:",r),!1}}async stopAllGenerations(){if(typeof TavernHelper>"u"||typeof stopAllGeneration>"u")return console.warn("[AI生成] 停止所有生成功能不可用"),!1;try{return await stopAllGeneration()}catch(l){return console.error("[AI生成] 停止所有生成失败:",l),!1}}onGenerationEvent(l,r){if(typeof eventOn>"u"||typeof iframe_events>"u")return console.warn("[AI生成] 事件系统不可用"),()=>{};let c;switch(l){case"started":c=iframe_events.GENERATION_STARTED;break;case"streaming":c=iframe_events.STREAM_TOKEN_RECEIVED_FULLY;break;case"completed":c=iframe_events.GENERATION_ENDED;break;default:return console.warn(`[AI生成] 未知事件类型: ${l}`),()=>{}}const d=m=>{r({type:l,generationId:m.generation_id||"",text:m.text||m,metadata:m})};return eventOn(c,d),()=>{console.log("[AI生成] 事件监听器移除（如果支持）")}}isAvailable(){return typeof TavernHelper<"u"&&typeof TavernHelper.generate=="function"}getCurrentPresetInfo(){if(typeof TavernHelper>"u")return null;try{return TavernHelper.getPreset("in_use")}catch(l){return console.error("[AI生成] 获取预设失败:",l),null}}async switchPreset(l){if(typeof TavernHelper>"u")return!1;try{return TavernHelper.loadPreset(l)}catch(r){return console.error("[AI生成] 切换预设失败:",r),!1}}getAvailablePresets(){if(typeof TavernHelper>"u")return[];try{return TavernHelper.getPresetNames()}catch(l){return console.error("[AI生成] 获取预设列表失败:",l),[]}}}const mr=new vy;class jy{async generateWithEnhancedContext(l,r,c={}){console.log("[AI增强V2] 开始生成，选项:",c);const d={userInput:r,shouldStream:c.shouldStream,vectorMemory:c.includeVectorMemories!==!1?{...il,maxResults:c.maxVectorResults||il.maxResults,categories:c.categories}:{...il,enabled:!1},worldbook:c.includeWorldbook!==!1?Pi:{...Pi,manualInject:!1},preset:c.includePreset!==!1?Ad:{...Ad,useCurrentPreset:!1},gameStateContext:c.includeGameState!==!1?hr:{...hr,enabled:!1},customApi:c.customApi};return await mr.generate(l,d)}async generateWithCustomAPI(l,r,c,d={}){return this.generateWithEnhancedContext(l,r,{...d,customApi:c,includePreset:!1,includeWorldbook:!1})}async quickGenerate(l,r,c=!1){return mr.quickGenerate(l,r,{enableVectorMemory:!0,enableGameState:!0,shouldStream:c})}async generateWithVectorOnly(l,r,c=5){return this.generateWithEnhancedContext(l,r,{includeVectorMemories:!0,includeGameState:!1,maxVectorResults:c})}async generateByCategory(l,r,c,d=5){return this.generateWithEnhancedContext(l,r,{includeVectorMemories:!0,categories:c,maxVectorResults:d})}isAvailable(){return mr.isAvailable()}getCurrentPreset(){return mr.getCurrentPresetInfo()}onGeneration(l,r){return mr.onGenerationEvent(l,r)}}const Ny=new jy,wy={探索:["探索","发现","前往","到达","离开","进入","出发","地图","位置","区域","场景","奇遇","随机事件","遇见","路过","寻找","搜索","调查"],战斗:["战斗","攻击","防御","技能","释放","造成","受到","伤害","击败","胜利","失败","敌人","怪物","对手","竞技场","对决","挑战","回合","排行榜","榜单","排名","积分"],商城:["商城","抽卡","抽取","招募","购买","卡池","人物卡牌","装备","通用技能","兽宠","同人","灵感","召唤","天机","万象寻仙","百炼阁","万法楼","御兽斋","异界降临","神兵天成","大道顿悟","灵兽创生","法宝","防具","功法","灵兽","契约","锻造","领悟","创造"],医馆:["医馆","问诊","诊断","治疗","医治","症状","病情","药物","处方","康复","伤势","疾病","患者","病历","走火入魔"],悬赏:["悬赏","任务","委托","接取","完成","奖励","目标","追捕","调查","赏金","猎人","追踪","线索","千乳圣女"],培育:["培育","修炼","突破","提升","境界","灵力","功法","炼丹","炼器","成长","进阶","繁殖","孕育","育灵轩","监测","配种","后代"],商业:["商业","交易","出售","价格","灵石","商店","商人","买卖","交换","货物","店铺","收入","员工","经营","生意","青楼","角斗场","炼丹房","拍卖行","情报阁","监视","头牌","角斗士","奴隶"],声望:["声望","名声","威望","名气","事迹","名望","江湖","传闻","称号","侠义","恶行","风流","天机阁"],公告:["公告","宗门","世界","奇遇","通知","消息","天元","惊蛰","宗门排行","野榜","区域榜","世界榜"],大牢:["大牢","监狱","囚犯","审讯","刑法","狱卒","牢房","劳役","囚禁","关押","拷问","禁闭","越狱","赎金"],其他:[]},qx={exploration:"探索",map:"探索",battle:"战斗",arena:"战斗",shop:"商城",gacha:"商城",hospital:"医馆",consultation:"医馆",bounty:"悬赏",cultivation:"培育",business:"商业",surveillance:"商业",reputation:"声望",announcement:"公告",telepathy:"其他",interaction:"其他",party:"其他",inventory:"其他"};class Sy{constructor(){this.currentScene="unknown",this.isEnabled=!0,this.eventListenersRegistered=!1}setMessageCallback(l){this.onMessageCallback=l}setCurrentScene(l){this.currentScene=l}setEnabled(l){this.isEnabled=l}categorizeMessage(l,r){if(r&&qx[r])return qx[r];let c=0,d="其他";for(const[m,f]of Object.entries(wy)){if(f.length===0)continue;let x=0;for(const h of f)l.includes(h)&&x++;x>c&&(c=x,d=m)}return d}handleCapturedMessage(l){if(!this.isEnabled||!this.onMessageCallback)return;const r=this.categorizeMessage(l.content,l.scene||this.currentScene);this.onMessageCallback(l,r)}registerEventListeners(){if(this.eventListenersRegistered){console.log("[AI消息捕获] 事件监听器已注册");return}if(typeof window>"u"||!window.eventOn){console.warn("[AI消息捕获] 未检测到SillyTavern环境，无法注册事件监听器");return}const l=window.eventOn,r=window.tavern_events,c=window.iframe_events;console.log("[AI消息捕获] 开始注册事件监听器..."),l(r.MESSAGE_RECEIVED,(d,m)=>{console.log(`[AI消息捕获] 接收到消息 #${d}, 类型: ${m||"unknown"}`);try{const f=window.getChatMessages;if(f){const x=f(-1);if(x&&x.length>0){const h=x[0];h.role==="assistant"&&this.handleCapturedMessage({content:h.message,timestamp:new Date().toISOString(),source:"ai",messageId:d,scene:this.currentScene})}}}catch(f){console.error("[AI消息捕获] 处理MESSAGE_RECEIVED事件时出错:",f)}}),l(r.GENERATION_ENDED,d=>{console.log(`[AI消息捕获] 生成结束 #${d}`)}),c&&c.GENERATION_ENDED&&l(c.GENERATION_ENDED,(d,m)=>{console.log(`[AI消息捕获] Iframe生成结束, ID: ${m}`),d&&d.trim()&&this.handleCapturedMessage({content:d,timestamp:new Date().toISOString(),source:"ai",scene:this.currentScene})}),this.eventListenersRegistered=!0,console.log("[AI消息捕获] 事件监听器注册完成")}captureMessage(l,r){this.handleCapturedMessage({content:l,timestamp:new Date().toISOString(),source:"ai",scene:r||this.currentScene})}cleanup(){typeof window<"u"&&window.eventClearAll&&console.log("[AI消息捕获] 清理事件监听器"),this.eventListenersRegistered=!1}}const st=new Sy;async function ky(i){console.log("[榜单生成] 开始AI生成竞技场榜单..."),st.setCurrentScene("arena");try{const l=`你是一个修仙世界的竞技场榜单生成器。请根据当前游戏状态，生成真实、合理且有趣的竞技场排行榜。

要求：
1. 生成4个不同的榜单：宗门排行榜、野榜、区域榜、世界榜
2. 宗门排行榜包含5个子榜：总榜、核心弟子、内门弟子、外门弟子、杂役弟子
3. 每个榜单生成10-20个条目
4. 角色名字要符合修仙风格，富有想象力
5. 门派名称要多样化且符合修仙设定
6. 积分要合理分布，排名越高积分越高
7. 玩家当前排名：${i.playerProfile.arenaRank.tier} ${i.playerProfile.arenaRank.division}，积分：${i.playerProfile.arenaRank.points}

请生成JSON格式的榜单数据。`,r=`请生成完整的竞技场榜单数据。返回格式：
{
  "宗门排行榜": {
    "总榜": [{"rank": 1, "name": "角色名", "faction": "门派名", "points": 积分, "characterId": "id"}],
    "核心弟子": [...],
    "内门弟子": [...],
    "外门弟子": [...],
    "杂役弟子": [...]
  },
  "野榜": [...],
  "区域榜": [...],
  "世界榜": [...]
}

请确保：
- 每个榜单至少10个条目
- rank从1开始连续递增
- points按排名递减
- name和faction富有创意
- characterId使用"arena-npc-{随机数}"格式`;console.log("[榜单生成] 调用AI生成服务...");const c=await Ny.generateWithEnhancedContext(i,r,{includeVectorMemories:!0,includePreset:!0,includeWorldbook:!0,includeGameState:!0,maxVectorResults:3,categories:["战斗","公告","声望"]});console.log("[榜单生成] AI响应长度:",c.length),console.log("[榜单生成] AI响应内容:",c.substring(0,500)),st.captureMessage(c,"arena");let d;try{const f=(c.match(/```json\s*([\s\S]*?)\s*```/)||c.match(/```\s*([\s\S]*?)\s*```/)||[null,c])[1]||c;d=JSON.parse(f.trim()),console.log("[榜单生成] 成功解析AI生成的榜单")}catch(m){console.error("[榜单生成] JSON解析失败，使用默认榜单:",m),d=Gx(i)}return d=Cy(d,i),console.log("[榜单生成] 榜单生成完成"),d}catch(l){return console.error("[榜单生成] AI生成失败:",l),console.log("[榜单生成] 使用默认榜单作为降级方案"),Gx()}}function Cy(i,l){const r={宗门排行榜:{总榜:[],核心弟子:[],内门弟子:[],外门弟子:[],杂役弟子:[]},野榜:[],区域榜:[],世界榜:[]};if(i.宗门排行榜){const c=i.宗门排行榜;r.宗门排行榜.总榜=$a(c.总榜||[]),r.宗门排行榜.核心弟子=$a(c.核心弟子||[]),r.宗门排行榜.内门弟子=$a(c.内门弟子||[]),r.宗门排行榜.外门弟子=$a(c.外门弟子||[]),r.宗门排行榜.杂役弟子=$a(c.杂役弟子||[])}return r.野榜=$a(i.野榜||[]),r.区域榜=$a(i.区域榜||[]),r.世界榜=$a(i.世界榜||[]),r}function $a(i){return Array.isArray(i)?i.filter(l=>l&&typeof l=="object").map((l,r)=>({rank:typeof l.rank=="number"?l.rank:r+1,name:String(l.name||`修士${r+1}`),faction:String(l.faction||"散修"),points:typeof l.points=="number"?l.points:1e3-r*10,characterId:String(l.characterId||`arena-npc-${Date.now()}-${r}`)})).sort((l,r)=>l.rank-r.rank):[]}function Gx(i){console.log("[榜单生成] 生成默认榜单...");const l=["天元宗","玄天派","灵霄殿","百花谷","剑宗","药王谷","魔音宗","雷霆阁"],r=["剑心","云澈","月华","星辰","风行","雷动","冰心","火烈","木灵","水柔","金刚","土厚","天机","地灵","人杰","鬼才","龙吟","凤鸣","虎啸","豹影","熊霸","鹰扬","蛇行","鹤舞"],c=(d,m)=>{const f=[];for(let x=0;x<d;x++)f.push({rank:x+1,name:r[Math.floor(Math.random()*r.length)]+["真人","仙子","道人","上人","尊者"][Math.floor(Math.random()*5)],faction:l[Math.floor(Math.random()*l.length)],points:m-x*Math.floor(Math.random()*50+20),characterId:`arena-npc-${Date.now()}-${x}`});return f};return{宗门排行榜:{总榜:c(15,5e3),核心弟子:c(12,4500),内门弟子:c(12,3500),外门弟子:c(12,2500),杂役弟子:c(10,1500)},野榜:c(15,4800),区域榜:c(15,4600),世界榜:c(20,6e3)}}const Ey=({data:i})=>e.jsx("div",{className:"w-full h-full",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-300 table-fixed",children:[e.jsx("thead",{className:"text-xs text-amber-400 uppercase bg-slate-700/50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"p-3 w-16 text-center",children:"排名"}),e.jsx("th",{scope:"col",className:"p-3 w-2/5",children:"修士名号"}),e.jsx("th",{scope:"col",className:"p-3 w-2/5",children:"所属势力"}),e.jsx("th",{scope:"col",className:"p-3 w-1/5 text-right",children:"积分"})]})}),e.jsx("tbody",{children:i.map(l=>e.jsxs("tr",{className:"border-b border-slate-700/50 hover:bg-slate-800/40",children:[e.jsx("td",{className:"p-3 font-medium text-center",children:l.rank===1?"🥇":l.rank===2?"🥈":l.rank===3?"🥉":l.rank}),e.jsx("td",{className:"p-3 font-semibold text-white truncate",children:l.name}),e.jsx("td",{className:"p-3 truncate",children:l.faction}),e.jsx("td",{className:"p-3 font-mono text-right",children:l.points})]},l.rank))})]})}),Vx=({label:i,isActive:l,onClick:r,isSubTab:c})=>e.jsx("button",{onClick:r,className:`px-4 transition-colors duration-200 font-semibold ${c?`py-1 text-sm rounded-md ${l?"bg-amber-600/80 text-white":"bg-stone-700/60 text-gray-300 hover:bg-stone-700"}`:`py-2 text-base rounded-t-lg ${l?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50 hover:text-gray-200"}`}`,children:i}),My=({playerProfile:i,leaderboards:l,onMatchFound:r,gameState:c,onLeaderboardsUpdate:d})=>{const[m,f]=v.useState("宗门排行榜"),[x,h]=v.useState("总榜"),[g,b]=v.useState(!1),[y,S]=v.useState(!1),C=i.arenaRank,A=l,E=()=>m==="宗门排行榜"?A[m][x]:A[m],$=()=>{b(!0),setTimeout(()=>{const R=ys.filter(D=>D.id!==i.name),J={...R[Math.floor(Math.random()*R.length)],id:`arena-opponent-${Date.now()}`};r(J)},2500)},Z=async()=>{S(!0);try{console.log("[竞技场] 开始AI生成榜单...");const R=await ky(c);d(R),console.log("[竞技场] 榜单刷新完成")}catch(R){console.error("[竞技场] 榜单刷新失败:",R),alert("榜单刷新失败，请查看控制台了解详情")}finally{S(!1)}};return e.jsxs("div",{className:"h-full flex flex-col md:flex-row font-serif text-gray-300 p-4 gap-4",children:[e.jsxs("div",{className:"flex-shrink-0 md:w-1/3 bg-black/20 p-6 rounded-lg flex flex-col items-center justify-center text-center border border-stone-700/50",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"我的战绩"}),e.jsx("div",{className:"text-6xl mb-4",children:C.tierIcon}),e.jsxs("p",{className:"text-3xl font-bold text-amber-400",children:[C.tier," ",C.division]}),e.jsxs("p",{className:"text-lg text-gray-400 mt-2",children:[C.points," 积分"]}),e.jsx("button",{onClick:$,disabled:g,className:"mt-8 bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-500 transition-colors shadow-lg w-40 h-14 flex items-center justify-center disabled:bg-red-800 disabled:cursor-wait",children:g?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-3"}),"匹配中..."]}):"寻找对战"})]}),e.jsxs("div",{className:"flex-grow bg-black/20 p-4 rounded-lg border border-stone-700/50 flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 border-b border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"flex space-x-2",children:Object.keys(A).map(R=>e.jsx(Vx,{label:R,isActive:m===R,onClick:()=>f(R)},R))}),e.jsxs("button",{onClick:Z,disabled:y,className:"px-4 py-2 bg-amber-600/80 hover:bg-amber-600 text-white font-semibold rounded-lg transition-colors disabled:bg-gray-600 disabled:cursor-wait flex items-center gap-2",title:"AI生成新的榜单",children:[e.jsx("i",{className:`fa-solid fa-rotate ${y?"fa-spin":""}`}),y?"生成中...":"刷新榜单"]})]}),m==="宗门排行榜"&&e.jsx("div",{className:"px-2 py-2 flex space-x-2",children:Object.keys(A.宗门排行榜).map(R=>e.jsx(Vx,{label:R,isActive:x===R,onClick:()=>h(R),isSubTab:!0},R))})]}),e.jsx("div",{className:"flex-grow overflow-y-auto mt-2",children:e.jsx(Ey,{data:E()})})]})]})},Ay=i=>({attack:"攻击",defense:"防御",hp:"气血",speed:"速度",critRate:"会心率",critDmg:"会心伤害"})[i]||i,Ty=(i,l)=>i==="critRate"||i==="critDmg"?`+${(l*100).toFixed(0)}%`:l>0?`+${l}`:`${l}`,$y=({item:i,onClose:l})=>{const r=!i.genderLock||i.genderLock==="Universal"?"通用":i.genderLock==="Male"?"男性专用":"女性专用";return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20",children:[e.jsxs("h2",{className:"text-xl font-bold text-white font-serif flex items-baseline gap-2",children:[e.jsx("span",{children:i.name}),e.jsxs("span",{className:`text-base font-medium ${Me(i.rarity)}`,children:["[",i.rarity,"]"]})]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"p-6 font-serif",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-400",children:"法宝详情"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-base text-gray-400",children:i.type}),e.jsx("p",{className:"text-sm text-gray-400",children:r})]})]}),e.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50 mb-4",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-2 text-sm",children:"属性"}),e.jsx("div",{className:"space-y-1",children:Object.entries(i.stats).map(([c,d])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-300",children:Ay(c)}),e.jsx("span",{className:"font-mono text-green-400",children:Ty(c,d)})]},c))})]}),e.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"描述"}),e.jsx("p",{className:"text-gray-300 leading-relaxed text-sm italic",children:i.description})]})]})]})})},Ot=({label:i,isActive:l,onClick:r})=>e.jsx("button",{onClick:r,className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${l?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50 hover:text-gray-200"}`,children:i}),Da=({label:i,isActive:l,onClick:r})=>e.jsx("button",{onClick:r,className:`px-3 py-1 text-xs rounded-full transition-colors ${l?"bg-amber-600 text-white":"bg-stone-600 hover:bg-stone-500 text-gray-300"}`,children:i}),Dy=({card:i})=>e.jsxs("div",{className:`p-3 rounded-lg border-2 text-center h-full ${At(i.rarity)} ${pr(i.rarity,!1)}`,children:[e.jsx("p",{className:"font-bold font-serif text-white",children:i.name}),e.jsx("p",{className:`text-xs font-semibold ${Me(i.rarity)}`,children:i.realm}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:i.title})]}),Rd=({gender:i})=>{if(!i||i==="Universal")return null;const l=i==="Male"?"♂":"♀",r=i==="Male"?"text-sky-400":"text-pink-400";return e.jsx("div",{className:`absolute top-1 right-1 w-5 h-5 rounded-full bg-black/50 flex items-center justify-center font-bold ${r}`,children:l})},_y=({skill:i})=>e.jsxs("div",{className:`relative p-3 rounded-lg border-2 h-full ${At(i.rarity)} ${pr(i.rarity,!1)}`,children:[e.jsx(Rd,{gender:i.genderLock}),e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("h5",{className:`font-bold ${Me(i.rarity)}`,children:i.name}),e.jsxs("span",{className:"text-sm font-mono text-blue-400",children:[i.cost," 真元"]})]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1 line-clamp-2",children:i.description})]}),Oy=({item:i})=>e.jsxs("div",{className:`relative p-3 rounded-lg border-2 h-full ${At(i.rarity)} ${pr(i.rarity,!1)}`,children:[e.jsx(Rd,{gender:i.genderLock}),e.jsx("h5",{className:`font-bold truncate ${Me(i.rarity)}`,children:i.name}),e.jsx("div",{className:"text-xs text-gray-300 mt-1 space-y-0.5",children:Object.entries(i.stats).map(([l,r])=>e.jsxs("p",{children:[l,": ",e.jsxs("span",{className:"text-green-400",children:["+",r]})]},l))})]}),zy=({card:i})=>e.jsxs("div",{className:`relative p-3 rounded-lg border-2 text-center h-full ${At(i.rarity)} ${pr(i.rarity,!1)}`,children:[e.jsx(Rd,{gender:i.gender}),e.jsx("p",{className:"font-bold font-serif text-white",children:i.name}),e.jsxs("p",{className:`text-xs font-semibold ${Me(i.rarity)}`,children:["[",i.rarity,"]"]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 truncate",children:i.description})]}),Ry=({playerProfile:i,setPlayerProfile:l,onViewPet:r})=>{const[c,d]=v.useState("图鉴"),[m,f]=v.useState("男性角色"),[x,h]=v.useState("武器"),[g,b]=v.useState("雄性"),[y,S]=v.useState("All"),[C,A]=v.useState("男性专用"),[E,$]=v.useState(null),[Z,R]=v.useState(null),[V,J]=v.useState(null),[D,T]=v.useState("default"),[G,_]=v.useState("default"),[M,U]=v.useState(!1),[k,Q]=v.useState(null),[ne,Y]=v.useState(null),X=["神品","圣品","仙品","绝品","珍品","优品","良品","凡品"],L=()=>{if(!k)return;Y(null);const K=i.maleParty.some(se=>se.id===k.id),fe=i.femaleParty.some(se=>se.id===k.id);if(K||fe){Y("无法出售上阵中的角色卡！"),setTimeout(()=>Y(null),3e3),Q(null);return}const ge=un[k.rarity]||0,O={...i,spiritStones:i.spiritStones+ge,cardCollection:i.cardCollection.filter(se=>se.id!==k.id)};l(O),Q(null)},I=()=>{switch(c){case"图鉴":const K=[...i.cardCollection].filter(xe=>xe.gender===(m==="男性角色"?"Male":"Female")).sort((xe,pe)=>D==="rarity"?X.indexOf(xe.rarity)-X.indexOf(pe.rarity):0);return e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ot,{label:"男性角色",isActive:m==="男性角色",onClick:()=>f("男性角色")}),e.jsx(Ot,{label:"女性角色",isActive:m==="女性角色",onClick:()=>f("女性角色")})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("span",{children:"排序:"}),e.jsx(Da,{label:"默认",isActive:D==="default",onClick:()=>T("default")}),e.jsx(Da,{label:"稀有度",isActive:D==="rarity",onClick:()=>T("rarity")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-sm font-semibold transition-colors ${M?"text-red-400":"text-gray-400"}`,children:"出售模式"}),e.jsx("button",{onClick:()=>U(!M),className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors ${M?"bg-red-600":"bg-stone-600"}`,children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform ${M?"translate-x-6":"translate-x-1"}`})})]})]})]}),e.jsx("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:K.map(xe=>e.jsxs("button",{onClick:()=>M?Q(xe):$(xe),className:"relative text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:[e.jsx(Dy,{card:xe}),M&&e.jsx("div",{className:"absolute inset-0 bg-red-800/60 flex items-center justify-center rounded-lg cursor-pointer",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"出售"})})]},xe.id))})]});case"通用技能库":const fe={男性专用:"Male",女性专用:"Female",通用:"Universal"},ge=i.universalSkills.filter(xe=>xe.genderLock===fe[C]),O=ge.reduce((xe,pe)=>((xe[pe.rarity]=xe[pe.rarity]||[]).push(pe),xe),{});return e.jsxs("div",{children:[e.jsx("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ot,{label:"男性专用",isActive:C==="男性专用",onClick:()=>A("男性专用")}),e.jsx(Ot,{label:"女性专用",isActive:C==="女性专用",onClick:()=>A("女性专用")}),e.jsx(Ot,{label:"通用",isActive:C==="通用",onClick:()=>A("通用")})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[X.map(xe=>O[xe]&&O[xe].length>0?e.jsxs("div",{children:[e.jsxs("h4",{className:`font-semibold mb-2 text-lg ${Me(xe)}`,children:["【",xe,"】"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:O[xe].map(pe=>e.jsx("button",{onClick:()=>R(pe),className:"text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:e.jsx(_y,{skill:pe})},pe.id))})]},xe):null),ge.length===0&&e.jsx("div",{className:"text-center text-gray-500 pt-10",children:e.jsx("p",{children:"该分类下暂无技能。"})})]})]});case"装备库":const se={武器:"Weapon",衣服:"Armor",饰品:"Accessory"},he=i.equipmentInventory.filter(xe=>xe.type===se[x]).filter(xe=>y==="All"?!0:y==="Universal"?!xe.genderLock||xe.genderLock==="Universal":xe.genderLock===y).sort((xe,pe)=>G==="rarity"?X.indexOf(xe.rarity)-X.indexOf(pe.rarity):0);return e.jsxs("div",{children:[e.jsxs("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ot,{label:"武器",isActive:x==="武器",onClick:()=>{h("武器"),S("All")}}),e.jsx(Ot,{label:"衣服",isActive:x==="衣服",onClick:()=>{h("衣服"),S("All")}}),e.jsx(Ot,{label:"饰品",isActive:x==="饰品",onClick:()=>{h("饰品"),S("All")}})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("span",{children:"排序:"}),e.jsx(Da,{label:"默认",isActive:G==="default",onClick:()=>_("default")}),e.jsx(Da,{label:"稀有度",isActive:G==="rarity",onClick:()=>_("rarity")})]})]}),e.jsxs("div",{className:"px-4 py-2 flex items-center gap-3 bg-stone-800/50 border-b border-stone-700",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-400",children:"筛选:"}),e.jsx(Da,{label:"全部",isActive:y==="All",onClick:()=>S("All")}),e.jsx(Da,{label:"男性专用",isActive:y==="Male",onClick:()=>S("Male")}),e.jsx(Da,{label:"女性专用",isActive:y==="Female",onClick:()=>S("Female")}),e.jsx(Da,{label:"通用",isActive:y==="Universal",onClick:()=>S("Universal")})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[he.map(xe=>e.jsx("button",{onClick:()=>J(xe),className:"text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:e.jsx(Oy,{item:xe})},xe.id)),he.length===0&&e.jsx("div",{className:"col-span-full text-center text-gray-500 pt-10",children:e.jsx("p",{children:"该分类下暂无装备。"})})]})]});case"日常道具":return e.jsxs("div",{className:"p-6 text-center text-gray-500 font-serif flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📦"}),e.jsx("p",{children:"此功能尚未开放。"}),e.jsx("p",{className:"mt-2",children:"未来的丹药、材料等消耗品将在此处展示。"})]});case"兽宠":const le=[...i.petCollection].filter(xe=>xe.gender===(g==="雄性"?"Male":"Female")).sort((xe,pe)=>X.indexOf(xe.rarity)-X.indexOf(pe.rarity));return e.jsxs("div",{children:[e.jsx("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ot,{label:"雄性",isActive:g==="雄性",onClick:()=>b("雄性")}),e.jsx(Ot,{label:"雌性",isActive:g==="雌性",onClick:()=>b("雌性")})]})}),e.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[le.map(xe=>e.jsx("button",{onClick:()=>r(xe),className:"relative text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:e.jsx(zy,{card:xe})},xe.id)),le.length===0&&e.jsx("div",{className:"col-span-full text-center text-gray-500 pt-10",children:e.jsx("p",{children:"该分类下暂无兽宠。"})})]})]})}};return e.jsxs("div",{className:"h-full flex flex-col font-serif text-gray-300",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[e.jsx(Ot,{label:"图鉴",isActive:c==="图鉴",onClick:()=>d("图鉴")}),e.jsx(Ot,{label:"兽宠",isActive:c==="兽宠",onClick:()=>d("兽宠")}),e.jsx(Ot,{label:"通用技能库",isActive:c==="通用技能库",onClick:()=>d("通用技能库")}),e.jsx(Ot,{label:"装备库",isActive:c==="装备库",onClick:()=>d("装备库")}),e.jsx(Ot,{label:"日常道具",isActive:c==="日常道具",onClick:()=>d("日常道具")})]}),e.jsx("div",{className:"flex-grow overflow-y-auto bg-black/20 relative",children:I()}),E&&e.jsx(Wi,{card:E,onClose:()=>$(null),playerProfile:i,setPlayerProfile:l,onViewPet:r}),Z&&e.jsx(Od,{skill:Z,onClose:()=>R(null)}),V&&e.jsx($y,{item:V,onClose:()=>J(null)}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-stone-800 border border-stone-600 rounded-xl w-full max-w-md shadow-2xl p-6 text-center font-serif",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"确认出售"}),e.jsxs("p",{className:"text-gray-300",children:["你确定要出售 ",e.jsxs("span",{className:`font-semibold ${Me(k.rarity)}`,children:["[",k.rarity,"] ",k.name]})," 吗?"]}),e.jsxs("p",{className:"text-lg text-green-400 font-bold my-4",children:["你将获得 ",un[k.rarity]||0," 灵石"]}),ne&&e.jsx("p",{className:"text-red-500 text-sm mb-4 animate-shake",children:ne}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[e.jsx("button",{onClick:()=>Q(null),className:"px-6 py-2 bg-stone-600 hover:bg-stone-500 rounded-md font-semibold",children:"取消"}),e.jsx("button",{onClick:L,className:"px-6 py-2 bg-red-600 text-white hover:bg-red-500 rounded-md font-bold",children:"确认"})]})]})})]})},Ly=({playerProfile:i,setPlayerProfile:l,onViewPet:r})=>{const[c,d]=v.useState(null),[m,f]=v.useState(null),x=y=>{f(y)},h=(y,S)=>{if(!m||m.gender!==S)return;const C=JSON.parse(JSON.stringify(i)),A=S==="Male"?"maleParty":"femaleParty";C.maleParty=C.maleParty.filter(R=>R.id!==m.id),C.femaleParty=C.femaleParty.filter(R=>R.id!==m.id);const E=C[A],$=E[y];$?i[A].findIndex(V=>V.id===$.id)!==-1&&(E[y]=m):E[y]=m;const Z=[...Array(4)].map((R,V)=>E[V]||null).filter(Boolean);C[A]=Z,l(C),f(null)},g=(y,S)=>{const C=JSON.parse(JSON.stringify(i)),A=S==="Male"?"maleParty":"femaleParty";C[A]=C[A].filter(E=>E.id!==y),l(C)},b=({gender:y})=>{const S=y==="Male"?i.maleParty:i.femaleParty,C=i.cardCollection.filter(E=>E.gender===y),A=E=>S.some($=>$.id===E);return e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800/70 via-stone-900/80 to-black/70 p-4 rounded-lg flex flex-col h-full shadow-glow-gold",children:[e.jsx("h3",{className:"text-center font-bold text-gradient-gold mb-3 text-xl text-shadow-glow",children:y==="Male"?"男性编队 ⚔️":"女性编队 🌸"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gradient-gold mb-2 text-shadow-glow",children:["上阵队伍 (",S.length,"/4)"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[...Array(4)].map((E,$)=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{onClick:()=>h($,y),className:`h-28 w-full rounded-lg flex flex-col items-center justify-center p-2 text-center transition-all duration-300 border-2 cursor-pointer ${S[$]?`${At(S[$].rarity)} bg-gradient-to-br from-stone-700/60 to-stone-800/70 hover:from-stone-600/80 hover:to-stone-700/90 shadow-lg hover:shadow-glow-gold`:"border-dashed border-stone-600 bg-black/30 hover:bg-stone-800/50 hover:border-amber-500/50"}`,children:S[$]?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold font-serif text-white text-sm text-shadow-glow",children:S[$].name}),e.jsx("p",{className:`text-xs font-semibold ${Me(S[$].rarity)}`,children:S[$].realm}),S[$].pet&&e.jsx("button",{onClick:Z=>{Z.stopPropagation(),r(S[$].pet)},className:"absolute -bottom-1 -left-1 bg-purple-600 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:bg-purple-500 transition-colors z-10 border border-stone-900 shadow-glow-purple",title:`兽宠: ${S[$].pet.name}`,children:"🐾"})]}):e.jsx("span",{className:"text-stone-500 text-3xl opacity-50 hover:text-amber-400 hover:opacity-80 transition-all duration-300",children:"+"})}),S[$]&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z=>{Z.stopPropagation(),g(S[$].id,y)},className:"absolute -top-1 -right-1 bg-gradient-to-br from-red-600 to-red-700 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:from-red-500 hover:to-red-600 transition-all duration-300 z-10 border border-stone-900 shadow-glow-red hover:scale-110",title:"卸下",children:"×"}),e.jsx("button",{onClick:Z=>{Z.stopPropagation(),d(S[$])},className:"absolute -bottom-1 -right-1 bg-gradient-to-br from-sky-600 to-sky-700 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:from-sky-500 hover:to-sky-600 transition-all duration-300 z-10 border border-stone-900 shadow-glow-blue hover:scale-110",title:"详情",children:"i"})]})]},$))})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 scrollbar-xianxia",children:[e.jsx("h4",{className:"font-semibold text-gradient-gold mb-2 text-shadow-glow",children:"图鉴"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:C.map(E=>e.jsxs("button",{onClick:()=>x(E),onDoubleClick:()=>d(E),disabled:A(E.id),className:`relative p-2 rounded-lg border-2 text-center transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed hover:scale-105 ${(m==null?void 0:m.id)===E.id?"ring-4 ring-green-500 ring-offset-2 ring-offset-stone-800 shadow-glow-green animate-pulse-slow":""} ${At(E.rarity)} ${pr(E.rarity,!A(E.id))} hover:shadow-lg`,children:[e.jsx("p",{className:"font-bold font-serif text-white text-sm text-shadow-glow",children:E.name}),e.jsx("p",{className:`text-xs font-semibold ${Me(E.rarity)}`,children:E.realm}),A(E.id)&&e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-gradient-to-r from-amber-500 to-amber-600 text-white text-[9px] px-1.5 rounded-full font-bold shadow-glow-gold animate-shimmer",children:"上阵"})]},E.id))})]})]})};return e.jsxs("div",{className:"p-4 sm:p-6 text-gray-300 font-serif h-full bg-gradient-to-br from-stone-900 via-stone-950 to-black",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[e.jsx(b,{gender:"Male"}),e.jsx(b,{gender:"Female"})]}),c&&e.jsx(Wi,{card:c,onClose:()=>d(null),playerProfile:i,setPlayerProfile:l,onViewPet:r})]})},By=i=>!!(i&&i.gender&&i.skills),Yx=i=>!!(i&&i.stats&&["Weapon","Armor","Accessory"].includes(i.type)),Qx=i=>!!(i&&i.cost!==void 0&&i.mechanicsDescription),yd=i=>!!(i&&i.skill&&!i.baseAttributes),Jx=i=>i.type==="compensation",Hy=({gender:i})=>{if(i==="Universal"||!i)return null;const l=i==="Male"?"♂":"♀",r=i==="Male"?"text-sky-400":"text-pink-400";return e.jsx("div",{className:`absolute top-1 right-1 w-5 h-5 rounded-full bg-black/50 flex items-center justify-center font-bold text-sm ${r}`,children:l})},Uy=({item:i,isRevealed:l,onReveal:r})=>{const[c,d]=v.useState(!1);v.useEffect(()=>{l&&d(!0)},[l]);const m=()=>{c||(d(!0),r())},f=(()=>{if(Jx(i))return e.jsx("div",{className:"text-4xl mb-1 text-yellow-400",children:"💎"});if(By(i))return i.gender==="Male"?e.jsx("div",{className:"text-4xl mb-1 text-sky-400",children:"♂"}):e.jsx("div",{className:"text-4xl mb-1 text-pink-400",children:"♀"});if(yd(i))return e.jsx("div",{className:"text-4xl mb-1",children:"🐾"});const x=Yx(i)?"🗡️":Qx(i)?"📜":"❓";return e.jsx("div",{className:"text-4xl mb-1",children:x})})();return e.jsx("div",{className:"w-full aspect-[3/4] [perspective:1000px] group",onClick:m,children:e.jsxs("div",{className:`relative w-full h-full transition-transform duration-700 [transform-style:preserve-3d] ${c?"[transform:rotateY(180deg)]":""}`,children:[e.jsx("div",{className:"absolute w-full h-full [backface-visibility:hidden] bg-slate-700 rounded-lg border-2 border-slate-500 flex items-center justify-center",children:e.jsx("div",{className:"text-4xl text-amber-400 opacity-50",children:"?"})}),e.jsxs("div",{className:`absolute w-full h-full [backface-visibility:hidden] [transform:rotateY(180deg)] bg-slate-800 rounded-lg border-2 flex flex-col justify-between p-2 text-center ${jp(i.rarity)} ${At(i.rarity)}`,children:[(Yx(i)||Qx(i)||yd(i))&&e.jsx(Hy,{gender:yd(i)?i.gender:i.genderLock}),e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center",children:[f,e.jsx("p",{className:"text-sm font-bold text-white font-serif leading-tight",children:i.name}),Jx(i)&&e.jsx("p",{className:"text-xs text-amber-300 mt-1 px-1",children:i.description})]}),e.jsxs("p",{className:`text-xs font-semibold ${Me(i.rarity)}`,children:["[",i.rarity,"]"]})]})]})})},Iy=({results:i,onClose:l})=>{const[r,c]=v.useState(new Set),d=i.length===1,m=()=>{const h=new Set(i.map((g,b)=>b));c(h)},f=h=>{c(g=>new Set(g).add(h))},x=r.size===i.length;return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-slate-900/90 border border-slate-700 rounded-xl w-full max-w-4xl h-auto max-h-[90vh] shadow-2xl flex flex-col backdrop-blur-lg",onClick:h=>h.stopPropagation(),children:[e.jsx("h2",{className:"text-2xl font-bold text-white font-serif text-center p-4 flex-shrink-0",children:"招募结果"}),e.jsx("div",{className:`flex-grow p-4 overflow-y-auto ${d?"flex items-center justify-center":"grid grid-cols-5 gap-3"}`,children:i.map((h,g)=>e.jsx("div",{className:d?"w-48":"",children:e.jsx(Uy,{item:h,isRevealed:r.has(g),onReveal:()=>f(g)})},g))}),e.jsxs("div",{className:"p-4 flex-shrink-0 flex justify-center items-center gap-4",children:[!d&&e.jsx("button",{onClick:m,disabled:x,className:"bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-6 rounded-md transition-colors disabled:opacity-50",children:"全部展示"}),e.jsx("button",{onClick:l,disabled:!x,className:"bg-amber-600 hover:bg-amber-500 text-white font-bold py-2 px-8 rounded-md transition-colors disabled:opacity-50",children:"放入仓库"})]})]})})},Xx=i=>!!(i&&i.gender&&i.skills),Px=i=>!!(i&&i.stats&&["Weapon","Armor","Accessory"].includes(i.type)),Zx=i=>!!(i&&i.cost!==void 0&&i.mechanicsDescription),Kx=i=>!!(i&&i.skill&&!i.baseAttributes),Fx=i=>i.type==="compensation",Wx=({label:i,isActive:l,onClick:r})=>e.jsx("button",{onClick:r,className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-all duration-300 ${l?"bg-gradient-to-b from-stone-700/90 to-stone-800/90 text-gradient-gold border-b-2 border-xianxia-gold-500 shadow-glow-gold":"bg-transparent text-gray-400 hover:bg-stone-700/50 hover:text-amber-300"}`,children:i}),ll=({label:i,isActive:l,onClick:r})=>e.jsx("button",{onClick:r,className:`px-4 py-2 rounded-md transition-all duration-300 text-sm font-medium ${l?"bg-gradient-to-r from-amber-600/30 to-amber-700/30 text-gradient-gold border border-xianxia-gold-600/50 shadow-glow-gold":"bg-stone-800/60 text-gray-300 hover:bg-stone-700/80 hover:text-amber-300 border border-transparent"}`,children:i}),qy=({title:i,description:l,bannerUrl:r,onPullOne:c,onPullTen:d,isLoading:m,error:f,pullOneCost:x,pullTenCost:h,pullOneLabel:g="招募一次",pullTenLabel:b="招募十次",poolType:y})=>{const[S,C]=v.useState(!1),A=()=>y==="permanent"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`${Me("神品")}`,children:"【神品】: 0.1%"}),e.jsx("p",{className:`${Me("圣品")}`,children:"【圣品】: 0.4%"}),e.jsx("p",{className:`${Me("仙品")}`,children:"【仙品】: 1.5%"}),e.jsx("p",{className:`${Me("绝品")}`,children:"【绝品】: 3%"}),e.jsx("p",{className:`${Me("珍品")}`,children:"【珍品】: 5%"}),e.jsx("p",{className:`${Me("优品")}`,children:"【优品】: 15%"}),e.jsx("p",{className:`${Me("良品")}`,children:"【良品】: 30%"}),e.jsx("p",{className:`${Me("凡品")}`,children:"【凡品】: 45%"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:`${Me("神品")}`,children:["【神品】: 1% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsxs("p",{className:`${Me("圣品")}`,children:["【圣品】: 2% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsxs("p",{className:`${Me("仙品")}`,children:["【仙品】: 5% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsxs("p",{className:`${Me("绝品")}`,children:["【绝品】: 6% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsxs("p",{className:`${Me("珍品")}`,children:["【珍品】: 8% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsxs("p",{className:`${Me("优品")}`,children:["【优品】: 18% ",e.jsx("span",{className:"text-amber-400",children:"↑"})]}),e.jsx("p",{className:`${Me("良品")}`,children:"【良品】: 25%"}),e.jsx("p",{className:`${Me("凡品")}`,children:"【凡品】: 35%"})]});return e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800/70 via-stone-900/80 to-black/70 rounded-lg overflow-hidden flex flex-col shadow-glow-gold",children:[e.jsxs("div",{className:"relative h-48",children:[e.jsx("img",{src:r,alt:i,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-stone-900/95 via-stone-800/50 to-transparent"}),e.jsx("h3",{className:"absolute bottom-4 left-4 text-2xl font-bold text-gradient-gold font-serif tracking-wider drop-shadow-lg text-shadow-glow",children:i})]}),e.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[e.jsx("p",{className:"text-sm text-gray-200 flex-grow leading-relaxed",children:l}),e.jsx("div",{className:"text-right mt-2 mb-2",children:e.jsxs("button",{onClick:()=>C(!S),className:"text-xs text-stone-400 hover:text-amber-400 transition-colors duration-300",children:["概率公示 ",S?"▲":"▼"]})}),S&&e.jsxs("div",{className:"glass-morphism p-3 rounded-md mb-3 text-xs animate-slide-in border border-xianxia-gold-700/30",children:[A(),e.jsx("p",{className:"text-stone-500 mt-1 text-[10px]",children:"※ 十次招募必得【优品】或以上品质的物品。"}),y==="limited"&&e.jsx("p",{className:"text-amber-400 mt-1 text-[10px]",children:"※ 限定卡池高稀有度概率大幅提升！"})]}),f&&e.jsx("div",{className:"text-red-400 text-center text-sm my-2 animate-shake",children:f}),e.jsxs("div",{className:"mt-auto flex gap-3",children:[e.jsxs("button",{onClick:c,disabled:m,className:"flex-1 bg-gradient-to-br from-stone-700 to-stone-800 hover:from-stone-600 hover:to-stone-700 transition-all duration-300 rounded-md p-3 text-center border border-stone-500/50 shadow-lg disabled:opacity-50 disabled:cursor-wait hover:shadow-glow-blue",children:[e.jsx("p",{className:"font-bold text-white",children:m?"...":g}),e.jsxs("p",{className:"text-xs text-amber-400",children:["消耗 ",x," 灵石"]})]}),e.jsxs("button",{onClick:d,disabled:m,className:"flex-1 bg-gradient-to-br from-amber-600 via-amber-700 to-amber-800 hover:from-amber-500 hover:via-amber-600 hover:to-amber-700 transition-all duration-300 rounded-md p-3 text-center border border-xianxia-gold-500 shadow-glow-gold disabled:opacity-50 disabled:cursor-wait animate-shimmer",children:[e.jsx("p",{className:"font-bold text-white text-shadow-glow",children:m?"天机演算中...":b}),e.jsxs("p",{className:"text-xs text-amber-100",children:["消耗 ",h," 灵石"]})]})]})]})]})},Gy=({playerProfile:i,setPlayerProfile:l})=>{const[r,c]=v.useState("抽取卡池"),[d,m]=v.useState("人物卡牌"),[f,x]=v.useState("regular"),[h,g]=v.useState(null),[b,y]=v.useState(!1),[S,C]=v.useState(null),A=["凡品","良品","优品","珍品","绝品","仙品","圣品","神品"],E={凡品:45,良品:30,优品:15,珍品:5,绝品:3,仙品:1.5,圣品:.4,神品:.1},$=(D,T=!1)=>{const G=E,_=[];let M=A;T&&(M=A.filter(Q=>A.indexOf(Q)>=2)),M.forEach(Q=>{_.push({rarity:Q,weight:G[Q]})});const U=_.reduce((Q,ne)=>Q+ne.weight,0);let k=Math.random()*U;for(const Q of _)if(k-=Q.weight,k<=0)return Q.rarity;return _[_.length-1].rarity},Z=async(D,T)=>{const G=[];for(let Y=0;Y<D;Y++)G.push($());D===10&&!G.some(Y=>A.indexOf(Y)>=2)&&(G[Math.floor(Math.random()*10)]=$(T,!0));const _=G.map(async Y=>{try{const L=A.indexOf(Y)>=5&&Math.random()<.5;switch(d){case"人物卡牌":return await Yb(Y);case"装备":return await Qb(Y);case"通用技能":return await Jb(Y,"Universal");case"兽宠":return await ty(Y);default:throw new Error("Invalid gacha tab")}}catch(X){throw console.error(`生成物品失败 (稀有度: ${Y}):`,X),X}}),M=await Promise.all(_),U=[],k=d==="人物卡牌",Q=d==="通用技能",ne=d==="兽宠";for(const Y of M){if(!Y)continue;let X=!1;if(k?X=i.cardCollection.some(L=>L.name===Y.name):Q?X=i.universalSkills.some(L=>L.name===Y.name):ne&&(X=i.petCollection.some(L=>L.name===Y.name)),(k||Q||ne)&&X){const L=(un[Y.rarity]||10)*5;U.push({type:"compensation",id:`comp-${Y.id}-${Date.now()}`,name:`重复的${k?"角色":ne?"兽宠":"技能"}`,rarity:Y.rarity,description:`转化为 ${L} 灵石`})}else U.push(Y)}return U},R=async(D,T,G)=>{if(i.spiritStones<D){C("灵石不足！"),setTimeout(()=>C(null),3e3);return}if(b)return;y(!0),C(null);const _=i.spiritStones;try{l({...i,spiritStones:_-D});const M=await Z(T,G);g(M)}catch(M){console.error(M),C("天机紊乱，招募失败。灵石已退回。"),l({...i,spiritStones:_}),setTimeout(()=>C(null),4e3)}finally{y(!1)}},V=()=>{if(!h)return;console.log("🎁 开始处理抽卡结果，共",h.length,"个物品");const D=JSON.parse(JSON.stringify(i));h.forEach(T=>{if(console.log("📦 处理物品:",T.name,"稀有度:",T.rarity),console.log("🔍 物品类型检测:"),console.log("  - isCompensationItem:",Fx(T)),console.log("  - isCharacterCard:",Xx(T),"(需要gender和skills)"),console.log("  - isEquipment:",Px(T)),console.log("  - isSkill:",Zx(T)),console.log("  - isPetCard:",Kx(T)),console.log("  - 物品详情:",JSON.stringify(T,null,2)),Fx(T)){const G=T.description.match(/\d+/);if(G){const _=parseInt(G[0],10);D.spiritStones+=_,console.log("💎 补偿灵石:",_)}}else if(Xx(T)){const G={...T,id:`gen-char-${T.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};D.cardCollection.push(G),console.log("👤 添加角色到cardCollection:",T.name)}else if(Px(T)){const G={...T,id:`gen-equip-${T.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};D.equipmentInventory.push(G),console.log("⚔️ 添加装备到equipmentInventory:",T.name)}else if(Zx(T)){const G={...T,id:`gen-skill-${T.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};D.universalSkills.push(G),console.log("📜 添加技能到universalSkills:",T.name)}else if(Kx(T)){const G={...T,id:`gen-pet-${T.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};D.petCollection.push(G),console.log("🐾 添加宠物到petCollection:",T.name)}}),console.log("✅ 更新后的仓库状态:"),console.log("  - 角色数量:",D.cardCollection.length),console.log("  - 装备数量:",D.equipmentInventory.length),console.log("  - 技能数量:",D.universalSkills.length),console.log("  - 宠物数量:",D.petCollection.length),l(D),g(null),console.log("🎉 抽卡结果已保存到仓库！")},J=()=>{const D=async()=>{const k=prompt("请输入你的灵感来源（例如，一个角色名或一段描述）:");if(!k)return;const Q=1e3;if(i.spiritStones<Q){C("灵石不足！"),setTimeout(()=>C(null),3e3);return}if(b)return;y(!0),C(null);const ne=i.spiritStones;try{l({...i,spiritStones:ne-Q});const Y=$("permanent",!1);console.log(`🎲 同人卡池抽取稀有度: ${Y}`);let X;switch(d){case"人物卡牌":X=await Kb(k,Y);break;case"装备":X=await ay(k,Y);break;case"通用技能":X=await ny(k,Y,"Universal");break;case"兽宠":X=await sy(k,Y);break;default:alert(`"${d}"类型的同人创作功能出现错误。`),l({...i,spiritStones:ne}),y(!1);return}g([X])}catch(Y){console.error(Y),C("天机紊乱，召唤失败。灵石已退回。"),l({...i,spiritStones:ne}),setTimeout(()=>C(null),4e3)}finally{y(!1)}},_=f==="regular"?{人物卡牌:{title:"万象寻仙",description:"常驻卡池，可招募来自五湖四海的修士。",bannerUrl:"https://i.imgur.com/3sL0qXf.jpg",onPull:()=>R(100,1,"permanent")},装备:{title:"百炼阁",description:"常驻装备池，可获取各类法宝与防具。",bannerUrl:"https://i.imgur.com/2jM1aYk.jpg",onPull:()=>R(100,1,"permanent")},通用技能:{title:"万法楼",description:"常驻技能池，可习得各种通用功法。",bannerUrl:"https://i.imgur.com/dK8k9oN.jpg",onPull:()=>R(100,1,"permanent")},兽宠:{title:"御兽斋",description:"常驻兽宠池，可契约各种珍奇灵兽。",bannerUrl:"https://i.imgur.com/aJ4Gq9a.jpg",onPull:()=>R(100,1,"permanent")}}[d]:{人物卡牌:{title:"异界降临",description:"消耗大量灵石，将你的“灵感”化为现实，召唤来自异界的强者。",bannerUrl:"https://i.imgur.com/s6A4b3g.jpg",onPull:D},装备:{title:"神兵天成",description:"消耗大量灵石，根据你的“灵感”锻造出传说中的神兵利器。",bannerUrl:"https://i.imgur.com/Tq9g8xS.jpg",onPull:D},通用技能:{title:"大道顿悟",description:"消耗大量灵石，从你的“灵感”中领悟出惊天动地的无上功法。",bannerUrl:"https://i.imgur.com/o2N5d1m.jpg",onPull:D},兽宠:{title:"灵兽创生",description:"消耗大量灵石，将你的“灵感”化为现实，创造一只独一无二的灵兽伙伴。",bannerUrl:"https://i.imgur.com/Yp8zL5g.jpg",onPull:D}}[d],M=f==="regular"?200:1e3,U=f==="regular"?1800:9e3;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-center gap-3 mb-4",children:[e.jsx(ll,{label:"常规卡池",isActive:f==="regular",onClick:()=>x("regular")}),e.jsx(ll,{label:"同人卡池",isActive:f==="doujin",onClick:()=>x("doujin")})]}),e.jsx(qy,{title:_.title,description:_.description,bannerUrl:_.bannerUrl,onPullOne:()=>f==="regular"?R(M,1,"permanent"):D(),onPullTen:()=>f==="regular"?R(U,10,"permanent"):alert("同人卡池暂不支持十连抽。"),isLoading:b,error:S,pullOneCost:M,pullTenCost:U,pullOneLabel:f==="doujin"?"注入灵感":"招募一次",pullTenLabel:f==="doujin"?" ":"招募十次",poolType:"permanent"})]})};return e.jsxs("div",{className:"h-full flex flex-col font-serif text-gray-300 bg-gradient-to-br from-stone-900 via-stone-950 to-black",children:[e.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-xianxia-gold-700/30",children:[e.jsx(Wx,{label:"抽取卡池",isActive:r==="抽取卡池",onClick:()=>c("抽取卡池")}),e.jsx(Wx,{label:"道具购买",isActive:r==="道具购买",onClick:()=>c("道具购买")})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto bg-black/20 p-4 scrollbar-xianxia",children:[r==="抽取卡池"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(ll,{label:"人物卡牌",isActive:d==="人物卡牌",onClick:()=>m("人物卡牌")}),e.jsx(ll,{label:"装备",isActive:d==="装备",onClick:()=>m("装备")}),e.jsx(ll,{label:"通用技能",isActive:d==="通用技能",onClick:()=>m("通用技能")}),e.jsx(ll,{label:"兽宠",isActive:d==="兽宠",onClick:()=>m("兽宠")})]}),J()]}),r==="道具购买"&&e.jsx("div",{className:"p-6 text-center font-serif flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"glass-morphism p-8 rounded-lg ornate-border border-xianxia-gold-600",children:[e.jsx("div",{className:"text-6xl mb-6 animate-bounce-slow",children:"💰"}),e.jsx("p",{className:"text-gradient-gold text-xl font-bold mb-2",children:"此功能尚未开放"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"未来的商店将在此处展示，可购买丹药、材料等。"})]})})]}),h&&e.jsx(Iy,{results:h,onClose:V})]})},Vy=({activeModal:i,onClose:l,playerProfile:r,setPlayerProfile:c,leaderboards:d,onMatchFound:m,onViewPet:f,gameState:x,onLeaderboardsUpdate:h})=>{const g=()=>{switch(i){case"队伍":return e.jsx(Ly,{playerProfile:r,setPlayerProfile:c,onViewPet:f});case"商城":return e.jsx(Gy,{playerProfile:r,setPlayerProfile:c});case"背包":return e.jsx(Ry,{playerProfile:r,setPlayerProfile:c,onViewPet:f});case"竞技场":return e.jsx(My,{playerProfile:r,leaderboards:d,onMatchFound:m,gameState:x,onLeaderboardsUpdate:h});case"任务":default:return e.jsxs("div",{className:"p-6 text-gray-300 font-serif flex flex-col items-center justify-center h-full",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📜"}),e.jsxs("p",{children:["这里是 ",e.jsx("span",{className:"font-semibold text-amber-400",children:i})," 界面的占位内容。"]}),e.jsx("p",{className:"mt-4 text-center text-gray-400",children:"后续开发将在此处填充相关的游戏信息，例如背包列表、技能树、人物关系或当前任务日志等。"})]})}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-6xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col animate-slide-in",onClick:b=>b.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif tracking-widest",children:i}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:e.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]}),e.jsx("div",{className:"flex-grow overflow-y-auto",children:g()}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})})},ef=({value:i,maxValue:l,color:r,label:c})=>{const d=l>0?i/l*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-300",children:c}),e.jsx("span",{className:"text-xs font-mono text-gray-400",children:`${Math.round(i)}/${Math.round(l)}`})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 border border-stone-600/50 overflow-hidden",children:e.jsx("div",{className:`${r} h-full rounded-full transition-all duration-500 ease-in-out relative`,style:{width:`${d}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"})})})]})},Yy=({char:i})=>{const l=Cs(i);return e.jsxs("div",{className:"glass-morphism p-3 rounded-lg border border-stone-600/50 hover:border-xianxia-gold-500/50 transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-bold text-white font-serif",children:i.name}),e.jsx("p",{className:"text-amber-400 text-sm",children:i.realm})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ef,{value:l.hp,maxValue:l.maxHp,color:"bg-red-500",label:"气血"}),e.jsx(ef,{value:l.mp,maxValue:l.maxMp,color:"bg-blue-500",label:"真元"})]})]})},Qy=({playerProfile:i})=>{const l=i.maleParty.length>0?i.maleParty:i.femaleParty;return e.jsx(Qi,{title:`${i.name}的队伍`,children:e.jsx("div",{className:"space-y-3",children:l.length>0?l.map(r=>e.jsx(Yy,{char:r},r.id)):e.jsx("p",{className:"text-center text-gray-400",children:"当前没有角色上阵"})})})},Qi=({title:i,children:l})=>e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h3",{className:"font-semibold text-xianxia-gold-400 mb-3 text-lg",children:i}),l]}),Jy=({playerProfile:i,isOpen:l,onClose:r,hasPendingChallenge:c,onBattleClick:d,onRelationshipsClick:m,onReputationClick:f})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed inset-0 bg-black/70 z-30 transition-opacity duration-300 ${l?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:r}),e.jsxs("div",{className:`fixed top-0 left-0 h-full w-full max-w-md bg-gradient-to-br from-stone-800/95 via-stone-900/95 to-stone-950/95 backdrop-blur-lg border-r border-xianxia-gold-400/30 shadow-2xl shadow-xianxia-gold-500/10 z-40 transform transition-transform duration-300 ease-in-out ${l?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-xianxia-gold-400/20 bg-stone-900/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"个人信息"}),e.jsxs("button",{onClick:d,className:`relative px-4 py-1.5 text-sm font-semibold rounded-md transition-all duration-300 border ${c?"bg-red-800/80 border-red-500 text-white animate-pulse-fast shadow-glow-red":"bg-stone-700/50 border-stone-600 text-gray-400 cursor-default"}`,children:["战况",c&&e.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})]}),e.jsx("button",{onClick:f,className:"relative px-4 py-1.5 text-sm font-semibold rounded-md transition-all duration-300 border bg-stone-700/50 border-stone-600 text-gray-300 hover:bg-stone-600/80",children:"声望"})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"p-4 overflow-y-auto scrollbar-xianxia h-[calc(100%-65px)] space-y-4 font-serif",children:[e.jsxs(Qi,{title:"当前身份",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-400 w-16 inline-block",children:"名号："})," ",e.jsx("span",{className:"text-white font-bold",children:i.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-400 w-16 inline-block",children:"称号："})," ",e.jsx("span",{className:"text-white",children:i.title||"无"})]})]}),e.jsx(Qi,{title:"经济状况",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-gem text-yellow-400 text-xl"}),e.jsx("span",{className:"text-white font-bold text-lg",children:i.spiritStones}),e.jsx("span",{className:"text-gray-300",children:"灵石"})]})}),e.jsx(Qi,{title:"人际关系",children:e.jsx("button",{onClick:m,className:"w-full text-left hover:bg-stone-800/50 p-2 -m-2 rounded-md transition-colors",children:i.relationships&&i.relationships.length>0?e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-300",children:["已结识 ",e.jsx("span",{className:"font-bold text-white",children:i.relationships.length})," 位道友。"]}),e.jsx("p",{className:"text-xs text-amber-400 mt-1",children:"点击查看详情"})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 italic",children:"江湖路远，尚未结识重要人物。"}),e.jsx("p",{className:"text-xs text-amber-400 mt-1",children:"点击查看详情"})]})})}),e.jsx(Qy,{playerProfile:i})]})]})]}),Xy=({pet:i,onClose:l})=>{const[r,c]=v.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg h-auto max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"p-4 flex-shrink-0 bg-black/20",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white font-serif flex items-baseline gap-3",children:[e.jsx("span",{children:i.name}),e.jsxs("span",{className:`text-lg font-medium ${Me(i.rarity)}`,children:["[",i.rarity,"]"]})]}),e.jsx("p",{className:"text-lg text-amber-400 font-serif",children:i.gender==="Male"?"雄性":"雌性"})]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsx("div",{className:"mt-2 space-y-1 text-sm text-gray-300",children:e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500 font-semibold",children:"描述:"})," ",i.description]})})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-grow",children:e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"兽宠技能"}),e.jsxs("div",{className:`relative w-full text-left bg-stone-700/50 p-3 rounded-md border-2 ${At(i.skill.rarity)} cursor-pointer hover:bg-stone-600/70 transition-colors`,onClick:()=>c(!0),children:[e.jsx("div",{className:"flex justify-between items-baseline",children:e.jsxs("h5",{className:"font-bold text-white flex items-baseline gap-2",children:[e.jsx("span",{className:`${Me(i.skill.rarity)}`,children:i.skill.name}),e.jsxs("span",{className:`text-xs font-medium ${Me(i.skill.rarity)}`,children:["[",i.skill.rarity,"]"]})]})}),e.jsx("p",{className:"text-sm font-semibold text-amber-300 mt-1",children:i.skill.mechanicsDescription}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:i.skill.description})]})]})})]})}),r&&e.jsx(Od,{skill:i.skill,onClose:()=>c(!1)})]})},Yi=({value:i,rolling:l})=>{const[r,c]=v.useState(1);return v.useEffect(()=>{if(l){const d=setInterval(()=>{c(Math.floor(Math.random()*6)+1)},50);return()=>clearInterval(d)}else i!==null&&c(i)},[l,i]),e.jsx("div",{className:"w-20 h-20 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center text-4xl font-bold text-stone-800 shadow-lg",children:r})},Py=({playerProfile:i,opponentName:l,onBattleStart:r,onClose:c})=>{const[d,m]=v.useState("roll"),[f,x]=v.useState(null),[h,g]=v.useState(!1),[b,y]=v.useState(null),[S,C]=v.useState(null),[A,E]=v.useState("通过拼点决定先手！"),$=()=>{g(!0),setTimeout(()=>{let V,J;do V=Math.floor(Math.random()*6)+1,J=Math.floor(Math.random()*6)+1;while(V===J);const D=V>J?"player":"opponent";x({playerRoll:V,opponentRoll:J,winner:D}),g(!1),m("select"),E(D==="player"?"你赢得了先手！请选择你的出战队伍。":"对手赢得了先手，正在选择队伍...")},1500)},Z=V=>{(f==null?void 0:f.winner)==="player"&&!b&&y(V)};v.useEffect(()=>{if(!(d!=="select"||!f)){if(b&&S){const V=setTimeout(()=>{m("result"),E("队伍确定，准备开战！")},1e3);return()=>clearTimeout(V)}if(!b||!S)if(f.winner==="player"){if(b&&!S){const V=b==="Male"?"Female":"Male";E(`你已选择，对手将使用 ${V==="Male"?"男性":"女性"} 队伍。`);const J=setTimeout(()=>C(V),500);return()=>clearTimeout(J)}}else if(S){if(S&&!b){const V=S==="Male"?"Female":"Male",J=setTimeout(()=>{y(V),E(`你将使用 ${V==="Male"?"男性":"女性"} 队伍。`)},500);return()=>clearTimeout(J)}}else{const V=setTimeout(()=>{const J=Math.random()>.5?"Male":"Female";C(J),E(`对手选择了 ${J==="Male"?"男性":"女性"} 队伍。`)},1500);return()=>clearTimeout(V)}}},[d,f,b,S]);const R=()=>{if(d==="roll")return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-around items-center my-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white mb-2",children:i.name}),e.jsx(Yi,{value:null,rolling:h})]}),e.jsx("p",{className:"text-4xl font-serif text-amber-400",children:"VS"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white mb-2",children:l}),e.jsx(Yi,{value:null,rolling:h})]})]}),e.jsx("button",{onClick:$,disabled:h,className:"bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-500 transition-colors disabled:opacity-50",children:h?"投掷中...":"拼点"})]});if(d==="select"||d==="result"){const V=i.maleParty.length>0,J=i.femaleParty.length>0;return e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-around items-center my-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white mb-2",children:i.name}),e.jsx(Yi,{value:(f==null?void 0:f.playerRoll)||1,rolling:!1})]}),e.jsx("p",{className:`text-2xl font-serif ${(f==null?void 0:f.winner)==="player"?"text-green-400":"text-gray-400"}`,children:(f==null?void 0:f.winner)==="player"?"胜利":"败北"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white mb-2",children:l}),e.jsx(Yi,{value:(f==null?void 0:f.opponentRoll)||1,rolling:!1})]})]}),e.jsxs("div",{className:"my-6 grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sky-400",children:"你的队伍"}),e.jsx("p",{className:"mt-2 text-lg font-bold text-white h-8 animate-fade-in",children:b?b==="Male"?"男性编队":"女性编队":"..."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-400",children:"对手队伍"}),e.jsx("p",{className:"mt-2 text-lg font-bold text-white h-8 animate-fade-in",children:S?S==="Male"?"男性编队":"女性编队":"..."})]})]}),(f==null?void 0:f.winner)==="player"&&!b&&e.jsxs("div",{className:"mt-4 flex justify-center gap-4 animate-fade-in",children:[e.jsx("button",{onClick:()=>Z("Male"),disabled:!V,className:"bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"男性编队"}),e.jsx("button",{onClick:()=>Z("Female"),disabled:!J,className:"bg-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-500 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"女性编队"})]}),d==="result"&&b&&S&&e.jsx("div",{className:"mt-8 animate-fade-in",children:e.jsx("button",{onClick:()=>r(b,S),className:"bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-500 transition-colors shadow-lg animate-pulse-fast",children:"进入战斗"})})]})}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg shadow-2xl flex flex-col",children:[e.jsx("div",{className:"p-4 text-center bg-black/20",children:e.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"战前准备"})}),e.jsxs("div",{className:"p-6 font-serif",children:[e.jsx("p",{className:"text-center text-amber-300 mb-6 h-6",children:A}),R()]})]})})},tf=[{id:"threat_violence",type:"威胁",text:"以暴力相威胁",description:"威胁对囚犯施以酷刑，迫使其屈服",icon:"fa-fist-raised",baseEffects:{submissionChange:15,loyaltyChange:-10,healthChange:0,sanityChange:-5,informationChance:30},riskFactors:{escapeAttempt:5,rebellion:15,breakdown:10}},{id:"threat_family",type:"威胁",text:"威胁其亲友",description:"暗示会对其在意的人不利",icon:"fa-users",baseEffects:{submissionChange:25,loyaltyChange:-20,healthChange:0,sanityChange:-10,informationChance:50},riskFactors:{escapeAttempt:10,rebellion:25,breakdown:15}},{id:"threat_execution",type:"威胁",text:"以处决相威胁",description:"声称若不配合将被处死",icon:"fa-skull",baseEffects:{submissionChange:35,loyaltyChange:-30,healthChange:0,sanityChange:-15,informationChance:60},riskFactors:{escapeAttempt:20,rebellion:30,breakdown:25}},{id:"persuade_reason",type:"劝说",text:"晓之以理",description:"用道理说服囚犯配合",icon:"fa-comments",baseEffects:{submissionChange:5,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:5,breakdown:0}},{id:"persuade_emotion",type:"劝说",text:"动之以情",description:"用情感打动囚犯",icon:"fa-heart",baseEffects:{submissionChange:10,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:25},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"persuade_future",type:"劝说",text:"许诺未来",description:"承诺若配合将有好的结果",icon:"fa-sun",baseEffects:{submissionChange:15,loyaltyChange:20,healthChange:0,sanityChange:15,informationChance:35},requirements:{minSubmission:30},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_food",type:"交易",text:"以美食交换",description:"提供美味食物换取配合",icon:"fa-utensils",requirements:{spiritStones:10},baseEffects:{submissionChange:5,loyaltyChange:15,healthChange:10,sanityChange:5,informationChance:30},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_comfort",type:"交易",text:"改善待遇",description:"承诺改善关押条件",icon:"fa-bed",requirements:{spiritStones:50},baseEffects:{submissionChange:10,loyaltyChange:25,healthChange:5,sanityChange:10,informationChance:40},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_freedom",type:"交易",text:"以自由交换",description:"承诺若提供情报将释放",icon:"fa-dove",requirements:{minSubmission:50},baseEffects:{submissionChange:20,loyaltyChange:30,healthChange:0,sanityChange:20,informationChance:70},riskFactors:{escapeAttempt:5,rebellion:0,breakdown:0}},{id:"extract_casual",type:"套话",text:"闲聊套话",description:"在闲聊中套取信息",icon:"fa-comment-dots",baseEffects:{submissionChange:0,loyaltyChange:5,healthChange:0,sanityChange:0,informationChance:25},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"extract_trick",type:"套话",text:"设计圈套",description:"用话术诱导囚犯透露信息",icon:"fa-chess",baseEffects:{submissionChange:5,loyaltyChange:-5,healthChange:0,sanityChange:-5,informationChance:45},riskFactors:{escapeAttempt:0,rebellion:10,breakdown:5}},{id:"extract_pretend",type:"套话",text:"假装同情",description:"假装理解和同情来获取信任",icon:"fa-mask",baseEffects:{submissionChange:5,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:35},riskFactors:{escapeAttempt:0,rebellion:5,breakdown:0}},{id:"chat_past",type:"闲聊",text:"聊聊过去",description:"询问囚犯的过往经历",icon:"fa-clock-rotate-left",baseEffects:{submissionChange:0,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:15},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:5}},{id:"chat_cultivation",type:"闲聊",text:"谈论修炼",description:"与囚犯交流修炼心得",icon:"fa-yin-yang",baseEffects:{submissionChange:0,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"chat_world",type:"闲聊",text:"聊聊外界",description:"告诉囚犯外面世界的消息",icon:"fa-globe",baseEffects:{submissionChange:0,loyaltyChange:5,healthChange:0,sanityChange:-5,informationChance:10},riskFactors:{escapeAttempt:5,rebellion:5,breakdown:10}},{id:"favor_heal",type:"恩惠",text:"治疗伤势",description:"为囚犯治疗伤病",icon:"fa-kit-medical",requirements:{spiritStones:30},baseEffects:{submissionChange:5,loyaltyChange:20,healthChange:30,sanityChange:10,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"favor_gift",type:"恩惠",text:"赠送礼物",description:"送给囚犯一些小礼物",icon:"fa-gift",requirements:{spiritStones:20},baseEffects:{submissionChange:0,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:15},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"favor_visit",type:"恩惠",text:"安排探视",description:"允许囚犯的亲友来探视",icon:"fa-people-arrows",requirements:{minSubmission:40,spiritStones:100},baseEffects:{submissionChange:10,loyaltyChange:35,healthChange:0,sanityChange:30,informationChance:25},riskFactors:{escapeAttempt:15,rebellion:0,breakdown:0}},{id:"humiliate_mock",type:"羞辱",text:"言语嘲讽",description:"用言语羞辱和嘲讽囚犯",icon:"fa-face-laugh",baseEffects:{submissionChange:10,loyaltyChange:-15,healthChange:0,sanityChange:-10,informationChance:10},riskFactors:{escapeAttempt:5,rebellion:20,breakdown:15}},{id:"humiliate_public",type:"羞辱",text:"当众羞辱",description:"在其他囚犯面前羞辱",icon:"fa-bullhorn",baseEffects:{submissionChange:20,loyaltyChange:-25,healthChange:0,sanityChange:-20,informationChance:15},riskFactors:{escapeAttempt:10,rebellion:30,breakdown:25}},{id:"humiliate_strip",type:"羞辱",text:"剥夺尊严",description:"用各种方式剥夺囚犯的尊严",icon:"fa-person-falling-burst",baseEffects:{submissionChange:30,loyaltyChange:-35,healthChange:-5,sanityChange:-30,informationChance:20},riskFactors:{escapeAttempt:15,rebellion:40,breakdown:35}}],Zy=({isOpen:i,onClose:l,prisoner:r,playerSpiritStones:c,onDialogueComplete:d,onGenerateResponse:m,isLoading:f})=>{const[x,h]=v.useState(null),[g,b]=v.useState(null),[y,S]=v.useState([]),[C,A]=v.useState(""),[E,$]=v.useState(!1),[Z,R]=v.useState(!1),V=[{type:"威胁",icon:"fa-skull-crossbones",color:"red",description:"以暴力或威胁迫使囚犯屈服"},{type:"劝说",icon:"fa-hand-holding-heart",color:"blue",description:"用道理和情感说服囚犯"},{type:"交易",icon:"fa-handshake",color:"amber",description:"用利益交换囚犯的配合"},{type:"套话",icon:"fa-user-secret",color:"purple",description:"巧妙地套取情报"},{type:"闲聊",icon:"fa-comments",color:"green",description:"轻松的日常交流"},{type:"恩惠",icon:"fa-gift",color:"cyan",description:"给予好处以获取好感"},{type:"羞辱",icon:"fa-face-angry",color:"orange",description:"打击囚犯的尊严和意志"}],J=M=>tf.filter(U=>!(U.type!==M||U.requirements&&(U.requirements.spiritStones&&c<U.requirements.spiritStones||U.requirements.minSubmission&&r.submissionLevel<U.requirements.minSubmission||U.requirements.maxSubmission&&r.submissionLevel>U.requirements.maxSubmission))),D=M=>M.requirements?!(M.requirements.spiritStones&&c<M.requirements.spiritStones||M.requirements.minSubmission&&r.submissionLevel<M.requirements.minSubmission||M.requirements.maxSubmission&&r.submissionLevel>M.requirements.maxSubmission):!0,T=()=>r.submissionLevel>=80?"完全屈服":r.submissionLevel>=60?"意志动摇":r.submissionLevel>=40?"勉强配合":r.submissionLevel>=20?"抗拒不从":"顽固抵抗",G=()=>r.submissionLevel>=80?"text-green-400":r.submissionLevel>=60?"text-yellow-400":r.submissionLevel>=40?"text-orange-400":"text-red-400",_=async()=>{if(g){R(!0);try{const M=await m(r,g);A(M);const U=.7+Math.random()*.6,k={submissionChange:Math.round(g.baseEffects.submissionChange*U),loyaltyChange:Math.round(g.baseEffects.loyaltyChange*U),healthChange:Math.round(g.baseEffects.healthChange*U),sanityChange:Math.round(g.baseEffects.sanityChange*U)},Q=Math.random()*100<g.baseEffects.informationChance;let ne;g.riskFactors&&(Math.random()*100<g.riskFactors.rebellion?ne="囚犯表现出强烈的反抗情绪":Math.random()*100<g.riskFactors.breakdown?ne="囚犯的精神状态出现异常":Math.random()*100<g.riskFactors.escapeAttempt&&(ne="囚犯似乎在暗中谋划什么"));const Y={id:`dialogue-${Date.now()}`,prisonerId:r.character.id,prisonerName:r.character.name,timestamp:new Date().toLocaleString("zh-CN"),realTimestamp:Date.now(),dialogueType:g.type,playerChoice:g.text,prisonerResponse:M,attitude:r.submissionLevel>=60?"顺从":r.submissionLevel>=30?"中立":"敌对",effects:{submissionChange:k.submissionChange,loyaltyChange:k.loyaltyChange,healthChange:k.healthChange,sanityChange:k.sanityChange,informationGained:Q?"获得了一些有价值的情报":void 0,specialEvent:ne}};S(L=>[...L,Y]);const X={success:!0,dialogueRecord:Y,prisonerReaction:M,narrativeText:M,stateChanges:{submission:k.submissionChange,loyalty:k.loyaltyChange,health:k.healthChange,sanity:k.sanityChange},rewards:Q?{information:"获得了一些有价值的情报"}:void 0,consequences:ne?{eventTriggered:ne}:void 0};d(X)}catch(M){console.error("对话执行失败:",M),A("（对话过程中出现了意外...）")}finally{R(!1),b(null)}}};return i?e.jsx("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-6xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-gradient-to-r from-stone-800 to-stone-900 border-b border-amber-500/30",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-stone-700 flex items-center justify-center border-2 border-amber-500/50",children:e.jsx("i",{className:"fa-solid fa-user text-3xl text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-comments"}),"与 ",r.character.name," 对话"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm mt-1",children:[e.jsxs("span",{className:"text-gray-400",children:[r.character.gender==="Male"?"♂":"♀"," ",r.character.realm]}),e.jsxs("span",{className:G(),children:[e.jsx("i",{className:"fa-solid fa-brain mr-1"}),T()]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>$(!E),className:"px-4 py-2 bg-cyan-600/80 text-white font-bold rounded-md hover:bg-cyan-500/80 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-history mr-2"}),E?"返回对话":"对话记录"]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors p-2",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),e.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[e.jsxs("div",{className:"w-72 bg-black/30 border-r border-stone-700 p-4 overflow-y-auto flex-shrink-0",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"身体状态"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"健康"}),e.jsxs("span",{className:r.health>70?"text-green-400":r.health>40?"text-yellow-400":"text-red-400",children:[r.health,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${r.health>70?"bg-green-500":r.health>40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.health}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"神智"}),e.jsxs("span",{className:r.sanity>70?"text-green-400":r.sanity>40?"text-yellow-400":"text-red-400",children:[r.sanity,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${r.sanity>70?"bg-green-500":r.sanity>40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.sanity}%`}})})]})]})]}),e.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"意志状态"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"屈服度"}),e.jsxs("span",{className:"text-yellow-400",children:[r.submissionLevel,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all",style:{width:`${r.submissionLevel}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"归顺度"}),e.jsxs("span",{className:"text-green-400",children:[r.loyaltyLevel,"%"]})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${r.loyaltyLevel}%`}})})]})]})]})]}),e.jsxs("div",{className:"bg-black/40 p-3 rounded-lg mb-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"囚犯信息"}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"罪行"}),e.jsx("span",{className:"text-red-300 text-right max-w-[150px] truncate",title:r.crime,children:r.crime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"剩余刑期"}),e.jsxs("span",{className:"text-orange-400",children:[r.remainingDays,"天"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"关押位置"}),e.jsx("span",{className:"text-blue-400",children:r.location})]})]})]}),r.status.length>0&&e.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"当前状态"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:r.status.map((M,U)=>e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-500/20 text-orange-300 rounded",children:M},U))})]})]}),e.jsx("div",{className:"flex-grow flex flex-col overflow-hidden",children:E?e.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"对话历史记录"}),y.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-10",children:[e.jsx("i",{className:"fa-solid fa-comments text-4xl mb-4 opacity-50"}),e.jsx("p",{children:"暂无对话记录"})]}):e.jsx("div",{className:"space-y-4",children:y.map(M=>e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 text-xs bg-amber-500/20 text-amber-300 rounded",children:M.dialogueType}),e.jsx("span",{className:"text-white font-bold",children:M.playerChoice})]}),e.jsx("span",{className:"text-xs text-gray-500",children:M.timestamp})]}),e.jsx("div",{className:"bg-black/20 p-3 rounded mb-3",children:e.jsxs("p",{className:"text-gray-300 text-sm italic",children:['"',M.prisonerResponse,'"']})}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"屈服度:"}),e.jsxs("span",{className:`ml-1 font-bold ${M.effects.submissionChange>=0?"text-yellow-400":"text-red-400"}`,children:[M.effects.submissionChange>=0?"+":"",M.effects.submissionChange]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"归顺度:"}),e.jsxs("span",{className:`ml-1 font-bold ${M.effects.loyaltyChange>=0?"text-green-400":"text-red-400"}`,children:[M.effects.loyaltyChange>=0?"+":"",M.effects.loyaltyChange]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"健康:"}),e.jsxs("span",{className:`ml-1 font-bold ${M.effects.healthChange>=0?"text-green-400":"text-red-400"}`,children:[M.effects.healthChange>=0?"+":"",M.effects.healthChange]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"神智:"}),e.jsxs("span",{className:`ml-1 font-bold ${M.effects.sanityChange>=0?"text-green-400":"text-red-400"}`,children:[M.effects.sanityChange>=0?"+":"",M.effects.sanityChange]})]})]})]},M.id))})]}):e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"bg-gradient-to-r from-stone-800/50 to-stone-900/50 p-4 border-b border-stone-700 flex-shrink-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-stone-700 flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"fa-solid fa-user text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-amber-300 font-bold mb-1",children:r.character.name}),e.jsxs("p",{className:"text-gray-300 italic",children:['"',C,'"']})]})]})}),!x&&e.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"选择对话方式"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:V.map(({type:M,icon:U,color:k,description:Q})=>{const ne=J(M).length,Y={red:"border-red-500/30 bg-red-900/20 hover:border-red-500/60 text-red-400",blue:"border-blue-500/30 bg-blue-900/20 hover:border-blue-500/60 text-blue-400",amber:"border-amber-500/30 bg-amber-900/20 hover:border-amber-500/60 text-amber-400",purple:"border-purple-500/30 bg-purple-900/20 hover:border-purple-500/60 text-purple-400",green:"border-green-500/30 bg-green-900/20 hover:border-green-500/60 text-green-400",cyan:"border-cyan-500/30 bg-cyan-900/20 hover:border-cyan-500/60 text-cyan-400",orange:"border-orange-500/30 bg-orange-900/20 hover:border-orange-500/60 text-orange-400"};return e.jsxs("button",{onClick:()=>h(M),disabled:ne===0,className:`p-4 rounded-lg border-2 transition-all text-left ${ne>0?Y[k]:"border-stone-700 bg-stone-800/50 opacity-50 cursor-not-allowed"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:e.jsx("i",{className:`fa-solid ${U}`})}),e.jsx("div",{className:"font-bold mb-1",children:M}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:Q}),e.jsxs("div",{className:"text-xs text-gray-500",children:[ne," 个可用选项"]})]},M)})})]}),x&&!g&&e.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>h(null),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsxs("h3",{className:"text-lg font-bold text-white",children:[x," - 选择具体方式"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:tf.filter(M=>M.type===x).map(M=>{var k;const U=D(M);return e.jsx("button",{onClick:()=>U&&b(M),disabled:!U,className:`p-4 rounded-lg border-2 transition-all text-left ${U?"border-stone-600 bg-black/30 hover:border-amber-500/50":"border-stone-800 bg-black/10 opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl text-amber-400",children:e.jsx("i",{className:`fa-solid ${M.icon}`})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-bold text-white mb-1",children:M.text}),e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:M.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"屈服:"}),e.jsxs("span",{className:`ml-1 ${M.baseEffects.submissionChange>=0?"text-yellow-400":"text-red-400"}`,children:[M.baseEffects.submissionChange>=0?"+":"",M.baseEffects.submissionChange]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"归顺:"}),e.jsxs("span",{className:`ml-1 ${M.baseEffects.loyaltyChange>=0?"text-green-400":"text-red-400"}`,children:[M.baseEffects.loyaltyChange>=0?"+":"",M.baseEffects.loyaltyChange]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"情报:"}),e.jsxs("span",{className:"ml-1 text-cyan-400",children:[M.baseEffects.informationChance,"%"]})]}),M.riskFactors&&M.riskFactors.rebellion>10&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"风险:"}),e.jsx("span",{className:"ml-1 text-red-400",children:M.riskFactors.rebellion>30?"高":"中"})]})]}),((k=M.requirements)==null?void 0:k.spiritStones)&&e.jsxs("span",{className:`px-2 py-0.5 text-xs rounded ${c>=M.requirements.spiritStones?"bg-amber-500/20 text-amber-300":"bg-red-500/20 text-red-300"}`,children:[M.requirements.spiritStones," 灵石"]})]})]})},M.id)})})]}),g&&e.jsx("div",{className:"flex-shrink-0 p-4 bg-black/40 border-t border-amber-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-bold mb-1",children:["已选择: ",e.jsx("span",{className:"text-amber-400",children:g.text})]}),e.jsx("div",{className:"text-xs text-gray-400",children:g.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(null),className:"px-4 py-2 bg-gray-600/80 text-white rounded-md hover:bg-gray-500/80 transition-colors",children:"取消"}),e.jsx("button",{onClick:_,disabled:Z||f,className:"px-6 py-2 bg-amber-600/80 text-white font-bold rounded-md hover:bg-amber-500/80 disabled:opacity-50 transition-colors",children:Z?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"对话中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-comment mr-2"}),"开始对话"]})})]})]})})]})})]})]})}):null},Ky=({isOpen:i,onClose:l,prisonSystem:r,onInterrogatePrisoner:c,onViewPrisonerDetail:d,onTransferPrisoner:m,onReleasePrisoner:f,onRecruitPrisoner:x,onAssignLabor:h,onClaimLaborResult:g,onGenerateEvent:b,onDialogueComplete:y,onGenerateDialogueResponse:S,isLoading:C,playerProfile:A,setPlayerProfile:E,onViewPet:$})=>{const[Z,R]=v.useState("管理区"),[V,J]=v.useState(null),[D,T]=v.useState(!1),[G,_]=v.useState(!1),[M,U]=v.useState(null),[k,Q]=v.useState(null),[ne,Y]=v.useState(36e5),[X,L]=v.useState(Date.now());if(v.useEffect(()=>{const le=setInterval(()=>{L(Date.now())},1e3);return()=>clearInterval(le)},[]),!i)return null;if(!r||!r.stats)return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"bg-stone-900 p-8 rounded-xl text-center",children:[e.jsx("i",{className:"fa-solid fa-exclamation-triangle text-yellow-400 text-4xl mb-4"}),e.jsx("h3",{className:"text-xl text-white mb-2",children:"大牢系统数据缺失"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"请重新开始游戏或加载新存档"}),e.jsx("button",{onClick:l,className:"px-6 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-500",children:"关闭"})]})});const I=["居住区","审讯区","娱乐区","劳役区","管理区","医疗区"],K=le=>r.prisoners.filter(xe=>xe.location===le),fe=le=>({居住区:"fa-bed",审讯区:"fa-gavel",娱乐区:"fa-gamepad",劳役区:"fa-hammer",管理区:"fa-chart-line",医疗区:"fa-hospital"})[le],ge=le=>({居住区:"blue",审讯区:"red",娱乐区:"green",劳役区:"orange",管理区:"purple",医疗区:"cyan"})[le],O=()=>{const le=r.stats,xe=r.events.slice(-5).reverse();return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"囚犯总数"}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[le.totalPrisoners," / ",r.config.maxPrisoners]})]}),e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"平均屈服度"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:[le.avgSubmission.toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"平均归顺度"}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[le.avgLoyalty.toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"狱卒数量"}),e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:le.totalGuards})]})]}),e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-300 mb-3",children:"财务统计"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"总收入"}),e.jsxs("div",{className:"text-xl font-bold text-green-400",children:[le.totalRevenue," ",e.jsx("span",{className:"text-sm",children:"灵石"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"总支出"}),e.jsxs("div",{className:"text-xl font-bold text-red-400",children:[le.totalExpenses," ",e.jsx("span",{className:"text-sm",children:"灵石"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"净利润"}),e.jsxs("div",{className:`text-xl font-bold ${le.netProfit>=0?"text-green-400":"text-red-400"}`,children:[le.netProfit," ",e.jsx("span",{className:"text-sm",children:"灵石"})]})]})]})]}),e.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-300",children:"最近事件"}),e.jsx("button",{onClick:b,disabled:C,className:"px-3 py-1 text-sm bg-purple-600/80 text-white rounded-md hover:bg-purple-500/80 disabled:opacity-50 transition-colors",children:C?"生成中...":"触发随机事件"})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:xe.length>0?xe.map(pe=>{const Ae=pe.severity==="critical"?"text-red-400":pe.severity==="high"?"text-orange-400":pe.severity==="medium"?"text-yellow-400":"text-gray-400";return e.jsxs("div",{className:"bg-black/20 p-3 rounded border border-stone-700/50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`font-bold ${Ae}`,children:pe.title}),e.jsx("span",{className:"text-xs text-gray-500",children:pe.timestamp})]}),e.jsx("p",{className:"text-sm text-gray-300",children:pe.description}),!pe.resolved&&e.jsx("span",{className:"inline-block mt-2 px-2 py-1 text-xs bg-red-500/20 text-red-400 rounded",children:"未处理"})]},pe.id)}):e.jsx("div",{className:"text-center text-gray-500 py-4",children:"暂无事件记录"})})]})]})},se=le=>{const xe=K(le);return xe.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-10",children:[e.jsx("i",{className:`fa-solid ${fe(le)} text-4xl mb-4 opacity-50`}),e.jsx("p",{children:"此区域暂无囚犯"})]}):e.jsx("div",{className:"space-y-3",children:xe.map(pe=>{const Ae=pe.submissionLevel>70?"text-green-400":pe.submissionLevel>40?"text-yellow-400":"text-red-400";return e.jsx("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700 hover:border-amber-500/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:pe.character.name}),e.jsxs("span",{className:"text-sm text-gray-400",children:[pe.character.gender==="Male"?"♂":"♀"," Lv.",pe.character.realm]}),e.jsx("span",{className:"px-2 py-1 text-xs bg-purple-500/20 text-purple-300 rounded",children:pe.character.rarity})]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:[e.jsx("span",{className:"text-red-300",children:"罪行:"})," ",pe.crime]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"屈服:"}),e.jsxs("span",{className:`ml-1 font-bold ${Ae}`,children:[pe.submissionLevel,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"归顺:"}),e.jsxs("span",{className:`ml-1 font-bold ${pe.loyaltyLevel>70?"text-green-400":"text-gray-400"}`,children:[pe.loyaltyLevel,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"剩余刑期:"}),e.jsxs("span",{className:"ml-1 font-bold text-orange-400",children:[pe.remainingDays,"天"]})]})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:pe.status.map(je=>e.jsx("span",{className:"px-2 py-1 text-xs bg-orange-500/20 text-orange-300 rounded",children:je},je))})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx("button",{onClick:je=>{je.stopPropagation(),J(pe),T(!0)},className:"px-3 py-1 text-sm bg-cyan-600/80 text-white rounded hover:bg-cyan-500/80 transition-colors",children:"详情"}),e.jsxs("button",{onClick:je=>{je.stopPropagation(),U(pe),_(!0)},disabled:C,className:"px-3 py-1 text-sm bg-amber-600/80 text-white rounded hover:bg-amber-500/80 disabled:opacity-50 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-comments mr-1"}),"对话"]}),e.jsx("button",{onClick:je=>{je.stopPropagation(),c(pe)},disabled:C,className:"px-3 py-1 text-sm bg-red-600/80 text-white rounded hover:bg-red-500/80 disabled:opacity-50 transition-colors",children:"审讯"}),e.jsxs("select",{value:pe.location,onChange:je=>{je.stopPropagation(),m(pe,je.target.value)},className:"px-2 py-1 text-xs bg-stone-700 text-white rounded border border-stone-600",onClick:je=>je.stopPropagation(),children:[e.jsx("option",{value:"",disabled:!0,children:"转移到..."}),I.filter(je=>je!==pe.location).map(je=>e.jsx("option",{value:je,children:je},je))]}),pe.loyaltyLevel>=80&&e.jsx("button",{onClick:je=>{je.stopPropagation(),x(pe)},className:"px-3 py-1 text-sm bg-green-600/80 text-white rounded hover:bg-green-500/80 transition-colors",children:"招募"})]})]})},pe.character.id)})})},he=()=>{const le=r.prisoners.filter(je=>!je.status.includes("劳役中")&&je.health>30),xe=je=>{const de=Math.floor(je/1e3),ye=Math.floor(de/60),ke=Math.floor(ye/60);return ke>0?`${ke}小时${ye%60}分钟`:ye>0?`${ye}分钟${de%60}秒`:`${de}秒`},pe=je=>({凡品:"text-gray-400",良品:"text-green-400",优品:"text-blue-400",珍品:"text-purple-400",绝品:"text-orange-400",仙品:"text-red-400",圣品:"text-pink-400",神品:"text-yellow-400"})[je]||"text-gray-400",Ae=je=>{const de=je.maxWorkers-je.workers.length,ye=je.type==="矿山"?"orange":"green";return e.jsxs("div",{className:`bg-black/30 p-4 rounded-lg border-2 border-${ye}-500/30 hover:border-${ye}-500/60 transition-colors`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-xl font-bold text-${ye}-300 flex items-center gap-2`,children:[e.jsx("i",{className:`fa-solid ${je.type==="矿山"?"fa-mountain":"fa-leaf"}`}),je.name]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:je.description})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full ${de>0?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"}`,children:[de,"/",je.maxWorkers," 可用"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[0,1].map(ke=>{const Oe=je.workers[ke];if(Oe){const zt=Math.max(0,Oe.endTime-X),Fe=zt===0,La=(Oe.duration-zt)/Oe.duration*100;return e.jsxs("div",{className:`bg-black/40 p-3 rounded-lg border ${Fe?"border-green-500/50":"border-yellow-500/50"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-bold",children:Oe.prisonerName}),e.jsxs("div",{className:"text-xs text-gray-400",children:["工位 #",ke+1]})]}),Fe?e.jsxs("span",{className:"px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded animate-pulse",children:[e.jsx("i",{className:"fa-solid fa-check mr-1"}),"完成"]}):e.jsxs("span",{className:"px-2 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded",children:[e.jsx("i",{className:"fa-solid fa-clock mr-1"}),"劳役中"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"进度"}),e.jsx("span",{children:Fe?"已完成":xe(zt)})]}),e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${Fe?"bg-green-500":"bg-yellow-500"}`,style:{width:`${La}%`}})})]}),Fe&&g&&e.jsxs("button",{onClick:()=>g(je.id,Oe.prisonerId),className:"w-full px-3 py-1.5 text-sm bg-green-600/80 text-white rounded hover:bg-green-500/80 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-gift mr-2"}),"领取奖励"]})]},ke)}else return e.jsx("div",{className:"bg-black/20 p-3 rounded-lg border border-dashed border-stone-600",children:e.jsxs("div",{className:"text-center text-gray-500 py-4",children:[e.jsx("i",{className:"fa-solid fa-user-plus text-2xl mb-2 opacity-50"}),e.jsxs("div",{className:"text-sm",children:["工位 #",ke+1]}),e.jsx("div",{className:"text-xs",children:"空闲中"})]})},ke)})}),de>0&&le.length>0&&e.jsxs("div",{className:"border-t border-stone-700 pt-3",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"分配囚犯到此劳役点："}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:k===je.id?k:"",onChange:ke=>Q(ke.target.value||null),className:"flex-grow px-3 py-2 bg-stone-700 text-white rounded border border-stone-600 text-sm",children:[e.jsx("option",{value:"",children:"选择囚犯..."}),le.map(ke=>e.jsxs("option",{value:ke.character.id,children:[ke.character.name," (健康:",ke.health,"%)"]},ke.character.id))]}),e.jsxs("select",{value:ne,onChange:ke=>Y(Number(ke.target.value)),className:"px-3 py-2 bg-stone-700 text-white rounded border border-stone-600 text-sm",children:[e.jsx("option",{value:18e5,children:"30分钟"}),e.jsx("option",{value:36e5,children:"1小时"}),e.jsx("option",{value:72e5,children:"2小时"}),e.jsx("option",{value:144e5,children:"4小时"}),e.jsx("option",{value:288e5,children:"8小时"})]}),e.jsxs("button",{onClick:()=>{if(k){const ke=le.find(Oe=>Oe.character.id===k);ke&&(h(ke.character.id,je.id,ne),Q(null))}},disabled:!k,className:"px-4 py-2 bg-blue-600/80 text-white rounded hover:bg-blue-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:[e.jsx("i",{className:"fa-solid fa-play mr-1"}),"开始劳役"]})]})]}),de>0&&le.length===0&&e.jsxs("div",{className:"border-t border-stone-700 pt-3 text-center text-gray-500 text-sm",children:[e.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"暂无可分配的囚犯（需要健康值大于30%且未在劳役中）"]})]},je.id)};return e.jsxs("div",{className:"space-y-4",children:[r.materialInventory&&r.materialInventory.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-purple-900/20 p-4 rounded-lg border border-amber-500/30",children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-box-open"}),"材料库存"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:r.materialInventory.map((je,de)=>e.jsxs("div",{className:"bg-black/40 p-3 rounded border border-stone-700/50",children:[e.jsx("div",{className:`font-bold ${pe(je.material.rarity)}`,children:je.material.name}),e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:je.material.type==="ore"?"矿石":"草药"}),e.jsxs("div",{className:"text-sm text-white",children:["数量: ",e.jsx("span",{className:"font-bold text-green-400",children:je.quantity})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["价值: ",je.material.value," 灵石/个"]})]},`${je.material.id}-${de}`))})]}),e.jsx("div",{className:"space-y-4",children:r.laborSites.map(je=>Ae(je))}),e.jsxs("div",{className:"bg-blue-900/20 p-4 rounded-lg border border-blue-500/30",children:[e.jsxs("h4",{className:"text-sm font-bold text-blue-300 mb-2",children:[e.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"劳役系统说明"]}),e.jsxs("ul",{className:"text-xs text-gray-400 space-y-1",children:[e.jsx("li",{children:"• 每个劳役点最多可同时安排2名囚犯工作"}),e.jsx("li",{children:"• 囚犯健康值必须大于30%才能参与劳役"}),e.jsx("li",{children:"• 劳役使用真实时间计时，可选择30分钟到8小时不等"}),e.jsx("li",{children:"• 完成后可获得2种随机材料（矿石或草药），每种25-50个"}),e.jsx("li",{children:"• 材料的名称、稀有度和描述由AI生成"}),e.jsx("li",{children:"• 劳役会消耗囚犯10-30点健康值，但会获得50-150经验"})]})]})]})};return e.jsxs("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:[e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:le=>le.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-dungeon"}),"镇狱大牢"]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["囚犯: ",r.stats.totalPrisoners,"/",r.config.maxPrisoners," | 安全等级: ",r.config.securityLevel,"/10"]})]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[e.jsx("div",{className:"w-48 bg-black/20 border-r border-stone-700 flex-shrink-0",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 mb-3 uppercase",children:"区域"}),e.jsx("div",{className:"space-y-1",children:I.map(le=>{const xe=ge(le),pe=Z===le,Ae=K(le).length;return e.jsxs("button",{onClick:()=>R(le),className:`w-full text-left px-3 py-2 rounded-md transition-colors flex items-center justify-between ${pe?`bg-${xe}-500/20 text-${xe}-300 border border-${xe}-500/50`:"text-gray-400 hover:bg-stone-700/50"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${fe(le)}`}),le]}),le!=="管理区"&&e.jsx("span",{className:"text-xs bg-black/30 px-2 py-1 rounded",children:Ae})]},le)})})]})}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("i",{className:`fa-solid ${fe(Z)}`}),Z]}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[Z==="居住区"&&"囚犯的日常居住区域，按危险程度分配不同牢房",Z==="审讯区"&&"对囚犯进行审讯和刑罚执行的地方",Z==="娱乐区"&&"囚犯的休闲和思想改造区域",Z==="劳役区"&&"囚犯进行强制劳动的区域",Z==="管理区"&&"监狱管理和运营中心，查看整体统计",Z==="医疗区"&&"治疗受伤和生病的囚犯"]})]}),Z==="管理区"?O():Z==="劳役区"?he():se(Z)]})]})]}),D&&V&&e.jsx(Wi,{card:V.character,onClose:()=>{T(!1),J(null)},playerProfile:A,setPlayerProfile:E,onViewPet:$}),G&&M&&e.jsx(Zy,{isOpen:G,onClose:()=>{_(!1),U(null)},prisoner:M,playerSpiritStones:(A==null?void 0:A.spiritStones)||0,onDialogueComplete:le=>{y&&M&&y(M,le)},onGenerateResponse:async(le,xe)=>{if(S)return await S(le,xe);const Ae={威胁:["哼，你以为这样就能让我屈服吗？","我...我不会说的...","你们这些人，迟早会遭报应的！"],劝说:["你说的...或许有些道理...","我需要时间考虑...","你真的能保证吗？"],交易:["这个条件...让我想想...","你能给我什么保证？","也许我们可以谈谈..."],套话:["你想知道什么？","我不知道你在说什么...","这个...我不太清楚..."],闲聊:["难得有人愿意和我说话...","外面的世界...还好吗？","你为什么要来这里？"],恩惠:["你...为什么要帮我？","谢谢你...","我不知道该说什么..."],羞辱:["你！你会后悔的！","...","我不会忘记这一切的..."]}[xe.type]||["..."];return Ae[Math.floor(Math.random()*Ae.length)]},isLoading:C})]})},Fy=({isOpen:i,onClose:l,quests:r,playerProfile:c,onClaimReward:d})=>{const[m,f]=v.useState("Main"),[x,h]=v.useState(null);if(!i)return null;const g=r.filter(C=>m==="Completed"?C.status==="Completed"||C.status==="Claimable":C.category===m&&C.status!=="Completed"&&C.status!=="Claimable"),b=({quest:C})=>e.jsxs("li",{onClick:()=>h(C),className:`p-3 cursor-pointer rounded-md transition-colors ${(x==null?void 0:x.id)===C.id?"bg-amber-500/20":"hover:bg-stone-700/50"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-white",children:C.title}),e.jsx("p",{className:"text-xs text-gray-400",children:C.status==="Claimable"?"可领取":C.status})]}),C.status==="Claimable"&&e.jsx("i",{className:"fa-solid fa-gift text-amber-400 animate-pulse"})]},C.id),y=({quest:C})=>{var A;return C?e.jsxs("div",{className:"flex-1 p-6 bg-black/20 rounded-lg overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold text-amber-300 font-serif mb-4",children:C.title}),e.jsxs("p",{className:"text-gray-300 mb-6 italic",children:['"',C.description,'"']}),e.jsx("h4",{className:"font-bold text-white mb-3",children:"任务目标"}),e.jsx("ul",{className:"space-y-2 mb-6",children:C.objectives.map(E=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("i",{className:`fa-solid ${E.isCompleted?"fa-check-square text-green-500":"fa-square text-gray-500"} mr-3`}),e.jsxs("span",{className:`${E.isCompleted?"line-through text-gray-500":"text-gray-300"}`,children:[E.description," ",E.targetCount?`(${E.currentCount}/${E.targetCount})`:""]})]},E.id))}),e.jsx("h4",{className:"font-bold text-white mb-3",children:"任务奖励"}),e.jsxs("div",{className:"space-y-2 mb-6",children:[C.rewards.spiritStones&&e.jsxs("div",{className:"flex items-center text-amber-300",children:[e.jsx("i",{className:"fa-solid fa-coins mr-2"}),e.jsxs("span",{children:["灵石 x ",C.rewards.spiritStones]})]}),C.rewards.reputation&&e.jsxs("div",{className:"flex items-center text-purple-300",children:[e.jsx("i",{className:"fa-solid fa-star mr-2"}),e.jsxs("span",{children:["声望 +",C.rewards.reputation]})]}),(A=C.rewards.items)==null?void 0:A.map((E,$)=>e.jsxs("div",{className:"flex items-center text-green-300",children:[e.jsx("i",{className:"fa-solid fa-box mr-2"}),e.jsx("span",{children:E.name})]},$))]}),C.status==="Claimable"&&e.jsxs("button",{onClick:()=>d(C.id),className:"w-full py-3 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-bold rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105 flex items-center justify-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-gift"}),e.jsx("span",{children:"领取奖励"})]}),C.status==="Completed"&&e.jsxs("div",{className:"w-full py-3 bg-gray-600 text-gray-400 font-bold rounded-lg text-center",children:[e.jsx("i",{className:"fa-solid fa-check mr-2"}),e.jsx("span",{children:"已领取"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsx("p",{children:"从左侧选择一个任务以查看详情"})})},S=({tab:C,label:A})=>e.jsx("button",{onClick:()=>f(C),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${m===C?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:A});return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-5xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"任务日志"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[e.jsx(S,{tab:"Main",label:"主线任务"}),e.jsx(S,{tab:"Side",label:"支线任务"}),e.jsx(S,{tab:"Sect",label:"宗门任务"}),e.jsx(S,{tab:"Completed",label:"已完成"})]}),e.jsxs("div",{className:"flex-grow flex p-6 space-x-6 overflow-hidden",children:[e.jsx("div",{className:"w-1/3 flex-shrink-0 bg-black/20 rounded-lg p-4 overflow-y-auto",children:e.jsx("ul",{className:"space-y-2",children:g.length>0?g.map(C=>e.jsx(b,{quest:C},C.id)):e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"此分类下暂无任务。"})})}),e.jsx(y,{quest:x})]})]})})},Wy=({event:i,onChoice:l,resultText:r})=>e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg shadow-2xl flex flex-col",children:[e.jsx("div",{className:"p-4 text-center bg-black/20",children:e.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:i.title})}),e.jsx("div",{className:"p-6 font-serif min-h-[15rem] flex flex-col justify-center",children:r?e.jsx("div",{className:"text-center animate-fade-in",children:e.jsx("p",{className:"text-amber-300 text-lg leading-relaxed",children:r})}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap mb-6 text-center leading-relaxed",children:i.story}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:i.choices.map((c,d)=>e.jsx("button",{onClick:()=>l(c),className:"w-full sm:w-auto bg-stone-700/80 px-5 py-3 rounded-md hover:bg-stone-600/80 hover:border-amber-400/50 border border-transparent transition-all duration-200 font-serif shadow-md",children:c.text},d))})]})})]})}),ev=({isOpen:i,onClose:l,reputation:r,isLoading:c,onRefresh:d})=>{const[m,f]=v.useState("summary");if(!i)return null;const x=b=>{switch(b){case"名垂青史":return"text-yellow-300 animate-glow";case"威震一方":return"text-red-400";case"声名远扬":return"text-sky-400";case"小有名气":return"text-green-400";default:return"text-gray-400"}},h=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:`text-4xl font-bold font-serif ${x(r.level)}`,children:r.level}),e.jsxs("p",{className:"text-lg text-gray-400 font-mono",children:[r.score," 声望"]})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"江湖称号"}),r.title?e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx("span",{className:"px-3 py-1 bg-rose-800/50 text-rose-300 rounded-full border border-rose-700",children:r.title})}):e.jsx("p",{className:"text-gray-500 italic",children:"尚未获得任何称号。"})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-green-400 mb-3 text-lg",children:"侠义之举"}),r.goodDeeds&&r.goodDeeds.length>0?e.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:r.goodDeeds.map((b,y)=>e.jsx("li",{children:b},y))}):e.jsx("p",{className:"text-gray-500 italic",children:"尚未有侠义之举流传。"})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-red-400 mb-3 text-lg",children:"恶行昭彰"}),r.badDeeds&&r.badDeeds.length>0?e.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:r.badDeeds.map((b,y)=>e.jsx("li",{children:b},y))}):e.jsx("p",{className:"text-gray-500 italic",children:"你似乎还未犯下什么大错。"})]}),e.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[e.jsx("h4",{className:"font-semibold text-pink-400 mb-3 text-lg",children:"风流韵事"}),r.lewdDeeds&&r.lewdDeeds.length>0?e.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:r.lewdDeeds.map((b,y)=>e.jsx("li",{children:b},y))}):e.jsx("p",{className:"text-gray-500 italic",children:"江湖上还没有关于你的风流传说。"})]})]}),g=()=>e.jsx("div",{className:"space-y-4",children:r.history&&r.history.length>0?r.history.map(b=>e.jsxs("div",{className:"bg-black/20 p-3 rounded-lg border border-stone-700/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-gray-300",children:b.description}),e.jsx("span",{className:`font-mono text-lg ${b.scoreChange>=0?"text-green-400":"text-red-400"}`,children:b.scoreChange>=0?`+${b.scoreChange}`:b.scoreChange})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:b.timestamp})]},b.id)):e.jsx("p",{className:"text-gray-500 italic text-center pt-8",children:"声望历史一片空白。"})});return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"声望"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:d,disabled:c,className:"px-4 py-2 text-sm font-semibold bg-amber-600 text-white rounded-lg hover:bg-amber-500 transition-colors disabled:bg-stone-600 disabled:cursor-not-allowed",children:c?"刷新中...":"刷新情报"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),e.jsx("div",{className:"border-b border-stone-700 px-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>f("summary"),className:`py-2 px-4 text-sm font-semibold transition-colors ${m==="summary"?"text-amber-400 border-b-2 border-amber-400":"text-gray-400 hover:text-white"}`,children:"声望总览"}),e.jsx("button",{onClick:()=>f("history"),className:`py-2 px-4 text-sm font-semibold transition-colors ${m==="history"?"text-amber-400 border-b-2 border-amber-400":"text-gray-400 hover:text-white"}`,children:"声望历史"})]})}),e.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:c&&m==="summary"?e.jsx("div",{className:"text-center text-amber-300 animate-glow p-8",children:"正在获取天机阁的最新情报..."}):m==="summary"?h():g()})]})})},tv=({isOpen:i,onClose:l,onSave:r,onLoad:c,onExport:d,onImport:m,onDelete:f,getSaves:x})=>{const[h,g]=v.useState({}),[b,y]=v.useState("save"),[S,C]=v.useState(null),[A,E]=v.useState(null),[$,Z]=v.useState(""),R=Zi.useRef(null),V=k=>{var Y;const Q=(Y=k.target.files)==null?void 0:Y[0];if(!Q)return;const ne=new FileReader;ne.onload=X=>{var L;try{const I=(L=X.target)==null?void 0:L.result;if(typeof I!="string")throw new Error("文件不是有效的文本文件。");const K=JSON.parse(I);K.name&&K.timestamp&&K.gameState?(m(K),J()):alert("无效的存档文件格式。")}catch(I){console.error("导入存档失败:",I),alert("导入失败，文件可能已损坏或格式不正确。")}},ne.readAsText(Q),R.current&&(R.current.value="")},J=v.useCallback(async()=>{const k=await x();g(k)},[x]);if(v.useEffect(()=>{i&&J()},[i,J]),!i)return null;const D=k=>{const Q=h[k],ne=(Q==null?void 0:Q.name)||`存档 ${k}`;E(k),Z(ne)},T=async k=>{$.trim()&&(r(k,$.trim()),E(null),Z(""),setTimeout(()=>J(),200))},G=async k=>{await f(k),C(null),J()},_=k=>{const Q=new Date(k),ne=Q.getFullYear(),Y=String(Q.getMonth()+1).padStart(2,"0"),X=String(Q.getDate()).padStart(2,"0"),L=String(Q.getHours()).padStart(2,"0"),I=String(Q.getMinutes()).padStart(2,"0"),K=String(Q.getSeconds()).padStart(2,"0");return`${ne}-${Y}-${X} ${L}:${I}:${K}`},M=k=>{if(!k)return"";const{playerProfile:Q,exploration:ne}=k.gameState;return`${Q.name} | ${ne.location} | 灵石: ${Q.spiritStones}`},U=k=>{const Q=h[k],ne=!Q,Y=A===k;return e.jsxs("div",{className:`relative group bg-gradient-to-br ${ne?"from-stone-800/40 to-stone-900/40":"from-stone-800/80 to-stone-900/80"} rounded-xl p-5 border-2 transition-all duration-300 ${ne?"border-stone-700/30 hover:border-stone-600/50":"border-amber-900/50 hover:border-amber-700/70 hover:shadow-xl hover:shadow-amber-900/20"}`,children:[e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-white font-bold text-sm",children:k})})}),e.jsx("div",{className:"ml-10 mb-3",children:Y?e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",value:$,onChange:X=>Z(X.target.value),onKeyPress:X=>{X.key==="Enter"&&T(k),X.key==="Escape"&&(E(null),Z(""))},className:"flex-1 px-3 py-2 bg-stone-900/80 border border-amber-700/50 rounded-lg text-white font-serif focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20",placeholder:"输入存档名称...",autoFocus:!0}),e.jsx("button",{onClick:()=>T(k),className:"px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-semibold transition-colors",children:"确定"}),e.jsx("button",{onClick:()=>{E(null),Z("")},className:"px-4 py-2 bg-stone-600 hover:bg-stone-500 rounded-lg text-white font-semibold transition-colors",children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-200 font-serif mb-1 flex items-center gap-2",children:[Q?Q.name:`空存档位 ${k}`,!ne&&b==="save"&&e.jsxs("button",{onClick:()=>D(k),className:"text-xs px-2 py-1 bg-amber-700/50 hover:bg-amber-600/50 rounded text-amber-200 transition-colors",title:"重命名",children:[e.jsx("i",{className:"fa-solid fa-pen-to-square mr-1"}),"改名"]})]}),Q?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-amber-300/80 font-mono mb-1",children:[e.jsx("i",{className:"fa-solid fa-clock mr-1"}),_(Q.timestamp)]}),e.jsxs("p",{className:"text-xs text-stone-400 line-clamp-1",children:[e.jsx("i",{className:"fa-solid fa-gamepad mr-1"}),M(Q)]})]}):e.jsx("p",{className:"text-sm text-stone-500 italic",children:'点击"存档"按钮创建新存档'})]})}),!Y&&e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2",children:[b==="save"?e.jsxs("button",{onClick:()=>D(k),className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-sky-600 to-sky-700 hover:from-sky-500 hover:to-sky-600 rounded-lg font-bold text-white transition-all duration-200 shadow-lg hover:shadow-sky-500/30 transform hover:scale-105",children:[e.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"}),ne?"新建存档":"覆盖存档"]}):e.jsxs("button",{onClick:()=>c(k),disabled:ne,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-lg font-bold text-white transition-all duration-200 shadow-lg hover:shadow-green-500/30 transform hover:scale-105 disabled:from-stone-700 disabled:to-stone-800 disabled:text-stone-500 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none",children:[e.jsx("i",{className:"fa-solid fa-folder-open mr-2"}),"读取存档"]}),e.jsx("button",{onClick:()=>d(k),disabled:ne,className:"w-11 h-11 rounded-lg font-semibold text-white bg-purple-700 hover:bg-purple-600 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-purple-500/30 disabled:bg-stone-700 disabled:text-stone-500 disabled:cursor-not-allowed disabled:shadow-none",title:"导出存档",children:e.jsx("i",{className:"fa-solid fa-download"})}),e.jsx("button",{onClick:()=>C(k),disabled:ne,className:"w-11 h-11 rounded-lg font-semibold text-white bg-red-800 hover:bg-red-700 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-red-500/30 disabled:bg-stone-700 disabled:text-stone-500 disabled:cursor-not-allowed disabled:shadow-none",title:"删除存档",children:e.jsx("i",{className:"fa-solid fa-trash-can"})})]}),S===k&&Q&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:()=>C(null),children:e.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 border-2 border-red-600/50 rounded-xl w-full max-w-md shadow-2xl p-6 text-center font-serif",onClick:X=>X.stopPropagation(),children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-600/20 flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-triangle-exclamation text-red-500 text-3xl"})}),e.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:"确认删除"}),e.jsx("p",{className:"text-gray-300 mb-2",children:"你确定要永久删除存档"}),e.jsxs("p",{className:"text-xl font-bold text-amber-300 mb-1",children:['"',Q.name,'"']}),e.jsx("p",{className:"text-sm text-stone-400 mb-6",children:"此操作无法撤销！"}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("button",{onClick:()=>C(null),className:"px-6 py-2.5 bg-stone-600 hover:bg-stone-500 rounded-lg font-semibold text-white transition-colors shadow-lg",children:[e.jsx("i",{className:"fa-solid fa-xmark mr-2"}),"取消"]}),e.jsxs("button",{onClick:()=>G(k),className:"px-6 py-2.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-lg font-bold text-white transition-all shadow-lg hover:shadow-red-500/30",children:[e.jsx("i",{className:"fa-solid fa-trash-can mr-2"}),"确认删除"]})]})]})})]},k)};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-gradient-to-br from-stone-900 to-black w-full max-w-4xl h-auto max-h-[85vh] rounded-2xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col border-2 border-amber-900/50",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-5 flex-shrink-0 bg-gradient-to-r from-amber-900/40 to-stone-900/40 border-b-2 border-amber-900/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg",children:e.jsx("i",{className:"fa-solid fa-floppy-disk text-white text-lg"})}),e.jsx("h2",{className:"text-3xl font-bold text-amber-300 font-serif",children:"存档管理"})]}),e.jsx("button",{onClick:l,className:"w-10 h-10 rounded-full bg-stone-700 hover:bg-stone-600 transition-colors flex items-center justify-center text-amber-300 hover:text-white",children:e.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 px-6 pt-4 flex space-x-2",children:[e.jsxs("button",{onClick:()=>y("save"),className:`flex-1 px-6 py-3 text-base font-bold rounded-t-xl transition-all duration-200 ${b==="save"?"bg-gradient-to-b from-amber-700 to-amber-800 text-white shadow-lg border-2 border-amber-600 border-b-0":"bg-stone-800/50 text-stone-400 hover:bg-stone-700/70 hover:text-stone-200 border-2 border-stone-700 border-b-0"}`,children:[e.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"}),"保存游戏"]}),e.jsxs("button",{onClick:()=>y("load"),className:`flex-1 px-6 py-3 text-base font-bold rounded-t-xl transition-all duration-200 ${b==="load"?"bg-gradient-to-b from-green-700 to-green-800 text-white shadow-lg border-2 border-green-600 border-b-0":"bg-stone-800/50 text-stone-400 hover:bg-stone-700/70 hover:text-stone-200 border-2 border-stone-700 border-b-0"}`,children:[e.jsx("i",{className:"fa-solid fa-folder-open mr-2"}),"读取存档"]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-4 custom-scrollbar",children:[1,2,3,4,5].map(k=>U(k))}),e.jsxs("div",{className:"p-5 bg-gradient-to-r from-stone-900/60 to-black/60 border-t-2 border-stone-700/50 flex-shrink-0",children:[e.jsx("input",{type:"file",ref:R,onChange:V,className:"hidden",accept:"application/json"}),e.jsxs("button",{onClick:()=>{var k;return(k=R.current)==null?void 0:k.click()},className:"w-full px-6 py-3 rounded-xl font-bold text-white bg-gradient-to-r from-purple-700 to-purple-800 hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-purple-500/30 transform hover:scale-[1.02]",children:[e.jsx("i",{className:"fa-solid fa-file-import mr-2"}),"从文件导入存档"]}),e.jsxs("p",{className:"text-center text-xs text-stone-500 mt-3 font-mono",children:[e.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"纯手动存档系统 - 不会自动保存游戏进度"]})]})]})})},sv=({story:i,storyEndRef:l})=>e.jsxs("div",{className:"w-full max-w-4xl h-full max-h-[70vh] scrollbar-enhanced overflow-y-auto p-6 bg-stone-950/70 rounded-xl border border-stone-700/50 shadow-2xl backdrop-blur-md",children:[e.jsx("div",{className:"prose max-w-none prose-p:text-gray-200 prose-p:leading-loose prose-headings:text-amber-400 prose-strong:text-amber-200 font-serif whitespace-pre-wrap animate-fade-in text-lg",children:i}),e.jsx("div",{ref:l})]}),av=({isOpen:i,onClose:l,shop:r,cardCollection:c})=>{const[d,m]=v.useState(null),[f,x]=v.useState(""),[h,g]=v.useState(!1),[b,y]=v.useState(!1),[S,C]=v.useState(""),[A,E]=v.useState([]),[$,Z]=v.useState(!1);if(!i)return null;const R=()=>{y(!0),E([]),C("")},V=async()=>{if(!d||!S.trim())return;const T=[...A,{role:"user",content:S}];E(T),Z(!0);try{const G=T.slice(-6).map(k=>`${k.role==="user"?"玩家":d.name}: ${k.content}`).join(`
`),_=Object.entries(fr).find(([k])=>{const Q=r.staff.find(ne=>ne.positionId===k);return(Q==null?void 0:Q.characterId)===d.id}),M=_?_[1].name:"未知岗位",U=await ey(d,M,S,G);E([...T,{role:"ai",content:U}]),C(""),st.setCurrentScene("surveillance"),st.captureMessage(U,"surveillance")}catch(G){console.error("互动生成失败:",G),alert("互动失败，请重试")}finally{Z(!1)}},J=()=>{y(!1),E([]),C("")},D=async(T,G)=>{m(T),g(!0),x("");try{const _=await Wb(T,G);x(_)}catch(_){console.error("Failed to generate surveillance report:",_),x("监视水晶似乎被一股神秘的力量干扰了...")}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-3xl h-[70vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[e.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["监视 ",r.type]}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-grow p-6 flex gap-6 overflow-hidden",children:[e.jsx("div",{className:"w-1/3 flex-shrink-0 space-y-3 overflow-y-auto",children:Object.entries(fr).filter(([,T])=>T.shop===r.type).map(([T,G])=>{const _=r.staff.find(U=>U.positionId===T),M=_?c.find(U=>U.id===_.characterId):null;return e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-400 font-semibold mb-1",children:G.name}),M?e.jsx("button",{onClick:()=>D(M,G.name),className:`w-full text-left p-2 rounded-md transition-colors ${(d==null?void 0:d.id)===M.id?"bg-amber-600/50":"bg-stone-800/70 hover:bg-stone-700/90"}`,children:M.name}):e.jsx("div",{className:"p-2 text-gray-500 italic text-sm",children:"空缺"})]},T)})}),e.jsx("div",{className:"w-2/3 bg-black/30 rounded-lg p-4 overflow-y-auto border border-stone-700",children:b?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-stone-600",children:[e.jsxs("h3",{className:"text-amber-400 font-semibold",children:["与 ",d==null?void 0:d.name," 互动"]}),e.jsx("button",{onClick:J,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto mb-3 space-y-2",children:[A.length===0?e.jsxs("p",{className:"text-center text-gray-500 italic",children:["开始与",d==null?void 0:d.name,"交流..."]}):A.map((T,G)=>e.jsxs("div",{className:`p-2 rounded ${T.role==="user"?"bg-blue-900/30 ml-8":"bg-amber-900/20 mr-8"}`,children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:T.role==="user"?"你":d==null?void 0:d.name}),e.jsx("div",{className:"text-gray-200 text-sm whitespace-pre-wrap",children:T.content})]},G)),$&&e.jsxs("div",{className:"text-center text-amber-300 animate-pulse",children:[d==null?void 0:d.name," 正在回应..."]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:T=>C(T.target.value),onKeyPress:T=>T.key==="Enter"&&!$&&V(),disabled:$,placeholder:"输入你想说的话...",className:"flex-1 bg-stone-800 text-gray-200 px-3 py-2 rounded border border-stone-600 focus:border-amber-500 focus:outline-none disabled:opacity-50"}),e.jsx("button",{onClick:V,disabled:!S.trim()||$,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition-colors",children:$?"生成中...":"发送"})]})]}):e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"text-center text-amber-300 animate-pulse",children:"正在通过水晶窥探..."}):f?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap font-serif leading-relaxed mb-4",children:f}),d&&e.jsxs("button",{onClick:R,className:"w-full mt-4 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-comments"}),e.jsx("span",{children:"参与互动"})]})]}):e.jsx("div",{className:"text-center text-gray-500 h-full flex items-center justify-center",children:e.jsx("p",{children:"选择一名员工进行监视。"})})})})]})]})})},nv=({isOpen:i,onClose:l,playerProfile:r})=>{const[c,d]=v.useState([]),[m,f]=v.useState(null),[x,h]=v.useState([]),[g,b]=v.useState(""),[y,S]=v.useState(!1);if(v.useEffect(()=>{if(i){const A=r.relationships.filter(E=>E.relationshipStatus==="熟人");d(A),A.length>0?f(A[0]):f(null),h([]),b("")}},[i,r.relationships]),!i)return null;const C=async()=>{if(g.trim()&&!y&&m){const A={sender:"user",text:g},E=[...x,A];h(E),b(""),S(!0);try{const $=await oy(r,m,E);h(Z=>[...Z,{sender:"ai",text:$}])}catch($){console.error("传音失败:",$),h(Z=>[...Z,{sender:"ai",text:"...信号中断..."}])}finally{S(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border-dialog bg-stone-900/90 backdrop-blur-lg w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl flex",onClick:A=>A.stopPropagation(),children:[e.jsxs("div",{className:"w-1/3 border-r-2 border-amber-500/10 flex flex-col bg-black/20",children:[e.jsx("h3",{className:"text-xl font-bold text-amber-200 p-4 border-b-2 border-amber-500/10 text-center font-serif tracking-widest",children:"传音玉简"}),e.jsx("ul",{className:"flex-grow overflow-y-auto scrollbar-thin scrollbar-thumb-amber-700/50 scrollbar-track-transparent",children:c.length>0?c.map(A=>e.jsxs("li",{className:`p-4 flex items-center cursor-pointer hover:bg-amber-500/10 transition-colors duration-200 border-b border-amber-500/5 ${(m==null?void 0:m.id)===A.id?"bg-amber-500/20":""}`,onClick:()=>f(A),children:[e.jsx("i",{className:"fa-solid fa-user-circle text-2xl mr-4 text-amber-300/70"}),e.jsx("span",{className:"text-lg text-gray-200 font-serif",children:A.name})]},A.id)):e.jsx("li",{className:"p-4 text-center text-gray-500",children:"暂无熟人"})})]}),e.jsx("div",{className:"w-2/3 flex flex-col bg-stone-800/30",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b-2 border-amber-500/10 flex justify-between items-center bg-black/20",children:[e.jsx("h3",{className:"text-xl font-bold text-amber-200 font-serif tracking-wider",children:m.name}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),e.jsx("div",{className:"flex-grow p-4 overflow-y-auto space-y-4 scrollbar-thin scrollbar-thumb-amber-700/50 scrollbar-track-transparent",children:x.map((A,E)=>e.jsxs("div",{className:`flex items-start gap-3 animate-fade-in-up ${A.sender==="user"?"justify-end":"justify-start"}`,children:[A.sender==="ai"&&e.jsx("i",{className:"fa-solid fa-user-circle text-2xl text-amber-300/70 mt-1"}),e.jsx("div",{className:`max-w-xs lg:max-w-md p-3 rounded-lg font-serif shadow-md ${A.sender==="user"?"bg-blue-900/60 text-white rounded-br-none":"bg-stone-700/60 text-gray-200 rounded-bl-none"}`,children:A.text}),A.sender==="user"&&e.jsx("i",{className:"fa-solid fa-user-circle text-2xl text-blue-300/70 mt-1"})]},E))}),e.jsx("div",{className:"p-4 border-t-2 border-amber-500/10 bg-black/20",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"text",value:g,onChange:A=>b(A.target.value),onKeyPress:A=>A.key==="Enter"&&C(),className:"w-full bg-stone-800/80 border border-amber-500/30 rounded-l-md p-3 text-gray-200 focus:outline-none focus:ring-1 focus:ring-amber-400 font-serif",placeholder:y?"对方正在输入...":"输入传音内容...",disabled:y}),e.jsx("button",{onClick:C,disabled:y||!g.trim(),className:"bg-amber-600 text-white px-5 py-3 rounded-r-md hover:bg-amber-500 transition-colors font-semibold disabled:bg-stone-600 disabled:cursor-not-allowed flex items-center justify-center w-20",children:y?e.jsx("i",{className:"fas fa-spinner fa-pulse"}):e.jsx("i",{className:"fa-solid fa-paper-plane"})})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-comments text-4xl mb-4"}),e.jsx("p",{children:"请先从左侧选择一位熟人开始传音"})]})})]})})},sf=()=>{const i=document;return i.fullscreenElement||i.webkitFullscreenElement||i.mozFullScreenElement||i.msFullscreenElement},lv=i=>{const l=i;l.requestFullscreen?l.requestFullscreen():l.webkitRequestFullscreen?l.webkitRequestFullscreen():l.mozRequestFullScreen?l.mozRequestFullScreen():l.msRequestFullscreen&&l.msRequestFullscreen()},rv=()=>{const i=document;i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen?i.webkitExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.msExitFullscreen&&i.msExitFullscreen()},iv=i=>{const[l,r]=v.useState(!!sf()),c=v.useCallback(()=>{r(!!sf())},[]);v.useLayoutEffect(()=>(document.addEventListener("fullscreenchange",c),document.addEventListener("webkitfullscreenchange",c),document.addEventListener("mozfullscreenchange",c),document.addEventListener("MSFullscreenChange",c),()=>{document.removeEventListener("fullscreenchange",c),document.removeEventListener("webkitfullscreenchange",c),document.removeEventListener("mozfullscreenchange",c),document.removeEventListener("MSFullscreenChange",c)}),[c]);const d=v.useCallback(()=>{l?rv():i.current&&lv(i.current)},[l,i]);return{isFullscreen:l,toggleFullscreen:d}},ov=({playerProfile:i,location:l,onProfileClick:r,appRef:c})=>{const d=jf(),m=sb(),{isFullscreen:f,toggleFullscreen:x}=iv(c);return d.shouldHideTopBar&&!f?null:d.isCompact?e.jsxs("header",{className:`fixed top-0 left-0 right-0 h-12 bg-gradient-to-b from-black/90 to-black/60 backdrop-blur-sm px-2 flex justify-between items-center z-30 font-serif text-xs transition-transform duration-300 ${m?"-translate-y-full":"translate-y-0"}`,children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 bg-black/40 px-2 py-1 rounded-full border border-yellow-400/20 hover:bg-black/60 transition-all active:scale-95",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-700/80 flex items-center justify-center text-yellow-400 text-xs",children:e.jsx("i",{className:"fa-solid fa-user"})}),e.jsx("span",{className:"text-white font-semibold text-xs",children:i.name})]}),e.jsx("div",{className:"bg-black/40 px-3 py-1 rounded-full border border-yellow-400/20",children:e.jsx("p",{className:"text-white font-semibold text-xs",children:l})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-black/40 px-2 py-1 rounded-full border border-yellow-400/20",children:[e.jsx("i",{className:"fa-solid fa-gem text-yellow-400 text-sm"}),e.jsx("span",{className:"text-white font-bold text-xs",children:i.spiritStones})]}),e.jsx("button",{onClick:x,className:"w-8 h-8 flex items-center justify-center bg-black/40 rounded-full border border-yellow-400/20 hover:bg-black/60 transition-all active:scale-95",children:e.jsx("i",{className:`fa-solid ${f?"fa-compress":"fa-expand"} text-yellow-400 text-sm`})})]})]}):e.jsxs("header",{className:`fixed top-0 left-0 right-0 h-16 bg-gradient-to-b from-black/80 to-transparent backdrop-blur-sm p-3 flex justify-between items-center z-30 font-serif text-sm transition-transform duration-300 ${m?"-translate-y-full":"translate-y-0"}`,children:[e.jsx("div",{className:"flex items-center gap-4 pointer-events-auto",children:e.jsxs("button",{onClick:r,className:"flex items-center gap-3 bg-black/50 p-2 pr-4 rounded-full border border-yellow-400/20 hover:bg-black/70 transition-all duration-200 active:scale-95 shadow-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-yellow-400 border border-yellow-400/30",children:e.jsx("i",{className:"fa-solid fa-user"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-white",children:i.name}),e.jsx("p",{className:"text-xs text-yellow-300",children:i.title})]})]})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bg-black/50 px-6 py-2 rounded-full border border-yellow-400/20 shadow-lg backdrop-blur-sm",children:e.jsx("p",{className:"text-white font-semibold whitespace-nowrap",children:l})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-black/50 p-2 pl-4 rounded-full border border-yellow-400/20 shadow-lg pointer-events-auto backdrop-blur-sm",children:[e.jsx("i",{className:"fa-solid fa-gem text-yellow-400 text-lg"}),e.jsx("span",{className:"text-white font-bold text-lg",children:i.spiritStones})]}),e.jsx("button",{onClick:x,className:"w-10 h-10 flex items-center justify-center bg-black/50 rounded-full border border-yellow-400/20 hover:bg-black/70 transition-all active:scale-95 shadow-lg",children:e.jsx("i",{className:`fa-solid ${f?"fa-compress":"fa-expand"} text-yellow-400 text-lg`})})]})]})},cv=(i,l)=>{let r=null;return(...c)=>{r&&clearTimeout(r),r=setTimeout(()=>{i(...c)},l)}},dv=150,uv=10;function mv(){const i=v.useRef(0);v.useEffect(()=>{if(window.self===window.top){console.log("[IframeHeightSync] Not in an iframe, skipping activation.");return}const l=()=>{const f=document.documentElement.scrollHeight,x=Math.abs(f-i.current);f>0&&x>=uv&&(window.parent.postMessage({type:"set-frame-height",height:f},"*"),i.current=f,console.log(`[IframeHeightSync] Sent height update: ${f}px`))},r=cv(l,dv),c=new ResizeObserver(r),d=document.documentElement;c.observe(d),console.log("[IframeHeightSync] Activated. Observing document element.");const m=setTimeout(l,300);return()=>{c.disconnect(),clearTimeout(m),console.log("[IframeHeightSync] Deactivated.")}},[])}const xv=(i,l)=>i.quests.some(c=>c.id===l.id)?i:{...i,quests:[...i.quests,l]},Cf=(i,l,r)=>({...i,quests:i.quests.map(c=>c.id===l?{...c,status:r}:c)}),fv=(i,l,r,c)=>({...i,quests:i.quests.map(d=>{if(d.id===l){const m=d.objectives.map(f=>{if(f.id===r){const x=f.targetCount?c>=f.targetCount:!0;return{...f,currentCount:c,isCompleted:x}}return f});return{...d,objectives:m}}return d})}),Ef=i=>i.objectives.every(l=>l.isCompleted),hv=(i,l)=>{const r=i.quests.find(c=>c.id===l);return!r||!Ef(r)?i:Cf(i,l,"Claimable")},pv=(i,l)=>{const r=i.quests.find(d=>d.id===l);if(!r||r.status!=="Claimable")return i;let c={...i};return r.rewards.spiritStones&&(c.spiritStones+=r.rewards.spiritStones),r.rewards.reputation&&(c.reputation.score+=r.rewards.reputation),r.rewards.items&&r.rewards.items.length>0&&r.rewards.items.forEach(d=>{"stats"in d?c.equipmentInventory.push({...d,id:`${d.id}_${Date.now()}_${Math.random()}`}):"cost"in d&&c.universalSkills.push(d)}),c=Cf(c,l,"Completed"),c},vd=(i,l)=>{const r={威胁:{low:["哼，你以为这样就能让我屈服吗？","我不会说的，你们这些人迟早会遭报应！","有本事就杀了我！"],mid:["我...我不会说的...","你想怎样...","别...别过来..."],high:["求求你...不要...","我说，我什么都说...","饶命啊..."]},劝说:{low:["少来这套！","你的花言巧语骗不了我！","哼，虚伪！"],mid:["你说的...或许有些道理...","我需要时间考虑...","你真的能保证吗？"],high:["好...我听你的...","你说得对...","我愿意配合..."]},交易:{low:["你以为我会为了这点好处出卖自己？","免谈！","你太小看我了！"],mid:["这个条件...让我想想...","你能给我什么保证？","也许我们可以谈谈..."],high:["成交...","我接受...","只要你说话算数..."]},套话:{low:["你想套我的话？做梦！","我什么都不知道！","别费心思了！"],mid:["你想知道什么？","我不太清楚...","这个...我不能说..."],high:["其实...我知道一些事...","我告诉你...","你想知道的是..."]},闲聊:{low:["我没兴趣和你说话！","滚！","别烦我！"],mid:["难得有人愿意和我说话...","外面的世界...还好吗？","你为什么要来这里？"],high:["谢谢你愿意和我聊天...","能和你说说话真好...","你是个好人..."]},恩惠:{low:["我不需要你的施舍！","你想收买我？","别以为这样我就会感激你！"],mid:["你...为什么要帮我？","谢谢你...","我不知道该说什么..."],high:["太感谢了...","你真是太好了...","我会记住你的恩情..."]},羞辱:{low:["你！你会后悔的！","我不会忘记这一切的！","总有一天我会报仇！"],mid:["...","为什么...","够了..."],high:["是...我错了...","请原谅我...","我不敢了..."]}},c=r[i]||r.闲聊;let d;return l>=70?d=c.high:l>=40?d=c.mid:d=c.low,d[Math.floor(Math.random()*d.length)]},gv=({favorability:i})=>{const l=(i+100)/200*100,r=i>50?"bg-green-500":i>-50?"bg-yellow-500":"bg-red-500";return e.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2.5",children:e.jsx("div",{className:`${r} h-2.5 rounded-full`,style:{width:`${l}%`}})})},bv=({isOpen:i,onClose:l,playerProfile:r})=>{const[c,d]=v.useState("熟人");if(!i)return null;const m=r.relationships.filter(f=>f.relationshipStatus===c);return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:l,children:e.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[e.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"人际关系"}),e.jsx("button",{onClick:l,className:"text-amber-300 hover:text-white transition-colors",children:e.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),e.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[e.jsx("button",{onClick:()=>d("熟人"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${c==="熟人"?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:"熟人"}),e.jsx("button",{onClick:()=>d("陌生人"),className:`px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 ${c==="陌生人"?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"}`,children:"陌生人"})]}),e.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-6 space-y-4",children:m.length>0?m.map(f=>e.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50 hover:border-xianxia-gold-500/50 transition-all duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white font-serif",children:f.name}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:f.relationshipTags.map(x=>e.jsx("span",{className:"px-2 py-1 bg-stone-700 text-xs text-gray-300 rounded-full",children:x},x))})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"好感度"}),e.jsx("p",{className:"font-mono text-lg text-white",children:f.favorability})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx(gv,{favorability:f.favorability})}),e.jsxs("p",{className:"text-sm text-gray-300 mt-3 italic",children:['"',f.description,'"']})]},f.id)):e.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[e.jsx("p",{className:"text-4xl mb-4",children:"🌪️"}),e.jsx("p",{children:"此分类下暂无人物。"})]})})]})})},yv=()=>{var ra;mv();const i=v.useRef(null),[l,r]=v.useState(Og),[c,d]=v.useState(!1),[m,f]=v.useState(!0),[x,h]=v.useState(!1),[g,b]=v.useState(null),[y,S]=v.useState(null),[C,A]=v.useState(!1),[E,$]=v.useState([]),[Z,R]=v.useState(null),[V,J]=v.useState(null),[D,T]=v.useState(null),[G,_]=v.useState(!1),[M,U]=v.useState(!1),[k,Q]=v.useState(!1),[ne,Y]=v.useState(!1),[X,L]=v.useState(null),[I,K]=v.useState(null),[fe,ge]=v.useState(!1),[O,se]=v.useState(!1),[he,le]=v.useState(!1),[xe,pe]=v.useState(!1),[Ae,je]=v.useState(!1),[de,ye]=v.useState(!1),[ke,Oe]=v.useState(!1),[zt,Fe]=v.useState(!1),[La,xn]=v.useState(!1),[ol,cl]=v.useState(!1),[Qs,fn]=v.useState(null),[Ba,br]=v.useState(!1),[Vt,Nt]=v.useState(null),[dl,Js]=v.useState(""),[yr,cs]=v.useState([]),[Ld,eo]=v.useState(!1),[ul,vr]=v.useState(!1),[Xs,Tt]=v.useState(null),[Yt,wt]=v.useState(null),[ml,jr]=v.useState(null),[Nr,Ha]=v.useState(null),[hn,pn]=v.useState(!1),[ds,Ua]=v.useState(!1),[Ps,gn]=v.useState(null),[wr,bn]=v.useState(!1),[Ia,Sr]=v.useState(!1),[to,so]=v.useState(!1),[ao,kr]=v.useState(!1),[xl,fl]=v.useState(!1),[hl,Wt]=v.useState(!1),[ot,St]=v.useState(null),[Zs,qa]=v.useState(""),[no,Cr]=v.useState(!1),[Er,Ks]=v.useState(!1),[pl,Es]=v.useState(!1),[Fs,Ws]=v.useState(!1),[ea,lt]=v.useState(!1),[Ga,Ms]=v.useState({isOpen:!1,title:"",list:[],onSelect:()=>{}}),us=v.useRef(null);v.useEffect(()=>{console.log("[App] 初始化AI消息捕获服务..."),st.setMessageCallback((N,w)=>{console.log(`[App] 捕获到AI消息，类别: ${w}`,N);const B=N.content.length>30?N.content.substring(0,30)+"...":N.content;ct(w,`AI生成: ${B}`,N.content,[])});try{st.registerEventListeners(),console.log("[App] AI消息捕获服务初始化成功")}catch(N){console.warn("[App] AI消息捕获服务初始化失败（可能不在SillyTavern环境中）:",N)}return()=>{st.cleanup()}},[]),v.useEffect(()=>{d(!0),l.playerProfile.businessDistrict||r(N=>({...N,playerProfile:{...N.playerProfile,businessDistrict:{name:"七情六欲坊",level:1,shops:[{id:"shop_brothel_1",type:"青楼",level:1,staff:[]}],log:[{timestamp:"初始",message:'你获得了"七情六欲坊"的初始地契，并开设了第一家青楼。'}]}}})),l.prisonSystem||r(N=>({...N,prisonSystem:{prisoners:[],guards:[],facilities:[],laborSites:[{id:"mine-01",type:"矿山",name:"青蛇矿脉",description:"宗门后山的灵石矿脉",maxWorkers:2,workers:[]},{id:"herb-01",type:"采药",name:"灵药园",description:"宗门的药材种植园",maxWorkers:2,workers:[]}],materialInventory:[],laborTasks:[],laborRecords:[],events:[],ransomOffers:[],stats:{totalPrisoners:0,byArea:{居住区:0,审讯区:0,娱乐区:0,劳役区:0,管理区:0,医疗区:0},byCellType:{普通牢房:0,重犯牢房:0,单独囚室:0},avgSubmission:0,avgLoyalty:0,avgHealth:0,totalGuards:5,escapeAttempts:0,successfulEscapes:0,totalRevenue:0,totalExpenses:0,netProfit:0},config:{maxPrisoners:50,dailyFoodCost:10,securityLevel:5,enableAutoInterrogation:!1,enableAutoLabor:!1}}})),l.memories.大牢||r(N=>({...N,memories:{...N.memories,大牢:[]},memorySummaries:{...N.memorySummaries,大牢:{small:[],large:[]}}}))},[]),v.useEffect(()=>{const N=()=>{r(B=>{const H=Date.now();let oe=!1;const re=B.cultivationPavilion.map(be=>be.status==="Breeding"&&be.endTime>0&&H>=be.endTime?(oe=!0,console.log(`[育灵仓] 培育仓 #${be.slotId} 已完成，状态更新为 Ready`),{...be,status:"Ready",monitoringLog:[{timestamp:"培育完成",message:"灵胎已成熟，可以开启查看结果。"},...be.monitoringLog]}):be);return oe?(console.log("[育灵仓] 状态已更新，触发重渲染"),{...B,cultivationPavilion:re}):B})},w=setInterval(N,1e3);return N(),()=>clearInterval(w)},[]),v.useEffect(()=>{l.hospitalPatients.length===0&&r(N=>({...N,hospitalPatients:[{id:Ex.patientId,medicalRecord:Ex,status:"待诊"}]})),l.bountyBoard.length===0&&r(N=>({...N,bountyBoard:[{...zg,id:"bounty-example-01",status:"悬赏中"}]}))},[]);const ta=async()=>{if(l.playerProfile.businessDistrict){const N=Nf(l.playerProfile);let w="",B=0;const oe=l.exploration.time.match(/第(\d+)天/),be=`第${(oe?parseInt(oe[1],10):1)+1}天，清晨`;if(Math.random()<.3)try{const ae=await Fb(l.playerProfile.businessDistrict,l.playerProfile.cardCollection);w=ae.message,B=ae.incomeChange}catch(ae){console.error("Failed to generate business event:",ae),w="今天风平浪静，无事发生。"}else w="今天风平浪静，无事发生。";const ue=N+B;r(ae=>{if(!ae.playerProfile.businessDistrict)return ae;const ve=[{timestamp:be,message:`结算日：总收入 ${ue} 灵石。${w}`},...ae.playerProfile.businessDistrict.log].slice(0,50);return{...ae,exploration:{...ae.exploration,time:be},playerProfile:{...ae.playerProfile,spiritStones:ae.playerProfile.spiritStones+ue,businessDistrict:{...ae.playerProfile.businessDistrict,log:ve}}}}),l.playerProfile.businessDistrict&&(w||ue>0)&&ct("商业",`${be}的经营日报`,`总收入：${ue} 灵石
${w}`)}if(Math.random()<.5)try{const N=await ur();r(w=>({...w,bountyBoard:[...w.bountyBoard,{...N,id:`bounty-${Date.now()}`,status:"悬赏中"}].slice(-10)}))}catch(N){console.error("Failed to generate bounty target:",N)}},lo=async()=>{h(!0);try{const w=(await Promise.all([dr("Female"),dr("Female"),dr("Male"),dr("Male")])).map(B=>({id:B.patientId,medicalRecord:B,status:"待诊"}));r(B=>{const H=B.hospitalPatients.filter(oe=>oe.status==="治疗中");return{...B,hospitalPatients:[...H,...w]}})}catch(N){console.error("Failed to refresh patients:",N),b("刷新病人列表失败。")}finally{h(!1)}},Mr=async N=>{h(!0);try{const w=await dr(N);r(B=>({...B,hospitalPatients:[...B.hospitalPatients,{id:w.patientId,medicalRecord:w,status:"待诊"}].slice(-10)}))}catch(w){console.error("Failed to add patient:",w),b("添加病人失败。")}finally{h(!1)}},Ar=async()=>{h(!0);try{const N=await Promise.all([ur(),ur(),ur()]);r(w=>({...w,bountyBoard:N.map(B=>({...B,id:`bounty-${Date.now()}-${Math.random()}`,status:"悬赏中"})).slice(-10)}))}catch(N){console.error("Failed to refresh bounty board:",N),b("刷新悬赏榜失败。")}finally{h(!1)}},ro=async N=>{h(!0);try{const w=await ur(N);r(B=>({...B,bountyBoard:[...B.bountyBoard,{...w,id:`bounty-${Date.now()}`,status:"悬赏中"}].slice(-10)}))}catch(w){console.error("Failed to add bounty target:",w),b("添加悬赏目标失败。")}finally{h(!1)}},yn=N=>{const w=l.hospitalPatients.find(B=>B.id===N);if(w)if(Nt(w),w.consultationStory&&w.consultationChoices)Js(w.consultationStory),cs(w.consultationChoices);else{const B=`你坐在问诊室内，面前的病人是【${w.medicalRecord.name}】。

${w.medicalRecord.background}

你清了清嗓子，准备开始今天的问诊。`;Js(B),cs(["询问病症详情","进行身体检查","安抚病患情绪","开具诊疗方案"]),r(H=>({...H,hospitalPatients:H.hospitalPatients.map(oe=>oe.id===N?{...oe,status:"治疗中",consultationStory:B,consultationChoices:["询问病症详情","进行身体检查","安抚病患情绪","开具诊疗方案"]}:oe)}))}},vn=async N=>{if(!Vt)return;h(!0);const w=`${dl}

> ${N}`,B=`你正在为【${Vt.medicalRecord.name}】诊断【${Vt.medicalRecord.illnessDescription}】。`;try{const H=await Ux(`${B}
${w}`,N,l.playerProfile,l),oe=`${w}

${H.story}`,re=H.choices&&Array.isArray(H.choices)&&H.choices.length>0?H.choices:["继续问诊","检查病情","开具处方","结束诊疗"];Js(oe),cs(re),r(be=>({...be,hospitalPatients:be.hospitalPatients.map(ue=>ue.id===Vt.id?{...ue,consultationStory:oe,consultationChoices:re}:ue)}))}catch(H){console.error(H),b("AI响应错误，请稍后再试。"),cs(["继续问诊","检查病情","开具处方","结束诊疗"])}finally{h(!1)}},ms=()=>{Vt&&(ct("医馆",`为${Vt.medicalRecord.name}问诊`,dl,[Vt.medicalRecord.name]),r(N=>({...N,hospitalPatients:N.hospitalPatients.map(w=>w.id===Vt.id?{...w,status:"已治愈",consultationStory:void 0,consultationChoices:void 0}:w)}))),Nt(null),Js(""),cs([])},Rt=()=>{Nt(null),Js(""),cs([])},Tr=N=>{jr(N)},io=v.useCallback(async(N="all")=>{pe(!0);try{const w=N==="all"?["sect","adventure","world"]:[N],B={...l.announcements};for(const H of w){const oe=H,re=await Xb(oe,5,l),be={sect:"宗门",adventure:"奇遇",world:"世界"},ue=re.map((ae,ve)=>({...ae,id:`${oe}-${Date.now()}-${ve}`,category:be[oe]}));B[oe]=ue}r(H=>({...H,announcements:B})),pn(!0)}catch(w){console.error("Failed to fetch announcements:",w)}finally{pe(!1)}},[l.announcements]);v.useEffect(()=>{var N;l.mode==="exploration"?(st.setCurrentScene("exploration"),(N=us.current)==null||N.scrollIntoView({behavior:"smooth",block:"end"})):l.mode==="battle"&&st.setCurrentScene("battle")},[l.mode]),v.useEffect(()=>{Vt?st.setCurrentScene("consultation"):Ba?st.setCurrentScene("hospital"):Qs?st.setCurrentScene("surveillance"):ol?st.setCurrentScene("business"):ul?st.setCurrentScene("bounty"):ds?st.setCurrentScene("cultivation"):M?st.setCurrentScene("map"):ne?st.setCurrentScene("interaction"):Ae?st.setCurrentScene("telepathy"):de?st.setCurrentScene("reputation"):he?st.setCurrentScene("announcement"):y==="竞技场"?st.setCurrentScene("arena"):y==="商城"?st.setCurrentScene("shop"):l.mode==="exploration"&&st.setCurrentScene("exploration")},[Vt,Ba,ol,ul,ds,M,ne,y,l.mode]),v.useEffect(()=>{var N;l.mode==="exploration"&&((N=us.current)==null||N.scrollIntoView({behavior:"smooth",block:"end"}))},[l.exploration.story,l.mode]),v.useEffect(()=>{l.exploration.pendingChallenge&&ge(!0)},[l.exploration.pendingChallenge]),v.useEffect(()=>{l.mode==="battle"&&l.battle&&r(N=>{if(!N.battle)return N;const w=N.battle.playerParty.map(B=>{const H=N.playerProfile.cardCollection.find(oe=>oe.id===B.card.id);if(H){const oe=Cs(H),re=B.calculatedStats.maxHp,be=re>0?Math.min(1,B.currentHp/re):1,ue=B.calculatedStats.maxMp,ae=ue>0?Math.min(1,B.currentMp/ue):1;return{...B,card:H,calculatedStats:oe,currentHp:Math.max(1,Math.round(oe.maxHp*be)),currentMp:Math.round(oe.maxMp*ae)}}return B});return JSON.stringify(N.battle.playerParty)===JSON.stringify(w)?N:{...N,battle:{...N.battle,playerParty:w}}})},[l.playerProfile.cardCollection,l.mode]);const Va=v.useCallback(async N=>{var B;h(!0),b(null);const w=l.exploration.story;try{const H=await Ux(w,N,l.playerProfile,l);let oe=`${l.exploration.story}

> ${N}

${H.story}`,re=!1,be=null;const ue=l.bountyBoard.filter(ve=>ve.status==="悬赏中");for(const ve of ue)if(ve.locationHint.includes(H.location)&&Math.random()<.25){oe+=`

**[红尘录]** 你似乎在【${H.location}】感受到了特殊的气息... 一个名号为【${ve.name}】的悬赏目标出现了！`;const Ne=Cs(ve.character),ze={playerParty:[],opponentParty:[{card:ve.character,currentHp:Ne.maxHp,currentMp:Ne.maxMp,statusEffects:[],calculatedStats:Ne,pet:ve.character.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`遭遇了红尘录目标：${ve.name}！`],isBattleOver:!1,victory:null};T(ze),re=!0;break}if(((B=H.event)==null?void 0:B.type)==="battle"&&H.opponentParty){const ve={playerParty:[],opponentParty:H.opponentParty.map(Ne=>({...Ne,statusEffects:[],pet:Ne.card.pet})),activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`与 ${H.event.opponentName} 的战斗即将开始！`],isBattleOver:!1,victory:null};T(ve),re=!0}if(H.pendingChallenge&&H.pendingChallenge.challengerName&&(be=H.pendingChallenge,oe+=`

[你收到了来自 ${be.challengerName} 的挑战！]`),r(ve=>{let Ne={...ve.playerProfile};if(H.relationshipUpdate&&(Ne=Pb(Ne,H.relationshipUpdate)),H.newQuest){const ze=Date.now(),De=Ne.lastQuestGenerationTime||0,gt=300*1e3;ze-De>=gt&&Math.random()<.2?(Ne=xv(Ne,H.newQuest),Ne.lastQuestGenerationTime=ze,console.log("[任务系统] 生成新任务:",H.newQuest.title)):console.log("[任务系统] 任务生成被限制 (冷却中或概率未命中)")}if(H.questUpdate){const{questId:ze,objectiveId:De,progress:gt}=H.questUpdate,Ue=Ne.quests.find(dt=>dt.id===ze),yt=Ue==null?void 0:Ue.objectives.find(dt=>dt.id===De);if(yt){const dt=(yt.currentCount||0)+gt;Ne=fv(Ne,ze,De,dt);const es=Ne.quests.find(Xa=>Xa.id===ze);es&&Ef(es)&&es.status==="In Progress"&&(Ne=hv(Ne,ze),console.log("[任务系统] 任务可领取:",es.title))}}return H.reputationUpdate&&(Ne.reputation={...Ne.reputation,score:Ne.reputation.score+H.reputationUpdate.scoreChange,history:[...Ne.reputation.history,{id:`rep-${Date.now()}`,timestamp:H.time||ve.exploration.time,description:H.reputationUpdate.description,scoreChange:H.reputationUpdate.scoreChange}].slice(-20)}),{...ve,playerProfile:Ne,exploration:{...ve.exploration,story:oe,location:H.location||ve.exploration.location,time:H.time||ve.exploration.time,choices:H.choices||[],pendingChallenge:be}}}),re&&!be){$([]),_(!0),h(!1);return}if(Math.random()<.25&&!be&&!re)try{const ve=await Vb(H.location,l.playerProfile,l);L(ve)}catch(ve){console.error("Failed to generate random event:",ve)}h(!1)}catch(H){console.error(H),b("仙界似乎有些不稳定，灵气无法正确响应你的请求。"),h(!1)}},[l.playerProfile,l.exploration.story]),$r=v.useCallback(async N=>{var be,ue;if(!l.battle||l.battle.isBattleOver){console.warn("[战斗] 战斗已结束或不存在，无法执行行动");return}h(!0),b(null),$([]);const w=l.battle;if(!w.playerParty||!w.opponentParty||w.activePlayerCardIndex>=w.playerParty.length||w.activeOpponentCardIndex>=w.opponentParty.length){console.error("[战斗] 战斗数据无效，索引越界"),b("战斗数据异常，请重新开始战斗"),h(!1);return}const B=w.playerParty[w.activePlayerCardIndex],H=w.opponentParty[w.activeOpponentCardIndex],oe=ae=>ae.includes("剑")||ae.includes("斩")?"slash":ae.includes("火")||ae.includes("焰")?"fire":ae.includes("疗")||ae.includes("愈")?"heal":ae.includes("盾")||ae.includes("御")?"shield":"default",re=ae=>new Promise(ve=>setTimeout(ve,ae));try{console.log("[战斗] 开始处理AI回合，玩家行动:",N);const ae=await Gb(B,H,N,l);if(!ae||typeof ae!="object")throw new Error("AI返回结果无效");(!ae.playerStatusEffects||!Array.isArray(ae.playerStatusEffects))&&(console.warn("[战斗] AI未返回playerStatusEffects，使用空数组"),ae.playerStatusEffects=[]),(!ae.opponentStatusEffects||!Array.isArray(ae.opponentStatusEffects))&&(console.warn("[战斗] AI未返回opponentStatusEffects，使用空数组"),ae.opponentStatusEffects=[]),ae.playerHpChange=typeof ae.playerHpChange=="number"?ae.playerHpChange:0,ae.opponentHpChange=typeof ae.opponentHpChange=="number"?ae.opponentHpChange:0,ae.playerMpChange=typeof ae.playerMpChange=="number"?ae.playerMpChange:0,ae.opponentMpChange=typeof ae.opponentMpChange=="number"?ae.opponentMpChange:0,ae.playerActionDescription=ae.playerActionDescription||"玩家使用了技能进行攻击。",ae.opponentActionDescription=ae.opponentActionDescription||"对手进行了反击。",ae.playerTurnSummary=ae.playerTurnSummary||`【${N.split("_")[0]}】对对手造成了伤害`,ae.opponentTurnSummary=ae.opponentTurnSummary||"【反击】对玩家造成了伤害",console.log("[战斗] AI回合处理完成",ae),$([ae.playerActionDescription,ae.opponentActionDescription]),R({key:Date.now(),effect:oe(N),attacker:"player"}),ae.opponentHpChange<0&&J("opponent"),await re(2e3);const ve=((ue=(be=ae.opponentTurnSummary)==null?void 0:be.match(/\[(.*?)\]/))==null?void 0:ue[1])||"default";R({key:Date.now()+1,effect:oe(ve),attacker:"opponent"}),J(null),ae.playerHpChange<0&&J("player"),await re(1500);const Ne=B.currentHp+ae.playerHpChange,ze=H.currentHp+ae.opponentHpChange,De=B.currentMp+ae.playerMpChange,gt=H.currentMp+ae.opponentMpChange,Ue=[...w.combatLog,`> ${ae.playerTurnSummary}`,`> ${ae.opponentTurnSummary}`],yt=Ne<=0,dt=ze<=0;let es=w.activePlayerCardIndex,Xa=w.activeOpponentCardIndex,An=!1,ia=null;if(dt&&(Ue.push(`${H.card.name} 已被击败！`),w.activeOpponentCardIndex+1>=w.opponentParty.length?(An=!0,ia=!0,Ue.push("你获得了胜利！")):(Xa++,Ue.push(`对手派出了 ${w.opponentParty[Xa].card.name}！`))),yt&&(Ue.push(`${B.card.name} 已被击败！`),w.activePlayerCardIndex+1>=w.playerParty.length?(An=!0,ia=!1,Ue.push("你被击败了！")):(es++,Ue.push(`你派出了 ${w.playerParty[es].card.name}！`))),r($t=>{if(!$t.battle)return $t;const wl=[...$t.battle.playerParty],Hr=wl[$t.battle.activePlayerCardIndex],Ur=[...Hr.statusEffects.map(hs=>({...hs,duration:hs.duration-1})).filter(hs=>hs.duration>0),...ae.playerStatusEffects];wl[$t.battle.activePlayerCardIndex]={...Hr,currentHp:Math.max(0,Ne),currentMp:Math.max(0,De),statusEffects:Ur};const Sl=[...$t.battle.opponentParty],Ir=Sl[$t.battle.activeOpponentCardIndex],xo=[...Ir.statusEffects.map(hs=>({...hs,duration:hs.duration-1})).filter(hs=>hs.duration>0),...ae.opponentStatusEffects];return Sl[$t.battle.activeOpponentCardIndex]={...Ir,currentHp:Math.max(0,ze),currentMp:Math.max(0,gt),statusEffects:xo},{...$t,battle:{...$t.battle,playerParty:wl,opponentParty:Sl,combatLog:Ue,activePlayerCardIndex:es,activeOpponentCardIndex:Xa,isBattleOver:An,victory:ia}}}),An)try{const $t=Ue.slice(-10).join(`
`);ct("战斗",ia?"战斗胜利":"战斗失败",$t,[B.card.name,H.card.name]),console.log("[战斗] 战斗记忆已保存")}catch($t){console.error("[战斗] 保存战斗记忆失败:",$t)}J(null)}catch(ae){console.error("[战斗] 处理战斗回合时出错:",ae),b("一股神秘的力量扰乱了战场。请稍后重试。"),ae instanceof Error&&console.error("[战斗] 错误详情:",ae.message,ae.stack);try{st.captureMessage(`战斗出错: ${ae instanceof Error?ae.message:"未知错误"}`,"battle")}catch(ve){console.error("[战斗] 捕获错误消息失败:",ve)}}finally{h(!1)}},[l.battle,l.exploration.time,l.exploration.location]),jn=N=>{var be;const w=l.playerProfile.arenaRank,B=N?25:-15,H=Math.max(0,w.points+B),re=(ue=>ue>=5e3?{tier:"王者",division:"",points:ue,tierIcon:"👑"}:ue>=4e3?{tier:"钻石",division:String(5-Math.floor((ue-4e3)/200)),points:ue,tierIcon:"💎"}:ue>=3e3?{tier:"白金",division:String(5-Math.floor((ue-3e3)/200)),points:ue,tierIcon:"🛡️"}:ue>=2e3?{tier:"黄金",division:String(5-Math.floor((ue-2e3)/200)),points:ue,tierIcon:"🌟"}:ue>=1e3?{tier:"白银",division:String(5-Math.floor((ue-1e3)/200)),points:ue,tierIcon:"🥈"}:{tier:"黄铜",division:String(5-Math.floor(ue/200)),points:ue,tierIcon:"🥉"})(H);if(Ha({oldRank:w,newRank:re,pointsChange:B,victory:N}),r(ue=>{const ae={...ue.playerProfile,arenaRank:re},ve={...ue.leaderboards},Ne=ve.宗门排行榜.总榜,ze=Ne.findIndex(De=>De.name===ae.name);return ze!==-1?Ne[ze].points=re.points:(Ne.length<20||re.points>Ne[Ne.length-1].points)&&Ne.push({rank:0,name:ae.name,faction:"青蛇宗",points:re.points,characterId:"player"}),Ne.sort((De,gt)=>gt.points-De.points).forEach((De,gt)=>{De.rank=gt+1}),ve.宗门排行榜.总榜=Ne.slice(0,20),{...ue,playerProfile:ae,leaderboards:ve,mode:"exploration",battle:void 0}}),l.battle){const ue=(be=l.battle.opponentParty[0])==null?void 0:be.card;ue&&ct("战斗",`竞技场对战：${N?"胜利":"失败"}`,`在竞技场与【${ue.name}】展开了激烈的战斗，最终${N?"取得了胜利":"遗憾落败"}。段位积分${B>=0?"增加":"减少"}了${Math.abs(B)}点。`,[ue.name])}},oo=()=>{var oe;if((oe=l.battle)!=null&&oe.isArenaBattle){jn(l.battle.victory??!1);return}const N=l.battle;if(!N){r(re=>({...re,mode:"exploration",battle:void 0}));return}let w=`

 战斗的尘埃落定。`,B=[...l.bountyBoard],H=[...l.playerProfile.cardCollection];if(N.victory&&N.opponentParty.length>0){const re=N.opponentParty[0].card,be=B.findIndex(ue=>ue.character.name===re.name&&ue.status==="悬赏中");if(be!==-1){const ue=B[be];B[be]={...ue,status:"已完成"},H.some(ae=>ae.name===ue.character.name)||H.push(ue.character),w+=`

**[红尘录]** 目标【${ue.name}】已被你成功狩猎！请前往红尘录查看结果。`}}r(re=>({...re,mode:"exploration",battle:void 0,bountyBoard:B,playerProfile:{...re.playerProfile,cardCollection:H},exploration:{...re.exploration,story:re.exploration.story+w,choices:["继续你的旅程。","调息疗伤。","搜查四周。"]}}))},Lt=()=>{var N;if(l.battle&&(r(w=>w.battle?{...w,battle:{...w.battle,isBattleOver:!0,victory:!1,isFled:!0}}:w),l.battle)){const w=(N=l.battle.opponentParty[0])==null?void 0:N.card;w&&ct("战斗","逃离战斗",`面对【${w.name}】，你选择了避其锋芒，成功逃离了战斗。`,[w.name])}},gl=(N,w)=>{var ve;const H=(N==="Male"?l.playerProfile.maleParty:l.playerProfile.femaleParty).map(Ne=>l.playerProfile.cardCollection.find(ze=>ze.id===Ne.id)||Ne),oe=ys.filter(Ne=>Ne.gender===w),re=oe.length>0?[oe[Math.floor(Math.random()*oe.length)]]:w==="Male"?[Xi]:[_d],be=D?((ve=D.combatLog[0].match(/与 (.*) 的战斗/))==null?void 0:ve[1])||"挑战者":re[0].name,ue=D?D.opponentParty:re.map(Ne=>{const ze=Cs(Ne);return{card:Ne,currentHp:ze.maxHp,currentMp:ze.maxMp,statusEffects:[],calculatedStats:ze,pet:Ne.pet}}),ae={playerParty:H.map(Ne=>{const ze=Cs(Ne);return{card:Ne,currentHp:ze.maxHp,currentMp:ze.maxMp,statusEffects:[],calculatedStats:ze,pet:Ne.pet}}),opponentParty:ue,activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"player",combatLog:[`与 ${be} 的战斗即将开始！`],isBattleOver:!1,victory:null};r(Ne=>({...Ne,mode:"battle",battle:ae,exploration:{...Ne.exploration,pendingChallenge:null}})),T(null),_(!1)},Dr=v.useCallback(()=>{if(ge(!1),l.playerProfile.maleParty.length===0&&l.playerProfile.femaleParty.length===0){b("队伍中至少需要一名角色才能进入战斗！"),setTimeout(()=>b(null),3e3);return}D?($([]),_(!0)):(b("战斗信息丢失，无法开始。"),r(N=>({...N,exploration:{...N.exploration,pendingChallenge:null}})))},[l.playerProfile,D]),Nn=v.useCallback(()=>{var w;ge(!1);const N=((w=l.exploration.pendingChallenge)==null?void 0:w.challengerName)||"对方";r(B=>({...B,exploration:{...B.exploration,story:B.exploration.story+`

你思虑再三，决定拒绝 ${N} 的挑战。`,choices:["继续你的旅程。","检查你的状态。","寻找一个安全的地方休息。"],pendingChallenge:null}})),T(null)},[l.exploration.pendingChallenge,l.exploration.story]),sa=N=>S(N),_r=()=>S(null),Ya=N=>{r(w=>({...w,playerProfile:N}))},aa=N=>{U(!1),Va(`前往 ${N}。`)},co=N=>{Y(!1),Va(N)},Or=async(N,w)=>{const B={name:w,timestamp:Date.now(),gameState:l};await _a.saveToSlot(N,B)},zr=async N=>{const B=(await _a.getAllSaves())[N];if(!B){alert("没有可导出的存档！");return}const H=JSON.stringify(B,null,2),oe=new Blob([H],{type:"application/json"}),re=URL.createObjectURL(oe),be=document.createElement("a");be.href=re,be.download=`${B.name.replace(/\s/g,"_")}_${new Date(B.timestamp).toISOString()}.json`,document.body.appendChild(be),be.click(),document.body.removeChild(be),URL.revokeObjectURL(re)},bl=async N=>{const w=prompt("请选择要导入到的存档槽位 (1-5):");if(!w)return;const B=parseInt(w,10);if(isNaN(B)||B<1||B>5){alert("无效的槽位！请输入1到5之间的数字。");return}try{await _a.saveToSlot(B,N),alert(`存档 "${N.name}" 已成功导入到槽位 ${B}！请重新打开菜单查看。`),Fe(!1)}catch(H){console.error("导入存档时保存失败:",H),alert("保存导入的存档时发生错误。")}},uo=async N=>{const w=await _a.loadFromSlot(N);w&&r(w),Fe(!1)},mo=async N=>{await _a.deleteSlot(N)},wn=()=>{ye(!0)},xs=async()=>{Oe(!0);try{const N=await Zb(l.playerProfile,l);r(w=>({...w,playerProfile:{...w.playerProfile,reputation:{...w.playerProfile.reputation,title:N.title,goodDeeds:N.goodDeeds,badDeeds:N.badDeeds,lewdDeeds:N.lewdDeeds}}}))}catch(N){console.error("Failed to generate reputation details:",N)}finally{Oe(!1)}},yl=(N,w)=>{const B=l.bountyBoard.find(ue=>ue.id===N);if(!B)return;const H={凡品:.5*60*60*1e3,良品:3600*1e3,优品:7200*1e3,珍品:14400*1e3,绝品:480*60*1e3,仙品:720*60*1e3,圣品:1440*60*1e3,神品:2880*60*1e3},oe=H[B.character.rarity]||H.凡品,re=Date.now(),be=re+oe;r(ue=>({...ue,bountyBoard:ue.bountyBoard.map(ae=>ae.id===N?{...ae,status:"追踪中",trackerId:w,startTime:re,endTime:be}:ae)}))},vl=async N=>{const w=l.bountyBoard.find(H=>H.id===N),B=l.playerProfile.cardCollection.find(H=>H.id===(w==null?void 0:w.trackerId));if(!w||!B){b("无法找到悬赏或追踪者信息。");return}h(!0);try{const H=await iy(B,w.character,l),oe={...w,trackingLog:H};r(re=>({...re,bountyBoard:re.bountyBoard.map(be=>be.id===N?oe:be)})),wt(oe)}catch(H){console.error("生成悬赏日志失败:",H),b("天机阁传讯失败，无法获取任务报告。")}finally{h(!1)}},na=(N,w)=>{r(H=>{var ae;const oe=H.bountyBoard.find(ve=>ve.id===N);if(!oe)return H;const re=un[oe.character.rarity]*10,be=w==="imprisoned"?20:5;let ue=H.prisonSystem;if(w==="imprisoned"){const ve={character:oe.character,crime:`红尘录悬赏目标 - ${oe.specialTrait}`,sentence:365,remainingDays:365,submissionLevel:0,loyaltyLevel:0,health:70,sanity:80,location:"居住区",cellType:"重犯牢房",value:{ransom:un[oe.character.rarity]*5,labor:un[oe.character.rarity]*2,intelligence:un[oe.character.rarity]*3},status:["受伤"],history:[{id:`interrogation-${Date.now()}`,date:H.exploration.time,realTimestamp:Date.now(),method:{id:"captured",name:"被捕",category:"basic",description:"从红尘录悬赏任务中被捕获",damage:30,intimidation:50,successRate:100,submissionIncrease:0,risks:{death:0,permanentInjury:0,insanity:0}},duration:0,result:{success:!0,informationGained:`身份：${oe.character.name}，罪行：${oe.specialTrait}`,submissionIncrease:0,healthDecrease:30},interrogator:oe.trackerId&&((ae=l.playerProfile.cardCollection.find(Ne=>Ne.id===oe.trackerId))==null?void 0:ae.name)||"追踪者"}],knownInformation:[`真实姓名：${oe.character.name}`,`境界：${oe.character.realm}`,`悬赏特征：${oe.specialTrait}`],potentialInformation:["背景势力","隐藏身份","同伙信息","藏匿地点"],imprisonedDate:H.exploration.time,realImprisonedTime:Date.now()};ue={...H.prisonSystem,prisoners:[...H.prisonSystem.prisoners,ve],stats:{...H.prisonSystem.stats,totalPrisoners:H.prisonSystem.stats.totalPrisoners+1,byArea:{...H.prisonSystem.stats.byArea,居住区:H.prisonSystem.stats.byArea.居住区+1},byCellType:{...H.prisonSystem.stats.byCellType,重犯牢房:H.prisonSystem.stats.byCellType.重犯牢房+1}}}}return{...H,playerProfile:{...H.playerProfile,spiritStones:H.playerProfile.spiritStones+re,reputation:{...H.playerProfile.reputation,score:H.playerProfile.reputation.score+be}},bountyBoard:H.bountyBoard.map(ve=>ve.id===N?{...ve,status:"已结束",finalOutcome:w}:ve),prisonSystem:ue}});const B=l.bountyBoard.find(H=>H.id===N);if(B){const H=w==="imprisoned"?`成功捕获【${B.name}】并押入大牢，可前往大牢进行审讯和管理。`:`成功完成对【${B.name}】的悬赏任务。`;ct(w==="imprisoned"?"大牢":"悬赏",`完成悬赏：${B.name}`,B.trackingLog?`${B.trackingLog}

${H}`:H,[B.name])}wt(null)},la=N=>{const w=Cs(N),B={playerParty:[],opponentParty:[{card:N,currentHp:w.maxHp,currentMp:w.maxMp,statusEffects:[],calculatedStats:w,pet:N.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`与 ${N.name} 的竞技场对决即将开始！`],isBattleOver:!1,victory:null,isArenaBattle:!0};T(B),S(null),_(!0)},Rr=N=>{const{outcome:w}=N;K(w.description),setTimeout(()=>{r(H=>{const oe=JSON.parse(JSON.stringify(H.playerProfile));let re=`

[奇遇] ${w.description}`;switch(w.type){case"reward_stones":oe.spiritStones+=w.amount;break;case"lose_stones":oe.spiritStones=Math.max(0,oe.spiritStones-w.amount);break;case"battle":const be=ys.filter(De=>De.rarity==="优品"||De.rarity==="珍品"),ae={...be[Math.floor(Math.random()*be.length)],id:`rand-${Date.now()}`,name:w.opponentName,origin:w.opponentDescription},ve=Cs(ae),Ne={playerParty:[],opponentParty:[{card:ae,currentHp:ve.maxHp,currentMp:ve.maxMp,statusEffects:[],calculatedStats:ve,pet:ae.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`遭遇了 ${w.opponentName}！`],isBattleOver:!1,victory:null};T(Ne),re+=`

你遭遇了 ${w.opponentName}！`;break;case"reward_item":const ze=yf.find(De=>De.name===w.itemName);if(ze){const De={...ze,id:`${ze.id}_${Date.now()}_${Math.random()}`};oe.equipmentInventory.push(De)}else re+=`
但它似乎只是个普通的物件，你随手丢弃了。`;break}return{...H,playerProfile:oe,exploration:{...H.exploration,story:H.exploration.story+re}}}),L(null),K(null),w.type==="battle"&&_(!0),ct("其他",X.title,`${X.story}

选择：${N.text}

${w.description}`)},2e3)},jl=(N,w,B)=>{const{cardCollection:H,petCollection:oe}=l.playerProfile,re=[...H,...oe],be=re.find(Ue=>Ue.id===w),ue=re.find(Ue=>Ue.id===B);if(!be||!ue){b("选择的父母卡牌无效。");return}const ae={凡品:3600*1e3,良品:7200*1e3,优品:14400*1e3,珍品:480*60*1e3,绝品:720*60*1e3,仙品:1080*60*1e3,圣品:1440*60*1e3,神品:2880*60*1e3},ve=ae[be.rarity],Ne=ae[ue.rarity],ze=(ve+Ne)/2,De=Date.now(),gt=De+ze;r(Ue=>{const yt=Ue.cultivationPavilion.map(dt=>dt.slotId===N?{...dt,parentA:be,parentB:ue,startTime:De,endTime:gt,status:"Breeding",monitoringLog:[{timestamp:"培育开始",message:`能量已注入，${be.name} 与 ${ue.name} 的生命精华开始融合。`}]}:dt);return{...Ue,cultivationPavilion:yt}})},Lr=async N=>{const w=l.cultivationPavilion.find(B=>B.slotId===N);if(!w||w.status!=="Ready"||!w.parentA||!w.parentB){b("无法领取，培育尚未完成或数据异常。");return}h(!0);try{const B=await ry(w.parentA,w.parentB);r(H=>{const oe={...H.playerProfile};"skills"in B?oe.cardCollection.push(B):oe.petCollection.push(B);const re=H.cultivationPavilion.map(be=>be.slotId===N?{...be,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]}:be);return{...H,playerProfile:oe,cultivationPavilion:re}}),alert(`恭喜！你获得了新的卡牌：【${B.name}】！`),w.parentA&&w.parentB&&ct("培育","育灵轩培育成功",`【${w.parentA.name}】与【${w.parentB.name}】的灵胎已成熟，诞生了新的生命：【${B.name}】！`,[w.parentA.name,w.parentB.name,B.name])}catch(B){console.error("生成后代失败:",B),b("开启灵胎失败，似乎有一股神秘力量阻止了新生命的诞生。")}finally{h(!1)}},Qa=v.useCallback((N,w,B)=>{const H=l.prisonSystem.prisoners.find(ue=>ue.character.id===N),oe=l.prisonSystem.laborSites.find(ue=>ue.id===w);if(!H||!oe){b("找不到囚犯或劳役地点");return}if(oe.workers.length>=oe.maxWorkers){b(`${oe.name}的工位已满（${oe.maxWorkers}/${oe.maxWorkers}）`);return}if(H.status.includes("劳役中")){b(`${H.character.name}已经在劳役中`);return}const re=Date.now(),be=re+B*36e5;r(ue=>{const ae={prisonerId:H.character.id,prisonerName:H.character.name,startTime:re,endTime:be,duration:B,status:"working"};return{...ue,prisonSystem:{...ue.prisonSystem,laborSites:ue.prisonSystem.laborSites.map(ve=>ve.id===w?{...ve,workers:[...ve.workers,ae]}:ve),prisoners:ue.prisonSystem.prisoners.map(ve=>ve.character.id===N?{...ve,status:[...ve.status.filter(Ne=>Ne!=="劳役中"),"劳役中"],location:"劳役区"}:ve)}}}),ct("大牢",`劳役分配：${H.character.name}`,`将囚犯【${H.character.name}】分配到${oe.name}进行${B}小时的劳役。`,[H.character.name])},[l.prisonSystem]),fs=v.useCallback(async(N,w)=>{const B=l.prisonSystem.laborSites.find(re=>re.id===N),H=B==null?void 0:B.workers.find(re=>re.prisonerId===w),oe=l.prisonSystem.prisoners.find(re=>re.character.id===w);if(!B||!H||!oe){b("找不到劳役信息");return}if(Date.now()<H.endTime){b("劳役尚未完成");return}h(!0);try{const re=await cy(oe,B.type,H.duration,l);r(ue=>{const ae=ue.prisonSystem.laborSites.find(De=>De.id===N),ve=(ae==null?void 0:ae.workers.filter(De=>De.prisonerId!==w))||[],Ne=[...ue.prisonSystem.materialInventory,...re.materials],ze=ue.prisonSystem.prisoners.map(De=>De.character.id===w?{...De,status:De.status.filter(gt=>gt!=="劳役中"),health:Math.max(0,De.health-re.healthCost),location:"居住区"}:De);return{...ue,prisonSystem:{...ue.prisonSystem,laborSites:ue.prisonSystem.laborSites.map(De=>De.id===N?{...De,workers:ve}:De),materialInventory:Ne,prisoners:ze}}});const be=re.materials.map(ue=>`${ue.material.name}(${ue.material.rarity}) x${ue.quantity}`).join("、");ct("大牢",`劳役完成：${oe.character.name}`,`${oe.character.name}完成了在${B.name}的劳役。

${re.story}

获得材料：${be}
经验+${re.experience}，健康-${re.healthCost}`,[oe.character.name]),alert(`劳役完成！

${re.story}

获得材料：${be}`)}catch(re){console.error("生成劳役结果失败:",re),b("生成劳役结果失败，请稍后重试")}finally{h(!1)}},[l]),ct=v.useCallback((N,w,B,H)=>{const oe={id:`memory-${Date.now()}-${Math.random()}`,category:N,title:w,content:B,timestamp:l.exploration.time,realTimestamp:Date.now(),location:l.exploration.location,involvedCharacters:H};r(re=>{const be=[oe,...re.memories[N]].slice(0,100),ue={...re,memories:{...re.memories,[N]:be}};if(re.summarySettings.autoSummaryEnabled){const{smallSummaryInterval:ae,largeSummaryInterval:ve}=re.summarySettings,Ne=be.length,ze=re.memorySummaries[N].small.length;if(Ne>0&&Ne%ae===0){const De=Math.max(0,Ne-ae),gt=Ne-1,Ue=be.slice(De,gt+1);gd(Ue,"small",N,re.summarySettings.summaryPrompts.small).then(yt=>{r(dt=>{const es=[yt,...dt.memorySummaries[N].small].slice(0,50);return{...dt,memorySummaries:{...dt.memorySummaries,[N]:{...dt.memorySummaries[N],small:es}}}})}).catch(yt=>console.error("自动生成小总结失败:",yt))}if(ze>0&&ze%ve===0){const gt=re.memorySummaries[N].small.slice(0,ve).map(Ue=>({id:Ue.id,category:Ue.category,title:Ue.title,content:Ue.content,timestamp:Ue.timestamp,realTimestamp:Ue.realTimestamp,location:void 0,involvedCharacters:void 0}));gd(gt,"large",N,re.summarySettings.summaryPrompts.large).then(Ue=>{r(yt=>{const dt=[Ue,...yt.memorySummaries[N].large].slice(0,50);return{...yt,memorySummaries:{...yt.memorySummaries,[N]:{...yt.memorySummaries[N],large:dt}}}})}).catch(Ue=>console.error("自动生成大总结失败:",Ue))}}return ue})},[l.exploration.time,l.exploration.location]),Ja=v.useCallback(N=>{r(w=>({...w,memories:{...w.memories,[N]:[]}}))},[]),js=v.useCallback((N,w)=>{r(B=>({...B,memories:{...B.memories,[N]:B.memories[N].filter(H=>H.id!==w)}}))},[]),Nl=v.useCallback((N,w,B)=>{r(H=>({...H,memorySummaries:{...H.memorySummaries,[N]:{...H.memorySummaries[N],[B]:H.memorySummaries[N][B].filter(oe=>oe.id!==w)}}}))},[]),Sn=v.useCallback(async(N,w,B,H)=>{const re=l.memories[N].slice(w,B+1);if(re.length===0){b("没有选择任何记忆进行总结。");return}h(!0);try{const be=H==="small"?l.summarySettings.summaryPrompts.small:l.summarySettings.summaryPrompts.large,ue=await gd(re,H,N,be);r(ae=>{const ve=[ue,...ae.memorySummaries[N][H]].slice(0,50);return{...ae,memorySummaries:{...ae.memorySummaries,[N]:{...ae.memorySummaries[N],[H]:ve}}}})}catch(be){console.error("生成总结失败:",be),b("AI生成总结失败，请稍后再试。")}finally{h(!1)}},[l.memories]),Br=v.useCallback(N=>{r(w=>({...w,summarySettings:N}))},[]),kn=v.useCallback(N=>{r(w=>({...w,vectorConfig:N})),Gt.updateConfig(N),lf.updateConfig(N),console.log("[App] 向量配置已更新，Reranker状态:",N.rerankerEnabled?"启用":"禁用")},[]),Cn=()=>{var N,w;if(l.mode==="exploration")return e.jsx(sv,{story:l.exploration.story,storyEndRef:us});if(l.mode==="battle"&&l.battle){const B=l.battle;if(!B.playerParty||!B.opponentParty||B.playerParty.length===0||B.opponentParty.length===0||B.activePlayerCardIndex>=B.playerParty.length||B.activeOpponentCardIndex>=B.opponentParty.length)return console.error("[渲染] 战斗数据无效，返回空视图",{playerPartyLength:(N=B.playerParty)==null?void 0:N.length,opponentPartyLength:(w=B.opponentParty)==null?void 0:w.length,activePlayerIndex:B.activePlayerCardIndex,activeOpponentIndex:B.activeOpponentCardIndex}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-400 bg-black/60 p-8 rounded-lg",children:[e.jsx("p",{className:"text-2xl mb-4",children:"⚠️ 战斗数据异常"}),e.jsx("p",{className:"mb-4",children:"战斗状态出现错误，请返回探索模式"}),e.jsx("button",{onClick:()=>{r(re=>({...re,mode:"exploration",battle:void 0}))},className:"bg-amber-600 px-6 py-2 rounded hover:bg-amber-500",children:"返回探索"})]})});const H=B.playerParty[B.activePlayerCardIndex],oe=B.opponentParty[B.activeOpponentCardIndex];return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(eb,{player:H,opponent:oe,animation:Z,lastHit:V})}),e.jsx("div",{className:"flex-shrink-0 h-48 p-4",children:e.jsx(Ig,{descriptions:E,isLoading:x,isPlayerTurn:B.turn==="player"})})]})}return null},En=v.useMemo(()=>{var w,B;const N=new Map;return l.bountyBoard.forEach(H=>{H.status==="追踪中"&&H.trackerId&&N.set(H.trackerId,`红尘录: ${H.name}`)}),l.cultivationPavilion.forEach(H=>{H.status==="Breeding"&&(H.parentA&&N.set(H.parentA.id,"育灵轩: 培育中"),H.parentB&&N.set(H.parentB.id,"育灵轩: 培育中"))}),(w=l.playerProfile.businessDistrict)==null||w.shops.forEach(H=>{H.staff.forEach(oe=>{var be;const re=((be=fr[oe.positionId])==null?void 0:be.name)||"工作";N.set(oe.characterId,`${H.type}: ${re}`)})}),(B=l.etiquetteSystem)!=null&&B.designer&&N.set(l.etiquetteSystem.designer.characterId,"礼仪设计馆: 设计师"),N},[l.bountyBoard,l.cultivationPavilion,l.playerProfile.businessDistrict,l.etiquetteSystem]),pt=v.useMemo(()=>new Set(En.keys()),[En]),As=()=>{f(!1),d(!0)},Mn=async N=>{const w=await _a.loadFromSlot(N);w?(r(w),f(!1),d(!0)):alert("加载存档失败，存档可能已损坏。")};return m?e.jsx(Ug,{onStartNewGame:As,onLoadGame:Mn}):e.jsxs("div",{ref:i,className:"flex flex-col font-serif relative",style:{width:"540px",height:"960px",overflow:"hidden",backgroundImage:"url('https://github.com/zzq0219/sillytavern/blob/main/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E4%BA%91%E9%9B%BE-%E4%BB%99%E4%BE%A0.png?raw=true')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"scroll"},children:[e.jsx(ov,{playerProfile:l.playerProfile,location:l.exploration.location,onProfileClick:()=>Q(!0),appRef:i}),hn&&e.jsx(Yg,{announcements:[...l.announcements.world,...l.announcements.adventure,...l.announcements.sect],onClick:()=>le(!0)}),e.jsx("main",{className:"flex-grow flex flex-col items-center w-full pt-12 md:pt-16 pb-20 md:pb-28 px-2 sm:px-4",children:Cn()}),l.mode==="battle"&&l.battle&&!l.battle.isBattleOver&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Xg,{battleState:l.battle,isLoading:x,onCombatAction:$r,onFlee:Lt,onOpenCombatLog:()=>A(!0)})}),l.mode==="battle"&&((ra=l.battle)==null?void 0:ra.isBattleOver)&&e.jsx(tb,{victory:l.battle.victory,isFled:l.battle.isFled,onClose:oo}),l.mode==="exploration"&&e.jsx(ab,{gameState:l,isLoading:x,error:g,onExplorationAction:Va,onNavClick:sa,onMapClick:()=>U(!0),onInteractClick:()=>Y(!0),onTelepathyClick:()=>je(!0),onSystemClick:()=>Fe(!0),onQuestClick:()=>xn(!0),onBusinessClick:()=>cl(!0),onHospitalClick:()=>br(!0),onBountyBoardClick:()=>vr(!0),onNextDay:ta,onAnnouncementsClick:()=>le(!0),onCultivationClick:()=>Ua(!0),onMemoryClick:()=>bn(!0),onCharacterStatusClick:()=>Sr(!0),onPrisonClick:()=>fl(!0),onEtiquetteHallClick:()=>Cr(!0),onGauntletClick:()=>Ks(!0)}),e.jsx(Jy,{isOpen:k,onClose:()=>Q(!1),playerProfile:l.playerProfile,hasPendingChallenge:!!l.exploration.pendingChallenge,onBattleClick:()=>{l.exploration.pendingChallenge&&(Q(!1),ge(!0))},onRelationshipsClick:()=>se(!0),onReputationClick:()=>wn()}),y&&e.jsx(Vy,{activeModal:y,onClose:_r,playerProfile:l.playerProfile,setPlayerProfile:Ya,leaderboards:l.leaderboards,onMatchFound:la,onViewPet:gn,gameState:l,onLeaderboardsUpdate:N=>{r(w=>({...w,leaderboards:N}))}}),C&&l.battle&&e.jsx(xb,{log:l.battle.combatLog,onClose:()=>A(!1)}),G&&D&&e.jsx(Py,{playerProfile:l.playerProfile,opponentName:D.opponentParty[0].card.name,onBattleStart:gl,onClose:()=>{_(!1),T(null),r(N=>({...N,exploration:{...N.exploration,pendingChallenge:null}}))}}),M&&e.jsx(Ib,{currentLocationName:l.exploration.location,onClose:()=>U(!1),onTravel:aa}),ne&&e.jsx(zb,{isOpen:ne,onClose:()=>Y(!1),onInteract:co,storyContext:l.exploration.story}),X&&e.jsx(Wy,{event:X,onChoice:Rr,resultText:I}),l.exploration.pendingChallenge&&e.jsx(cb,{isOpen:fe,onClose:Nn,challenge:l.exploration.pendingChallenge,onAccept:Dr,onDecline:Nn}),O&&e.jsx(bv,{isOpen:O,onClose:()=>se(!1),playerProfile:l.playerProfile}),e.jsx(Vg,{isOpen:he,onClose:()=>le(!1),announcements:l.announcements,onRefresh:()=>io("all"),isLoading:xe}),e.jsx(nv,{isOpen:Ae,onClose:()=>je(!1),playerProfile:l.playerProfile}),e.jsx(ev,{isOpen:de,onClose:()=>ye(!1),reputation:l.playerProfile.reputation,isLoading:ke,onRefresh:xs}),e.jsx(tv,{isOpen:zt,onClose:()=>Fe(!1),onSave:Or,onLoad:uo,onExport:zr,onImport:bl,onDelete:mo,getSaves:_a.getAllSaves}),e.jsx(Fy,{isOpen:La,onClose:()=>xn(!1),quests:l.playerProfile.quests,playerProfile:l.playerProfile,onClaimReward:N=>{var B;const w=l.playerProfile.quests.find(H=>H.id===N);if(w&&w.status==="Claimable"){if(r(H=>({...H,playerProfile:pv(H.playerProfile,N)})),w){const H=[w.rewards.spiritStones?`灵石 +${w.rewards.spiritStones}`:"",w.rewards.reputation?`声望 +${w.rewards.reputation}`:"",((B=w.rewards.items)==null?void 0:B.map(oe=>oe.name).join("、"))||""].filter(Boolean).join("，");ct("其他",`完成任务：${w.title}`,`${w.description}

获得奖励：${H}`,[])}console.log("[任务系统] 领取奖励:",w.title)}}}),Nr&&e.jsx(Qg,{...Nr,onClose:()=>Ha(null)}),e.jsx(ob,{isOpen:ol,onClose:()=>cl(!1),playerProfile:l.playerProfile,onUpdateProfile:Ya,onOpenSurveillance:N=>fn(N),busyCharacterIds:pt,onOpenSelector:(N,w,B)=>Ms({isOpen:!0,title:N,list:w,onSelect:B}),etiquetteSystem:l.etiquetteSystem}),Qs&&e.jsx(av,{isOpen:!!Qs,onClose:()=>fn(null),shop:Qs,cardCollection:l.playerProfile.cardCollection}),e.jsx(Ob,{isOpen:Ba,onClose:()=>br(!1),patients:l.hospitalPatients,onStartConsultation:yn,onRefresh:lo,onAddPatient:Mr,isLoading:x,onViewRecord:Tr,consultationPatient:Vt,consultationStory:dl,consultationChoices:yr,onConsultationAction:vn,onEndConsultation:ms,onReturnToList:Rt}),ml&&e.jsx(qb,{isOpen:!!ml,onClose:()=>jr(null),record:ml}),e.jsx(nb,{isOpen:ul,onClose:()=>vr(!1),bountyBoard:l.bountyBoard,onViewTarget:N=>Tt(N.character),onAccept:N=>{const w=l.bountyBoard.find(H=>H.id===N);if(!w)return;const B=l.playerProfile.cardCollection.filter(H=>!pt.has(H.id));Ms({isOpen:!0,title:`为悬赏【${w.name}】派遣角色`,list:B,onSelect:H=>{yl(w.id,H.id)}})},onClaim:vl,onRefresh:Ar,onAddTarget:ro,isLoading:x}),Xs&&e.jsx(Wi,{card:Xs,onClose:()=>Tt(null),playerProfile:l.playerProfile,setPlayerProfile:Ya,onViewPet:gn}),Ps&&e.jsx(Xy,{pet:Ps,onClose:()=>gn(null)}),Yt&&e.jsx(lb,{isOpen:!!Yt,onClose:()=>wt(null),bounty:Yt,onOutcome:N=>na(Yt.id,N)}),e.jsx(pb,{isOpen:ds,onClose:()=>Ua(!1),playerProfile:l.playerProfile,cultivationSlots:l.cultivationPavilion,onStartCultivation:jl,onClaimCultivation:Lr,busyCharacterIds:pt,onOpenSelector:(N,w,B)=>Ms({isOpen:!0,title:N,list:w,onSelect:B}),onGetLiveMonitoring:async N=>{const w=l.cultivationPavilion.find(B=>B.slotId===N);if(!w||!w.parentA||!w.parentB)return"监视目标丢失...";try{return await ly(w.parentA,w.parentB)}catch(B){return console.error("生成监视报告失败:",B),"监视水晶受到干扰，无法看清内部情况..."}}}),e.jsx(py,{isOpen:wr,onClose:()=>bn(!1),memories:l.memories,memorySummaries:l.memorySummaries,summarySettings:l.summarySettings,onClearCategory:Ja,onDeleteEntry:js,onDeleteSummary:Nl,onManualSummary:Sn,onUpdateSettings:Br,gameState:l,onVectorConfigSave:kn}),e.jsx(Sp,{isOpen:Ia,onClose:()=>Sr(!1),cardCollection:l.playerProfile.cardCollection,petCollection:l.playerProfile.petCollection,busyCharacterDetails:En}),e.jsx(Np,{isOpen:Ga.isOpen,onClose:()=>Ms(N=>({...N,isOpen:!1})),onSelect:Ga.onSelect,characterList:Ga.list,title:Ga.title}),e.jsx(Ky,{isOpen:xl,onClose:()=>fl(!1),prisonSystem:l.prisonSystem,playerProfile:l.playerProfile,setPlayerProfile:Ya,onViewPet:gn,onInterrogatePrisoner:N=>{St(N),Wt(!0),qa("")},onViewPrisonerDetail:N=>{alert(`查看囚犯详情：${N.character.name}

罪行：${N.crime}
屈服度：${N.submissionLevel}%
归顺度：${N.loyaltyLevel}%
健康度：${N.health}%
神智：${N.sanity}%`)},onTransferPrisoner:(N,w)=>{r(B=>({...B,prisonSystem:{...B.prisonSystem,prisoners:B.prisonSystem.prisoners.map(H=>H.character.id===N.character.id?{...H,location:w}:H)}})),ct("大牢",`囚犯转移：${N.character.name}`,`将囚犯【${N.character.name}】从${N.location}转移到${w}。`,[N.character.name])},onReleasePrisoner:N=>{r(w=>({...w,prisonSystem:{...w.prisonSystem,prisoners:w.prisonSystem.prisoners.filter(B=>B.character.id!==N.character.id)}})),ct("大牢",`释放囚犯：${N.character.name}`,`释放了囚犯【${N.character.name}】。罪行：${N.crime}`,[N.character.name])},onRecruitPrisoner:N=>{if(N.loyaltyLevel<80||N.submissionLevel<60){alert(`招募失败：【${N.character.name}】的归顺度或屈服度不足！

当前归顺度：${N.loyaltyLevel}% (需要≥80%)
当前屈服度：${N.submissionLevel}% (需要≥60%)`);return}r(w=>({...w,playerProfile:{...w.playerProfile,cardCollection:[...w.playerProfile.cardCollection,N.character]},prisonSystem:{...w.prisonSystem,prisoners:w.prisonSystem.prisoners.filter(B=>B.character.id!==N.character.id)}})),ct("大牢",`成功招募：${N.character.name}`,`成功招募了囚犯【${N.character.name}】加入队伍。归顺度：${N.loyaltyLevel}%，屈服度：${N.submissionLevel}%`,[N.character.name]),alert(`成功招募【${N.character.name}】！

该角色已加入你的卡牌收藏。`)},onAssignLabor:Qa,onClaimLaborResult:fs,onGenerateEvent:()=>{alert("随机事件功能开发中")},onDialogueComplete:(N,w)=>{var B,H,oe;r(re=>{var be;return{...re,prisonSystem:{...re.prisonSystem,prisoners:re.prisonSystem.prisoners.map(ue=>{var ae;return ue.character.id===N.character.id?{...ue,submissionLevel:Math.max(0,Math.min(100,ue.submissionLevel+w.stateChanges.submission)),loyaltyLevel:Math.max(0,Math.min(100,ue.loyaltyLevel+w.stateChanges.loyalty)),health:Math.max(0,Math.min(100,ue.health+w.stateChanges.health)),sanity:Math.max(0,Math.min(100,ue.sanity+w.stateChanges.sanity)),knownInformation:(ae=w.rewards)!=null&&ae.information?[...ue.knownInformation||[],w.rewards.information]:ue.knownInformation}:ue}),stats:{...re.prisonSystem.stats,avgSubmission:re.prisonSystem.prisoners.length>0?re.prisonSystem.prisoners.reduce((ue,ae)=>ue+ae.submissionLevel,0)/re.prisonSystem.prisoners.length:0,avgLoyalty:re.prisonSystem.prisoners.length>0?re.prisonSystem.prisoners.reduce((ue,ae)=>ue+ae.loyaltyLevel,0)/re.prisonSystem.prisoners.length:0}},playerProfile:(be=w.rewards)!=null&&be.spiritStones?{...re.playerProfile,spiritStones:re.playerProfile.spiritStones-(w.rewards.spiritStones||0)}:re.playerProfile}}),ct("大牢",`与囚犯对话：${N.character.name}`,`与囚犯【${N.character.name}】进行了${w.dialogueRecord.dialogueType}对话。
选择：${w.dialogueRecord.playerChoice}
囚犯回应："${w.dialogueRecord.prisonerResponse}"
效果：屈服度${w.stateChanges.submission>=0?"+":""}${w.stateChanges.submission}，归顺度${w.stateChanges.loyalty>=0?"+":""}${w.stateChanges.loyalty}`+((B=w.rewards)!=null&&B.information?`
获得情报：${w.rewards.information}`:"")+((H=w.consequences)!=null&&H.eventTriggered?`
触发事件：${w.consequences.eventTriggered}`:""),[N.character.name]),(oe=w.consequences)!=null&&oe.eventTriggered&&setTimeout(()=>{var re;alert(`⚠️ 特殊事件：${(re=w.consequences)==null?void 0:re.eventTriggered}`)},500)},onGenerateDialogueResponse:async(N,w)=>{var B;try{const H=`你是一个修仙世界的囚犯，名叫${N.character.name}，${N.character.gender==="Male"?"男性":"女性"}，修为${N.character.realm}。
你因为"${N.crime}"被关押在大牢中。
当前状态：
- 屈服度：${N.submissionLevel}%（${N.submissionLevel>=80?"完全屈服":N.submissionLevel>=60?"意志动摇":N.submissionLevel>=40?"勉强配合":"顽固抵抗"}）
- 归顺度：${N.loyaltyLevel}%
- 健康：${N.health}%
- 神智：${N.sanity}%

狱卒对你使用了"${w.type}"的方式：${w.text}（${w.description}）

请以囚犯的身份，用第一人称回应这个对话。回应要符合你当前的屈服度和心理状态：
- 如果屈服度低，应该表现出抗拒、愤怒或不屑
- 如果屈服度高，应该表现出顺从、恐惧或配合
- 回应要简短有力，1-3句话即可
- 要符合修仙世界的语言风格`;return typeof window<"u"&&((B=window.SillyTavern)!=null&&B.generateText)&&await window.SillyTavern.generateText(H)||vd(w.type,N.submissionLevel)}catch(H){return console.error("生成对话响应失败:",H),vd(w.type,N.submissionLevel)}},isLoading:x}),e.jsx(Jp,{isOpen:no,onClose:()=>Cr(!1),etiquetteSystem:l.etiquetteSystem,onUpdateEtiquetteSystem:N=>{r(w=>({...w,etiquetteSystem:N}))},cardCollection:l.playerProfile.cardCollection,gameState:l,onOpenDesignerSelection:()=>{const N=l.playerProfile.cardCollection.filter(w=>!pt.has(w.id));Ms({isOpen:!0,title:"选择礼仪设计师",list:N,onSelect:w=>{const B={characterId:w.id,assignedAt:Date.now(),designCount:0,designStyle:["极致服从","羞耻强化"],qualityScore:80};r(H=>({...H,etiquetteSystem:{...H.etiquetteSystem,designer:B,logs:[{id:`log-${Date.now()}`,timestamp:Date.now(),action:"designer_assign",details:`指派了新设计师：${w.name}`,designerId:w.id},...H.etiquetteSystem.logs].slice(0,100)}})),Ms(H=>({...H,isOpen:!1}))}})}}),e.jsx($b,{isOpen:Er,onClose:()=>Ks(!1),gameState:l,setGameState:r,onOpenAnnouncement:()=>{Es(!0)},onOpenRegistration:()=>{Ws(!0)},onOpenLive:()=>{lt(!0)}}),e.jsx(Db,{isOpen:ea,onClose:()=>lt(!1),gameState:l,setGameState:r}),e.jsx(gb,{isOpen:pl,onClose:()=>Es(!1),gameState:l,onGenerateAllDrafts:async()=>{console.log("[大闯关] 生成全部草稿");const N=l.gauntletSystem.currentEvent;if(!N){alert("当前没有进行中的赛事");return}if(N.challengesGenerated){alert("关卡草稿已生成，无需重复生成");return}try{alert("开始生成6轮关卡草稿，请稍候...");const w=await Oa.generateAllChallengeDrafts(l),B=wb(N,w);r(H=>({...H,gauntletSystem:{...H.gauntletSystem,currentEvent:B}})),console.log("[大闯关] 关卡草稿生成完成"),alert(`关卡草稿生成成功！

已生成${w.length}轮关卡`)}catch(w){console.error("[大闯关] 生成关卡草稿失败:",w),alert("生成关卡草稿失败，请重试")}},onStartAllOptimization:async()=>{var w;console.log("[大闯关] 开始全部优化");const N=l.gauntletSystem.currentEvent;if(!N){alert("当前没有进行中的赛事");return}if(!N.challengesGenerated){alert("请先生成关卡草稿");return}if(N.allOptimizationsComplete){alert("所有关卡已完成优化");return}try{alert("开始优化所有关卡（共18次优化），这可能需要一些时间...");let B={...N};const H=18;let oe=0;for(let re=1;re<=6;re++){const be=(w=B.rounds[re-1])==null?void 0:w.challenge;if(!be)continue;let ue={...be};for(let ae=1;ae<=3;ae++){if(ue.optimizationProgress>=ae){oe++;continue}console.log(`[大闯关] 优化第${re}轮关卡 (${ae}/3)`);const ve=await Oa.optimizeChallenge(ue,ae,l);ue={...ue,[`optimization${ae}`]:ve,optimizationProgress:ae},ae===3&&(ue.finalVersion=ve.optimizedDesign),oe++,await new Promise(Ne=>setTimeout(Ne,300))}B=Ox(B,re,ue)}r(re=>({...re,gauntletSystem:{...re.gauntletSystem,currentEvent:B}})),console.log("[大闯关] 全部优化完成"),alert("所有关卡优化完成！")}catch(B){console.error("[大闯关] 优化失败:",B),alert("优化过程中出错，请重试")}},onOptimizeChallenge:async(N,w)=>{var oe;console.log(`[大闯关] 优化第${N}轮关卡，第${w}次优化`);const B=l.gauntletSystem.currentEvent;if(!B){alert("当前没有进行中的赛事");return}const H=(oe=B.rounds[N-1])==null?void 0:oe.challenge;if(!H){alert(`第${N}轮关卡不存在`);return}if(H.optimizationProgress>=w){alert(`第${N}轮关卡的第${w}次优化已完成`);return}try{alert(`正在优化第${N}轮关卡（第${w}次）...`);const re=await Oa.optimizeChallenge(H,w,l);let be={...H,[`optimization${w}`]:re,optimizationProgress:w};w===3&&(be.finalVersion=re.optimizedDesign);const ue=Ox(B,N,be);r(ae=>({...ae,gauntletSystem:{...ae.gauntletSystem,currentEvent:ue}})),console.log(`[大闯关] 第${N}轮关卡第${w}次优化完成`),alert(`优化完成！

第${N}轮关卡已完成第${w}次优化`)}catch(re){console.error("[大闯关] 优化失败:",re),alert("优化失败，请重试")}}}),e.jsx(_b,{isOpen:Fs,onClose:()=>Ws(!1),gameState:l,onRegister:async N=>{console.log("[大闯关] 报名参赛者:",N.name);let w=l.gauntletSystem.currentEvent,B=l.gauntletSystem;if(w||(w=wf(l.gauntletSystem),B={...l.gauntletSystem,currentEvent:w,totalEditions:w.edition}),w=yb(w),w.status!=="registration"){alert(`当前不在报名阶段

赛事状态: ${w.status}`);return}const H=vb(w,{name:N.name,realm:N.realm,appearance:N.appearance,charm:N.charm,skillfulness:N.skillfulness,characterCardId:N.id});r(oe=>({...oe,gauntletSystem:{...B,currentEvent:H}})),console.log("[大闯关] 报名成功:",N.name),alert(`报名成功！

参赛者: ${N.name}
当前已报名人数: ${H.contestants.length}/64`)},onCancelRegistration:async()=>{console.log("[大闯关] 取消报名");const N=l.gauntletSystem.currentEvent;if(!N){alert("当前没有进行中的赛事");return}if(N.status!=="registration"){alert("当前不在报名阶段，无法取消报名");return}if(!N.playerContestantId){alert("您尚未报名");return}const w=jb(N);r(B=>({...B,gauntletSystem:{...B.gauntletSystem,currentEvent:w}})),console.log("[大闯关] 取消报名成功"),alert("已成功取消报名")},onGenerateContestants:async N=>{const w=l.gauntletSystem.currentEvent;if(!w){console.error("[大闯关] 当前没有活跃赛事"),alert("当前没有进行中的赛事");return}try{h(!0),console.log(`[大闯关] 开始生成${N}名AI参赛者...`);const B=await Oa.generateContestants(N,l);console.log(`[大闯关] 成功生成${B.length}名参赛者`);const H={...w,contestants:[...w.contestants,...B]};r(oe=>({...oe,gauntletSystem:{...oe.gauntletSystem,currentEvent:H}})),console.log(`[大闯关] 参赛者已添加到赛事，当前人数：${H.contestants.length}`),alert(`成功生成${B.length}名参赛者！

当前报名人数：${H.contestants.length}/64`)}catch(B){console.error("[大闯关] 生成参赛者失败:",B),alert("生成参赛者失败，请稍后重试。")}finally{h(!1)}}}),hl&&ot&&e.jsx(Rb,{isOpen:hl,onClose:()=>Wt(!1),prisoner:ot,availableTortureMethods:[{id:"whipping",name:"鞭刑",category:"basic",description:"用鞭子抽打囚犯，造成皮肉之苦",damage:20,intimidation:40,successRate:30,submissionIncrease:10,risks:{death:2,permanentInjury:5,insanity:3}},{id:"caning",name:"杖刑",category:"basic",description:"用木杖击打囚犯",damage:30,intimidation:50,successRate:40,submissionIncrease:15,risks:{death:5,permanentInjury:10,insanity:5}}],onExecuteTorture:(N,w,B)=>{alert(`执行刑罚：囚犯 ${N}, 方法 ${w}, 时长 ${B}分钟

此功能需要AI集成才能生成审讯结果。`),qa(`正在执行刑罚...
持续时间：${B}分钟

[此处将显示AI生成的审讯过程]`)},onEndInterrogation:()=>{Wt(!1),St(null),qa("")},interrogationLog:Zs,isLoading:x})]})},Mf=document.getElementById("root");if(!Mf)throw new Error("Could not find root element to mount to");const vv=vp.createRoot(Mf);vv.render(e.jsx(Zi.StrictMode,{children:e.jsx(yv,{})}));</script>
  <style rel="stylesheet" crossorigin>.mobile-container{width:100%;max-width:100vw;padding:.5rem}@media(min-width:768px){.mobile-container{max-width:768px;margin:0 auto;padding:1rem}}.responsive-padding{padding:1rem}@media(max-width:640px){.responsive-padding{padding:.5rem}}.responsive-padding-sm{padding:.5rem}@media(min-width:768px){.responsive-padding-sm{padding:1rem}}.stack-mobile{display:flex;flex-direction:column;gap:.5rem}@media(min-width:768px){.stack-mobile{flex-direction:row;gap:1rem}}.modal-responsive{position:fixed;width:100%;max-width:100vw;height:90vh;max-height:90vh;margin:0;border-radius:1rem 1rem 0 0;bottom:0;top:auto;left:0;right:0}@media(min-width:768px){.modal-responsive{position:relative;width:auto;max-width:42rem;height:auto;max-height:85vh;border-radius:.75rem;bottom:auto;top:auto;left:auto;right:auto}}.modal-responsive-lg{position:fixed;width:100%;max-width:100vw;height:95vh;max-height:95vh;margin:0;border-radius:1rem 1rem 0 0;bottom:0;left:0;right:0}@media(min-width:768px){.modal-responsive-lg{position:relative;width:auto;max-width:56rem;height:auto;max-height:90vh;border-radius:.75rem;bottom:auto;left:auto;right:auto}}@media(min-width:1024px){.modal-responsive-lg{max-width:72rem}}.modal-drag-indicator{display:block;width:3rem;height:.25rem;background-color:#78716c80;border-radius:9999px;margin:.5rem auto}@media(min-width:768px){.modal-drag-indicator{display:none}}@keyframes slideUpMobile{0%{transform:translateY(100%);opacity:.8}to{transform:translateY(0);opacity:1}}.animate-slide-up-mobile{animation:slideUpMobile .3s cubic-bezier(.16,1,.3,1)}@media(min-width:768px){.animate-slide-up-mobile{animation:none}}.touch-target{min-width:44px;min-height:44px;display:inline-flex;align-items:center;justify-content:center;padding:.5rem}.touch-feedback{transition:all .2s ease;-webkit-tap-highlight-color:transparent}.touch-feedback:active{transform:scale(.95);opacity:.8}.btn-responsive{width:100%;padding:.75rem 1rem;font-size:1rem;min-height:44px}@media(min-width:640px){.btn-responsive{width:auto;min-width:120px;padding:.5rem 1.5rem}}.btn-group-mobile{display:flex;flex-direction:column;gap:.5rem;width:100%}@media(min-width:640px){.btn-group-mobile{flex-direction:row;width:auto;gap:1rem}}.responsive-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem}@media(min-width:640px){.responsive-grid{grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem}}@media(min-width:1024px){.responsive-grid{grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem}}.card-grid-mobile{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem}@media(min-width:480px){.card-grid-mobile{grid-template-columns:repeat(3,1fr);gap:.75rem}}@media(min-width:768px){.card-grid-mobile{grid-template-columns:repeat(4,1fr);gap:1rem}}@media(min-width:1024px){.card-grid-mobile{grid-template-columns:repeat(5,1fr);gap:1rem}}.text-responsive-title{font-size:clamp(1.25rem,4vw,2rem);line-height:1.2}.text-responsive-subtitle{font-size:clamp(1rem,3vw,1.5rem);line-height:1.3}.text-responsive-body{font-size:clamp(.875rem,2vw,1rem);line-height:1.6}.text-responsive-small{font-size:clamp(.75rem,1.5vw,.875rem);line-height:1.4}.card-responsive{width:100%;max-width:100%;padding:.75rem}@media(min-width:640px){.card-responsive{max-width:20rem;padding:1rem}}.character-card-responsive{width:100%;aspect-ratio:2/3;min-width:120px}@media(min-width:480px){.character-card-responsive{min-width:150px}}@media(min-width:768px){.character-card-responsive{min-width:180px}}.show-mobile{display:block}@media(min-width:768px){.show-mobile{display:none!important}}.hide-mobile{display:none}@media(min-width:768px){.hide-mobile{display:block}}.show-tablet{display:none}@media(min-width:640px){.show-tablet{display:block}}.topbar-responsive{height:3rem;padding:.5rem}@media(min-width:768px){.topbar-responsive{height:4rem;padding:1rem}}.bottombar-responsive{height:5rem;padding:.5rem}@media(min-width:768px){.bottombar-responsive{height:7rem;padding:1rem}}.input-responsive{width:100%;padding:.75rem;font-size:1rem;min-height:44px}@media(min-width:640px){.input-responsive{padding:.5rem .75rem}}.select-responsive{width:100%;padding:.75rem;font-size:1rem;min-height:44px}@media(min-width:640px){.select-responsive{width:auto;min-width:200px}}.gap-responsive{gap:.5rem}@media(min-width:768px){.gap-responsive{gap:1rem}}.gap-responsive-lg{gap:.75rem}@media(min-width:768px){.gap-responsive-lg{gap:1.5rem}}.scroll-mobile{overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior:contain}.scroll-horizontal-mobile{display:flex;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scroll-snap-type:x mandatory;gap:.5rem;padding:.5rem}.scroll-horizontal-mobile>*{flex-shrink:0;scroll-snap-align:start}.scrollbar-hide{-ms-overflow-style:none;scrollbar-width:none}.scrollbar-hide::-webkit-scrollbar{display:none}.img-responsive{width:100%;height:auto;object-fit:cover}.avatar-responsive{width:2.5rem;height:2.5rem}@media(min-width:768px){.avatar-responsive{width:3rem;height:3rem}}.safe-area-inset-top{padding-top:env(safe-area-inset-top)}.safe-area-inset-bottom{padding-bottom:env(safe-area-inset-bottom)}.safe-area-inset-left{padding-left:env(safe-area-inset-left)}.safe-area-inset-right{padding-right:env(safe-area-inset-right)}.gpu-accelerated{transform:translateZ(0);will-change:transform;backface-visibility:hidden}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}#root *{box-sizing:border-box}.fixed-container-topbar{height:48px!important;min-height:48px!important;max-height:48px!important;padding:.5rem!important;font-size:.875rem!important}.fixed-container-topbar .text-xl{font-size:1rem!important}.fixed-container-topbar .text-lg{font-size:.875rem!important}.fixed-container-bottombar{height:100px!important;min-height:100px!important;max-height:100px!important;padding:.5rem!important}.fixed-container-bottombar button{padding:.375rem .75rem!important;font-size:.75rem!important;min-height:32px!important}.fixed-container-bottombar .text-xs{font-size:.625rem!important}.fixed-container-main{height:812px!important;max-height:812px!important;overflow-y:auto!important;overflow-x:hidden!important;-webkit-overflow-scrolling:touch}.fixed-container-story{padding:1rem!important;font-size:.875rem!important;line-height:1.6!important}.fixed-container-modal{width:500px!important;max-width:500px!important;max-height:880px!important;margin:40px auto!important}.fixed-container-modal-header{padding:.75rem!important;font-size:1rem!important}.fixed-container-modal-content{max-height:700px!important;overflow-y:auto!important;padding:1rem!important;font-size:.875rem!important}.fixed-container-card-grid{display:grid!important;grid-template-columns:repeat(3,1fr)!important;gap:.5rem!important;padding:.5rem!important}.fixed-container-character-card{width:100%!important;min-width:0!important;aspect-ratio:2/3!important}.fixed-container-character-card .text-sm{font-size:.75rem!important}.fixed-container-character-card .text-xs{font-size:.625rem!important}.fixed-container-battlefield{height:400px!important;max-height:400px!important}.fixed-container-battle-character{max-width:200px!important;max-height:300px!important}.fixed-container-battle-actions{height:200px!important;max-height:200px!important}.fixed-container-battle-narrator{height:180px!important;max-height:180px!important;overflow-y:auto!important;font-size:.875rem!important}.fixed-container-btn-group{display:flex!important;flex-wrap:wrap!important;gap:.375rem!important;justify-content:center!important}.fixed-container-btn{padding:.5rem 1rem!important;font-size:.875rem!important;min-height:36px!important;white-space:nowrap!important}.fixed-container-btn-sm{padding:.375rem .75rem!important;font-size:.75rem!important;min-height:32px!important}.fixed-container-list{max-height:600px!important;overflow-y:auto!important}.fixed-container-list-item{padding:.75rem!important;font-size:.875rem!important}.fixed-container-input,.fixed-container-select{width:100%!important;padding:.5rem!important;font-size:.875rem!important}.fixed-container-scroll::-webkit-scrollbar{width:6px!important;height:6px!important}.fixed-container-scroll::-webkit-scrollbar-track{background:#1c191780!important}.fixed-container-scroll::-webkit-scrollbar-thumb{background:#57534e!important;border-radius:3px!important}.fixed-container-scroll::-webkit-scrollbar-thumb:hover{background:#78716c!important}.fixed-container-text-xs{font-size:.625rem!important;line-height:1.4!important}.fixed-container-text-sm{font-size:.75rem!important;line-height:1.5!important}.fixed-container-text-base{font-size:.875rem!important;line-height:1.6!important}.fixed-container-text-lg{font-size:1rem!important;line-height:1.5!important}.fixed-container-text-xl{font-size:1.125rem!important;line-height:1.4!important}.fixed-container-p-tight{padding:.5rem!important}.fixed-container-m-tight{margin:.5rem!important}.fixed-container-gap-tight{gap:.5rem!important}.fixed-container-announcement{height:28px!important;font-size:.75rem!important;padding:.25rem .5rem!important}.fixed-container-avatar{width:2rem!important;height:2rem!important}.fixed-container-avatar-lg{width:3rem!important;height:3rem!important}.fixed-container-icon{width:1rem!important;height:1rem!important}.fixed-container-icon-lg{width:1.5rem!important;height:1.5rem!important}.fixed-container-progress{height:.5rem!important}.fixed-container-progress-lg{height:.75rem!important}.fixed-container-badge{padding:.125rem .375rem!important;font-size:.625rem!important}.fixed-container-start-screen{width:540px!important;height:960px!important}.fixed-container-map{width:100%!important;height:100%!important;max-width:540px!important;max-height:960px!important}@media(min-width:640px),(min-width:768px),(min-width:1024px),(min-width:1280px){.fixed-container-no-responsive *{font-size:inherit!important;padding:inherit!important;margin:inherit!important}}:root{--primary-gold: #fcd34d;--primary-gold-light: #fde68a;--primary-gold-dark: #f59e0b;--bg-primary: #1c1917;--bg-secondary: #292524;--bg-overlay: rgba(0, 0, 0, .8);--accent-red: #dc2626;--accent-blue: #2563eb;--accent-purple: #9333ea;--accent-green: #10b981;--accent-pink: #ec4899;--accent-cyan: #06b6d4;--rarity-common: #9ca3af;--rarity-uncommon: #10b981;--rarity-rare: #3b82f6;--rarity-epic: #a855f7;--rarity-legendary: #f59e0b;--rarity-mythic: #ec4899;--rarity-divine: #8b5cf6;--glow-gold: 0 0 20px rgba(252, 211, 77, .4);--glow-red: 0 0 20px rgba(220, 38, 38, .4);--glow-blue: 0 0 20px rgba(37, 99, 235, .4);--glow-purple: 0 0 20px rgba(147, 51, 234, .4);--transition-fast: .2s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out}.ornate-border{position:relative;border:2px solid rgba(252,211,77,.3);box-shadow:0 0 30px #fcd34d1a,inset 0 0 20px #fcd34d0d}.ornate-border:before{content:"";position:absolute;top:-4px;right:-4px;bottom:-4px;left:-4px;border-radius:inherit;padding:2px;background:linear-gradient(135deg,#fcd34d66,#dc262633,#9333ea4d,#fcd34d66);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;animation:rotateBorder 8s linear infinite}@keyframes rotateBorder{0%,to{filter:hue-rotate(0deg)}50%{filter:hue-rotate(60deg)}}.ornate-border-dialog{border:2px solid rgba(252,211,77,.2);box-shadow:0 10px 50px #00000080,inset 0 0 30px #fcd34d0d}.card-3d-hover{transition:transform .3s ease,box-shadow .3s ease;transform-style:preserve-3d}.card-3d-hover:hover{transform:translateY(-8px) rotateX(5deg) rotateY(5deg) scale(1.02);box-shadow:0 20px 40px #0006,0 0 30px #fcd34d33}.card-legendary-glow{position:relative;animation:legendaryPulse 2s ease-in-out infinite}.card-legendary-glow:before{content:"";position:absolute;top:-2px;right:-2px;bottom:-2px;left:-2px;border-radius:inherit;background:linear-gradient(45deg,#f59e0b,#fbbf24,#f59e0b);opacity:.6;filter:blur(8px);z-index:-1;animation:rotateGradient 3s linear infinite}@keyframes legendaryPulse{0%,to{box-shadow:0 0 20px #f59e0b99}50%{box-shadow:0 0 40px #f59e0be6}}@keyframes rotateGradient{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.card-shine{position:relative;overflow:hidden}.card-shine:after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.3) 50%,transparent 70%);transform:translate(-100%);transition:transform .8s}.card-shine:hover:after{transform:translate(100%)}.btn-primary-enhanced{position:relative;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;font-weight:700;padding:.75rem 1.5rem;border-radius:.5rem;border:2px solid rgba(252,211,77,.5);box-shadow:0 4px 15px #f59e0b4d,inset 0 1px #fff3;transition:all .3s ease;overflow:hidden;cursor:pointer}.btn-primary-enhanced:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(135deg,transparent 0%,rgba(255,255,255,.2) 100%);transform:translateY(-100%);transition:transform .3s}.btn-primary-enhanced:hover:before{transform:translateY(0)}.btn-primary-enhanced:hover{transform:translateY(-2px);box-shadow:0 8px 25px #f59e0b80,inset 0 1px #ffffff4d}.btn-primary-enhanced:active{transform:translateY(0)}.hp-bar-enhanced{position:relative;height:12px;background:#1c1917cc;border-radius:999px;overflow:hidden;box-shadow:inset 0 2px 4px #00000080}.hp-bar-fill-enhanced{height:100%;background:linear-gradient(90deg,#dc2626,#ef4444,#f87171);border-radius:999px;box-shadow:0 0 10px #dc262680,inset 0 1px #ffffff4d;transition:width .5s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}.hp-bar-fill-enhanced:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.3) 50%,transparent 100%);animation:shimmer 2s infinite}@keyframes shimmer{0%{transform:translate(-100%)}to{transform:translate(200%)}}@keyframes modalSlideIn{0%{opacity:0;transform:translateY(-50px) scale(.9)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-slide-in{animation:modalSlideIn .4s cubic-bezier(.16,1,.3,1)}.scrollbar-enhanced::-webkit-scrollbar{width:8px;height:8px}.scrollbar-enhanced::-webkit-scrollbar-track{background:#29252480;border-radius:4px}.scrollbar-enhanced::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#fcd34d99,#f59e0b99);border-radius:4px;border:2px solid rgba(41,37,36,.5)}.scrollbar-enhanced::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#fcd34dcc,#f59e0bcc)}.custom-scrollbar::-webkit-scrollbar{width:12px}.custom-scrollbar::-webkit-scrollbar-track{background:linear-gradient(to right,#1c191780,#29252480,#1c191780);border-radius:6px;border:1px solid rgba(120,113,108,.2)}.custom-scrollbar::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#fbbf24b3,#f59e0bcc,#d97706b3);border-radius:6px;border:2px solid rgba(28,25,23,.8);box-shadow:0 0 10px #fbbf244d,inset 0 1px #fff3;transition:all .3s ease}.custom-scrollbar::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#fbbf24e6,#f59e0b,#d97706e6);box-shadow:0 0 15px #fbbf2480,inset 0 1px #ffffff4d}.custom-scrollbar::-webkit-scrollbar-thumb:active{background:linear-gradient(180deg,#d97706e6,#f59e0b,#fbbf24e6)}@keyframes pulsGlow{0%,to{box-shadow:0 0 10px #fcd34d80}50%{box-shadow:0 0 30px #fcd34dcc}}.animate-pulse-glow{animation:pulseGlow 2s ease-in-out infinite}@keyframes float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}.animate-float{animation:float 3s ease-in-out infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin-slow{animation:spin 3s linear infinite}.glass-morphism{background:#1c1917b3;-webkit-backdrop-filter:blur(10px) saturate(150%);backdrop-filter:blur(10px) saturate(150%);border:1px solid rgba(252,211,77,.1)}.glass-morphism-light{background:#29252480;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.particle-bg{position:fixed;top:0;right:0;bottom:0;left:0;background:radial-gradient(2px 2px at 20% 30%,white,transparent),radial-gradient(2px 2px at 60% 70%,white,transparent),radial-gradient(1px 1px at 50% 50%,white,transparent),radial-gradient(1px 1px at 80% 10%,white,transparent),radial-gradient(2px 2px at 90% 60%,white,transparent),radial-gradient(1px 1px at 33% 80%,white,transparent);background-size:200% 200%;animation:starTwinkle 4s ease-in-out infinite;pointer-events:none;opacity:.3}@keyframes starTwinkle{0%,to{opacity:.2}50%{opacity:.4}}.text-gradient-gold{background:linear-gradient(135deg,#fde68a,#fcd34d,#f59e0b);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-weight:700}.text-glow{text-shadow:0 0 10px rgba(252,211,77,.5),0 0 20px rgba(252,211,77,.3),0 0 30px rgba(252,211,77,.1)}.text-stroke{-webkit-text-stroke:1px rgba(0,0,0,.5);paint-order:stroke fill}.center-container{display:flex;align-items:center;justify-content:center}.full-cover{position:fixed;top:0;right:0;bottom:0;left:0;z-index:9999}.no-select{user-select:none;-webkit-user-select:none}.gpu-accelerated{transform:translateZ(0);will-change:transform}</style>
</head>
  <body class="bg-stone-950 text-stone-300 font-sans">
    <div id="root" class="w-full"></div>
  </body>
</html>