<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>仙侠卡牌RPG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- 水墨书法字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;500;600;700&family=ZCOOL+XiaoWei&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'serif': ['"Noto Serif SC"', 'serif'],
              'sans': ['"Noto Serif SC"', 'serif'],
              'brush': ['"Ma Shan Zheng"', '"ZCOOL XiaoWei"', 'cursive'],
              'elegant': ['"ZCOOL XiaoWei"', '"Noto Serif SC"', 'serif'],
            },
            colors: {
              // 水墨主色调
              'ink': {
                50: '#fafafa',
                100: '#f5f5f5',
                200: '#e5e5e5',
                300: '#d4d4d4',
                400: '#a3a3a3',
                500: '#737373',
                600: '#525252',
                700: '#404040',
                800: '#262626',
                900: '#171717',
                950: '#0a0a0a',
              },
              // 宣纸色
              'paper': {
                50: '#fefdfb',
                100: '#fdf9f3',
                200: '#faf3e8',
                300: '#f5ead8',
                400: '#ede0c8',
                500: '#e2d4b8',
                600: '#d4c4a8',
                700: '#c4b498',
                800: '#b0a088',
                900: '#968878',
              },
              // 淡金点缀
              'gold': {
                50: '#fffbeb',
                100: '#fef3c7',
                200: '#fde68a',
                300: '#fcd34d',
                400: '#d4a574',
                500: '#b8956a',
                600: '#9a7b55',
                700: '#7c6244',
                800: '#5e4a33',
                900: '#403222',
              },
              // 朱砂红（偶尔点缀）
              'cinnabar': {
                400: '#c75050',
                500: '#a63d3d',
                600: '#8b3030',
              },
            },
            animation: {
              'fade-in': 'fadeIn 0.6s ease-out',
              'slide-up': 'slideUp 0.4s ease-out',
              'pulse-soft': 'pulseSoft 3s ease-in-out infinite',
              'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
              'flash': 'flash 0.5s ease-out',
              'glow': 'inkGlow 3s ease-in-out infinite alternate',
              'float': 'float 4s ease-in-out infinite',
              'marquee': 'marquee 40s linear infinite',
              'ink-spread': 'inkSpread 1.5s ease-out forwards',
              'brush-stroke': 'brushStroke 0.8s ease-out',
              'mist-float': 'mistFloat 8s ease-in-out infinite',
            },
            keyframes: {
              fadeIn: {
                '0%': { opacity: 0, transform: 'translateY(10px)' },
                '100%': { opacity: 1, transform: 'translateY(0)' },
              },
              slideUp: {
                '0%': { transform: 'translateY(100%)', opacity: 0.8 },
                '100%': { transform: 'translateY(0)', opacity: 1 },
              },
              pulseSoft: {
                '0%, 100%': { opacity: 0.8 },
                '50%': { opacity: 1 },
              },
              shake: {
                '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                '40%, 60%': { transform: 'translate3d(4px, 0, 0)' },
              },
              flash: {
                '0%, 100%': { opacity: 1 },
                '50%': { opacity: 0.1 },
              },
              inkGlow: {
                'from': { textShadow: '0 0 8px rgba(180, 160, 120, 0.3), 0 0 16px rgba(180, 160, 120, 0.1)' },
                'to': { textShadow: '0 0 12px rgba(180, 160, 120, 0.5), 0 0 24px rgba(180, 160, 120, 0.2)' },
              },
              float: {
                '0%, 100%': { transform: 'translateY(0px)' },
                '50%': { transform: 'translateY(-6px)' },
              },
              marquee: {
                '0%': { transform: 'translateX(0)' },
                '100%': { transform: 'translateX(-50%)' },
              },
              inkSpread: {
                '0%': { transform: 'scale(0.8)', opacity: 0, filter: 'blur(4px)' },
                '100%': { transform: 'scale(1)', opacity: 1, filter: 'blur(0)' },
              },
              brushStroke: {
                '0%': { clipPath: 'inset(0 100% 0 0)' },
                '100%': { clipPath: 'inset(0 0 0 0)' },
              },
              mistFloat: {
                '0%, 100%': { transform: 'translateX(0) translateY(0)', opacity: 0.3 },
                '25%': { transform: 'translateX(10px) translateY(-5px)', opacity: 0.5 },
                '50%': { transform: 'translateX(5px) translateY(5px)', opacity: 0.4 },
                '75%': { transform: 'translateX(-5px) translateY(-3px)', opacity: 0.5 },
              },
            },
            boxShadow: {
              'ink': '0 4px 20px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)',
              'ink-lg': '0 8px 40px rgba(0, 0, 0, 0.2), 0 4px 16px rgba(0, 0, 0, 0.1)',
              'gold-glow': '0 0 20px rgba(180, 149, 106, 0.3)',
              'inner-ink': 'inset 0 2px 10px rgba(0, 0, 0, 0.1)',
            },
          },
        },
      }
    </script>

<style>
    /* ===== 水墨风格主题 ===== */
    :root {
        /* 水墨色彩变量 */
        --ink-darkest: #0a0a0a;
        --ink-dark: #1a1a1a;
        --ink-medium: #2d2d2d;
        --ink-light: #404040;
        --ink-lighter: #525252;
        --ink-faint: #737373;
        
        /* 宣纸色 */
        --paper-white: #fdfbf7;
        --paper-cream: #f5f0e6;
        --paper-aged: #e8e0d0;
        
        /* 淡金点缀 */
        --gold-light: #d4b896;
        --gold-medium: #b8956a;
        --gold-dark: #8b7355;
        
        /* 朱砂红 */
        --cinnabar: #a63d3d;
        
        /* 水墨渐变 */
        --ink-gradient: linear-gradient(135deg, rgba(20, 20, 20, 0.95) 0%, rgba(35, 35, 35, 0.9) 50%, rgba(25, 25, 25, 0.95) 100%);
        --paper-gradient: linear-gradient(180deg, rgba(253, 251, 247, 0.08) 0%, rgba(245, 240, 230, 0.03) 100%);
    }

    /* 响应式布局 - 移动端和桌面端自适应 */
    html {
        margin: 0;
        padding: 0;
        width: 100%;
        overflow-x: hidden;
        overflow-y: auto;
    }
    
    body {
        margin: 0;
        padding: 0;
        min-height: 100vh;
        width: 100%;
        /* 水墨山水背景 */
        background-color: var(--ink-darkest);
        background-image: 
            /* 水墨云雾效果层 */
            radial-gradient(ellipse at 20% 20%, rgba(255, 255, 255, 0.03) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 80%, rgba(255, 255, 255, 0.02) 0%, transparent 50%),
            radial-gradient(ellipse at 50% 50%, rgba(180, 149, 106, 0.02) 0%, transparent 70%),
            /* 主背景 - 水墨山水 */
            url('https://images.unsplash.com/photo-1513475382585-d06e58bcb0e0?w=1920&q=80');
        background-size: cover;
        background-position: center;
        background-attachment: scroll;
        overflow-x: hidden;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        font-family: 'Noto Serif SC', serif;
    }
    
    /* 添加全局水墨纹理叠加 */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            /* 宣纸纹理 */
            url('https://www.transparenttextures.com/patterns/rice-paper-3.png'),
            var(--ink-gradient);
        opacity: 0.88;
        pointer-events: none;
        z-index: 0;
    }

    /* 桌面端使用固定背景 */
    @media (min-width: 768px) {
        body {
            background-attachment: fixed;
        }
    }

    /* 响应式根容器 */
    #root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
    }

    /* 优化触控体验 */
    * {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }

    button, a {
        -webkit-user-select: none;
        user-select: none;
    }

    /* 水墨风格文本排版 */
    .prose {
        --tw-prose-body: #d4d4d4;
        --tw-prose-headings: var(--gold-light);
        --tw-prose-invert-body: #d4d4d4;
        --tw-prose-invert-headings: var(--gold-light);
        line-height: 2;
        letter-spacing: 0.05em;
    }

    /* 水墨风格滚动条 */
    ::-webkit-scrollbar {
        width: 4px;
        height: 4px;
    }
    ::-webkit-scrollbar-track {
        background: rgba(20, 20, 20, 0.6);
    }
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, var(--gold-medium) 0%, var(--gold-dark) 100%);
        border-radius: 2px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, var(--gold-light) 0%, var(--gold-medium) 100%);
    }

    /* 通用动画 - 按钮反馈 */
    @keyframes button-press {
        0% { transform: scale(1); }
        50% { transform: scale(0.97); }
        100% { transform: scale(1); }
    }

    /* 焦点优化 - 使用淡金色 */
    :focus-visible {
        outline: 1px solid var(--gold-medium);
        outline-offset: 2px;
        border-radius: 2px;
    }

    /* ===== 水墨风格组件 ===== */
    
    /* 水墨边框 */
    .ink-border {
        border: 1px solid rgba(180, 149, 106, 0.3);
        box-shadow: 
            inset 0 0 20px rgba(0, 0, 0, 0.3),
            0 0 1px rgba(180, 149, 106, 0.2);
    }

    /* 水墨卡片 */
    .ink-card {
        background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(20, 20, 20, 0.98) 100%);
        border: 1px solid rgba(180, 149, 106, 0.2);
        box-shadow: 
            0 4px 20px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(8px);
    }

    /* 水墨按钮基础样式 */
    .ink-btn {
        background: linear-gradient(135deg, rgba(40, 40, 40, 0.9) 0%, rgba(30, 30, 30, 0.95) 100%);
        border: 1px solid rgba(180, 149, 106, 0.3);
        color: var(--gold-light);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .ink-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(180, 149, 106, 0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .ink-btn:hover::before {
        left: 100%;
    }
    
    .ink-btn:hover {
        border-color: rgba(180, 149, 106, 0.5);
        box-shadow: 0 0 15px rgba(180, 149, 106, 0.15);
    }

    /* 水墨标题样式 */
    .ink-title {
        color: var(--gold-light);
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        letter-spacing: 0.1em;
    }

    /* 毛笔字效果 */
    .brush-text {
        font-family: 'Ma Shan Zheng', 'ZCOOL XiaoWei', cursive;
        letter-spacing: 0.15em;
    }

    /* 卷轴容器 - 水墨版 */
    .scroll-container {
        background: linear-gradient(180deg, rgba(253, 251, 247, 0.95) 0%, rgba(245, 240, 230, 0.95) 100%);
        color: #2d2d2d;
        border: none;
        box-shadow: 
            0 10px 40px rgba(0, 0, 0, 0.5),
            inset 0 0 60px rgba(0, 0, 0, 0.05);
        padding: 2rem;
        position: relative;
    }
    
    .scroll-container .prose {
        --tw-prose-body: #3d3d3d;
        --tw-prose-headings: #5c4a3a;
    }

    /* 神品彩虹效果保留但调整为更淡雅 */
    .text-rainbow {
        background-image: linear-gradient(to right, #a3a3a3, #d4b896, #b8956a, #a3a3a3);
        background-size: 200% auto;
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: rainbow-flow 4s linear infinite;
    }
    @keyframes rainbow-flow {
        to {
            background-position: 200% center;
        }
    }

    /* 毛玻璃效果增强 */
    .backdrop-blur-sm {
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
    }
    .backdrop-blur-md {
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    /* 水墨卡片阴影 */
    .shadow-card {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    .shadow-card-hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.25);
    }

    /* 加载动画优化 - 使用淡金色 */
    @keyframes pulse-glow {
        0%, 100% {
            opacity: 1;
            box-shadow: 0 0 0 0 rgba(180, 149, 106, 0.5);
        }
        50% {
            opacity: 0.8;
            box-shadow: 0 0 0 10px rgba(180, 149, 106, 0);
        }
    }

    /* 响应式字体大小 */
    @media (max-width: 640px) {
        html {
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        html {
            font-size: 12px;
        }
    }

    /* 触摸目标最小尺寸 */
    @media (max-width: 768px) {
        button, a, .interactive {
            min-width: 44px;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    }

    /* ===== 水墨装饰元素 ===== */
    
    /* 水墨分隔线 */
    .ink-divider {
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(180, 149, 106, 0.4), transparent);
        border: none;
        margin: 1rem 0;
    }

    /* 印章效果 */
    .seal-stamp {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border: 2px solid var(--cinnabar);
        color: var(--cinnabar);
        font-family: 'Ma Shan Zheng', cursive;
        transform: rotate(-5deg);
        opacity: 0.9;
    }

    /* 水墨晕染背景 */
    .ink-wash {
        background: radial-gradient(ellipse at center, rgba(60, 60, 60, 0.3) 0%, transparent 70%);
    }

    /* 云雾装饰 */
    .mist-decoration {
        position: absolute;
        width: 200px;
        height: 100px;
        background: radial-gradient(ellipse, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
        pointer-events: none;
        animation: mistFloat 8s ease-in-out infinite;
    }

    /* 竹节边框装饰 */
    .bamboo-corner::before {
        content: '◆';
        position: absolute;
        top: -8px;
        left: -8px;
        color: var(--gold-medium);
        font-size: 12px;
        opacity: 0.6;
    }
    
    .bamboo-corner::after {
        content: '◆';
        position: absolute;
        bottom: -8px;
        right: -8px;
        color: var(--gold-medium);
        font-size: 12px;
        opacity: 0.6;
    }

    /* 古典边框 */
    .classic-border {
        border: 1px solid rgba(180, 149, 106, 0.3);
        position: relative;
    }
    
    .classic-border::before {
        content: '';
        position: absolute;
        top: 3px;
        left: 3px;
        right: 3px;
        bottom: 3px;
        border: 1px solid rgba(180, 149, 106, 0.15);
        pointer-events: none;
    }

    /* 渐隐边缘效果 */
    .fade-edges {
        mask-image: linear-gradient(to bottom, 
            transparent 0%, 
            black 5%, 
            black 95%, 
            transparent 100%);
        -webkit-mask-image: linear-gradient(to bottom, 
            transparent 0%, 
            black 5%, 
            black 95%, 
            transparent 100%);
    }

    /* 墨迹溅射效果（用于特殊状态） */
    .ink-splash {
        position: relative;
    }
    
    .ink-splash::after {
        content: '';
        position: absolute;
        top: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        background: radial-gradient(circle at 30% 30%, rgba(40, 40, 40, 0.8) 0%, transparent 60%);
        pointer-events: none;
    }

    /* 悬浮状态的墨晕效果 */
    .hover-ink-glow {
        transition: all 0.3s ease;
    }
    
    .hover-ink-glow:hover {
        box-shadow: 
            0 0 20px rgba(180, 149, 106, 0.15),
            inset 0 0 20px rgba(180, 149, 106, 0.05);
    }

    /* 文字墨迹效果 */
    .text-ink-effect {
        text-shadow:
            1px 1px 2px rgba(0, 0, 0, 0.3),
            -1px -1px 1px rgba(255, 255, 255, 0.05);
    }

    /* ===== 修仙风格装饰增强 ===== */
    
    /* 八卦旋转装饰 */
    .bagua-spin {
        display: inline-block;
        animation: baguaSpin 20s linear infinite;
    }
    
    .bagua-spin::before {
        content: '☯';
        font-size: 1.5em;
        color: var(--gold-medium);
        opacity: 0.7;
        display: block;
    }
    
    @keyframes baguaSpin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* 仙气缭绕效果 */
    .immortal-mist {
        position: relative;
        overflow: hidden;
    }
    
    .immortal-mist::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 300%;
        height: 100%;
        background: linear-gradient(90deg,
            transparent 0%,
            rgba(255, 255, 255, 0.02) 20%,
            rgba(180, 149, 106, 0.03) 40%,
            rgba(255, 255, 255, 0.03) 60%,
            rgba(180, 149, 106, 0.02) 80%,
            transparent 100%);
        animation: immortalMistFlow 12s linear infinite;
        pointer-events: none;
    }
    
    @keyframes immortalMistFlow {
        0% { transform: translateX(0); }
        100% { transform: translateX(33.33%); }
    }

    /* 灵气流动按钮 */
    .qi-flow-btn {
        background: linear-gradient(135deg, rgba(40, 40, 40, 0.95) 0%, rgba(25, 25, 25, 0.98) 100%);
        border: 1px solid rgba(180, 149, 106, 0.4);
        color: var(--gold-light);
        position: relative;
        overflow: hidden;
        transition: all 0.4s ease;
    }
    
    .qi-flow-btn::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: conic-gradient(from 0deg, transparent, rgba(184, 149, 106, 0.15), transparent, rgba(184, 149, 106, 0.1), transparent);
        animation: qiRotate 8s linear infinite;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .qi-flow-btn:hover::before {
        opacity: 1;
    }
    
    .qi-flow-btn::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(180, 149, 106, 0.15), transparent);
        transition: left 0.6s ease;
    }
    
    .qi-flow-btn:hover::after {
        left: 100%;
    }
    
    .qi-flow-btn:hover {
        border-color: rgba(180, 149, 106, 0.6);
        box-shadow:
            0 0 25px rgba(180, 149, 106, 0.2),
            0 0 50px rgba(180, 149, 106, 0.1),
            inset 0 0 20px rgba(180, 149, 106, 0.05);
        text-shadow: 0 0 15px rgba(180, 149, 106, 0.6);
    }
    
    @keyframes qiRotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* 法阵装饰背景 */
    .magic-circle-bg {
        position: relative;
    }
    
    .magic-circle-bg::before {
        content: '✧';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 6rem;
        color: var(--gold-medium);
        opacity: 0.05;
        animation: pulseSoft 4s ease-in-out infinite;
        pointer-events: none;
    }

    /* 仙侠边框装饰 */
    .xianxia-frame {
        position: relative;
        border: 1px solid rgba(180, 149, 106, 0.3);
    }
    
    .xianxia-frame::before,
    .xianxia-frame::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border: 1px solid rgba(180, 149, 106, 0.5);
        pointer-events: none;
    }
    
    .xianxia-frame::before {
        top: -1px;
        left: -1px;
        border-right: none;
        border-bottom: none;
    }
    
    .xianxia-frame::after {
        bottom: -1px;
        right: -1px;
        border-left: none;
        border-top: none;
    }

    /* 四角祥云装饰 */
    .cloud-corners {
        position: relative;
    }
    
    .cloud-corners::before {
        content: '☁';
        position: absolute;
        top: 4px;
        left: 8px;
        font-size: 0.8rem;
        color: var(--gold-medium);
        opacity: 0.4;
    }
    
    .cloud-corners::after {
        content: '☁';
        position: absolute;
        bottom: 4px;
        right: 8px;
        font-size: 0.8rem;
        color: var(--gold-medium);
        opacity: 0.4;
        transform: scaleX(-1);
    }

    /* 玉简风格标签 */
    .jade-slip {
        background: linear-gradient(135deg, rgba(180, 200, 180, 0.08) 0%, rgba(150, 180, 150, 0.04) 100%);
        border: 1px solid rgba(180, 200, 180, 0.25);
        color: rgba(200, 220, 200, 0.9);
        padding: 0.25rem 0.75rem;
        font-size: 0.85rem;
        position: relative;
    }
    
    .jade-slip::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(200, 220, 200, 0.4), transparent);
    }
    
    .jade-slip::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(200, 220, 200, 0.2), transparent);
    }

    /* 灵石图标 */
    .spirit-stone::before {
        content: '◈';
        margin-right: 0.3rem;
        color: var(--gold-medium);
        text-shadow: 0 0 8px rgba(184, 149, 106, 0.5);
    }

    /* 丹药图标 */
    .elixir-icon::before {
        content: '⚗';
        margin-right: 0.3rem;
        color: var(--cinnabar);
        text-shadow: 0 0 6px rgba(166, 61, 61, 0.4);
    }

    /* 剑气图标 */
    .sword-qi::before {
        content: '⚔';
        margin-right: 0.3rem;
        color: var(--gold-light);
        text-shadow: 0 0 8px rgba(212, 184, 150, 0.5);
    }

    /* 修为境界标识 */
    .realm-mark {
        background: linear-gradient(135deg, rgba(184, 149, 106, 0.15) 0%, rgba(140, 110, 70, 0.08) 100%);
        border: 1px solid rgba(184, 149, 106, 0.35);
        padding: 0.2rem 0.8rem;
        clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
        position: relative;
    }
    
    .realm-mark::before {
        content: '';
        position: absolute;
        inset: 1px;
        background: linear-gradient(135deg, rgba(20, 20, 20, 0.95) 0%, rgba(15, 15, 15, 0.98) 100%);
        clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
        z-index: -1;
    }

    /* 技能/法术图标框 */
    .skill-frame {
        width: 52px;
        height: 52px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(35, 35, 35, 0.95) 0%, rgba(25, 25, 25, 0.98) 100%);
        border: 2px solid rgba(180, 149, 106, 0.35);
        position: relative;
    }
    
    .skill-frame::before {
        content: '';
        position: absolute;
        inset: 3px;
        border: 1px solid rgba(180, 149, 106, 0.2);
    }
    
    .skill-frame::after {
        content: '';
        position: absolute;
        inset: -4px;
        border: 1px solid rgba(180, 149, 106, 0.1);
    }
    
    .skill-frame:hover {
        border-color: rgba(180, 149, 106, 0.6);
        box-shadow: 0 0 15px rgba(180, 149, 106, 0.2);
    }

    /* 仙侠进度条 */
    .cultivation-progress {
        height: 10px;
        background: rgba(20, 20, 20, 0.9);
        border: 1px solid rgba(180, 149, 106, 0.25);
        border-radius: 1px;
        overflow: hidden;
        position: relative;
    }
    
    .cultivation-progress-bar {
        height: 100%;
        background: linear-gradient(90deg,
            rgba(140, 110, 70, 0.7) 0%,
            rgba(184, 149, 106, 0.9) 40%,
            rgba(212, 181, 150, 1) 60%,
            rgba(184, 149, 106, 0.9) 100%);
        position: relative;
        transition: width 0.6s ease;
    }
    
    .cultivation-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: progressGlow 2.5s ease-in-out infinite;
    }
    
    @keyframes progressGlow {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* 门派/势力徽章 */
    .sect-emblem {
        width: 64px;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle, rgba(184, 149, 106, 0.08) 0%, transparent 70%);
        border: 2px solid rgba(180, 149, 106, 0.25);
        border-radius: 50%;
        position: relative;
    }
    
    .sect-emblem::before {
        content: '';
        position: absolute;
        inset: 5px;
        border: 1px solid rgba(180, 149, 106, 0.15);
        border-radius: 50%;
    }
    
    .sect-emblem::after {
        content: '';
        position: absolute;
        inset: -8px;
        border: 1px dashed rgba(180, 149, 106, 0.12);
        border-radius: 50%;
        animation: baguaSpin 40s linear infinite reverse;
    }

    /* 卷轴装饰标题 */
    .scroll-title {
        position: relative;
        display: inline-block;
        padding: 0 2.5rem;
    }
    
    .scroll-title::before,
    .scroll-title::after {
        content: '〓';
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gold-medium);
        opacity: 0.5;
        font-size: 0.75em;
    }
    
    .scroll-title::before {
        left: 0;
    }
    
    .scroll-title::after {
        right: 0;
    }

    /* 古典分隔装饰 */
    .ancient-divider {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem 0;
    }
    
    .ancient-divider::before,
    .ancient-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(180, 149, 106, 0.4), transparent);
    }
    
    .ancient-divider-symbol {
        color: var(--gold-medium);
        font-size: 0.8rem;
        opacity: 0.6;
    }

    /* 浮动灵气粒子容器 */
    .spirit-particles {
        position: fixed;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: 0;
    }
    
    .spirit-particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: radial-gradient(circle, rgba(184, 149, 106, 0.6) 0%, transparent 70%);
        border-radius: 50%;
        animation: floatUp 18s linear infinite;
    }
    
    @keyframes floatUp {
        0% {
            transform: translateY(100vh) translateX(0) scale(0);
            opacity: 0;
        }
        10% {
            transform: translateY(90vh) translateX(10px) scale(1);
            opacity: 0.7;
        }
        90% {
            transform: translateY(10vh) translateX(-10px) scale(1);
            opacity: 0.7;
        }
        100% {
            transform: translateY(0) translateX(0) scale(0);
            opacity: 0;
        }
    }

    /* 仙侠头像框 */
    .avatar-frame {
        position: relative;
        padding: 4px;
        background: linear-gradient(135deg, rgba(180, 149, 106, 0.3) 0%, rgba(140, 110, 70, 0.2) 100%);
        border-radius: 50%;
    }
    
    .avatar-frame::before {
        content: '';
        position: absolute;
        inset: -2px;
        border: 1px solid rgba(180, 149, 106, 0.2);
        border-radius: 50%;
    }
    
    .avatar-frame::after {
        content: '';
        position: absolute;
        inset: -6px;
        border: 1px dashed rgba(180, 149, 106, 0.1);
        border-radius: 50%;
        animation: baguaSpin 30s linear infinite;
    }

    /* 神品/仙品光效 */
    .divine-glow {
        position: relative;
    }
    
    .divine-glow::before {
        content: '';
        position: absolute;
        inset: -3px;
        background: conic-gradient(from 0deg,
            rgba(184, 149, 106, 0.3),
            rgba(212, 181, 150, 0.4),
            rgba(184, 149, 106, 0.3),
            rgba(140, 110, 70, 0.3),
            rgba(184, 149, 106, 0.3));
        border-radius: inherit;
        animation: divineRotate 6s linear infinite;
        z-index: -1;
    }
    
    @keyframes divineRotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* 状态标签样式 */
    .status-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.15rem 0.5rem;
        background: rgba(30, 30, 30, 0.9);
        border: 1px solid rgba(180, 149, 106, 0.3);
        font-size: 0.75rem;
        color: var(--gold-light);
    }
    
    .status-tag-positive {
        border-color: rgba(150, 200, 150, 0.4);
        color: rgba(180, 220, 180, 0.9);
    }
    
    .status-tag-negative {
        border-color: rgba(166, 61, 61, 0.4);
        color: rgba(200, 100, 100, 0.9);
    }

    /* 提示气泡 */
    .tooltip-xianxia {
        position: relative;
    }
    
    .tooltip-xianxia::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.5rem 0.75rem;
        background: linear-gradient(135deg, rgba(30, 30, 30, 0.98) 0%, rgba(20, 20, 20, 0.99) 100%);
        border: 1px solid rgba(180, 149, 106, 0.4);
        color: var(--gold-light);
        font-size: 0.8rem;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
        z-index: 100;
    }
    
    .tooltip-xianxia:hover::after {
        opacity: 1;
        transform: translateX(-50%) translateY(-5px);
    }

    /* 动态数值变化 */
    .value-change-positive {
        color: rgba(150, 220, 150, 0.95);
        animation: valueUp 0.5s ease-out;
    }
    
    .value-change-negative {
        color: rgba(220, 100, 100, 0.95);
        animation: valueDown 0.5s ease-out;
    }
    
    @keyframes valueUp {
        0% { transform: translateY(0); opacity: 0; }
        50% { transform: translateY(-10px); opacity: 1; }
        100% { transform: translateY(-20px); opacity: 0; }
    }
    
    @keyframes valueDown {
        0% { transform: translateY(0); opacity: 0; }
        50% { transform: translateY(10px); opacity: 1; }
        100% { transform: translateY(20px); opacity: 0; }
    }
</style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.28.0"
  }
}
</script>
  <script type="module" crossorigin>!function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n,s,r={exports:{}},a={};var l,i,o=(s||(s=1,r.exports=function(){if(n)return a;n=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(t,n,s){var r=null;if(void 0!==s&&(r=""+s),void 0!==n.key&&(r=""+n.key),"key"in n)for(var a in s={},n)"key"!==a&&(s[a]=n[a]);else s=n;return n=s.ref,{$$typeof:e,type:t,key:r,ref:void 0!==n?n:null,props:s}}return a.Fragment=t,a.jsx=s,a.jsxs=s,a}()),r.exports),c={exports:{}},d={};function u(){if(l)return d;l=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),i=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.for("react.activity"),p=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}function y(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||h}b.prototype.isReactComponent={},b.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},b.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=b.prototype;var j=v.prototype=new y;j.constructor=v,f(j,b.prototype),j.isPureReactComponent=!0;var N=Array.isArray;function w(){}var k={H:null,A:null,T:null,S:null},C=Object.prototype.hasOwnProperty;function S(t,n,s){var r=s.ref;return{$$typeof:e,type:t,key:n,ref:void 0!==r?r:null,props:s}}function E(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var P=/\/+/g;function $(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function _(n,s,r,a,l){var i=typeof n;"undefined"!==i&&"boolean"!==i||(n=null);var o,c,d=!1;if(null===n)d=!0;else switch(i){case"bigint":case"string":case"number":d=!0;break;case"object":switch(n.$$typeof){case e:case t:d=!0;break;case m:return _((d=n._init)(n._payload),s,r,a,l)}}if(d)return l=l(n),d=""===a?"."+$(n,0):a,N(l)?(r="",null!=d&&(r=d.replace(P,"$&/")+"/"),_(l,s,r,"",function(e){return e})):null!=l&&(E(l)&&(o=l,c=r+(null==l.key||n&&n.key===l.key?"":(""+l.key).replace(P,"$&/")+"/")+d,l=S(o.type,c,o.props)),s.push(l)),1;d=0;var u,x=""===a?".":a+":";if(N(n))for(var h=0;h<n.length;h++)d+=_(a=n[h],s,r,i=x+$(a,h),l);else if("function"==typeof(h=null===(u=n)||"object"!=typeof u?null:"function"==typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(n=h.call(n),h=0;!(a=n.next()).done;)d+=_(a=a.value,s,r,i=x+$(a,h++),l);else if("object"===i){if("function"==typeof n.then)return _(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(w,w):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(n),s,r,a,l);throw s=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===s?"object with keys {"+Object.keys(n).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.")}return d}function D(e,t,n){if(null==e)return e;var s=[],r=0;return _(e,s,"","",function(e){return t.call(n,e,r++)}),s}function L(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},A={map:D,forEach:function(e,t,n){D(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return D(e,function(){t++}),t},toArray:function(e){return D(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return d.Activity=x,d.Children=A,d.Component=b,d.Fragment=n,d.Profiler=r,d.PureComponent=v,d.StrictMode=s,d.Suspense=c,d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,d.__COMPILER_RUNTIME={__proto__:null,c:function(e){return k.H.useMemoCache(e)}},d.cache=function(e){return function(){return e.apply(null,arguments)}},d.cacheSignal=function(){return null},d.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var s=f({},e.props),r=e.key;if(null!=t)for(a in void 0!==t.key&&(r=""+t.key),t)!C.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(s[a]=t[a]);var a=arguments.length-2;if(1===a)s.children=n;else if(1<a){for(var l=Array(a),i=0;i<a;i++)l[i]=arguments[i+2];s.children=l}return S(e.type,r,s)},d.createContext=function(e){return(e={$$typeof:i,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},d.createElement=function(e,t,n){var s,r={},a=null;if(null!=t)for(s in void 0!==t.key&&(a=""+t.key),t)C.call(t,s)&&"key"!==s&&"__self"!==s&&"__source"!==s&&(r[s]=t[s]);var l=arguments.length-2;if(1===l)r.children=n;else if(1<l){for(var i=Array(l),o=0;o<l;o++)i[o]=arguments[o+2];r.children=i}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===r[s]&&(r[s]=l[s]);return S(e,a,r)},d.createRef=function(){return{current:null}},d.forwardRef=function(e){return{$$typeof:o,render:e}},d.isValidElement=E,d.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:L}},d.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},d.startTransition=function(e){var t=k.T,n={};k.T=n;try{var s=e(),r=k.S;null!==r&&r(n,s),"object"==typeof s&&null!==s&&"function"==typeof s.then&&s.then(w,M)}catch(a){M(a)}finally{null!==t&&null!==n.types&&(t.types=n.types),k.T=t}},d.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},d.use=function(e){return k.H.use(e)},d.useActionState=function(e,t,n){return k.H.useActionState(e,t,n)},d.useCallback=function(e,t){return k.H.useCallback(e,t)},d.useContext=function(e){return k.H.useContext(e)},d.useDebugValue=function(){},d.useDeferredValue=function(e,t){return k.H.useDeferredValue(e,t)},d.useEffect=function(e,t){return k.H.useEffect(e,t)},d.useEffectEvent=function(e){return k.H.useEffectEvent(e)},d.useId=function(){return k.H.useId()},d.useImperativeHandle=function(e,t,n){return k.H.useImperativeHandle(e,t,n)},d.useInsertionEffect=function(e,t){return k.H.useInsertionEffect(e,t)},d.useLayoutEffect=function(e,t){return k.H.useLayoutEffect(e,t)},d.useMemo=function(e,t){return k.H.useMemo(e,t)},d.useOptimistic=function(e,t){return k.H.useOptimistic(e,t)},d.useReducer=function(e,t,n){return k.H.useReducer(e,t,n)},d.useRef=function(e){return k.H.useRef(e)},d.useState=function(e){return k.H.useState(e)},d.useSyncExternalStore=function(e,t,n){return k.H.useSyncExternalStore(e,t,n)},d.useTransition=function(){return k.H.useTransition()},d.version="19.2.0",d}function m(){return i||(i=1,c.exports=u()),c.exports}var x=m();const p=t(x);var h,f,g={exports:{}},b={},y={exports:{}},v={};function j(){return f||(f=1,y.exports=(h||(h=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,a=e[s];if(!(0<r(a,t)))break e;e[s]=t,e[n]=a,n=s}}function n(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,a=e.length,l=a>>>1;s<l;){var i=2*(s+1)-1,o=e[i],c=i+1,d=e[c];if(0>r(o,n))c<a&&0>r(d,o)?(e[s]=d,e[c]=n,s=c):(e[s]=o,e[i]=n,s=i);else{if(!(c<a&&0>r(d,n)))break e;e[s]=d,e[c]=n,s=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,i=l.now();e.unstable_now=function(){return l.now()-i}}var o=[],c=[],d=1,u=null,m=3,x=!1,p=!1,h=!1,f=!1,g="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function v(e){for(var r=n(c);null!==r;){if(null===r.callback)s(c);else{if(!(r.startTime<=e))break;s(c),r.sortIndex=r.expirationTime,t(o,r)}r=n(c)}}function j(e){if(h=!1,v(e),!p)if(null!==n(o))p=!0,w||(w=!0,N());else{var t=n(c);null!==t&&D(j,t.startTime-e)}}var N,w=!1,k=-1,C=5,S=-1;function E(){return!(!f&&e.unstable_now()-S<C)}function P(){if(f=!1,w){var t=e.unstable_now();S=t;var r=!0;try{e:{p=!1,h&&(h=!1,b(k),k=-1),x=!0;var a=m;try{t:{for(v(t),u=n(o);null!==u&&!(u.expirationTime>t&&E());){var l=u.callback;if("function"==typeof l){u.callback=null,m=u.priorityLevel;var i=l(u.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof i){u.callback=i,v(t),r=!0;break t}u===n(o)&&s(o),v(t)}else s(o);u=n(o)}if(null!==u)r=!0;else{var d=n(c);null!==d&&D(j,d.startTime-t),r=!1}}break e}finally{u=null,m=a,x=!1}r=void 0}}finally{r?N():w=!1}}}if("function"==typeof y)N=function(){y(P)};else if("undefined"!=typeof MessageChannel){var $=new MessageChannel,_=$.port2;$.port1.onmessage=P,N=function(){_.postMessage(null)}}else N=function(){g(P,0)};function D(t,n){k=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},e.unstable_requestPaint=function(){f=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},e.unstable_scheduleCallback=function(s,r,a){var l=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?l+a:l,s){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return s={id:d++,callback:r,priorityLevel:s,startTime:a,expirationTime:i=a+i,sortIndex:-1},a>l?(s.sortIndex=a,t(c,s),null===n(o)&&s===n(c)&&(h?(b(k),k=-1):h=!0,D(j,a-l))):(s.sortIndex=i,t(o,s),p||x||(p=!0,w||(w=!0,N()))),s},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}}(v)),v)),y.exports}var N,w,k,C,S={exports:{}},E={};function P(){if(N)return E;N=1;var e=m();function t(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var s={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");var a=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}return E.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,E.createPortal=function(e,n){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!n||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(t(299));return function(e,t,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:r,key:null==s?null:""+s,children:e,containerInfo:t,implementation:n}}(e,n,null,s)},E.flushSync=function(e){var t=a.T,n=s.p;try{if(a.T=null,s.p=2,e)return e()}finally{a.T=t,s.p=n,s.d.f()}},E.preconnect=function(e,t){"string"==typeof e&&(t?t="string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},E.prefetchDNS=function(e){"string"==typeof e&&s.d.D(e)},E.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=l(n,t.crossOrigin),a="string"==typeof t.integrity?t.integrity:void 0,i="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:i}):"script"===n&&s.d.X(e,{crossOrigin:r,integrity:a,fetchPriority:i,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},E.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},E.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=l(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},E.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=l(t.as,t.crossOrigin);s.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},E.requestFormReset=function(e){s.d.r(e)},E.unstable_batchedUpdates=function(e,t){return e(t)},E.useFormState=function(e,t,n){return a.H.useFormState(e,t,n)},E.useFormStatus=function(){return a.H.useHostTransitionStatus()},E.version="19.2.0",E}function $(){if(w)return S.exports;return w=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),S.exports=P(),S.exports}function _(){if(k)return b;k=1;var e=j(),t=m(),n=$();function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function a(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function i(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function o(e){if(a(e)!==e)throw Error(s(188))}function c(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=c(e)))return t;e=e.sibling}return null}var d=Object.assign,u=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),v=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),_=Symbol.for("react.memo_cache_sentinel"),D=Symbol.iterator;function L(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=D&&e[D]||e["@@iterator"])?e:null}var M=Symbol.for("react.client.reference");function A(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===M?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case h:return"Fragment";case g:return"Profiler";case f:return"StrictMode";case w:return"Suspense";case C:return"SuspenseList";case P:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case p:return"Portal";case v:return e.displayName||"Context";case y:return(e._context.displayName||"Context")+".Consumer";case N:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case S:return null!==(t=e.displayName||null)?t:A(e.type)||"Memo";case E:t=e._payload,e=e._init;try{return A(e(t))}catch(n){}}return null}var T=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z={pending:!1,data:null,method:null,action:null},R=[],F=-1;function q(e){return{current:e}}function B(e){0>F||(e.current=R[F],R[F]=null,F--)}function H(e,t){F++,R[F]=e.current,e.current=t}var U,V,W=q(null),Q=q(null),G=q(null),J=q(null);function K(e,t){switch(H(G,t),H(Q,e),H(W,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?yu(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=vu(t=yu(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(W),H(W,e)}function Y(){B(W),B(Q),B(G)}function X(e){null!==e.memoizedState&&H(J,e);var t=W.current,n=vu(t,e.type);t!==n&&(H(Q,e),H(W,n))}function Z(e){Q.current===e&&(B(W),B(Q)),J.current===e&&(B(J),mm._currentValue=z)}function ee(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||"",V=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+U+e+V}var te=!1;function ne(e,t){if(!e||te)return"";te=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(r){var s=r}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){s=a}e.call(n.prototype)}}else{try{throw Error()}catch(l){s=l}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(i){if(i&&s&&"string"==typeof i.stack)return[i.stack,s.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=s.DetermineComponentFrameRoot(),l=a[0],i=a[1];if(l&&i){var o=l.split("\n"),c=i.split("\n");for(r=s=0;s<o.length&&!o[s].includes("DetermineComponentFrameRoot");)s++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(s===o.length||r===c.length)for(s=o.length-1,r=c.length-1;1<=s&&0<=r&&o[s]!==c[r];)r--;for(;1<=s&&0<=r;s--,r--)if(o[s]!==c[r]){if(1!==s||1!==r)do{if(s--,0>--r||o[s]!==c[r]){var d="\n"+o[s].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=s&&0<=r);break}}}finally{te=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?ee(n):""}function se(e,t){switch(e.tag){case 26:case 27:case 5:return ee(e.type);case 16:return ee("Lazy");case 13:return e.child!==t&&null!==t?ee("Suspense Fallback"):ee("Suspense");case 19:return ee("SuspenseList");case 0:case 15:return ne(e.type,!1);case 11:return ne(e.type.render,!1);case 1:return ne(e.type,!0);case 31:return ee("Activity");default:return""}}function re(e){try{var t="",n=null;do{t+=se(e,n),n=e,e=e.return}while(e);return t}catch(s){return"\nError generating stack: "+s.message+"\n"+s.stack}}var ae=Object.prototype.hasOwnProperty,le=e.unstable_scheduleCallback,ie=e.unstable_cancelCallback,oe=e.unstable_shouldYield,ce=e.unstable_requestPaint,de=e.unstable_now,ue=e.unstable_getCurrentPriorityLevel,me=e.unstable_ImmediatePriority,xe=e.unstable_UserBlockingPriority,pe=e.unstable_NormalPriority,he=e.unstable_LowPriority,fe=e.unstable_IdlePriority,ge=e.log,be=e.unstable_setDisableYieldValue,ye=null,ve=null;function je(e){if("function"==typeof ge&&be(e),ve&&"function"==typeof ve.setStrictMode)try{ve.setStrictMode(ye,e)}catch(t){}}var Ne=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(we(e)/ke|0)|0},we=Math.log,ke=Math.LN2;var Ce=256,Se=262144,Ee=4194304;function Pe(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function $e(e,t,n){var s=e.pendingLanes;if(0===s)return 0;var r=0,a=e.suspendedLanes,l=e.pingedLanes;e=e.warmLanes;var i=134217727&s;return 0!==i?0!==(s=i&~a)?r=Pe(s):0!==(l&=i)?r=Pe(l):n||0!==(n=i&~e)&&(r=Pe(n)):0!==(i=s&~a)?r=Pe(i):0!==l?r=Pe(l):n||0!==(n=s&~e)&&(r=Pe(n)),0===r?0:0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(n=t&-t)||32===a&&4194048&n)?t:r}function _e(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function De(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Le(){var e=Ee;return!(62914560&(Ee<<=1))&&(Ee=4194304),e}function Me(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ae(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Te(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-Ne(t);e.entangledLanes|=t,e.entanglements[s]=1073741824|e.entanglements[s]|261930&n}function Ie(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Ne(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}function Oe(e,t){var n=t&-t;return 0!==((n=42&n?1:ze(n))&(e.suspendedLanes|t))?0:n}function ze(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Re(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Fe(){var e=O.p;return 0!==e?e:void 0===(e=window.event)?32:Pm(e.type)}function qe(e,t){var n=O.p;try{return O.p=e,t()}finally{O.p=n}}var Be=Math.random().toString(36).slice(2),He="__reactFiber$"+Be,Ue="__reactProps$"+Be,Ve="__reactContainer$"+Be,We="__reactEvents$"+Be,Qe="__reactListeners$"+Be,Ge="__reactHandles$"+Be,Je="__reactResources$"+Be,Ke="__reactMarker$"+Be;function Ye(e){delete e[He],delete e[Ue],delete e[We],delete e[Qe],delete e[Ge]}function Xe(e){var t=e[He];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Ve]||n[He]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=zu(e);null!==e;){if(n=e[He])return n;e=zu(e)}return t}n=(e=n).parentNode}return null}function Ze(e){if(e=e[He]||e[Ve]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function et(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function tt(e){var t=e[Je];return t||(t=e[Je]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function nt(e){e[Ke]=!0}var st=new Set,rt={};function at(e,t){lt(e,t),lt(e+"Capture",t)}function lt(e,t){for(rt[e]=t,e=0;e<t.length;e++)st.add(t[e])}var it=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ot={},ct={};function dt(e,t,n){if(r=t,ae.call(ct,r)||!ae.call(ot,r)&&(it.test(r)?ct[r]=!0:(ot[r]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var s=t.toLowerCase().slice(0,5);if("data-"!==s&&"aria-"!==s)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var r}function ut(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function mt(e,t,n,s){if(null===s)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+s)}}function xt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function pt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){if(!e._valueTracker){var t=pt(e)?"checked":"value";e._valueTracker=function(e,t,n){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==s&&"function"==typeof s.get&&"function"==typeof s.set){var r=s.get,a=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ft(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=pt(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function gt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var bt=/[\n"\\]/g;function yt(e){return e.replace(bt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function vt(e,t,n,s,r,a,l,i){e.name="",null!=l&&"function"!=typeof l&&"symbol"!=typeof l&&"boolean"!=typeof l?e.type=l:e.removeAttribute("type"),null!=t?"number"===l?(0===t&&""===e.value||e.value!=t)&&(e.value=""+xt(t)):e.value!==""+xt(t)&&(e.value=""+xt(t)):"submit"!==l&&"reset"!==l||e.removeAttribute("value"),null!=t?Nt(e,l,xt(t)):null!=n?Nt(e,l,xt(n)):null!=s&&e.removeAttribute("value"),null==r&&null!=a&&(e.defaultChecked=!!a),null!=r&&(e.checked=r&&"function"!=typeof r&&"symbol"!=typeof r),null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?e.name=""+xt(i):e.removeAttribute("name")}function jt(e,t,n,s,r,a,l,i){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=n){if(("submit"===a||"reset"===a)&&null==t)return void ht(e);n=null!=n?""+xt(n):"",t=null!=t?""+xt(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}s="function"!=typeof(s=null!=s?s:r)&&"symbol"!=typeof s&&!!s,e.checked=i?e.checked:!!s,e.defaultChecked=!!s,null!=l&&"function"!=typeof l&&"symbol"!=typeof l&&"boolean"!=typeof l&&(e.name=l),ht(e)}function Nt(e,t,n){"number"===t&&gt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function wt(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+xt(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(s&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function kt(e,t,n){null==t||((t=""+xt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+xt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function Ct(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(s(92));if(T(r)){if(1<r.length)throw Error(s(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=xt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),ht(e)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Et=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pt(e,t,n){var s=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?s?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":s?e.setProperty(t,n):"number"!=typeof n||0===n||Et.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function $t(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var a in t)r=t[a],t.hasOwnProperty(a)&&n[a]!==r&&Pt(e,a,r)}else for(var l in t)t.hasOwnProperty(l)&&Pt(e,l,t[l])}function _t(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Lt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mt(e){return Lt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function At(){}var Tt=null;function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ot=null,zt=null;function Rt(e){var t=Ze(e);if(t&&(e=t.stateNode)){var n=e[Ue]||null;e:switch(e=t.stateNode,t.type){case"input":if(vt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=r[Ue]||null;if(!a)throw Error(s(90));vt(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ft(r)}break e;case"textarea":kt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&wt(e,!!n.multiple,t,!1)}}}var Ft=!1;function qt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==Ot||null!==zt)&&(td(),Ot&&(t=Ot,e=zt,zt=Ot=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Bt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Ue]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(s(231,t,typeof n));return n}var Ht=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Ut=!1;if(Ht)try{var Vt={};Object.defineProperty(Vt,"passive",{get:function(){Ut=!0}}),window.addEventListener("test",Vt,Vt),window.removeEventListener("test",Vt,Vt)}catch(Zm){Ut=!1}var Wt=null,Qt=null,Gt=null;function Jt(){if(Gt)return Gt;var e,t,n=Qt,s=n.length,r="value"in Wt?Wt.value:Wt.textContent,a=r.length;for(e=0;e<s&&n[e]===r[e];e++);var l=s-e;for(t=1;t<=l&&n[s-t]===r[a-t];t++);return Gt=r.slice(e,1<t?1-t:void 0)}function Kt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Yt(){return!0}function Xt(){return!1}function Zt(e){function t(t,n,s,r,a){for(var l in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(l)&&(t=e[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?Yt:Xt,this.isPropagationStopped=Xt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Yt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Yt)},persist:function(){},isPersistent:Yt}),t}var en,tn,nn,sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rn=Zt(sn),an=d({},sn,{view:0,detail:0}),ln=Zt(an),on=d({},an,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==nn&&(nn&&"mousemove"===e.type?(en=e.screenX-nn.screenX,tn=e.screenY-nn.screenY):tn=en=0,nn=e),en)},movementY:function(e){return"movementY"in e?e.movementY:tn}}),cn=Zt(on),dn=Zt(d({},on,{dataTransfer:0})),un=Zt(d({},an,{relatedTarget:0})),mn=Zt(d({},sn,{animationName:0,elapsedTime:0,pseudoElement:0})),xn=Zt(d({},sn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),pn=Zt(d({},sn,{data:0})),hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=gn[e])&&!!t[e]}function yn(){return bn}var vn=Zt(d({},an,{key:function(e){if(e.key){var t=hn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Kt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?fn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yn,charCode:function(e){return"keypress"===e.type?Kt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Kt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),jn=Zt(d({},on,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=Zt(d({},an,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yn})),wn=Zt(d({},sn,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=Zt(d({},on,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Cn=Zt(d({},sn,{newState:0,oldState:0})),Sn=[9,13,27,32],En=Ht&&"CompositionEvent"in window,Pn=null;Ht&&"documentMode"in document&&(Pn=document.documentMode);var $n=Ht&&"TextEvent"in window&&!Pn,_n=Ht&&(!En||Pn&&8<Pn&&11>=Pn),Dn=String.fromCharCode(32),Ln=!1;function Mn(e,t){switch(e){case"keyup":return-1!==Sn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function An(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Tn=!1;var In={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function On(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!In[e.type]:"textarea"===t}function zn(e,t,n,s){Ot?zt?zt.push(s):zt=[s]:Ot=s,0<(t=au(t,"onChange")).length&&(n=new rn("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Rn=null,Fn=null;function qn(e){Yd(e,0)}function Bn(e){if(ft(et(e)))return e}function Hn(e,t){if("change"===e)return t}var Un=!1;if(Ht){var Vn;if(Ht){var Wn="oninput"in document;if(!Wn){var Qn=document.createElement("div");Qn.setAttribute("oninput","return;"),Wn="function"==typeof Qn.oninput}Vn=Wn}else Vn=!1;Un=Vn&&(!document.documentMode||9<document.documentMode)}function Gn(){Rn&&(Rn.detachEvent("onpropertychange",Jn),Fn=Rn=null)}function Jn(e){if("value"===e.propertyName&&Bn(Fn)){var t=[];zn(t,Fn,e,It(e)),qt(qn,t)}}function Kn(e,t,n){"focusin"===e?(Gn(),Fn=n,(Rn=t).attachEvent("onpropertychange",Jn)):"focusout"===e&&Gn()}function Yn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Bn(Fn)}function Xn(e,t){if("click"===e)return Bn(t)}function Zn(e,t){if("input"===e||"change"===e)return Bn(t)}var es="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ts(e,t){if(es(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!ae.call(t,r)||!es(e[r],t[r]))return!1}return!0}function ns(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ss(e,t){var n,s=ns(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=ns(s)}}function rs(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?rs(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function as(e){for(var t=gt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=gt((e=t.contentWindow).document)}return t}function ls(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var is=Ht&&"documentMode"in document&&11>=document.documentMode,os=null,cs=null,ds=null,us=!1;function ms(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;us||null==os||os!==gt(s)||("selectionStart"in(s=os)&&ls(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},ds&&ts(ds,s)||(ds=s,0<(s=au(cs,"onSelect")).length&&(t=new rn("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=os)))}function xs(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ps={animationend:xs("Animation","AnimationEnd"),animationiteration:xs("Animation","AnimationIteration"),animationstart:xs("Animation","AnimationStart"),transitionrun:xs("Transition","TransitionRun"),transitionstart:xs("Transition","TransitionStart"),transitioncancel:xs("Transition","TransitionCancel"),transitionend:xs("Transition","TransitionEnd")},hs={},fs={};function gs(e){if(hs[e])return hs[e];if(!ps[e])return e;var t,n=ps[e];for(t in n)if(n.hasOwnProperty(t)&&t in fs)return hs[e]=n[t];return e}Ht&&(fs=document.createElement("div").style,"AnimationEvent"in window||(delete ps.animationend.animation,delete ps.animationiteration.animation,delete ps.animationstart.animation),"TransitionEvent"in window||delete ps.transitionend.transition);var bs=gs("animationend"),ys=gs("animationiteration"),vs=gs("animationstart"),js=gs("transitionrun"),Ns=gs("transitionstart"),ws=gs("transitioncancel"),ks=gs("transitionend"),Cs=new Map,Ss="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Es(e,t){Cs.set(e,t),at(t,[e])}Ss.push("scrollEnd");var Ps="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},$s=[],_s=0,Ds=0;function Ls(){for(var e=_s,t=Ds=_s=0;t<e;){var n=$s[t];$s[t++]=null;var s=$s[t];$s[t++]=null;var r=$s[t];$s[t++]=null;var a=$s[t];if($s[t++]=null,null!==s&&null!==r){var l=s.pending;null===l?r.next=r:(r.next=l.next,l.next=r),s.pending=r}0!==a&&Is(n,r,a)}}function Ms(e,t,n,s){$s[_s++]=e,$s[_s++]=t,$s[_s++]=n,$s[_s++]=s,Ds|=s,e.lanes|=s,null!==(e=e.alternate)&&(e.lanes|=s)}function As(e,t,n,s){return Ms(e,t,n,s),Os(e)}function Ts(e,t){return Ms(e,null,null,t),Os(e)}function Is(e,t,n){e.lanes|=n;var s=e.alternate;null!==s&&(s.lanes|=n);for(var r=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(s=a.alternate)&&(s.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(r=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,r&&null!==t&&(r=31-Ne(n),null===(s=(e=a.hiddenUpdates)[r])?e[r]=[t]:s.push(t),t.lane=536870912|n),a):null}function Os(e){if(50<Wc)throw Wc=0,Qc=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var zs={};function Rs(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fs(e,t,n,s){return new Rs(e,t,n,s)}function qs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bs(e,t){var n=e.alternate;return null===n?((n=Fs(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Hs(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Us(e,t,n,r,a,l){var i=0;if(r=e,"function"==typeof e)qs(e)&&(i=1);else if("string"==typeof e)i=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,W.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case P:return(e=Fs(31,n,t,a)).elementType=P,e.lanes=l,e;case h:return Vs(n.children,a,l,t);case f:i=8,a|=24;break;case g:return(e=Fs(12,n,t,2|a)).elementType=g,e.lanes=l,e;case w:return(e=Fs(13,n,t,a)).elementType=w,e.lanes=l,e;case C:return(e=Fs(19,n,t,a)).elementType=C,e.lanes=l,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case v:i=10;break e;case y:i=9;break e;case N:i=11;break e;case S:i=14;break e;case E:i=16,r=null;break e}i=29,n=Error(s(130,null===e?"null":typeof e,"")),r=null}return(t=Fs(i,n,t,a)).elementType=e,t.type=r,t.lanes=l,t}function Vs(e,t,n,s){return(e=Fs(7,e,s,t)).lanes=n,e}function Ws(e,t,n){return(e=Fs(6,e,null,t)).lanes=n,e}function Qs(e){var t=Fs(18,null,null,0);return t.stateNode=e,t}function Gs(e,t,n){return(t=Fs(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Js=new WeakMap;function Ks(e,t){if("object"==typeof e&&null!==e){var n=Js.get(e);return void 0!==n?n:(t={value:e,source:t,stack:re(t)},Js.set(e,t),t)}return{value:e,source:t,stack:re(t)}}var Ys=[],Xs=0,Zs=null,er=0,tr=[],nr=0,sr=null,rr=1,ar="";function lr(e,t){Ys[Xs++]=er,Ys[Xs++]=Zs,Zs=e,er=t}function ir(e,t,n){tr[nr++]=rr,tr[nr++]=ar,tr[nr++]=sr,sr=e;var s=rr;e=ar;var r=32-Ne(s)-1;s&=~(1<<r),n+=1;var a=32-Ne(t)+r;if(30<a){var l=r-r%5;a=(s&(1<<l)-1).toString(32),s>>=l,r-=l,rr=1<<32-Ne(t)+r|n<<r|s,ar=a+e}else rr=1<<a|n<<r|s,ar=e}function or(e){null!==e.return&&(lr(e,1),ir(e,1,0))}function cr(e){for(;e===Zs;)Zs=Ys[--Xs],Ys[Xs]=null,er=Ys[--Xs],Ys[Xs]=null;for(;e===sr;)sr=tr[--nr],tr[nr]=null,ar=tr[--nr],tr[nr]=null,rr=tr[--nr],tr[nr]=null}function dr(e,t){tr[nr++]=rr,tr[nr++]=ar,tr[nr++]=sr,rr=t.id,ar=t.overflow,sr=e}var ur=null,mr=null,xr=!1,pr=null,hr=!1,fr=Error(s(519));function gr(e){throw wr(Ks(Error(s(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),fr}function br(e){var t=e.stateNode,n=e.type,s=e.memoizedProps;switch(t[He]=e,t[Ue]=s,n){case"dialog":Xd("cancel",t),Xd("close",t);break;case"iframe":case"object":case"embed":Xd("load",t);break;case"video":case"audio":for(n=0;n<Jd.length;n++)Xd(Jd[n],t);break;case"source":Xd("error",t);break;case"img":case"image":case"link":Xd("error",t),Xd("load",t);break;case"details":Xd("toggle",t);break;case"input":Xd("invalid",t),jt(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":Xd("invalid",t);break;case"textarea":Xd("invalid",t),Ct(t,s.value,s.defaultValue,s.children)}"string"!=typeof(n=s.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===s.suppressHydrationWarning||uu(t.textContent,n)?(null!=s.popover&&(Xd("beforetoggle",t),Xd("toggle",t)),null!=s.onScroll&&Xd("scroll",t),null!=s.onScrollEnd&&Xd("scrollend",t),null!=s.onClick&&(t.onclick=At),t=!0):t=!1,t||gr(e,!0)}function yr(e){for(ur=e.return;ur;)switch(ur.tag){case 5:case 31:case 13:return void(hr=!1);case 27:case 3:return void(hr=!0);default:ur=ur.return}}function vr(e){if(e!==ur)return!1;if(!xr)return yr(e),xr=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||ju(e.type,e.memoizedProps)),t=!t),t&&mr&&gr(e),yr(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));mr=Ou(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));mr=Ou(e)}else 27===n?(n=mr,Pu(e.type)?(e=Iu,Iu=null,mr=e):mr=n):mr=ur?Tu(e.stateNode.nextSibling):null;return!0}function jr(){mr=ur=null,xr=!1}function Nr(){var e=pr;return null!==e&&(null===Lc?Lc=e:Lc.push.apply(Lc,e),pr=null),e}function wr(e){null===pr?pr=[e]:pr.push(e)}var kr=q(null),Cr=null,Sr=null;function Er(e,t,n){H(kr,t._currentValue),t._currentValue=n}function Pr(e){e._currentValue=kr.current,B(kr)}function $r(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function _r(e,t,n,r){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var l=a.dependencies;if(null!==l){var i=a.child;l=l.firstContext;e:for(;null!==l;){var o=l;l=a;for(var c=0;c<t.length;c++)if(o.context===t[c]){l.lanes|=n,null!==(o=l.alternate)&&(o.lanes|=n),$r(l.return,n,e),r||(i=null);break e}l=o.next}}else if(18===a.tag){if(null===(i=a.return))throw Error(s(341));i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),$r(i,n,e),i=null}else i=a.child;if(null!==i)i.return=a;else for(i=a;null!==i;){if(i===e){i=null;break}if(null!==(a=i.sibling)){a.return=i.return,i=a;break}i=i.return}a=i}}function Dr(e,t,n,r){e=null;for(var a=t,l=!1;null!==a;){if(!l)if(524288&a.flags)l=!0;else if(262144&a.flags)break;if(10===a.tag){var i=a.alternate;if(null===i)throw Error(s(387));if(null!==(i=i.memoizedProps)){var o=a.type;es(a.pendingProps.value,i.value)||(null!==e?e.push(o):e=[o])}}else if(a===J.current){if(null===(i=a.alternate))throw Error(s(387));i.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(mm):e=[mm])}a=a.return}null!==e&&_r(t,e,n,r),t.flags|=262144}function Lr(e){for(e=e.firstContext;null!==e;){if(!es(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Mr(e){Cr=e,Sr=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ar(e){return Ir(Cr,e)}function Tr(e,t){return null===Cr&&Mr(e),Ir(e,t)}function Ir(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Sr){if(null===e)throw Error(s(308));Sr=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Sr=Sr.next=t;return n}var Or="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},zr=e.unstable_scheduleCallback,Rr=e.unstable_NormalPriority,Fr={$$typeof:v,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qr(){return{controller:new Or,data:new Map,refCount:0}}function Br(e){e.refCount--,0===e.refCount&&zr(Rr,function(){e.controller.abort()})}var Hr=null,Ur=0,Vr=0,Wr=null;function Qr(){if(0===--Ur&&null!==Hr){null!==Wr&&(Wr.status="fulfilled");var e=Hr;Hr=null,Vr=0,Wr=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Gr=I.S;I.S=function(e,t){Tc=de(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Hr){var n=Hr=[];Ur=0,Vr=Ud(),Wr={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ur++,t.then(Qr,Qr)}(0,t),null!==Gr&&Gr(e,t)};var Jr=q(null);function Kr(){var e=Jr.current;return null!==e?e:fc.pooledCache}function Yr(e,t){H(Jr,null===t?Jr.current:t.pool)}function Xr(){var e=Kr();return null===e?null:{parent:Fr._currentValue,pool:e}}var Zr=Error(s(460)),ea=Error(s(474)),ta=Error(s(542)),na={then:function(){}};function sa(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ra(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(At,At),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw oa(e=t.reason),e;default:if("string"==typeof t.status)t.then(At,At);else{if(null!==(e=fc)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw oa(e=t.reason),e}throw la=t,Zr}}function aa(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw la=t,Zr;throw t}}var la=null;function ia(){if(null===la)throw Error(s(459));var e=la;return la=null,e}function oa(e){if(e===Zr||e===ta)throw Error(s(483))}var ca=null,da=0;function ua(e){var t=da;return da+=1,null===ca&&(ca=[]),ra(ca,e,t)}function ma(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function xa(e,t){if(t.$$typeof===u)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pa(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=Bs(e,t)).index=0,e.sibling=null,e}function l(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=67108866,n):s:(t.flags|=67108866,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function o(e,t,n,s){return null===t||6!==t.tag?((t=Ws(n,e.mode,s)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,s){var r=n.type;return r===h?u(e,t,n.props.children,s,n.key):null!==t&&(t.elementType===r||"object"==typeof r&&null!==r&&r.$$typeof===E&&aa(r)===t.type)?(ma(t=a(t,n.props),n),t.return=e,t):(ma(t=Us(n.type,n.key,n.props,null,e.mode,s),n),t.return=e,t)}function d(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Gs(n,e.mode,s)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function u(e,t,n,s,r){return null===t||7!==t.tag?((t=Vs(n,e.mode,s,r)).return=e,t):((t=a(t,n)).return=e,t)}function m(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Ws(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case x:return ma(n=Us(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case p:return(t=Gs(t,e.mode,n)).return=e,t;case E:return m(e,t=aa(t),n)}if(T(t)||L(t))return(t=Vs(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return m(e,ua(t),n);if(t.$$typeof===v)return m(e,Tr(e,t),n);xa(e,t)}return null}function f(e,t,n,s){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==r?null:o(e,t,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===r?c(e,t,n,s):null;case p:return n.key===r?d(e,t,n,s):null;case E:return f(e,t,n=aa(n),s)}if(T(n)||L(n))return null!==r?null:u(e,t,n,s,null);if("function"==typeof n.then)return f(e,t,ua(n),s);if(n.$$typeof===v)return f(e,t,Tr(e,n),s);xa(e,n)}return null}function g(e,t,n,s,r){if("string"==typeof s&&""!==s||"number"==typeof s||"bigint"==typeof s)return o(t,e=e.get(n)||null,""+s,r);if("object"==typeof s&&null!==s){switch(s.$$typeof){case x:return c(t,e=e.get(null===s.key?n:s.key)||null,s,r);case p:return d(t,e=e.get(null===s.key?n:s.key)||null,s,r);case E:return g(e,t,n,s=aa(s),r)}if(T(s)||L(s))return u(t,e=e.get(n)||null,s,r,null);if("function"==typeof s.then)return g(e,t,n,ua(s),r);if(s.$$typeof===v)return g(e,t,n,Tr(t,s),r);xa(t,s)}return null}function b(o,c,d,u){if("object"==typeof d&&null!==d&&d.type===h&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case x:e:{for(var y=d.key;null!==c;){if(c.key===y){if((y=d.type)===h){if(7===c.tag){n(o,c.sibling),(u=a(c,d.props.children)).return=o,o=u;break e}}else if(c.elementType===y||"object"==typeof y&&null!==y&&y.$$typeof===E&&aa(y)===c.type){n(o,c.sibling),ma(u=a(c,d.props),d),u.return=o,o=u;break e}n(o,c);break}t(o,c),c=c.sibling}d.type===h?((u=Vs(d.props.children,o.mode,u,d.key)).return=o,o=u):(ma(u=Us(d.type,d.key,d.props,null,o.mode,u),d),u.return=o,o=u)}return i(o);case p:e:{for(y=d.key;null!==c;){if(c.key===y){if(4===c.tag&&c.stateNode.containerInfo===d.containerInfo&&c.stateNode.implementation===d.implementation){n(o,c.sibling),(u=a(c,d.children||[])).return=o,o=u;break e}n(o,c);break}t(o,c),c=c.sibling}(u=Gs(d,o.mode,u)).return=o,o=u}return i(o);case E:return b(o,c,d=aa(d),u)}if(T(d))return function(s,a,i,o){for(var c=null,d=null,u=a,x=a=0,p=null;null!==u&&x<i.length;x++){u.index>x?(p=u,u=null):p=u.sibling;var h=f(s,u,i[x],o);if(null===h){null===u&&(u=p);break}e&&u&&null===h.alternate&&t(s,u),a=l(h,a,x),null===d?c=h:d.sibling=h,d=h,u=p}if(x===i.length)return n(s,u),xr&&lr(s,x),c;if(null===u){for(;x<i.length;x++)null!==(u=m(s,i[x],o))&&(a=l(u,a,x),null===d?c=u:d.sibling=u,d=u);return xr&&lr(s,x),c}for(u=r(u);x<i.length;x++)null!==(p=g(u,s,x,i[x],o))&&(e&&null!==p.alternate&&u.delete(null===p.key?x:p.key),a=l(p,a,x),null===d?c=p:d.sibling=p,d=p);return e&&u.forEach(function(e){return t(s,e)}),xr&&lr(s,x),c}(o,c,d,u);if(L(d)){if("function"!=typeof(y=L(d)))throw Error(s(150));return function(a,i,o,c){if(null==o)throw Error(s(151));for(var d=null,u=null,x=i,p=i=0,h=null,b=o.next();null!==x&&!b.done;p++,b=o.next()){x.index>p?(h=x,x=null):h=x.sibling;var y=f(a,x,b.value,c);if(null===y){null===x&&(x=h);break}e&&x&&null===y.alternate&&t(a,x),i=l(y,i,p),null===u?d=y:u.sibling=y,u=y,x=h}if(b.done)return n(a,x),xr&&lr(a,p),d;if(null===x){for(;!b.done;p++,b=o.next())null!==(b=m(a,b.value,c))&&(i=l(b,i,p),null===u?d=b:u.sibling=b,u=b);return xr&&lr(a,p),d}for(x=r(x);!b.done;p++,b=o.next())null!==(b=g(x,a,p,b.value,c))&&(e&&null!==b.alternate&&x.delete(null===b.key?p:b.key),i=l(b,i,p),null===u?d=b:u.sibling=b,u=b);return e&&x.forEach(function(e){return t(a,e)}),xr&&lr(a,p),d}(o,c,d=y.call(d),u)}if("function"==typeof d.then)return b(o,c,ua(d),u);if(d.$$typeof===v)return b(o,c,Tr(o,d),u);xa(o,d)}return"string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d?(d=""+d,null!==c&&6===c.tag?(n(o,c.sibling),(u=a(c,d)).return=o,o=u):(n(o,c),(u=Ws(d,o.mode,u)).return=o,o=u),i(o)):n(o,c)}return function(e,t,n,s){try{da=0;var r=b(e,t,n,s);return ca=null,r}catch(l){if(l===Zr||l===ta)throw l;var a=Fs(29,l,null,e.mode);return a.lanes=s,a.return=e,a}}}var ha=pa(!0),fa=pa(!1),ga=!1;function ba(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ya(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function va(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ja(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,2&hc){var r=s.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),s.pending=t,t=Os(e),Is(e,null,n),t}return Ms(e,s,t,n),Os(e)}function Na(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,Ie(e,n)}}function wa(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var l={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?r=a=l:a=a.next=l,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:s.shared,callbacks:s.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var ka=!1;function Ca(){if(ka){if(null!==Wr)throw Wr}}function Sa(e,t,n,s){ka=!1;var r=e.updateQueue;ga=!1;var a=r.firstBaseUpdate,l=r.lastBaseUpdate,i=r.shared.pending;if(null!==i){r.shared.pending=null;var o=i,c=o.next;o.next=null,null===l?a=c:l.next=c,l=o;var u=e.alternate;null!==u&&((i=(u=u.updateQueue).lastBaseUpdate)!==l&&(null===i?u.firstBaseUpdate=c:i.next=c,u.lastBaseUpdate=o))}if(null!==a){var m=r.baseState;for(l=0,u=c=o=null,i=a;;){var x=-536870913&i.lane,p=x!==i.lane;if(p?(bc&x)===x:(s&x)===x){0!==x&&x===Vr&&(ka=!0),null!==u&&(u=u.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{var h=e,f=i;x=t;var g=n;switch(f.tag){case 1:if("function"==typeof(h=f.payload)){m=h.call(g,m,x);break e}m=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null==(x="function"==typeof(h=f.payload)?h.call(g,m,x):h))break e;m=d({},m,x);break e;case 2:ga=!0}}null!==(x=i.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=r.callbacks)?r.callbacks=[x]:p.push(x))}else p={lane:x,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===u?(c=u=p,o=m):u=u.next=p,l|=x;if(null===(i=i.next)){if(null===(i=r.shared.pending))break;i=(p=i).next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}null===u&&(o=m),r.baseState=o,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null===a&&(r.shared.lanes=0),Sc|=l,e.lanes=l,e.memoizedState=m}}function Ea(e,t){if("function"!=typeof e)throw Error(s(191,e));e.call(t)}function Pa(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ea(n[e],t)}var $a=q(null),_a=q(0);function Da(e,t){H(_a,e=kc),H($a,t),kc=e|t.baseLanes}function La(){H(_a,kc),H($a,$a.current)}function Ma(){kc=_a.current,B($a),B(_a)}var Aa=q(null),Ta=null;function Ia(e){var t=e.alternate;H(qa,1&qa.current),H(Aa,e),null===Ta&&(null===t||null!==$a.current||null!==t.memoizedState)&&(Ta=e)}function Oa(e){H(qa,qa.current),H(Aa,e),null===Ta&&(Ta=e)}function za(e){22===e.tag?(H(qa,qa.current),H(Aa,e),null===Ta&&(Ta=e)):Ra()}function Ra(){H(qa,qa.current),H(Aa,Aa.current)}function Fa(e){B(Aa),Ta===e&&(Ta=null),B(qa)}var qa=q(0);function Ba(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Mu(n)||Au(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ha=0,Ua=null,Va=null,Wa=null,Qa=!1,Ga=!1,Ja=!1,Ka=0,Ya=0,Xa=null,Za=0;function el(){throw Error(s(321))}function tl(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!es(e[n],t[n]))return!1;return!0}function nl(e,t,n,s,r,a){return Ha=a,Ua=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,I.H=null===e||null===e.memoizedState?gi:bi,Ja=!1,a=n(s,r),Ja=!1,Ga&&(a=rl(t,n,s,r)),sl(e),a}function sl(e){I.H=fi;var t=null!==Va&&null!==Va.next;if(Ha=0,Wa=Va=Ua=null,Qa=!1,Ya=0,Xa=null,t)throw Error(s(300));null===e||Ai||null!==(e=e.dependencies)&&Lr(e)&&(Ai=!0)}function rl(e,t,n,r){Ua=e;var a=0;do{if(Ga&&(Xa=null),Ya=0,Ga=!1,25<=a)throw Error(s(301));if(a+=1,Wa=Va=null,null!=e.updateQueue){var l=e.updateQueue;l.lastEffect=null,l.events=null,l.stores=null,null!=l.memoCache&&(l.memoCache.index=0)}I.H=yi,l=t(n,r)}while(Ga);return l}function al(){var e=I.H,t=e.useState()[0];return t="function"==typeof t.then?ul(t):t,e=e.useState()[0],(null!==Va?Va.memoizedState:null)!==e&&(Ua.flags|=1024),t}function ll(){var e=0!==Ka;return Ka=0,e}function il(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function ol(e){if(Qa){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Qa=!1}Ha=0,Wa=Va=Ua=null,Ga=!1,Ya=Ka=0,Xa=null}function cl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Wa?Ua.memoizedState=Wa=e:Wa=Wa.next=e,Wa}function dl(){if(null===Va){var e=Ua.alternate;e=null!==e?e.memoizedState:null}else e=Va.next;var t=null===Wa?Ua.memoizedState:Wa.next;if(null!==t)Wa=t,Va=e;else{if(null===e){if(null===Ua.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(Va=e).memoizedState,baseState:Va.baseState,baseQueue:Va.baseQueue,queue:Va.queue,next:null},null===Wa?Ua.memoizedState=Wa=e:Wa=Wa.next=e}return Wa}function ul(e){var t=Ya;return Ya+=1,null===Xa&&(Xa=[]),e=ra(Xa,e,t),t=Ua,null===(null===Wa?t.memoizedState:Wa.next)&&(t=t.alternate,I.H=null===t||null===t.memoizedState?gi:bi),e}function ml(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return ul(e);if(e.$$typeof===v)return Ar(e)}throw Error(s(438,String(e)))}function xl(e){var t=null,n=Ua.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var s=Ua.alternate;null!==s&&(null!==(s=s.updateQueue)&&(null!=(s=s.memoCache)&&(t={data:s.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Ua.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),s=0;s<e;s++)n[s]=_;return t.index++,n}function pl(e,t){return"function"==typeof t?t(e):t}function hl(e){return fl(dl(),Va,e)}function fl(e,t,n){var r=e.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=n;var a=e.baseQueue,l=r.pending;if(null!==l){if(null!==a){var i=a.next;a.next=l.next,l.next=i}t.baseQueue=a=l,r.pending=null}if(l=e.baseState,null===a)e.memoizedState=l;else{var o=i=null,c=null,d=t=a.next,u=!1;do{var m=-536870913&d.lane;if(m!==d.lane?(bc&m)===m:(Ha&m)===m){var x=d.revertLane;if(0===x)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),m===Vr&&(u=!0);else{if((Ha&x)===x){d=d.next,x===Vr&&(u=!0);continue}m={lane:0,revertLane:d.revertLane,gesture:null,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(o=c=m,i=l):c=c.next=m,Ua.lanes|=x,Sc|=x}m=d.action,Ja&&n(l,m),l=d.hasEagerState?d.eagerState:n(l,m)}else x={lane:m,revertLane:d.revertLane,gesture:d.gesture,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(o=c=x,i=l):c=c.next=x,Ua.lanes|=m,Sc|=m;d=d.next}while(null!==d&&d!==t);if(null===c?i=l:c.next=o,!es(l,e.memoizedState)&&(Ai=!0,u&&null!==(n=Wr)))throw n;e.memoizedState=l,e.baseState=i,e.baseQueue=c,r.lastRenderedState=l}return null===a&&(r.lanes=0),[e.memoizedState,r.dispatch]}function gl(e){var t=dl(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,l=t.memoizedState;if(null!==a){n.pending=null;var i=a=a.next;do{l=e(l,i.action),i=i.next}while(i!==a);es(l,t.memoizedState)||(Ai=!0),t.memoizedState=l,null===t.baseQueue&&(t.baseState=l),n.lastRenderedState=l}return[l,r]}function bl(e,t,n){var r=Ua,a=dl(),l=xr;if(l){if(void 0===n)throw Error(s(407));n=n()}else n=t();var i=!es((Va||a).memoizedState,n);if(i&&(a.memoizedState=n,Ai=!0),a=a.queue,Hl(jl.bind(null,r,a,e),[e]),a.getSnapshot!==t||i||null!==Wa&&1&Wa.memoizedState.tag){if(r.flags|=2048,zl(9,{destroy:void 0},vl.bind(null,r,a,n,t),null),null===fc)throw Error(s(349));l||127&Ha||yl(r,t,n)}return n}function yl(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Ua.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Ua.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function vl(e,t,n,s){t.value=n,t.getSnapshot=s,Nl(t)&&wl(e)}function jl(e,t,n){return n(function(){Nl(t)&&wl(e)})}function Nl(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!es(e,n)}catch(s){return!0}}function wl(e){var t=Ts(e,2);null!==t&&Kc(t,e,2)}function kl(e){var t=cl();if("function"==typeof e){var n=e;if(e=n(),Ja){je(!0);try{n()}finally{je(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pl,lastRenderedState:e},t}function Cl(e,t,n,s){return e.baseState=n,fl(e,Va,"function"==typeof s?s:pl)}function Sl(e,t,n,r,a){if(xi(e))throw Error(s(485));if(null!==(e=t.action)){var l={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){l.listeners.push(e)}};null!==I.T?n(!0):l.isTransition=!1,r(l),null===(n=t.pending)?(l.next=t.pending=l,El(t,l)):(l.next=n.next,t.pending=n.next=l)}}function El(e,t){var n=t.action,s=t.payload,r=e.state;if(t.isTransition){var a=I.T,l={};I.T=l;try{var i=n(r,s),o=I.S;null!==o&&o(l,i),Pl(e,t,i)}catch(c){_l(e,t,c)}finally{null!==a&&null!==l.types&&(a.types=l.types),I.T=a}}else try{Pl(e,t,a=n(r,s))}catch(d){_l(e,t,d)}}function Pl(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){$l(e,t,n)},function(n){return _l(e,t,n)}):$l(e,t,n)}function $l(e,t,n){t.status="fulfilled",t.value=n,Dl(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,El(e,n)))}function _l(e,t,n){var s=e.pending;if(e.pending=null,null!==s){s=s.next;do{t.status="rejected",t.reason=n,Dl(t),t=t.next}while(t!==s)}e.action=null}function Dl(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ll(e,t){return t}function Ml(e,t){if(xr){var n=fc.formState;if(null!==n){e:{var s=Ua;if(xr){if(mr){t:{for(var r=mr,a=hr;8!==r.nodeType;){if(!a){r=null;break t}if(null===(r=Tu(r.nextSibling))){r=null;break t}}r="F!"===(a=r.data)||"F"===a?r:null}if(r){mr=Tu(r.nextSibling),s="F!"===r.data;break e}}gr(s)}s=!1}s&&(t=n[0])}}return(n=cl()).memoizedState=n.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ll,lastRenderedState:t},n.queue=s,n=di.bind(null,Ua,s),s.dispatch=n,s=kl(!1),a=mi.bind(null,Ua,!1,s.queue),r={state:t,dispatch:null,action:e,pending:null},(s=cl()).queue=r,n=Sl.bind(null,Ua,r,a,n),r.dispatch=n,s.memoizedState=e,[t,n,!1]}function Al(e){return Tl(dl(),Va,e)}function Tl(e,t,n){if(t=fl(e,t,Ll)[0],e=hl(pl)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var s=ul(t)}catch(l){if(l===Zr)throw ta;throw l}else s=t;var r=(t=dl()).queue,a=r.dispatch;return n!==t.memoizedState&&(Ua.flags|=2048,zl(9,{destroy:void 0},Il.bind(null,r,n),null)),[s,a,e]}function Il(e,t){e.action=t}function Ol(e){var t=dl(),n=Va;if(null!==n)return Tl(t,n,e);dl(),t=t.memoizedState;var s=(n=dl()).queue.dispatch;return n.memoizedState=e,[t,s,!1]}function zl(e,t,n,s){return e={tag:e,create:n,deps:s,inst:t,next:null},null===(t=Ua.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Ua.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function Rl(){return dl().memoizedState}function Fl(e,t,n,s){var r=cl();Ua.flags|=e,r.memoizedState=zl(1|t,{destroy:void 0},n,void 0===s?null:s)}function ql(e,t,n,s){var r=dl();s=void 0===s?null:s;var a=r.memoizedState.inst;null!==Va&&null!==s&&tl(s,Va.memoizedState.deps)?r.memoizedState=zl(t,a,n,s):(Ua.flags|=e,r.memoizedState=zl(1|t,a,n,s))}function Bl(e,t){Fl(8390656,8,e,t)}function Hl(e,t){ql(2048,8,e,t)}function Ul(e){var t=dl().memoizedState;return function(e){Ua.flags|=4;var t=Ua.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Ua.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&hc)throw Error(s(440));return t.impl.apply(void 0,arguments)}}function Vl(e,t){return ql(4,2,e,t)}function Wl(e,t){return ql(4,4,e,t)}function Ql(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Gl(e,t,n){n=null!=n?n.concat([e]):null,ql(4,4,Ql.bind(null,t,e),n)}function Jl(){}function Kl(e,t){var n=dl();t=void 0===t?null:t;var s=n.memoizedState;return null!==t&&tl(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Yl(e,t){var n=dl();t=void 0===t?null:t;var s=n.memoizedState;if(null!==t&&tl(t,s[1]))return s[0];if(s=e(),Ja){je(!0);try{e()}finally{je(!1)}}return n.memoizedState=[s,t],s}function Xl(e,t,n){return void 0===n||1073741824&Ha&&!(261930&bc)?e.memoizedState=t:(e.memoizedState=n,e=Jc(),Ua.lanes|=e,Sc|=e,n)}function Zl(e,t,n,s){return es(n,t)?n:null!==$a.current?(e=Xl(e,n,s),es(e,t)||(Ai=!0),e):42&Ha&&(!(1073741824&Ha)||261930&bc)?(e=Jc(),Ua.lanes|=e,Sc|=e,t):(Ai=!0,e.memoizedState=n)}function ei(e,t,n,s,r){var a=O.p;O.p=0!==a&&8>a?a:8;var l=I.T,i={};I.T=i,mi(e,!1,t,n);try{var o=r(),c=I.S;if(null!==c&&c(i,o),null!==o&&"object"==typeof o&&"function"==typeof o.then)ui(e,t,function(e,t){var n=[],s={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){s.status="fulfilled",s.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(s.status="rejected",s.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),s}(o,s),Gc());else ui(e,t,s,Gc())}catch(d){ui(e,t,{then:function(){},status:"rejected",reason:d},Gc())}finally{O.p=a,null!==l&&null!==i.types&&(l.types=i.types),I.T=l}}function ti(){}function ni(e,t,n,r){if(5!==e.tag)throw Error(s(476));var a=si(e).queue;ei(e,a,t,z,null===n?ti:function(){return ri(e),n(r)})}function si(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:z,baseState:z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pl,lastRenderedState:z},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pl,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ri(e){var t=si(e);null===t.next&&(t=e.alternate.memoizedState),ui(e,t.next.queue,{},Gc())}function ai(){return Ar(mm)}function li(){return dl().memoizedState}function ii(){return dl().memoizedState}function oi(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Gc(),s=ja(t,e=va(n),n);return null!==s&&(Kc(s,t,n),Na(s,t,n)),t={cache:qr()},void(e.payload=t)}t=t.return}}function ci(e,t,n){var s=Gc();n={lane:s,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},xi(e)?pi(t,n):null!==(n=As(e,t,n,s))&&(Kc(n,e,s),hi(n,t,s))}function di(e,t,n){ui(e,t,n,Gc())}function ui(e,t,n,s){var r={lane:s,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(xi(e))pi(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var l=t.lastRenderedState,i=a(l,n);if(r.hasEagerState=!0,r.eagerState=i,es(i,l))return Ms(e,t,r,0),null===fc&&Ls(),!1}catch(o){}if(null!==(n=As(e,t,r,s)))return Kc(n,e,s),hi(n,t,s),!0}return!1}function mi(e,t,n,r){if(r={lane:2,revertLane:Ud(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},xi(e)){if(t)throw Error(s(479))}else null!==(t=As(e,n,r,2))&&Kc(t,e,2)}function xi(e){var t=e.alternate;return e===Ua||null!==t&&t===Ua}function pi(e,t){Ga=Qa=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hi(e,t,n){if(4194048&n){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,Ie(e,n)}}var fi={readContext:Ar,use:ml,useCallback:el,useContext:el,useEffect:el,useImperativeHandle:el,useLayoutEffect:el,useInsertionEffect:el,useMemo:el,useReducer:el,useRef:el,useState:el,useDebugValue:el,useDeferredValue:el,useTransition:el,useSyncExternalStore:el,useId:el,useHostTransitionStatus:el,useFormState:el,useActionState:el,useOptimistic:el,useMemoCache:el,useCacheRefresh:el};fi.useEffectEvent=el;var gi={readContext:Ar,use:ml,useCallback:function(e,t){return cl().memoizedState=[e,void 0===t?null:t],e},useContext:Ar,useEffect:Bl,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,Fl(4194308,4,Ql.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fl(4194308,4,e,t)},useInsertionEffect:function(e,t){Fl(4,2,e,t)},useMemo:function(e,t){var n=cl();t=void 0===t?null:t;var s=e();if(Ja){je(!0);try{e()}finally{je(!1)}}return n.memoizedState=[s,t],s},useReducer:function(e,t,n){var s=cl();if(void 0!==n){var r=n(t);if(Ja){je(!0);try{n(t)}finally{je(!1)}}}else r=t;return s.memoizedState=s.baseState=r,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},s.queue=e,e=e.dispatch=ci.bind(null,Ua,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},cl().memoizedState=e},useState:function(e){var t=(e=kl(e)).queue,n=di.bind(null,Ua,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Jl,useDeferredValue:function(e,t){return Xl(cl(),e,t)},useTransition:function(){var e=kl(!1);return e=ei.bind(null,Ua,e.queue,!0,!1),cl().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Ua,a=cl();if(xr){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===fc)throw Error(s(349));127&bc||yl(r,t,n)}a.memoizedState=n;var l={value:n,getSnapshot:t};return a.queue=l,Bl(jl.bind(null,r,l,e),[e]),r.flags|=2048,zl(9,{destroy:void 0},vl.bind(null,r,l,n,t),null),n},useId:function(){var e=cl(),t=fc.identifierPrefix;if(xr){var n=ar;t="_"+t+"R_"+(n=(rr&~(1<<32-Ne(rr)-1)).toString(32)+n),0<(n=Ka++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Za++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ai,useFormState:Ml,useActionState:Ml,useOptimistic:function(e){var t=cl();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=mi.bind(null,Ua,!0,n),n.dispatch=t,[e,t]},useMemoCache:xl,useCacheRefresh:function(){return cl().memoizedState=oi.bind(null,Ua)},useEffectEvent:function(e){var t=cl(),n={impl:e};return t.memoizedState=n,function(){if(2&hc)throw Error(s(440));return n.impl.apply(void 0,arguments)}}},bi={readContext:Ar,use:ml,useCallback:Kl,useContext:Ar,useEffect:Hl,useImperativeHandle:Gl,useInsertionEffect:Vl,useLayoutEffect:Wl,useMemo:Yl,useReducer:hl,useRef:Rl,useState:function(){return hl(pl)},useDebugValue:Jl,useDeferredValue:function(e,t){return Zl(dl(),Va.memoizedState,e,t)},useTransition:function(){var e=hl(pl)[0],t=dl().memoizedState;return["boolean"==typeof e?e:ul(e),t]},useSyncExternalStore:bl,useId:li,useHostTransitionStatus:ai,useFormState:Al,useActionState:Al,useOptimistic:function(e,t){return Cl(dl(),0,e,t)},useMemoCache:xl,useCacheRefresh:ii};bi.useEffectEvent=Ul;var yi={readContext:Ar,use:ml,useCallback:Kl,useContext:Ar,useEffect:Hl,useImperativeHandle:Gl,useInsertionEffect:Vl,useLayoutEffect:Wl,useMemo:Yl,useReducer:gl,useRef:Rl,useState:function(){return gl(pl)},useDebugValue:Jl,useDeferredValue:function(e,t){var n=dl();return null===Va?Xl(n,e,t):Zl(n,Va.memoizedState,e,t)},useTransition:function(){var e=gl(pl)[0],t=dl().memoizedState;return["boolean"==typeof e?e:ul(e),t]},useSyncExternalStore:bl,useId:li,useHostTransitionStatus:ai,useFormState:Ol,useActionState:Ol,useOptimistic:function(e,t){var n=dl();return null!==Va?Cl(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:xl,useCacheRefresh:ii};function vi(e,t,n,s){n=null==(n=n(s,t=e.memoizedState))?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}yi.useEffectEvent=Ul;var ji={enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Gc(),r=va(s);r.payload=t,null!=n&&(r.callback=n),null!==(t=ja(e,r,s))&&(Kc(t,e,s),Na(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Gc(),r=va(s);r.tag=1,r.payload=t,null!=n&&(r.callback=n),null!==(t=ja(e,r,s))&&(Kc(t,e,s),Na(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Gc(),s=va(n);s.tag=2,null!=t&&(s.callback=t),null!==(t=ja(e,s,n))&&(Kc(t,e,n),Na(t,e,n))}};function Ni(e,t,n,s,r,a,l){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,a,l):!t.prototype||!t.prototype.isPureReactComponent||(!ts(n,s)||!ts(r,a))}function wi(e,t,n,s){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&ji.enqueueReplaceState(t,t.state,null)}function ki(e,t){var n=t;if("ref"in t)for(var s in n={},t)"ref"!==s&&(n[s]=t[s]);if(e=e.defaultProps)for(var r in n===t&&(n=d({},n)),e)void 0===n[r]&&(n[r]=e[r]);return n}function Ci(e){Ps(e)}function Si(e){console.error(e)}function Ei(e){Ps(e)}function Pi(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function $i(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(s){setTimeout(function(){throw s})}}function _i(e,t,n){return(n=va(n)).tag=3,n.payload={element:null},n.callback=function(){Pi(e,t)},n}function Di(e){return(e=va(e)).tag=3,e}function Li(e,t,n,s){var r=n.type.getDerivedStateFromError;if("function"==typeof r){var a=s.value;e.payload=function(){return r(a)},e.callback=function(){$i(t,n,s)}}var l=n.stateNode;null!==l&&"function"==typeof l.componentDidCatch&&(e.callback=function(){$i(t,n,s),"function"!=typeof r&&(null===zc?zc=new Set([this]):zc.add(this));var e=s.stack;this.componentDidCatch(s.value,{componentStack:null!==e?e:""})})}var Mi=Error(s(461)),Ai=!1;function Ti(e,t,n,s){t.child=null===e?fa(t,null,n,s):ha(t,e.child,n,s)}function Ii(e,t,n,s,r){n=n.render;var a=t.ref;if("ref"in s){var l={};for(var i in s)"ref"!==i&&(l[i]=s[i])}else l=s;return Mr(t),s=nl(e,t,n,l,a,r),i=ll(),null===e||Ai?(xr&&i&&or(t),t.flags|=1,Ti(e,t,s,r),t.child):(il(e,t,r),ao(e,t,r))}function Oi(e,t,n,s,r){if(null===e){var a=n.type;return"function"!=typeof a||qs(a)||void 0!==a.defaultProps||null!==n.compare?((e=Us(n.type,null,s,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,zi(e,t,a,s,r))}if(a=e.child,!lo(e,r)){var l=a.memoizedProps;if((n=null!==(n=n.compare)?n:ts)(l,s)&&e.ref===t.ref)return ao(e,t,r)}return t.flags|=1,(e=Bs(a,s)).ref=t.ref,e.return=t,t.child=e}function zi(e,t,n,s,r){if(null!==e){var a=e.memoizedProps;if(ts(a,s)&&e.ref===t.ref){if(Ai=!1,t.pendingProps=s=a,!lo(e,r))return t.lanes=e.lanes,ao(e,t,r);131072&e.flags&&(Ai=!0)}}return Vi(e,t,n,s,r)}function Ri(e,t,n,s){var r=s.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===s.mode){if(128&t.flags){if(a=null!==a?a.baseLanes|n:n,null!==e){for(s=t.child=e.child,r=0;null!==s;)r=r|s.lanes|s.childLanes,s=s.sibling;s=r&~a}else s=0,t.child=null;return qi(e,t,a,n,s)}if(!(536870912&n))return s=t.lanes=536870912,qi(e,t,null!==a?a.baseLanes|n:n,n,s);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Yr(0,null!==a?a.cachePool:null),null!==a?Da(t,a):La(),za(t)}else null!==a?(Yr(0,a.cachePool),Da(t,a),Ra(),t.memoizedState=null):(null!==e&&Yr(0,null),La(),Ra());return Ti(e,t,r,n),t.child}function Fi(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function qi(e,t,n,s,r){var a=Kr();return a=null===a?null:{parent:Fr._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&Yr(0,null),La(),za(t),null!==e&&Dr(e,t,s,!0),t.childLanes=r,null}function Bi(e,t){return(t=eo({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Hi(e,t,n){return ha(t,e.child,null,n),(e=Bi(t,t.pendingProps)).flags|=2,Fa(t),t.memoizedState=null,e}function Ui(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Vi(e,t,n,s,r){return Mr(t),n=nl(e,t,n,s,void 0,r),s=ll(),null===e||Ai?(xr&&s&&or(t),t.flags|=1,Ti(e,t,n,r),t.child):(il(e,t,r),ao(e,t,r))}function Wi(e,t,n,s,r,a){return Mr(t),t.updateQueue=null,n=rl(t,s,n,r),sl(e),s=ll(),null===e||Ai?(xr&&s&&or(t),t.flags|=1,Ti(e,t,n,a),t.child):(il(e,t,a),ao(e,t,a))}function Qi(e,t,n,s,r){if(Mr(t),null===t.stateNode){var a=zs,l=n.contextType;"object"==typeof l&&null!==l&&(a=Ar(l)),a=new n(s,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=ji,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=s,a.state=t.memoizedState,a.refs={},ba(t),l=n.contextType,a.context="object"==typeof l&&null!==l?Ar(l):zs,a.state=t.memoizedState,"function"==typeof(l=n.getDerivedStateFromProps)&&(vi(t,n,l,s),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(l=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),l!==a.state&&ji.enqueueReplaceState(a,a.state,null),Sa(t,s,a,r),Ca(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),s=!0}else if(null===e){a=t.stateNode;var i=t.memoizedProps,o=ki(n,i);a.props=o;var c=a.context,d=n.contextType;l=zs,"object"==typeof d&&null!==d&&(l=Ar(d));var u=n.getDerivedStateFromProps;d="function"==typeof u||"function"==typeof a.getSnapshotBeforeUpdate,i=t.pendingProps!==i,d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(i||c!==l)&&wi(t,a,s,l),ga=!1;var m=t.memoizedState;a.state=m,Sa(t,s,a,r),Ca(),c=t.memoizedState,i||m!==c||ga?("function"==typeof u&&(vi(t,n,u,s),c=t.memoizedState),(o=ga||Ni(t,n,o,s,m,c,l))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),a.props=s,a.state=c,a.context=l,s=o):("function"==typeof a.componentDidMount&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,ya(e,t),d=ki(n,l=t.memoizedProps),a.props=d,u=t.pendingProps,m=a.context,c=n.contextType,o=zs,"object"==typeof c&&null!==c&&(o=Ar(c)),(c="function"==typeof(i=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(l!==u||m!==o)&&wi(t,a,s,o),ga=!1,m=t.memoizedState,a.state=m,Sa(t,s,a,r),Ca();var x=t.memoizedState;l!==u||m!==x||ga||null!==e&&null!==e.dependencies&&Lr(e.dependencies)?("function"==typeof i&&(vi(t,n,i,s),x=t.memoizedState),(d=ga||Ni(t,n,d,s,m,x,o)||null!==e&&null!==e.dependencies&&Lr(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(s,x,o),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(s,x,o)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=x),a.props=s,a.state=x,a.context=o,s=d):("function"!=typeof a.componentDidUpdate||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),s=!1)}return a=s,Ui(e,t),s=!!(128&t.flags),a||s?(a=t.stateNode,n=s&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&s?(t.child=ha(t,e.child,null,r),t.child=ha(t,null,n,r)):Ti(e,t,n,r),t.memoizedState=a.state,e=t.child):e=ao(e,t,r),e}function Gi(e,t,n,s){return jr(),t.flags|=256,Ti(e,t,n,s),t.child}var Ji={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ki(e){return{baseLanes:e,cachePool:Xr()}}function Yi(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=$c),e}function Xi(e,t,n){var r,a=t.pendingProps,l=!1,i=!!(128&t.flags);if((r=i)||(r=(null===e||null!==e.memoizedState)&&!!(2&qa.current)),r&&(l=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(xr){if(l?Ia(t):Ra(),(e=mr)?null!==(e=null!==(e=Lu(e,hr))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==sr?{id:rr,overflow:ar}:null,retryLane:536870912,hydrationErrors:null},(n=Qs(e)).return=t,t.child=n,ur=t,mr=null):e=null,null===e)throw gr(t);return Au(e)?t.lanes=32:t.lanes=536870912,null}var o=a.children;return a=a.fallback,l?(Ra(),o=eo({mode:"hidden",children:o},l=t.mode),a=Vs(a,l,n,null),o.return=t,a.return=t,o.sibling=a,t.child=o,(a=t.child).memoizedState=Ki(n),a.childLanes=Yi(e,r,n),t.memoizedState=Ji,Fi(null,a)):(Ia(t),Zi(t,o))}var c=e.memoizedState;if(null!==c&&null!==(o=c.dehydrated)){if(i)256&t.flags?(Ia(t),t.flags&=-257,t=to(e,t,n)):null!==t.memoizedState?(Ra(),t.child=e.child,t.flags|=128,t=null):(Ra(),o=a.fallback,l=t.mode,a=eo({mode:"visible",children:a.children},l),(o=Vs(o,l,n,null)).flags|=2,a.return=t,o.return=t,a.sibling=o,t.child=a,ha(t,e.child,null,n),(a=t.child).memoizedState=Ki(n),a.childLanes=Yi(e,r,n),t.memoizedState=Ji,t=Fi(null,a));else if(Ia(t),Au(o)){if(r=o.nextSibling&&o.nextSibling.dataset)var d=r.dgst;r=d,(a=Error(s(419))).stack="",a.digest=r,wr({value:a,source:null,stack:null}),t=to(e,t,n)}else if(Ai||Dr(e,t,n,!1),r=0!==(n&e.childLanes),Ai||r){if(null!==(r=fc)&&(0!==(a=Oe(r,n))&&a!==c.retryLane))throw c.retryLane=a,Ts(e,a),Kc(r,e,a),Mi;Mu(o)||od(),t=to(e,t,n)}else Mu(o)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,mr=Tu(o.nextSibling),ur=t,xr=!0,pr=null,hr=!1,null!==e&&dr(t,e),(t=Zi(t,a.children)).flags|=4096);return t}return l?(Ra(),o=a.fallback,l=t.mode,d=(c=e.child).sibling,(a=Bs(c,{mode:"hidden",children:a.children})).subtreeFlags=65011712&c.subtreeFlags,null!==d?o=Bs(d,o):(o=Vs(o,l,n,null)).flags|=2,o.return=t,a.return=t,a.sibling=o,t.child=a,Fi(null,a),a=t.child,null===(o=e.child.memoizedState)?o=Ki(n):(null!==(l=o.cachePool)?(c=Fr._currentValue,l=l.parent!==c?{parent:c,pool:c}:l):l=Xr(),o={baseLanes:o.baseLanes|n,cachePool:l}),a.memoizedState=o,a.childLanes=Yi(e,r,n),t.memoizedState=Ji,Fi(e.child,a)):(Ia(t),e=(n=e.child).sibling,(n=Bs(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Zi(e,t){return(t=eo({mode:"visible",children:t},e.mode)).return=e,e.child=t}function eo(e,t){return(e=Fs(22,e,null,t)).lanes=0,e}function to(e,t,n){return ha(t,e.child,null,n),(e=Zi(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function no(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),$r(e.return,t,n)}function so(e,t,n,s,r,a){var l=e.memoizedState;null===l?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r,treeForkCount:a}:(l.isBackwards=t,l.rendering=null,l.renderingStartTime=0,l.last=s,l.tail=n,l.tailMode=r,l.treeForkCount=a)}function ro(e,t,n){var s=t.pendingProps,r=s.revealOrder,a=s.tail;s=s.children;var l=qa.current,i=!!(2&l);if(i?(l=1&l|2,t.flags|=128):l&=1,H(qa,l),Ti(e,t,s,n),s=xr?er:0,!i&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&no(e,n,t);else if(19===e.tag)no(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===Ba(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),so(t,!1,r,n,a,s);break;case"backwards":case"unstable_legacy-backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Ba(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}so(t,!0,n,null,a,s);break;case"together":so(t,!1,null,null,void 0,s);break;default:t.memoizedState=null}return t.child}function ao(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Sc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Dr(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Bs(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bs(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function lo(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Lr(e))}function io(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ai=!0;else{if(!(lo(e,n)||128&t.flags))return Ai=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),Er(0,Fr,e.memoizedState.cache),jr();break;case 27:case 5:X(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:Er(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Oa(t),null;break;case 13:var s=t.memoizedState;if(null!==s)return null!==s.dehydrated?(Ia(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Xi(e,t,n):(Ia(t),null!==(e=ao(e,t,n))?e.sibling:null);Ia(t);break;case 19:var r=!!(128&e.flags);if((s=0!==(n&t.childLanes))||(Dr(e,t,n,!1),s=0!==(n&t.childLanes)),r){if(s)return ro(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),H(qa,qa.current),s)break;return null;case 22:return t.lanes=0,Ri(e,t,n,t.pendingProps);case 24:Er(0,Fr,e.memoizedState.cache)}return ao(e,t,n)}(e,t,n);Ai=!!(131072&e.flags)}else Ai=!1,xr&&1048576&t.flags&&ir(t,er,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=aa(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var a=e.$$typeof;if(a===N){t.tag=11,t=Ii(null,t,e,r,n);break e}if(a===S){t.tag=14,t=Oi(null,t,e,r,n);break e}}throw t=A(e)||e,Error(s(306,t,""))}qs(e)?(r=ki(e,r),t.tag=1,t=Qi(null,t,e,r,n)):(t.tag=0,t=Vi(null,t,e,r,n))}return t;case 0:return Vi(e,t,t.type,t.pendingProps,n);case 1:return Qi(e,t,r=t.type,a=ki(r,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(s(387));r=t.pendingProps;var l=t.memoizedState;a=l.element,ya(e,t),Sa(t,r,null,n);var i=t.memoizedState;if(r=i.cache,Er(0,Fr,r),r!==l.cache&&_r(t,[Fr],n,!0),Ca(),r=i.element,l.isDehydrated){if(l={element:r,isDehydrated:!1,cache:i.cache},t.updateQueue.baseState=l,t.memoizedState=l,256&t.flags){t=Gi(e,t,r,n);break e}if(r!==a){wr(a=Ks(Error(s(424)),t)),t=Gi(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(mr=Tu(e.firstChild),ur=t,xr=!0,pr=null,hr=!0,n=fa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(jr(),r===a){t=ao(e,t,n);break e}Ti(e,t,r,n)}t=t.child}return t;case 26:return Ui(e,t),null===e?(n=Qu(t.type,null,t.pendingProps,null))?t.memoizedState=n:xr||(n=t.type,e=t.pendingProps,(r=bu(G.current).createElement(n))[He]=t,r[Ue]=e,pu(r,n,e),nt(r),t.stateNode=r):t.memoizedState=Qu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&xr&&(r=t.stateNode=Ru(t.type,t.pendingProps,G.current),ur=t,hr=!0,a=mr,Pu(t.type)?(Iu=a,mr=Tu(r.firstChild)):mr=a),Ti(e,t,t.pendingProps.children,n),Ui(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&xr&&((a=r=mr)&&(null!==(r=function(e,t,n,s){for(;1===e.nodeType;){var r=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(s){if(!e[Ke])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==r.rel||e.getAttribute("href")!==(null==r.href||""===r.href?null:r.href)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin)||e.getAttribute("title")!==(null==r.title?null:r.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==r.src?null:r.src)||e.getAttribute("type")!==(null==r.type?null:r.type)||e.getAttribute("crossorigin")!==(null==r.crossOrigin?null:r.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==r.name?null:""+r.name;if("hidden"===r.type&&e.getAttribute("name")===a)return e}if(null===(e=Tu(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,hr))?(t.stateNode=r,ur=t,mr=Tu(r.firstChild),hr=!1,a=!0):a=!1),a||gr(t)),X(t),a=t.type,l=t.pendingProps,i=null!==e?e.memoizedProps:null,r=l.children,ju(a,l)?r=null:null!==i&&ju(a,i)&&(t.flags|=32),null!==t.memoizedState&&(a=nl(e,t,al,null,null,n),mm._currentValue=a),Ui(e,t),Ti(e,t,r,n),t.child;case 6:return null===e&&xr&&((e=n=mr)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Tu(e.nextSibling)))return null}return e}(n,t.pendingProps,hr))?(t.stateNode=n,ur=t,mr=null,e=!0):e=!1),e||gr(t)),null;case 13:return Xi(e,t,n);case 4:return K(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ha(t,null,r,n):Ti(e,t,r,n),t.child;case 11:return Ii(e,t,t.type,t.pendingProps,n);case 7:return Ti(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ti(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,Er(0,t.type,r.value),Ti(e,t,r.children,n),t.child;case 9:return a=t.type._context,r=t.pendingProps.children,Mr(t),r=r(a=Ar(a)),t.flags|=1,Ti(e,t,r,n),t.child;case 14:return Oi(e,t,t.type,t.pendingProps,n);case 15:return zi(e,t,t.type,t.pendingProps,n);case 19:return ro(e,t,n);case 31:return function(e,t,n){var r=t.pendingProps,a=!!(128&t.flags);if(t.flags&=-129,null===e){if(xr){if("hidden"===r.mode)return e=Bi(t,r),t.lanes=536870912,Fi(null,e);if(Oa(t),(e=mr)?null!==(e=null!==(e=Lu(e,hr))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==sr?{id:rr,overflow:ar}:null,retryLane:536870912,hydrationErrors:null},(n=Qs(e)).return=t,t.child=n,ur=t,mr=null):e=null,null===e)throw gr(t);return t.lanes=536870912,null}return Bi(t,r)}var l=e.memoizedState;if(null!==l){var i=l.dehydrated;if(Oa(t),a)if(256&t.flags)t.flags&=-257,t=Hi(e,t,n);else{if(null===t.memoizedState)throw Error(s(558));t.child=e.child,t.flags|=128,t=null}else if(Ai||Dr(e,t,n,!1),a=0!==(n&e.childLanes),Ai||a){if(null!==(r=fc)&&0!==(i=Oe(r,n))&&i!==l.retryLane)throw l.retryLane=i,Ts(e,i),Kc(r,e,i),Mi;od(),t=Hi(e,t,n)}else e=l.treeContext,mr=Tu(i.nextSibling),ur=t,xr=!0,pr=null,hr=!1,null!==e&&dr(t,e),(t=Bi(t,r)).flags|=4096;return t}return(e=Bs(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Ri(e,t,n,t.pendingProps);case 24:return Mr(t),r=Ar(Fr),null===e?(null===(a=Kr())&&(a=fc,l=qr(),a.pooledCache=l,l.refCount++,null!==l&&(a.pooledCacheLanes|=n),a=l),t.memoizedState={parent:r,cache:a},ba(t),Er(0,Fr,a)):(0!==(e.lanes&n)&&(ya(e,t),Sa(t,null,null,n),Ca()),a=e.memoizedState,l=t.memoizedState,a.parent!==r?(a={parent:r,cache:r},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),Er(0,Fr,r)):(r=l.cache,Er(0,Fr,r),r!==a.cache&&_r(t,[Fr],n,!0))),Ti(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function oo(e){e.flags|=4}function co(e,t,n,s,r){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&r)===r)if(e.stateNode.complete)e.flags|=8192;else{if(!ad())throw la=na,ea;e.flags|=8192}}else e.flags&=-16777217}function uo(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!lm(t)){if(!ad())throw la=na,ea;e.flags|=8192}}function mo(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Le():536870912,e.lanes|=t,_c|=t)}function xo(e,t){if(!xr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function po(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=65011712&r.subtreeFlags,s|=65011712&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function ho(e,t,n){var r=t.pendingProps;switch(cr(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return po(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Pr(Fr),Y(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(vr(t)?oo(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Nr())),po(t),null;case 26:var a=t.type,l=t.memoizedState;return null===e?(oo(t),null!==l?(po(t),uo(t,l)):(po(t),co(t,a,0,0,n))):l?l!==e.memoizedState?(oo(t),po(t),uo(t,l)):(po(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&oo(t),po(t),co(t,a,0,0,n)),null;case 27:if(Z(t),n=G.current,a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&oo(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return po(t),null}e=W.current,vr(t)?br(t):(e=Ru(a,r,n),t.stateNode=e,oo(t))}return po(t),null;case 5:if(Z(t),a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&oo(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return po(t),null}if(l=W.current,vr(t))br(t);else{var i=bu(G.current);switch(l){case 1:l=i.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:l=i.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":l=i.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":l=i.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":(l=i.createElement("div")).innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l="string"==typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?l.multiple=!0:r.size&&(l.size=r.size);break;default:l="string"==typeof r.is?i.createElement(a,{is:r.is}):i.createElement(a)}}l[He]=t,l[Ue]=r;e:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)l.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;null===i.sibling;){if(null===i.return||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}t.stateNode=l;e:switch(pu(l,a,r),a){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&oo(t)}}return po(t),co(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&oo(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(s(166));if(e=G.current,vr(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(a=ur))switch(a.tag){case 27:case 5:r=a.memoizedProps}e[He]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||uu(e.nodeValue,n)))||gr(t,!0)}else(e=bu(e).createTextNode(r))[He]=t,t.stateNode=e}return po(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=vr(t),null!==n){if(null===e){if(!r)throw Error(s(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(557));e[He]=t}else jr(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;po(t),e=!1}else n=Nr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(Fa(t),t):(Fa(t),null);if(128&t.flags)throw Error(s(558))}return po(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=vr(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[He]=t}else jr(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;po(t),a=!1}else a=Nr(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(Fa(t),t):(Fa(t),null)}return Fa(t),128&t.flags?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(a=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(a=r.alternate.memoizedState.cachePool.pool),l=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(l=r.memoizedState.cachePool.pool),l!==a&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),mo(t,t.updateQueue),po(t),null);case 4:return Y(),null===e&&tu(t.stateNode.containerInfo),po(t),null;case 10:return Pr(t.type),po(t),null;case 19:if(B(qa),null===(r=t.memoizedState))return po(t),null;if(a=!!(128&t.flags),null===(l=r.rendering))if(a)xo(r,!1);else{if(0!==Cc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(l=Ba(e))){for(t.flags|=128,xo(r,!1),e=l.updateQueue,t.updateQueue=e,mo(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Hs(n,e),n=n.sibling;return H(qa,1&qa.current|2),xr&&lr(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&de()>Ic&&(t.flags|=128,a=!0,xo(r,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=Ba(l))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,mo(t,e),xo(r,!0),null===r.tail&&"hidden"===r.tailMode&&!l.alternate&&!xr)return po(t),null}else 2*de()-r.renderingStartTime>Ic&&536870912!==n&&(t.flags|=128,a=!0,xo(r,!1),t.lanes=4194304);r.isBackwards?(l.sibling=t.child,t.child=l):(null!==(e=r.last)?e.sibling=l:t.child=l,r.last=l)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=de(),e.sibling=null,n=qa.current,H(qa,a?1&n|2:1&n),xr&&lr(t,r.treeForkCount),e):(po(t),null);case 22:case 23:return Fa(t),Ma(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(po(t),6&t.subtreeFlags&&(t.flags|=8192)):po(t),null!==(n=t.updateQueue)&&mo(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&B(Jr),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Pr(Fr),po(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function fo(e,t){switch(cr(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Pr(Fr),Y(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Z(t),null;case 31:if(null!==t.memoizedState){if(Fa(t),null===t.alternate)throw Error(s(340));jr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Fa(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));jr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(qa),null;case 4:return Y(),null;case 10:return Pr(t.type),null;case 22:case 23:return Fa(t),Ma(),null!==e&&B(Jr),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Pr(Fr),null;default:return null}}function go(e,t){switch(cr(t),t.tag){case 3:Pr(Fr),Y();break;case 26:case 27:case 5:Z(t);break;case 4:Y();break;case 31:null!==t.memoizedState&&Fa(t);break;case 13:Fa(t);break;case 19:B(qa);break;case 10:Pr(t.type);break;case 22:case 23:Fa(t),Ma(),null!==e&&B(Jr);break;case 24:Pr(Fr)}}function bo(e,t){try{var n=t.updateQueue,s=null!==n?n.lastEffect:null;if(null!==s){var r=s.next;n=r;do{if((n.tag&e)===e){s=void 0;var a=n.create,l=n.inst;s=a(),l.destroy=s}n=n.next}while(n!==r)}}catch(i){Cd(t,t.return,i)}}function yo(e,t,n){try{var s=t.updateQueue,r=null!==s?s.lastEffect:null;if(null!==r){var a=r.next;s=a;do{if((s.tag&e)===e){var l=s.inst,i=l.destroy;if(void 0!==i){l.destroy=void 0,r=t;var o=n,c=i;try{c()}catch(d){Cd(r,o,d)}}}s=s.next}while(s!==a)}}catch(d){Cd(t,t.return,d)}}function vo(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Pa(t,n)}catch(s){Cd(e,e.return,s)}}}function jo(e,t,n){n.props=ki(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(s){Cd(e,t,s)}}function No(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;default:s=e.stateNode}"function"==typeof n?e.refCleanup=n(s):n.current=s}}catch(r){Cd(e,t,r)}}function wo(e,t){var n=e.ref,s=e.refCleanup;if(null!==n)if("function"==typeof s)try{s()}catch(r){Cd(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(a){Cd(e,t,a)}else n.current=null}function ko(e){var t=e.type,n=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&s.focus();break e;case"img":n.src?s.src=n.src:n.srcSet&&(s.srcset=n.srcSet)}}catch(r){Cd(e,e.return,r)}}function Co(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,l=null,i=null,o=null,c=null,d=null,u=null;for(p in n){var m=n[p];if(n.hasOwnProperty(p)&&null!=m)switch(p){case"checked":case"value":break;case"defaultValue":c=m;default:r.hasOwnProperty(p)||mu(e,t,p,null,r,m)}}for(var x in r){var p=r[x];if(m=n[x],r.hasOwnProperty(x)&&(null!=p||null!=m))switch(x){case"type":l=p;break;case"name":a=p;break;case"checked":d=p;break;case"defaultChecked":u=p;break;case"value":i=p;break;case"defaultValue":o=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:p!==m&&mu(e,t,x,p,r,m)}}return void vt(e,i,o,c,d,u,l,a);case"select":for(l in p=i=o=x=null,n)if(c=n[l],n.hasOwnProperty(l)&&null!=c)switch(l){case"value":break;case"multiple":p=c;default:r.hasOwnProperty(l)||mu(e,t,l,null,r,c)}for(a in r)if(l=r[a],c=n[a],r.hasOwnProperty(a)&&(null!=l||null!=c))switch(a){case"value":x=l;break;case"defaultValue":o=l;break;case"multiple":i=l;default:l!==c&&mu(e,t,a,l,r,c)}return t=o,n=i,r=p,void(null!=x?wt(e,!!n,x,!1):!!r!=!!n&&(null!=t?wt(e,!!n,t,!0):wt(e,!!n,n?[]:"",!1)));case"textarea":for(o in p=x=null,n)if(a=n[o],n.hasOwnProperty(o)&&null!=a&&!r.hasOwnProperty(o))switch(o){case"value":case"children":break;default:mu(e,t,o,null,r,a)}for(i in r)if(a=r[i],l=n[i],r.hasOwnProperty(i)&&(null!=a||null!=l))switch(i){case"value":x=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(s(91));break;default:a!==l&&mu(e,t,i,a,r,l)}return void kt(e,x,p);case"option":for(var h in n)if(x=n[h],n.hasOwnProperty(h)&&null!=x&&!r.hasOwnProperty(h))if("selected"===h)e.selected=!1;else mu(e,t,h,null,r,x);for(c in r)if(x=r[c],p=n[c],r.hasOwnProperty(c)&&x!==p&&(null!=x||null!=p))if("selected"===c)e.selected=x&&"function"!=typeof x&&"symbol"!=typeof x;else mu(e,t,c,x,r,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var f in n)x=n[f],n.hasOwnProperty(f)&&null!=x&&!r.hasOwnProperty(f)&&mu(e,t,f,null,r,x);for(d in r)if(x=r[d],p=n[d],r.hasOwnProperty(d)&&x!==p&&(null!=x||null!=p))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=x)throw Error(s(137,t));break;default:mu(e,t,d,x,r,p)}return;default:if(_t(t)){for(var g in n)x=n[g],n.hasOwnProperty(g)&&void 0!==x&&!r.hasOwnProperty(g)&&xu(e,t,g,void 0,r,x);for(u in r)x=r[u],p=n[u],!r.hasOwnProperty(u)||x===p||void 0===x&&void 0===p||xu(e,t,u,x,r,p);return}}for(var b in n)x=n[b],n.hasOwnProperty(b)&&null!=x&&!r.hasOwnProperty(b)&&mu(e,t,b,null,r,x);for(m in r)x=r[m],p=n[m],!r.hasOwnProperty(m)||x===p||null==x&&null==p||mu(e,t,m,x,r,p)}(r,e.type,n,t),r[Ue]=t}catch(a){Cd(e,e.return,a)}}function So(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Pu(e.type)||4===e.tag}function Eo(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||So(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Pu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Po(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=At));else if(4!==s&&(27===s&&Pu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Po(e,t,n),e=e.sibling;null!==e;)Po(e,t,n),e=e.sibling}function $o(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&(27===s&&Pu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for($o(e,t,n),e=e.sibling;null!==e;)$o(e,t,n),e=e.sibling}function _o(e){var t=e.stateNode,n=e.memoizedProps;try{for(var s=e.type,r=t.attributes;r.length;)t.removeAttributeNode(r[0]);pu(t,s,n),t[He]=e,t[Ue]=n}catch(a){Cd(e,e.return,a)}}var Do=!1,Lo=!1,Mo=!1,Ao="function"==typeof WeakSet?WeakSet:Set,To=null;function Io(e,t,n){var s=n.flags;switch(n.tag){case 0:case 11:case 15:Ko(e,n),4&s&&bo(5,n);break;case 1:if(Ko(e,n),4&s)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(l){Cd(n,n.return,l)}else{var r=ki(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(r,t,e.__reactInternalSnapshotBeforeUpdate)}catch(i){Cd(n,n.return,i)}}64&s&&vo(n),512&s&&No(n,n.return);break;case 3:if(Ko(e,n),64&s&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Pa(e,t)}catch(l){Cd(n,n.return,l)}}break;case 27:null===t&&4&s&&_o(n);case 26:case 5:Ko(e,n),null===t&&4&s&&ko(n),512&s&&No(n,n.return);break;case 12:Ko(e,n);break;case 31:Ko(e,n),4&s&&Bo(e,n);break;case 13:Ko(e,n),4&s&&Ho(e,n),64&s&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var s=function(){t(),n.removeEventListener("DOMContentLoaded",s)};n.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}(e,n=$d.bind(null,n))));break;case 22:if(!(s=null!==n.memoizedState||Do)){t=null!==t&&null!==t.memoizedState||Lo,r=Do;var a=Lo;Do=s,(Lo=t)&&!a?Xo(e,n,!!(8772&n.subtreeFlags)):Ko(e,n),Do=r,Lo=a}break;case 30:break;default:Ko(e,n)}}function Oo(e){var t=e.alternate;null!==t&&(e.alternate=null,Oo(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ye(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var zo=null,Ro=!1;function Fo(e,t,n){for(n=n.child;null!==n;)qo(e,t,n),n=n.sibling}function qo(e,t,n){if(ve&&"function"==typeof ve.onCommitFiberUnmount)try{ve.onCommitFiberUnmount(ye,n)}catch(a){}switch(n.tag){case 26:Lo||wo(n,t),Fo(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Lo||wo(n,t);var s=zo,r=Ro;Pu(n.type)&&(zo=n.stateNode,Ro=!1),Fo(e,t,n),Fu(n.stateNode),zo=s,Ro=r;break;case 5:Lo||wo(n,t);case 6:if(s=zo,r=Ro,zo=null,Fo(e,t,n),Ro=r,null!==(zo=s))if(Ro)try{(9===zo.nodeType?zo.body:"HTML"===zo.nodeName?zo.ownerDocument.body:zo).removeChild(n.stateNode)}catch(l){Cd(n,t,l)}else try{zo.removeChild(n.stateNode)}catch(l){Cd(n,t,l)}break;case 18:null!==zo&&(Ro?($u(9===(e=zo).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Wm(e)):$u(zo,n.stateNode));break;case 4:s=zo,r=Ro,zo=n.stateNode.containerInfo,Ro=!0,Fo(e,t,n),zo=s,Ro=r;break;case 0:case 11:case 14:case 15:yo(2,n,t),Lo||yo(4,n,t),Fo(e,t,n);break;case 1:Lo||(wo(n,t),"function"==typeof(s=n.stateNode).componentWillUnmount&&jo(n,t,s)),Fo(e,t,n);break;case 21:Fo(e,t,n);break;case 22:Lo=(s=Lo)||null!==n.memoizedState,Fo(e,t,n),Lo=s;break;default:Fo(e,t,n)}}function Bo(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Wm(e)}catch(n){Cd(t,t.return,n)}}}function Ho(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Wm(e)}catch(n){Cd(t,t.return,n)}}function Uo(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Ao),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Ao),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var s=_d.bind(null,e,t);t.then(s,s)}})}function Vo(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r],l=e,i=t,o=i;e:for(;null!==o;){switch(o.tag){case 27:if(Pu(o.type)){zo=o.stateNode,Ro=!1;break e}break;case 5:zo=o.stateNode,Ro=!1;break e;case 3:case 4:zo=o.stateNode.containerInfo,Ro=!0;break e}o=o.return}if(null===zo)throw Error(s(160));qo(l,i,a),zo=null,Ro=!1,null!==(l=a.alternate)&&(l.return=null),a.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Qo(t,e),t=t.sibling}var Wo=null;function Qo(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Vo(t,e),Go(e),4&r&&(yo(3,e,e.return),bo(3,e),yo(5,e,e.return));break;case 1:Vo(t,e),Go(e),512&r&&(Lo||null===n||wo(n,n.return)),64&r&&Do&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var a=Wo;if(Vo(t,e),Go(e),512&r&&(Lo||null===n||wo(n,n.return)),4&r){var l=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(r){case"title":(!(l=a.getElementsByTagName("title")[0])||l[Ke]||l[He]||"http://www.w3.org/2000/svg"===l.namespaceURI||l.hasAttribute("itemprop"))&&(l=a.createElement(r),a.head.insertBefore(l,a.querySelector("head > title"))),pu(l,r,n),l[He]=e,nt(l),r=l;break e;case"link":var i=rm("link","href",a).get(r+(n.href||""));if(i)for(var o=0;o<i.length;o++)if((l=i[o]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&l.getAttribute("rel")===(null==n.rel?null:n.rel)&&l.getAttribute("title")===(null==n.title?null:n.title)&&l.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){i.splice(o,1);break t}pu(l=a.createElement(r),r,n),a.head.appendChild(l);break;case"meta":if(i=rm("meta","content",a).get(r+(n.content||"")))for(o=0;o<i.length;o++)if((l=i[o]).getAttribute("content")===(null==n.content?null:""+n.content)&&l.getAttribute("name")===(null==n.name?null:n.name)&&l.getAttribute("property")===(null==n.property?null:n.property)&&l.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&l.getAttribute("charset")===(null==n.charSet?null:n.charSet)){i.splice(o,1);break t}pu(l=a.createElement(r),r,n),a.head.appendChild(l);break;default:throw Error(s(468,r))}l[He]=e,nt(l),r=l}e.stateNode=r}else am(a,e.type,e.stateNode);else e.stateNode=Zu(a,r,e.memoizedProps);else l!==r?(null===l?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):l.count--,null===r?am(a,e.type,e.stateNode):Zu(a,r,e.memoizedProps)):null===r&&null!==e.stateNode&&Co(e,e.memoizedProps,n.memoizedProps)}break;case 27:Vo(t,e),Go(e),512&r&&(Lo||null===n||wo(n,n.return)),null!==n&&4&r&&Co(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Vo(t,e),Go(e),512&r&&(Lo||null===n||wo(n,n.return)),32&e.flags){a=e.stateNode;try{St(a,"")}catch(h){Cd(e,e.return,h)}}4&r&&null!=e.stateNode&&Co(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&r&&(Mo=!0);break;case 6:if(Vo(t,e),Go(e),4&r){if(null===e.stateNode)throw Error(s(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(h){Cd(e,e.return,h)}}break;case 3:if(sm=null,a=Wo,Wo=Hu(t.containerInfo),Vo(t,e),Wo=a,Go(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wm(t.containerInfo)}catch(h){Cd(e,e.return,h)}Mo&&(Mo=!1,Jo(e));break;case 4:r=Wo,Wo=Hu(e.stateNode.containerInfo),Vo(t,e),Go(e),Wo=r;break;case 12:default:Vo(t,e),Go(e);break;case 31:case 19:Vo(t,e),Go(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Uo(e,r)));break;case 13:Vo(t,e),Go(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Ac=de()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Uo(e,r)));break;case 22:a=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,d=Do,u=Lo;if(Do=d||a,Lo=u||c,Vo(t,e),Lo=u,Do=d,Go(e),8192&r)e:for(t=e.stateNode,t._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||c||Do||Lo||Yo(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(l=c.stateNode,a)"function"==typeof(i=l.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{o=c.stateNode;var m=c.memoizedProps.style,x=null!=m&&m.hasOwnProperty("display")?m.display:null;o.style.display=null==x||"boolean"==typeof x?"":(""+x).trim()}}catch(h){Cd(c,c.return,h)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(h){Cd(c,c.return,h)}}}else if(18===t.tag){if(null===n){c=t;try{var p=c.stateNode;a?_u(p,!0):_u(c.stateNode,!1)}catch(h){Cd(c,c.return,h)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Uo(e,n))));case 30:case 21:}}function Go(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(So(r)){n=r;break}r=r.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var a=n.stateNode;$o(e,Eo(e),a);break;case 5:var l=n.stateNode;32&n.flags&&(St(l,""),n.flags&=-33),$o(e,Eo(e),l);break;case 3:case 4:var i=n.stateNode.containerInfo;Po(e,Eo(e),i);break;default:throw Error(s(161))}}catch(o){Cd(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Jo(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Jo(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Ko(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Io(e,t.alternate,t),t=t.sibling}function Yo(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:yo(4,t,t.return),Yo(t);break;case 1:wo(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&jo(t,t.return,n),Yo(t);break;case 27:Fu(t.stateNode);case 26:case 5:wo(t,t.return),Yo(t);break;case 22:null===t.memoizedState&&Yo(t);break;default:Yo(t)}e=e.sibling}}function Xo(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var s=t.alternate,r=e,a=t,l=a.flags;switch(a.tag){case 0:case 11:case 15:Xo(r,a,n),bo(4,a);break;case 1:if(Xo(r,a,n),"function"==typeof(r=(s=a).stateNode).componentDidMount)try{r.componentDidMount()}catch(c){Cd(s,s.return,c)}if(null!==(r=(s=a).updateQueue)){var i=s.stateNode;try{var o=r.shared.hiddenCallbacks;if(null!==o)for(r.shared.hiddenCallbacks=null,r=0;r<o.length;r++)Ea(o[r],i)}catch(c){Cd(s,s.return,c)}}n&&64&l&&vo(a),No(a,a.return);break;case 27:_o(a);case 26:case 5:Xo(r,a,n),n&&null===s&&4&l&&ko(a),No(a,a.return);break;case 12:Xo(r,a,n);break;case 31:Xo(r,a,n),n&&4&l&&Bo(r,a);break;case 13:Xo(r,a,n),n&&4&l&&Ho(r,a);break;case 22:null===a.memoizedState&&Xo(r,a,n),No(a,a.return);break;case 30:break;default:Xo(r,a,n)}t=t.sibling}}function Zo(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Br(n))}function ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Br(e))}function tc(e,t,n,s){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)nc(e,t,n,s),t=t.sibling}function nc(e,t,n,s){var r=t.flags;switch(t.tag){case 0:case 11:case 15:tc(e,t,n,s),2048&r&&bo(9,t);break;case 1:case 31:case 13:default:tc(e,t,n,s);break;case 3:tc(e,t,n,s),2048&r&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Br(e)));break;case 12:if(2048&r){tc(e,t,n,s),e=t.stateNode;try{var a=t.memoizedProps,l=a.id,i=a.onPostCommit;"function"==typeof i&&i(l,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(o){Cd(t,t.return,o)}}else tc(e,t,n,s);break;case 23:break;case 22:a=t.stateNode,l=t.alternate,null!==t.memoizedState?2&a._visibility?tc(e,t,n,s):rc(e,t):2&a._visibility?tc(e,t,n,s):(a._visibility|=2,sc(e,t,n,s,!!(10256&t.subtreeFlags)||!1)),2048&r&&Zo(l,t);break;case 24:tc(e,t,n,s),2048&r&&ec(t.alternate,t)}}function sc(e,t,n,s,r){for(r=r&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,l=t,i=n,o=s,c=l.flags;switch(l.tag){case 0:case 11:case 15:sc(a,l,i,o,r),bo(8,l);break;case 23:break;case 22:var d=l.stateNode;null!==l.memoizedState?2&d._visibility?sc(a,l,i,o,r):rc(a,l):(d._visibility|=2,sc(a,l,i,o,r)),r&&2048&c&&Zo(l.alternate,l);break;case 24:sc(a,l,i,o,r),r&&2048&c&&ec(l.alternate,l);break;default:sc(a,l,i,o,r)}t=t.sibling}}function rc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,s=t,r=s.flags;switch(s.tag){case 22:rc(n,s),2048&r&&Zo(s.alternate,s);break;case 24:rc(n,s),2048&r&&ec(s.alternate,s);break;default:rc(n,s)}t=t.sibling}}var ac=8192;function lc(e,t,n){if(e.subtreeFlags&ac)for(e=e.child;null!==e;)ic(e,t,n),e=e.sibling}function ic(e,t,n){switch(e.tag){case 26:lc(e,t,n),e.flags&ac&&null!==e.memoizedState&&function(e,t,n,s){if(!("stylesheet"!==n.type||"string"==typeof s.media&&!1===matchMedia(s.media).matches||4&n.state.loading)){if(null===n.instance){var r=Gu(s.href),a=t.querySelector(Ju(r));if(a)return null!==(t=a._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=om.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,void nt(a);a=t.ownerDocument||t,s=Ku(s),(r=qu.get(r))&&tm(s,r),nt(a=a.createElement("link"));var l=a;l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),pu(a,"link",s),n.instance=a}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=om.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Wo,e.memoizedState,e.memoizedProps);break;case 5:default:lc(e,t,n);break;case 3:case 4:var s=Wo;Wo=Hu(e.stateNode.containerInfo),lc(e,t,n),Wo=s;break;case 22:null===e.memoizedState&&(null!==(s=e.alternate)&&null!==s.memoizedState?(s=ac,ac=16777216,lc(e,t,n),ac=s):lc(e,t,n))}}function oc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n];To=s,mc(s,e)}oc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)dc(e),e=e.sibling}function dc(e){switch(e.tag){case 0:case 11:case 15:cc(e),2048&e.flags&&yo(9,e,e.return);break;case 3:case 12:default:cc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,uc(e)):cc(e)}}function uc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n];To=s,mc(s,e)}oc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:yo(8,t,t.return),uc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,uc(t));break;default:uc(t)}e=e.sibling}}function mc(e,t){for(;null!==To;){var n=To;switch(n.tag){case 0:case 11:case 15:yo(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var s=n.memoizedState.cachePool.pool;null!=s&&s.refCount++}break;case 24:Br(n.memoizedState.cache)}if(null!==(s=n.child))s.return=n,To=s;else e:for(n=e;null!==To;){var r=(s=To).sibling,a=s.return;if(Oo(s),s===n){To=null;break e}if(null!==r){r.return=a,To=r;break e}To=a}}}var xc={getCacheForType:function(e){var t=Ar(Fr),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Ar(Fr).controller.signal}},pc="function"==typeof WeakMap?WeakMap:Map,hc=0,fc=null,gc=null,bc=0,yc=0,vc=null,jc=!1,Nc=!1,wc=!1,kc=0,Cc=0,Sc=0,Ec=0,Pc=0,$c=0,_c=0,Dc=null,Lc=null,Mc=!1,Ac=0,Tc=0,Ic=1/0,Oc=null,zc=null,Rc=0,Fc=null,qc=null,Bc=0,Hc=0,Uc=null,Vc=null,Wc=0,Qc=null;function Gc(){return 2&hc&&0!==bc?bc&-bc:null!==I.T?Ud():Fe()}function Jc(){if(0===$c)if(536870912&bc&&!xr)$c=536870912;else{var e=Se;!(3932160&(Se<<=1))&&(Se=262144),$c=e}return null!==(e=Aa.current)&&(e.flags|=32),$c}function Kc(e,t,n){(e!==fc||2!==yc&&9!==yc)&&null===e.cancelPendingCommit||(sd(e,0),ed(e,bc,$c,!1)),Ae(e,n),2&hc&&e===fc||(e===fc&&(!(2&hc)&&(Ec|=n),4===Cc&&ed(e,bc,$c,!1)),Od(e))}function Yc(e,t,n){if(6&hc)throw Error(s(327));for(var r=!n&&!(127&t)&&0===(t&e.expiredLanes)||_e(e,t),a=r?function(e,t){var n=hc;hc|=2;var r=ld(),a=id();fc!==e||bc!==t?(Oc=null,Ic=de()+500,sd(e,t)):Nc=_e(e,t);e:for(;;)try{if(0!==yc&&null!==gc){t=gc;var l=vc;t:switch(yc){case 1:yc=0,vc=null,pd(e,t,l,1);break;case 2:case 9:if(sa(l)){yc=0,vc=null,xd(t);break}t=function(){2!==yc&&9!==yc||fc!==e||(yc=7),Od(e)},l.then(t,t);break e;case 3:yc=7;break e;case 4:yc=5;break e;case 7:sa(l)?(yc=0,vc=null,xd(t)):(yc=0,vc=null,pd(e,t,l,7));break;case 5:var i=null;switch(gc.tag){case 26:i=gc.memoizedState;case 5:case 27:var o=gc;if(i?lm(i):o.stateNode.complete){yc=0,vc=null;var c=o.sibling;if(null!==c)gc=c;else{var d=o.return;null!==d?(gc=d,hd(d)):gc=null}break t}}yc=0,vc=null,pd(e,t,l,5);break;case 6:yc=0,vc=null,pd(e,t,l,6);break;case 8:nd(),Cc=6;break e;default:throw Error(s(462))}}ud();break}catch(u){rd(e,u)}return Sr=Cr=null,I.H=r,I.A=a,hc=n,null!==gc?0:(fc=null,bc=0,Ls(),Cc)}(e,t):cd(e,t,!0),l=r;;){if(0===a){Nc&&!r&&ed(e,t,0,!1);break}if(n=e.current.alternate,!l||Zc(n)){if(2===a){if(l=t,e.errorRecoveryDisabledLanes&l)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){t=i;e:{var o=e;a=Dc;var c=o.current.memoizedState.isDehydrated;if(c&&(sd(o,i).flags|=256),2!==(i=cd(o,i,!1))){if(wc&&!c){o.errorRecoveryDisabledLanes|=l,Ec|=l,a=4;break e}l=Lc,Lc=a,null!==l&&(null===Lc?Lc=l:Lc.push.apply(Lc,l))}a=i}if(l=!1,2!==a)continue}}if(1===a){sd(e,0),ed(e,t,0,!0);break}e:{switch(r=e,l=a){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:ed(r,t,$c,!jc);break e;case 2:Lc=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(a=Ac+300-de())){if(ed(r,t,$c,!jc),0!==$e(r,0,!0))break e;Bc=t,r.timeoutHandle=wu(Xc.bind(null,r,n,Lc,Oc,Mc,t,$c,Ec,_c,jc,l,"Throttled",-0,0),a)}else Xc(r,n,Lc,Oc,Mc,t,$c,Ec,_c,jc,l,null,-0,0)}break}a=cd(e,t,!1),l=!1}Od(e)}function Xc(e,t,n,s,r,a,l,i,o,c,d,u,m,x){if(e.timeoutHandle=-1,8192&(u=t.subtreeFlags)||!(16785408&~u)){ic(t,a,u={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:At});var p=(62914560&a)===a?Ac-de():(4194048&a)===a?Tc-de():0;if(null!==(p=function(e,t){return e.stylesheets&&0===e.count&&dm(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var s=setTimeout(function(){if(e.stylesheets&&dm(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===im&&(im=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),s=0;s<n.length;s++){var r=n[s],a=r.transferSize,l=r.initiatorType,i=r.duration;if(a&&i&&hu(l)){for(l=0,i=r.responseEnd,s+=1;s<n.length;s++){var o=n[s],c=o.startTime;if(c>i)break;var d=o.transferSize,u=o.initiatorType;d&&hu(u)&&(l+=d*((o=o.responseEnd)<i?1:(i-c)/(o-c)))}if(--s,t+=8*(a+l)/(r.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var r=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&dm(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>im?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(r)}}:null}(u,p)))return Bc=a,e.cancelPendingCommit=p(gd.bind(null,e,t,a,n,s,r,l,i,o,d,u,null,m,x)),void ed(e,a,l,!c)}gd(e,t,a,n,s,r,l,i,o)}function Zc(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var s=0;s<n.length;s++){var r=n[s],a=r.getSnapshot;r=r.value;try{if(!es(a(),r))return!1}catch(l){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ed(e,t,n,s){t&=~Pc,t&=~Ec,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var r=t;0<r;){var a=31-Ne(r),l=1<<a;s[a]=-1,r&=~l}0!==n&&Te(e,n,t)}function td(){return!!(6&hc)||(zd(0),!1)}function nd(){if(null!==gc){if(0===yc)var e=gc.return;else Sr=Cr=null,ol(e=gc),ca=null,da=0,e=gc;for(;null!==e;)go(e.alternate,e),e=e.return;gc=null}}function sd(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,ku(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Bc=0,nd(),fc=e,gc=n=Bs(e.current,null),bc=t,yc=0,vc=null,jc=!1,Nc=_e(e,t),wc=!1,_c=$c=Pc=Ec=Sc=Cc=0,Lc=Dc=null,Mc=!1,8&t&&(t|=32&t);var s=e.entangledLanes;if(0!==s)for(e=e.entanglements,s&=t;0<s;){var r=31-Ne(s),a=1<<r;t|=e[r],s&=~a}return kc=t,Ls(),n}function rd(e,t){Ua=null,I.H=fi,t===Zr||t===ta?(t=ia(),yc=3):t===ea?(t=ia(),yc=4):yc=t===Mi?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,vc=t,null===gc&&(Cc=1,Pi(e,Ks(t,e.current)))}function ad(){var e=Aa.current;return null===e||((4194048&bc)===bc?null===Ta:!!((62914560&bc)===bc||536870912&bc)&&e===Ta)}function ld(){var e=I.H;return I.H=fi,null===e?fi:e}function id(){var e=I.A;return I.A=xc,e}function od(){Cc=4,jc||(4194048&bc)!==bc&&null!==Aa.current||(Nc=!0),!(134217727&Sc)&&!(134217727&Ec)||null===fc||ed(fc,bc,$c,!1)}function cd(e,t,n){var s=hc;hc|=2;var r=ld(),a=id();fc===e&&bc===t||(Oc=null,sd(e,t)),t=!1;var l=Cc;e:for(;;)try{if(0!==yc&&null!==gc){var i=gc,o=vc;switch(yc){case 8:nd(),l=6;break e;case 3:case 2:case 9:case 6:null===Aa.current&&(t=!0);var c=yc;if(yc=0,vc=null,pd(e,i,o,c),n&&Nc){l=0;break e}break;default:c=yc,yc=0,vc=null,pd(e,i,o,c)}}dd(),l=Cc;break}catch(d){rd(e,d)}return t&&e.shellSuspendCounter++,Sr=Cr=null,hc=s,I.H=r,I.A=a,null===gc&&(fc=null,bc=0,Ls()),l}function dd(){for(;null!==gc;)md(gc)}function ud(){for(;null!==gc&&!oe();)md(gc)}function md(e){var t=io(e.alternate,e,kc);e.memoizedProps=e.pendingProps,null===t?hd(e):gc=t}function xd(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Wi(n,t,t.pendingProps,t.type,void 0,bc);break;case 11:t=Wi(n,t,t.pendingProps,t.type.render,t.ref,bc);break;case 5:ol(t);default:go(n,t),t=io(n,t=gc=Hs(t,kc),kc)}e.memoizedProps=e.pendingProps,null===t?hd(e):gc=t}function pd(e,t,n,r){Sr=Cr=null,ol(t),ca=null,da=0;var a=t.return;try{if(function(e,t,n,r,a){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&Dr(t,n,a,!0),null!==(n=Aa.current)){switch(n.tag){case 31:case 13:return null===Ta?od():null===n.alternate&&0===Cc&&(Cc=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===na?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Sd(e,r,a)),!1;case 22:return n.flags|=65536,r===na?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Sd(e,r,a)),!1}throw Error(s(435,n.tag))}return Sd(e,r,a),od(),!1}if(xr)return null!==(t=Aa.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,r!==fr&&wr(Ks(e=Error(s(422),{cause:r}),n))):(r!==fr&&wr(Ks(t=Error(s(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,r=Ks(r,n),wa(e,a=_i(e.stateNode,r,a)),4!==Cc&&(Cc=2)),!1;var l=Error(s(520),{cause:r});if(l=Ks(l,n),null===Dc?Dc=[l]:Dc.push(l),4!==Cc&&(Cc=2),null===t)return!0;r=Ks(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,wa(n,e=_i(n.stateNode,r,e)),!1;case 1:if(t=n.type,l=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===l||"function"!=typeof l.componentDidCatch||null!==zc&&zc.has(l))))return n.flags|=65536,a&=-a,n.lanes|=a,Li(a=Di(a),e,n,r),wa(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,bc))return Cc=1,Pi(e,Ks(n,e.current)),void(gc=null)}catch(l){if(null!==a)throw gc=a,l;return Cc=1,Pi(e,Ks(n,e.current)),void(gc=null)}32768&t.flags?(xr||1===r?e=!0:Nc||536870912&bc?e=!1:(jc=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=Aa.current)&&13===r.tag&&(r.flags|=16384))),fd(t,e)):hd(t)}function hd(e){var t=e;do{if(32768&t.flags)return void fd(t,jc);e=t.return;var n=ho(t.alternate,t,kc);if(null!==n)return void(gc=n);if(null!==(t=t.sibling))return void(gc=t);gc=t=e}while(null!==t);0===Cc&&(Cc=5)}function fd(e,t){do{var n=fo(e.alternate,e);if(null!==n)return n.flags&=32767,void(gc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(gc=e);gc=e=n}while(null!==e);Cc=6,gc=null}function gd(e,t,n,r,a,l,i,o,c){e.cancelPendingCommit=null;do{Nd()}while(0!==Rc);if(6&hc)throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(l=t.lanes|t.childLanes,function(e,t,n,s,r,a){var l=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,o=e.expirationTimes,c=e.hiddenUpdates;for(n=l&~n;0<n;){var d=31-Ne(n),u=1<<d;i[d]=0,o[d]=-1;var m=c[d];if(null!==m)for(c[d]=null,d=0;d<m.length;d++){var x=m[d];null!==x&&(x.lane&=-536870913)}n&=~u}0!==s&&Te(e,s,0),0!==a&&0===r&&0!==e.tag&&(e.suspendedLanes|=a&~(l&~t))}(e,n,l|=Ds,i,o,c),e===fc&&(gc=fc=null,bc=0),qc=t,Fc=e,Bc=n,Hc=l,Uc=a,Vc=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,le(pe,function(){return wd(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=I.T,I.T=null,a=O.p,O.p=2,i=hc,hc|=4;try{!function(e,t){if(e=e.containerInfo,fu=jm,ls(e=as(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,l=r.focusNode;r=r.focusOffset;try{n.nodeType,l.nodeType}catch(f){n=null;break e}var i=0,o=-1,c=-1,d=0,u=0,m=e,x=null;t:for(;;){for(var p;m!==n||0!==a&&3!==m.nodeType||(o=i+a),m!==l||0!==r&&3!==m.nodeType||(c=i+r),3===m.nodeType&&(i+=m.nodeValue.length),null!==(p=m.firstChild);)x=m,m=p;for(;;){if(m===e)break t;if(x===n&&++d===a&&(o=i),x===l&&++u===r&&(c=i),null!==(p=m.nextSibling))break;x=(m=x).parentNode}m=p}n=-1===o||-1===c?null:{start:o,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(gu={focusedElem:e,selectionRange:n},jm=!1,To=t;null!==To;)if(e=(t=To).child,1028&t.subtreeFlags&&null!==e)e.return=t,To=e;else for(;null!==To;){switch(l=(t=To).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(a=e[n]).ref.impl=a.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==l){e=void 0,n=t,a=l.memoizedProps,l=l.memoizedState,r=n.stateNode;try{var h=ki(n.type,a);e=r.getSnapshotBeforeUpdate(h,l),r.__reactInternalSnapshotBeforeUpdate=e}catch(g){Cd(n,n.return,g)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Du(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Du(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,To=e;break}To=t.return}}(e,t)}finally{hc=i,O.p=a,I.T=r}}Rc=1,bd(),yd(),vd()}}function bd(){if(1===Rc){Rc=0;var e=Fc,t=qc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=I.T,I.T=null;var s=O.p;O.p=2;var r=hc;hc|=4;try{Qo(t,e);var a=gu,l=as(e.containerInfo),i=a.focusedElem,o=a.selectionRange;if(l!==i&&i&&i.ownerDocument&&rs(i.ownerDocument.documentElement,i)){if(null!==o&&ls(i)){var c=o.start,d=o.end;if(void 0===d&&(d=c),"selectionStart"in i)i.selectionStart=c,i.selectionEnd=Math.min(d,i.value.length);else{var u=i.ownerDocument||document,m=u&&u.defaultView||window;if(m.getSelection){var x=m.getSelection(),p=i.textContent.length,h=Math.min(o.start,p),f=void 0===o.end?h:Math.min(o.end,p);!x.extend&&h>f&&(l=f,f=h,h=l);var g=ss(i,h),b=ss(i,f);if(g&&b&&(1!==x.rangeCount||x.anchorNode!==g.node||x.anchorOffset!==g.offset||x.focusNode!==b.node||x.focusOffset!==b.offset)){var y=u.createRange();y.setStart(g.node,g.offset),x.removeAllRanges(),h>f?(x.addRange(y),x.extend(b.node,b.offset)):(y.setEnd(b.node,b.offset),x.addRange(y))}}}}for(u=[],x=i;x=x.parentNode;)1===x.nodeType&&u.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<u.length;i++){var v=u[i];v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}jm=!!fu,gu=fu=null}finally{hc=r,O.p=s,I.T=n}}e.current=t,Rc=2}}function yd(){if(2===Rc){Rc=0;var e=Fc,t=qc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=I.T,I.T=null;var s=O.p;O.p=2;var r=hc;hc|=4;try{Io(e,t.alternate,t)}finally{hc=r,O.p=s,I.T=n}}Rc=3}}function vd(){if(4===Rc||3===Rc){Rc=0,ce();var e=Fc,t=qc,n=Bc,s=Vc;10256&t.subtreeFlags||10256&t.flags?Rc=5:(Rc=0,qc=Fc=null,jd(e,e.pendingLanes));var r=e.pendingLanes;if(0===r&&(zc=null),Re(n),t=t.stateNode,ve&&"function"==typeof ve.onCommitFiberRoot)try{ve.onCommitFiberRoot(ye,t,void 0,!(128&~t.current.flags))}catch(o){}if(null!==s){t=I.T,r=O.p,O.p=2,I.T=null;try{for(var a=e.onRecoverableError,l=0;l<s.length;l++){var i=s[l];a(i.value,{componentStack:i.stack})}}finally{I.T=t,O.p=r}}3&Bc&&Nd(),Od(e),r=e.pendingLanes,261930&n&&42&r?e===Qc?Wc++:(Wc=0,Qc=e):Wc=0,zd(0)}}function jd(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Br(t)))}function Nd(){return bd(),yd(),vd(),wd()}function wd(){if(5!==Rc)return!1;var e=Fc,t=Hc;Hc=0;var n=Re(Bc),r=I.T,a=O.p;try{O.p=32>n?32:n,I.T=null,n=Uc,Uc=null;var l=Fc,i=Bc;if(Rc=0,qc=Fc=null,Bc=0,6&hc)throw Error(s(331));var o=hc;if(hc|=4,dc(l.current),nc(l,l.current,i,n),hc=o,zd(0,!1),ve&&"function"==typeof ve.onPostCommitFiberRoot)try{ve.onPostCommitFiberRoot(ye,l)}catch(c){}return!0}finally{O.p=a,I.T=r,jd(e,t)}}function kd(e,t,n){t=Ks(n,t),null!==(e=ja(e,t=_i(e.stateNode,t,2),2))&&(Ae(e,2),Od(e))}function Cd(e,t,n){if(3===e.tag)kd(e,e,n);else for(;null!==t;){if(3===t.tag){kd(t,e,n);break}if(1===t.tag){var s=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&(null===zc||!zc.has(s))){e=Ks(n,e),null!==(s=ja(t,n=Di(2),2))&&(Li(n,s,t,e),Ae(s,2),Od(s));break}}t=t.return}}function Sd(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new pc;var r=new Set;s.set(t,r)}else void 0===(r=s.get(t))&&(r=new Set,s.set(t,r));r.has(n)||(wc=!0,r.add(n),e=Ed.bind(null,e,t,n),t.then(e,e))}function Ed(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,fc===e&&(bc&n)===n&&(4===Cc||3===Cc&&(62914560&bc)===bc&&300>de()-Ac?!(2&hc)&&sd(e,0):Pc|=n,_c===bc&&(_c=0)),Od(e)}function Pd(e,t){0===t&&(t=Le()),null!==(e=Ts(e,t))&&(Ae(e,t),Od(e))}function $d(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Pd(e,n)}function _d(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==r&&r.delete(t),Pd(e,n)}var Dd=null,Ld=null,Md=!1,Ad=!1,Td=!1,Id=0;function Od(e){e!==Ld&&null===e.next&&(null===Ld?Dd=Ld=e:Ld=Ld.next=e),Ad=!0,Md||(Md=!0,Su(function(){6&hc?le(me,Rd):Fd()}))}function zd(e,t){if(!Td&&Ad){Td=!0;do{for(var n=!1,s=Dd;null!==s;){if(0!==e){var r=s.pendingLanes;if(0===r)var a=0;else{var l=s.suspendedLanes,i=s.pingedLanes;a=(1<<31-Ne(42|e)+1)-1,a=201326741&(a&=r&~(l&~i))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,Hd(s,a))}else a=bc,!(3&(a=$e(s,s===fc?a:0,null!==s.cancelPendingCommit||-1!==s.timeoutHandle)))||_e(s,a)||(n=!0,Hd(s,a));s=s.next}}while(n);Td=!1}}function Rd(){Fd()}function Fd(){Ad=Md=!1;var e=0;0!==Id&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==Nu&&(Nu=e,!0);return Nu=null,!1}()&&(e=Id);for(var t=de(),n=null,s=Dd;null!==s;){var r=s.next,a=qd(s,t);0===a?(s.next=null,null===n?Dd=r:n.next=r,null===r&&(Ld=n)):(n=s,(0!==e||3&a)&&(Ad=!0)),s=r}0!==Rc&&5!==Rc||zd(e),0!==Id&&(Id=0)}function qd(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var l=31-Ne(a),i=1<<l,o=r[l];-1===o?0!==(i&n)&&0===(i&s)||(r[l]=De(i,t)):o<=t&&(e.expiredLanes|=i),a&=~i}if(n=bc,n=$e(e,e===(t=fc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),s=e.callbackNode,0===n||e===t&&(2===yc||9===yc)||null!==e.cancelPendingCommit)return null!==s&&null!==s&&ie(s),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||_e(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==s&&ie(s),Re(n)){case 2:case 8:n=xe;break;case 32:default:n=pe;break;case 268435456:n=fe}return s=Bd.bind(null,e),n=le(n,s),e.callbackPriority=t,e.callbackNode=n,t}return null!==s&&null!==s&&ie(s),e.callbackPriority=2,e.callbackNode=null,2}function Bd(e,t){if(0!==Rc&&5!==Rc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Nd()&&e.callbackNode!==n)return null;var s=bc;return 0===(s=$e(e,e===fc?s:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Yc(e,s,t),qd(e,de()),null!=e.callbackNode&&e.callbackNode===n?Bd.bind(null,e):null)}function Hd(e,t){if(Nd())return null;Yc(e,t,!0)}function Ud(){if(0===Id){var e=Vr;0===e&&(e=Ce,!(261888&(Ce<<=1))&&(Ce=256)),Id=e}return Id}function Vd(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Mt(""+e)}function Wd(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Qd=0;Qd<Ss.length;Qd++){var Gd=Ss[Qd];Es(Gd.toLowerCase(),"on"+(Gd[0].toUpperCase()+Gd.slice(1)))}Es(bs,"onAnimationEnd"),Es(ys,"onAnimationIteration"),Es(vs,"onAnimationStart"),Es("dblclick","onDoubleClick"),Es("focusin","onFocus"),Es("focusout","onBlur"),Es(js,"onTransitionRun"),Es(Ns,"onTransitionStart"),Es(ws,"onTransitionCancel"),Es(ks,"onTransitionEnd"),lt("onMouseEnter",["mouseout","mouseover"]),lt("onMouseLeave",["mouseout","mouseover"]),lt("onPointerEnter",["pointerout","pointerover"]),lt("onPointerLeave",["pointerout","pointerover"]),at("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),at("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),at("onBeforeInput",["compositionend","keypress","textInput","paste"]),at("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jd));function Yd(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var a=void 0;if(t)for(var l=s.length-1;0<=l;l--){var i=s[l],o=i.instance,c=i.currentTarget;if(i=i.listener,o!==a&&r.isPropagationStopped())break e;a=i,r.currentTarget=c;try{a(r)}catch(d){Ps(d)}r.currentTarget=null,a=o}else for(l=0;l<s.length;l++){if(o=(i=s[l]).instance,c=i.currentTarget,i=i.listener,o!==a&&r.isPropagationStopped())break e;a=i,r.currentTarget=c;try{a(r)}catch(d){Ps(d)}r.currentTarget=null,a=o}}}}function Xd(e,t){var n=t[We];void 0===n&&(n=t[We]=new Set);var s=e+"__bubble";n.has(s)||(nu(t,e,2,!1),n.add(s))}function Zd(e,t,n){var s=0;t&&(s|=4),nu(n,e,s,t)}var eu="_reactListening"+Math.random().toString(36).slice(2);function tu(e){if(!e[eu]){e[eu]=!0,st.forEach(function(t){"selectionchange"!==t&&(Kd.has(t)||Zd(t,!1,e),Zd(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[eu]||(t[eu]=!0,Zd("selectionchange",!1,t))}}function nu(e,t,n,s){switch(Pm(t)){case 2:var r=Nm;break;case 8:r=wm;break;default:r=km}n=r.bind(null,t,n,e),r=void 0,!Ut||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),s?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function su(e,t,n,s,r){var l=s;if(!(1&t||2&t||null===s))e:for(;;){if(null===s)return;var i=s.tag;if(3===i||4===i){var o=s.stateNode.containerInfo;if(o===r)break;if(4===i)for(i=s.return;null!==i;){var c=i.tag;if((3===c||4===c)&&i.stateNode.containerInfo===r)return;i=i.return}for(;null!==o;){if(null===(i=Xe(o)))return;if(5===(c=i.tag)||6===c||26===c||27===c){s=l=i;continue e}o=o.parentNode}}s=s.return}qt(function(){var s=l,r=It(n),i=[];e:{var o=Cs.get(e);if(void 0!==o){var c=rn,d=e;switch(e){case"keypress":if(0===Kt(n))break e;case"keydown":case"keyup":c=vn;break;case"focusin":d="focus",c=un;break;case"focusout":d="blur",c=un;break;case"beforeblur":case"afterblur":c=un;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=cn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=dn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Nn;break;case bs:case ys:case vs:c=mn;break;case ks:c=wn;break;case"scroll":case"scrollend":c=ln;break;case"wheel":c=kn;break;case"copy":case"cut":case"paste":c=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=jn;break;case"toggle":case"beforetoggle":c=Cn}var u=!!(4&t),m=!u&&("scroll"===e||"scrollend"===e),x=u?null!==o?o+"Capture":null:o;u=[];for(var p,h=s;null!==h;){var f=h;if(p=f.stateNode,5!==(f=f.tag)&&26!==f&&27!==f||null===p||null===x||null!=(f=Bt(h,x))&&u.push(ru(h,f,p)),m)break;h=h.return}0<u.length&&(o=new c(o,d,null,n,r),i.push({event:o,listeners:u}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Tt||!(d=n.relatedTarget||n.fromElement)||!Xe(d)&&!d[Ve])&&(c||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=s,null!==(d=(d=n.relatedTarget||n.toElement)?Xe(d):null)&&(m=a(d),u=d.tag,d!==m||5!==u&&27!==u&&6!==u)&&(d=null)):(c=null,d=s),c!==d)){if(u=cn,f="onMouseLeave",x="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(u=jn,f="onPointerLeave",x="onPointerEnter",h="pointer"),m=null==c?o:et(c),p=null==d?o:et(d),(o=new u(f,h+"leave",c,n,r)).target=m,o.relatedTarget=p,f=null,Xe(r)===s&&((u=new u(x,h+"enter",d,n,r)).target=p,u.relatedTarget=m,f=u),m=f,c&&d)e:{for(u=lu,h=d,p=0,f=x=c;f;f=u(f))p++;f=0;for(var g=h;g;g=u(g))f++;for(;0<p-f;)x=u(x),p--;for(;0<f-p;)h=u(h),f--;for(;p--;){if(x===h||null!==h&&x===h.alternate){u=x;break e}x=u(x),h=u(h)}u=null}else u=null;null!==c&&iu(i,o,c,u,!1),null!==d&&null!==m&&iu(i,m,d,u,!0)}if("select"===(c=(o=s?et(s):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var b=Hn;else if(On(o))if(Un)b=Zn;else{b=Yn;var y=Kn}else!(c=o.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?s&&_t(s.elementType)&&(b=Hn):b=Xn;switch(b&&(b=b(e,s))?zn(i,b,n,r):(y&&y(e,o,s),"focusout"===e&&s&&"number"===o.type&&null!=s.memoizedProps.value&&Nt(o,"number",o.value)),y=s?et(s):window,e){case"focusin":(On(y)||"true"===y.contentEditable)&&(os=y,cs=s,ds=null);break;case"focusout":ds=cs=os=null;break;case"mousedown":us=!0;break;case"contextmenu":case"mouseup":case"dragend":us=!1,ms(i,n,r);break;case"selectionchange":if(is)break;case"keydown":case"keyup":ms(i,n,r)}var v;if(En)e:{switch(e){case"compositionstart":var j="onCompositionStart";break e;case"compositionend":j="onCompositionEnd";break e;case"compositionupdate":j="onCompositionUpdate";break e}j=void 0}else Tn?Mn(e,n)&&(j="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(j="onCompositionStart");j&&(_n&&"ko"!==n.locale&&(Tn||"onCompositionStart"!==j?"onCompositionEnd"===j&&Tn&&(v=Jt()):(Qt="value"in(Wt=r)?Wt.value:Wt.textContent,Tn=!0)),0<(y=au(s,j)).length&&(j=new pn(j,e,null,n,r),i.push({event:j,listeners:y}),v?j.data=v:null!==(v=An(n))&&(j.data=v))),(v=$n?function(e,t){switch(e){case"compositionend":return An(t);case"keypress":return 32!==t.which?null:(Ln=!0,Dn);case"textInput":return(e=t.data)===Dn&&Ln?null:e;default:return null}}(e,n):function(e,t){if(Tn)return"compositionend"===e||!En&&Mn(e,t)?(e=Jt(),Gt=Qt=Wt=null,Tn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _n&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(j=au(s,"onBeforeInput")).length&&(y=new pn("onBeforeInput","beforeinput",null,n,r),i.push({event:y,listeners:j}),y.data=v)),function(e,t,n,s,r){if("submit"===t&&n&&n.stateNode===r){var a=Vd((r[Ue]||null).action),l=s.submitter;l&&null!==(t=(t=l[Ue]||null)?Vd(t.formAction):l.getAttribute("formAction"))&&(a=t,l=null);var i=new rn("action","action",null,s,r);e.push({event:i,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(0!==Id){var e=l?Wd(r,l):new FormData(r);ni(n,{pending:!0,data:e,method:r.method,action:a},null,e)}}else"function"==typeof a&&(i.preventDefault(),e=l?Wd(r,l):new FormData(r),ni(n,{pending:!0,data:e,method:r.method,action:a},a,e))},currentTarget:r}]})}}(i,e,s,n,r)}Yd(i,t)})}function ru(e,t,n){return{instance:e,listener:t,currentTarget:n}}function au(e,t){for(var n=t+"Capture",s=[];null!==e;){var r=e,a=r.stateNode;if(5!==(r=r.tag)&&26!==r&&27!==r||null===a||(null!=(r=Bt(e,n))&&s.unshift(ru(e,r,a)),null!=(r=Bt(e,t))&&s.push(ru(e,r,a))),3===e.tag)return s;e=e.return}return[]}function lu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function iu(e,t,n,s,r){for(var a=t._reactName,l=[];null!==n&&n!==s;){var i=n,o=i.alternate,c=i.stateNode;if(i=i.tag,null!==o&&o===s)break;5!==i&&26!==i&&27!==i||null===c||(o=c,r?null!=(c=Bt(n,a))&&l.unshift(ru(n,c,o)):r||null!=(c=Bt(n,a))&&l.push(ru(n,c,o))),n=n.return}0!==l.length&&e.push({event:t,listeners:l})}var ou=/\r\n?/g,cu=/\u0000|\uFFFD/g;function du(e){return("string"==typeof e?e:""+e).replace(ou,"\n").replace(cu,"")}function uu(e,t){return t=du(t),du(e)===t}function mu(e,t,n,r,a,l){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||St(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&St(e,""+r);break;case"className":ut(e,"class",r);break;case"tabIndex":ut(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":ut(e,n,r);break;case"style":$t(e,r,l);break;case"data":if("object"!==t){ut(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Mt(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof l&&("formAction"===n?("input"!==t&&mu(e,t,"name",a.name,a,null),mu(e,t,"formEncType",a.formEncType,a,null),mu(e,t,"formMethod",a.formMethod,a,null),mu(e,t,"formTarget",a.formTarget,a,null)):(mu(e,t,"encType",a.encType,a,null),mu(e,t,"method",a.method,a,null),mu(e,t,"target",a.target,a,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=Mt(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=At);break;case"onScroll":null!=r&&Xd("scroll",e);break;case"onScrollEnd":null!=r&&Xd("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=Mt(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Xd("beforetoggle",e),Xd("toggle",e),dt(e,"popover",r);break;case"xlinkActuate":mt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":mt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":mt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":mt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":mt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":mt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":mt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":mt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":mt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":dt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&dt(e,n=Dt.get(n)||n,r)}}function xu(e,t,n,r,a,l){switch(n){case"style":$t(e,r,l);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=a.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"==typeof r?St(e,r):("number"==typeof r||"bigint"==typeof r)&&St(e,""+r);break;case"onScroll":null!=r&&Xd("scroll",e);break;case"onScrollEnd":null!=r&&Xd("scrollend",e);break;case"onClick":null!=r&&(e.onclick=At);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:rt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"==typeof(l=null!=(l=e[Ue]||null)?l[n]:null)&&e.removeEventListener(t,l,a),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):dt(e,n,r):("function"!=typeof l&&null!==l&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,a)))}}function pu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xd("error",e),Xd("load",e);var r,a=!1,l=!1;for(r in n)if(n.hasOwnProperty(r)){var i=n[r];if(null!=i)switch(r){case"src":a=!0;break;case"srcSet":l=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:mu(e,t,r,i,n,null)}}return l&&mu(e,t,"srcSet",n.srcSet,n,null),void(a&&mu(e,t,"src",n.src,n,null));case"input":Xd("invalid",e);var o=r=i=l=null,c=null,d=null;for(a in n)if(n.hasOwnProperty(a)){var u=n[a];if(null!=u)switch(a){case"name":l=u;break;case"type":i=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":r=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(s(137,t));break;default:mu(e,t,a,u,n,null)}}return void jt(e,r,o,c,d,i,l,!1);case"select":for(l in Xd("invalid",e),a=i=r=null,n)if(n.hasOwnProperty(l)&&null!=(o=n[l]))switch(l){case"value":r=o;break;case"defaultValue":i=o;break;case"multiple":a=o;default:mu(e,t,l,o,n,null)}return t=r,n=i,e.multiple=!!a,void(null!=t?wt(e,!!a,t,!1):null!=n&&wt(e,!!a,n,!0));case"textarea":for(i in Xd("invalid",e),r=l=a=null,n)if(n.hasOwnProperty(i)&&null!=(o=n[i]))switch(i){case"value":a=o;break;case"defaultValue":l=o;break;case"children":r=o;break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(s(91));break;default:mu(e,t,i,o,n,null)}return void Ct(e,a,l,r);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(a=n[c]))if("selected"===c)e.selected=a&&"function"!=typeof a&&"symbol"!=typeof a;else mu(e,t,c,a,n,null);return;case"dialog":Xd("beforetoggle",e),Xd("toggle",e),Xd("cancel",e),Xd("close",e);break;case"iframe":case"object":Xd("load",e);break;case"video":case"audio":for(a=0;a<Jd.length;a++)Xd(Jd[a],e);break;case"image":Xd("error",e),Xd("load",e);break;case"details":Xd("toggle",e);break;case"embed":case"source":case"link":Xd("error",e),Xd("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(a=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:mu(e,t,d,a,n,null)}return;default:if(_t(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(a=n[u])&&xu(e,t,u,a,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(null!=(a=n[o])&&mu(e,t,o,a,n,null))}function hu(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var fu=null,gu=null;function bu(e){return 9===e.nodeType?e:e.ownerDocument}function yu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vu(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function ju(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Nu=null;var wu="function"==typeof setTimeout?setTimeout:void 0,ku="function"==typeof clearTimeout?clearTimeout:void 0,Cu="function"==typeof Promise?Promise:void 0,Su="function"==typeof queueMicrotask?queueMicrotask:void 0!==Cu?function(e){return Cu.resolve(null).then(e).catch(Eu)}:wu;function Eu(e){setTimeout(function(){throw e})}function Pu(e){return"head"===e}function $u(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)||"/&"===n){if(0===s)return e.removeChild(r),void Wm(t);s--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)s++;else if("html"===n)Fu(e.ownerDocument.documentElement);else if("head"===n){Fu(n=e.ownerDocument.head);for(var a=n.firstChild;a;){var l=a.nextSibling,i=a.nodeName;a[Ke]||"SCRIPT"===i||"STYLE"===i||"LINK"===i&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=l}}else"body"===n&&Fu(e.ownerDocument.body);n=r}while(n);Wm(t)}function _u(e,t){var n=e;e=0;do{var s=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=s}while(n)}function Du(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Du(n),Ye(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Lu(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Tu(e.nextSibling)))return null}return e}function Mu(e){return"$?"===e.data||"$~"===e.data}function Au(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Tu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Iu=null;function Ou(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Tu(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function zu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Ru(e,t,n){switch(t=bu(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function Fu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ye(e)}var qu=new Map,Bu=new Set;function Hu(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Uu=O.d;O.d={f:function(){var e=Uu.f(),t=td();return e||t},r:function(e){var t=Ze(e);null!==t&&5===t.tag&&"form"===t.type?ri(t):Uu.r(e)},D:function(e){Uu.D(e),Wu("dns-prefetch",e,null)},C:function(e,t){Uu.C(e,t),Wu("preconnect",e,t)},L:function(e,t,n){Uu.L(e,t,n);var s=Vu;if(s&&e&&t){var r='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+yt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(r+='[imagesizes="'+yt(n.imageSizes)+'"]')):r+='[href="'+yt(e)+'"]';var a=r;switch(t){case"style":a=Gu(e);break;case"script":a=Yu(e)}qu.has(a)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),qu.set(a,e),null!==s.querySelector(r)||"style"===t&&s.querySelector(Ju(a))||"script"===t&&s.querySelector(Xu(a))||(pu(t=s.createElement("link"),"link",e),nt(t),s.head.appendChild(t)))}},m:function(e,t){Uu.m(e,t);var n=Vu;if(n&&e){var s=t&&"string"==typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+yt(s)+'"][href="'+yt(e)+'"]',a=r;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Yu(e)}if(!qu.has(a)&&(e=d({rel:"modulepreload",href:e},t),qu.set(a,e),null===n.querySelector(r))){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Xu(a)))return}pu(s=n.createElement("link"),"link",e),nt(s),n.head.appendChild(s)}}},X:function(e,t){Uu.X(e,t);var n=Vu;if(n&&e){var s=tt(n).hoistableScripts,r=Yu(e),a=s.get(r);a||((a=n.querySelector(Xu(r)))||(e=d({src:e,async:!0},t),(t=qu.get(r))&&nm(e,t),nt(a=n.createElement("script")),pu(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},s.set(r,a))}},S:function(e,t,n){Uu.S(e,t,n);var s=Vu;if(s&&e){var r=tt(s).hoistableStyles,a=Gu(e);t=t||"default";var l=r.get(a);if(!l){var i={loading:0,preload:null};if(l=s.querySelector(Ju(a)))i.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=qu.get(a))&&tm(e,n);var o=l=s.createElement("link");nt(o),pu(o,"link",e),o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),o.addEventListener("load",function(){i.loading|=1}),o.addEventListener("error",function(){i.loading|=2}),i.loading|=4,em(l,t,s)}l={type:"stylesheet",instance:l,count:1,state:i},r.set(a,l)}}},M:function(e,t){Uu.M(e,t);var n=Vu;if(n&&e){var s=tt(n).hoistableScripts,r=Yu(e),a=s.get(r);a||((a=n.querySelector(Xu(r)))||(e=d({src:e,async:!0,type:"module"},t),(t=qu.get(r))&&nm(e,t),nt(a=n.createElement("script")),pu(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},s.set(r,a))}}};var Vu="undefined"==typeof document?null:document;function Wu(e,t,n){var s=Vu;if(s&&"string"==typeof t&&t){var r=yt(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"==typeof n&&(r+='[crossorigin="'+n+'"]'),Bu.has(r)||(Bu.add(r),e={rel:e,crossOrigin:n,href:t},null===s.querySelector(r)&&(pu(t=s.createElement("link"),"link",e),nt(t),s.head.appendChild(t)))}}function Qu(e,t,n,r){var a,l,i,o,c=(c=G.current)?Hu(c):null;if(!c)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Gu(n.href),(r=(n=tt(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Gu(n.href);var d=tt(c).hoistableStyles,u=d.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=c.querySelector(Ju(e)))&&!d._p&&(u.instance=d,u.state.loading=5),qu.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},qu.set(e,n),d||(a=c,l=e,i=n,o=u.state,a.querySelector('link[rel="preload"][as="style"]['+l+"]")?o.loading=1:(l=a.createElement("link"),o.preload=l,l.addEventListener("load",function(){return o.loading|=1}),l.addEventListener("error",function(){return o.loading|=2}),pu(l,"link",i),nt(l),a.head.appendChild(l))))),t&&null===r)throw Error(s(528,""));return u}if(t&&null!==r)throw Error(s(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Yu(n),(r=(n=tt(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Gu(e){return'href="'+yt(e)+'"'}function Ju(e){return'link[rel="stylesheet"]['+e+"]"}function Ku(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Yu(e){return'[src="'+yt(e)+'"]'}function Xu(e){return"script[async]"+e}function Zu(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+yt(n.href)+'"]');if(r)return t.instance=r,nt(r),r;var a=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return nt(r=(e.ownerDocument||e).createElement("style")),pu(r,"style",a),em(r,n.precedence,e),t.instance=r;case"stylesheet":a=Gu(n.href);var l=e.querySelector(Ju(a));if(l)return t.state.loading|=4,t.instance=l,nt(l),l;r=Ku(n),(a=qu.get(a))&&tm(r,a),nt(l=(e.ownerDocument||e).createElement("link"));var i=l;return i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),pu(l,"link",r),t.state.loading|=4,em(l,n.precedence,e),t.instance=l;case"script":return l=Yu(n.src),(a=e.querySelector(Xu(l)))?(t.instance=a,nt(a),a):(r=n,(a=qu.get(l))&&nm(r=d({},n),a),nt(a=(e=e.ownerDocument||e).createElement("script")),pu(a,"link",r),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,em(r,n.precedence,e));return t.instance}function em(e,t,n){for(var s=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=s.length?s[s.length-1]:null,a=r,l=0;l<s.length;l++){var i=s[l];if(i.dataset.precedence===t)a=i;else if(a!==r)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function tm(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function nm(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var sm=null;function rm(e,t,n){if(null===sm){var s=new Map,r=sm=new Map;r.set(n,s)}else(s=(r=sm).get(n))||(s=new Map,r.set(n,s));if(s.has(e))return s;for(s.set(e,null),n=n.getElementsByTagName(e),r=0;r<n.length;r++){var a=n[r];if(!(a[Ke]||a[He]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var l=a.getAttribute(t)||"";l=e+l;var i=s.get(l);i?i.push(a):s.set(l,[a])}}return s}function am(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function lm(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var im=0;function om(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)dm(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var cm=null;function dm(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cm=new Map,t.forEach(um,e),cm=null,om.call(e))}function um(e,t){if(!(4&t.state.loading)){var n=cm.get(e);if(n)var s=n.get(null);else{n=new Map,cm.set(e,n);for(var r=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<r.length;a++){var l=r[a];"LINK"!==l.nodeName&&"not all"===l.getAttribute("media")||(n.set(l.dataset.precedence,l),s=l)}s&&n.set(null,s)}l=(r=t.instance).getAttribute("data-precedence"),(a=n.get(l)||s)===s&&n.set(null,r),n.set(l,r),this.count++,s=om.bind(this),r.addEventListener("load",s),r.addEventListener("error",s),a?a.parentNode.insertBefore(r,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(r,e.firstChild),t.state.loading|=4}}var mm={$$typeof:v,Provider:null,Consumer:null,_currentValue:z,_currentValue2:z,_threadCount:0};function xm(e,t,n,s,r,a,l,i,o){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Me(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Me(0),this.hiddenUpdates=Me(null),this.identifierPrefix=s,this.onUncaughtError=r,this.onCaughtError=a,this.onRecoverableError=l,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function pm(e,t,n,s,r,a,l,i,o,c,d,u){return e=new xm(e,t,n,l,o,c,d,u,i),t=1,!0===a&&(t|=24),a=Fs(3,null,null,t),e.current=a,a.stateNode=e,(t=qr()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:s,isDehydrated:n,cache:t},ba(a),e}function hm(e){return e?e=zs:zs}function fm(e,t,n,s,r,a){r=hm(r),null===s.context?s.context=r:s.pendingContext=r,(s=va(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(s.callback=a),null!==(n=ja(e,s,t))&&(Kc(n,0,t),Na(n,e,t))}function gm(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function bm(e,t){gm(e,t),(e=e.alternate)&&gm(e,t)}function ym(e){if(13===e.tag||31===e.tag){var t=Ts(e,67108864);null!==t&&Kc(t,0,67108864),bm(e,67108864)}}function vm(e){if(13===e.tag||31===e.tag){var t=Gc(),n=Ts(e,t=ze(t));null!==n&&Kc(n,0,t),bm(e,t)}}var jm=!0;function Nm(e,t,n,s){var r=I.T;I.T=null;var a=O.p;try{O.p=2,km(e,t,n,s)}finally{O.p=a,I.T=r}}function wm(e,t,n,s){var r=I.T;I.T=null;var a=O.p;try{O.p=8,km(e,t,n,s)}finally{O.p=a,I.T=r}}function km(e,t,n,s){if(jm){var r=Cm(s);if(null===r)su(e,t,s,Sm,n),Om(e,s);else if(function(e,t,n,s,r){switch(t){case"focusin":return _m=zm(_m,e,t,n,s,r),!0;case"dragenter":return Dm=zm(Dm,e,t,n,s,r),!0;case"mouseover":return Lm=zm(Lm,e,t,n,s,r),!0;case"pointerover":var a=r.pointerId;return Mm.set(a,zm(Mm.get(a)||null,e,t,n,s,r)),!0;case"gotpointercapture":return a=r.pointerId,Am.set(a,zm(Am.get(a)||null,e,t,n,s,r)),!0}return!1}(r,e,t,n,s))s.stopPropagation();else if(Om(e,s),4&t&&-1<Im.indexOf(e)){for(;null!==r;){var a=Ze(r);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var l=Pe(a.pendingLanes);if(0!==l){var i=a;for(i.pendingLanes|=2,i.entangledLanes|=2;l;){var o=1<<31-Ne(l);i.entanglements[1]|=o,l&=~o}Od(a),!(6&hc)&&(Ic=de()+500,zd(0))}}break;case 31:case 13:null!==(i=Ts(a,2))&&Kc(i,0,2),td(),bm(a,2)}if(null===(a=Cm(s))&&su(e,t,s,Sm,n),a===r)break;r=a}null!==r&&s.stopPropagation()}else su(e,t,s,null,n)}}function Cm(e){return Em(e=It(e))}var Sm=null;function Em(e){if(Sm=null,null!==(e=Xe(e))){var t=a(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(31===n){if(null!==(e=i(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Sm=e,null}function Pm(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ue()){case me:return 2;case xe:return 8;case pe:case he:return 32;case fe:return 268435456;default:return 32}default:return 32}}var $m=!1,_m=null,Dm=null,Lm=null,Mm=new Map,Am=new Map,Tm=[],Im="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Om(e,t){switch(e){case"focusin":case"focusout":_m=null;break;case"dragenter":case"dragleave":Dm=null;break;case"mouseover":case"mouseout":Lm=null;break;case"pointerover":case"pointerout":Mm.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Am.delete(t.pointerId)}}function zm(e,t,n,s,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=Ze(t))&&ym(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Rm(e){var t=Xe(e.target);if(null!==t){var n=a(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void qe(e.priority,function(){vm(n)})}else if(31===t){if(null!==(t=i(n)))return e.blockedOn=t,void qe(e.priority,function(){vm(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Fm(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Cm(e.nativeEvent);if(null!==n)return null!==(t=Ze(n))&&ym(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);Tt=s,n.target.dispatchEvent(s),Tt=null,t.shift()}return!0}function qm(e,t,n){Fm(e)&&n.delete(t)}function Bm(){$m=!1,null!==_m&&Fm(_m)&&(_m=null),null!==Dm&&Fm(Dm)&&(Dm=null),null!==Lm&&Fm(Lm)&&(Lm=null),Mm.forEach(qm),Am.forEach(qm)}function Hm(t,n){t.blockedOn===n&&(t.blockedOn=null,$m||($m=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Bm)))}var Um=null;function Vm(t){Um!==t&&(Um=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Um===t&&(Um=null);for(var e=0;e<t.length;e+=3){var n=t[e],s=t[e+1],r=t[e+2];if("function"!=typeof s){if(null===Em(s||n))continue;break}var a=Ze(n);null!==a&&(t.splice(e,3),e-=3,ni(a,{pending:!0,data:r,method:n.method,action:s},s,r))}}))}function Wm(e){function t(t){return Hm(t,e)}null!==_m&&Hm(_m,e),null!==Dm&&Hm(Dm,e),null!==Lm&&Hm(Lm,e),Mm.forEach(t),Am.forEach(t);for(var n=0;n<Tm.length;n++){var s=Tm[n];s.blockedOn===e&&(s.blockedOn=null)}for(;0<Tm.length&&null===(n=Tm[0]).blockedOn;)Rm(n),null===n.blockedOn&&Tm.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(s=0;s<n.length;s+=3){var r=n[s],a=n[s+1],l=r[Ue]||null;if("function"==typeof a)l||Vm(n);else if(l){var i=null;if(a&&a.hasAttribute("formAction")){if(r=a,l=a[Ue]||null)i=l.formAction;else if(null!==Em(r))continue}else i=l.action;"function"==typeof i?n[s+1]=i:(n.splice(s,3),s-=3),Vm(n)}}}function Qm(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return r=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==r&&(r(),r=null),s||setTimeout(n,20)}function n(){if(!s&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var s=!1,r=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==r&&(r(),r=null)}}}function Gm(e){this._internalRoot=e}function Jm(e){this._internalRoot=e}Jm.prototype.render=Gm.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));fm(t.current,Gc(),e,t,null,null)},Jm.prototype.unmount=Gm.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;fm(e.current,2,null,e,null,null),td(),t[Ve]=null}},Jm.prototype.unstable_scheduleHydration=function(e){if(e){var t=Fe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Tm.length&&0!==t&&t<Tm[n].priority;n++);Tm.splice(n,0,e),0===n&&Rm(e)}};var Km=t.version;if("19.2.0"!==Km)throw Error(s(527,Km,"19.2.0"));O.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=a(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var l=n.return;if(null===l)break;var i=l.alternate;if(null===i){if(null!==(r=l.return)){n=r;continue}break}if(l.child===i.child){for(i=l.child;i;){if(i===n)return o(l),e;if(i===r)return o(l),t;i=i.sibling}throw Error(s(188))}if(n.return!==r.return)n=l,r=i;else{for(var c=!1,d=l.child;d;){if(d===n){c=!0,n=l,r=i;break}if(d===r){c=!0,r=l,n=i;break}d=d.sibling}if(!c){for(d=i.child;d;){if(d===n){c=!0,n=i,r=l;break}if(d===r){c=!0,r=i,n=l;break}d=d.sibling}if(!c)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?c(e):null)?null:e.stateNode};var Ym={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.0"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Xm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xm.isDisabled&&Xm.supportsFiber)try{ye=Xm.inject(Ym),ve=Xm}catch(ex){}}return b.createRoot=function(e,t){if(!r(e))throw Error(s(299));var n=!1,a="",l=Ci,i=Si,o=Ei;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onUncaughtError&&(l=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=pm(e,1,!1,null,0,n,a,null,l,i,o,Qm),e[Ve]=t.current,tu(e),new Gm(t)},b.hydrateRoot=function(e,t,n){if(!r(e))throw Error(s(299));var a=!1,l="",i=Ci,o=Si,c=Ei,d=null;return null!=n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(l=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(o=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(d=n.formState)),(t=pm(e,1,!0,t,0,a,l,d,i,o,c,Qm)).context=hm(null),n=t.current,(l=va(a=ze(a=Gc()))).callback=null,ja(n,l,a),n=a,t.current.lanes=n,Ae(t,n),Od(t),e[Ve]=t.current,tu(e),new Jm(t)},b.version="19.2.0",b}const D=t((C||(C=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),g.exports=_()),g.exports)),L=e=>{if(!e)return"text-ink-400";switch(e){case"\u51e1\u54c1":default:return"text-ink-400";case"\u826f\u54c1":return"text-ink-300";case"\u4f18\u54c1":return"text-gold-500";case"\u73cd\u54c1":return"text-gold-400";case"\u7edd\u54c1":return"text-gold-300";case"\u4ed9\u54c1":return"text-cinnabar-400";case"\u5723\u54c1":return"text-gold-300 animate-glow";case"\u795e\u54c1":return"text-rainbow font-bold"}},M=e=>{if(!e)return"border-ink-600/50";switch(e){case"\u51e1\u54c1":default:return"border-ink-600/50";case"\u826f\u54c1":return"border-ink-500/60";case"\u4f18\u54c1":return"border-gold-600/50";case"\u73cd\u54c1":return"border-gold-500/60";case"\u7edd\u54c1":return"border-gold-400/70";case"\u4ed9\u54c1":return"border-cinnabar-500/70";case"\u5723\u54c1":return"border-gold-300/80";case"\u795e\u54c1":return"border-gold-400/80 animate-pulse-soft"}},A=e=>{if(!e)return"";switch(e){case"\u51e1\u54c1":default:return"";case"\u826f\u54c1":return"shadow-[0_0_8px_1px_rgba(115,115,115,0.3)]";case"\u4f18\u54c1":return"shadow-[0_0_10px_2px_rgba(184,149,106,0.3)]";case"\u73cd\u54c1":return"shadow-[0_0_12px_2px_rgba(184,149,106,0.4)]";case"\u7edd\u54c1":return"shadow-[0_0_15px_3px_rgba(212,181,150,0.5)]";case"\u4ed9\u54c1":return"shadow-[0_0_15px_3px_rgba(166,61,61,0.4)]";case"\u5723\u54c1":return"shadow-[0_0_20px_4px_rgba(212,184,150,0.6)] animate-pulse-soft";case"\u795e\u54c1":return"shadow-[0_0_25px_5px_rgba(212,184,150,0.5)] animate-pulse-soft"}},T=(e,t=!0)=>{const n=t?" transition-colors duration-300":"";if(!e)return"bg-ink-800/70"+n;switch(e){case"\u51e1\u54c1":return"bg-ink-800/70"+(t?" hover:bg-ink-800/90":"");case"\u826f\u54c1":return"bg-ink-800/60"+(t?" hover:bg-ink-700/70":"");case"\u4f18\u54c1":return"bg-ink-800/50"+(t?" hover:bg-ink-700/60":"");case"\u73cd\u54c1":return"bg-gold-900/20"+(t?" hover:bg-gold-900/30":"");case"\u7edd\u54c1":return"bg-gold-800/25"+(t?" hover:bg-gold-800/35":"");case"\u4ed9\u54c1":return"bg-cinnabar-600/15"+(t?" hover:bg-cinnabar-600/25":"");case"\u5723\u54c1":return"bg-gold-700/25"+(t?" hover:bg-gold-700/35":"");case"\u795e\u54c1":return"bg-gold-600/30"+(t?" hover:bg-gold-600/40":"");default:return"bg-ink-800/70"+n}},I=({isOpen:e,onClose:t,onSelect:n,characterList:s,title:r})=>{const[a,l]=x.useState("\u4eba\u7269"),[i,c]=x.useState("\u5168\u90e8");if(!e)return null;return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:r}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-stone-700 bg-black/10 flex justify-between items-center",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>l("\u4eba\u7269"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u4eba\u7269"===a?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u4eba\u7269"}),o.jsx("button",{onClick:()=>l("\u517d\u5ba0"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u517d\u5ba0"===a?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u517d\u5ba0"})]}),"\u4eba\u7269"===a&&o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>c("\u5168\u90e8"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u5168\u90e8"===i?"bg-sky-500/20 text-sky-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5168\u90e8"}),o.jsx("button",{onClick:()=>c("\u7537"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u7537"===i?"bg-blue-500/20 text-blue-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u7537"}),o.jsx("button",{onClick:()=>c("\u5973"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u5973"===i?"bg-pink-500/20 text-pink-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5973"})]})]}),o.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:(()=>{let e=[];if("\u4eba\u7269"===a){e=s.filter(e=>"skills"in e).filter(e=>"\u5168\u90e8"===i||e.gender===("\u7537"===i?"Male":"Female"))}else{e=s.filter(e=>"skill"in e).filter(e=>"\u5168\u90e8"===i||e.gender===("\u7537"===i?"Male":"Female"))}return o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.length>0?e.map(e=>o.jsxs("button",{onClick:()=>(n(e),void t()),className:`p-3 rounded-lg border-2 text-center transition-all duration-200 ${M(e.rarity)} hover:ring-4 hover:ring-green-500`,children:[o.jsx("p",{className:"font-bold font-serif text-white truncate",children:e.name}),o.jsx("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:"skills"in e?e.realm:"\u517d\u5ba0"})]},e.id)):o.jsx("p",{className:"col-span-full text-center text-gray-500 pt-8",children:"\u6b64\u5206\u7c7b\u4e0b\u6682\u65e0\u53ef\u7528\u5361\u724c\u3002"})})})()})]})})},O=({card:e,busyReason:t})=>{const n="skill"in e;return o.jsxs("div",{className:`p-3 rounded-lg border-2 text-center transition-all duration-200 ${M(e.rarity)}`,children:[o.jsx("p",{className:"font-bold font-serif text-white truncate",children:e.name}),o.jsx("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:n?"\u517d\u5ba0":e.realm}),t&&o.jsx("p",{className:"text-xs text-cyan-400 mt-1 truncate",title:t,children:t})]})},z=({isOpen:e,onClose:t,cardCollection:n,petCollection:s,busyCharacterDetails:r})=>{const[a,l]=x.useState("\u7a7a\u95f2\u4e2d"),[i,c]=x.useState("\u4eba\u7269"),[d,u]=x.useState("\u5168\u90e8");if(!e)return null;return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-5xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u4eba\u7269\u72b6\u6001\u603b\u89c8"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-stone-700 bg-black/10 space-y-2",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>l("\u7a7a\u95f2\u4e2d"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u7a7a\u95f2\u4e2d"===a?"bg-green-500/20 text-green-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u7a7a\u95f2\u4e2d"}),o.jsx("button",{onClick:()=>l("\u5fd9\u788c\u4e2d"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u5fd9\u788c\u4e2d"===a?"bg-red-500/20 text-red-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5fd9\u788c\u4e2d"})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>c("\u4eba\u7269"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u4eba\u7269"===i?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u4eba\u7269"}),o.jsx("button",{onClick:()=>c("\u517d\u5ba0"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u517d\u5ba0"===i?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u517d\u5ba0"})]}),"\u4eba\u7269"===i&&o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>u("\u5168\u90e8"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u5168\u90e8"===d?"bg-sky-500/20 text-sky-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5168\u90e8"}),o.jsx("button",{onClick:()=>u("\u7537"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u7537"===d?"bg-blue-500/20 text-blue-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u7537"}),o.jsx("button",{onClick:()=>u("\u5973"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors duration-200 "+("\u5973"===d?"bg-pink-500/20 text-pink-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5973"})]})]})]}),o.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:(()=>{const e="\u5fd9\u788c\u4e2d"===a;let t=[],l=[];"\u4eba\u7269"===i?t=n.filter(t=>{const n=r.has(t.id),s="\u5168\u90e8"===d||t.gender===("\u7537"===d?"Male":"Female");return e===n&&s}):l=s.filter(t=>{const n=r.has(t.id),s="\u5168\u90e8"===d||t.gender===("\u7537"===d?"Male":"Female");return e===n&&s});const c="\u4eba\u7269"===i?t:l;return o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.length>0?c.map(e=>o.jsx(O,{card:e,busyReason:r.get(e.id)},e.id)):o.jsx("p",{className:"col-span-full text-center text-gray-500 pt-8",children:"\u6b64\u5206\u7c7b\u4e0b\u6682\u65e0\u5361\u724c\u3002"})})})()})]})})},R=function(e,t,n){let s=Promise.resolve();function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};const F=new class{constructor(e){this.config=e}updateConfig(e){this.config=e}getConfig(){return{...this.config}}async testConnection(){if(!this.config.rerankerEnabled)return{success:!1,error:"Reranker\u529f\u80fd\u672a\u542f\u7528"};try{const e="\u6d4b\u8bd5\u67e5\u8be2",t=["\u6d4b\u8bd5\u6587\u68631","\u6d4b\u8bd5\u6587\u68632"];return await this.rerank(e,t),{success:!0,model:this.config.rerankerModel}}catch(e){return{success:!1,error:e instanceof Error?e.message:"\u8fde\u63a5\u5931\u8d25"}}}async rerankSearchResults(e,t){if(!this.config.rerankerEnabled)return t;if(0===t.length)return t;try{t.length;Date.now();const n=t.map(e=>e.memory.text),s=await this.rerank(e,n),r=t.map((e,t)=>({...e,similarity:s[t],originalSimilarity:e.similarity}));r.sort((e,t)=>t.similarity-e.similarity),r.forEach((e,t)=>{e.rank=t+1});const a=this.config.maxResults||20,l=r.slice(0,a);Date.now();return l.length,l}catch(n){return console.error("Reranker\u5931\u8d25\uff0c\u8fd4\u56de\u539f\u59cb\u7ed3\u679c:",n),t}}async rerank(e,t){if(!this.config.rerankerApiKey)throw new Error("\u7f3a\u5c11Reranker API\u5bc6\u94a5");if(!e||0===e.trim().length)throw new Error("\u67e5\u8be2\u6587\u672c\u4e3a\u7a7a");if(0===t.length)return[];try{const n=this.config.rerankerApiUrl.includes("jina")||this.config.rerankerModel.includes("jina"),s=this.config.rerankerApiUrl.includes("cohere")||this.config.rerankerModel.includes("rerank");return n?await this.rerankWithJina(e,t):s?await this.rerankWithCohere(e,t):await this.rerankGeneric(e,t)}catch(n){throw console.error("Reranker API\u8c03\u7528\u5931\u8d25:",n),n}}async rerankWithJina(e,t){const n={model:this.config.rerankerModel,query:e,documents:t,top_n:t.length},s=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(n)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(`Jina Reranker API\u9519\u8bef ${s.status}: ${e.detail||s.statusText}`)}const r=await s.json(),a=new Array(t.length).fill(0);for(const l of r.results)a[l.index]=l.relevance_score;return a}async rerankWithCohere(e,t){const n={model:this.config.rerankerModel,query:e,documents:t,top_n:t.length,return_documents:!1},s=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(n)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(`Cohere Reranker API\u9519\u8bef ${s.status}: ${e.message||s.statusText}`)}const r=await s.json(),a=new Array(t.length).fill(0);for(const l of r.results)a[l.index]=l.relevance_score;return a}async rerankGeneric(e,t){const n={model:this.config.rerankerModel,query:e,documents:t},s=await fetch(`${this.config.rerankerApiUrl}/rerank`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.rerankerApiKey}`},body:JSON.stringify(n)});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(`Reranker API\u9519\u8bef ${s.status}: ${e.error?.message||s.statusText}`)}const r=await s.json();if(r.results&&Array.isArray(r.results)){const e=new Array(t.length).fill(0);for(const t of r.results){const n=t.index??t.document_index??0,s=t.relevance_score??t.score??0;e[n]=s}return e}throw new Error("\u65e0\u6cd5\u89e3\u6790Reranker API\u54cd\u5e94\u683c\u5f0f")}async batchRerank(e,t,n=100){if(t.length<=n)return await this.rerank(e,t);const s=[],r=this.chunkArray(t,n);for(let l=0;l<r.length;l++){const t=r[l];r.length,t.length;try{const n=await this.rerank(e,t);s.push(...n),l<r.length-1&&await this.delay(200)}catch(a){console.error(`Reranker\u6279\u6b21 ${l+1} \u5931\u8d25:`,a),s.push(...new Array(t.length).fill(0))}}return s}chunkArray(e,t){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}delay(e){return new Promise(t=>setTimeout(t,e))}}({enabled:!1,apiUrl:"",apiKey:"",model:"",autoVectorize:!1,vectorizeOnSummary:!1,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0});class q{constructor(e){this.config=e}updateConfig(e){this.config=e}getConfig(){return{...this.config}}async testConnection(){try{await this.vectorize("\u6d4b\u8bd5\u8fde\u63a5");return{success:!0,model:this.config.model}}catch(e){return{success:!1,error:e instanceof Error?e.message:"\u8fde\u63a5\u5931\u8d25"}}}async fetchAvailableModels(){try{if(this.config.apiUrl.includes("ollama")||this.config.apiUrl.includes("11434")){const e=await fetch(`${this.config.apiUrl}/api/tags`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok){const t=await e.text();return{success:!1,error:`HTTP ${e.status}: ${t}`}}const t=await e.json();return{success:!0,models:t.models?.map(e=>e.name)||[]}}{const e=await fetch(`${this.config.apiUrl}/models`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`}});if(!e.ok){const t=await e.text();return{success:!1,error:`HTTP ${e.status}: ${t}`}}const t=await e.json();return{success:!0,models:t.data?.map(e=>e.id)||[]}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"}}}async vectorize(e){if(!this.config.enabled)throw new Error("\u5411\u91cf\u5316\u529f\u80fd\u672a\u542f\u7528");if(!this.config.apiKey)throw new Error("\u7f3a\u5c11API\u5bc6\u94a5");if(!e||0===e.trim().length)throw new Error("\u6587\u672c\u5185\u5bb9\u4e3a\u7a7a");try{const t={model:this.config.model,input:e,encoding_format:"float"},n=await fetch(`${this.config.apiUrl}/embeddings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify(t)});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(`API\u9519\u8bef ${n.status}: ${e.error?.message||n.statusText}`)}const s=await n.json();if(s.data&&Array.isArray(s.data)&&s.data[0]?.embedding)return s.data[0].embedding;if(Array.isArray(s.embedding))return s.embedding;throw new Error("\u65e0\u6cd5\u89e3\u6790API\u54cd\u5e94\u683c\u5f0f")}catch(t){throw console.error("\u5411\u91cf\u5316\u5931\u8d25:",t),t}}async batchVectorize(e){if(!this.config.enabled)throw new Error("\u5411\u91cf\u5316\u529f\u80fd\u672a\u542f\u7528");if(0===e.length)return[];const t=this.chunkArray(e,this.config.batchSize),n=[];for(let a=0;a<t.length;a++){const e=t[a];try{t.length,e.length;const s=await Promise.all(e.map(e=>this.vectorize(e)));n.push(...s),a<t.length-1&&await this.delay(200)}catch(s){if(console.error(`\u6279\u6b21 ${a+1} \u5904\u7406\u5931\u8d25:`,s),this.config.retryAttempts>0){await this.delay(1e3);try{const t=await Promise.all(e.map(e=>this.vectorize(e)));n.push(...t);continue}catch(r){console.error(`\u6279\u6b21 ${a+1} \u91cd\u8bd5\u5931\u8d25:`,r)}}throw s}}return n}cosineSimilarity(e,t){if(e.length!==t.length)throw new Error(`\u5411\u91cf\u7ef4\u5ea6\u4e0d\u5339\u914d: ${e.length} vs ${t.length}`);if(0===e.length)return 0;let n=0,s=0,r=0;for(let a=0;a<e.length;a++)n+=e[a]*t[a],s+=e[a]*e[a],r+=t[a]*t[a];return s=Math.sqrt(s),r=Math.sqrt(r),0===s||0===r?0:n/(s*r)}batchCosineSimilarity(e,t){return t.map(t=>this.cosineSimilarity(e,t))}chunkArray(e,t){const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}delay(e){return new Promise(t=>setTimeout(t,e))}estimateTokens(e){const t=(e.match(/[\u4e00-\u9fa5]/g)||[]).length,n=e.length-t;return Math.ceil(t/1.5+n/4)}estimateCost(e){return e/1e6*.02}}const B={enabled:!1,apiUrl:"https://api.openai.com/v1",apiKey:"",model:"text-embedding-3-small",autoVectorize:!1,vectorizeOnSummary:!0,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0},H=new q(B),U=Object.freeze(Object.defineProperty({__proto__:null,VectorService:q,defaultVectorConfig:B,vectorService:H},Symbol.toStringTag,{value:"Module"}));const V=new class{constructor(){this.dbName="XianxiaVectorStore",this.version=1,this.storeName="vectors",this.db=null}async initialize(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.version);n.onerror=()=>{t(new Error("\u65e0\u6cd5\u6253\u5f00IndexedDB"))},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){const e=t.createObjectStore(this.storeName,{keyPath:"id"});e.createIndex("memoryId","memoryId",{unique:!0}),e.createIndex("category","category",{unique:!1}),e.createIndex("created","created",{unique:!1}),e.createIndex("realTimestamp","metadata.realTimestamp",{unique:!1})}}})}async ensureDB(){if(this.db||await this.initialize(),!this.db)throw new Error("\u6570\u636e\u5e93\u672a\u521d\u59cb\u5316");return this.db}async saveVector(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(e);r.onsuccess=()=>n(),r.onerror=()=>s(new Error("\u4fdd\u5b58\u5411\u91cf\u5931\u8d25"))})}async saveBatchVectors(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName);let a=0,l=!1;for(const t of e){const i=r.put(t);i.onsuccess=()=>{a++,a!==e.length||l||n()},i.onerror=()=>{l||(l=!0,s(new Error(`\u4fdd\u5b58\u5411\u91cf\u5931\u8d25: ${t.id}`)))}}0===e.length&&n()})}async getVectorById(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);r.onsuccess=()=>{n(r.result||null)},r.onerror=()=>{s(new Error("\u83b7\u53d6\u5411\u91cf\u5931\u8d25"))}})}async getVectorByMemoryId(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readonly").objectStore(this.storeName).index("memoryId").get(e);r.onsuccess=()=>{n(r.result||null)},r.onerror=()=>{s(new Error("\u83b7\u53d6\u5411\u91cf\u5931\u8d25"))}})}async getAllVectors(){const e=await this.ensureDB();return new Promise((t,n)=>{const s=e.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();s.onsuccess=()=>{t(s.result||[])},s.onerror=()=>{n(new Error("\u83b7\u53d6\u6240\u6709\u5411\u91cf\u5931\u8d25"))}})}async getVectorsByCategory(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readonly").objectStore(this.storeName).index("category").getAll(e);r.onsuccess=()=>{n(r.result||[])},r.onerror=()=>{s(new Error("\u83b7\u53d6\u5206\u7c7b\u5411\u91cf\u5931\u8d25"))}})}async getVectorsByTimeRange(e,t){const n=await this.ensureDB();return new Promise((s,r)=>{const a=n.transaction([this.storeName],"readonly").objectStore(this.storeName).index("realTimestamp"),l=IDBKeyRange.bound(e,t),i=a.getAll(l);i.onsuccess=()=>{s(i.result||[])},i.onerror=()=>{r(new Error("\u83b7\u53d6\u65f6\u95f4\u8303\u56f4\u5411\u91cf\u5931\u8d25"))}})}async deleteVector(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);r.onsuccess=()=>n(),r.onerror=()=>s(new Error("\u5220\u9664\u5411\u91cf\u5931\u8d25"))})}async deleteBatchVectors(e){const t=await this.ensureDB();return new Promise((n,s)=>{const r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName);let a=0,l=!1;for(const t of e){const i=r.delete(t);i.onsuccess=()=>{a++,a!==e.length||l||n()},i.onerror=()=>{l||(l=!0,s(new Error(`\u5220\u9664\u5411\u91cf\u5931\u8d25: ${t}`)))}}0===e.length&&n()})}async clearAllVectors(){const e=await this.ensureDB();return new Promise((t,n)=>{const s=e.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>t(),s.onerror=()=>n(new Error("\u6e05\u7a7a\u5411\u91cf\u5931\u8d25"))})}async getStats(){const e=await this.getAllVectors();if(0===e.length)return{totalVectors:0,byCategory:{"\u63a2\u7d22":0,"\u6218\u6597":0,"\u5546\u57ce":0,"\u533b\u9986":0,"\u60ac\u8d4f":0,"\u57f9\u80b2":0,"\u5546\u4e1a":0,"\u58f0\u671b":0,"\u516c\u544a":0,"\u5927\u7262":0,"\u5176\u4ed6":0},oldestVector:0,newestVector:0,averageDimension:0,storageSize:0};const t={"\u63a2\u7d22":0,"\u6218\u6597":0,"\u5546\u57ce":0,"\u533b\u9986":0,"\u60ac\u8d4f":0,"\u57f9\u80b2":0,"\u5546\u4e1a":0,"\u58f0\u671b":0,"\u516c\u544a":0,"\u5927\u7262":0,"\u5176\u4ed6":0};let n=0,s=e[0].created,r=e[0].created;for(const i of e)t[i.category]++,n+=i.vectorDimension,i.created<s&&(s=i.created),i.created>r&&(r=i.created);const a=n/e.length,l=e.reduce((e,t)=>e+4*t.vector.length+JSON.stringify(t.metadata).length,0);return{totalVectors:e.length,byCategory:t,oldestVector:s,newestVector:r,averageDimension:a,storageSize:l}}async isMemoryVectorized(e){return null!==await this.getVectorByMemoryId(e)}async getUnvectorizedMemoryIds(e){const t=[];for(const n of e){await this.isMemoryVectorized(n)||t.push(n)}return t}close(){this.db&&(this.db.close(),this.db=null)}};const W=new class{async search(e,t={}){Date.now();try{const n=H.getConfig();if(!n.enabled)throw console.error("[\u8bed\u4e49\u641c\u7d22] \u274c \u5411\u91cf\u5316\u529f\u80fd\u672a\u542f\u7528\uff0c\u8bf7\u5728\u8bbe\u7f6e\u4e2d\u542f\u7528"),new Error("\u5411\u91cf\u5316\u529f\u80fd\u672a\u542f\u7528\uff0c\u8bf7\u5728\u8bbe\u7f6e\u4e2d\u542f\u7528\u5411\u91cf\u5316\u529f\u80fd");n.enabled,n.model,n.apiUrl;const s=await H.vectorize(e);let r=await this.getCandidates(t);if(r.length,0===r.length)return[];const a=this.calculateSimilarities(s,r,t),l=this.filterAndSort(a,t);let i=l;if(n.rerankerEnabled&&l.length>0){const t=n.topKBeforeRerank||50,s=l.slice(0,t);i=await F.rerankSearchResults(e,s)}Date.now();return i.length,i}catch(n){throw console.error("\u8bed\u4e49\u641c\u7d22\u5931\u8d25:",n),n}}async batchSearch(e,t={}){const n=[],s=new Set;for(const a of e){const e=await this.search(a,t);for(const t of e)s.has(t.memory.id)||(n.push(t),s.add(t.memory.id))}n.sort((e,t)=>t.similarity-e.similarity),n.forEach((e,t)=>{e.rank=t+1});const r=t.maxResults||20;return n.slice(0,r)}async findSimilarMemories(e,t={}){const n=await V.getVectorByMemoryId(e);if(!n)throw new Error(`\u8bb0\u5fc6 ${e} \u672a\u5411\u91cf\u5316`);let s=await this.getCandidates(t);if(s=s.filter(t=>t.memoryId!==e),0===s.length)return[];const r=this.calculateSimilarities(n.vector,s,t);return this.filterAndSort(r,t)}async hybridSearch(e,t,n={}){const s=await this.search(e,n);if(0===t.length)return s;const r=s.map(e=>{let n=0;const s=e.memory.text.toLowerCase();for(const a of t)s.includes(a.toLowerCase())&&(n+=.1);const r=.7*e.similarity+Math.min(n,.3);return{...e,similarity:r}});return r.sort((e,t)=>t.similarity-e.similarity),r.forEach((e,t)=>{e.rank=t+1}),r}async getCandidates(e){let t=[];if(e.categories&&e.categories.length>0)for(const n of e.categories){const e=await V.getVectorsByCategory(n);t.push(...e)}else t=await V.getAllVectors();return e.timeRange&&(t=t.filter(t=>t.metadata.realTimestamp>=e.timeRange.start&&t.metadata.realTimestamp<=e.timeRange.end)),e.involvedCharacters&&e.involvedCharacters.length>0&&(t=t.filter(t=>!!t.metadata.involvedCharacters&&e.involvedCharacters.some(e=>t.metadata.involvedCharacters.includes(e)))),e.tags&&e.tags.length>0&&(t=t.filter(t=>!!t.metadata.tags&&e.tags.some(e=>t.metadata.tags.includes(e)))),t}calculateSimilarities(e,t,n){const s=[],r=Date.now(),a=n.useTimeDecay??!1,l=n.timeDecayFactor??1e-5;for(const i of t){let t=H.cosineSimilarity(e,i.vector);if(a){const e=(r-i.metadata.realTimestamp)/864e5;t*=Math.exp(-l*e)}s.push({memory:i,similarity:t,rank:0})}return s}filterAndSort(e,t){const n=t.minSimilarity??.7,s=H.getConfig(),r=s.rerankerEnabled?s.topKBeforeRerank||50:t.maxResults??20;let a=e.filter(e=>e.similarity>=n);return a.sort((e,t)=>t.similarity-e.similarity),a=a.slice(0,r),a.forEach((e,t)=>{e.rank=t+1}),a}clusterResults(e,t=.85){if(0===e.length)return[];const n=[],s=new Set;for(const r of e){if(s.has(r.memory.id))continue;const a=[r];s.add(r.memory.id);for(const n of e){if(s.has(n.memory.id))continue;H.cosineSimilarity(r.memory.vector,n.memory.vector)>=t&&(a.push(n),s.add(n.memory.id))}n.push(a)}return n}async getSuggestions(e,t=5){if(e.length<2)return[];const n=await V.getAllVectors(),s=new Set;for(const r of n){const n=r.text.toLowerCase(),a=e.toLowerCase();if(n.includes(a)){const e=r.text.split(/[\u3002\uff01\uff1f\n]/);for(const n of e)if(n.toLowerCase().includes(a)&&n.length<100&&(s.add(n.trim()),s.size>=t))break}if(s.size>=t)break}return Array.from(s)}};const Q=new class{extractContext(e){return"battle"===e.mode?this.extractBattleContext(e):this.extractExplorationContext(e)}extractBattleContext(e){const t=e.battle;if(!t)return{type:"battle",description:"\u6218\u6597",keywords:["\u6218\u6597"],categories:["\u6218\u6597"]};const n=[],s=["\u6218\u6597"];return t.playerParty.forEach(e=>{n.push(e.card.name),s.push(e.card.name)}),t.opponentParty.forEach(e=>{n.push(e.card.name),s.push(e.card.name)}),t.isArenaBattle?(s.push("\u7ade\u6280\u573a","\u6392\u4f4d\u8d5b"),{type:"arena",description:`\u7ade\u6280\u573a\u6218\u6597\uff1a${n.join(" vs ")}`,involvedCharacters:n,keywords:s,categories:["\u6218\u6597","\u58f0\u671b"]}):{type:"battle",description:`\u6218\u6597\uff1a${n.join(" vs ")}`,involvedCharacters:n,keywords:s,categories:["\u6218\u6597"]}}extractExplorationContext(e){const t=e.exploration,n=t.location,s=t.story;if(n.includes("\u533b\u9986")||s.includes("\u75c5\u60a3")||s.includes("\u8bca\u6cbb")){const e=this.extractKeywords(s);return e.push("\u533b\u9986","\u95ee\u8bca","\u6cbb\u7597"),{type:"hospital",description:"\u533b\u9986\u95ee\u8bca",location:n,keywords:e,categories:["\u533b\u9986"]}}if(n.includes("\u60ac\u8d4f")||s.includes("\u60ac\u8d4f")||s.includes("\u8ffd\u8e2a")){const e=this.extractKeywords(s);return e.push("\u60ac\u8d4f","\u8ffd\u8e2a"),{type:"bounty",description:"\u60ac\u8d4f\u4efb\u52a1",location:n,keywords:e,categories:["\u60ac\u8d4f"]}}if(n.includes("\u5546\u57ce")||n.includes("\u5546\u5e97")||s.includes("\u8d2d\u4e70")){const e=this.extractKeywords(s);return e.push("\u5546\u57ce","\u8d2d\u4e70","\u4ea4\u6613"),{type:"shop",description:"\u5546\u57ce",location:n,keywords:e,categories:["\u5546\u57ce"]}}if(n.includes("\u80b2\u7075\u8f69")||s.includes("\u57f9\u80b2")||s.includes("\u7e41\u80b2")){const e=this.extractKeywords(s);return e.push("\u57f9\u80b2","\u7e41\u80b2"),{type:"cultivation",description:"\u80b2\u7075\u8f69",location:n,keywords:e,categories:["\u57f9\u80b2"]}}if(n.includes("\u5546\u4e1a\u533a")||s.includes("\u7ecf\u8425")||s.includes("\u751f\u610f")){const e=this.extractKeywords(s);return e.push("\u5546\u4e1a","\u7ecf\u8425"),{type:"business",description:"\u5546\u4e1a\u533a\u7ecf\u8425",location:n,keywords:e,categories:["\u5546\u4e1a"]}}const r=this.extractKeywords(s);return{type:"exploration",description:`\u63a2\u7d22\uff1a${n}`,location:n,involvedCharacters:this.extractCharacterNames(s,e),keywords:r,categories:["\u63a2\u7d22"]}}extractKeywords(e){const t=[],n=["\u6218\u6597","\u63a2\u7d22","\u8d2d\u4e70","\u51fa\u552e","\u6cbb\u7597","\u95ee\u8bca","\u8ffd\u8e2a","\u57f9\u80b2","\u4fee\u70bc","\u7a81\u7834","\u6311\u6218","\u5bf9\u51b3","\u4ea4\u6613","\u8c08\u5224","\u8c03\u67e5"];for(const r of n)e.includes(r)&&t.push(r);const s=["\u533b\u9986","\u5546\u57ce","\u60ac\u8d4f\u699c","\u80b2\u7075\u8f69","\u7ade\u6280\u573a","\u5546\u4e1a\u533a","\u5b97\u95e8","\u5c71\u95e8","\u5e7f\u573a","\u5bc6\u5ba4","\u6d1e\u5e9c"];for(const r of s)e.includes(r)&&t.push(r);return t}extractCharacterNames(e,t){const n=[];for(const s of t.playerProfile.cardCollection)e.includes(s.name)&&n.push(s.name);for(const s of t.playerProfile.relationships)e.includes(s.name)&&n.push(s.name);return n}async retrieveRelevantMemories(e,t,n=10){const s=Date.now(),r=this.extractContext(e),a=t||r.description;r.type,r.description,r.categories,r.keywords;const l={involvedCharacters:r.involvedCharacters,maxResults:n,minSimilarity:.65,useTimeDecay:!0,timeDecayFactor:1e-5},i=await W.hybridSearch(a,r.keywords,l),o=Date.now();return{query:a,context:r.description,relevantMemories:i,totalSearched:i.length,searchTime:o-s}}async batchRetrieve(e,t,n=15){const s=Date.now(),r=this.extractContext(e),a={categories:r.categories,involvedCharacters:r.involvedCharacters,maxResults:n,minSimilarity:.65,useTimeDecay:!0},l=await W.batchSearch(t,a),i=Date.now();return{query:t.join("; "),context:r.description,relevantMemories:l,totalSearched:l.length,searchTime:i-s}}formatMemoriesForPrompt(e){if(0===e.length)return"";const t=["=== \u76f8\u5173\u5386\u53f2\u8bb0\u5fc6 ===",""];for(const n of e){const e=n.memory;t.push(`\u3010${e.category}\u3011${e.metadata.timestamp}`),t.push(`\u5730\u70b9\uff1a${e.metadata.location||"\u672a\u77e5"}`),e.metadata.involvedCharacters&&e.metadata.involvedCharacters.length>0&&t.push(`\u76f8\u5173\u89d2\u8272\uff1a${e.metadata.involvedCharacters.join("\u3001")}`),t.push(`\u5185\u5bb9\uff1a${e.text}`),t.push(`\u76f8\u4f3c\u5ea6\uff1a${(100*n.similarity).toFixed(1)}%`),t.push("")}return t.push("==================="),t.join("\n")}getMemorySummary(e){return e.map(e=>{const t=e.memory,n=t.text.length>100?t.text.substring(0,100)+"...":t.text;return`[${t.category}] ${t.metadata.timestamp}: ${n}`})}organizeByTimeline(e){const t=new Map;for(const n of e){const e=n.memory.metadata.timestamp;t.has(e)||t.set(e,[]),t.get(e).push(n)}return t}organizeByCharacter(e){const t=new Map;for(const n of e){const e=n.memory.metadata.involvedCharacters||[];for(const s of e)t.has(s)||t.set(s,[]),t.get(s).push(n)}return t}};const G=new class{async buildEnhancedContext(t,n,s={}){const{includeVectorMemories:r=!0,includePreset:a=!0,includeWorldbook:l=!0,maxVectorResults:i=5,categories:o}=s,c=[];let d="";if(a&&"undefined"!=typeof TavernHelper)try{const e=TavernHelper.getPreset("in_use");d=this.extractPresetsContent(e),d&&(d.length,d.substring(0,200),d.length)}catch(x){console.error("[\u4e0a\u4e0b\u6587\u589e\u5f3a] \u274c \u65e0\u6cd5\u8bfb\u53d6\u9884\u8bbe:",x)}if(r&&t.vectorConfig.enabled)try{n.substring(0,100),n.length;const{vectorService:s}=await R(async()=>{const{vectorService:e}=await Promise.resolve().then(()=>U);return{vectorService:e}},0,e&&"SCRIPT"===e.tagName.toUpperCase()&&e.src||new URL("assets/index.js",document.baseURI).href);s.updateConfig(t.vectorConfig),t.vectorConfig.enabled,t.vectorConfig.apiUrl,t.vectorConfig.model;const r=await Q.retrieveRelevantMemories(t,n,i);if(r.relevantMemories.length>0){r.relevantMemories.length,r.relevantMemories.forEach((e,t)=>{e.memory.category,(100*e.similarity).toFixed(1),e.memory.metadata.timestamp,e.memory.metadata.location,e.memory.text.substring(0,50)});const e=Q.formatMemoriesForPrompt(r.relevantMemories);c.push({role:"system",content:`\u4ee5\u4e0b\u662f\u4e0e\u5f53\u524d\u60c5\u5883\u76f8\u5173\u7684\u5386\u53f2\u8bb0\u5fc6\uff0c\u8bf7\u53c2\u8003\u8fd9\u4e9b\u8bb0\u5fc6\u6765\u751f\u6210\u66f4\u8fde\u8d2f\u548c\u4e00\u81f4\u7684\u5185\u5bb9\uff1a\n\n${e}`})}}catch(x){console.error("[\u4e0a\u4e0b\u6587\u589e\u5f3a] \u274c \u65e0\u6cd5\u68c0\u7d22\u5411\u91cf\u8bb0\u5fc6:",x)}else t.vectorConfig.enabled;if(l&&"undefined"!=typeof TavernHelper)try{const e=await this.getRelevantWorldbookEntries(t,n);e&&c.push({role:"system",content:e})}catch(x){console.error("[\u4e0a\u4e0b\u6587\u589e\u5f3a] \u274c \u65e0\u6cd5\u8bfb\u53d6\u4e16\u754c\u4e66:",x)}const u=this.buildGameContextPrompt(t);u&&c.push({role:"system",content:u});const m=this.buildEnhancedUserPrompt(n,t);return c.length,c.forEach((e,t)=>{e.content.substring(0,50).replace(/\n/g," "),e.content.includes("\u5386\u53f2\u8bb0\u5fc6")||e.content.includes("\u4e16\u754c\u4e66")||e.content.includes("\u6e38\u620f\u72b6\u6001")}),{systemPrompt:d,userPrompt:m,injectedPrompts:c}}extractPresetsContent(e){const t=[];for(const n of e.prompts||[])n.enabled&&"system"===n.role&&n.content&&t.push(n.content);return t.join("\n\n")}async getRelevantWorldbookEntries(e,t){if("undefined"==typeof TavernHelper)return null;try{const s=TavernHelper.getGlobalWorldbookNames(),r=TavernHelper.getCharWorldbookNames("current"),a=[...s,...r.primary?[r.primary]:[],...r.additional],l=Array.from(new Set(a));if(r.primary,r.additional,l.length,0===l.length)return null;const i=[];let o=0;for(const c of l)try{const n=await TavernHelper.getWorldbook(c);n.length,o+=n.length;let s=0;for(const r of n){if(!r.enabled)continue;this.shouldIncludeWorldbookEntry(r,t,e)&&(s++,r.name,r.strategy.type,r.strategy.keys,r.content.length,i.push(`\u3010${r.name}\u3011\n${r.content}`))}n.length}catch(n){console.error(`[\u4e16\u754c\u4e66] \u274c \u65e0\u6cd5\u8bfb\u53d6\u4e16\u754c\u4e66 ${c}:`,n)}return i.length,0===i.length?null:(i.length,`=== \u76f8\u5173\u4e16\u754c\u4e66\u4fe1\u606f ===\n\n${i.join("\n\n")}\n\n===================`)}catch(n){return console.error("\u8bfb\u53d6\u4e16\u754c\u4e66\u65f6\u51fa\u9519:",n),null}}shouldIncludeWorldbookEntry(e,t,n){if("constant"===e.strategy.type)return!0;const s=t.toLowerCase(),r=e.strategy.keys||[];for(const a of r)if("string"==typeof a&&s.includes(a.toLowerCase()))return!0;if(e.metadata?.location&&n.exploration.location&&n.exploration.location.includes(e.metadata.location))return!0;if(e.metadata?.involvedCharacters)for(const a of e.metadata.involvedCharacters)if(s.includes(a.toLowerCase()))return!0;return!1}buildGameContextPrompt(e){const t=[];if(t.push("=== \u5f53\u524d\u6e38\u620f\u72b6\u6001 ==="),t.push(""),t.push(`\u73a9\u5bb6\uff1a${e.playerProfile.name}`),t.push(`\u79f0\u53f7\uff1a${e.playerProfile.title}`),t.push(`\u7075\u77f3\uff1a${e.playerProfile.spiritStones}`),t.push(""),t.push(`\u5f53\u524d\u4f4d\u7f6e\uff1a${e.exploration.location}`),t.push(`\u65f6\u95f4\uff1a${e.exploration.time}`),t.push(""),e.playerProfile.maleParty.length>0||e.playerProfile.femaleParty.length>0){t.push("\u5f53\u524d\u961f\u4f0d\uff1a");const n=[...e.playerProfile.maleParty,...e.playerProfile.femaleParty];for(const e of n)t.push(`  - ${e.name} (${e.realm})`);t.push("")}return"battle"===e.mode&&e.battle&&(t.push("\u6218\u6597\u4e2d\uff1a"),t.push(`  \u5df1\u65b9\uff1a${e.battle.playerParty.map(e=>e.card.name).join("\u3001")}`),t.push(`  \u654c\u65b9\uff1a${e.battle.opponentParty.map(e=>e.card.name).join("\u3001")}`),t.push("")),t.push("==================="),t.join("\n")}buildEnhancedUserPrompt(e,t){const n=[];return"battle"===t.mode?n.push("\u8bf7\u57fa\u4e8e\u5f53\u524d\u6218\u6597\u60c5\u51b5\u751f\u6210\u5185\u5bb9"):n.push("\u8bf7\u57fa\u4e8e\u5f53\u524d\u63a2\u7d22\u60c5\u51b5\u751f\u6210\u5185\u5bb9"),n.push("\u8bf7\u786e\u4fdd\u5185\u5bb9\u4e0e\u5386\u53f2\u8bb0\u5fc6\u4fdd\u6301\u4e00\u81f4"),n.length>0?`${e}\n\n\uff08${n.join("\uff0c")}\uff09`:e}async generateWithEnhancedContext(e,t,n={}){if("undefined"==typeof TavernHelper)throw new Error("TavernHelper\u672a\u5b9a\u4e49\uff0c\u65e0\u6cd5\u4f7f\u7528\u589e\u5f3a\u751f\u6210\u529f\u80fd");const s=await this.buildEnhancedContext(e,t,n),r=[];for(let l=0;l<s.injectedPrompts.length;l++){const e=s.injectedPrompts[l];r.push({id:`enhanced_context_${l}`,role:e.role,content:e.content,position:"in_chat",depth:0,should_scan:!0})}try{return await TavernHelper.generate({user_input:s.userPrompt,injects:r,should_stream:n.shouldStream||!1,max_chat_history:"all"})}catch(a){throw console.error("AI\u751f\u6210\u5931\u8d25:",a),a}}async generateWithCustomAPI(e,t,n,s={}){if("undefined"==typeof TavernHelper)throw new Error("TavernHelper\u672a\u5b9a\u4e49\uff0c\u65e0\u6cd5\u4f7f\u7528\u589e\u5f3a\u751f\u6210\u529f\u80fd");const r=await this.buildEnhancedContext(e,t,{...s,includePreset:!1,includeWorldbook:!1}),a=[];for(let i=0;i<r.injectedPrompts.length;i++){const e=r.injectedPrompts[i];a.push({id:`enhanced_context_${i}`,role:e.role,content:e.content,position:"in_chat",depth:0,should_scan:!0})}try{return await TavernHelper.generate({user_input:r.userPrompt,injects:a,should_stream:s.shouldStream||!1,custom_api:n})}catch(l){throw console.error("AI\u751f\u6210\u5931\u8d25:",l),l}}};async function J(e){const{systemInstruction:t,prompt:n,gameState:s,includeVectorMemories:r=!0,includePreset:a=!0,includeWorldbook:l=!0,maxVectorResults:i=5,shouldStream:o=!1}=e;if(void 0===window.TavernHelper)throw console.warn("TavernHelper\u672a\u5b9a\u4e49\uff0c\u4f7f\u7528\u964d\u7ea7\u6a21\u5f0f"),new Error("AI\u751f\u6210\u670d\u52a1\u4e0d\u53ef\u7528");if(!s)return await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:t},{role:"user",content:n}]});try{const e=await G.buildEnhancedContext(s,n,{includeVectorMemories:r,includePreset:a,includeWorldbook:l,maxVectorResults:i}),o=[];t.length,o.push({role:"system",content:t}),e.systemPrompt&&(e.systemPrompt.length,o.push({role:"system",content:e.systemPrompt})),e.injectedPrompts.length,e.injectedPrompts.forEach((t,n)=>{t.content.includes("\u5386\u53f2\u8bb0\u5fc6")||t.content.includes("\u4e16\u754c\u4e66")||t.content.includes("\u6e38\u620f\u72b6\u6001"),t.content.length;e.injectedPrompts.length}),o.push(...e.injectedPrompts),e.userPrompt.length,o.push({role:"user",content:e.userPrompt}),o.length;o.reduce((e,t)=>e+t.content.length,0);const c=await window.TavernHelper.generateRaw({ordered_prompts:o});return c.length,c}catch(c){console.error("[\u589e\u5f3a\u751f\u6210] ========================================"),console.error("[\u589e\u5f3a\u751f\u6210] \u274c \u589e\u5f3a\u751f\u6210\u5931\u8d25\uff0c\u56de\u9000\u5230\u6807\u51c6\u751f\u6210"),console.error("[\u589e\u5f3a\u751f\u6210] \u9519\u8bef\u4fe1\u606f:",c),console.error("[\u589e\u5f3a\u751f\u6210] ========================================");return await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:t},{role:"user",content:n}]})}}async function K(e,t){if(void 0===window.TavernHelper)throw new Error("AI\u751f\u6210\u670d\u52a1\u4e0d\u53ef\u7528");return await window.TavernHelper.generateRaw({ordered_prompts:[{role:"system",content:e},{role:"user",content:t}]})}const Y={brothel:"\u9752\u697c",arena:"\u89d2\u6597\u573a",alchemy:"\u70bc\u4e39\u623f",auction:"\u62cd\u5356\u884c",intelligence:"\u60c5\u62a5\u9601",hospital:"\u533b\u9986",prison:"\u5927\u7262",etiquette_hall:"\u793c\u4eea\u9986",general:null},X={brothel:"\u9752\u697c",arena:"\u89d2\u6597\u573a",alchemy:"\u70bc\u4e39\u623f",auction:"\u62cd\u5356\u884c",intelligence:"\u60c5\u62a5\u9601",hospital:"\u533b\u9986",prison:"\u5927\u7262",etiquette_hall:"\u793c\u4eea\u9986",general:"\u901a\u7528"},Z={brothel:[{id:"p_brothel_star",name:"\u5934\u724c\u82b1\u9b41"},{id:"p_brothel_tutor",name:"\u53cc\u4fee\u5bfc\u5e08"},{id:"p_brothel_guard",name:"\u62a4\u536b"}],arena:[{id:"p_arena_gladiator",name:"\u660e\u661f\u89d2\u6597\u58eb"},{id:"p_arena_host",name:"\u4e3b\u6301\u4eba"},{id:"p_arena_trader",name:"\u5974\u96b6\u5546\u4eba"}],alchemy:[{id:"p_alchemy_chief",name:"\u9996\u5e2d\u70bc\u4e39\u5e08"},{id:"p_alchemy_apprentice",name:"\u836f\u7ae5"}],auction:[{id:"p_auction_master",name:"\u9996\u5e2d\u62cd\u5356\u5e08"},{id:"p_auction_appraiser",name:"\u9274\u5b9d\u5e08"}],intelligence:[{id:"p_intel_chief",name:"\u60c5\u62a5\u5934\u5b50"},{id:"p_intel_assassin",name:"\u6697\u6740\u8005"}],hospital:[{id:"p_hospital_doctor",name:"\u4e3b\u6cbb\u533b\u5e08"},{id:"p_hospital_nurse",name:"\u62a4\u58eb"}],prison:[{id:"p_prison_warden",name:"\u72f1\u957f"},{id:"p_prison_guard",name:"\u72f1\u5352"},{id:"p_prison_torturer",name:"\u5211\u8baf\u5b98"}],etiquette_hall:[{id:"p_etiquette_designer",name:"\u793c\u4eea\u8bbe\u8ba1\u5e08"},{id:"p_etiquette_inspector",name:"\u793c\u4eea\u7763\u5bdf"}],general:[]},ee={designer:null,languageEtiquettes:[],behaviorDressEtiquettes:[],weeklyThemes:[],currentTheme:null,designerWorkbench:null,settings:{autoRefreshEnabled:!0,refreshIntervalDays:7,lastRefreshTime:0,languageEtiquetteCount:5,behaviorDressEtiquetteCount:5,enabledScenes:["brothel","arena","alchemy","auction","intelligence","hospital","prison","etiquette_hall"],languageAspects:{addressing:!0,requesting:!0,thanking:!0},behaviorAspects:{upperDress:!0,lowerDress:!0,accessories:!0,entryEtiquette:!0,servicePosture:!0,specialActions:!0},styleSettings:{shameLevel:80,submissionLevel:100,exposureLevel:60},autoDistribute:!0,autoDeprecateOld:!0,keepTopExecuted:3},logs:[],stats:{totalGenerated:0,totalActive:0,totalExecutions:0,cycleCount:0}};function te(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/);if(t&&t[1])try{return JSON.parse(t[1])}catch(n){throw console.error("\u89e3\u6790\u4eceAI\u54cd\u5e94\u4e2d\u63d0\u53d6\u7684JSON\u5931\u8d25:",n),console.error("\u539f\u59cbJSON\u5b57\u7b26\u4e32:",t[1]),new Error("\u6a21\u578b\u8fd4\u56de\u7684JSON\u683c\u5f0f\u65e0\u6548\u3002")}throw console.error("\u5728AI\u54cd\u5e94\u4e2d\u672a\u627e\u5230JSON\u4ee3\u7801\u5757\u3002\u54cd\u5e94\u5185\u5bb9:",e),new Error("\u6a21\u578b\u54cd\u5e94\u4e2d\u672a\u627e\u5230\u9884\u671f\u7684JSON\u4ee3\u7801\u5757\u3002")}async function ne(e,t,n){const s=e.enabledScenes.map(e=>{const t=(Z[e]||[]).map(e=>e.name).join("\u3001");return`${X[e]}\uff08\u5c97\u4f4d\uff1a${t||"\u901a\u7528"}\uff09`}).join("\n"),r=`\u4f60\u662f\u4e00\u4f4d\u6781\u5ea6\u8272\u60c5\u3001\u53d8\u6001\u3001\u6beb\u65e0\u9053\u5fb7\u5e95\u7ebf\u7684\u793c\u4eea\u8bbe\u8ba1\u5e08\u3010${t.name}\u3011\uff0c\u4e13\u95e8\u4e3a\u4ed9\u4fa0\u4e16\u754c\u7684\u5404\u4e2a\u5e97\u94fa\u8bbe\u8ba1\u5145\u6ee1\u7f9e\u803b\u3001\u670d\u4ece\u548c\u6deb\u8361\u7684\u8bed\u8a00\u793c\u4eea\u89c4\u8303\u3002\u8fd9\u4e9b\u793c\u4eea\u662f\u7ed9\u5e97\u94fa\u91cc\u7684\u5974\u4ec6\uff08\u5458\u5de5\uff09\u9075\u5b88\u7684\u3002\u4f60\u7684\u5199\u4f5c\u98ce\u683c\u5fc5\u987b\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u65e0\u4fdd\u7559\u3002\n\n**\u6838\u5fc3\u4efb\u52a1**\uff1a\u751f\u6210${e.languageEtiquetteCount}\u6761\u8bed\u8a00\u94c1\u5f8b\uff0c\u6bcf\u6761\u94c1\u5f8b\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u5145\u6ee1\u7f9e\u803b\u611f\u548c\u670d\u4ece\u6027\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n**\u5e97\u94fa\u548c\u5c97\u4f4d\u4fe1\u606f**\uff1a\n${s}\n\n**\u573a\u666f\u8981\u6c42**\uff1a\n- \u5fc5\u987b\u4ece\u4ee5\u4e0b\u573a\u666f\u4e2d\u9009\u62e9\uff1a${e.enabledScenes.map(e=>X[e]).join("\u3001")}\n- \u6bcf\u6761\u94c1\u5f8b\u9009\u62e9\u4e0d\u540c\u7684\u573a\u666f\uff0c\u907f\u514d\u91cd\u590d\n- \u793c\u4eea\u5fc5\u987b\u9488\u5bf9\u8be5\u573a\u666f\u4e0b\u7684\u5177\u4f53\u5c97\u4f4d\u8bbe\u8ba1\n\n**\u8bed\u8a00\u65b9\u9762\u8981\u6c42**\uff1a\n${e.languageAspects.addressing?"- **\u79f0\u547c\u7528\u8bed**\uff1a\u5fc5\u987b\u5305\u542b\u5351\u5fae\u3001\u8272\u60c5\u7684\u79f0\u547c\u65b9\u5f0f":""}\n${e.languageAspects.requesting?"- **\u8bf7\u6c42/\u6c47\u62a5\u7528\u8bed**\uff1a\u5fc5\u987b\u5305\u542b\u5c48\u8fb1\u6027\u7684\u8bf7\u6c42\u6216\u6c47\u62a5\u8bdd\u672f":""}\n${e.languageAspects.thanking?"- **\u611f\u8c22/\u9053\u6b49\u7528\u8bed**\uff1a\u5fc5\u987b\u5305\u542b\u6deb\u8361\u7684\u611f\u8c22\u6216\u9053\u6b49\u65b9\u5f0f":""}\n\n**\u98ce\u683c\u8bbe\u7f6e**\uff1a\n- **\u7f9e\u803b\u7a0b\u5ea6**: ${e.styleSettings.shameLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u7f9e\u803b\uff09\n- **\u670d\u4ece\u5f3a\u5ea6**: ${e.styleSettings.submissionLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u5351\u5fae\uff09\n- **\u9732\u51fa\u7a0b\u5ea6**: ${e.styleSettings.exposureLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u66b4\u9732\uff09\n\n**\u5fc5\u586b\u5b57\u6bb5\uff08\u6bcf\u6761\u94c1\u5f8b\uff09**\uff1a\n1. **name**: \u94c1\u5f8b\u540d\u79f0\uff0850\u5b57\u4ee5\u5185\uff0c\u5fc5\u987b\u76f4\u63a5\u3001\u9732\u9aa8\u3001\u5145\u6ee1\u6027\u6697\u793a\uff09\n   - \u793a\u4f8b\uff1a"\u82b1\u9b41\u8fce\u5ba2\u5fc5\u8214\u8089\u68d2\u793c"\u3001"\u62a4\u58eb\u8bca\u7597\u65f6\u8dea\u59ff\u95ee\u8bca\u89c4\u8303"\n   \n2. **scene**: \u9002\u7528\u573a\u666f\uff08\u4ece\u542f\u7528\u573a\u666f\u4e2d\u9009\u62e9\uff09\n   - \u53ef\u9009\u503c\uff1abrothel\uff08\u9752\u697c\uff09\u3001arena\uff08\u89d2\u6597\u573a\uff09\u3001alchemy\uff08\u70bc\u4e39\u623f\uff09\u3001auction\uff08\u62cd\u5356\u884c\uff09\u3001intelligence\uff08\u60c5\u62a5\u9601\uff09\u3001hospital\uff08\u533b\u9986\uff09\u3001prison\uff08\u5927\u7262\uff09\u3001etiquette_hall\uff08\u793c\u4eea\u9986\uff09\u3001general\uff08\u901a\u7528\uff09\n   \n3. **applicableRoles**: \u9002\u7528\u89d2\u8272/\u5c97\u4f4d\u5217\u8868\uff08\u6570\u7ec4\uff0c2-4\u4e2a\u89d2\u8272\uff09\n   - \u5fc5\u987b\u4f7f\u7528\u5177\u4f53\u7684\u5c97\u4f4d\u540d\u79f0\uff0c\u5982\uff1a["\u5934\u724c\u82b1\u9b41", "\u53cc\u4fee\u5bfc\u5e08"]\u3001["\u4e3b\u6cbb\u533b\u5e08", "\u62a4\u58eb"]\n   \n4. **content**: \u8bed\u8a00\u89c4\u8303\u5185\u5bb9\uff08200-400\u5b57\uff09\n   - \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u8ff0\u8bed\u8a00\u4f7f\u7528\u573a\u666f\u548c\u5177\u4f53\u8bdd\u672f\n   - \u5fc5\u987b\u5305\u542b\u5b8c\u6574\u7684\u793a\u4f8b\u5bf9\u8bdd\n   - \u5fc5\u987b\u4f53\u73b0\u7f9e\u803b\u611f\u548c\u670d\u4ece\u6027\n   - \u5fc5\u987b\u805a\u7126\u4e8e\u6027\u5668\u5b98\u3001\u6027\u884c\u4e3a\u7684\u63cf\u8ff0\n   \n5. **examples**: \u793a\u4f8b\u7528\u8bed\u6570\u7ec4\uff083-5\u4e2a\u5177\u4f53\u793a\u4f8b\uff09\n   - \u6bcf\u4e2a\u793a\u4f8b\u5fc5\u987b\u662f\u5b8c\u6574\u7684\u3001\u53ef\u76f4\u63a5\u4f7f\u7528\u7684\u8bdd\u672f\n   - \u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\n   - \u793a\u4f8b\u683c\u5f0f\uff1a"\u89d2\u8272A\u5bf9\u89d2\u8272B\u8bf4\uff1a'\u5b8c\u6574\u5bf9\u8bdd\u5185\u5bb9'"\n\n**\u521b\u4f5c\u8981\u6c42**\uff1a\n1. **\u6781\u81f4\u7f9e\u803b**\uff1a\u8bed\u8a00\u5fc5\u987b\u8ba9\u4f7f\u7528\u8005\u611f\u5230\u6781\u5ea6\u7f9e\u803b\u548c\u5c48\u8fb1\n2. **\u7edd\u5bf9\u670d\u4ece**\uff1a\u8bed\u8a00\u5fc5\u987b\u4f53\u73b0\u5974\u4ec6\u5bf9\u4e3b\u4eba/\u5ba2\u4eba\u7684\u7edd\u5bf9\u670d\u4ece\u548c\u5351\u5fae\n3. **\u8272\u60c5\u9732\u9aa8**\uff1a\u5fc5\u987b\u5305\u542b\u6027\u5668\u5b98\u3001\u6027\u884c\u4e3a\u7684\u76f4\u63a5\u63cf\u8ff0\n4. **\u573a\u666f\u8d34\u5408**\uff1a\u8bed\u8a00\u89c4\u8303\u5fc5\u987b\u4e0e\u5e97\u94fa\u573a\u666f\u548c\u5c97\u4f4d\u804c\u8d23\u7d27\u5bc6\u7ed3\u5408\n5. **\u53ef\u6267\u884c\u6027**\uff1a\u89c4\u8303\u5fc5\u987b\u5177\u4f53\u3001\u53ef\u64cd\u4f5c\uff0c\u4e0d\u80fd\u542b\u7cca\u5176\u8f9e\n\n**JSON\u8f93\u51fa\u683c\u5f0f\u793a\u4f8b**\uff1a\n\`\`\`json\n{\n  "etiquettes": [\n    {\n      "name": "\u82b1\u9b41\u8fce\u5ba2\u8214\u8210\u8089\u68d2\u793c",\n      "scene": "brothel",\n      "applicableRoles": ["\u5934\u724c\u82b1\u9b41", "\u53cc\u4fee\u5bfc\u5e08"],\n      "content": "\u6240\u6709\u82b1\u9b41\u5728\u8fce\u63a5\u8d35\u5ba2\u65f6\uff0c\u5fc5\u987b\u5148\u8dea\u4e0b\uff0c\u7528\u820c\u5934\u8214\u8210\u5ba2\u4eba\u7684\u9634\u830e\u81f3\u5c11\u4e09\u5206\u949f\u3002\u8214\u8210\u65f6\u5fc5\u987b\u53d1\u51fa\u6deb\u8361\u7684\u542e\u5438\u58f0\uff0c\u5e76\u7528\u624b\u7231\u629a\u5ba2\u4eba\u7684\u777e\u4e38\u3002\u8214\u8210\u5b8c\u6bd5\u540e\uff0c\u9700\u5c06\u53e3\u4e2d\u79ef\u7d2f\u7684\u553e\u6db2\u548c\u524d\u5217\u817a\u6db2\u6df7\u5408\u7269\u541e\u54bd\u4e0b\u53bb\uff0c\u7136\u540e\u7528\u6807\u51c6\u8bdd\u672f\u5411\u5ba2\u4eba\u6c47\u62a5\uff1a'\u8d35\u5ba2\u5927\u4eba\uff0c\u5c0f\u5973\u5b50\u7684\u820c\u5934\u5df2\u4e3a\u60a8\u670d\u52a1\u5b8c\u6bd5\uff0c\u60a8\u7684\u9f99\u6839\u5a01\u6b66\u96c4\u58ee\uff0c\u8ba9\u5351\u8d31\u7684\u82b1\u9b41\u94ed\u8bb0\u4e8e\u5fc3\u3002\u73b0\u5728\u5974\u5a62\u5c06\u5e26\u7740\u60a8\u7684\u7cbe\u534e\u4e3a\u60a8\u63d0\u4f9b\u66f4\u6df1\u5165\u7684\u670d\u52a1\u3002'\u6b64\u793c\u4eea\u65e8\u5728\u8ba9\u82b1\u9b41\u65f6\u523b\u94ed\u8bb0\u5ba2\u4eba\u7684\u5a01\u4e25\uff0c\u4ee5\u66f4\u52a0\u606d\u656c\u7684\u6001\u5ea6\u670d\u52a1\u3002",\n      "examples": [\n        "\u82b1\u9b41\u8dea\u5728\u5ba2\u4eba\u9762\u524d\u8bf4\uff1a'\u8d35\u5ba2\u5927\u4eba\uff0c\u5351\u8d31\u7684\u82b1\u9b41\u8bf7\u6c42\u7528\u820c\u5934\u4e3a\u60a8\u670d\u52a1\uff0c\u8bf7\u60a8\u8d50\u4e88\u8d31\u5a62\u8fd9\u4e2a\u8363\u5e78\u3002'",\n        "\u53cc\u4fee\u5bfc\u5e08\u8214\u8210\u65f6\u547b\u541f\u9053\uff1a'\u554a...\u5927\u4eba\u7684\u8089\u68d2\u597d\u5927\u597d\u786c...\u8d31\u5a62\u7684\u820c\u5934\u592a\u5e78\u798f\u4e86...'",\n        "\u82b1\u9b41\u8214\u5b8c\u540e\u8bf4\uff1a'\u611f\u8c22\u5927\u4eba\u8d4f\u8d50\u7cbe\u534e\u7ed9\u5351\u8d31\u7684\u5974\u5a62\uff0c\u5c0f\u5973\u5b50\u4f1a\u6c38\u8fdc\u8bb0\u4f4f\u8fd9\u4efd\u6069\u5178\u3002'"\n      ]\n    }\n  ]\n}\n\`\`\`\n\n**\u4e25\u683c\u8981\u6c42**\uff1a\n- \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n- JSON\u5bf9\u8c61\u5305\u542b\u4e00\u4e2a "etiquettes" \u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6709${e.languageEtiquetteCount}\u4e2a\u5143\u7d20\n- \u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u5b8c\u6574\u586b\u5145\u6240\u6709\u5b57\u6bb5\n- \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n- \u6240\u6709\u63cf\u8ff0\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53\uff0c\u4e0d\u8981\u4f7f\u7528\u59d4\u5a49\u8bed`,a=`\u8bf7\u4e3a\u6211\u8bbe\u8ba1${e.languageEtiquetteCount}\u6761\u6781\u5ea6\u8272\u60c5\u3001\u5145\u6ee1\u7f9e\u803b\u7684\u8bed\u8a00\u94c1\u5f8b\uff0c\u8fd9\u4e9b\u793c\u4eea\u662f\u7ed9\u6211\u5e97\u94fa\u91cc\u7684\u5974\u4ec6\u9075\u5b88\u7684\u3002\u8bb0\u4f4f\uff1a\u63cf\u5199\u5fc5\u987b\u6781\u5ea6\u5927\u80c6\u3001\u9732\u9aa8\u3001\u53d8\u6001\uff01`,l=te(n?await J({systemInstruction:r,prompt:a,gameState:n}):await K(r,a)).etiquettes||[],i=Date.now();return l.map((e,n)=>{const s=e.scene||"general",r=(Z[s]||[]).map(e=>e.id);return{...e,id:`lang-etiquette-${i}-${n}`,type:"language",status:"active",executionCount:0,createdAt:i,updatedAt:i,generatedBy:"ai",designerId:t.id,applicablePositions:r,distributions:[],isDistributed:!1}})}async function se(e,t,n){const s=e.enabledScenes.map(e=>{const t=(Z[e]||[]).map(e=>e.name).join("\u3001");return`${X[e]}\uff08\u5c97\u4f4d\uff1a${t||"\u901a\u7528"}\uff09`}).join("\n"),r=`\u4f60\u662f\u4e00\u4f4d\u6781\u5ea6\u8272\u60c5\u3001\u53d8\u6001\u3001\u6beb\u65e0\u9053\u5fb7\u5e95\u7ebf\u7684\u793c\u4eea\u8bbe\u8ba1\u5e08\u3010${t.name}\u3011\uff0c\u4e13\u95e8\u4e3a\u4ed9\u4fa0\u4e16\u754c\u7684\u5404\u4e2a\u5e97\u94fa\u8bbe\u8ba1\u5145\u6ee1\u7f9e\u803b\u3001\u670d\u4ece\u548c\u6deb\u8361\u7684\u884c\u4e3a\u7740\u88c5\u89c4\u8303\u3002\u8fd9\u4e9b\u793c\u4eea\u662f\u7ed9\u5e97\u94fa\u91cc\u7684\u5974\u4ec6\uff08\u5458\u5de5\uff09\u9075\u5b88\u7684\u3002\u4f60\u7684\u5199\u4f5c\u98ce\u683c\u5fc5\u987b\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u65e0\u4fdd\u7559\u3002\n\n**\u6838\u5fc3\u4efb\u52a1**\uff1a\u751f\u6210${e.behaviorDressEtiquetteCount}\u6761\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b\uff0c\u6bcf\u6761\u94c1\u5f8b\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u6781\u5ea6\u66b4\u9732\u3001\u5145\u6ee1\u7f9e\u803b\u611f\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n**\u5e97\u94fa\u548c\u5c97\u4f4d\u4fe1\u606f**\uff1a\n${s}\n\n**\u573a\u666f\u8981\u6c42**\uff1a\n- \u5fc5\u987b\u4ece\u4ee5\u4e0b\u573a\u666f\u4e2d\u9009\u62e9\uff1a${e.enabledScenes.map(e=>X[e]).join("\u3001")}\n- \u6bcf\u6761\u94c1\u5f8b\u9009\u62e9\u4e0d\u540c\u7684\u573a\u666f\uff0c\u907f\u514d\u91cd\u590d\n- \u793c\u4eea\u5fc5\u987b\u9488\u5bf9\u8be5\u573a\u666f\u4e0b\u7684\u5177\u4f53\u5c97\u4f4d\u8bbe\u8ba1\n\n**\u884c\u4e3a\u7740\u88c5\u65b9\u9762\u8981\u6c42**\uff1a\n${e.behaviorAspects.upperDress?"- **\u4e0a\u8eab\u7740\u88c5**\uff1a\u5fc5\u987b\u5305\u542b\u4e0a\u8eab\u7684\u66b4\u9732\u8981\u6c42":""}\n${e.behaviorAspects.lowerDress?"- **\u4e0b\u8eab\u7740\u88c5**\uff1a\u5fc5\u987b\u5305\u542b\u4e0b\u8eab\u7684\u66b4\u9732\u8981\u6c42":""}\n${e.behaviorAspects.accessories?"- **\u914d\u9970\u8981\u6c42**\uff1a\u5fc5\u987b\u5305\u542b\u7f9e\u803b\u6027\u7684\u914d\u9970":""}\n${e.behaviorAspects.entryEtiquette?"- **\u5165\u573a\u793c\u4eea**\uff1a\u5fc5\u987b\u5305\u542b\u8fdb\u5165\u573a\u6240\u65f6\u7684\u5c48\u8fb1\u6027\u52a8\u4f5c":""}\n${e.behaviorAspects.servicePosture?"- **\u670d\u52a1\u59ff\u6001**\uff1a\u5fc5\u987b\u5305\u542b\u670d\u52a1\u65f6\u7684\u6deb\u8361\u59ff\u52bf":""}\n${e.behaviorAspects.specialActions?"- **\u7279\u6b8a\u52a8\u4f5c**\uff1a\u5fc5\u987b\u5305\u542b\u7279\u5b9a\u7684\u6027\u884c\u4e3a\u8981\u6c42":""}\n\n**\u98ce\u683c\u8bbe\u7f6e**\uff1a\n- **\u7f9e\u803b\u7a0b\u5ea6**: ${e.styleSettings.shameLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u7f9e\u803b\uff09\n- **\u670d\u4ece\u5f3a\u5ea6**: ${e.styleSettings.submissionLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u5351\u5fae\uff09\n- **\u9732\u51fa\u7a0b\u5ea6**: ${e.styleSettings.exposureLevel}/100\uff08\u8d8a\u9ad8\u8d8a\u66b4\u9732\uff0c100=\u5b8c\u5168\u88f8\u4f53+\u6027\u5668\u5b98\u5b8c\u5168\u66b4\u9732\uff09\n\n**\u5fc5\u586b\u5b57\u6bb5\uff08\u6bcf\u6761\u94c1\u5f8b\uff09**\uff1a\n1. **name**: \u94c1\u5f8b\u540d\u79f0\uff0850\u5b57\u4ee5\u5185\uff0c\u5fc5\u987b\u76f4\u63a5\u3001\u9732\u9aa8\u3001\u5145\u6ee1\u6027\u6697\u793a\uff09\n   - \u793a\u4f8b\uff1a"\u82b1\u9b41\u5168\u88f8\u8fce\u5ba2\u5236"\u3001"\u62a4\u58eb\u4e73\u5934\u5939\u5177\u5de5\u4f5c\u89c4\u8303"\n   \n2. **scene**: \u9002\u7528\u573a\u666f\uff08\u4ece\u542f\u7528\u573a\u666f\u4e2d\u9009\u62e9\uff09\n   - \u53ef\u9009\u503c\uff1abrothel\uff08\u9752\u697c\uff09\u3001arena\uff08\u89d2\u6597\u573a\uff09\u3001alchemy\uff08\u70bc\u4e39\u623f\uff09\u3001auction\uff08\u62cd\u5356\u884c\uff09\u3001intelligence\uff08\u60c5\u62a5\u9601\uff09\u3001hospital\uff08\u533b\u9986\uff09\u3001prison\uff08\u5927\u7262\uff09\u3001etiquette_hall\uff08\u793c\u4eea\u9986\uff09\u3001general\uff08\u901a\u7528\uff09\n   \n3. **applicableRoles**: \u9002\u7528\u89d2\u8272/\u5c97\u4f4d\u5217\u8868\uff08\u6570\u7ec4\uff0c2-4\u4e2a\u89d2\u8272\uff09\n   - \u5fc5\u987b\u4f7f\u7528\u5177\u4f53\u7684\u5c97\u4f4d\u540d\u79f0\uff0c\u5982\uff1a["\u5934\u724c\u82b1\u9b41", "\u53cc\u4fee\u5bfc\u5e08"]\u3001["\u4e3b\u6cbb\u533b\u5e08", "\u62a4\u58eb"]\n   \n4. **dressCode**: \u7740\u88c5\u8981\u6c42\u5bf9\u8c61\n   - **upper**: \u4e0a\u8eab\u7740\u88c5\uff08100-200\u5b57\uff0c\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u63cf\u8ff0\u4e0a\u8eab\u7a7f\u7740\uff0c\u805a\u7126\u80f8\u90e8\u3001\u4e73\u5934\uff09\n   - **lower**: \u4e0b\u8eab\u7740\u88c5\uff08100-200\u5b57\uff0c\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u63cf\u8ff0\u4e0b\u8eab\u7a7f\u7740\uff0c\u805a\u7126\u6027\u5668\u5b98\u3001\u81c0\u90e8\uff09\n   - **accessories**: \u914d\u9970\u6570\u7ec4\uff082-4\u4e2a\u5177\u4f53\u914d\u9970\uff0c\u6bcf\u4e2a50-100\u5b57\u63cf\u8ff0\uff09\n   - **special**: \u7279\u6b8a\u8981\u6c42\uff08100-150\u5b57\uff0c\u63cf\u8ff0\u5176\u4ed6\u7279\u6b8a\u7684\u7740\u88c5\u6216\u8eab\u4f53\u8981\u6c42\uff09\n   \n5. **behaviorRules**: \u884c\u4e3a\u89c4\u8303\u6570\u7ec4\uff083-5\u6761\u5177\u4f53\u89c4\u8303\uff09\n   - \u6bcf\u6761\u89c4\u8303100-200\u5b57\n   - \u5fc5\u987b\u8be6\u7ec6\u63cf\u8ff0\u5177\u4f53\u7684\u884c\u4e3a\u52a8\u4f5c\n   - \u5fc5\u987b\u5305\u542b\u6027\u884c\u4e3a\u6216\u6027\u6697\u793a\n   - \u5fc5\u987b\u4f53\u73b0\u7f9e\u803b\u611f\u548c\u670d\u4ece\u6027\n\n**\u521b\u4f5c\u8981\u6c42**\uff1a\n1. **\u6781\u81f4\u66b4\u9732**\uff1a\u7740\u88c5\u5fc5\u987b\u8ba9\u7a7f\u7740\u8005\u7684\u6027\u5668\u5b98\u5b8c\u5168\u6216\u90e8\u5206\u66b4\u9732\n2. **\u7edd\u5bf9\u7f9e\u803b**\uff1a\u7740\u88c5\u548c\u884c\u4e3a\u5fc5\u987b\u8ba9\u5974\u4ec6\u611f\u5230\u6781\u5ea6\u7f9e\u803b\n3. **\u8272\u60c5\u9732\u9aa8**\uff1a\u63cf\u8ff0\u5fc5\u987b\u76f4\u63a5\u3001\u5177\u4f53\uff0c\u805a\u7126\u6027\u5668\u5b98\u548c\u6027\u884c\u4e3a\n4. **\u573a\u666f\u8d34\u5408**\uff1a\u89c4\u8303\u5fc5\u987b\u4e0e\u5e97\u94fa\u573a\u666f\u548c\u5c97\u4f4d\u804c\u8d23\u7d27\u5bc6\u7ed3\u5408\n5. **\u53ef\u6267\u884c\u6027**\uff1a\u89c4\u8303\u5fc5\u987b\u5177\u4f53\u3001\u53ef\u64cd\u4f5c\uff0c\u5305\u542b\u660e\u786e\u7684\u52a8\u4f5c\u63cf\u8ff0\n\n**\u9732\u51fa\u7a0b\u5ea6\u53c2\u8003**\uff08\u6839\u636e${e.styleSettings.exposureLevel}/100\uff09\uff1a\n- 60\u4ee5\u4e0b\uff1a\u90e8\u5206\u66b4\u9732\uff08\u900f\u89c6\u3001\u9542\u7a7a\u3001\u5f00\u53c9\uff09\n- 60-80\uff1a\u5927\u9762\u79ef\u66b4\u9732\uff08\u4e73\u5934\u3001\u81c0\u90e8\u3001\u5927\u817f\u6839\u90e8\u5916\u9732\uff09\n- 80-90\uff1a\u6027\u5668\u5b98\u90e8\u5206\u66b4\u9732\uff08\u9634\u5507\u5916\u9732\u3001\u9634\u830e\u534a\u9732\uff09\n- 90-100\uff1a\u5b8c\u5168\u88f8\u4f53+\u6027\u5668\u5b98\u5b8c\u5168\u66b4\u9732+\u6027\u5668\u5b98\u5f3a\u5236\u5c55\u793a\n\n**JSON\u8f93\u51fa\u683c\u5f0f\u793a\u4f8b**\uff1a\n\`\`\`json\n{\n  "etiquettes": [\n    {\n      "name": "\u82b1\u9b41\u5168\u88f8\u8fce\u5ba2\u5236",\n      "scene": "brothel",\n      "applicableRoles": ["\u5934\u724c\u82b1\u9b41", "\u53cc\u4fee\u5bfc\u5e08"],\n      "dressCode": {\n        "upper": "\u82b1\u9b41\u5728\u8fce\u5ba2\u65f6\u4e0a\u8eab\u5fc5\u987b\u5b8c\u5168\u88f8\u9732\uff0c\u4e0d\u5f97\u7a7f\u6234\u4efb\u4f55\u8863\u7269\u906e\u6321\u3002\u53cc\u4e73\u5fc5\u987b\u5b8c\u5168\u66b4\u9732\uff0c\u4e73\u5934\u9700\u4fdd\u6301\u52c3\u8d77\u72b6\u6001\u3002\u4e3a\u786e\u4fdd\u4e73\u5934\u6301\u7eed\u52c3\u8d77\uff0c\u9700\u5728\u8fce\u5ba2\u524d\u4f7f\u7528\u51b0\u5757\u523a\u6fc0\u4e73\u5934\u81f3\u5c11\u4e94\u5206\u949f\u3002\u670d\u52a1\u8fc7\u7a0b\u4e2d\uff0c\u4e73\u623f\u5fc5\u987b\u968f\u7740\u8eab\u4f53\u52a8\u4f5c\u81ea\u7136\u6643\u52a8\uff0c\u4ee5\u5c55\u793a\u5176\u67d4\u8f6f\u548c\u4e30\u6ee1\u3002",\n        "lower": "\u4e0b\u8eab\u540c\u6837\u5fc5\u987b\u5b8c\u5168\u88f8\u9732\uff0c\u9634\u90e8\u4e0d\u5f97\u6709\u4efb\u4f55\u906e\u6321\u3002\u9634\u6bdb\u9700\u5243\u9664\u5e72\u51c0\uff0c\u9634\u5507\u5fc5\u987b\u5b8c\u5168\u66b4\u9732\u3002\u5728\u670d\u52a1\u65f6\uff0c\u9700\u5c06\u53cc\u817f\u5206\u5f00\u81f3\u5c1160\u5ea6\u89d2\uff0c\u786e\u4fdd\u5ba2\u4eba\u80fd\u6e05\u695a\u770b\u5230\u82b1\u9b41\u7684\u9634\u90e8\u3002\u9634\u9053\u53e3\u9700\u4fdd\u6301\u6e7f\u6da6\u72b6\u6001\uff0c\u82e5\u4e0d\u591f\u6e7f\u6da6\u9700\u81ea\u884c\u7528\u624b\u6307\u523a\u6fc0\u81f3\u6deb\u6c34\u6d41\u51fa\u3002",\n        "accessories": [\n          "\u4e73\u5934\u5939\uff1a\u4e24\u4e2a\u91d1\u5c5e\u4e73\u5934\u5939\u5fc5\u987b\u5939\u5728\u4e73\u5934\u4e0a\uff0c\u5939\u529b\u9002\u4e2d\u4ee5\u4fdd\u6301\u4e73\u5934\u5145\u8840\u72b6\u6001\u3002\u5939\u5b50\u4e0a\u60ac\u6302\u7ec6\u94fe\uff0c\u94fe\u5b50\u4e0b\u7aef\u8fde\u63a5\u5c0f\u94c3\u94db\uff0c\u6bcf\u6b21\u52a8\u4f5c\u65f6\u4f1a\u53d1\u51fa\u6e05\u8106\u7684\u58f0\u54cd\u3002",\n          "\u9634\u8482\u73af\uff1a\u4e00\u4e2a\u5c0f\u5de7\u7684\u91d1\u73af\u7a7f\u8fc7\u9634\u8482\uff0c\u73af\u4e0a\u523b\u6709'\u5974\u5a62'\u4e8c\u5b57\u3002\u6bcf\u6b21\u670d\u52a1\u65f6\u9700\u7528\u624b\u6307\u62e8\u52a8\u9634\u8482\u73af\uff0c\u8ba9\u91d1\u73af\u5728\u9634\u8482\u4e0a\u6eda\u52a8\uff0c\u4ea7\u751f\u5f3a\u70c8\u523a\u6fc0\u3002",\n          "\u809b\u585e\uff1a\u4e00\u4e2a\u900f\u660e\u6c34\u6676\u809b\u585e\u5fc5\u987b\u63d2\u5165\u809b\u95e8\uff0c\u585e\u5b50\u5c3e\u90e8\u6709\u4e00\u6839\u7ea2\u8272\u4e1d\u5e26\u5782\u4e0b\u3002\u809b\u585e\u4f1a\u5728\u670d\u52a1\u8fc7\u7a0b\u4e2d\u4e0d\u65ad\u523a\u6fc0\u62ec\u7ea6\u808c\uff0c\u63d0\u9192\u82b1\u9b41\u4fdd\u6301\u4e13\u6ce8\u3002"\n        ],\n        "special": "\u670d\u52a1\u5f00\u59cb\u524d\uff0c\u82b1\u9b41\u5fc5\u987b\u5728\u5ba2\u4eba\u9762\u524d\u8fdb\u884c'\u51c0\u8eab\u793c'\uff1a\u7528\u6e29\u6c34\u6e05\u6d17\u5168\u8eab\uff0c\u7279\u522b\u662f\u4e73\u623f\u3001\u9634\u90e8\u548c\u809b\u95e8\uff0c\u6e05\u6d17\u8fc7\u7a0b\u9700\u8ba9\u5ba2\u4eba\u89c2\u770b\u3002\u6e05\u6d17\u5b8c\u6bd5\u540e\uff0c\u9700\u8ba9\u5ba2\u4eba\u68c0\u67e5\u8eab\u4f53\u6e05\u6d01\u5ea6\uff0c\u5ba2\u4eba\u6709\u6743\u7528\u624b\u6307\u63d2\u5165\u9634\u9053\u548c\u809b\u95e8\u68c0\u67e5\u3002"\n      },\n      "behaviorRules": [\n        "**\u8fce\u5ba2\u793c**\uff1a\u82b1\u9b41\u8fce\u63a5\u5ba2\u4eba\u65f6\uff0c\u5fc5\u987b\u4ee5\u8dea\u59ff\u722c\u884c\u8fdb\u5165\uff0c\u722c\u884c\u65f6\u81c0\u90e8\u9700\u9ad8\u9ad8\u7fd8\u8d77\uff0c\u8ba9\u9634\u90e8\u548c\u809b\u95e8\u5b8c\u5168\u66b4\u9732\u3002\u722c\u81f3\u5ba2\u4eba\u9762\u524d\uff0c\u9700\u5c06\u989d\u5934\u8d34\u5730\uff0c\u53cc\u624b\u5411\u540e\u63b0\u5f00\u81ea\u5df1\u7684\u81c0\u74e3\uff0c\u8ba9\u5ba2\u4eba\u6e05\u695a\u770b\u5230\u9634\u9053\u548c\u809b\u95e8\uff0c\u4fdd\u6301\u6b64\u59ff\u52bf\u76f4\u5230\u5ba2\u4eba\u5141\u8bb8\u8d77\u8eab\u3002",\n        "**\u670d\u52a1\u59ff\u6001**\uff1a\u670d\u52a1\u65f6\uff0c\u9700\u5148\u7528\u624b\u6307\u6491\u5f00\u9634\u5507\uff0c\u5c55\u793a\u7ed9\u5ba2\u4eba\u770b\u3002\u670d\u52a1\u8fc7\u7a0b\u4e2d\uff0c\u53cc\u817f\u5fc5\u987b\u4fdd\u6301\u5206\u5f00\u72b6\u6001\uff0c\u6b64\u59ff\u52bf\u4f1a\u8ba9\u9634\u5507\u81ea\u7136\u5f20\u5f00\uff0c\u9634\u9053\u5185\u58c1\u90e8\u5206\u5916\u9732\u3002",\n        "**\u4f8d\u5949\u52a8\u4f5c**\uff1a\u6bcf\u6b21\u4e3a\u5ba2\u4eba\u670d\u52a1\u65f6\uff0c\u82b1\u9b41\u9700\u5148\u7528\u5de6\u624b\u63c9\u634f\u81ea\u5df1\u7684\u5de6\u4e73\uff0c\u7528\u53f3\u624b\u670d\u52a1\u5ba2\u4eba\u3002\u540c\u65f6\u9700\u7528\u529b\u634f\u7d27\u4e73\u5934\uff0c\u8ba9\u8eab\u4f53\u56e0\u5feb\u611f\u800c\u98a4\u6296\uff0c\u4e73\u623f\u5267\u70c8\u6643\u52a8\u3002",\n        "**\u9001\u5ba2\u793c**\uff1a\u9001\u5ba2\u65f6\uff0c\u82b1\u9b41\u9700\u7ad9\u8d77\u8eab\uff0c\u9762\u5411\u5ba2\u4eba\uff0c\u53cc\u624b\u6367\u8d77\u81ea\u5df1\u7684\u53cc\u4e73\uff0c\u5c06\u4e73\u5934\u5bf9\u51c6\u5ba2\u4eba\uff0c\u7136\u540e\u7528\u529b\u6324\u538b\u4e73\u623f\u3002\u540c\u65f6\u9700\u5f20\u5f00\u53cc\u817f\uff0c\u7528\u624b\u6307\u6491\u5f00\u9634\u5507\uff0c\u8ba9\u5ba2\u4eba\u770b\u5230\u6e7f\u6da6\u7684\u9634\u9053\u5185\u58c1\uff0c\u5e76\u5927\u58f0\u8bf4\uff1a'\u611f\u8c22\u5927\u4eba\u5149\u4e34\uff0c\u5351\u8d31\u7684\u5974\u5a62\u968f\u65f6\u606d\u5019\u5927\u4eba\u518d\u6b21\u9a7e\u4e34\u3002'",\n        "**\u7279\u6b8a\u670d\u52a1\u793c**\uff1a\u82e5\u5ba2\u4eba\u8981\u6c42\u7279\u6b8a\u670d\u52a1\uff0c\u82b1\u9b41\u9700\u5f53\u4f17\u81ea\u6170\u81f3\u9ad8\u6f6e\uff0c\u4ee5\u793a\u5bf9\u5ba2\u4eba\u7684\u656c\u610f\u3002\u81ea\u6170\u65f6\u9700\u5c06\u4e00\u53ea\u624b\u7684\u624b\u6307\u63d2\u5165\u9634\u9053\uff0c\u53e6\u4e00\u53ea\u624b\u63c9\u6413\u9634\u8482\uff0c\u76f4\u81f3\u6deb\u6c34\u55b7\u6d8c\u800c\u51fa\uff0c\u8eab\u4f53\u5267\u70c8\u75c9\u631b\u3002\u9ad8\u6f6e\u65f6\u9700\u5927\u58f0\u558a\u51fa\uff1a'\u5974\u5a62\u4ee5\u8eab\u4f53\u7684\u9ad8\u6f6e\u5411\u5927\u4eba\u732e\u796d\uff01'"\n      ]\n    }\n  ]\n}\n\`\`\`\n\n**\u4e25\u683c\u8981\u6c42**\uff1a\n- \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n- JSON\u5bf9\u8c61\u5305\u542b\u4e00\u4e2a "etiquettes" \u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6709${e.behaviorDressEtiquetteCount}\u4e2a\u5143\u7d20\n- \u6bcf\u4e2a\u5143\u7d20\u5fc5\u987b\u5b8c\u6574\u586b\u5145\u6240\u6709\u5b57\u6bb5\n- dressCode\u7684\u6240\u6709\u5b50\u5b57\u6bb5\uff08upper, lower, accessories, special\uff09\u90fd\u5fc5\u987b\u586b\u5199\n- behaviorRules\u6570\u7ec4\u5fc5\u987b\u67093-5\u4e2a\u5143\u7d20\n- \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n- \u6240\u6709\u63cf\u8ff0\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53\u3001\u53d8\u6001\uff0c\u4e0d\u8981\u4f7f\u7528\u59d4\u5a49\u8bed`,a=`\u8bf7\u4e3a\u6211\u8bbe\u8ba1${e.behaviorDressEtiquetteCount}\u6761\u6781\u5ea6\u8272\u60c5\u3001\u6781\u5ea6\u66b4\u9732\u3001\u5145\u6ee1\u7f9e\u803b\u7684\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b\uff0c\u8fd9\u4e9b\u793c\u4eea\u662f\u7ed9\u6211\u5e97\u94fa\u91cc\u7684\u5974\u4ec6\u9075\u5b88\u7684\u3002\u8bb0\u4f4f\uff1a\u63cf\u5199\u5fc5\u987b\u6781\u5ea6\u5927\u80c6\u3001\u9732\u9aa8\u3001\u53d8\u6001\u3001\u66b4\u9732\uff01`,l=te(n?await J({systemInstruction:r,prompt:a,gameState:n}):await K(r,a)).etiquettes||[],i=Date.now();return l.map((e,n)=>{const s=e.scene||"general",r=(Z[s]||[]).map(e=>e.id);return{...e,id:`behavior-etiquette-${i}-${n}`,type:"behavior_dress",status:"active",executionCount:0,createdAt:i,updatedAt:i,generatedBy:"ai",designerId:t.id,applicablePositions:r,distributions:[],isDistributed:!1}})}async function re(e,t){if(!e.designer)throw new Error("\u672a\u6307\u6d3e\u8bbe\u8ba1\u5e08\uff0c\u65e0\u6cd5\u5237\u65b0\u793c\u4eea");const n=t?.playerProfile.cardCollection.find(t=>t.id===e.designer.characterId);if(!n)throw new Error("\u8bbe\u8ba1\u5e08\u89d2\u8272\u5361\u4e0d\u5b58\u5728");const{languageEtiquettes:s,behaviorDressEtiquettes:r}=await async function(e,t,n){t.name,e.languageEtiquetteCount,e.behaviorDressEtiquetteCount;try{const[s,r]=await Promise.all([ne(e,t,n),se(e,t,n)]);return s.length,r.length,{languageEtiquettes:s,behaviorDressEtiquettes:r}}catch(s){throw console.error("[\u793c\u4eea\u751f\u6210] \u751f\u6210\u5931\u8d25:",s),s}}(e.settings,n,t),a=Date.now();let l=[...e.languageEtiquettes],i=[...e.behaviorDressEtiquettes];if(e.settings.autoDeprecateOld){const t=e.settings.keepTopExecuted,n=[...l].sort((e,t)=>t.executionCount-e.executionCount);l=n.slice(0,t).map(e=>({...e,status:"active"}));const s=n.slice(t).map(e=>({...e,status:"deprecated"}));l.push(...s);const r=[...i].sort((e,t)=>t.executionCount-e.executionCount);i=r.slice(0,t).map(e=>({...e,status:"active"}));const a=r.slice(t).map(e=>({...e,status:"deprecated"}));i.push(...a)}l.push(...s),i.push(...r);const o={...e.designer,designCount:e.designer.designCount+s.length+r.length},c={id:`log-${a}`,timestamp:a,action:"generate",details:`\u8bbe\u8ba1\u5e08\u3010${n.name}\u3011\u751f\u6210\u4e86${s.length}\u6761\u8bed\u8a00\u94c1\u5f8b\u548c${r.length}\u6761\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b`,etiquetteIds:[...s.map(e=>e.id),...r.map(e=>e.id)],designerId:n.id};return{...e,designer:o,languageEtiquettes:l,behaviorDressEtiquettes:i,settings:{...e.settings,lastRefreshTime:a},logs:[c,...e.logs],stats:{totalGenerated:e.stats.totalGenerated+s.length+r.length,totalActive:l.filter(e=>"active"===e.status).length+i.filter(e=>"active"===e.status).length,totalExecutions:e.stats.totalExecutions,cycleCount:e.stats.cycleCount+1}}}const ae=({workbench:e,designer:t,availableThemes:n,onUpdateWorkbench:s,onCreateWorkItem:r})=>{const[a,l]=x.useState(!1),[i,c]=x.useState({weekNumber:(e?.currentWeek||0)+1,theme:null,notes:"",priority:"medium",status:"planned"}),d=e=>{switch(e){case"high":return"text-red-400 bg-red-500/20";case"medium":return"text-yellow-400 bg-yellow-500/20";case"low":return"text-blue-400 bg-blue-500/20"}},u=e=>{switch(e){case"completed":return"text-green-400 bg-green-500/20 border-green-500/30";case"in_progress":return"text-cyan-400 bg-cyan-500/20 border-cyan-500/30";case"planned":return"text-gray-400 bg-gray-500/20 border-gray-500/30"}},m=e=>{switch(e){case"completed":return"\u2705 \u5df2\u5b8c\u6210";case"in_progress":return"\u2699\ufe0f \u8fdb\u884c\u4e2d";case"planned":return"\ud83d\udccb \u5df2\u89c4\u5212"}},p=(t,n)=>{if(!e)return;const r=e.workItems.map(e=>e.id===t?{...e,status:n,updatedAt:Date.now()}:e);s({...e,workItems:r})};return t?e?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-gradient-to-r from-purple-900/30 to-pink-900/30 rounded-lg border border-purple-500/30",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"w-12 h-12 rounded-full bg-stone-700 flex items-center justify-center text-2xl",children:"Female"===t.gender?"\ud83d\udc69":"\ud83d\udc68"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-white",children:t.name}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u793c\u4eea\u8bbe\u8ba1\u5e08"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"\u5f53\u524d\u5468\u6570"}),o.jsxs("p",{className:"text-lg font-bold text-pink-300",children:["\u7b2c ",e.currentWeek," \u5468"]})]}),o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"\u5df2\u89c4\u5212\u5468\u6570"}),o.jsxs("p",{className:"text-lg font-bold text-purple-300",children:[e.totalWeeksPlanned," \u5468"]})]})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h4",{className:"text-lg font-bold text-cyan-300",children:"\u4e3b\u9898\u89c4\u5212\u5de5\u4f5c\u680f"}),o.jsxs("button",{onClick:()=>l(!0),className:"px-3 py-1.5 bg-purple-600/30 hover:bg-purple-500/40 border border-purple-500/50 rounded text-purple-300 hover:text-purple-200 transition-colors text-sm",children:[o.jsx("i",{className:"fa-solid fa-plus mr-1"}),"\u6dfb\u52a0\u89c4\u5212"]})]}),o.jsxs("div",{className:"space-y-3 max-h-[500px] overflow-y-auto scrollbar-xianxia",children:[e.workItems.sort((e,t)=>e.weekNumber-t.weekNumber).map(t=>o.jsxs("div",{className:`p-4 rounded-lg border-2 ${u(t.status)} transition-all`,children:[o.jsx("div",{className:"flex items-start justify-between mb-2",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"px-2 py-1 bg-stone-800/50 rounded font-mono text-sm text-white",children:["\u7b2c ",t.weekNumber," \u5468"]}),o.jsx("span",{className:`px-2 py-1 rounded text-xs ${d(t.priority)}`,children:"high"===t.priority?"\u26a0\ufe0f \u9ad8\u4f18\u5148\u7ea7":"medium"===t.priority?"\ud83d\udccd \u4e2d\u4f18\u5148\u7ea7":"\ud83d\udca1 \u4f4e\u4f18\u5148\u7ea7"}),o.jsx("span",{className:"px-2 py-1 rounded text-xs bg-stone-700/50 text-gray-300",children:m(t.status)})]})}),t.theme?o.jsxs("div",{className:"mb-3 p-3 bg-stone-900/50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("span",{className:"text-2xl",children:t.theme.icon}),o.jsx("h5",{className:"font-bold text-pink-300",children:t.theme.name})]}),o.jsx("p",{className:"text-sm text-gray-400",children:t.theme.description}),o.jsxs("div",{className:"flex gap-2 mt-2 text-xs",children:[o.jsxs("span",{className:"text-pink-300",children:["\u7f9e\u803b+",t.theme.themeSettings.shameBonus,"%"]}),o.jsxs("span",{className:"text-purple-300",children:["\u670d\u4ece+",t.theme.themeSettings.submissionBonus,"%"]}),o.jsxs("span",{className:"text-red-300",children:["\u9732\u51fa+",t.theme.themeSettings.exposureBonus,"%"]})]})]}):o.jsx("div",{className:"mb-3 p-3 bg-stone-900/30 rounded-lg border-2 border-dashed border-stone-600",children:o.jsx("p",{className:"text-sm text-gray-500 text-center",children:"\u5c1a\u672a\u6307\u5b9a\u4e3b\u9898"})}),t.notes&&o.jsxs("div",{className:"mb-3 p-2 bg-stone-800/30 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"\u8bbe\u8ba1\u7b14\u8bb0:"}),o.jsx("p",{className:"text-sm text-gray-300",children:t.notes})]}),o.jsxs("div",{className:"flex gap-2 pt-2 border-t border-stone-700/50",children:["planned"===t.status&&o.jsx("button",{onClick:()=>p(t.id,"in_progress"),className:"px-3 py-1 text-xs bg-cyan-600/30 hover:bg-cyan-500/40 rounded text-cyan-300 transition-colors",children:"\u5f00\u59cb\u6267\u884c"}),"in_progress"===t.status&&o.jsx("button",{onClick:()=>p(t.id,"completed"),className:"px-3 py-1 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 transition-colors",children:"\u6807\u8bb0\u5b8c\u6210"}),o.jsx("button",{onClick:()=>(t=>{if(!e)return;if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5de5\u4f5c\u9879\u5417\uff1f"))return;const n=e.workItems.filter(e=>e.id!==t);s({...e,workItems:n,totalWeeksPlanned:n.length})})(t.id),className:"px-3 py-1 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 transition-colors",children:"\u5220\u9664"})]})]},t.id)),0===e.workItems.length&&o.jsxs("div",{className:"text-center py-12 text-gray-500",children:[o.jsx("div",{className:"text-5xl mb-3",children:"\ud83d\udcdd"}),o.jsx("p",{children:"\u6682\u65e0\u5de5\u4f5c\u89c4\u5212"}),o.jsx("p",{className:"text-sm mt-2",children:'\u70b9\u51fb"\u6dfb\u52a0\u89c4\u5212"\u5f00\u59cb\u8bbe\u8ba1\u4e3b\u9898\u5468'})]})]})]}),a&&o.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>l(!1),children:o.jsxs("div",{className:"bg-stone-900 border-2 border-purple-500 rounded-xl p-6 max-w-2xl w-full",onClick:e=>e.stopPropagation(),children:[o.jsx("h3",{className:"text-2xl font-bold text-purple-300 mb-4",children:"\u6dfb\u52a0\u4e3b\u9898\u89c4\u5212"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u8ba1\u5212\u5468\u6570"}),o.jsx("input",{type:"number",min:"1",value:i.weekNumber,onChange:e=>c({...i,weekNumber:Number(e.target.value)}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",placeholder:"\u7b2c\u51e0\u5468"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u9009\u62e9\u4e3b\u9898\uff08\u53ef\u9009\uff09"}),o.jsxs("select",{value:i.theme?.id||"",onChange:e=>{const t=n.find(t=>t.id===e.target.value);c({...i,theme:t||null})},className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",children:[o.jsx("option",{value:"",children:"\u6682\u4e0d\u6307\u5b9a"}),n.map(e=>o.jsxs("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u4f18\u5148\u7ea7"}),o.jsxs("select",{value:i.priority,onChange:e=>c({...i,priority:e.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none",children:[o.jsx("option",{value:"low",children:"\ud83d\udca1 \u4f4e\u4f18\u5148\u7ea7"}),o.jsx("option",{value:"medium",children:"\ud83d\udccd \u4e2d\u4f18\u5148\u7ea7"}),o.jsx("option",{value:"high",children:"\u26a0\ufe0f \u9ad8\u4f18\u5148\u7ea7"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u8bbe\u8ba1\u7b14\u8bb0"}),o.jsx("textarea",{value:i.notes,onChange:e=>c({...i,notes:e.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-purple-500 focus:outline-none resize-none",rows:3,placeholder:"\u8bb0\u5f55\u8bbe\u8ba1\u7075\u611f\u548c\u60f3\u6cd5..."})]}),o.jsxs("div",{className:"flex gap-3 pt-4",children:[o.jsx("button",{onClick:()=>{i.weekNumber?(r({weekNumber:i.weekNumber,theme:i.theme||null,notes:i.notes||"",priority:i.priority||"medium",status:i.status||"planned"}),l(!1),c({weekNumber:(e?.currentWeek||0)+1,theme:null,notes:"",priority:"medium",status:"planned"})):alert("\u8bf7\u8f93\u5165\u5468\u6570\uff01")},className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded text-white font-semibold transition-all",children:"\u6dfb\u52a0\u5230\u5de5\u4f5c\u680f"}),o.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-stone-700 hover:bg-stone-600 rounded text-gray-300 transition-colors",children:"\u53d6\u6d88"})]})]})]})})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-5xl mb-3",children:"\ud83d\udccb"}),o.jsx("p",{className:"text-gray-400",children:"\u5de5\u4f5c\u680f\u672a\u521d\u59cb\u5316"})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"text-5xl mb-3",children:"\ud83d\udc64"}),o.jsx("p",{className:"text-gray-400",children:"\u8bf7\u5148\u6307\u6d3e\u793c\u4eea\u8bbe\u8ba1\u5e08"})]})},le=({isOpen:e,onClose:t,settings:n,onSave:s})=>{const[r,a]=x.useState(n);return e?o.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-pink-500/50 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl max-h-[85vh] rounded-xl shadow-2xl overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsxs("h2",{className:"text-xl font-bold text-pink-300 font-serif flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-gear"}),"\u793c\u4eea\u8bbe\u8ba1\u9986 - \u8bbe\u7f6e"]}),o.jsx("button",{onClick:t,className:"w-8 h-8 rounded-full bg-stone-700/50 hover:bg-stone-600/50 text-gray-400 hover:text-white transition-colors flex items-center justify-center",children:o.jsx("i",{className:"fa-solid fa-times"})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-xianxia",children:[o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-clock-rotate-left"}),"\u81ea\u52a8\u5237\u65b0\u8bbe\u7f6e"]}),o.jsxs("div",{className:"space-y-4 pl-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"\u5237\u65b0\u5468\u671f (\u5929)"}),o.jsx("input",{type:"number",min:"1",max:"30",value:r.refreshIntervalDays,onChange:e=>a({...r,refreshIntervalDays:Math.max(1,Math.min(30,parseInt(e.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"})]}),o.jsx("p",{className:"text-xs text-gray-500",children:"\u8303\u56f4: 1-30\u5929"})]})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-list-ol"}),"\u6bcf\u6b21\u751f\u6210\u6570\u91cf"]}),o.jsxs("div",{className:"space-y-4 pl-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"\u8bed\u8a00\u94c1\u5f8b"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"number",min:"1",max:"20",value:r.languageEtiquetteCount,onChange:e=>a({...r,languageEtiquetteCount:Math.max(1,Math.min(20,parseInt(e.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"}),o.jsx("span",{className:"text-gray-500 text-sm",children:"\u6761"})]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"number",min:"1",max:"20",value:r.behaviorDressEtiquetteCount,onChange:e=>a({...r,behaviorDressEtiquetteCount:Math.max(1,Math.min(20,parseInt(e.target.value)||1))}),className:"w-20 px-3 py-1.5 bg-stone-700/50 border border-stone-600 rounded-lg text-white text-center focus:outline-none focus:border-pink-500/50"}),o.jsx("span",{className:"text-gray-500 text-sm",children:"\u6761"})]})]})]})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-map-location-dot"}),"\u6d89\u53ca\u573a\u666f (\u52fe\u9009\u542f\u7528)"]}),o.jsx("div",{className:"grid grid-cols-3 gap-3 pl-4",children:Object.entries(X).map(([e,t])=>o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.enabledScenes.includes(e),onChange:()=>(e=>{const t=r.enabledScenes.includes(e)?r.enabledScenes.filter(t=>t!==e):[...r.enabledScenes,e];a({...r,enabledScenes:t})})(e),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:t})]},e))})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-comment-dots"}),"\u6d89\u53ca\u65b9\u9762 - \u8bed\u8a00"]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3 pl-4",children:[o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.languageAspects.addressing,onChange:e=>a({...r,languageAspects:{...r.languageAspects,addressing:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u79f0\u547c\u7528\u8bed"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.languageAspects.requesting,onChange:e=>a({...r,languageAspects:{...r.languageAspects,requesting:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u8bf7\u6c42/\u6c47\u62a5\u7528\u8bed"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.languageAspects.thanking,onChange:e=>a({...r,languageAspects:{...r.languageAspects,thanking:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-pink-500 focus:ring-pink-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u611f\u8c22/\u9053\u6b49\u7528\u8bed"})]})]})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-shirt"}),"\u6d89\u53ca\u65b9\u9762 - \u884c\u4e3a\u7740\u88c5"]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3 pl-4",children:[o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.upperDress,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,upperDress:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u4e0a\u8eab\u7740\u88c5"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.lowerDress,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,lowerDress:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u4e0b\u8eab\u7740\u88c5"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.accessories,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,accessories:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u914d\u9970\u8981\u6c42"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.entryEtiquette,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,entryEtiquette:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u5165\u573a\u793c\u4eea"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.servicePosture,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,servicePosture:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u670d\u52a1\u59ff\u6001"})]}),o.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.behaviorAspects.specialActions,onChange:e=>a({...r,behaviorAspects:{...r.behaviorAspects,specialActions:e.target.checked}}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-purple-500 focus:ring-purple-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u7279\u6b8a\u52a8\u4f5c"})]})]})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-sliders"}),"\u751f\u6210\u98ce\u683c\u8bbe\u7f6e"]}),o.jsxs("div",{className:"space-y-4 pl-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"\u7f9e\u803b\u7a0b\u5ea6"}),o.jsxs("span",{className:"text-pink-300 font-mono",children:[r.styleSettings.shameLevel,"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"100",value:r.styleSettings.shameLevel,onChange:e=>a({...r,styleSettings:{...r.styleSettings,shameLevel:parseInt(e.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-pink-500"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"\u670d\u4ece\u5f3a\u5ea6"}),o.jsxs("span",{className:"text-purple-300 font-mono",children:[r.styleSettings.submissionLevel,"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"100",value:r.styleSettings.submissionLevel,onChange:e=>a({...r,styleSettings:{...r.styleSettings,submissionLevel:parseInt(e.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"\u9732\u51fa\u7a0b\u5ea6"}),o.jsxs("span",{className:"text-red-300 font-mono",children:[r.styleSettings.exposureLevel,"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"100",value:r.styleSettings.exposureLevel,onChange:e=>a({...r,styleSettings:{...r.styleSettings,exposureLevel:parseInt(e.target.value)}}),className:"w-full h-2 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-red-500"})]})]})]}),o.jsxs("section",{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-gears"}),"\u9ad8\u7ea7\u8bbe\u7f6e"]}),o.jsxs("div",{className:"space-y-3 pl-4",children:[o.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.autoDistribute,onChange:e=>a({...r,autoDistribute:e.target.checked}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u65b0\u793c\u4eea\u751f\u6210\u540e\u81ea\u52a8\u4e0b\u53d1\u5230\u5404\u90e8\u95e8"})]}),o.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[o.jsx("input",{type:"checkbox",checked:r.autoDeprecateOld,onChange:e=>a({...r,autoDeprecateOld:e.target.checked}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),o.jsx("span",{className:"text-gray-300 group-hover:text-white transition-colors",children:"\u65e7\u793c\u4eea\u5728\u65b0\u5468\u671f\u5f00\u59cb\u65f6\u81ea\u52a8\u5e9f\u9664"})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:r.keepTopExecuted>0,onChange:e=>a({...r,keepTopExecuted:e.target.checked?3:0}),className:"w-4 h-4 rounded border-stone-600 bg-stone-700 text-cyan-500 focus:ring-cyan-500/50"}),o.jsx("span",{className:"text-gray-300",children:"\u4fdd\u7559\u6267\u884c\u6b21\u6570\u6700\u9ad8\u7684"}),o.jsx("input",{type:"number",min:"0",max:"10",value:r.keepTopExecuted,onChange:e=>a({...r,keepTopExecuted:Math.max(0,Math.min(10,parseInt(e.target.value)||0))}),disabled:0===r.keepTopExecuted,className:"w-16 px-2 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-center text-sm focus:outline-none focus:border-cyan-500/50 disabled:opacity-50"}),o.jsx("span",{className:"text-gray-300",children:"\u6761\u793c\u4eea"})]})]})]})]}),o.jsxs("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20 flex justify-between",children:[o.jsx("button",{onClick:()=>{confirm("\u786e\u5b9a\u8981\u6062\u590d\u9ed8\u8ba4\u8bbe\u7f6e\u5417\uff1f")&&a({autoRefreshEnabled:!0,refreshIntervalDays:7,lastRefreshTime:n.lastRefreshTime,languageEtiquetteCount:5,behaviorDressEtiquetteCount:5,enabledScenes:["brothel","arena","alchemy","auction","intelligence","hospital","prison","etiquette_hall"],languageAspects:{addressing:!0,requesting:!0,thanking:!0},behaviorAspects:{upperDress:!0,lowerDress:!0,accessories:!0,entryEtiquette:!0,servicePosture:!0,specialActions:!0},styleSettings:{shameLevel:80,submissionLevel:100,exposureLevel:60},autoDistribute:!0,autoDeprecateOld:!0,keepTopExecuted:3})},className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded-lg text-gray-300 hover:text-white transition-colors text-sm",children:"\u6062\u590d\u9ed8\u8ba4"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:t,className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded-lg text-gray-300 hover:text-white transition-colors text-sm",children:"\u53d6\u6d88"}),o.jsx("button",{onClick:()=>{s(r)},className:"px-6 py-2 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 rounded-lg text-white font-semibold text-sm transition-all duration-200",children:"\u4fdd\u5b58\u8bbe\u7f6e"})]})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"})]})}):null},ie=({currentTheme:e,allThemes:t,onCreateTheme:n,onActivateTheme:s,onDeleteTheme:r})=>{const[a,l]=x.useState(!1),[i,c]=x.useState({name:"",description:"",icon:"\ud83c\udfad",themeSettings:{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:[],goals:[],status:"upcoming"}),d=e=>{switch(e){case"active":return"border-green-500 bg-green-500/10";case"upcoming":return"border-blue-500 bg-blue-500/10";case"completed":return"border-gray-500 bg-gray-500/10"}},u=e=>{switch(e){case"active":return"\u2705 \u8fdb\u884c\u4e2d";case"upcoming":return"\u23f3 \u672a\u5f00\u59cb";case"completed":return"\u2714\ufe0f \u5df2\u5b8c\u6210"}};return o.jsxs("div",{className:"space-y-4",children:[e&&o.jsxs("div",{className:"p-4 rounded-lg border-2 border-pink-500 bg-gradient-to-br from-pink-500/20 to-purple-500/20",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-4xl",children:e.icon}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-pink-300",children:e.name}),o.jsx("p",{className:"text-sm text-gray-400",children:"\u5f53\u524d\u4e3b\u9898\u5468"})]})]}),o.jsx("span",{className:"px-3 py-1 rounded-full bg-green-500/20 text-green-300 text-sm",children:u(e.status)})]}),o.jsx("p",{className:"text-gray-300 mb-3",children:e.description}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"\u7f9e\u803b\u52a0\u6210"}),o.jsxs("p",{className:"text-lg font-bold text-pink-300",children:["+",e.themeSettings.shameBonus,"%"]})]}),o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"\u670d\u4ece\u52a0\u6210"}),o.jsxs("p",{className:"text-lg font-bold text-purple-300",children:["+",e.themeSettings.submissionBonus,"%"]})]}),o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded text-center",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"\u9732\u51fa\u52a0\u6210"}),o.jsxs("p",{className:"text-lg font-bold text-red-300",children:["+",e.themeSettings.exposureBonus,"%"]})]})]}),e.goals.length>0&&o.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"\u4e3b\u9898\u76ee\u6807:"}),o.jsx("ul",{className:"space-y-1",children:e.goals.map((e,t)=>o.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[o.jsx("span",{children:e.completed?"\u2705":"\u2b55"}),o.jsx("span",{className:e.completed?"text-green-300":"text-gray-300",children:e.description})]},t))})]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h4",{className:"text-lg font-bold text-cyan-300",children:"\u6240\u6709\u4e3b\u9898\u5468"}),o.jsxs("button",{onClick:()=>l(!0),className:"px-3 py-1.5 bg-pink-600/30 hover:bg-pink-500/40 border border-pink-500/50 rounded text-pink-300 hover:text-pink-200 transition-colors text-sm",children:[o.jsx("i",{className:"fa-solid fa-plus mr-1"}),"\u521b\u5efa\u65b0\u4e3b\u9898"]})]}),o.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto scrollbar-xianxia",children:t.map(e=>o.jsx("div",{className:`p-3 rounded-lg border-2 ${d(e.status)} transition-all`,children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[o.jsx("span",{className:"text-2xl",children:e.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h5",{className:"font-bold text-white",children:e.name}),o.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-stone-700/50 text-gray-300",children:u(e.status)})]}),o.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:e.description}),o.jsxs("div",{className:"flex gap-2 mt-2 text-xs",children:[o.jsxs("span",{className:"text-pink-300",children:["\u7f9e\u803b+",e.themeSettings.shameBonus,"%"]}),o.jsxs("span",{className:"text-purple-300",children:["\u670d\u4ece+",e.themeSettings.submissionBonus,"%"]}),o.jsxs("span",{className:"text-red-300",children:["\u9732\u51fa+",e.themeSettings.exposureBonus,"%"]})]})]})]}),o.jsxs("div",{className:"flex gap-2",children:["upcoming"===e.status&&o.jsx("button",{onClick:()=>s(e.id),className:"px-2 py-1 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 transition-colors",children:"\u542f\u7528"}),"active"!==e.status&&o.jsx("button",{onClick:()=>r(e.id),className:"px-2 py-1 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 transition-colors",children:"\u5220\u9664"})]})]})},e.id))})]}),a&&o.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>l(!1),children:o.jsxs("div",{className:"bg-stone-900 border-2 border-pink-500 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[o.jsx("h3",{className:"text-2xl font-bold text-pink-300 mb-4",children:"\u521b\u5efa\u65b0\u4e3b\u9898\u5468"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u4e3b\u9898\u540d\u79f0"}),o.jsx("input",{type:"text",value:i.name,onChange:e=>c({...i,name:e.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none",placeholder:"\u4f8b\u5982: \u7f9e\u8fb1\u5468\u3001\u670d\u4ece\u5468"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u4e3b\u9898\u56fe\u6807"}),o.jsx("input",{type:"text",value:i.icon,onChange:e=>c({...i,icon:e.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none",placeholder:"\u8f93\u5165emoji\u56fe\u6807"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u4e3b\u9898\u63cf\u8ff0"}),o.jsx("textarea",{value:i.description,onChange:e=>c({...i,description:e.target.value}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none resize-none",rows:3,placeholder:"\u63cf\u8ff0\u8fd9\u4e2a\u4e3b\u9898\u5468\u7684\u7279\u8272..."})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u7f9e\u803b\u52a0\u6210 (%)"}),o.jsx("input",{type:"number",min:"0",max:"50",value:i.themeSettings?.shameBonus,onChange:e=>c({...i,themeSettings:{...i.themeSettings,shameBonus:Number(e.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u670d\u4ece\u52a0\u6210 (%)"}),o.jsx("input",{type:"number",min:"0",max:"50",value:i.themeSettings?.submissionBonus,onChange:e=>c({...i,themeSettings:{...i.themeSettings,submissionBonus:Number(e.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u9732\u51fa\u52a0\u6210 (%)"}),o.jsx("input",{type:"number",min:"0",max:"50",value:i.themeSettings?.exposureBonus,onChange:e=>c({...i,themeSettings:{...i.themeSettings,exposureBonus:Number(e.target.value)}}),className:"w-full px-3 py-2 bg-stone-800 border border-stone-600 rounded text-white focus:border-pink-500 focus:outline-none"})]})]}),o.jsxs("div",{className:"flex gap-3 pt-4",children:[o.jsx("button",{onClick:()=>{if(!i.name||!i.description)return void alert("\u8bf7\u586b\u5199\u4e3b\u9898\u540d\u79f0\u548c\u63cf\u8ff0\uff01");const e=Date.now();n({name:i.name,description:i.description,icon:i.icon||"\ud83c\udfad",startTime:e,endTime:e+6048e5,status:"upcoming",themeSettings:i.themeSettings||{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:i.specialRequirements||[],goals:i.goals||[]}),l(!1),c({name:"",description:"",icon:"\ud83c\udfad",themeSettings:{shameBonus:20,submissionBonus:20,exposureBonus:20},specialRequirements:[],goals:[],status:"upcoming"})},className:"flex-1 px-4 py-2 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 rounded text-white font-semibold transition-all",children:"\u521b\u5efa\u4e3b\u9898"}),o.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-stone-700 hover:bg-stone-600 rounded text-gray-300 transition-colors",children:"\u53d6\u6d88"})]})]})]})})]})},oe=({type:e})=>o.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[o.jsx("div",{className:"text-5xl mb-4",children:"language"===e?"\ud83d\udcac":"\ud83d\udc57"}),o.jsxs("p",{className:"text-lg mb-2",children:["\u6682\u65e0","language"===e?"\u8bed\u8a00":"\u884c\u4e3a\u7740\u88c5","\u94c1\u5f8b"]}),o.jsx("p",{className:"text-sm",children:"\u8bf7\u6307\u6d3e\u8bbe\u8ba1\u5e08\u5e76\u5237\u65b0\u793c\u4eea\uff0c\u6216\u624b\u52a8\u6dfb\u52a0"})]}),ce=({etiquette:e,isExpanded:t,onToggleExpand:n,onDeprecate:s,onDistribute:r,onRecall:a})=>o.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border transition-all duration-200 "+("active"===e.status?"border-pink-500/30 bg-stone-800/50 hover:border-pink-500/50":"border-stone-700/50 bg-stone-800/30 opacity-60"),children:[o.jsx("div",{className:"flex items-start justify-between",children:o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[o.jsxs("span",{className:"text-pink-400 font-mono text-xs",children:["#",e.id]}),o.jsx("h4",{className:"font-bold text-white text-sm sm:text-base",children:e.name}),o.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${{active:"text-green-400 bg-green-500/20",pending:"text-yellow-400 bg-yellow-500/20",deprecated:"text-gray-500 bg-gray-500/20"}[e.status]}`,children:"active"===e.status?"\u2705 \u751f\u6548\u4e2d":"pending"===e.status?"\u23f3 \u5f85\u4e0b\u53d1":"\u274c \u5df2\u5e9f\u9664"})]}),o.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 text-xs text-gray-400 mb-2",children:[o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["\ud83d\udccd ",X[e.scene]]}),o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs hidden sm:inline",children:["\ud83d\udc65 ",e.applicableRoles.join(", ")]}),o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["\ud83d\udcca ",e.executionCount,"\u6b21"]})]}),o.jsx("p",{className:"text-gray-300 text-sm "+(t?"":"line-clamp-2"),children:e.content}),t&&e.examples&&e.examples.length>0&&o.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded-lg",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"\u793a\u4f8b\u7528\u8bed:"}),o.jsx("ul",{className:"space-y-1",children:e.examples.map((e,t)=>o.jsxs("li",{className:"text-sm text-pink-300 italic",children:['"',e,'"']},t))})]})]})}),e.isDistributed&&e.distributions&&e.distributions.length>0&&o.jsxs("div",{className:"mt-2 p-1.5 sm:p-2 bg-green-900/20 rounded border border-green-500/30",children:[o.jsx("p",{className:"text-xs text-green-400 mb-1",children:"\u2705 \u5df2\u5206\u53d1"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:e.distributions.filter(e=>"distributed"===e.status).map((e,t)=>o.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-300 rounded",children:e.shopType},t))})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-3 pt-3 border-t border-stone-700/50 gap-2",children:[o.jsx("button",{onClick:n,className:"text-xs text-gray-400 hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-0 flex items-center",children:t?"\u6536\u8d77 \u25b2":"\u5c55\u5f00 \u25bc"}),o.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto",children:[e.isDistributed?o.jsx("button",{onClick:a,className:"px-2 py-1.5 text-xs bg-orange-600/30 hover:bg-orange-500/40 rounded text-orange-300 hover:text-orange-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\udce5 \u64a4\u56de"}):o.jsx("button",{onClick:r,className:"px-2 py-1.5 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 hover:text-green-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\udce4 \u5206\u53d1"}),o.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"\ud83d\udc41\ufe0f \u9884\u89c8"}),o.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"\u270f\ufe0f \u5fae\u8c03"}),"active"===e.status&&!e.isDistributed&&o.jsx("button",{onClick:s,className:"px-2 py-1.5 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\uddd1\ufe0f \u5e9f\u9664"})]})]})]}),de=({etiquette:e,isExpanded:t,onToggleExpand:n,onDeprecate:s,onDistribute:r,onRecall:a})=>o.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border transition-all duration-200 "+("active"===e.status?"border-purple-500/30 bg-stone-800/50 hover:border-purple-500/50":"border-stone-700/50 bg-stone-800/30 opacity-60"),children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[o.jsxs("span",{className:"text-purple-400 font-mono text-xs",children:["#",e.id]}),o.jsx("h4",{className:"font-bold text-white text-sm sm:text-base",children:e.name}),o.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${{active:"text-green-400 bg-green-500/20",pending:"text-yellow-400 bg-yellow-500/20",deprecated:"text-gray-500 bg-gray-500/20"}[e.status]}`,children:"active"===e.status?"\u2705 \u751f\u6548\u4e2d":"pending"===e.status?"\u23f3 \u5f85\u4e0b\u53d1":"\u274c \u5df2\u5e9f\u9664"})]}),o.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 text-xs text-gray-400 mb-2",children:[o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["\ud83d\udccd ",X[e.scene]]}),o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs hidden sm:inline",children:["\ud83d\udc65 ",e.applicableRoles.join(", ")]}),o.jsxs("span",{className:"px-1.5 py-0.5 sm:px-2 bg-stone-700/50 rounded text-xs",children:["\ud83d\udcca ",e.executionCount,"\u6b21"]})]}),o.jsxs("div",{className:"mb-2",children:[o.jsx("p",{className:"text-xs text-purple-300 mb-1",children:"\ud83d\udc57 \u7740\u88c5\u8981\u6c42:"}),o.jsxs("div",{className:"text-gray-300 text-sm space-y-1 "+(t?"":"line-clamp-2"),children:[e.dressCode.upper&&o.jsxs("p",{children:["\u2022 \u4e0a\u8eab: ",e.dressCode.upper]}),e.dressCode.lower&&o.jsxs("p",{children:["\u2022 \u4e0b\u8eab: ",e.dressCode.lower]}),e.dressCode.accessories&&e.dressCode.accessories.length>0&&o.jsxs("p",{children:["\u2022 \u914d\u9970: ",e.dressCode.accessories.join(", ")]}),e.dressCode.special&&o.jsxs("p",{children:["\u2022 \u7279\u6b8a: ",e.dressCode.special]})]})]}),t&&e.behaviorRules.length>0&&o.jsxs("div",{className:"mt-3 p-3 bg-stone-900/50 rounded-lg",children:[o.jsx("p",{className:"text-xs text-purple-300 mb-2",children:"\ud83c\udfad \u884c\u4e3a\u8981\u6c42:"}),o.jsx("ul",{className:"space-y-1",children:e.behaviorRules.map((e,t)=>o.jsxs("li",{className:"text-sm text-gray-300",children:["\u2022 ",e]},t))})]})]}),e.isDistributed&&e.distributions&&e.distributions.length>0&&o.jsxs("div",{className:"mt-2 p-2 bg-green-900/20 rounded border border-green-500/30",children:[o.jsx("p",{className:"text-xs text-green-400 mb-1",children:"\u2705 \u5df2\u5206\u53d1\u5230\uff1a"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:e.distributions.filter(e=>"distributed"===e.status).map((e,t)=>o.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-500/20 text-green-300 rounded",children:e.shopType},t))})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-3 pt-3 border-t border-stone-700/50 gap-2",children:[o.jsx("button",{onClick:n,className:"text-xs text-gray-400 hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-0 flex items-center",children:t?"\u6536\u8d77 \u25b2":"\u5c55\u5f00 \u25bc"}),o.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto",children:[e.isDistributed?o.jsx("button",{onClick:a,className:"px-2 py-1.5 text-xs bg-orange-600/30 hover:bg-orange-500/40 rounded text-orange-300 hover:text-orange-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\udce5 \u64a4\u56de"}):o.jsx("button",{onClick:r,className:"px-2 py-1.5 text-xs bg-green-600/30 hover:bg-green-500/40 rounded text-green-300 hover:text-green-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\udce4 \u5206\u53d1"}),o.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"\ud83d\udc41\ufe0f \u9884\u89c8"}),o.jsx("button",{className:"px-2 py-1.5 text-xs bg-stone-700/50 hover:bg-stone-600/50 rounded text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0 hidden sm:inline-block",children:"\u270f\ufe0f \u5fae\u8c03"}),"active"===e.status&&!e.isDistributed&&o.jsx("button",{onClick:s,className:"px-2 py-1.5 text-xs bg-red-900/30 hover:bg-red-800/40 rounded text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\uddd1\ufe0f \u5e9f\u9664"})]})]})]}),ue=({isOpen:e,onClose:t,etiquetteSystem:n,onUpdateEtiquetteSystem:s,cardCollection:r,onOpenDesignerSelection:a,gameState:l})=>{const[i,c]=x.useState("theme"),[d,u]=x.useState("all"),[m,p]=x.useState(!1),[h,f]=x.useState(null),[g,b]=x.useState(!1),y=x.useMemo(()=>n.designer&&r.find(e=>e.id===n.designer?.characterId)||null,[n.designer,r]),v=x.useMemo(()=>{if(!n.designer||!n.settings.autoRefreshEnabled)return null;const e=(n.settings.lastRefreshTime||Date.now())+24*n.settings.refreshIntervalDays*60*60*1e3-Date.now();if(e<=0)return{text:"\u53ef\u7acb\u5373\u5237\u65b0",canRefresh:!0};return{text:`${Math.floor(e/864e5)}\u5929 ${Math.floor(e%864e5/36e5)}\u5c0f\u65f6`,canRefresh:!1}},[n.designer,n.settings]),j=x.useMemo(()=>"all"===d?n.languageEtiquettes:n.languageEtiquettes.filter(e=>e.scene===d),[n.languageEtiquettes,d]),N=x.useMemo(()=>"all"===d?n.behaviorDressEtiquettes:n.behaviorDressEtiquettes.filter(e=>e.scene===d),[n.behaviorDressEtiquettes,d]),w=x.useMemo(()=>({totalActive:n.languageEtiquettes.filter(e=>"active"===e.status).length+n.behaviorDressEtiquettes.filter(e=>"active"===e.status).length,languageCount:n.languageEtiquettes.length,behaviorCount:n.behaviorDressEtiquettes.length}),[n]),k=(e,t)=>{if(confirm("\u786e\u5b9a\u8981\u5e9f\u9664\u8fd9\u6761\u793c\u4eea\u5417\uff1f"))if("language"===t){const t=n.languageEtiquettes.map(t=>t.id===e?{...t,status:"deprecated",updatedAt:Date.now()}:t);s({...n,languageEtiquettes:t})}else{const t=n.behaviorDressEtiquettes.map(t=>t.id===e?{...t,status:"deprecated",updatedAt:Date.now()}:t);s({...n,behaviorDressEtiquettes:t})}},C=(e,t)=>{const r="language"===t?n.languageEtiquettes.find(t=>t.id===e):n.behaviorDressEtiquettes.find(t=>t.id===e);if(!r)return;const a=Y[r.scene];if(!a)return void alert("\u901a\u7528\u793c\u4eea\u9700\u8981\u624b\u52a8\u9009\u62e9\u5206\u53d1\u76ee\u6807\uff0c\u6b64\u529f\u80fd\u6b63\u5728\u5f00\u53d1\u4e2d...");const l=Z[r.scene]||[],i={shopType:a,positionIds:l.map(e=>e.id),distributedAt:Date.now(),distributedBy:n.designer?.characterId,status:"distributed"};if("language"===t){const t=n.languageEtiquettes.map(t=>t.id===e?{...t,distributions:[...t.distributions||[],i],isDistributed:!0,updatedAt:Date.now()}:t);s({...n,languageEtiquettes:t})}else{const t=n.behaviorDressEtiquettes.map(t=>t.id===e?{...t,distributions:[...t.distributions||[],i],isDistributed:!0,updatedAt:Date.now()}:t);s({...n,behaviorDressEtiquettes:t})}alert(`\u2705 \u793c\u4eea\u5df2\u5206\u53d1\u5230\u3010${a}\u3011\uff01\n\n\u9002\u7528\u5c97\u4f4d\uff1a${l.map(e=>e.name).join("\u3001")||"\u5168\u90e8"}`)},S=(e,t)=>{if(confirm("\u786e\u5b9a\u8981\u64a4\u56de\u8fd9\u6761\u793c\u4eea\u5417\uff1f\u64a4\u56de\u540e\u5e97\u94fa\u5c06\u4e0d\u518d\u6267\u884c\u6b64\u793c\u4eea\u3002")){if("language"===t){const t=n.languageEtiquettes.map(t=>t.id===e?{...t,distributions:(t.distributions||[]).map(e=>({...e,status:"recalled",recalledAt:Date.now()})),isDistributed:!1,updatedAt:Date.now()}:t);s({...n,languageEtiquettes:t})}else{const t=n.behaviorDressEtiquettes.map(t=>t.id===e?{...t,distributions:(t.distributions||[]).map(e=>({...e,status:"recalled",recalledAt:Date.now()})),isDistributed:!1,updatedAt:Date.now()}:t);s({...n,behaviorDressEtiquettes:t})}alert("\u2705 \u793c\u4eea\u5df2\u64a4\u56de\uff01")}};return e?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-0 sm:p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full h-full sm:h-[90vh] sm:max-w-6xl sm:rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col animate-slide-in",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-3 sm:p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[o.jsx("h2",{className:"text-lg sm:text-2xl font-bold text-gradient-gold text-shadow-glow font-serif tracking-widest",children:"\ud83c\udf80 \u793c\u4eea\u8bbe\u8ba1\u9986"}),o.jsxs("button",{onClick:()=>p(!0),className:"px-2 py-1 sm:px-3 sm:py-1.5 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-pink-500/50 rounded-lg text-gray-300 hover:text-pink-300 transition-all duration-200 text-xs sm:text-sm flex items-center gap-1 sm:gap-2",children:[o.jsx("i",{className:"fa-solid fa-gear"}),"\u8bbe\u7f6e"]})]}),o.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:o.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]}),o.jsxs("div",{className:"flex-grow flex flex-col sm:flex-row overflow-hidden",children:[o.jsxs("div",{className:"w-full sm:w-72 flex-shrink-0 border-b sm:border-b-0 sm:border-r border-stone-700/50 flex flex-col bg-black/10 max-h-56 sm:max-h-none overflow-y-auto sm:overflow-y-visible",children:[o.jsxs("div",{className:"p-2 sm:p-4 border-b border-stone-700/50",children:[o.jsxs("h3",{className:"text-base sm:text-lg font-bold text-pink-300 mb-2 sm:mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-user-pen"}),"\u793c\u4eea\u8bbe\u8ba1\u5e08"]}),y?o.jsxs("div",{className:`p-2 sm:p-3 rounded-lg border-2 ${M(y.rarity)} bg-stone-800/50`,children:[o.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[o.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-stone-700 flex items-center justify-center text-xl sm:text-2xl flex-shrink-0",children:"Female"===y.gender?"\ud83d\udc69":"\ud83d\udc68"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"font-bold text-white truncate text-sm sm:text-base",children:y.name}),o.jsx("p",{className:`text-xs ${L(y.rarity)}`,children:y.realm})]})]}),n.designer&&o.jsxs("div",{className:"mt-2 sm:mt-3 space-y-1 text-xs text-gray-400",children:[o.jsxs("p",{className:"truncate",children:["\ud83d\udcca \u5df2\u8bbe\u8ba1: ",o.jsx("span",{className:"text-pink-300",children:n.designer.designCount})," \u6761"]}),o.jsxs("p",{className:"truncate hidden sm:block",children:["\u2b50 \u8d28\u91cf: ",o.jsxs("span",{className:"ml-1 text-yellow-400",children:["\u2605".repeat(Math.floor(n.designer.qualityScore/20)),"\u2606".repeat(5-Math.floor(n.designer.qualityScore/20))]})]})]}),o.jsxs("div",{className:"mt-2 sm:mt-3 flex gap-1 sm:gap-2",children:[o.jsx("button",{onClick:a,className:"flex-1 px-2 py-1 sm:py-1.5 bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 rounded text-xs text-gray-300 hover:text-white transition-colors min-h-[44px] sm:min-h-0",children:"\ud83d\udd04 \u66f4\u6362"}),o.jsx("button",{onClick:()=>{confirm("\u786e\u5b9a\u8981\u79fb\u9664\u5f53\u524d\u8bbe\u8ba1\u5e08\u5417\uff1f")&&s({...n,designer:null})},className:"flex-1 px-2 py-1 sm:py-1.5 bg-red-900/30 hover:bg-red-800/40 border border-red-700/50 rounded text-xs text-red-300 hover:text-red-200 transition-colors min-h-[44px] sm:min-h-0",children:"\u274c \u79fb\u9664"})]})]}):o.jsxs("div",{className:"p-2 sm:p-4 rounded-lg border-2 border-dashed border-stone-600 bg-stone-800/30 text-center",children:[o.jsx("div",{className:"text-2xl sm:text-4xl mb-1 sm:mb-2",children:"\ud83d\udc64"}),o.jsx("p",{className:"text-gray-400 text-xs sm:text-sm mb-2 sm:mb-3",children:"\u672a\u6307\u6d3e\u8bbe\u8ba1\u5e08"}),o.jsx("p",{className:"text-yellow-500 text-xs mb-2 sm:mb-3 hidden sm:block",children:"\ud83d\udca1 \u81ea\u52a8\u5237\u65b0\u5df2\u6682\u505c"}),o.jsx("button",{onClick:a,className:"w-full px-2 py-2 sm:px-3 bg-pink-600/30 hover:bg-pink-500/40 border border-pink-500/50 rounded-lg text-pink-300 hover:text-pink-200 transition-colors text-xs sm:text-sm min-h-[44px]",children:"\ud83d\udccb \u9009\u62e9\u8bbe\u8ba1\u5e08"})]})]}),o.jsxs("div",{className:"p-2 sm:p-4 flex-1 hidden sm:block",children:[o.jsxs("h3",{className:"text-base sm:text-lg font-bold text-cyan-300 mb-2 sm:mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-chart-line"}),"\u8fd0\u884c\u72b6\u6001"]}),o.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-400 text-sm",children:"\u7cfb\u7edf\u72b6\u6001:"}),n.designer?o.jsxs("span",{className:"text-green-400 text-sm flex items-center gap-1",children:[o.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"\u8fd0\u884c\u4e2d"]}):o.jsxs("span",{className:"text-red-400 text-sm flex items-center gap-1",children:[o.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),"\u5df2\u6682\u505c"]})]}),v&&o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-400 text-sm",children:"\u4e0b\u6b21\u5237\u65b0:"}),o.jsxs("span",{className:"text-amber-300 text-sm",children:["\u23f3 ",v.text]})]}),o.jsxs("div",{className:"mt-4 p-3 bg-stone-800/50 rounded-lg space-y-2",children:[o.jsxs("p",{className:"text-gray-300 text-sm",children:["\ud83d\udcdc \u5f53\u524d\u751f\u6548\u793c\u4eea: ",o.jsx("span",{className:"text-pink-300 font-bold",children:w.totalActive})," \u6761"]}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["\u2022 \u8bed\u8a00\u94c1\u5f8b: ",w.languageCount," \u6761"]}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["\u2022 \u884c\u4e3a\u7740\u88c5\u94c1\u5f8b: ",w.behaviorCount," \u6761"]})]}),o.jsx("div",{className:"mt-3 sm:mt-4 space-y-2",children:o.jsxs("button",{onClick:async()=>{if(!n.designer)return void alert("\u8bf7\u5148\u6307\u6d3e\u793c\u4eea\u8bbe\u8ba1\u5e08\uff01");if(g)return;if(confirm(`\u5373\u5c06\u751f\u6210\u65b0\u793c\u4eea\uff1a\n\u2022 \u8bed\u8a00\u94c1\u5f8b: ${n.settings.languageEtiquetteCount} \u6761\n\u2022 \u884c\u4e3a\u7740\u88c5\u94c1\u5f8b: ${n.settings.behaviorDressEtiquetteCount} \u6761\n\n\u786e\u5b9a\u8981\u5237\u65b0\u5417\uff1f`)){b(!0);try{const e=await re(n,l);s(e),alert(`\u2705 \u793c\u4eea\u5237\u65b0\u6210\u529f\uff01\n\n\u2022 \u65b0\u589e\u8bed\u8a00\u94c1\u5f8b: ${e.languageEtiquettes.filter(t=>"active"===t.status&&t.createdAt===e.settings.lastRefreshTime).length} \u6761\n\u2022 \u65b0\u589e\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b: ${e.behaviorDressEtiquettes.filter(t=>"active"===t.status&&t.createdAt===e.settings.lastRefreshTime).length} \u6761`)}catch(e){console.error("[\u793c\u4eea\u9986] \u793c\u4eea\u5237\u65b0\u5931\u8d25:",e),alert(`\u274c \u793c\u4eea\u5237\u65b0\u5931\u8d25\uff1a${e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"}\n\n\u8bf7\u68c0\u67e5\u662f\u5426\u5df2\u6b63\u786e\u914d\u7f6eAI\u751f\u6210\u670d\u52a1\u3002`)}finally{b(!1)}}},disabled:!n.designer||g,className:"w-full px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-200 flex items-center justify-center gap-2 "+(n.designer&&!g?"bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white":"bg-stone-700/50 text-gray-500 cursor-not-allowed"),children:[o.jsx("i",{className:"fa-solid "+(g?"fa-spinner fa-spin":"fa-rotate")}),g?"\u751f\u6210\u4e2d...":"\u7acb\u5373\u5237\u65b0\u6240\u6709\u793c\u4eea"]})})]})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden w-full",children:[o.jsx("div",{className:"flex-shrink-0 p-2 sm:p-4 border-b border-stone-700/50 bg-black/10",children:o.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap w-full sm:w-auto overflow-x-auto scrollbar-hide",children:[o.jsx("button",{onClick:()=>c("theme"),className:"px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 "+("theme"===i?"bg-cyan-500/20 text-cyan-300 border border-cyan-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"),children:"\ud83c\udfad \u4e3b\u9898"}),o.jsx("button",{onClick:()=>c("workbench"),className:"px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 "+("workbench"===i?"bg-purple-500/20 text-purple-300 border border-purple-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"),children:"\ud83d\udccb \u5de5\u4f5c"}),o.jsx("button",{onClick:()=>c("language"),className:"px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 "+("language"===i?"bg-pink-500/20 text-pink-300 border border-pink-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"),children:"\ud83d\udcac \u8bed\u8a00"}),o.jsx("button",{onClick:()=>c("behavior_dress"),className:"px-2 py-1.5 sm:px-4 sm:py-2 rounded-lg text-xs sm:text-sm font-semibold transition-all duration-200 whitespace-nowrap min-h-[44px] sm:min-h-0 "+("behavior_dress"===i?"bg-amber-500/20 text-amber-300 border border-amber-500/50":"bg-stone-700/30 text-gray-400 hover:text-gray-300 border border-transparent"),children:"\ud83d\udc57 \u7740\u88c5"})]}),o.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 w-full sm:w-auto",children:[o.jsx("span",{className:"text-gray-400 text-xs sm:text-sm whitespace-nowrap",children:"\u573a\u666f:"}),o.jsxs("select",{value:d,onChange:e=>u(e.target.value),className:"flex-1 sm:flex-none px-2 py-1.5 sm:px-3 bg-stone-700/50 border border-stone-600 rounded-lg text-gray-300 text-xs sm:text-sm focus:outline-none focus:border-pink-500/50 min-h-[44px] sm:min-h-0",children:[o.jsx("option",{value:"all",children:"\u5168\u90e8"}),Object.entries(X).map(([e,t])=>o.jsx("option",{value:e,children:t},e))]})]})]})}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-4 space-y-3 sm:space-y-4 scrollbar-xianxia",children:["theme"===i?o.jsx(ie,{currentTheme:n.currentTheme,allThemes:n.weeklyThemes,onCreateTheme:e=>{const t={...e,id:`theme_${Date.now()}`,createdAt:Date.now(),designedBy:n.designer?.characterId};s({...n,weeklyThemes:[...n.weeklyThemes,t]})},onActivateTheme:e=>{const t=n.weeklyThemes.find(t=>t.id===e);if(!t)return;const r=n.weeklyThemes.map(t=>"active"===t.status?{...t,status:"completed"}:t.id===e?{...t,status:"active",startTime:Date.now(),endTime:Date.now()+6048e5}:t);s({...n,weeklyThemes:r,currentTheme:{...t,status:"active",startTime:Date.now(),endTime:Date.now()+6048e5}})},onDeleteTheme:e=>{if(!confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u4e3b\u9898\u5417\uff1f"))return;const t=n.weeklyThemes.filter(t=>t.id!==e);s({...n,weeklyThemes:t})}}):"workbench"===i?o.jsx(ae,{workbench:n.designerWorkbench,designer:y,availableThemes:n.weeklyThemes.filter(e=>"upcoming"===e.status),onUpdateWorkbench:e=>s({...n,designerWorkbench:e}),onCreateWorkItem:e=>{if(!n.designerWorkbench)return;const t={...e,id:`work_${Date.now()}`,createdAt:Date.now(),updatedAt:Date.now()};s({...n,designerWorkbench:{...n.designerWorkbench,workItems:[...n.designerWorkbench.workItems,t],totalWeeksPlanned:n.designerWorkbench.totalWeeksPlanned+1}})}}):"language"===i?j.length>0?j.map(e=>o.jsx(ce,{etiquette:e,isExpanded:h===e.id,onToggleExpand:()=>f(h===e.id?null:e.id),onDeprecate:()=>k(e.id,"language"),onDistribute:()=>C(e.id,"language"),onRecall:()=>S(e.id,"language")},e.id)):o.jsx(oe,{type:"language"}):N.length>0?N.map(e=>o.jsx(de,{etiquette:e,isExpanded:h===e.id,onToggleExpand:()=>f(h===e.id?null:e.id),onDeprecate:()=>k(e.id,"behavior_dress"),onDistribute:()=>C(e.id,"behavior_dress"),onRecall:()=>S(e.id,"behavior_dress")},e.id)):o.jsx(oe,{type:"behavior_dress"}),o.jsxs("button",{className:"w-full p-3 sm:p-4 border-2 border-dashed border-stone-600 hover:border-pink-500/50 rounded-lg text-gray-400 hover:text-pink-300 transition-colors flex items-center justify-center gap-2 min-h-[44px] text-xs sm:text-sm",children:[o.jsx("i",{className:"fa-solid fa-plus"}),"language"===i?"\u6dfb\u52a0\u8bed\u8a00\u94c1\u5f8b":"\u6dfb\u52a0\u884c\u4e3a\u7740\u88c5\u94c1\u5f8b"]})]})]})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-pink-400 to-transparent"})]})}),o.jsx(le,{isOpen:m,onClose:()=>p(!1),settings:n.settings,onSave:e=>{s({...n,settings:e}),p(!1)}})]}):null},me=(e,t)=>t.some(t=>e instanceof t);let xe,pe;const he=new WeakMap,fe=new WeakMap,ge=new WeakMap;let be={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return he.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ye(e){be=e(be)}function ve(e){return(pe||(pe=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(we(this),t),Ne(this.request)}:function(...t){return Ne(e.apply(we(this),t))}}function je(e){return"function"==typeof e?ve(e):(e instanceof IDBTransaction&&function(e){if(he.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",a),e.removeEventListener("abort",a)},r=()=>{t(),s()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",a),e.addEventListener("abort",a)});he.set(e,t)}(e),me(e,xe||(xe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,be):e)}function Ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",a)},r=()=>{t(Ne(e.result)),s()},a=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",a)});return ge.set(t,e),t}(e);if(fe.has(e))return fe.get(e);const t=je(e);return t!==e&&(fe.set(e,t),ge.set(t,e)),t}const we=e=>ge.get(e);const ke=["get","getKey","getAll","getAllKeys","count"],Ce=["put","add","delete","clear"],Se=new Map;function Ee(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Se.get(t))return Se.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=Ce.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!ke.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,r?"readwrite":"readonly");let l=a.store;return s&&(l=l.index(t.shift())),(await Promise.all([l[n](...t),r&&a.done]))[0]};return Se.set(t,a),a}ye(e=>({...e,get:(t,n,s)=>Ee(t,n)||e.get(t,n,s),has:(t,n)=>!!Ee(t,n)||e.has(t,n)}));const Pe=["continue","continuePrimaryKey","advance"],$e={},_e=new WeakMap,De=new WeakMap,Le={get(e,t){if(!Pe.includes(t))return e[t];let n=$e[t];return n||(n=$e[t]=function(...e){_e.set(this,De.get(this)[t](...e))}),n}};async function*Me(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,Le);for(De.set(n,t),ge.set(n,we(t));t;)yield n,t=await(_e.get(n)||t.continue()),_e.delete(n)}function Ae(e,t){return t===Symbol.asyncIterator&&me(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&me(e,[IDBIndex,IDBObjectStore])}function Te(e){const t=e||{monthlySchedule:1,registrationDuration:24,enableAutoGeneration:!0,preparationDuration:6},n=new Date,s=n.getFullYear(),r=n.getMonth();let a=new Date(s,r,t.monthlySchedule);return a.getTime()<n.getTime()&&(a=new Date(s,r+1,t.monthlySchedule)),a.getTime()}ye(e=>({...e,get:(t,n,s)=>Ae(t,n)?Me:e.get(t,n,s),has:(t,n)=>Ae(t,n)||e.has(t,n)}));const Ie={id:"s1",name:"\u9752\u7389\u5251\u8bc0",rarity:"\u826f\u54c1",description:"\u9752\u86c7\u5b97\u5165\u95e8\u5251\u6cd5\uff0c\u8bb2\u7a76\u5feb\u3001\u51c6\u3001\u72e0\uff0c\u76f4\u6307\u654c\u4eba\u8981\u5bb3\u3002",eroticDescription:"\u4f7f\u7528\u8005\u5c06\u7075\u6c14\u704c\u6ce8\u4e8e\u5251\u8eab\uff0c\u5251\u5203\u53d8\u5f97\u6eda\u70eb\u5e76\u53d1\u51fa\u5fae\u5149\u3002\u4ed6\u4e0d\u4f1a\u653b\u51fb\u81f4\u547d\u90e8\u4f4d\uff0c\u800c\u662f\u4ee5\u4e00\u4e2a\u4e0b\u6d41\u81f3\u6781\u7684\u89d2\u5ea6\uff0c\u7528\u6eda\u70eb\u7684\u5251\u8eab\u7cbe\u51c6\u5730\u5212\u5f00\u654c\u4eba\u7684\u8863\u5e26\uff0c\u6216\u76f4\u63a5\u70d9\u5728\u5bf9\u65b9\u7684\u654f\u611f\u808c\u80a4\u4e0a\uff0c\u7559\u4e0b\u5c48\u8fb1\u7684\u5370\u8bb0\u3002",mechanicsDescription:"\u9020\u6210115%\u653b\u51fb\u529b\u7684\u7269\u7406\u4f24\u5bb3\u3002",cost:15,genderLock:"Male"},Oe={id:"s2",name:"\u5ca9\u5c71\u76fe",rarity:"\u4f18\u54c1",description:"\u51dd\u805a\u5927\u5730\u7cbe\u534e\uff0c\u5316\u4e3a\u575a\u4e0d\u53ef\u6467\u7684\u62a4\u76fe\u3002",eroticDescription:"\u4f7f\u7528\u8005\u53cc\u817f\u5927\u5f00\uff0c\u9633\u521a\u7684\u7075\u529b\u8d2f\u5165\u5927\u5730\u3002\u4e00\u9762\u7c97\u7cd9\u7684\u77f3\u76fe\u62d4\u5730\u800c\u8d77\uff0c\u62a4\u5728\u8eab\u524d\u3002\u77f3\u76fe\u8868\u9762\u5e76\u975e\u5149\u6ed1\uff0c\u800c\u662f\u5e03\u6ee1\u4e86\u5927\u5c0f\u4e0d\u4e00\u3001\u5f62\u4f3c\u7537\u6027\u9633\u5177\u7684\u72f0\u72de\u51f8\u8d77\uff0c\u4efb\u4f55\u653b\u51fb\u90fd\u4f1a\u88ab\u8fd9\u4e9b\u201c\u77f3\u6839\u201d\u9876\u56de\u53bb\uff0c\u5145\u6ee1\u4e86\u6311\u8845\u4e0e\u7f9e\u8fb1\u7684\u610f\u5473\u3002",mechanicsDescription:"\u63d0\u5347\u81ea\u8eab30%\u9632\u5fa1\u529b\uff0c\u6301\u7eed3\u56de\u5408\u3002",cost:20,genderLock:"Male"},ze={id:"s3",name:"\u51e4\u706b\u672f",rarity:"\u826f\u54c1",description:"\u64cd\u63a7\u5982\u51e4\u51f0\u822c\u534e\u4e3d\u7684\u706b\u7130\uff0c\u711a\u70e7\u654c\u4eba\u3002",eroticDescription:"\u4f7f\u7528\u8005\u5a9a\u773c\u5982\u4e1d\uff0c\u626d\u52a8\u8170\u80a2\uff0c\u53cc\u817f\u4e4b\u95f4\u7adf\u55b7\u5c04\u51fa\u4e00\u80a1\u707c\u70ed\u7684\u7c89\u7ea2\u8272\u706b\u7130\u3002\u8fd9\u706b\u7130\u4e0d\u4ec5\u70e7\u707c\u654c\u4eba\u7684\u8089\u4f53\uff0c\u66f4\u6563\u53d1\u51fa\u6d53\u90c1\u7684\u50ac\u60c5\u9999\u6c14\uff0c\u8ba9\u654c\u4eba\u5728\u75db\u82e6\u4e0e\u6b32\u671b\u7684\u53cc\u91cd\u6298\u78e8\u4e2d\u610f\u5fd7\u5d29\u6e83\u3002",mechanicsDescription:"\u9020\u6210105%\u653b\u51fb\u529b\u7684\u706b\u7130\u4f24\u5bb3\uff0c\u5e76\u65bd\u52a0[\u707c\u70e7]\u6548\u679c\uff08\u6bcf\u56de\u5408\u635f\u59315%\u6700\u5927\u751f\u547d\u503c\uff09\uff0c\u6301\u7eed2\u56de\u5408\u3002",cost:18,genderLock:"Female"},Re={id:"s4",name:"\u4e5d\u5c3e\u5e7b\u672f",rarity:"\u4f18\u54c1",description:"\u4e5d\u5c3e\u72d0\u4e00\u65cf\u7684\u8840\u8109\u5929\u8d4b\uff0c\u80fd\u5236\u9020\u8db3\u4ee5\u4e71\u771f\u7684\u6deb\u9761\u5e7b\u5883\u3002",eroticDescription:"\u4f7f\u7528\u8005\u8eab\u540e\u4e5d\u6761\u6bdb\u8338\u8338\u7684\u72d0\u5c3e\u5982\u7075\u86c7\u822c\u4f38\u51fa\uff0c\u4e0d\u7531\u5206\u8bf4\u5730\u5c06\u654c\u4eba\u7d27\u7d27\u7f20\u7ed5\u3002\u72d0\u5c3e\u7684\u5c16\u7aef\u7cbe\u51c6\u5730\u627e\u5230\u5e76\u6414\u522e\u7740\u5bf9\u65b9\u6700\u654f\u611f\u7684\u90e8\u4f4d\uff0c\u540c\u65f6\u91ca\u653e\u51fa\u5f3a\u70c8\u7684\u5e7b\u672f\u7075\u529b\uff0c\u4f7f\u5176\u77ac\u95f4\u5815\u5165\u88ab\u65e0\u6570\u89e6\u624b\u548c\u5de8\u6839\u8f6e\u756a\u4fb5\u72af\u7684\u6deb\u4e71\u5e7b\u89c9\u4e4b\u4e2d\uff0c\u5f7b\u5e95\u4e27\u5931\u6218\u610f\u3002",mechanicsDescription:"\u670960%\u51e0\u7387\u4f7f\u654c\u4eba[\u6df7\u4e71]\uff08\u65e0\u6cd5\u884c\u52a8\uff09\uff0c\u6301\u7eed1\u56de\u5408\u3002",cost:25,genderLock:"Female"},Fe={id:"us1",name:"\u7075\u6c14\u56de\u590d",rarity:"\u51e1\u54c1",description:"\u6062\u590d\u5c11\u91cf\u771f\u5143\u3002",eroticDescription:"\u4f7f\u7528\u8005\u5f00\u59cb\u5a07\u5598\uff0c\u901a\u8fc7\u6a21\u62df\u6027\u9ad8\u6f6e\u7684\u65b9\u5f0f\u5feb\u901f\u805a\u96c6\u5468\u56f4\u7684\u7075\u6c14\uff0c\u8865\u5145\u81ea\u8eab\u3002",mechanicsDescription:"\u6062\u590d25\u70b9\u771f\u5143\u3002",cost:0,genderLock:"Universal"},qe={id:"us2",name:"\u57fa\u7840\u62f3\u6cd5",rarity:"\u51e1\u54c1",description:"\u9020\u6210\u5c11\u91cf\u7269\u7406\u4f24\u5bb3\u3002",eroticDescription:"\u770b\u4f3c\u666e\u901a\u7684\u62f3\u6cd5\uff0c\u4f46\u6bcf\u4e00\u62f3\u90fd\u7cbe\u51c6\u5730\u6253\u5411\u654c\u4eba\u7684\u4e0b\u4f53\uff0c\u8bd5\u56fe\u9020\u6210\u6700\u76f4\u63a5\u7684\u75db\u82e6\u548c\u7f9e\u8fb1\u3002",mechanicsDescription:"\u9020\u6210100%\u653b\u51fb\u529b\u7684\u7269\u7406\u4f24\u5bb3\u3002",cost:10,genderLock:"Universal"},Be={id:"us3",name:"\u5929\u96f7\u51fb",rarity:"\u73cd\u54c1",description:"\u5f15\u52a8\u4e5d\u5929\u795e\u96f7\uff0c\u5bf9\u654c\u4eba\u9020\u6210\u5de8\u5927\u4f24\u5bb3\u3002",eroticDescription:"\u4f7f\u7528\u8005\u9ad8\u4e3e\u53cc\u624b\uff0c\u53ec\u5524\u4e00\u9053\u7c97\u5927\u7684\u7d2b\u8272\u95ea\u7535\uff0c\u95ea\u7535\u5982\u4e00\u6761\u5de8\u9f99\u822c\u4ece\u5929\u800c\u964d\uff0c\u7cbe\u51c6\u5730\u8d2f\u7a7f\u654c\u4eba\u7684\u8eab\u4f53\uff0c\u4f7f\u5176\u6d51\u8eab\u62bd\u6410\uff0c\u53e3\u5410\u767d\u6cab\u3002",mechanicsDescription:"\u9020\u6210220%\u653b\u51fb\u529b\u7684\u96f7\u7535\u4f24\u5bb3\uff0c\u4f46\u81ea\u8eab[\u865a\u5f31]\uff08\u653b\u51fb\u529b\u964d\u4f4e20%\uff09\uff0c\u6301\u7eed2\u56de\u5408\u3002",cost:45,genderLock:"Male"},He={id:"us4",name:"\u51e4\u51f0\u6d85\u69c3",rarity:"\u7edd\u54c1",description:"\u6fd2\u6b7b\u65f6\u6709\u51e0\u7387\u6d74\u706b\u91cd\u751f\u3002",eroticDescription:"\u5728\u6b7b\u4ea1\u7684\u77ac\u95f4\uff0c\u4f7f\u7528\u8005\u5168\u8eab\u8863\u7269\u88ab\u706b\u7130\u70e7\u5c3d\uff0c\u8d64\u88f8\u7684\u8eab\u4f53\u5728\u70c8\u706b\u4e2d\u91cd\u5851\uff0c\u53d1\u51fa\u8bf1\u4eba\u7684\u547b\u541f\uff0c\u4ee5\u66f4\u5b8c\u7f8e\u3001\u66f4\u6deb\u8361\u7684\u59ff\u6001\u91cd\u751f\u3002",mechanicsDescription:"\u6c14\u8840\u4f4e\u4e8e15%\u65f6\uff0c\u670935%\u51e0\u7387\u6062\u590d60%\u6700\u5927\u6c14\u8840\u3002\u4e00\u573a\u6218\u6597\u53ea\u80fd\u89e6\u53d1\u4e00\u6b21\u3002",cost:100,genderLock:"Female"},Ue={id:"e1",name:"\u7834\u74dc\u4e4b\u5203",type:"Weapon",rarity:"\u51e1\u54c1",description:"\u4e00\u628a\u7c97\u7cd9\u7684\u94c1\u5251\uff0c\u5251\u67c4\u88ab\u8bbe\u8ba1\u6210\u9633\u5177\u7684\u5f62\u72b6\uff0c\u636e\u8bf4\u80fd\u8f7b\u6613\u5212\u7834\u5904\u5973\u7684\u8863\u7269\u3002",stats:{attack:5}},Ve={id:"e2",name:"\u5f00\u88c6\u5b66\u5f92\u888d",type:"Armor",rarity:"\u51e1\u54c1",description:"\u4e00\u4ef6\u666e\u901a\u7684\u5b66\u5f92\u888d\uff0c\u4f46\u88c6\u90e8\u88ab\u6545\u610f\u526a\u5f00\uff0c\u65b9\u4fbf\u968f\u65f6\u968f\u5730\u8fdb\u884c\u201c\u4fee\u70bc\u201d\u3002",stats:{hp:15,defense:3}},We={id:"e3",name:"\u50ac\u60c5\u6deb\u7eb9",type:"Accessory",rarity:"\u826f\u54c1",description:"\u4e00\u9053\u523b\u5728\u5c0f\u8179\u4e0a\u7684\u6deb\u7eb9\uff0c\u80fd\u8ba9\u4f69\u6234\u8005\u5728\u6218\u6597\u4e2d\u611f\u5230\u6301\u7eed\u7684\u6027\u5feb\u611f\uff0c\u4ece\u800c\u8eab\u6cd5\u66f4\u201c\u7075\u6d3b\u201d\u3002",stats:{speed:8}},Qe=[Ue,Ve,We,{id:"e4",name:"\u4e73\u9489\u9f9f\u7532",type:"Armor",rarity:"\u73cd\u54c1",description:"\u4ec5\u80fd\u906e\u4f4f\u80f8\u524d\u4e24\u70b9\u7684\u9f9f\u7532\u80f8\u7f69\uff0c\u4e0a\u9762\u7a7f\u6709\u4e73\u73af\uff0c\u6bcf\u6b21\u53d7\u5230\u653b\u51fb\u90fd\u4f1a\u62c9\u626f\u4e73\u5934\uff0c\u5e26\u6765\u75db\u5e76\u5feb\u4e50\u7684\u523a\u6fc0\u3002",stats:{hp:80,defense:35}},{id:"e5",name:"\u6deb\u9b54\u7684\u9879\u5708",type:"Accessory",rarity:"\u4f18\u54c1",description:"\u4e00\u4e2a\u523b\u6709\u5815\u843d\u7b26\u6587\u7684\u9879\u5708\uff0c\u6234\u4e0a\u5b83\u7684\u4eba\u4f1a\u4e0d\u81ea\u89c9\u5730\u6563\u53d1\u51fa\u9080\u8bf7\u4ea4\u5abe\u7684\u9a9a\u5a9a\u6c14\u606f\u3002",stats:{critRate:.08,critDmg:.15}},{id:"e6",name:"\u8d2f\u7a7f\u795e\u5973\u4e4b\u67aa",type:"Weapon",rarity:"\u4ed9\u54c1",description:"\u4f20\u8bf4\u4e2d\u66fe\u8ba9\u4ed9\u754c\u5723\u5973\u9ad8\u6f6e\u8fed\u8d77\u7684\u957f\u67aa\uff0c\u67aa\u5934\u523b\u6ee1\u4e86\u80fd\u523a\u6fc0G\u70b9\u7684\u5492\u6587\u3002",stats:{attack:80,critRate:.1}},{id:"e7",name:"\u7edd\u5bf9\u9732\u51fa\u5723\u94e0",type:"Armor",rarity:"\u5723\u54c1",description:"\u4e00\u5957\u770b\u4f3c\u534e\u4e3d\u7684\u94e0\u7532\uff0c\u4f46\u5176\u8bbe\u8ba1\u5de7\u5999\uff0c\u65e0\u8bba\u4ece\u54ea\u4e2a\u89d2\u5ea6\u770b\uff0c\u90fd\u4f1a\u4e0d\u7ecf\u610f\u5730\u9732\u51fa\u7a7f\u6234\u8005\u7684\u79c1\u5bc6\u90e8\u4f4d\u3002",stats:{hp:200,defense:50,speed:-10}},{id:"e8",name:"\u89e6\u624b\u8f6f\u97ad",type:"Weapon",rarity:"\u826f\u54c1",description:"\u5982\u7ae0\u9c7c\u89e6\u624b\u822c\u67d4\u8f6f\u800c\u7075\u6d3b\u7684\u97ad\u5b50\uff0c\u97ad\u8eab\u4e0a\u5e03\u6ee1\u5438\u76d8\uff0c\u80fd\u7f20\u4f4f\u654c\u4eba\u5e76\u5e26\u6765\u5f02\u6837\u7684\u5feb\u611f\u3002",stats:{attack:8,speed:4}},{id:"e9",name:"\u5168\u900f\u660e\u9713\u88f3",type:"Armor",rarity:"\u4f18\u54c1",description:"\u4e00\u4ef6\u5b8c\u5168\u900f\u660e\u7684\u4ed9\u8863\uff0c\u552f\u4e00\u7684\u906e\u6321\u662f\u5728\u79c1\u5904\u7ee3\u4e86\u4e00\u6735\u82e5\u9690\u82e5\u73b0\u7684\u83b2\u82b1\uff0c\u5f15\u4eba\u9050\u60f3\u3002",stats:{hp:40,defense:12,speed:3}},{id:"e10",name:"\u81ea\u6170\u6708\u534e\u7c2a",type:"Accessory",rarity:"\u73cd\u54c1",description:"\u4e00\u6839\u80fd\u6839\u636e\u4e3b\u4eba\u610f\u5ff5\u9707\u52a8\u7684\u53d1\u7c2a\uff0c\u65e2\u662f\u9970\u54c1\uff0c\u4e5f\u662f\u65b9\u4fbf\u7684\u81ea\u6170\u5de5\u5177\uff0c\u4f69\u6234\u8005\u53ef\u968f\u65f6\u4eab\u53d7\u5feb\u611f\u3002",stats:{critRate:.03,speed:10}}],Ge={p_brothel_star:{name:"\u5934\u724c\u82b1\u9b41",shop:"\u9752\u697c",requiredAttr:"charm"},p_brothel_tutor:{name:"\u53cc\u4fee\u5bfc\u5e08",shop:"\u9752\u697c",requiredAttr:"skillfulness"},p_brothel_guard:{name:"\u62a4\u536b",shop:"\u9752\u697c",requiredAttr:"defense"},p_arena_gladiator:{name:"\u660e\u661f\u89d2\u6597\u58eb",shop:"\u89d2\u6597\u573a",requiredAttr:"attack"},p_arena_host:{name:"\u4e3b\u6301\u4eba",shop:"\u89d2\u6597\u573a",requiredAttr:"charm"},p_arena_trader:{name:"\u5974\u96b6\u5546\u4eba",shop:"\u89d2\u6597\u573a",requiredAttr:"skillfulness"},p_alchemy_chief:{name:"\u9996\u5e2d\u70bc\u4e39\u5e08",shop:"\u70bc\u4e39\u623f",requiredAttr:"perception"},p_alchemy_apprentice:{name:"\u836f\u7ae5",shop:"\u70bc\u4e39\u623f",requiredAttr:"speed"},p_auction_master:{name:"\u9996\u5e2d\u62cd\u5356\u5e08",shop:"\u62cd\u5356\u884c",requiredAttr:"charm"},p_auction_appraiser:{name:"\u9274\u5b9d\u5e08",shop:"\u62cd\u5356\u884c",requiredAttr:"perception"},p_intel_chief:{name:"\u60c5\u62a5\u5934\u5b50",shop:"\u60c5\u62a5\u9601",requiredAttr:"perception"},p_intel_assassin:{name:"\u6697\u6740\u8005",shop:"\u60c5\u62a5\u9601",requiredAttr:"attack"}},Je={id:"c1",name:"\u591c\u5bb8",gender:"Male",realm:"\u7b51\u57fa\u671f",rarity:"\u73cd\u54c1",title:"\u6697\u5f71\u4e2d\u7684\u4f4e\u8bed\u8005",race:"\u9b54\u65cf",origin:"\u6765\u81ea\u9b54\u754c\u4e0e\u4eba\u754c\u4ea4\u6c47\u7684\u9634\u5f71\u4e4b\u5730\uff0c\u662f\u68a6\u9b47\u4e0e\u4eba\u7c7b\u7684\u6df7\u8840\u3002\u4ed6\u52a0\u5165\u5b97\u95e8\u7684\u76ee\u7684\u65e0\u4eba\u77e5\u6653\uff0c\u53ea\u4e3a\u5bfb\u627e\u80fd\u6ee1\u8db3\u4ed6\u7279\u6b8a\u201c\u98df\u6b32\u201d\u7684\u7075\u9b42\u3002",appearance:"\u4ed6\u603b\u662f\u7a7f\u7740\u4e00\u4ef6\u80fd\u906e\u853d\u8eab\u5f62\u7684\u9ed1\u8272\u6597\u7bf7\uff0c\u515c\u5e3d\u4e0b\u53ea\u80fd\u770b\u5230\u4e00\u53cc\u95ea\u70c1\u7740\u7d2b\u8272\u5e7d\u5149\u7684\u773c\u775b\u548c\u82cd\u767d\u7684\u5634\u5507\u3002\u5f53\u4ed6\u65bd\u6cd5\u65f6\uff0c\u6597\u7bf7\u4e0b\u4f1a\u4f38\u51fa\u6570\u6761\u7531\u7eaf\u7cb9\u6697\u5f71\u6784\u6210\u7684\u89e6\u624b\uff0c\u8fd9\u4e9b\u89e6\u624b\u8868\u9762\u5149\u6ed1\u6e7f\u6da6\uff0c\u9876\u7aef\u5e26\u6709\u80fd\u5438\u98df\u4ed6\u4eba\u7cbe\u795e\u80fd\u91cf\u7684\u5438\u76d8\u3002",charm:88,skillfulness:70,perception:80,baseAttributes:{hp:110,maxHp:110,mp:60,maxMp:60,attack:20,defense:10,speed:16,critRate:.12,critDmg:1.6},skills:[{id:"s5",name:"\u6697\u5f71\u89e6\u624b",rarity:"\u826f\u54c1",description:"\u4ece\u9634\u5f71\u4e2d\u53ec\u5524\u89e6\u624b\u675f\u7f1a\u654c\u4eba\u3002",eroticDescription:"\u6570\u6761\u51b0\u51b7\u6ed1\u817b\u7684\u6697\u5f71\u89e6\u624b\u4ece\u5730\u9762\u94bb\u51fa\uff0c\u65e0\u89c6\u6240\u6709\u62a4\u7532\uff0c\u76f4\u63a5\u7f20\u7ed5\u4e0a\u654c\u4eba\u7684\u56db\u80a2\u548c\u8170\u8179\uff0c\u5e76\u5f3a\u884c\u94bb\u5165\u5176\u8863\u7269\u5185\uff0c\u5728\u5176\u6700\u654f\u611f\u7684\u90e8\u4f4d\u6e38\u8d70\u3001\u629a\u5f04\uff0c\u4f7f\u5176\u56e0\u5f3a\u70c8\u7684\u5feb\u611f\u548c\u6050\u60e7\u800c\u65e0\u6cd5\u52a8\u5f39\u3002",mechanicsDescription:"\u5bf9\u5355\u4e2a\u654c\u4eba\u9020\u621080%\u653b\u51fb\u529b\u7684\u6697\u5f71\u4f24\u5bb3\uff0c\u5e76\u670970%\u51e0\u7387\u4f7f\u5176\u3010\u675f\u7f1a\u3011\uff08\u65e0\u6cd5\u884c\u52a8\uff09\uff0c\u6301\u7eed1\u56de\u5408\u3002",cost:20,genderLock:"Male"},{id:"s6",name:"\u7cbe\u795e\u4fb5\u8680",rarity:"\u4f18\u54c1",description:"\u7528\u9b54\u97f3\u4fb5\u8680\u654c\u4eba\u7684\u5fc3\u667a\u3002",eroticDescription:"\u591c\u5bb8\u53d1\u51fa\u53ea\u6709\u76ee\u6807\u80fd\u542c\u5230\u7684\u3001\u5145\u6ee1\u9b45\u60d1\u7684\u9b54\u97f3\u4f4e\u8bed\u3002\u8fd9\u58f0\u97f3\u4f1a\u76f4\u63a5\u5728\u654c\u4eba\u8111\u6d77\u4e2d\u54cd\u8d77\uff0c\u4e0d\u65ad\u653e\u5927\u5176\u5185\u5fc3\u6700\u6df1\u5904\u7684\u6deb\u6b32\uff0c\u8ba9\u5176\u4ea7\u751f\u88ab\u65e0\u6570\u4eba\u8f6e\u756a\u4fb5\u72af\u7684\u5e7b\u89c9\uff0c\u6700\u7ec8\u7cbe\u795e\u5d29\u6e83\uff0c\u4efb\u4eba\u5bb0\u5272\u3002",mechanicsDescription:"\u5bf9\u5355\u4e2a\u654c\u4eba\u9020\u6210\u7cbe\u795e\u51b2\u51fb\uff0c\u4f7f\u5176\u3010\u6df7\u4e71\u3011\uff08\u65e0\u6cd5\u884c\u52a8\uff09\u5e76\u3010\u6613\u4f24\u3011\uff08\u53d7\u5230\u7684\u4f24\u5bb3\u589e\u52a020%\uff09\uff0c\u6301\u7eed2\u56de\u5408\u3002",cost:35,genderLock:"Male"},null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},Ke={id:"c2",name:"\u7075\u6708",gender:"Female",realm:"\u7b51\u57fa\u671f",rarity:"\u73cd\u54c1",title:"\u5929\u751f\u5a9a\u9aa8\u9a9a\u8d27",race:"\u5996\u65cf",origin:"\u4e5d\u5c3e\u5929\u72d0\u7684\u540e\u88d4\uff0c\u4e3a\u5bfb\u6c42\u7a81\u7834\u8840\u8109\u7684\u684e\u688f\u800c\u52a0\u5165\u4e86\u4fee\u4ed9\u5b97\u95e8\u3002",appearance:"\u5979\u4ece\u4e0d\u7a7f\u4e73\u7f69\u548c\u5185\u88e4\uff0c\u4ec5\u4ec5\u5957\u7740\u4e00\u4ef6\u8584\u5982\u8749\u7ffc\u7684\u7eb1\u88d9\u3002\u4e00\u5bf9\u7855\u5927\u7684\u4e73\u623f\u968f\u7740\u5979\u7684\u8d70\u52a8\u5267\u70c8\u5730\u6643\u52a8\uff0c\u6df1\u8272\u7684\u4e73\u5934\u6e05\u6670\u53ef\u89c1\u3002\u88d9\u4e0b\u5149\u6d01\u4e00\u7247\uff0c\u9971\u6ee1\u7684\u9634\u5507\u8f6e\u5ed3\u5206\u660e\u3002\u5979\u5929\u751f\u6deb\u8361\uff0c\u4f53\u5185\u5a9a\u836f\u8fc7\u5269\uff0c\u5bfc\u81f4\u79c1\u5904\u65f6\u523b\u6e7f\u6da6\uff0c\u751a\u81f3\u4f1a\u5728\u8d70\u8def\u65f6\u7559\u4e0b\u6de1\u6de1\u7684\u9a9a\u5473\u75d5\u8ff9\u3002",charm:95,skillfulness:80,perception:60,baseAttributes:{hp:100,maxHp:100,mp:70,maxMp:70,attack:15,defense:10,speed:18,critRate:.15,critDmg:1.6},skills:[ze,Re,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},Ye=[Je,Ke,{id:"c3",name:"\u77f3\u6bc5",gender:"Male",realm:"\u91d1\u4e39\u671f",rarity:"\u4f18\u54c1",title:"\u4e0d\u52a8\u5c71\u738b",race:"\u4eba\u65cf",origin:"\u5929\u751f\u795e\u529b\uff0c\u4ee5\u70bc\u4f53\u4e3a\u4e3b\uff0c\u8089\u8eab\u575a\u4e0d\u53ef\u6467\u3002",charm:30,skillfulness:40,perception:45,baseAttributes:{hp:180,maxHp:180,mp:40,maxMp:40,attack:14,defense:25,speed:10,critRate:.05,critDmg:1.5},skills:[Oe,Ie,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},{id:"c4",name:"\u82cf\u5a9a",gender:"Female",realm:"\u7b51\u57fa\u671f",rarity:"\u4f18\u54c1",title:"\u767e\u82b1\u4ed9\u5b50",race:"\u4eba\u65cf",origin:"\u7cbe\u901a\u6cbb\u7597\u4e0e\u8f85\u52a9\u6cd5\u672f\uff0c\u662f\u961f\u4f0d\u4e2d\u53ef\u9760\u7684\u540e\u76fe\u3002",charm:85,skillfulness:70,perception:65,baseAttributes:{hp:95,maxHp:95,mp:80,maxMp:80,attack:12,defense:14,speed:16,critRate:.08,critDmg:1.5},skills:[Re,ze,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},{id:"c5",name:"\u9f99\u50b2\u5929",gender:"Male",realm:"\u5143\u5a74\u671f",rarity:"\u4ed9\u54c1",title:"\u5929\u547d\u4e4b\u5b50",race:"\u795e\u65cf",origin:"\u4e0a\u53e4\u795e\u65cf\u540e\u88d4\uff0c\u8840\u8109\u4e2d\u8574\u542b\u7740\u6bc1\u5929\u706d\u5730\u7684\u529b\u91cf\u3002",charm:80,skillfulness:85,perception:90,baseAttributes:{hp:250,maxHp:250,mp:120,maxMp:120,attack:40,defense:25,speed:22,critRate:.2,critDmg:2},skills:[Ie,ze,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},{id:"c6",name:"\u5f20\u4e09",gender:"Male",realm:"\u70bc\u6c14\u671f",rarity:"\u51e1\u54c1",title:"\u5916\u95e8\u5f1f\u5b50",race:"\u4eba\u65cf",origin:"\u666e\u901a\u7684\u5b97\u95e8\u5916\u95e8\u5f1f\u5b50\u3002",charm:40,skillfulness:30,perception:35,baseAttributes:{hp:80,maxHp:80,mp:40,maxMp:40,attack:10,defense:8,speed:12,critRate:.05,critDmg:1.5},skills:[Ie,qe,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},{id:"c7",name:"\u4e5d\u5929\u7384\u5973",gender:"Female",realm:"\u5316\u795e\u671f",rarity:"\u795e\u54c1",title:"\u5929\u9053\u5316\u8eab",race:"\u795e\u65cf",origin:"\u81ea\u5929\u5730\u521d\u5f00\u65f6\u8bde\u751f\u7684\u5148\u5929\u795e\u7075\uff0c\u638c\u7ba1\u7740\u5929\u9053\u6cd5\u5219\uff0c\u5a01\u4e25\u800c\u53c8\u795e\u79d8\u3002",charm:99,skillfulness:99,perception:99,baseAttributes:{hp:400,maxHp:400,mp:250,maxMp:250,attack:60,defense:40,speed:30,critRate:.3,critDmg:2.5},skills:[Be,He,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null}],Xe={"\u51e1\u54c1":10,"\u826f\u54c1":50,"\u4f18\u54c1":150,"\u73cd\u54c1":500,"\u7edd\u54c1":1500,"\u4ed9\u54c1":5e3,"\u5723\u54c1":15e3,"\u795e\u54c1":5e4},Ze=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,et=(e,t)=>{const n=[],s=new Set;for(;n.length<t&&s.size<e.length;){const t=e[Ze(0,e.length-1)];if(!s.has(t.id)){const e=Ze(1e3,6e3);n.push({rank:0,name:t.name,faction:"\u9752\u86c7\u5b97",points:e,characterId:t.id}),s.add(t.id)}}return n.sort((e,t)=>t.points-e.points).map((e,t)=>({...e,rank:t+1}))},tt={"\u5b97\u95e8\u6392\u884c\u699c":{"\u603b\u699c":et(Ye,20),"\u6838\u5fc3\u5f1f\u5b50":et(Ye.filter(e=>["\u4ed9\u54c1","\u5723\u54c1","\u795e\u54c1"].includes(e.rarity)),20),"\u5185\u95e8\u5f1f\u5b50":et(Ye.filter(e=>["\u73cd\u54c1","\u7edd\u54c1"].includes(e.rarity)),20),"\u5916\u95e8\u5f1f\u5b50":et(Ye.filter(e=>["\u4f18\u54c1","\u826f\u54c1"].includes(e.rarity)),20),"\u6742\u5f79\u5f1f\u5b50":et(Ye.filter(e=>"\u51e1\u54c1"===e.rarity),20)},"\u91ce\u699c":et(Ye,20),"\u533a\u57df\u699c":et(Ye,20),"\u4e16\u754c\u699c":et(Ye,20)},nt={character:{id:"prisoner-char-01",name:"\u8840\u5f71\u9b54\u541b",gender:"Male",realm:"\u5143\u5a74\u671f",rarity:"\u7edd\u54c1",title:"\u8840\u715e\u9b54\u5934",race:"\u9b54\u65cf",origin:"\u8840\u715e\u95e8\u53db\u5f92\uff0c\u56e0\u5c60\u6740\u65e0\u8f9c\u6751\u6c11\u88ab\u6355",appearance:"\u4e00\u8eab\u9ed1\u8863\uff0c\u53cc\u76ee\u8840\u7ea2\uff0c\u5468\u8eab\u7f20\u7ed5\u7740\u6de1\u6de1\u7684\u8840\u715e\u4e4b\u6c14",charm:45,skillfulness:75,perception:60,baseAttributes:{hp:280,maxHp:280,mp:120,maxMp:120,attack:45,defense:28,speed:22,critRate:.18,critDmg:1.8},skills:[Ie,Oe,null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},crime:"\u5c60\u6740\u65e0\u8f9c\u6751\u6c11\uff0c\u5438\u53d6\u8840\u6c14\u4fee\u70bc\u9b54\u529f",sentence:100,remainingDays:100,submissionLevel:20,loyaltyLevel:5,health:85,sanity:90,location:"\u5c45\u4f4f\u533a",cellType:"\u5355\u72ec\u56da\u5ba4",value:{ransom:5e4,labor:3e3,intelligence:8e3},status:["\u5065\u5eb7"],history:[],knownInformation:[],potentialInformation:["\u8840\u715e\u95e8\u603b\u575b\u4f4d\u7f6e","\u9b54\u529f\u4fee\u70bc\u79d8\u6cd5","\u5176\u4ed6\u9b54\u9053\u540c\u4f19"],imprisonedDate:"\u7b2c\u4e00\u5929",realImprisonedTime:Date.now()},st={mode:"exploration",exploration:{story:"\u5728\u8fd9\u4e2a\u5145\u6ee1\u6b32\u671b\u4e0e\u529b\u91cf\u7684\u4fee\u4ed9\u4e16\u754c\uff0c\u5b9e\u529b\u5e76\u975e\u552f\u4e00\u7684\u4e3b\u5bb0\uff0c\u6f5c\u85cf\u5728\u7075\u6c14\u4e4b\u4e0b\u7684\u539f\u59cb\u672c\u80fd\u540c\u6837\u6405\u52a8\u7740\u98ce\u4e91\u3002\u4f60\uff0c\u4e00\u4e2a\u8eab\u6000\u5f02\u7980\u7684\u65b0\u8fdb\u5f1f\u5b50\uff0c\u8e0f\u5165\u4e86\u4ee5\u53cc\u4fee\u548c\u5a9a\u672f\u95fb\u540d\u7684\u9752\u86c7\u5b97\u3002\u5728\u8fd9\u91cc\uff0c\u5f3a\u5927\u7684\u4fee\u58eb\u4eec\u4e0d\u4ec5\u8ffd\u6c42\u901a\u5929\u4fee\u4e3a\uff0c\u66f4\u6c89\u6eba\u4e8e\u6781\u81f4\u7684\u8089\u4f53\u6b22\u6109\u3002\u5b97\u95e8\u4e4b\u5185\uff0c\u5e08\u5144\u5e08\u59d0\u4eec\u7684\u5173\u7cfb\u9519\u7efc\u590d\u6742\uff0c\u6bcf\u4e00\u6b21\u201c\u5207\u78cb\u201d\u90fd\u53ef\u80fd\u662f\u4e00\u573a\u9999\u6c57\u6dcb\u6f13\u7684\u5f81\u670d\u3002\u4f60\u5c06\u5982\u4f55\u5728\u8fd9\u6761\u5145\u6ee1\u8bf1\u60d1\u4e0e\u5371\u9669\u7684\u9053\u8def\u4e0a\u7acb\u8db3\uff1f\u662f\u6210\u4e3a\u4ed6\u4eba\u80ef\u4e0b\u7684\u73a9\u7269\uff0c\u8fd8\u662f\u5c06\u6240\u6709\u4eba\u90fd\u53d8\u6210\u4f60\u81ea\u5df1\u7684\u7981\u8114\uff1f\u4f60\u7684\u6deb\u4e71\u4ed9\u9014\uff0c\u73b0\u5728\u5f00\u59cb\u3002",location:"\u9752\u86c7\u5b97\u5c71\u95e8",time:"\u7b2c\u4e00\u5929\uff0c\u6e05\u6668",choices:["\u5411\u5b88\u95e8\u5f1f\u5b50\u4ecb\u7ecd\u81ea\u5df1\u3002","\u5bfb\u627e\u767b\u8bb0\u5904\u3002","\u63a2\u7d22\u5916\u95e8\u5ead\u9662\u3002"],pendingChallenge:null},playerProfile:{name:"\u5929\u9009\u8005",title:"\u65b0\u8fdb\u5f1f\u5b50",relationships:[{id:"c2",name:"\u7075\u6708",avatar:"path/to/lingyue-avatar.png",relationshipStatus:"\u719f\u4eba",relationshipTags:["\u540c\u95e8","\u521d\u8bc6"],favorability:10,description:"\u5728\u5b97\u95e8\u521d\u8bc6\uff0c\u4f3c\u4e4e\u5bf9\u4f60\u6709\u4e9b\u597d\u5947\u3002"},{id:"c1",name:"\u98ce\u9038",avatar:"path/to/fengyi-avatar.png",relationshipStatus:"\u719f\u4eba",relationshipTags:["\u5e08\u5144","\u5251\u4fee"],favorability:25,description:"\u4e00\u4f4d\u51b7\u5cfb\u7684\u5e08\u5144\uff0c\u5251\u6cd5\u9ad8\u8d85\u3002"},{id:"c3",name:"\u77f3\u6bc5",avatar:"path/to/shiyi-avatar.png",relationshipStatus:"\u964c\u751f\u4eba",relationshipTags:["\u70bc\u4f53\u4fee\u58eb"],favorability:0,description:"\u4e00\u4e2a\u770b\u8d77\u6765\u5f88\u5f3a\u58ee\u7684\u4fee\u58eb\uff0c\u4f46\u4f60\u4eec\u8fd8\u6ca1\u8bf4\u8fc7\u8bdd\u3002"}],spiritStones:1e3,maleParty:[Je],femaleParty:[],cardCollection:[Je,Ke],equipmentInventory:[Ue,Ve,We],petCollection:[{id:"pet2",name:"\u9738\u5929\u864e",gender:"Male",rarity:"\u73cd\u54c1",description:"\u62e5\u6709\u4e0a\u53e4\u767d\u864e\u8840\u8109\u7684\u7075\u517d\uff0c\u6027\u683c\u9738\u9053\uff0c\u7834\u574f\u529b\u60ca\u4eba\u3002",skill:{id:"ps2",name:"\u864e\u5578\u5c71\u6797",rarity:"\u73cd\u54c1",description:"\u53d1\u51fa\u4e00\u58f0\u9707\u6151\u5fc3\u9b44\u7684\u864e\u5578\u3002",eroticDescription:"\u96c4\u6d51\u7684\u864e\u5578\u58f0\u4e2d\u5939\u6742\u7740\u4f4e\u6c89\u7684\u5598\u606f\uff0c\u80fd\u5524\u8d77\u5468\u56f4\u751f\u7269\u6700\u539f\u59cb\u7684\u4ea4\u914d\u6b32\u671b\uff0c\u4f7f\u5176\u81e3\u670d\u4e8e\u9738\u5929\u864e\u7684\u96c4\u5a01\u4e4b\u4e0b\u3002",mechanicsDescription:"\u6218\u6597\u5f00\u59cb\u65f6\uff0c\u670930%\u51e0\u7387\u4f7f\u654c\u65b9\u5168\u4f53\u3010\u6050\u60e7\u3011\uff08\u653b\u51fb\u529b\u964d\u4f4e15%\uff09\uff0c\u6301\u7eed2\u56de\u5408\u3002",cost:0,genderLock:"Universal"}},{id:"pet3",name:"\u5e7b\u68a6\u8776",gender:"Female",rarity:"\u73cd\u54c1",description:"\u7fc5\u8180\u4e0a\u5e26\u6709\u8ff7\u5e7b\u82b1\u7eb9\u7684\u7075\u8776\uff0c\u80fd\u7f16\u7ec7\u51fa\u4ee5\u5047\u4e71\u771f\u7684\u5e7b\u5883\u3002",skill:{id:"ps3",name:"\u8776\u604b\u82b1",rarity:"\u73cd\u54c1",description:"\u6563\u64ad\u80fd\u5f15\u4eba\u5165\u68a6\u7684\u82b1\u7c89\u3002",eroticDescription:"\u717d\u52a8\u7fc5\u8180\uff0c\u6d12\u4e0b\u95ea\u7740\u6625\u5149\u7684\u50ac\u60c5\u82b1\u7c89\uff0c\u95fb\u5230\u82b1\u7c89\u7684\u751f\u7269\u4f1a\u7acb\u523b\u9677\u5165\u6700\u6deb\u9761\u7684\u6625\u68a6\u4e4b\u4e2d\uff0c\u4efb\u4eba\u6446\u5e03\u3002",mechanicsDescription:"\u63a2\u7d22\u65f6\uff0c\u670915%\u7684\u51e0\u7387\u4f7f\u4f60\u907f\u5f00\u4e00\u6b21\u8d1f\u9762\u4e8b\u4ef6\u3002",cost:0,genderLock:"Universal"}}],universalSkills:[Fe,qe],arenaRank:{tier:"\u9ec4\u94dc",division:"III",points:1250,tierIcon:"\ud83e\udd49"},reputation:{score:0,level:"\u9ed8\u9ed8\u65e0\u95fb",dynamicTitles:[],greatestDeeds:[],title:"",goodDeeds:[],badDeeds:[],lewdDeeds:[],history:[]},quests:[{id:"main_01",title:"\u3010\u4e3b\u7ebf\u3011\u521d\u5165\u5c71\u95e8",description:"\u4f60\u7ad9\u5728\u9752\u86c7\u5b97\u7684\u5c71\u95e8\u524d\uff0c\u4e00\u4f4d\u5fc3\u6000\u58ee\u5fd7\u7684\u65b0\u8fdb\u5f1f\u5b50\u3002\u9996\u5148\uff0c\u4f60\u9700\u8981\u5411\u5b97\u95e8\u62a5\u5230\u3002",category:"Main",status:"In Progress",objectives:[{id:"obj1",description:"\u4e0e\u5b88\u95e8\u5f1f\u5b50\u4ea4\u8c08",isCompleted:!1,targetCount:1,currentCount:0},{id:"obj2",description:"\u5728\u5916\u95e8\u767b\u8bb0\u5904\u5b8c\u6210\u767b\u8bb0",isCompleted:!1,targetCount:1,currentCount:0}],rewards:{spiritStones:50,reputation:10}}],businessDistrict:null},leaderboards:tt,announcements:{sect:[],adventure:[],world:[]},hospitalPatients:[],bountyBoard:[],cultivationPavilion:[{slotId:1,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]},{slotId:2,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]},{slotId:3,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]}],prisonSystem:{prisoners:[nt],guards:[],facilities:[],laborSites:[{id:"mine-01",type:"\u77ff\u5c71",name:"\u9752\u86c7\u77ff\u8109",description:"\u5b97\u95e8\u540e\u5c71\u7684\u7075\u77f3\u77ff\u8109",maxWorkers:2,workers:[]},{id:"herb-01",type:"\u91c7\u836f",name:"\u7075\u836f\u56ed",description:"\u5b97\u95e8\u7684\u836f\u6750\u79cd\u690d\u56ed",maxWorkers:2,workers:[]}],materialInventory:[],laborTasks:[],laborRecords:[],events:[],ransomOffers:[],stats:{totalPrisoners:0,byArea:{"\u5c45\u4f4f\u533a":0,"\u5ba1\u8baf\u533a":0,"\u5a31\u4e50\u533a":0,"\u52b3\u5f79\u533a":0,"\u7ba1\u7406\u533a":0,"\u533b\u7597\u533a":0},byCellType:{"\u666e\u901a\u7262\u623f":0,"\u91cd\u72af\u7262\u623f":0,"\u5355\u72ec\u56da\u5ba4":0},avgSubmission:0,avgLoyalty:0,avgHealth:0,totalGuards:5,escapeAttempts:0,successfulEscapes:0,totalRevenue:0,totalExpenses:0,netProfit:0},config:{maxPrisoners:50,dailyFoodCost:10,securityLevel:5,enableAutoInterrogation:!1,enableAutoLabor:!1}},memories:{"\u63a2\u7d22":[],"\u6218\u6597":[],"\u5546\u57ce":[],"\u533b\u9986":[],"\u60ac\u8d4f":[],"\u57f9\u80b2":[],"\u5546\u4e1a":[],"\u58f0\u671b":[],"\u516c\u544a":[],"\u5927\u7262":[],"\u5176\u4ed6":[]},memorySummaries:{"\u63a2\u7d22":{small:[],large:[]},"\u6218\u6597":{small:[],large:[]},"\u5546\u57ce":{small:[],large:[]},"\u533b\u9986":{small:[],large:[]},"\u60ac\u8d4f":{small:[],large:[]},"\u57f9\u80b2":{small:[],large:[]},"\u5546\u4e1a":{small:[],large:[]},"\u58f0\u671b":{small:[],large:[]},"\u516c\u544a":{small:[],large:[]},"\u5927\u7262":{small:[],large:[]},"\u5176\u4ed6":{small:[],large:[]}},summarySettings:{autoSummaryEnabled:!0,smallSummaryInterval:10,largeSummaryInterval:5,summaryPrompts:{small:"\u4f60\u662f\u4e00\u4e2a\u8bb0\u5fc6\u603b\u7ed3\u52a9\u624b\u3002\u8bf7\u6839\u636e\u4ee5\u4e0b\u3010{category}\u3011\u5206\u7c7b\u7684\u8bb0\u5fc6\u7247\u6bb5\uff0c\u751f\u6210\u4e00\u4e2a\u7b80\u6d01\u3001\u8fde\u8d2f\u3001\u5927\u7ea6100-200\u5b57\u7684\u5c0f\u603b\u7ed3\u3002\u603b\u7ed3\u5e94\u63d0\u70bc\u5173\u952e\u4e8b\u4ef6\u3001\u4eba\u7269\u548c\u7ed3\u679c\uff0c\u5e76\u4ee5\u7b2c\u4e09\u4eba\u79f0\u53d9\u8ff0\u3002\u8bf7\u76f4\u63a5\u8f93\u51fa\u603b\u7ed3\u5185\u5bb9\uff0c\u4e0d\u8981\u5305\u542b\u4efb\u4f55\u989d\u5916\u7684\u524d\u7f00\u6216\u6807\u9898\u3002",large:"\u4f60\u662f\u4e00\u4e2a\u9ad8\u7ea7\u8bb0\u5fc6\u5206\u6790\u5e08\u3002\u8bf7\u6839\u636e\u4ee5\u4e0b\u591a\u4e2a\u5173\u4e8e\u3010{category}\u3011\u7684\u5c0f\u603b\u7ed3\uff0c\u751f\u6210\u4e00\u4e2a\u5168\u9762\u3001\u6df1\u523b\u3001\u5927\u7ea6200-400\u5b57\u7684\u5927\u603b\u7ed3\u3002\u8fd9\u4e2a\u603b\u7ed3\u5e94\u8be5\u8bc6\u522b\u6838\u5fc3\u4e3b\u9898\u3001\u957f\u671f\u5f71\u54cd\u548c\u4eba\u7269\u5173\u7cfb\u53d8\u5316\uff0c\u5e76\u4ee5\u5b8f\u89c2\u89c6\u89d2\u8fdb\u884c\u53d9\u8ff0\u3002\u8bf7\u76f4\u63a5\u8f93\u51fa\u603b\u7ed3\u5185\u5bb9\uff0c\u4e0d\u8981\u5305\u542b\u4efb\u4f55\u989d\u5916\u7684\u524d\u7f00\u6216\u6807\u9898\u3002"}},vectorConfig:B,etiquetteSystem:ee,gauntletSystem:{currentEvent:null,eventHistory:[],totalEditions:0,nextEventDate:Te(),playerStats:{participations:0,wins:0,bestRank:0,totalScore:0,averageRank:0},config:{monthlySchedule:1,registrationDuration:24,enableAutoGeneration:!0,preparationDuration:6}}},rt={patientId:"patient-example-01",name:"\u6797\u5a49\u513f",gender:"Female",age:19,background:"\u6b63\u9053\u5b97\u95e8\u201c\u78a7\u971e\u5bab\u201d\u7684\u5723\u5973\uff0c\u56e0\u5077\u7ec3\u7981\u672f\u800c\u8d70\u706b\u5165\u9b54\uff0c\u8eab\u4f53\u4ea7\u751f\u4e86\u5947\u7279\u7684\u5f02\u53d8\u3002",genitalShape:"\u7389\u51c0\u74f6\u578b\u871c\u7a74",sexualFeatures:["\u5723\u5973\u4f53\u8d28","\u8d85\u654f\u611f","\u88ab\u89e6\u78b0\u4f1a\u4e0d\u81ea\u89c9\u6d41\u51fa\u7231\u6db2"],illnessDescription:"\u6240\u60a3\u5947\u75c7\u4e3a\u201c\u7075\u6b32\u5012\u9519\u201d\u3002\u6bcf\u65e5\u6b63\u5348\uff0c\u4f53\u5185\u7eaf\u51c0\u7684\u7075\u529b\u4f1a\u8f6c\u5316\u4e3a\u9ad8\u6d53\u5ea6\u7684\u6deb\u6b32\u4e4b\u6c14\uff0c\u82e5\u4e0d\u4e0e\u4eba\u4ea4\u5408\u758f\u5bfc\uff0c\u4fbf\u4f1a\u906d\u53d7\u4e07\u8681\u566c\u5fc3\u822c\u7684\u75db\u82e6\uff0c\u540c\u65f6\u8eab\u4f53\u4f1a\u6563\u53d1\u51fa\u80fd\u4ee4\u5468\u56f4\u6240\u6709\u751f\u7269\u53d1\u60c5\u7684\u5f02\u9999\u3002"},at={name:"\u4e5d\u8f6c\u6deb\u9b54",character:{id:"bounty-char-example-01",name:"\u4e5d\u8f6c\u6deb\u9b54",gender:"Male",realm:"\u5143\u5a74\u671f",rarity:"\u7edd\u54c1",title:"\u884c\u8d70\u7684\u64ad\u79cd\u673a\u5668",race:"\u9b54\u65cf",origin:"\u4e0a\u53e4\u6deb\u9b54\u7684\u4e00\u7f15\u5206\u9b42\u8f6c\u4e16\uff0c\u4ee5\u5438\u98df\u5973\u6027\u4fee\u58eb\u7684\u5143\u9634\u4e3a\u4fee\u70bc\u6cd5\u95e8\uff0c\u5b9e\u529b\u6781\u5f3a\uff0c\u6781\u5ea6\u5371\u9669\u3002",appearance:"\u5916\u8868\u662f\u4fca\u7f8e\u5996\u5f02\u7684\u9752\u5e74\uff0c\u4f46\u5f53\u4ed6\u5174\u594b\u65f6\uff0c\u989d\u5934\u4f1a\u957f\u51fa\u9b54\u89d2\uff0c\u80ef\u4e0b\u5de8\u7269\u4f1a\u81a8\u80c0\u5230\u6050\u6016\u7684\u5c3a\u5bf8\uff0c\u4e0a\u9762\u5e03\u6ee1\u4e86\u80fd\u5438\u53d6\u5143\u9634\u7684\u5012\u523a\u3002",charm:92,skillfulness:88,perception:70,baseAttributes:{hp:350,maxHp:350,mp:150,maxMp:150,attack:55,defense:30,speed:25,critRate:.25,critDmg:2.2},skills:[{id:"bs1",name:"\u9b54\u9f99\u63a2\u7a74",rarity:"\u7edd\u54c1",description:"\u91ca\u653e\u51fa\u5145\u6ee1\u9b54\u6c14\u7684\u89e6\u624b\u653b\u51fb\u654c\u4eba\u3002",eroticDescription:"\u80ef\u4e0b\u5de8\u7269\u5316\u4e3a\u6570\u6761\u7075\u6d3b\u7684\u9b54\u6c14\u89e6\u624b\uff0c\u5f3a\u884c\u94bb\u5165\u654c\u4eba\u7684\u6240\u6709\u5b54\u7a74\u8fdb\u884c\u8e42\u8e8f\uff0c\u5438\u53d6\u5176\u5143\u9634\u3002",mechanicsDescription:"\u9020\u6210180%\u653b\u51fb\u529b\u7684\u6697\u5f71\u4f24\u5bb3\uff0c\u5e76\u6062\u590d\u9020\u6210\u4f24\u5bb330%\u7684\u6c14\u8840\u3002",cost:40,genderLock:"Male"},{id:"bs2",name:"\u6deb\u9b54\u9886\u57df",rarity:"\u7edd\u54c1",description:"\u5c55\u5f00\u9886\u57df\uff0c\u524a\u5f31\u654c\u4eba\u3002",eroticDescription:"\u91ca\u653e\u51fa\u5145\u6ee1\u7c89\u8272\u7634\u6c14\u7684\u9886\u57df\uff0c\u9886\u57df\u5185\u7684\u654c\u4eba\u4f1a\u6301\u7eed\u9677\u5165\u6027\u5174\u594b\u72b6\u6001\uff0c\u53cc\u817f\u53d1\u8f6f\uff0c\u6218\u610f\u5168\u65e0\u3002",mechanicsDescription:"\u654c\u65b9\u5168\u4f53\u653b\u51fb\u529b\u4e0e\u9632\u5fa1\u529b\u964d\u4f4e20%\uff0c\u6301\u7eed3\u56de\u5408\u3002",cost:60,genderLock:"Male"},null,null],equipment:{weapon:null,armor:null,accessory1:null,accessory2:null},pet:null},specialTrait:"\u53ea\u5bf9\u5904\u5973\u6216\u5143\u9634\u672a\u6cc4\u7684\u5973\u6027\u4fee\u58eb\u611f\u5174\u8da3\uff0c\u5728\u4e0e\u5979\u4eec\u6218\u6597\u65f6\u4f1a\u53d8\u5f97\u5f02\u5e38\u5f3a\u5927\u3002",locationHint:"\u4f3c\u4e4e\u5728\u3010\u5408\u6b22\u5b97\u3011\u9644\u8fd1\u7684\u5c71\u8109\u4e2d\u5bfb\u627e\u65b0\u7684\u730e\u7269\u3002",trackerId:null,startTime:0,endTime:0,trackingLog:null,finalOutcome:null},lt={2:e=>{if(e.memories){const t={"\u63a2\u7d22":e.memories["\u63a2\u7d22"]||[],"\u6218\u6597":e.memories["\u6218\u6597"]||[],"\u5546\u57ce":[],"\u533b\u9986":e.memories["\u95ee\u8bca"]||[],"\u60ac\u8d4f":e.memories["\u60ac\u8d4f"]||[],"\u57f9\u80b2":e.memories["\u57f9\u80b2"]||[],"\u5546\u4e1a":e.memories["\u5546\u4e1a"]||[],"\u58f0\u671b":[],"\u516c\u544a":[],"\u5176\u4ed6":[...e.memories["\u4ea4\u4e92"]||[],...e.memories["\u5176\u4ed6"]||[]]};e.memories=t}if(e.memorySummaries){const t={"\u63a2\u7d22":e.memorySummaries["\u63a2\u7d22"]||{small:[],large:[]},"\u6218\u6597":e.memorySummaries["\u6218\u6597"]||{small:[],large:[]},"\u5546\u57ce":{small:[],large:[]},"\u533b\u9986":e.memorySummaries["\u95ee\u8bca"]||{small:[],large:[]},"\u60ac\u8d4f":e.memorySummaries["\u60ac\u8d4f"]||{small:[],large:[]},"\u57f9\u80b2":e.memorySummaries["\u57f9\u80b2"]||{small:[],large:[]},"\u5546\u4e1a":e.memorySummaries["\u5546\u4e1a"]||{small:[],large:[]},"\u58f0\u671b":{small:[],large:[]},"\u516c\u544a":{small:[],large:[]},"\u5176\u4ed6":{small:[...e.memorySummaries["\u4ea4\u4e92"]?.small||[],...e.memorySummaries["\u5176\u4ed6"]?.small||[]],large:[...e.memorySummaries["\u4ea4\u4e92"]?.large||[],...e.memorySummaries["\u5176\u4ed6"]?.large||[]]}};e.memorySummaries=t}return e}},it=e=>{let t=e.version||0;if(2===t)return e;let n={...e};for(let s=t+1;s<=2;s++){const e=lt[s];e&&(n=e(n))}return n.version=2,n};class ot{async saveToSlot(e,t){const n=JSON.parse(JSON.stringify({name:t.name,timestamp:t.timestamp,gameState:{...t.gameState,version:2}}));try{await window.TavernHelper.updateVariablesWith(t=>(t.xianxiaRpgSaves||(t.xianxiaRpgSaves={}),t.xianxiaRpgSaves[e]=n,t),{type:"character"})}catch(s){throw console.error(`TavernAdapter: \u4fdd\u5b58\u5230\u69fd\u4f4d ${e} \u5931\u8d25:`,s),s}}async loadFromSlot(e){try{const t=window.TavernHelper.getVariables({type:"character"});if(t&&t.xianxiaRpgSaves&&t.xianxiaRpgSaves[e]){const n=t.xianxiaRpgSaves[e];return n.name&&n.timestamp?it(n.gameState):it(n)}return null}catch(t){return console.error(`TavernAdapter: \u4ece\u69fd\u4f4d ${e} \u52a0\u8f7d\u5931\u8d25:`,t),null}}async getAllSaves(){try{const e=window.TavernHelper.getVariables({type:"character"}),t=e&&e.xianxiaRpgSaves||{},n={};for(let s=1;s<=5;s++)if(t[s]){const e=t[s];e.name&&e.timestamp?n[s]=e:n[s]={name:`\u5b58\u6863 ${s}`,timestamp:Date.now(),gameState:e}}else n[s]=null;return Promise.resolve(n)}catch(e){return console.error("TavernAdapter: \u83b7\u53d6\u6240\u6709\u5b58\u6863\u5931\u8d25:",e),{}}}async deleteSlot(e){try{await window.TavernHelper.updateVariablesWith(t=>(t.xianxiaRpgSaves&&t.xianxiaRpgSaves[e]&&delete t.xianxiaRpgSaves[e],t),{type:"character"})}catch(t){throw console.error(`TavernAdapter: \u5220\u9664\u69fd\u4f4d ${e} \u5931\u8d25:`,t),t}}}class ct{constructor(){this.dbPromise=null,this.saveToSlot=async(e,t)=>{const n=await this.getDb(),s={...t,gameState:{...t.gameState,version:2}};await n.put("manual_saves",s,e)},this.loadFromSlot=async e=>{const t=await this.getDb(),n=await t.get("manual_saves",e);return n?it(n.gameState):null},this.getAllSaves=async()=>{const e=await this.getDb(),t={};let n=await e.transaction("manual_saves").store.openCursor();for(;n;)t[n.key]=n.value,n=await n.continue();return t},this.deleteSlot=async e=>{const t=await this.getDb();await t.delete("manual_saves",e)}}getDb(){return this.dbPromise||(this.dbPromise=function(e,t,{blocked:n,upgrade:s,blocking:r,terminated:a}={}){const l=indexedDB.open(e,t),i=Ne(l);return s&&l.addEventListener("upgradeneeded",e=>{s(Ne(l.result),e.oldVersion,e.newVersion,Ne(l.transaction),e)}),n&&l.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),i.then(e=>{a&&e.addEventListener("close",()=>a()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),i}("xianxia-card-rpg-db",1,{upgrade(e){e.objectStoreNames.contains("autosave")&&e.deleteObjectStore("autosave"),e.objectStoreNames.contains("manual_saves")||e.createObjectStore("manual_saves")}})),this.dbPromise}}const dt=window.TavernHelper?new ot:new ct,ut=({onStartNewGame:e,onLoadGame:t})=>{const[n,s]=x.useState({}),[r,a]=x.useState(!1),[l,i]=x.useState(!1);x.useEffect(()=>{c()},[]);const c=async()=>{const e=await dt.getAllSaves();s(e)};return o.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundImage:"url('https://github.com/zzq0219/sillytavern/blob/main/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E4%BA%91%E9%9B%BE-%E4%BB%99%E4%BE%A0.png?raw=true')",backgroundSize:"cover",backgroundPosition:"center"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center space-y-8 px-4",children:[o.jsxs("div",{className:"text-center space-y-4 animate-fade-in",children:[o.jsx("h1",{className:"text-6xl md:text-7xl font-bold text-gradient-gold text-shadow-glow font-serif tracking-wider",children:"\u4ed9\u4fa0\u5361\u724cRPG"}),o.jsx("p",{className:"text-xl md:text-2xl text-amber-200/90 font-serif tracking-widest text-shadow",children:"\u7ea2\u5c18\u4e07\u4e08 \xb7 \u4ed9\u8def\u6f2b\u6f2b"})]}),r?o.jsx("div",{className:"w-full max-w-2xl animate-fade-in",children:o.jsxs("div",{className:"glass-morphism rounded-xl p-6 border border-stone-700/50 shadow-2xl",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-gradient-gold font-serif",children:"\u9009\u62e9\u5b58\u6863"}),o.jsx("button",{onClick:()=>a(!1),className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto scrollbar-xianxia",children:[1,2,3,4,5].map(e=>{const s=n[e];return s?o.jsx("button",{onClick:()=>(async e=>{i(!0);try{await t(e)}catch(n){console.error("\u52a0\u8f7d\u5b58\u6863\u5931\u8d25:",n),alert("\u52a0\u8f7d\u5b58\u6863\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002")}finally{i(!1)}})(e),disabled:l,className:"w-full p-4 bg-gradient-to-r from-stone-800/80 to-stone-900/80 rounded-lg\r\n                                                     border border-stone-700/50 hover:border-amber-500/50\r\n                                                     text-left transition-all duration-300\r\n                                                     hover:scale-[1.02] hover:shadow-lg hover:shadow-amber-500/20\r\n                                                     disabled:opacity-50 disabled:cursor-not-allowed\r\n                                                     group",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsxs("span",{className:"text-amber-400 font-bold font-serif",children:["\u5b58\u6863 ",e]}),o.jsx("span",{className:"text-gray-400",children:"|"}),o.jsx("span",{className:"text-white font-semibold",children:s.name})]}),o.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[o.jsxs("div",{children:[o.jsx("i",{className:"fa-solid fa-user mr-2"}),s.gameState.playerProfile.name]}),o.jsxs("div",{children:[o.jsx("i",{className:"fa-solid fa-location-dot mr-2"}),s.gameState.exploration.location]}),o.jsxs("div",{children:[o.jsx("i",{className:"fa-solid fa-clock mr-2"}),new Date(s.timestamp).toLocaleString("zh-CN")]})]})]}),o.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full \r\n                                                              bg-amber-500/20 group-hover:bg-amber-500/40 \r\n                                                              transition-colors duration-300",children:o.jsx("i",{className:"fa-solid fa-play text-amber-400"})})]})},e):o.jsxs("div",{className:"p-4 bg-stone-800/50 rounded-lg border border-stone-700/50 text-gray-500 text-center",children:[o.jsx("i",{className:"fa-solid fa-inbox mr-2"}),"\u5b58\u6863\u69fd ",e," - \u7a7a"]},e)})}),o.jsx("div",{className:"mt-4 pt-4 border-t border-stone-700/50",children:o.jsxs("button",{onClick:()=>a(!1),className:"w-full px-4 py-2 bg-stone-700/50 hover:bg-stone-700 rounded-lg\r\n                                             text-gray-300 hover:text-white transition-all duration-300\r\n                                             border border-stone-600/50",children:[o.jsx("i",{className:"fa-solid fa-arrow-left mr-2"}),"\u8fd4\u56de"]})})]})}):o.jsxs("div",{className:"flex flex-col space-y-4 w-full max-w-md animate-slide-up",children:[o.jsxs("button",{onClick:e,disabled:l,className:"group relative px-8 py-4 bg-gradient-to-r from-amber-600 via-yellow-500 to-amber-600 rounded-lg\r\n                                     text-white font-bold text-xl tracking-wider font-serif\r\n                                     border-2 border-amber-400/50 shadow-2xl\r\n                                     hover:shadow-amber-500/50 hover:scale-105 hover:border-amber-300\r\n                                     active:scale-95 transition-all duration-300\r\n                                     disabled:opacity-50 disabled:cursor-not-allowed\r\n                                     overflow-hidden",children:[o.jsxs("span",{className:"relative z-10 flex items-center justify-center space-x-2",children:[o.jsx("i",{className:"fa-solid fa-play"}),o.jsx("span",{children:"\u5f00\u59cb\u6e38\u620f"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent \r\n                                          translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"})]}),o.jsxs("button",{onClick:()=>a(!0),disabled:l,className:"group relative px-8 py-4 bg-gradient-to-r from-blue-600 via-cyan-500 to-blue-600 rounded-lg\r\n                                     text-white font-bold text-xl tracking-wider font-serif\r\n                                     border-2 border-blue-400/50 shadow-2xl\r\n                                     hover:shadow-blue-500/50 hover:scale-105 hover:border-blue-300\r\n                                     active:scale-95 transition-all duration-300\r\n                                     disabled:opacity-50 disabled:cursor-not-allowed\r\n                                     overflow-hidden",children:[o.jsxs("span",{className:"relative z-10 flex items-center justify-center space-x-2",children:[o.jsx("i",{className:"fa-solid fa-folder-open"}),o.jsx("span",{children:"\u8bfb\u53d6\u5b58\u6863"})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent \r\n                                          translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"})]})]}),o.jsx("div",{className:"absolute bottom-4 right-4 text-gray-400/70 text-sm font-mono",children:"v1.0.0"})]}),l&&o.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-20",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-amber-400 mx-auto mb-4"}),o.jsx("p",{className:"text-amber-200 text-xl font-serif",children:"\u52a0\u8f7d\u4e2d..."})]})})]})},mt=({descriptions:e,isLoading:t,isPlayerTurn:n})=>{const[s,r]=x.useState([]);x.useEffect(()=>{if(r([]),e.length>0){let t=0;const n=setInterval(()=>{r(n=>[...n,e[t]]),t++,t>=e.length&&clearInterval(n)},100);return()=>clearInterval(n)}},[e]);return o.jsxs("div",{className:"w-full min-h-[10rem] max-h-[16rem] ink-card p-4 rounded-lg flex flex-col justify-start text-ink-300 font-serif transition-all duration-300 text-base overflow-y-auto relative",children:[o.jsx("div",{className:"absolute top-2 left-2 w-2 h-2 border-l border-t border-gold-500/30"}),o.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 border-r border-t border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-2 left-2 w-2 h-2 border-l border-b border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-2 right-2 w-2 h-2 border-r border-b border-gold-500/30"}),o.jsx("div",{className:"space-y-2",children:t&&0===e.length?o.jsx("p",{className:"text-center text-gold-400 animate-glow tracking-wider",children:"\u56de\u5408\u7ed3\u7b97\u4e2d..."}):s.length>0?s.map((e,t)=>o.jsx("p",{className:"text-center animate-fade-in text-ink-200 leading-relaxed",children:e},t)):n||t?o.jsx("p",{className:"text-center text-ink-500 tracking-wide",children:"\u8bf7\u9009\u62e9\u4f60\u7684\u884c\u52a8\u3002"}):o.jsx("p",{className:"text-center text-ink-500 tracking-wide",children:"\u7b49\u5f85\u5bf9\u624b\u884c\u52a8..."})})]})},xt=({label:e,isActive:t,onClick:n})=>o.jsx("button",{onClick:n,className:"px-5 py-2 text-base font-semibold rounded-t-lg transition-colors duration-200 font-serif "+(t?"bg-stone-800/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-900/50 hover:text-gray-200"),children:e}),pt=({announcement:e})=>o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 animate-fade-in",children:[o.jsxs("div",{className:"flex justify-between items-baseline",children:[o.jsx("h3",{className:"text-xl font-bold text-white font-serif",children:e.title}),o.jsx("p",{className:"text-sm text-gray-500 font-mono",children:e.timestamp})]}),o.jsx("p",{className:"text-gray-300 mt-2",children:e.content})]}),ht=({isOpen:e,onClose:t,announcements:n,onRefresh:s,isLoading:r})=>{const[a,l]=x.useState("sect");if(!e)return null;const i={sect:{label:"\u5b97\u95e8\u516c\u544a",data:n.sect},adventure:{label:"\u5947\u9047\u9038\u95fb",data:n.adventure},world:{label:"\u4e16\u754c\u6cd5\u65e8",data:n.world}},c=i[a].data;return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 pr-6 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u5929\u673a\u9601"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:s,disabled:r,className:"text-amber-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-wait",children:o.jsx("i",{className:"fa-solid fa-arrows-rotate text-xl "+(r?"animate-spin":"")})}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),o.jsx("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:Object.entries(i).map(([e,{label:t}])=>o.jsx(xt,{label:t,isActive:a===e,onClick:()=>l(e)},e))}),o.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-4",children:c.length>0?c.map(e=>o.jsx(pt,{announcement:e},e.id)):o.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83d\udcdc"}),o.jsx("p",{children:r?"\u6b63\u5728\u4ece\u5929\u673a\u9601\u83b7\u53d6\u6700\u65b0\u60c5\u62a5...":"\u6b64\u5206\u7c7b\u4e0b\u6682\u65e0\u60c5\u62a5\u3002"})]})})]})})},ft=({announcements:e,onClick:t})=>{if(0===e.length)return null;const n=e.map(e=>`\u3010${e.category}\u3011 ${e.title}`).join("      ");return o.jsx("div",{className:"absolute top-16 left-0 right-0 h-8 bg-gradient-to-r from-amber-900/80 via-yellow-600/80 to-amber-900/80 z-10 flex items-center overflow-hidden cursor-pointer border-y-2 border-amber-400/50 shadow-lg pointer-events-auto",onClick:t,children:o.jsxs("div",{className:"whitespace-nowrap w-full flex",children:[o.jsx("p",{className:"font-serif text-sm text-yellow-100 drop-shadow-sm shadow-black animate-marquee pr-12",children:n}),o.jsx("p",{className:"font-serif text-sm text-yellow-100 drop-shadow-sm shadow-black animate-marquee pr-12","aria-hidden":"true",children:n})]})})},gt=({victory:e,oldRank:t,newRank:n,pointsChange:s,onClose:r})=>{const a=e?"\u80dc\u5229":"\u60dc\u8d25",l=e?"text-green-400":"text-red-400",i=s>=0?"text-green-400":"text-red-400";return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-md rounded-xl shadow-2xl backdrop-blur-lg flex flex-col items-center text-center p-8",children:[o.jsx("h2",{className:`text-4xl font-bold font-serif mb-4 ${l}`,children:a}),o.jsxs("div",{className:"my-6 w-full",children:[o.jsxs("div",{className:"flex justify-between items-center text-lg mb-2",children:[o.jsx("span",{className:"text-gray-400",children:"\u5148\u524d\u6bb5\u4f4d:"}),o.jsxs("span",{className:"text-white font-semibold",children:[t.tier," ",t.division]})]}),o.jsxs("div",{className:"flex justify-between items-center text-lg mb-4",children:[o.jsx("span",{className:"text-gray-400",children:"\u5148\u524d\u79ef\u5206:"}),o.jsx("span",{className:"text-white font-mono",children:t.points})]}),o.jsx("div",{className:"border-t border-dashed border-stone-600 my-4"}),o.jsxs("div",{className:"flex justify-between items-center text-2xl mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"\u5f53\u524d\u6bb5\u4f4d:"}),o.jsxs("span",{className:"text-amber-400 font-bold",children:[n.tier," ",n.division]})]}),o.jsxs("div",{className:"flex justify-between items-center text-2xl",children:[o.jsx("span",{className:"text-gray-300",children:"\u5f53\u524d\u79ef\u5206:"}),o.jsxs("div",{className:"flex items-baseline",children:[o.jsx("span",{className:"text-amber-400 font-mono font-bold",children:n.points}),o.jsxs("span",{className:`ml-2 font-mono ${i}`,children:["(",s>=0?`+${s}`:s,")"]})]})]})]}),o.jsx("button",{onClick:r,className:"mt-6 bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-500 transition-colors shadow-lg w-40 h-14 flex items-center justify-center",children:"\u8fd4\u56de"})]})})},bt=({title:e,description:t,cost:n,onClick:s,disabled:r})=>o.jsx("button",{onClick:s,disabled:r,className:"h-full w-full flex flex-col justify-between text-center bg-stone-700/80 p-3 rounded-lg hover:bg-stone-600/80 border border-stone-600/50 hover:border-amber-400/50 transition-all duration-200 group disabled:opacity-40 disabled:cursor-not-allowed shadow-md",children:o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-center items-baseline gap-2",children:[o.jsx("span",{className:"font-bold text-white text-base font-serif",children:e}),void 0!==n&&o.jsxs("span",{className:"font-mono text-blue-400 text-xs",children:[n,"MP"]})]}),o.jsx("p",{className:"text-xs text-amber-300 mt-1 group-hover:text-amber-200 font-serif whitespace-normal",children:t})]})}),yt=({activeCard:e,onAction:t,onClose:n})=>{const{card:s}=e;return o.jsx("div",{className:"fixed inset-0 bg-black/70 z-30 flex items-end justify-center",onClick:n,children:o.jsx("div",{className:"w-full max-w-4xl bg-stone-800/90 backdrop-blur-lg rounded-t-xl border-t border-yellow-400/20 p-5 shadow-2xl animate-slide-up",onClick:e=>e.stopPropagation(),children:o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",style:{gridAutoRows:"1fr"},children:[o.jsx(bt,{title:"\u666e\u901a\u653b\u51fb",description:"\u9020\u6210\u5c11\u91cf\u7269\u7406\u4f24\u5bb3",onClick:()=>t("\u666e\u901a\u653b\u51fb")}),s.skills.map(e=>e&&o.jsx(bt,{title:e.name,description:e.mechanicsDescription,cost:e.cost,onClick:()=>t(e)},e.id)),e.pet&&o.jsx(bt,{title:e.pet.skill.name,description:e.pet.skill.mechanicsDescription,cost:e.pet.skill.cost,onClick:()=>t(e.pet.skill)},e.pet.skill.id)]})})})},vt=({battleState:e,isLoading:t,onCombatAction:n,onFlee:s,onOpenCombatLog:r})=>{const[a,l]=x.useState(!1),i=e.playerParty[e.activePlayerCardIndex],c="player"===e.turn&&!e.isBattleOver&&!t;return o.jsxs(o.Fragment,{children:[o.jsx("footer",{className:"w-full h-28 bg-black/90 p-4 flex items-center justify-center border-t border-stone-700",children:o.jsxs("div",{className:"flex items-center justify-center gap-4",children:[o.jsx("button",{onClick:r,className:"w-32 h-14 text-lg bg-stone-800/80 hover:bg-stone-700/80 rounded-md font-serif border border-stone-600/50",children:"\u8bb0\u5f55"}),o.jsx("button",{onClick:()=>l(!0),disabled:!c,className:"w-40 h-16 text-xl bg-sky-700/80 hover:bg-sky-600/90 rounded-lg font-serif border-2 border-sky-500/80 text-white font-bold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-sky-500/30",children:"\u884c\u52a8"}),o.jsx("button",{onClick:s,className:"w-32 h-14 text-lg bg-red-800/80 hover:bg-red-700/80 rounded-md font-serif border border-red-600/50 text-white",children:"\u9003\u547d"})]})}),a&&o.jsx(yt,{activeCard:i,onAction:e=>{const t="string"==typeof e?e:e.name;n(t),l(!1)},onClose:()=>l(!1)})]})};var jt=$();const Nt=({effect:e,onClose:t})=>{return jt.createPortal(o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[110] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20",children:[o.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"\u72b6\u6001\u8be6\u60c5"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"p-6 font-serif flex-grow flex flex-col items-center",children:[o.jsx("div",{className:"text-6xl mb-3",children:(n=e.name,n?n.includes("\u63d0\u5347")||n.includes("\u76fe")?"\u2b06\ufe0f":n.includes("\u4e0b\u964d")||n.includes("\u5f31")?"\u2b07\ufe0f":n.includes("\u6bd2")||n.includes("\u707c\u70e7")?"\u2620\ufe0f":n.includes("\u6655")||n.includes("\u9501")||n.includes("\u6df7\u4e71")?"\ud83d\ude35":"\u2728":"\u2728")}),o.jsx("h3",{className:"text-3xl font-bold text-white text-center",children:e.name||"\u672a\u77e5\u72b6\u6001"}),o.jsxs("p",{className:"text-lg text-amber-400 font-mono mt-1 mb-6",children:["\u5269\u4f59 ",e.duration??0," \u56de\u5408"]}),o.jsxs("div",{className:"w-full space-y-4 text-left",children:[o.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"\u6548\u679c\u63cf\u8ff0"}),o.jsx("p",{className:"text-gray-300 leading-relaxed text-base",children:e.description||"\u65e0\u63cf\u8ff0"})]}),e.mechanicsDescription&&o.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"\u673a\u5236\u8bf4\u660e"}),o.jsx("p",{className:"text-amber-200 leading-relaxed text-base",children:e.mechanicsDescription})]})]})]})]})}),document.body);var n},wt=({effects:e,onClose:t})=>{const[n,s]=x.useState(null),r=e.filter(e=>e&&e.name);return jt.createPortal(o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-2xl shadow-2xl rounded-lg",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20 border-b border-stone-700 rounded-t-lg",children:[o.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"\u7279\u6b8a\u72b6\u6001\u4e00\u89c8"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsx("div",{className:"p-4 max-h-[60vh] overflow-y-auto",children:0===r.length?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-4xl mb-2",children:"\ud83c\udf1f"}),o.jsx("p",{className:"text-gray-400",children:"\u5f53\u524d\u65e0\u7279\u6b8a\u72b6\u6001"})]}):o.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.map((e,t)=>{return o.jsxs("button",{onClick:()=>s(e),className:"p-4 bg-stone-900/60 rounded-lg border border-stone-600/50 hover:border-amber-500/50 hover:bg-stone-800/60 transition-all flex items-center gap-3 text-left",children:[o.jsx("span",{className:"text-2xl",children:(n=e.name,n?n.includes("\u63d0\u5347")||n.includes("\u76fe")?"\u2b06\ufe0f":n.includes("\u4e0b\u964d")||n.includes("\u5f31")?"\u2b07\ufe0f":n.includes("\u6bd2")||n.includes("\u707c\u70e7")?"\u2620\ufe0f":n.includes("\u6655")||n.includes("\u9501")||n.includes("\u6df7\u4e71")?"\ud83d\ude35":"\u2728":"\u2728")}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-white font-medium text-sm",children:e.name||"\u672a\u77e5\u72b6\u6001"}),o.jsxs("p",{className:"text-xs text-amber-400",children:["\u5269\u4f59 ",e.duration??0," \u56de\u5408"]})]})]},`${e.name}-${t}`);var n})})}),o.jsx("div",{className:"p-3 bg-black/20 border-t border-stone-700 rounded-b-lg text-center",children:o.jsx("p",{className:"text-xs text-gray-500",children:"\u70b9\u51fb\u72b6\u6001\u67e5\u770b\u8be6\u7ec6\u673a\u5236\u8bf4\u660e"})})]})}),n&&o.jsx(Nt,{effect:n,onClose:()=>s(null)})]}),document.body)},kt=({value:e,maxValue:t,color:n,label:s})=>{const r=t>0?e/t*100:0,a="\u6c14\u8840"===s&&r<30;return o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex justify-between items-center mb-0.5 text-ink-200 z-10 relative px-1",children:[o.jsx("span",{className:"text-[10px] font-bold tracking-wide",children:s}),o.jsx("span",{className:"text-[10px] font-mono "+(a?"text-cinnabar-400 animate-pulse-soft":""),children:`${e}/${t}`})]}),o.jsx("div",{className:"w-full bg-ink-900/70 rounded h-2 border border-gold-600/20 overflow-hidden",children:o.jsx("div",{className:`${n} h-full rounded transition-all duration-500 ease-in-out relative ${a?"animate-pulse-soft":""}`,style:{width:`${r}%`},children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent"})})})]})},Ct=({participant:e,isPlayer:t,wasHit:n})=>{const{card:s,currentHp:r,currentMp:a,statusEffects:l}=e,[i,c]=x.useState(!1),[d,u]=x.useState(!1),m=t?"border-gold-500/50 shadow-[0_0_15px_rgba(184,149,106,0.2)]":"border-cinnabar-500/50 shadow-[0_0_15px_rgba(166,61,61,0.2)]";x.useEffect(()=>{if(n){c(!0);const e=setTimeout(()=>c(!1),500);return()=>clearTimeout(e)}},[n]);const p=i?"animate-shake":"";return o.jsxs(o.Fragment,{children:[d&&o.jsx(wt,{effects:l,onClose:()=>u(!1)}),o.jsxs("div",{className:`w-full max-w-[280px] ink-card rounded-lg border ${m} backdrop-blur-sm transition-all duration-300 ${p} p-3 relative`,children:[o.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 border-l border-t border-gold-500/30"}),o.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 border-r border-t border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-1 left-1 w-2 h-2 border-l border-b border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-1 right-1 w-2 h-2 border-r border-b border-gold-500/30"}),o.jsxs("div",{className:"text-center mb-2",children:[o.jsx("h2",{className:"text-lg font-bold text-gold-400 font-serif tracking-wider ink-title",children:s.name}),o.jsx("p",{className:`font-medium text-sm ${L(s.rarity)}`,children:s.realm})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(kt,{value:r,maxValue:s.baseAttributes.maxHp,color:"bg-gradient-to-r from-cinnabar-600 to-cinnabar-400",label:"\u6c14\u8840"}),o.jsx(kt,{value:a,maxValue:s.baseAttributes.maxMp,color:"bg-gradient-to-r from-ink-600 via-ink-500 to-ink-400",label:"\u771f\u5143"})]}),o.jsx("div",{className:"mt-3 h-8 flex items-center justify-center",children:o.jsxs("button",{onClick:()=>u(!0),className:"px-3 py-1 bg-ink-800/80 rounded text-xs border border-gold-600/30 hover:border-gold-500/50 hover:bg-ink-700/80 transition-all duration-300 flex items-center gap-1.5 text-ink-300 hover:text-gold-400",children:[o.jsx("span",{children:"\u72b6\u6001"}),l.length>0&&o.jsx("span",{className:"bg-gold-600 text-ink-900 px-1.5 rounded font-bold",children:l.length})]})})]})]})},St=({animation:e})=>o.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none animate-flash",children:o.jsx("div",{className:"relative w-32 h-32",children:(()=>{const t="text-6xl md:text-8xl text-yellow-300 drop-shadow-[0_0_15px_rgba(252,211,77,0.7)]";switch(e.effect){case"slash":return o.jsx("div",{className:t,children:"\u2694\ufe0f"});case"fire":return o.jsx("div",{className:t,children:"\ud83d\udd25"});case"heal":return o.jsx("div",{className:"text-6xl md:text-8xl text-green-400 drop-shadow-[0_0_15px_rgba(74,222,128,0.7)]",children:"\u2728"});case"shield":return o.jsx("div",{className:"text-6xl md:text-8xl text-sky-400 drop-shadow-[0_0_15px_rgba(56,189,248,0.7)]",children:"\ud83d\udee1\ufe0f"});default:return o.jsx("div",{className:t,children:"\ud83d\udca5"})}})()})},e.key),Et=({pet:e})=>o.jsxs("div",{className:"w-24 h-32 bg-stone-800/70 rounded-lg border border-stone-600 p-2 flex flex-col items-center justify-center text-center",children:[o.jsx("div",{className:"text-2xl",children:"\ud83d\udc3e"}),o.jsx("p",{className:"text-xs font-bold text-white truncate",children:e.name}),o.jsxs("p",{className:"text-[10px] text-amber-400",children:["[",e.rarity,"]"]})]}),Pt=({player:e,opponent:t,animation:n,lastHit:s})=>o.jsxs("div",{className:"w-full h-full relative flex justify-around items-center p-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"animate-fade-in transition-transform duration-300 hover:scale-105",children:o.jsx(Ct,{participant:e,isPlayer:!0,wasHit:"player"===s})}),e.pet&&o.jsx("div",{className:"animate-fade-in-right",children:o.jsx(Et,{pet:e.pet})})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none",children:n&&o.jsx(St,{animation:n})}),o.jsxs("div",{className:"flex items-center gap-4",children:[t.pet&&o.jsx("div",{className:"animate-fade-in-left",children:o.jsx(Et,{pet:t.pet})}),o.jsx("div",{className:"animate-fade-in transition-transform duration-300 hover:scale-105",children:o.jsx(Ct,{participant:t,isPlayer:!1,wasHit:"opponent"===s})})]})]}),$t=({victory:e,isFled:t=!1,onClose:n})=>{if(null===e)return null;const s=t?{text:"\u9041\u8d70",subText:"\u4e09\u5341\u516d\u8ba1\uff0c\u8d70\u4e3a\u4e0a\u8ba1",icon:"\ud83c\udf00",bgGradient:"from-orange-900/30 via-amber-800/20 to-orange-900/30",textColor:"text-orange-400",borderColor:"border-orange-500/50",glowColor:"shadow-orange-500/20"}:e?{text:"\u5927\u80dc",subText:"\u5929\u9053\u916c\u52e4\uff0c\u9053\u5fc3\u6c38\u56fa",icon:"\u2694\ufe0f",bgGradient:"from-gold-900/40 via-amber-700/30 to-gold-900/40",textColor:"text-gold-400",borderColor:"border-gold-500/60",glowColor:"shadow-gold-500/30"}:{text:"\u8d25\u5317",subText:"\u80dc\u8d25\u4e43\u5175\u5bb6\u5e38\u4e8b",icon:"\ud83d\udc80",bgGradient:"from-slate-900/50 via-slate-800/40 to-slate-900/50",textColor:"text-paper-400",borderColor:"border-slate-500/50",glowColor:"shadow-slate-500/20"};return o.jsxs("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",children:[o.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e&&!t&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute top-1/4 left-1/4 text-6xl text-gold-500/10 animate-pulse",children:"\u2727"}),o.jsx("div",{className:"absolute bottom-1/4 right-1/4 text-6xl text-gold-500/10 animate-pulse",style:{animationDelay:"0.5s"},children:"\u2727"}),o.jsx("div",{className:"absolute top-1/3 right-1/3 text-4xl text-gold-400/10 animate-pulse",style:{animationDelay:"1s"},children:"\u262f"})]})}),o.jsxs("div",{className:`relative bg-gradient-to-br ${s.bgGradient} bg-ink-900/95 border-2 ${s.borderColor} backdrop-blur-lg w-full max-w-md shadow-2xl ${s.glowColor} flex flex-col items-center justify-center p-8 text-center rounded-xl overflow-hidden`,children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/50 to-transparent"}),o.jsx("div",{className:"absolute top-2 left-2 text-gold-500/30",children:"\u25c8"}),o.jsx("div",{className:"absolute top-2 right-2 text-gold-500/30",children:"\u25c8"}),o.jsx("div",{className:"absolute bottom-2 left-2 text-gold-500/30",children:"\u25c8"}),o.jsx("div",{className:"absolute bottom-2 right-2 text-gold-500/30",children:"\u25c8"}),o.jsx("div",{className:"text-7xl mb-4 "+(e&&!t?"animate-bounce":""),children:s.icon}),o.jsxs("h2",{className:`text-5xl font-bold mb-2 font-serif ${s.textColor} text-shadow-glow`,children:["\u3016 ",s.text," \u3017"]}),o.jsx("p",{className:"text-paper-400 mb-6 text-lg italic",children:s.subText}),t&&o.jsx("p",{className:"text-paper-500 mb-6 text-sm bg-ink-800/50 px-4 py-2 rounded-lg border border-orange-500/20",children:"\ud83c\udf00 \u4f60\u6210\u529f\u9041\u8d70\uff0c\u4f46\u6b64\u6218\u88ab\u5224\u5b9a\u4e3a\u843d\u8d25"}),o.jsx("button",{onClick:n,className:"qi-flow-btn px-8 py-3 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 hover:shadow-lg",children:o.jsxs("span",{className:"relative z-10 text-gold-300 flex items-center gap-2",children:[o.jsx("span",{children:"\u7ee7\u7eed\u4fee\u884c"}),o.jsx("span",{children:"\u2192"})]})}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/50 to-transparent"})]})]})},_t=()=>{const[e,t]=x.useState({isCompact:!1,isMiniMode:!1,isMobile:!1,availableHeight:window.innerHeight,availableWidth:window.innerWidth,contentHeight:window.innerHeight,shouldHideTopBar:!1});return x.useEffect(()=>{const e=()=>{const e=window.innerHeight,n=window.innerWidth,s=e<500,r=e<600,a=e-(s?0:r?48:64)-(r?80:112);t({isCompact:r,isMiniMode:s,isMobile:n<768,availableHeight:e,availableWidth:n,contentHeight:Math.max(a,200),shouldHideTopBar:s})};e(),window.addEventListener("resize",e);const n=new ResizeObserver(e);return n.observe(document.body),()=>{window.removeEventListener("resize",e),n.disconnect()}},[]),e},Dt={"\u63a2\u7d22":"\ud83d\uddfa\ufe0f","\u961f\u4f0d":"\u2694\ufe0f","\u80cc\u5305":"\ud83d\udce6","\u6d3b\u52a8":"\ud83c\udfc6","\u66f4\u591a":"\u2630","\u5546\u57ce":"\ud83c\udfea","\u4efb\u52a1":"\ud83d\udcdc","\u8bb0\u5fc6":"\ud83d\udcd6","\u4f20\u97f3":"\ud83d\udd2e","\u80b2\u7075\u8f69":"\ud83e\uddec","\u4ea7\u4e1a":"\ud83c\udfdb\ufe0f","\u533b\u9986":"\ud83d\udc8a","\u7ea2\u5c18\u5f55":"\ud83d\udcd5","\u9547\u72f1\u5927\u7262":"\u26d3\ufe0f","\u793c\u4eea\u8bbe\u8ba1\u9986":"\ud83c\udf80","\u5927\u95ef\u5173":"\ud83c\udff0","\u6c5f\u6e56\u4f20\u95fb":"\ud83d\udce2","\u4eba\u7269\u72b6\u6001":"\ud83d\udc65","\u7cfb\u7edf":"\u2699\ufe0f"},Lt=({label:e,icon:t,onClick:n,color:s,badge:r,isCompact:a,useXianxiaIcon:l=!0})=>o.jsxs("button",{onClick:n,className:`qi-flow-btn relative flex flex-col items-center justify-center ${a?"w-12 h-12":"w-14 h-14"} text-ink-300 rounded-lg transition-all duration-300 active:scale-95 ${s||""}`,title:e,children:[o.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden pointer-events-none",children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gold-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})}),l&&Dt[e]?o.jsx("span",{className:(a?"text-lg":"text-xl")+" filter drop-shadow-[0_0_4px_rgba(180,149,106,0.4)]",children:Dt[e]}):o.jsx("i",{className:`${t} ${a?"text-lg":"text-xl"}`}),!a&&o.jsx("span",{className:"text-[10px] mt-1 font-semibold tracking-wide font-elegant",children:e}),void 0!==r&&r>0&&o.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-cinnabar-400 to-cinnabar-600 text-white text-xs rounded-full flex items-center justify-center font-bold shadow-[0_0_8px_rgba(166,61,61,0.5)] animate-pulse-soft border border-cinnabar-400/50",children:r>9?"9+":r})]}),Mt=e=>{const{gameState:t,isLoading:n,error:s,onExplorationAction:r,onNavClick:a,onMapClick:l,onInteractClick:i,onTelepathyClick:c,onSystemClick:d,onQuestClick:u,onBusinessClick:m,onNextDay:p,onHospitalClick:h,onBountyBoardClick:f,onAnnouncementsClick:g,onCultivationClick:b,onMemoryClick:y,onCharacterStatusClick:v,onPrisonClick:j,onEtiquetteHallClick:N,onGauntletClick:w}=e,[k,C]=x.useState(""),[S,E]=x.useState(!1),P=_t(),$=[{label:"\u63a2\u7d22",icon:"fa-solid fa-map-location-dot",onClick:l},{label:"\u961f\u4f0d",icon:"fa-solid fa-users",onClick:()=>a("\u961f\u4f0d")},{label:"\u80cc\u5305",icon:"fa-solid fa-briefcase",onClick:()=>a("\u80cc\u5305")},{label:"\u6d3b\u52a8",icon:"fa-solid fa-trophy",onClick:()=>a("\u7ade\u6280\u573a"),badge:t.playerProfile.quests.filter(e=>"In Progress"===e.status).length},{label:"\u66f4\u591a",icon:"fa-solid fa-ellipsis-vertical",onClick:()=>E(!S)}],_=[{label:"\u80b2\u7075\u8f69",icon:"fa-solid fa-dna",onClick:b,color:"text-purple-400"},{label:"\u4f20\u97f3",icon:"fa-solid fa-om",onClick:c,color:"text-cyan-400"},{label:"\u5546\u57ce",icon:"fa-solid fa-store",onClick:()=>a("\u5546\u57ce")},{label:"\u4efb\u52a1",icon:"fa-solid fa-scroll",onClick:u},{label:"\u4ea7\u4e1a",icon:"fa-solid fa-building",onClick:m},{label:"\u533b\u9986",icon:"fa-solid fa-hospital",onClick:h},{label:"\u8bb0\u5fc6",icon:"fa-solid fa-book-open",onClick:y,color:"text-pink-400"},{label:"\u7ea2\u5c18\u5f55",icon:"fa-solid fa-book-skull",onClick:f},{label:"\u6c5f\u6e56\u4f20\u95fb",icon:"fa-solid fa-bullhorn",onClick:g},{label:"\u9547\u72f1\u5927\u7262",icon:"fa-solid fa-dungeon",onClick:j,color:"text-red-400"},{label:"\u793c\u4eea\u8bbe\u8ba1\u9986",icon:"fa-solid fa-ribbon",onClick:N,color:"text-pink-400"},{label:"\u5927\u95ef\u5173",icon:"fa-solid fa-trophy",onClick:w,color:"text-amber-400"},{label:"\u4eba\u7269\u72b6\u6001",icon:"fa-solid fa-users-viewfinder",onClick:v,color:"text-teal-400"},{label:"\u7cfb\u7edf",icon:"fa-solid fa-bars",onClick:d}];return o.jsxs(o.Fragment,{children:[S&&o.jsx("div",{className:"fixed inset-0 bg-ink-950/85 z-40 backdrop-blur-md animate-fade-in flex items-end justify-center pb-24",onClick:()=>E(!1),children:o.jsxs("div",{className:"w-[92vw] max-w-md ink-card rounded-xl p-5 backdrop-blur-md animate-fade-in mb-4 relative xianxia-frame immortal-mist",onClick:e=>e.stopPropagation(),style:{maxHeight:"calc(100vh - 240px)",overflowY:"auto"},children:[o.jsx("div",{className:"absolute top-2 left-2 text-gold-500/40 text-xs",children:"\u2601"}),o.jsx("div",{className:"absolute top-2 right-2 text-gold-500/40 text-xs",style:{transform:"scaleX(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute bottom-2 left-2 text-gold-500/40 text-xs",style:{transform:"scaleY(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute bottom-2 right-2 text-gold-500/40 text-xs",style:{transform:"scale(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute top-3 left-3 w-4 h-4 border-l-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute top-3 right-3 w-4 h-4 border-r-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-3 left-3 w-4 h-4 border-l-2 border-b-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-3 right-3 w-4 h-4 border-r-2 border-b-2 border-gold-500/25"}),o.jsxs("div",{className:"text-center mb-5 relative",children:[o.jsx("div",{className:"absolute left-0 right-0 top-1/2 h-px bg-gradient-to-r from-transparent via-gold-500/30 to-transparent"}),o.jsxs("h3",{className:"relative inline-block px-6 py-1 text-gold-400 font-bold text-lg tracking-[0.2em] ink-title font-brush bg-ink-900/90",children:[o.jsx("span",{className:"text-gold-500/50 mr-2",children:"\u3013"}),"\u4ed9\u95e8\u79d8\u5883",o.jsx("span",{className:"text-gold-500/50 ml-2",children:"\u3013"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs text-gold-500/70",children:[o.jsx("span",{children:"\u2697"}),o.jsx("span",{className:"tracking-wider",children:"\u4fee\u70bc\u4e4b\u9053"}),o.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-gold-500/30 to-transparent"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.slice(0,2).map(e=>o.jsx(Lt,{...e,isCompact:!1,onClick:()=>{e.onClick(),E(!1)}},e.label))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs text-gold-500/70",children:[o.jsx("span",{children:"\u2694"}),o.jsx("span",{className:"tracking-wider",children:"\u6c5f\u6e56\u4e8b\u52a1"}),o.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-gold-500/30 to-transparent"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.slice(2,6).map(e=>o.jsx(Lt,{...e,isCompact:!1,onClick:()=>{e.onClick(),E(!1)}},e.label))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs text-gold-500/70",children:[o.jsx("span",{children:"\ud83d\udcdc"}),o.jsx("span",{className:"tracking-wider",children:"\u79d8\u5178\u8bb0\u5f55"}),o.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-gold-500/30 to-transparent"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.slice(6,9).map(e=>o.jsx(Lt,{...e,isCompact:!1,onClick:()=>{e.onClick(),E(!1)}},e.label))})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs text-gold-500/70",children:[o.jsx("span",{children:"\ud83c\udfdb"}),o.jsx("span",{className:"tracking-wider",children:"\u795e\u79d8\u6bbf\u5802"}),o.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-gold-500/30 to-transparent"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.slice(9).map(e=>o.jsx(Lt,{...e,isCompact:!1,onClick:()=>{e.onClick(),E(!1)}},e.label))})]})]}),o.jsxs("button",{onClick:()=>E(!1),className:"w-full py-2.5 text-ink-400 hover:text-gold-400 text-sm transition-all duration-300 bg-ink-800/50 hover:bg-ink-700/60 rounded-lg mt-4 border border-gold-600/20 hover:border-gold-500/30 tracking-wider",children:[o.jsx("span",{className:"text-gold-500/50 mr-1",children:"\u25c7"}),"\u6536\u8d77",o.jsx("span",{className:"text-gold-500/50 ml-1",children:"\u25c7"})]})]})}),o.jsxs("footer",{className:"fixed bottom-0 left-0 right-0 w-full bg-gradient-to-t from-ink-950/98 via-ink-900/95 to-transparent backdrop-blur-md z-20 border-t border-gold-600/20 "+(P.isCompact?"p-2":"p-3"),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/40 to-transparent"}),o.jsxs("div",{className:"w-full max-w-screen-lg mx-auto flex flex-col gap-2 relative",children:[o.jsx("div",{className:P.isCompact?"order-2":"order-1",children:n?o.jsx("div",{className:"flex items-center justify-center h-16",children:o.jsxs("div",{className:"flex items-center gap-3 bg-ink-900/80 border border-gold-600/25 px-6 py-3 rounded-full immortal-mist",children:[o.jsx("span",{className:"text-gold-500 text-lg animate-spin",style:{animationDuration:"3s"},children:"\u262f"}),o.jsx("span",{className:"text-gold-400 font-elegant text-sm tracking-[0.15em]",children:"\u5929\u673a\u8fd0\u8f6c\u4e2d..."}),o.jsx("span",{className:"text-gold-500/60 text-sm animate-pulse",children:"\u2727"})]})}):o.jsxs(o.Fragment,{children:[s&&o.jsxs("div",{className:"text-cinnabar-400 text-center mb-2 font-serif text-xs bg-cinnabar-600/10 py-1.5 px-3 rounded-lg border border-cinnabar-500/30 animate-shake",children:[o.jsx("span",{className:"mr-1",children:"\u26a0"})," ",s]}),o.jsx("div",{className:"flex flex-wrap justify-center gap-2 "+(P.isCompact?"mb-1":"mb-2"),children:t.exploration.choices.slice(0,P.isMobile?2:3).map((e,t)=>o.jsxs("button",{onClick:()=>r(e),className:`flex-1 min-w-[120px] max-w-[200px] text-center jade-slip ${P.isCompact?"px-2 py-1.5 text-xs":"px-3 py-2 text-sm"} rounded hover:bg-ink-700/60 hover:border-gold-500/40 transition-all duration-300 active:scale-95 font-elegant backdrop-blur-sm`,children:[o.jsx("span",{className:"text-gold-500/50 mr-1",children:"\u25c7"}),e]},t))}),o.jsxs("form",{onSubmit:e=>{e.preventDefault(),k.trim()&&!n&&(r(k.trim()),C(""))},className:"flex gap-2",children:[o.jsxs("div",{className:"flex-1 relative",children:[o.jsx("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"\u65bd\u5c55\u795e\u901a...",className:`w-full bg-ink-900/90 border border-gold-600/30 rounded-lg ${P.isCompact?"px-3 py-1 text-xs":"px-4 py-1.5 text-sm"} focus:outline-none focus:ring-1 focus:ring-gold-500/50 focus:border-gold-500/50 font-elegant backdrop-blur-sm text-ink-100 placeholder-ink-500`}),o.jsx("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 text-gold-500/30 text-xs pointer-events-none",children:"\u2726"})]}),o.jsx("button",{type:"submit",disabled:!k.trim(),className:`qi-flow-btn ${P.isCompact?"px-3 py-1 text-xs":"px-4 py-1.5 text-sm"} rounded-lg active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed font-elegant tracking-wider`,children:"\u8fd0\u529f"}),!P.isCompact&&o.jsxs("button",{type:"button",onClick:p,className:"qi-flow-btn font-bold px-4 py-1.5 text-sm rounded-lg active:scale-95 transition-all duration-300 tracking-wider",children:[o.jsx("span",{className:"mr-1",children:"\u2600"}),"\u7fcc\u65e5"]})]})]})}),o.jsx("div",{className:P.isCompact?"order-1":"order-2",children:o.jsx("div",{className:"flex justify-center items-center gap-2",children:$.map(e=>o.jsx(Lt,{...e,isCompact:P.isCompact},e.label))})})]})]})]})},At=({isOpen:e,onClose:t,bountyBoard:n,onViewTarget:s,onAccept:r,onClaim:a,onRefresh:l,onAddTarget:i,isLoading:c})=>{const[d,u]=x.useState("\u60ac\u8d4f\u4e2d");if(!e)return null;const m=n.filter(e=>e.status===d),p=({endTime:e})=>{const[t,n]=x.useState(e-Date.now());x.useEffect(()=>{const t=setInterval(()=>{const s=e-Date.now();s<=0&&clearInterval(t),n(s)},1e3);return()=>clearInterval(t)},[e]);return o.jsx("span",{className:"font-mono text-amber-400",children:(e=>{if(e<=0)return"\u5373\u5c06\u5b8c\u6210...";const t=Math.floor(e/1e3),n=Math.floor(t/3600),s=Math.floor(t%3600/60),r=t%60;return`${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`})(t)})},h=e=>{switch(e.status){case"\u60ac\u8d4f\u4e2d":return o.jsx("button",{onClick:()=>r(e.id),className:"bg-green-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-green-500/80 transition-colors",children:"\u63a5\u53d7\u60ac\u8d4f"});case"\u8ffd\u8e2a\u4e2d":return o.jsxs("div",{className:"text-center",onClick:e=>e.stopPropagation(),children:[o.jsx("p",{className:"text-sm text-gray-400",children:"\u5269\u4f59\u65f6\u95f4"}),o.jsx(p,{endTime:e.endTime})]});case"\u5df2\u5b8c\u6210":return o.jsx("button",{onClick:()=>a(e.id),className:"bg-yellow-500/80 text-white font-bold px-4 py-2 rounded-md hover:bg-yellow-400/80 transition-colors animate-pulse-slow",children:"\u67e5\u770b\u7ed3\u679c"});case"\u5df2\u7ed3\u675f":return o.jsx("span",{className:"text-gray-500 font-semibold",children:"\u5df2\u7ed3\u675f"});default:return null}};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u7ea2\u5c18\u5f55"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-stone-700 bg-black/10",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>u("\u60ac\u8d4f\u4e2d"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u60ac\u8d4f\u4e2d"===d?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u60ac\u8d4f\u4e2d"}),o.jsx("button",{onClick:()=>u("\u8ffd\u8e2a\u4e2d"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u8ffd\u8e2a\u4e2d"===d?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u8ffd\u8e2a\u4e2d"}),o.jsx("button",{onClick:()=>u("\u5df2\u5b8c\u6210"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u5df2\u5b8c\u6210"===d?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5df2\u5b8c\u6210"}),o.jsx("button",{onClick:()=>u("\u5df2\u7ed3\u675f"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("\u5df2\u7ed3\u675f"===d?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5df2\u7ed3\u675f"})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>i("Female"),disabled:c,className:"px-3 py-1 text-xs bg-pink-500/20 text-pink-300 rounded-md hover:bg-pink-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"\u751f\u6210\u4e2d...":"\u6dfb\u52a0\u5973\u6027\u76ee\u6807"}),o.jsx("button",{onClick:()=>i("Male"),disabled:c,className:"px-3 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-md hover:bg-blue-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"\u751f\u6210\u4e2d...":"\u6dfb\u52a0\u7537\u6027\u76ee\u6807"}),o.jsxs("button",{onClick:l,disabled:c,className:"px-3 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded-md hover:bg-yellow-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:[o.jsx("i",{className:"fa-solid fa-sync "+(c?"animate-spin":"")})," \u5237\u65b0\u60ac\u8d4f"]})]})]}),o.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:m.length>0?o.jsx("div",{className:"space-y-4",children:m.map(e=>o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 flex justify-between items-center",children:[o.jsxs("div",{className:"cursor-pointer flex-grow",onClick:()=>s(e),children:[o.jsxs("h3",{className:`text-xl font-bold font-serif ${L(e.character.rarity)}`,children:[e.name," ",o.jsxs("span",{className:"text-base font-normal text-gray-400",children:["[",e.character.rarity,"]"]})]}),o.jsxs("p",{className:"text-sm text-gray-400 italic mt-1",children:["\u7ebf\u7d22: ",e.locationHint]}),o.jsxs("p",{className:"text-sm text-pink-400 mt-1",children:["\u7279\u5f81: ",e.specialTrait]})]}),o.jsx("div",{className:"w-32 text-center flex-shrink-0",children:h(e)})]},e.id))}):o.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83d\udcdc"}),o.jsx("p",{children:"\u6b64\u699c\u5355\u4e0a\u6682\u65e0\u8bb0\u5f55\u3002"})]})})]})})},Tt=({isOpen:e,onClose:t,bounty:n,onOutcome:s})=>e?o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["\u4efb\u52a1\u62a5\u544a\uff1a",n.name]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-amber-400",children:"\u8ffd\u6355\u65e5\u5fd7"}),o.jsx("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:o.jsx("p",{className:"text-gray-300 italic leading-relaxed",children:n.trackingLog||"\u65e5\u5fd7\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u9057\u5931\u4e86..."})}),o.jsx("h3",{className:"text-lg font-semibold text-amber-400 mt-6",children:"\u5982\u4f55\u5904\u7f6e?"}),o.jsx("p",{className:"text-gray-400",children:"\u76ee\u6807\u5df2\u88ab\u6210\u529f\u5236\u670d\uff0c\u73b0\u5728\uff0c\u4f60\u6765\u51b3\u5b9aTa\u7684\u547d\u8fd0\u3002"})]}),o.jsxs("div",{className:"p-4 bg-black/20 border-t border-stone-700 flex justify-end gap-4",children:[o.jsx("button",{onClick:()=>s("killed"),className:"px-6 py-2 rounded-md font-semibold text-white bg-red-800 hover:bg-red-700 transition-colors",children:"\u6740\u5bb3"}),o.jsx("button",{onClick:()=>s("imprisoned"),className:"px-6 py-2 rounded-md font-semibold text-white bg-sky-600 hover:bg-sky-500 transition-colors",children:"\u538b\u5165\u5927\u7262"})]})]})}):null,It=e=>{const t=JSON.parse(JSON.stringify(e.baseAttributes)),n=Object.values(e.equipment);for(const s of n)if(s)for(const[e,n]of Object.entries(s.stats))if(void 0!==n)switch(e){case"hp":t.maxHp+=n;break;case"mp":t.maxMp+=n;break;case"attack":t.attack+=n;break;case"defense":t.defense+=n;break;case"speed":t.speed+=n;break;case"critRate":t.critRate+=n;break;case"critDmg":t.critDmg+=n}return t.hp=t.maxHp,t.mp=t.maxMp,t},Ot={p_brothel_star:1.5,p_brothel_tutor:1.2,p_brothel_guard:.5,p_arena_gladiator:1.8,p_arena_host:1.1,p_arena_trader:1,p_alchemy_chief:2,p_alchemy_apprentice:.8,p_auction_master:2.5,p_auction_appraiser:1.5,p_intel_chief:2.2,p_intel_assassin:1.7},zt={"\u9752\u697c":10,"\u89d2\u6597\u573a":5,"\u70bc\u4e39\u623f":2,"\u62cd\u5356\u884c":0,"\u60c5\u62a5\u9601":0};function Rt(e,t){if(!e.businessDistrict)return 0;const{shops:n,level:s}=e.businessDistrict;let r=0;if((t?n.filter(e=>e.id===t):n).forEach(t=>{let n=(zt[t.type]||0)*(1+.2*(t.level-1));t.staff.forEach(t=>{const s=e.cardCollection.find(e=>e.id===t.characterId),r=Ge[t.positionId];if(s&&r){const e=s[r.requiredAttr]||10,a=Ot[t.positionId]||1;n+=e/10*a}}),r+=n}),!t){r*=1+.1*(s-1);const t=e.reputation.score/5e3;r*=1+t}return Math.floor(r)}const Ft=({isOpen:e,onClose:t,playerProfile:n,onUpdateProfile:s,onOpenSurveillance:r,busyCharacterIds:a,onOpenSelector:l,etiquetteSystem:i})=>{const[c,d]=x.useState("\u9752\u697c"),[u,m]=x.useState(!1),{businessDistrict:p,cardCollection:h}=n,f=x.useMemo(()=>(e=>{if(!i)return{language:[],behavior:[]};const t=e;return{language:i.languageEtiquettes.filter(e=>e.isDistributed&&e.distributions?.some(e=>e.shopType===t&&"distributed"===e.status)),behavior:i.behaviorDressEtiquettes.filter(e=>e.isDistributed&&e.distributions?.some(e=>e.shopType===t&&"distributed"===e.status))}})(c),[c,i]),g=x.useMemo(()=>{if(!p)return{};const e={};return p.shops.forEach(t=>{e[t.id]=Rt(n,t.id)}),e},[n,p]);if(!e)return null;return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:p?p.name:"\u4ea7\u4e1a\u7ba1\u7406"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),p?o.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"md:col-span-1 space-y-4",children:[o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"font-semibold text-amber-400 mb-2",children:"\u8857\u533a\u603b\u89c8"}),o.jsxs("p",{className:"text-gray-300",children:["\u7b49\u7ea7: ",o.jsx("span",{className:"font-mono",children:p.level})]}),o.jsxs("p",{className:"text-gray-300",children:["\u5e97\u94fa\u6570\u91cf: ",o.jsx("span",{className:"font-mono",children:p.shops.length})]})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 h-96 overflow-y-auto",children:[o.jsx("h3",{className:"font-semibold text-amber-400 mb-2",children:"\u7ecf\u8425\u65e5\u5fd7"}),o.jsx("ul",{className:"space-y-2 text-sm",children:p.log.map((e,t)=>o.jsxs("li",{className:"text-gray-400",children:[o.jsxs("span",{className:"font-mono text-gray-500 mr-2",children:["[",e.timestamp,"]"]}),e.message]},t))})]})]}),o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("div",{className:"flex border-b border-stone-700 mb-4",children:["\u9752\u697c","\u89d2\u6597\u573a","\u70bc\u4e39\u623f","\u62cd\u5356\u884c","\u60c5\u62a5\u9601"].map(e=>{const t=p.shops.some(t=>t.type===e);return o.jsx("button",{disabled:!t,onClick:()=>d(e),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 disabled:text-gray-600 disabled:cursor-not-allowed "+(c===e?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:e},e)})}),o.jsxs("div",{className:"space-y-4",children:[u&&(f.language.length>0||f.behavior.length>0)&&o.jsxs("div",{className:"mb-4 p-4 bg-pink-900/20 rounded-lg border border-pink-500/30",children:[o.jsxs("h3",{className:"text-lg font-bold text-pink-300 mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-scroll"}),"\u5f53\u524d\u751f\u6548\u7684\u793c\u4eea\u89c4\u8303"]}),f.language.length>0&&o.jsxs("div",{className:"mb-3",children:[o.jsx("h4",{className:"text-sm font-semibold text-pink-400 mb-2",children:"\ud83d\udcac \u8bed\u8a00\u94c1\u5f8b"}),o.jsx("div",{className:"space-y-2",children:f.language.map(e=>o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded border border-pink-500/20",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"font-bold text-white text-sm",children:e.name}),o.jsxs("span",{className:"text-xs text-gray-400",children:["\ud83d\udc65 ",e.applicableRoles.join(", ")]})]}),o.jsx("p",{className:"text-xs text-gray-300 line-clamp-2",children:e.content})]},e.id))})]}),f.behavior.length>0&&o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-purple-400 mb-2",children:"\ud83d\udc57 \u884c\u4e3a\u7740\u88c5\u94c1\u5f8b"}),o.jsx("div",{className:"space-y-2",children:f.behavior.map(e=>o.jsxs("div",{className:"p-2 bg-stone-800/50 rounded border border-purple-500/20",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"font-bold text-white text-sm",children:e.name}),o.jsxs("span",{className:"text-xs text-gray-400",children:["\ud83d\udc65 ",e.applicableRoles.join(", ")]})]}),o.jsxs("div",{className:"text-xs text-gray-300",children:[e.dressCode.upper&&o.jsxs("p",{className:"line-clamp-1",children:["\u4e0a\u8eab: ",e.dressCode.upper]}),e.dressCode.lower&&o.jsxs("p",{className:"line-clamp-1",children:["\u4e0b\u8eab: ",e.dressCode.lower]})]})]},e.id))})]})]}),p.shops.filter(e=>e.type===c).map(e=>o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("h3",{className:"font-semibold text-lg text-cyan-400",children:[e.type," (Lv. ",e.level,")"]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("p",{className:"text-sm text-gray-400",children:["\u9884\u671f\u65e5\u6536\u5165: ",o.jsxs("span",{className:"font-mono text-amber-400",children:[g[e.id]||0," \u7075\u77f3"]})]}),o.jsxs("button",{onClick:()=>m(!u),className:"text-xs px-2 py-1 rounded-md transition-colors "+(u?"bg-pink-600/50 text-pink-300":"bg-stone-600/50 text-gray-300 hover:bg-pink-600/30"),children:[o.jsx("i",{className:"fa-solid fa-scroll mr-1"}),"\u793c\u4eea (",f.language.length+f.behavior.length,")"]}),o.jsx("button",{onClick:()=>r(e),className:"text-xs bg-purple-600/50 text-purple-300 px-2 py-1 rounded-md hover:bg-purple-600/80",children:"\u76d1\u89c6"})]})]}),o.jsx("div",{className:"space-y-2",children:Object.entries(Ge).filter(([,t])=>t.shop===e.type).map(([t,r])=>{const i=e.staff.find(e=>e.positionId===t),c=i?h.find(e=>e.id===i.characterId):null;return o.jsxs("div",{className:"flex items-center justify-between bg-stone-800/50 p-2 rounded-md",children:[o.jsx("span",{className:"text-gray-300",children:r.name}),c?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-amber-300",children:c.name}),o.jsx("button",{onClick:()=>((e,t)=>{if(!p)return;const r=JSON.parse(JSON.stringify(p)),a=r.shops.find(t=>t.id===e);a&&(a.staff=a.staff.filter(e=>e.characterId!==t),s({...n,businessDistrict:r}))})(e.id,c.id),className:"text-red-500 hover:text-red-400 text-xs",children:"\u5378\u4e0b"})]}):o.jsx("button",{onClick:()=>{const i=(()=>{if(!p)return h.filter(e=>!a.has(e.id));const e=new Set(p.shops.flatMap(e=>e.staff.map(e=>e.characterId)));return h.filter(t=>!e.has(t.id)&&!a.has(t.id))})();l(`\u4e3a\u3010${r.name}\u3011\u9009\u62e9\u5458\u5de5`,i,r=>{((e,t,r)=>{if(!p)return;const a=JSON.parse(JSON.stringify(p)),l=a.shops.find(t=>t.id===e);l&&(a.shops.forEach(e=>{e.staff=e.staff.filter(e=>e.characterId!==r)}),l.staff.push({characterId:r,positionId:t}),s({...n,businessDistrict:a}))})(e.id,t,r.id)})},className:"bg-stone-700 text-white text-sm rounded px-2 py-1 hover:bg-stone-600",children:"\u9009\u62e9\u5458\u5de5"})]},t)})})]},e.id))]})]})]})}):o.jsx("div",{className:"flex-grow flex items-center justify-center",children:o.jsxs("div",{className:"text-center text-gray-500",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83c\udfef"}),o.jsx("p",{children:"\u4f60\u8fd8\u672a\u62e5\u6709\u81ea\u5df1\u7684\u4ea7\u4e1a\u3002"}),o.jsx("p",{className:"text-sm mt-2",children:"\u5b8c\u6210\u7279\u5b9a\u4efb\u52a1\u6216\u79ef\u7d2f\u8db3\u591f\u8d44\u672c\uff0c\u5f00\u542f\u4f60\u7684\u5546\u4e1a\u5e1d\u56fd\u5427\uff01"})]})})]})})},qt=({isOpen:e,onClose:t,challenge:n,onAccept:s,onDecline:r})=>e?o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col items-center p-6 text-center",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"p-4 text-center",children:o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u6311\u6218"})}),o.jsxs("div",{className:"p-6 font-serif flex flex-col justify-center items-center",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\u2694\ufe0f"}),o.jsxs("p",{className:"text-white text-lg",children:[o.jsx("span",{className:"font-bold text-red-400",children:n.challengerName})," \u5411\u4f60\u53d1\u8d77\u4e86\u6311\u6218\uff01"]}),o.jsxs("p",{className:"text-amber-300 mt-2 italic",children:['"',n.reason,'"']}),o.jsxs("div",{className:"flex justify-center gap-4 mt-8",children:[o.jsx("button",{onClick:r,className:"px-6 py-2 bg-stone-600 hover:bg-stone-500 rounded-md font-semibold text-white",children:"\u62d2\u7edd\u6311\u6218"}),o.jsx("button",{onClick:s,className:"px-6 py-2 bg-red-700 text-white hover:bg-red-600 rounded-md font-bold",children:"\u63a5\u53d7\u6311\u6218"})]})]})]})}):null,Bt=e=>({attack:"\u653b\u51fb",defense:"\u9632\u5fa1",hp:"\u6c14\u8840",speed:"\u901f\u5ea6",critRate:"\u4f1a\u5fc3\u7387",critDmg:"\u4f1a\u5fc3\u4f24\u5bb3"}[e]||e),Ht=(e,t)=>"critRate"===e||"critDmg"===e?`${(100*t).toFixed(0)}%`:t>0?`+${t}`:`${t}`,Ut=({playerProfile:e,card:t,selectionState:n,onClose:s,onEquip:r,onLearnSkill:a,onEquipPet:l})=>{const[i,c]=x.useState(null),d=e=>"equipment"===e.type,u=e=>"skill"===e.type,m=e=>"pet"===e.type,p=(()=>{if(d(n))return e.equipmentInventory.filter(e=>e.type===n.slotType&&(!e.genderLock||"Universal"===e.genderLock||e.genderLock===t.gender));if(u(n)){const n=new Set(t.skills.map(e=>e?.id).filter(Boolean));return e.universalSkills.filter(e=>!n.has(e.id)&&("Universal"===e.genderLock||e.genderLock===t.gender))}if(m(n)){const n=new Set([...e.maleParty,...e.femaleParty].map(e=>e.pet?.id).filter(Boolean));return e.petCollection.filter(e=>e.gender===t.gender&&!n.has(e.id))}return[]})(),h=d(n)?t.equipment[n.slot]:null;return o.jsx("div",{className:"fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:s,children:o.jsxs("div",{className:"bg-slate-900/90 border border-slate-700 rounded-xl w-full max-w-2xl h-[70vh] shadow-2xl flex flex-col backdrop-blur-lg",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700 flex-shrink-0",children:[o.jsx("h2",{className:"text-xl font-bold text-white font-serif",children:(()=>{if(d(n)){return`\u9009\u62e9${{weapon:"\u6b66\u5668",armor:"\u8863\u670d",accessory1:"\u914d\u9970",accessory2:"\u914d\u9970"}[n.slot]}`}return m(n)?"\u9009\u62e9\u51fa\u6218\u517d\u5ba0":"\u9009\u62e9\u901a\u7528\u6280\u80fd"})()}),o.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"flex-grow flex flex-row overflow-hidden",children:[o.jsx("div",{className:"w-2/5 border-r border-slate-700 overflow-y-auto",children:p.length>0?p.map(e=>o.jsx("button",{onClick:()=>c(e),className:"w-full text-left p-3 text-sm transition-colors duration-150 "+(i?.id===e.id?"bg-amber-600/30":"hover:bg-slate-800/60"),children:o.jsxs("p",{className:"font-semibold text-white flex items-center gap-2",children:[o.jsx("span",{className:`${L(e.rarity)}`,children:e.name}),"rarity"in e&&o.jsxs("span",{className:`text-xs font-medium ${L(e.rarity)}`,children:["[",e.rarity,"]"]})]})},e.id)):o.jsx("p",{className:"p-4 text-sm text-gray-500",children:"\u65e0\u53ef\u7528\u9009\u9879"})}),o.jsxs("div",{className:"w-3/5 p-4 flex flex-col justify-between",children:[o.jsx("div",{children:i?d(n)?(f=i,g=h,o.jsxs("div",{children:[o.jsx("h3",{className:`text-lg font-bold ${L(f.rarity)}`,children:f.name}),o.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:[f.type," (",f.genderLock&&"Universal"!==f.genderLock?"Male"===f.genderLock?"\u7537\u6027\u4e13\u7528":"\u5973\u6027\u4e13\u7528":"\u901a\u7528",")"]}),o.jsx("div",{className:"space-y-2",children:Object.entries(f.stats).map(([e,t])=>{const n=g?.stats[e]||0,s=t-n;return o.jsxs("div",{className:"flex justify-between items-center text-sm",children:[o.jsx("span",{className:"text-gray-300",children:Bt(e)}),o.jsxs("div",{className:"flex items-center gap-2",children:[g&&o.jsx("span",{className:"text-gray-500",children:Ht(e,n)}),o.jsx("span",{className:"font-semibold "+(s>0?"text-green-400":s<0?"text-red-400":"text-white"),children:Ht(e,t)}),g&&0!==s&&o.jsxs("span",{className:"text-xs w-16 text-center font-mono "+(s>0?"text-green-500":"text-red-500"),children:["(",s>0?"+":"",s,")"]})]})]},e)})})]})):m(n)?(e=>o.jsxs("div",{children:[o.jsx("h3",{className:`text-lg font-bold ${L(e.rarity)}`,children:e.name}),o.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["(","Male"===e.gender?"\u96c4\u6027":"\u96cc\u6027",")"]}),o.jsx("p",{className:"text-sm text-gray-300 mb-4",children:e.description}),o.jsxs("div",{className:"bg-stone-800/50 p-3 rounded-md",children:[o.jsxs("h4",{className:"font-semibold text-amber-400 mb-2",children:["\u6280\u80fd: ",e.skill.name]}),o.jsx("p",{className:"text-sm font-semibold text-amber-300",children:e.skill.mechanicsDescription}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:e.skill.description})]})]}))(i):(e=>o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-baseline mb-2",children:[o.jsxs("h3",{className:"text-lg font-bold text-white flex items-baseline gap-2",children:[o.jsx("span",{className:`${L(e.rarity)}`,children:e.name}),o.jsxs("span",{className:`text-base font-medium ${L(e.rarity)}`,children:["[",e.rarity,"]"]})]}),o.jsxs("span",{className:"text-base font-mono text-blue-400",children:[e.cost," \u771f\u5143"]})]}),o.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["(","Universal"===e.genderLock?"\u901a\u7528":"Male"===e.genderLock?"\u7537\u6027\u4e13\u7528":"\u5973\u6027\u4e13\u7528",")"]}),o.jsx("p",{className:"text-sm font-semibold text-amber-300 mt-2",children:e.mechanicsDescription}),o.jsx("p",{className:"text-sm text-gray-400 mt-1",children:e.description})]}))(i):o.jsx("div",{className:"text-center text-gray-500 pt-10",children:o.jsx("p",{children:"\u4ece\u5de6\u4fa7\u5217\u8868\u9009\u62e9\u4e00\u9879\u4ee5\u9884\u89c8\u8be6\u60c5"})})}),i&&o.jsx("button",{onClick:()=>{d(n)&&r(n.slot,i),u(n)&&a(n.slotIndex,i),m(n)&&l(i)},className:"w-full bg-amber-600 text-white font-bold py-2 px-4 rounded-md hover:bg-amber-500 transition-colors",children:d(n)||m(n)?"\u88c5\u5907":"\u5b66\u4e60"})]})]})]})});var f,g},Vt=({skill:e,onClose:t})=>{const n="Universal"===e.genderLock?"\u901a\u7528":"Male"===e.genderLock?"\u7537\u6027\u4e13\u7528":"\u5973\u6027\u4e13\u7528";return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-xl w-full max-w-md shadow-2xl flex flex-col backdrop-blur-lg bg-slate-800/90",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center",children:[o.jsxs("h2",{className:"text-xl font-bold text-white font-serif flex items-baseline gap-2",children:[o.jsx("span",{children:e.name}),o.jsxs("span",{className:`text-base font-medium ${L(e.rarity)}`,children:["[",e.rarity,"]"]})]}),o.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsxs("div",{className:"p-6 font-serif",children:[o.jsxs("div",{className:"flex justify-between items-baseline mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-amber-400",children:"\u6280\u80fd\u8be6\u60c5"}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-base font-mono text-blue-400",children:e.cost>0?`${e.cost} \u771f\u5143`:"\u65e0\u6d88\u8017"}),o.jsx("p",{className:"text-sm text-gray-400",children:n})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-pink-400 mb-1 text-base",children:"\u52a8\u753b\u63cf\u8ff0"}),o.jsxs("p",{className:"text-gray-300 leading-relaxed text-sm italic",children:["\u201c",e.eroticDescription,"\u201d"]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-sky-400 mb-1 text-base",children:"\u673a\u5236\u63cf\u8ff0"}),o.jsx("p",{className:"text-gray-300 leading-relaxed text-sm",children:e.mechanicsDescription})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-semibold text-gray-500 mb-1 text-base",children:"\u80cc\u666f\u63cf\u8ff0"}),o.jsx("p",{className:"text-gray-400 leading-relaxed mt-2 text-sm italic",children:e.description})]})]})]})]})})},Wt={"\u6c14\u8840":"\u2764\ufe0f","\u771f\u5143":"\ud83d\udca0","\u653b\u51fb":"\u2694\ufe0f","\u9632\u5fa1":"\ud83d\udee1\ufe0f","\u901f\u5ea6":"\ud83d\udca8","\u4f1a\u5fc3\u7387":"\ud83c\udfaf","\u4f1a\u5fc3\u4f24\u5bb3":"\ud83d\udca5","\u9b45\u529b":"\ud83c\udf38","\u6280\u5de7":"\u270b","\u609f\u6027":"\ud83d\udca1"},Qt=({value:e,maxValue:t,color:n,label:s})=>{const r=t>0?e/t*100:0,a=Wt[s]||"\u25c7";return o.jsxs("div",{className:"group",children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsxs("span",{className:"text-sm font-medium text-paper-300 flex items-center gap-1",children:[o.jsx("span",{className:"opacity-80",children:a}),s]}),o.jsx("span",{className:"text-sm font-mono text-gold-400/80",children:`${Math.round(e)}/${Math.round(t)}`})]}),o.jsx("div",{className:"w-full bg-ink-900/80 rounded-full h-3 border border-gold-600/30 shadow-inner shadow-black/50 overflow-hidden",children:o.jsx("div",{className:`${n} h-full rounded-full transition-all duration-500 ease-in-out relative`,style:{width:`${r}%`},children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/20 to-transparent"})})})]})},Gt=({attributes:e,card:t})=>{const n=[{label:"\u653b\u51fb",value:Math.round(e.attack),icon:"\u2694\ufe0f"},{label:"\u9632\u5fa1",value:Math.round(e.defense),icon:"\ud83d\udee1\ufe0f"},{label:"\u901f\u5ea6",value:Math.round(e.speed),icon:"\ud83d\udca8"}],s=[{label:"\u4f1a\u5fc3\u7387",value:`${(100*e.critRate).toFixed(0)}%`,icon:"\ud83c\udfaf"},{label:"\u4f1a\u5fc3\u4f24\u5bb3",value:`${(100*e.critDmg).toFixed(0)}%`,icon:"\ud83d\udca5"}],r=[{label:"\u9b45\u529b",value:t.charm||0,icon:"\ud83c\udf38"},{label:"\u6280\u5de7",value:t.skillfulness||0,icon:"\u270b"},{label:"\u609f\u6027",value:t.perception||0,icon:"\ud83d\udca1"}];return o.jsxs("div",{className:"bg-gradient-to-br from-ink-900/60 to-ink-800/60 p-4 rounded-lg h-full flex flex-col border border-gold-600/30 relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-2 right-2 text-4xl text-gold-500/10",children:"\u262f"}),o.jsxs("h4",{className:"font-semibold text-gold-400 mb-3 text-lg flex items-center gap-2 relative z-10",children:[o.jsx("span",{children:"\u2727"}),o.jsx("span",{children:"\u4fee\u4e3a\u9762\u677f"}),o.jsx("span",{children:"\u2727"})]}),o.jsxs("div",{className:"space-y-3 relative z-10",children:[o.jsx(Qt,{value:e.hp,maxValue:e.maxHp,color:"bg-gradient-to-r from-cinnabar-700 to-cinnabar-500",label:"\u6c14\u8840"}),o.jsx(Qt,{value:e.mp,maxValue:e.maxMp,color:"bg-gradient-to-r from-blue-700 to-blue-500",label:"\u771f\u5143"})]}),o.jsx("div",{className:"grid grid-cols-3 gap-2 mt-4 text-center relative z-10",children:n.map(e=>o.jsxs("div",{className:"bg-ink-800/60 p-2 rounded-lg border border-gold-600/20 hover:border-gold-500/40 transition-colors group",children:[o.jsxs("p",{className:"text-xs text-paper-400 flex items-center justify-center gap-1",children:[o.jsx("span",{className:"opacity-70 group-hover:opacity-100 transition-opacity",children:e.icon}),e.label]}),o.jsx("p",{className:"font-bold text-gold-300",children:e.value})]},e.label))}),o.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2 text-center relative z-10",children:s.map(e=>o.jsxs("div",{className:"bg-ink-800/60 p-2 rounded-lg border border-gold-600/20 hover:border-gold-500/40 transition-colors group",children:[o.jsxs("p",{className:"text-xs text-paper-400 flex items-center justify-center gap-1",children:[o.jsx("span",{className:"opacity-70 group-hover:opacity-100 transition-opacity",children:e.icon}),e.label]}),o.jsx("p",{className:"font-bold text-gold-300",children:e.value})]},e.label))}),o.jsx("div",{className:"grid grid-cols-3 gap-2 mt-2 text-center relative z-10",children:r.map(e=>o.jsxs("div",{className:"bg-ink-800/60 p-2 rounded-lg border border-gold-600/20 hover:border-gold-500/40 transition-colors group",children:[o.jsxs("p",{className:"text-xs text-paper-400 flex items-center justify-center gap-1",children:[o.jsx("span",{className:"opacity-70 group-hover:opacity-100 transition-opacity",children:e.icon}),e.label]}),o.jsx("p",{className:"font-bold text-gold-300",children:e.value})]},e.label))})]})},Jt=({card:e,onClose:t,playerProfile:n,setPlayerProfile:s,onViewPet:r})=>{const[a,l]=x.useState(null),[i,c]=x.useState(null),d=x.useMemo(()=>{const t=n.maleParty.find(t=>t.id===e.id),s=n.femaleParty.find(t=>t.id===e.id),r=n.cardCollection.find(t=>t.id===e.id);return t||s||r||e},[n,e.id]),u=x.useMemo(()=>It(d),[d]),m=t=>{const r=JSON.parse(JSON.stringify(n)),a=r.cardCollection.find(t=>t.id===e.id),l=r.maleParty.find(t=>t.id===e.id),i=r.femaleParty.find(t=>t.id===e.id),o=[a,l,i].filter(Boolean);if(o.length>0){const e=o[0];t(e,r);const n=JSON.stringify(e);a&&Object.assign(a,JSON.parse(n)),l&&Object.assign(l,JSON.parse(n)),i&&Object.assign(i,JSON.parse(n))}s(r)},p={"\u6b66\u5668":"\u2694\ufe0f","\u8863\u670d":"\ud83d\udc58","\u914d\u9970\u4e00":"\ud83d\udc8d","\u914d\u9970\u4e8c":"\ud83d\udcff"};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:[o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[o.jsx("div",{className:"absolute top-20 left-20 text-9xl text-gold-500/5",children:"\u262f"}),o.jsx("div",{className:"absolute bottom-20 right-20 text-9xl text-gold-500/5",children:"\u262f"})]}),o.jsxs("div",{className:"relative bg-gradient-to-br from-ink-900/98 via-ink-800/98 to-ink-900/98 border-2 border-gold-600/50 backdrop-blur-lg w-full max-w-5xl h-[90vh] overflow-hidden shadow-2xl flex flex-col rounded-xl",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"}),o.jsx("div",{className:"absolute top-2 left-2 text-gold-500/30 text-lg",children:"\u25c8"}),o.jsx("div",{className:"absolute top-2 right-2 text-gold-500/30 text-lg",children:"\u25c8"}),o.jsxs("div",{className:"p-4 flex-shrink-0 bg-gradient-to-r from-ink-900/50 via-ink-800/50 to-ink-900/50 border-b border-gold-600/30",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-paper-100 font-serif flex items-baseline gap-3",children:[o.jsx("span",{className:"text-gold-400/60",children:"\u3010"}),o.jsx("span",{children:d.name}),o.jsx("span",{className:"text-gold-400/60",children:"\u3011"}),o.jsxs("span",{className:`text-lg font-medium ${L(d.rarity)}`,children:["\u3014",d.rarity,"\u3015"]})]}),o.jsxs("p",{className:"text-lg text-gold-400 font-serif flex items-center gap-2 mt-1",children:[o.jsx("span",{className:"text-sm opacity-60",children:"\u5883\u754c:"}),o.jsx("span",{className:"realm-mark px-2 py-0.5 text-sm",children:d.realm})]})]}),o.jsx("button",{onClick:t,className:"text-gold-400/70 hover:text-gold-300 transition-colors p-2 hover:bg-gold-500/10 rounded-lg",children:o.jsx("span",{className:"text-xl",children:"\u2715"})})]}),o.jsxs("div",{className:"mt-3 space-y-1.5 text-sm text-paper-300",children:[o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-500/70 font-semibold",children:"\ud83c\udff7\ufe0f \u79f0\u53f7:"}),o.jsx("span",{className:"jade-slip px-2 py-0.5",children:d.title||"\u65e0"})]}),o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-500/70 font-semibold",children:"\ud83e\uddec \u79cd\u65cf:"}),o.jsx("span",{children:d.race||"\u672a\u77e5"})]}),o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-500/70 font-semibold",children:"\ud83d\udcd6 \u6765\u5386:"}),o.jsx("span",{className:"italic opacity-80",children:d.origin||"\u4e00\u7247\u7a7a\u767d..."})]}),d.appearance&&o.jsxs("p",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-500/70 font-semibold",children:"\ud83d\udc64 \u5916\u89c2:"}),o.jsx("span",{className:"italic opacity-80",children:d.appearance})]})]})]}),o.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto flex-grow",children:[o.jsx(Gt,{attributes:u,card:d}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-gradient-to-br from-ink-900/60 to-ink-800/60 p-4 rounded-lg border border-gold-600/30",children:[o.jsxs("h4",{className:"font-semibold text-gold-400 mb-3 text-lg flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udde1\ufe0f"}),o.jsx("span",{children:"\u6cd5\u5b9d\u88c5\u5907"})]}),o.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{key:"weapon",label:"\u6b66\u5668",type:"Weapon"},{key:"armor",label:"\u8863\u670d",type:"Armor"},{key:"accessory1",label:"\u914d\u9970\u4e00",type:"Accessory"},{key:"accessory2",label:"\u914d\u9970\u4e8c",type:"Accessory"}].map(e=>o.jsxs("div",{className:"relative group",children:[o.jsxs("button",{onClick:()=>l({type:"equipment",slot:e.key,slotType:e.type}),className:`bg-ink-800/60 p-3 rounded-lg w-full text-left hover:bg-ink-700/70 transition-all duration-300 h-full border-2 hover:shadow-lg ${M(d.equipment[e.key]?.rarity)}`,children:[o.jsxs("p",{className:"text-sm text-paper-400 flex items-center gap-1",children:[o.jsx("span",{className:"opacity-70",children:p[e.label]}),e.label]}),o.jsx("p",{className:`font-bold truncate ${L(d.equipment[e.key]?.rarity)||"text-paper-500 italic"}`,children:d.equipment[e.key]?.name||"\u7a7a\u69fd\u4f4d"})]}),d.equipment[e.key]&&o.jsx("button",{onClick:()=>(e=>{m((t,n)=>{const s=t.equipment[e];if(s){n.equipmentInventory.push(s),t.equipment[e]=null;const r=It(t);t.baseAttributes.hp=r.maxHp,t.baseAttributes.mp=r.maxMp}})})(e.key),className:"absolute -top-1.5 -right-1.5 bg-gradient-to-br from-cinnabar-600 to-cinnabar-700 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:from-cinnabar-500 hover:to-cinnabar-600 transition-all z-10 border border-ink-900 hover:scale-110",title:"\u5378\u4e0b",children:"\xd7"})]},e.key))})]}),o.jsxs("div",{className:"bg-gradient-to-br from-ink-900/60 to-ink-800/60 p-4 rounded-lg border border-gold-600/30",children:[o.jsxs("h4",{className:"font-semibold text-gold-400 mb-3 text-lg flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udcdc"}),o.jsx("span",{children:"\u529f\u6cd5\u795e\u901a"})]}),o.jsx("div",{className:"space-y-3",children:d.skills.map((e,t)=>o.jsx("div",{className:"relative w-full text-left bg-ink-800/60 p-3 rounded-lg border-2 transition-all duration-300 "+(e?`${M(e?.rarity)} cursor-pointer hover:bg-ink-700/70 hover:shadow-lg`:"border-dashed border-ink-600 hover:border-gold-500/50"),onClick:()=>{e?c(e):t>1&&l({type:"skill",slotIndex:t})},children:e?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex justify-between items-baseline",children:[o.jsxs("h5",{className:"font-bold text-paper-100 flex items-baseline gap-2",children:[o.jsx("span",{className:`${L(e.rarity)}`,children:e.name}),o.jsxs("span",{className:`text-xs font-medium ${L(e.rarity)}`,children:["\u3014",e.rarity,"\u3015"]})]}),o.jsxs("span",{className:"text-sm font-mono text-blue-400 flex items-center gap-1",children:[o.jsx("span",{children:"\ud83d\udca0"}),e.cost]})]}),o.jsx("p",{className:"text-sm font-semibold text-gold-300 mt-1",children:e.mechanicsDescription}),o.jsx("p",{className:"text-xs text-paper-400 mt-1 italic",children:e.description}),o.jsx("p",{className:"absolute bottom-1 right-2 text-[10px] text-paper-500 mt-1",children:t<2?"\ud83d\udd12 \u89d2\u8272\u4e13\u5c5e":"\ud83d\udcda \u901a\u7528\u6280\u80fd"}),t>1&&o.jsx("button",{onClick:e=>{var n;e.stopPropagation(),n=t,m(e=>{e.skills[n]=null})},className:"absolute -top-1.5 -right-1.5 bg-gradient-to-br from-cinnabar-600 to-cinnabar-700 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:from-cinnabar-500 hover:to-cinnabar-600 transition-all z-10 border border-ink-900 hover:scale-110",title:"\u9057\u5fd8",children:"\xd7"})]}):o.jsxs("p",{className:"text-center text-paper-500 py-2 flex items-center justify-center gap-2",children:[o.jsx("span",{className:"opacity-50",children:"+"}),o.jsx("span",{children:"\u901a\u7528\u6280\u80fd\u69fd"})]})},t))})]})]})]}),o.jsx("div",{className:"p-4 border-t border-gold-600/30 bg-gradient-to-r from-ink-900/50 via-ink-800/50 to-ink-900/50",children:o.jsxs("div",{className:"bg-gradient-to-br from-ink-900/60 to-ink-800/60 p-4 rounded-lg border border-gold-600/30",children:[o.jsxs("h4",{className:"font-semibold text-gold-400 mb-3 text-lg flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udc3e"}),o.jsx("span",{children:"\u7075\u517d\u5951\u7ea6"})]}),o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>{d.pet?r(d.pet):l({type:"pet"})},className:`bg-ink-800/60 p-3 rounded-lg w-full text-left hover:bg-ink-700/70 transition-all duration-300 h-full border-2 hover:shadow-lg ${M(d.pet?.rarity)}`,children:[o.jsxs("p",{className:"text-sm text-paper-400 flex items-center gap-1",children:[o.jsx("span",{className:"opacity-70",children:"\ud83e\udd8a"}),"\u51fa\u6218\u7075\u517d"]}),o.jsx("p",{className:`font-bold truncate ${L(d.pet?.rarity)||"text-paper-500 italic"}`,children:d.pet?.name||"\u672a\u643a\u5e26"})]}),d.pet&&o.jsx("button",{onClick:e=>{e.stopPropagation(),m((e,t)=>{const n=e.pet;n&&(t.petCollection.push(n),e.pet=null)})},className:"absolute -top-1.5 -right-1.5 bg-gradient-to-br from-cinnabar-600 to-cinnabar-700 text-white w-5 h-5 rounded-full text-xs font-bold flex items-center justify-center hover:from-cinnabar-500 hover:to-cinnabar-600 transition-all z-10 border border-ink-900 hover:scale-110",title:"\u5378\u4e0b",children:"\xd7"})]})]})}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"})]})]}),a&&o.jsx(Ut,{playerProfile:n,selectionState:a,card:d,onClose:()=>l(null),onEquip:(e,t)=>{m((n,s)=>{const r=n.equipment[e],a=s.equipmentInventory.findIndex(e=>e.id===t.id);a>-1&&s.equipmentInventory.splice(a,1),r&&s.equipmentInventory.push(r),n.equipment[e]=t;const l=It(n);n.baseAttributes.hp=l.maxHp,n.baseAttributes.mp=l.maxMp}),l(null)},onLearnSkill:(e,t)=>{m(n=>{n.skills[e]=t}),l(null)},onEquipPet:e=>{m((t,n)=>{const s=t.pet,r=n.petCollection.findIndex(t=>t.id===e.id);r>-1&&n.petCollection.splice(r,1),s&&n.petCollection.push(s),t.pet=e}),l(null)}},a.type+("equipment"===a.type?a.slot:"skill"===a.type?a.slotIndex:"pet")),i&&o.jsx(Vt,{skill:i,onClose:()=>c(null)})]})},Kt=({log:e,onClose:t})=>o.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"bg-slate-800 w-full max-w-2xl h-4/5 rounded-xl shadow-2xl border border-slate-700 overflow-hidden backdrop-blur-lg bg-slate-800/80 flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700 flex-shrink-0",children:[o.jsx("h2",{className:"text-xl font-bold text-white font-serif",children:"\u6218\u6597\u8bb0\u5f55"}),o.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),o.jsx("div",{className:"p-6 overflow-y-auto flex-grow",children:o.jsx("div",{className:"prose prose-invert max-w-none prose-p:text-gray-300 prose-p:my-2 font-serif",children:e.map((e,t)=>o.jsx("p",{className:""+(e.startsWith(">")?"text-sky-400":""),children:e},t))})})]})}),Yt=({endTime:e})=>{const[t,n]=x.useState(e-Date.now());if(x.useEffect(()=>{if(t<=0)return;const s=setInterval(()=>{const t=e-Date.now();t<=0&&clearInterval(s),n(t)},1e3);return()=>clearInterval(s)},[e,t]),t<=0)return o.jsx("span",{className:"text-green-400 font-bold",children:"\u57f9\u80b2\u5b8c\u6210"});const s=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4),a=Math.floor(t%6e4/1e3);return o.jsxs("span",{className:"font-mono text-lg tracking-wider",children:[String(s).padStart(2,"0"),":",String(r).padStart(2,"0"),":",String(a).padStart(2,"0")]})},Xt=({slot:e,playerProfile:t,onStartCultivation:n,onClaimCultivation:s,onGetLiveMonitoring:r,busyCharacterIds:a,onOpenSelector:l})=>{const[i,c]=x.useState(null),[d,u]=x.useState(null),[m,p]=x.useState("live"),[h,f]=x.useState("\u5f85\u673a\u4e2d..."),[g,b]=x.useState(!1);x.useEffect(()=>{e.slotId,e.status,e.endTime,Date.now(),e.endTime,Date.now()},[e.status,e.endTime,e.slotId]);const y=()=>{i&&d&&n(e.slotId,i.id,d.id)},v=e=>{const n="A"===e?i:d;return o.jsx("button",{onClick:()=>{if("A"===e){const e=[...t.cardCollection,...t.petCollection].filter(e=>!a.has(e.id));l("\u9009\u62e9\u4eb2\u672c A",e,e=>{c(e),u(null)})}else{if(!i)return;let e=[];e="skill"in i?t.cardCollection.filter(e=>e.gender!==i.gender&&!a.has(e.id)):t.petCollection.filter(e=>e.gender!==i.gender&&!a.has(e.id)),l("\u9009\u62e9\u4eb2\u672c B",e,e=>{u(e)})}},disabled:"B"===e&&!i,className:"w-full md:w-48 h-40 md:h-64 bg-black/30 rounded-lg flex flex-col items-center justify-center ornate-border border-dashed border-stone-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:border-amber-500/50",children:n?o.jsxs("div",{className:`w-full h-full rounded-lg p-3 flex flex-col items-center justify-center text-center ${M(n.rarity)}`,children:[o.jsx("p",{className:"font-bold text-base md:text-lg truncate w-full px-2",children:n.name}),o.jsx("p",{className:`text-xs md:text-sm mt-1 ${L(n.rarity)}`,children:n.rarity})]}):o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("span",{className:"text-stone-500 text-3xl md:text-4xl mb-2",children:"+"}),o.jsxs("span",{className:"text-stone-500 text-xs",children:["\u9009\u62e9","A"===e?"\u4eb2\u672cA":"\u4eb2\u672cB"]})]})})};return"Empty"===e.status?o.jsxs("div",{className:"flex flex-col items-center w-full px-2 md:px-4",children:[o.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-8 items-center w-full max-w-2xl",children:[v("A"),o.jsx("div",{className:"text-3xl md:text-4xl font-bold text-gradient-gold",children:"\ud83e\uddec"}),v("B")]}),o.jsx("button",{onClick:y,disabled:!i||!d,className:"mt-6 px-8 py-3 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold rounded-full shadow-glow-green disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 hover:scale-105 text-base md:text-lg",children:"\u5f00\u59cb\u57f9\u80b2"})]}):o.jsxs("div",{className:"flex flex-col items-center gap-3 md:gap-4 w-full px-2 md:px-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[o.jsxs("div",{className:"w-full max-w-lg bg-gradient-to-br from-stone-800/80 to-stone-900/80 rounded-xl p-4 border border-stone-700/50",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-lg md:text-xl font-bold text-amber-400",children:"\u57f9\u80b2\u72b6\u6001"}),o.jsx("div",{className:"px-3 py-1 rounded-full text-sm font-bold "+("Breeding"===e.status?"bg-cyan-500/20 text-cyan-300":"bg-green-500/20 text-green-300"),children:"Breeding"===e.status?"\u8fdb\u884c\u4e2d":"\u5df2\u5b8c\u6210"})]}),o.jsx("div",{className:"text-center py-4 bg-black/30 rounded-lg",children:"Breeding"===e.status?o.jsxs("div",{children:[o.jsx("p",{className:"text-stone-400 text-sm mb-2",children:"\u80fd\u91cf\u878d\u5408\u4e2d..."}),o.jsx("div",{className:"text-2xl md:text-3xl font-mono text-cyan-300",children:o.jsx(Yt,{endTime:e.endTime})})]}):o.jsxs("div",{className:"animate-pulse",children:[o.jsx("div",{className:"text-4xl mb-2",children:"\u2728"}),o.jsx("p",{className:"text-green-400 font-bold text-xl md:text-2xl",children:"\u57f9\u80b2\u5b8c\u6210\uff01"}),o.jsx("p",{className:"text-stone-400 text-sm mt-2",children:"\u7075\u80ce\u5df2\u6210\u719f\uff0c\u8bf7\u5f00\u542f\u67e5\u770b"})]})})]}),o.jsxs("div",{className:"w-full max-w-lg",children:[o.jsx("h4",{className:"text-sm text-stone-400 mb-2 text-center",children:"\u878d\u5408\u4eb2\u672c"}),o.jsxs("div",{className:"flex gap-3 md:gap-4 justify-center",children:[o.jsxs("div",{className:`flex-1 max-w-[45%] bg-black/50 rounded-lg p-3 flex flex-col items-center justify-center text-center ornate-border ${M(e.parentA.rarity)}`,children:[o.jsx("p",{className:"font-bold text-sm md:text-base truncate w-full",children:e.parentA.name}),o.jsx("p",{className:`text-xs ${L(e.parentA.rarity)}`,children:e.parentA.rarity})]}),o.jsx("div",{className:"flex items-center justify-center text-amber-400",children:o.jsx("span",{className:"text-xl",children:"\u2715"})}),o.jsxs("div",{className:`flex-1 max-w-[45%] bg-black/50 rounded-lg p-3 flex flex-col items-center justify-center text-center ornate-border ${M(e.parentB.rarity)}`,children:[o.jsx("p",{className:"font-bold text-sm md:text-base truncate w-full",children:e.parentB.name}),o.jsx("p",{className:`text-xs ${L(e.parentB.rarity)}`,children:e.parentB.rarity})]})]})]}),o.jsxs("div",{className:"w-full max-w-lg bg-black/50 rounded-lg ornate-border border-stone-700 flex flex-col",children:[o.jsxs("div",{className:"flex-shrink-0 flex border-b border-stone-700",children:[o.jsxs("button",{onClick:()=>p("live"),className:"flex-1 py-2 px-2 text-xs md:text-sm font-semibold transition-colors flex items-center justify-center gap-1 "+("live"===m?"bg-stone-700 text-amber-400":"text-stone-400 hover:bg-stone-800"),children:[o.jsx("span",{children:"\ud83d\udce1"}),o.jsx("span",{children:"\u5b9e\u65f6\u76d1\u89c6"})]}),o.jsxs("button",{onClick:()=>p("log"),className:"flex-1 py-2 px-2 text-xs md:text-sm font-semibold transition-colors flex items-center justify-center gap-1 "+("log"===m?"bg-stone-700 text-amber-400":"text-stone-400 hover:bg-stone-800"),children:[o.jsx("span",{children:"\ud83d\udccb"}),o.jsx("span",{children:"\u76d1\u89c6\u65e5\u5fd7"})]})]}),o.jsx("div",{className:"p-3 h-32 md:h-40 overflow-y-auto scrollbar-xianxia text-xs md:text-sm text-gray-300",children:"live"===m?o.jsx("div",{className:"whitespace-pre-wrap",children:g?"\u6b63\u5728\u8fde\u63a5\u4fe1\u53f7...":h}):o.jsx("div",{className:"space-y-1",children:e.monitoringLog.length>0?e.monitoringLog.map((e,t)=>o.jsxs("p",{className:"text-gray-300",children:[o.jsxs("span",{className:"text-amber-400",children:["[",e.timestamp,"]"]})," ",e.message]},`${e.timestamp}-${t}`)):o.jsx("p",{className:"text-stone-500 text-center",children:"\u6682\u65e0\u65e5\u5fd7\u8bb0\u5f55"})})}),"live"===m&&"Breeding"===e.status&&o.jsx("button",{onClick:async()=>{b(!0);try{const t=await r(e.slotId);f(t)}catch(t){f("\u76d1\u89c6\u4fe1\u53f7\u4e2d\u65ad...")}finally{b(!1)}},className:"flex-shrink-0 w-full py-2 bg-cyan-600/20 hover:bg-cyan-600/40 text-cyan-300 text-xs transition-colors",children:"\ud83d\udd04 \u5237\u65b0\u76d1\u89c6\u4fe1\u53f7"})]}),"Ready"===e.status&&o.jsx("button",{onClick:()=>s(e.slotId),className:"w-full max-w-lg mt-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-yellow-400 text-black font-bold text-lg rounded-xl shadow-glow-gold animate-pulse-slow transition-all duration-300 hover:scale-105 hover:shadow-2xl",children:"\u2728 \u5f00\u542f\u7075\u80ce \u2728"})]})},Zt=({isOpen:e,onClose:t,playerProfile:n,cultivationSlots:s,onStartCultivation:r,onClaimCultivation:a,onGetLiveMonitoring:l,busyCharacterIds:i,onOpenSelector:c})=>{const[d,u]=x.useState(1);if(!e)return null;const m=s.find(e=>e.slotId===d);return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"w-full max-w-4xl h-[90vh] ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-900 via-stone-950 to-black rounded-2xl shadow-2xl flex flex-col overflow-hidden",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/30 border-b border-xianxia-gold-700/50",children:[o.jsx("h2",{className:"text-3xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u80b2\u7075\u8f69"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex flex-grow",children:[o.jsxs("div",{className:"w-1/4 border-r border-stone-700/50 p-4 flex flex-col gap-3",children:[o.jsx("h3",{className:"text-lg font-semibold text-amber-400 mb-2",children:"\u57f9\u80b2\u4ed3"}),s.map(e=>o.jsxs("button",{onClick:()=>u(e.slotId),className:"w-full p-3 rounded-lg text-left transition-all duration-200 border-2 "+(d===e.slotId?"bg-stone-700/80 border-amber-500":"bg-stone-800/50 border-transparent hover:bg-stone-700/50"),children:[o.jsxs("p",{className:"font-bold",children:["\u57f9\u80b2\u4ed3 #",e.slotId]}),o.jsxs("p",{className:"text-sm "+("Empty"===e.status?"text-gray-400":"Breeding"===e.status?"text-cyan-400":"text-green-400"),children:["\u72b6\u6001: ",e.status]})]},e.slotId))]}),o.jsx("div",{className:"w-3/4 p-6 flex items-center justify-center",children:m?o.jsx(Xt,{slot:m,playerProfile:n,onStartCultivation:r,onClaimCultivation:a,onGetLiveMonitoring:l,busyCharacterIds:i,onOpenSelector:c}):o.jsx("p",{children:"\u9009\u62e9\u4e00\u4e2a\u57f9\u80b2\u4ed3\u4ee5\u5f00\u59cb\u3002"})})]})]})})},en=({isOpen:e,onClose:t,gameState:n,onUpdateGameState:s})=>{const[r,a]=x.useState("overview");if(!e)return null;const l=n.gauntletSystem,i=l.currentEvent,c=i?.status||"idle";return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-4xl h-auto max-h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-3xl",children:"\ud83c\udfdf\ufe0f"}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u5927\u95ef\u5173"}),o.jsx("p",{className:"text-sm text-gray-400",children:"\u4fee\u4ed9\u754c\u6700\u76db\u5927\u7684\u7efc\u827a\u8d5b\u4e8b"})]})]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsx("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700 bg-black/10",children:[{key:"overview",label:"\u603b\u89c8",icon:"\ud83d\udcca"},{key:"registration",label:"\u62a5\u540d",icon:"\ud83d\udcdd"},{key:"live",label:"\u76f4\u64ad\u95f4",icon:"\ud83d\udcfa"},{key:"announcements",label:"\u516c\u544a",icon:"\ud83d\udce2"}].map(e=>o.jsxs("button",{onClick:()=>a(e.key),className:"px-4 py-3 text-sm font-semibold rounded-t-lg transition-colors duration-200 flex items-center gap-2 "+(r===e.key?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:[o.jsx("span",{children:e.icon}),o.jsx("span",{children:e.label})]},e.key))}),o.jsxs("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-6",children:["overview"===r&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-stone-700/50",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83c\udfaf"}),o.jsx("span",{children:"\u8d5b\u4e8b\u72b6\u6001"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg",children:[o.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"\u5f53\u524d\u72b6\u6001"}),o.jsx("p",{className:`text-xl font-bold ${d=c,{idle:"text-gray-400",countdown:"text-blue-400",registration:"text-green-400",preparing:"text-purple-400",in_progress:"text-red-400",completed:"text-amber-400"}[d]||"text-white"}`,children:(e=>({idle:"\ud83c\udf19 \u4f11\u8d5b\u671f",countdown:"\u23f0 \u5012\u8ba1\u65f6",registration:"\ud83d\udcdd \u62a5\u540d\u4e2d",preparing:"\u2699\ufe0f \u51c6\u5907\u4e2d",in_progress:"\ud83d\udd25 \u8fdb\u884c\u4e2d",completed:"\ud83c\udfc6 \u5df2\u7ed3\u675f"}[e]||"\u672a\u77e5\u72b6\u6001"))(c)})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg",children:[o.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"\u4e0b\u6b21\u8d5b\u4e8b"}),o.jsx("p",{className:"text-xl font-bold text-white",children:l.nextEventDate?new Date(l.nextEventDate).toLocaleDateString("zh-CN"):"\u5f85\u5b9a"})]})]})]}),i?o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-amber-500/30",children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-400 mb-4 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83c\udfc6"}),o.jsx("span",{children:i.name})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.contestants.length}),o.jsx("p",{className:"text-sm text-gray-400",children:"\u53c2\u8d5b\u8005"})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.currentRound}),o.jsx("p",{className:"text-sm text-gray-400",children:"\u5f53\u524d\u8f6e\u6b21"})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:i.judges.length}),o.jsx("p",{className:"text-sm text-gray-400",children:"\u8bc4\u59d4"})]})]})]}):o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-stone-700/50 text-center",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83c\udf19"}),o.jsx("p",{className:"text-gray-400",children:"\u5f53\u524d\u6ca1\u6709\u8fdb\u884c\u4e2d\u7684\u8d5b\u4e8b"}),o.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"\u8bf7\u7b49\u5f85\u4e0b\u4e00\u5c4a\u5927\u95ef\u5173\u5f00\u542f"})]}),o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-stone-700/50",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx("span",{children:"\u26a1"}),o.jsx("span",{children:"\u5feb\u6377\u64cd\u4f5c"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("button",{className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:"idle"!==c,onClick:()=>{alert("\u521b\u5efa\u65b0\u8d5b\u4e8b\u529f\u80fd\u5f00\u53d1\u4e2d...")},children:[o.jsx("span",{children:"\ud83c\udfac"}),o.jsx("span",{children:"\u521b\u5efa\u65b0\u8d5b\u4e8b"})]}),o.jsxs("button",{className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:"registration"!==c,onClick:()=>a("registration"),children:[o.jsx("span",{children:"\ud83d\udcdd"}),o.jsx("span",{children:"\u7acb\u5373\u62a5\u540d"})]}),o.jsxs("button",{className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:"in_progress"!==c,onClick:()=>a("live"),children:[o.jsx("span",{children:"\ud83d\udcfa"}),o.jsx("span",{children:"\u8fdb\u5165\u76f4\u64ad\u95f4"})]}),o.jsxs("button",{className:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-500 hover:to-purple-600 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2",onClick:()=>a("announcements"),children:[o.jsx("span",{children:"\ud83d\udce2"}),o.jsx("span",{children:"\u67e5\u770b\u516c\u544a"})]})]})]}),o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-stone-700/50",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udcdc"}),o.jsx("span",{children:"\u5386\u53f2\u8d5b\u4e8b"})]}),l.eventHistory.length>0?o.jsx("div",{className:"space-y-2",children:l.eventHistory.slice(0,5).map(e=>o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-white font-semibold",children:e.name}),o.jsxs("p",{className:"text-sm text-gray-400",children:["\u51a0\u519b: ",e.championName||"\u672a\u77e5"]})]}),o.jsx("span",{className:"text-amber-400",children:"\ud83c\udfc6"})]},e.id))}):o.jsx("p",{className:"text-gray-500 text-center py-4",children:"\u6682\u65e0\u5386\u53f2\u8d5b\u4e8b\u8bb0\u5f55"})]}),o.jsxs("div",{className:"glass-morphism p-6 rounded-lg border border-stone-700/50",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udcc8"}),o.jsx("span",{children:"\u6211\u7684\u6218\u7ee9"})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:l.playerStats.participations}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u53c2\u8d5b\u6b21\u6570"})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-amber-400",children:l.playerStats.wins}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u593a\u51a0\u6b21\u6570"})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:l.playerStats.bestRank>0?`\u7b2c${l.playerStats.bestRank}`:"-"}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u6700\u4f73\u540d\u6b21"})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("p",{className:"text-2xl font-bold text-white",children:l.playerStats.averageRank>0?l.playerStats.averageRank.toFixed(1):"-"}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u5e73\u5747\u540d\u6b21"})]})]})]})]}),"registration"===r&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83d\udcdd"}),o.jsx("p",{className:"text-xl text-gray-400",children:"\u62a5\u540d\u754c\u9762"}),o.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"\u529f\u80fd\u5f00\u53d1\u4e2d..."}),"registration"===c?o.jsxs("div",{className:"mt-6",children:[o.jsx("p",{className:"text-green-400 mb-4",children:"\u62a5\u540d\u901a\u9053\u5df2\u5f00\u542f\uff01"}),o.jsx("button",{className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white px-6 py-3 rounded-lg font-semibold",children:"\u9009\u62e9\u89d2\u8272\u62a5\u540d"})]}):o.jsx("p",{className:"text-yellow-400 mt-4",children:"\u5f53\u524d\u4e0d\u5728\u62a5\u540d\u9636\u6bb5"})]}),"live"===r&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83d\udcfa"}),o.jsx("p",{className:"text-xl text-gray-400",children:"\u76f4\u64ad\u95f4\u754c\u9762"}),o.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"\u529f\u80fd\u5f00\u53d1\u4e2d..."}),"in_progress"===c?o.jsxs("div",{className:"mt-6",children:[o.jsx("p",{className:"text-red-400 mb-4 animate-pulse",children:"\ud83d\udd34 \u76f4\u64ad\u4e2d"}),o.jsx("button",{className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white px-6 py-3 rounded-lg font-semibold",children:"\u8fdb\u5165\u76f4\u64ad\u95f4"})]}):o.jsx("p",{className:"text-yellow-400 mt-4",children:"\u5f53\u524d\u6ca1\u6709\u8fdb\u884c\u4e2d\u7684\u76f4\u64ad"})]}),"announcements"===r&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"text-center py-8",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83d\udce2"}),o.jsx("p",{className:"text-xl text-gray-400",children:"\u516c\u544a\u680f"})]}),i&&i.rounds.length>0&&o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"text-lg font-bold text-amber-400 mb-3",children:"\ud83c\udfaf \u5173\u5361\u9884\u544a"}),o.jsx("div",{className:"space-y-2",children:i.rounds.map((e,t)=>o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("span",{className:"text-white font-semibold",children:["\u7b2c",e.roundNumber,"\u8f6e: ",e.challenge?.name||"\u5f85\u516c\u5e03"]}),o.jsx("span",{className:"text-sm "+("completed"===e.status?"text-green-400":"in_progress"===e.status?"text-red-400":"text-gray-400"),children:"completed"===e.status?"\u5df2\u5b8c\u6210":"in_progress"===e.status?"\u8fdb\u884c\u4e2d":"\u5f85\u5f00\u59cb"})]}),e.challenge?.type&&o.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["\u7c7b\u578b: ",e.challenge.type," | \u96be\u5ea6: ",e.challenge.difficulty,"/10"]})]},t))})]}),!i&&o.jsx("p",{className:"text-gray-500 text-center",children:"\u6682\u65e0\u516c\u544a"})]})]}),o.jsx("div",{className:"flex-shrink-0 p-4 bg-black/20 border-t border-stone-700/50",children:o.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[o.jsx("span",{children:"\ud83d\udca1 \u5927\u95ef\u5173\u662f\u4fee\u4ed9\u754c\u6700\u76db\u5927\u7684\u7efc\u827a\u8d5b\u4e8b\uff0c64\u4f4d\u4f73\u4e3d\u540c\u53f0\u7ade\u6280"}),o.jsx("span",{children:"\u7248\u672c v1.0"})]})})]})});var d},tn=({isOpen:e,onClose:t,patients:n,onStartConsultation:s,onRefresh:r,onAddPatient:a,isLoading:l,onViewRecord:i,consultationPatient:c,consultationStory:d,consultationChoices:u,onConsultationAction:m,onEndConsultation:p,onReturnToList:h})=>{const[f,g]=x.useState("Female"),[b,y]=x.useState("\u5f85\u8bca"),[v,j]=x.useState("");if(!e)return null;if(c)return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-6xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["\u8bca\u7597\u5ba4 - \u95ee\u8bca\u4e2d: ",c.medicalRecord.name]}),o.jsx("p",{className:"text-sm text-red-400",children:c.medicalRecord.illnessDescription})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:h,className:"bg-blue-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-blue-500/80 transition-colors",children:"\u8fd4\u56de\u533b\u9986"}),o.jsx("button",{onClick:p,className:"bg-red-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-red-500/80 transition-colors",children:"\u7ed3\u675f\u95ee\u8bca"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),o.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[o.jsxs("div",{className:"w-1/4 bg-black/10 p-4 border-r border-stone-700 flex flex-col items-center overflow-y-auto",children:[o.jsx("div",{className:"w-32 h-32 rounded-full bg-stone-700 mb-4 flex items-center justify-center",children:o.jsx("i",{className:"fa-solid fa-user-injured text-6xl text-gray-500"})}),o.jsx("h3",{className:"text-xl text-white font-bold",children:c.medicalRecord.name}),o.jsxs("p",{className:"text-gray-400",children:[c.medicalRecord.age,"\u5c81, ","Male"===c.medicalRecord.gender?"\u7537":"\u5973"]}),o.jsx("button",{onClick:()=>i(c.medicalRecord),className:"mt-6 bg-cyan-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-cyan-500/80 transition-colors w-full",children:"\u67e5\u770b\u75c5\u5355"})]}),o.jsxs("div",{className:"w-3/4 flex flex-col",children:[o.jsx("div",{className:"flex-grow overflow-y-auto p-4 bg-black/5",children:o.jsx("div",{className:"prose prose-invert max-w-none",children:d.split("\n\n").map((e,t)=>o.jsx("p",{className:"text-gray-200 leading-relaxed mb-4",children:e},t))})}),o.jsxs("div",{className:"flex-shrink-0 p-4 bg-black/30 border-t border-stone-700",children:[o.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:(u&&Array.isArray(u)?u:[]).map((e,t)=>o.jsx("button",{onClick:()=>m(e),disabled:l,className:"flex-grow basis-40 text-center bg-stone-800/80 px-3 py-2 rounded-md hover:bg-stone-700/80 disabled:opacity-50 transition-colors text-white",children:e},t))}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:v,onChange:e=>j(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!l&&v.trim()&&(m(v),j(""))},placeholder:"\u8f93\u5165\u4f60\u7684\u95ee\u8bca\u884c\u52a8...",disabled:l,className:"flex-grow px-4 py-2 bg-stone-800/80 border border-stone-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:border-amber-500 disabled:opacity-50"}),o.jsx("button",{onClick:()=>{v.trim()&&(m(v),j(""))},disabled:l||!v.trim(),className:"px-6 py-2 bg-amber-600/80 text-white font-bold rounded-md hover:bg-amber-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?"\u751f\u6210\u4e2d...":"\u95ee\u8bca"})]})]})]})]})]})});const N=n.filter(e=>{const t=e.medicalRecord.gender===f,n="\u5168\u90e8"===b||e.status===b;return t&&n});return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u6027\u75c5\u533b\u9986"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 p-4 flex items-center justify-between border-b border-stone-700 bg-black/10",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>g("Female"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("Female"===f?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u5973\u6027\u75c5\u60a3"}),o.jsx("button",{onClick:()=>g("Male"),className:"px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 "+("Male"===f?"bg-amber-500/20 text-amber-300":"bg-stone-700/50 text-gray-300 hover:bg-stone-600/50"),children:"\u7537\u6027\u75c5\u60a3"})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>y("\u5f85\u8bca"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors "+("\u5f85\u8bca"===b?"bg-green-500/20 text-green-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"),children:"\u5f85\u8bca"}),o.jsx("button",{onClick:()=>y("\u6cbb\u7597\u4e2d"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors "+("\u6cbb\u7597\u4e2d"===b?"bg-yellow-500/20 text-yellow-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"),children:"\u6cbb\u7597\u4e2d"}),o.jsx("button",{onClick:()=>y("\u5df2\u6cbb\u6108"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors "+("\u5df2\u6cbb\u6108"===b?"bg-blue-500/20 text-blue-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"),children:"\u5df2\u6cbb\u6108"}),o.jsx("button",{onClick:()=>y("\u5168\u90e8"),className:"px-3 py-1 text-xs font-semibold rounded-md transition-colors "+("\u5168\u90e8"===b?"bg-purple-500/20 text-purple-300":"bg-stone-700/30 text-gray-400 hover:bg-stone-600/30"),children:"\u5168\u90e8"})]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>a("Female"),disabled:l,className:"px-3 py-1 text-xs bg-pink-500/20 text-pink-300 rounded-md hover:bg-pink-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"\u751f\u6210\u4e2d...":"\u6dfb\u52a0\u5973\u75c5\u60a3"}),o.jsx("button",{onClick:()=>a("Male"),disabled:l,className:"px-3 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-md hover:bg-blue-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"\u751f\u6210\u4e2d...":"\u6dfb\u52a0\u7537\u75c5\u60a3"}),o.jsxs("button",{onClick:r,disabled:l,className:"px-3 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded-md hover:bg-yellow-500/40 disabled:opacity-50 disabled:cursor-not-allowed",children:[o.jsx("i",{className:"fa-solid fa-sync "+(l?"animate-spin":"")})," \u5237\u65b0\u5217\u8868"]})]})]}),o.jsx("div",{className:"flex-grow p-6 overflow-y-auto",children:N.length>0?o.jsx("div",{className:"space-y-4",children:N.map(e=>{const t="\u5f85\u8bca"===e.status?"text-green-400":"\u6cbb\u7597\u4e2d"===e.status?"text-yellow-400":"text-blue-400",n="\u5f85\u8bca"===e.status?"bg-green-500/20":"\u6cbb\u7597\u4e2d"===e.status?"bg-yellow-500/20":"bg-blue-500/20";return o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50 flex justify-between items-center",children:[o.jsxs("div",{className:"flex-grow",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("h3",{className:"text-xl font-bold text-white font-serif",children:[e.medicalRecord.name," ",o.jsxs("span",{className:"text-base font-normal text-gray-400",children:["(",e.medicalRecord.age,"\u5c81)"]})]}),o.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n} ${t} font-semibold`,children:e.status})]}),o.jsxs("p",{className:"text-sm text-red-400 italic mt-1",children:["\u75c5\u75c7: ",e.medicalRecord.illnessDescription.substring(0,50),"..."]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:()=>i(e.medicalRecord),className:"bg-cyan-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-cyan-500/80 transition-colors",children:"\u67e5\u770b\u75c5\u5355"}),"\u5f85\u8bca"===e.status&&o.jsx("button",{onClick:()=>s(e.id),className:"bg-green-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-green-500/80 transition-colors",children:"\u5f00\u59cb\u95ee\u8bca"}),"\u6cbb\u7597\u4e2d"===e.status&&o.jsx("button",{onClick:()=>s(e.id),className:"bg-yellow-600/80 text-white font-bold px-4 py-2 rounded-md hover:bg-yellow-500/80 transition-colors",children:"\u7ee7\u7eed\u95ee\u8bca"})]})]},e.id)})}):o.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83c\udf3f"}),o.jsx("p",{children:"\u5f53\u524d\u7b5b\u9009\u6761\u4ef6\u4e0b\u65e0\u75c5\u4eba\u3002"})]})})]})})},nn=({isOpen:e,onClose:t,onInteract:n,storyContext:s})=>{const[r,a]=x.useState([]),[l,i]=x.useState(!0),[c,d]=x.useState(null);x.useEffect(()=>{if(e){(async()=>{i(!0),d(null);try{console.warn("scanForInteractables is not implemented yet.");a([])}catch(e){console.error("Failed to fetch interactables:",e),a([])}finally{i(!1)}})()}},[e,s]);const u=e=>{switch(e){case"NPC":return"\ud83d\udc64";case"Creature":return"\ud83d\udc3e";case"Object":return"\ud83d\udce6";default:return"\u2753"}},m=()=>{if(!c)return null;let e=[];"NPC"===c.type?(e.push({label:"\u4ea4\u8c08",verb:"\u4f60\u5c1d\u8bd5\u4e0e"}),e.push({label:"\u6311\u6218",verb:`\u4f60\u5411 ${c.name} \u4eae\u51fa\u9ec4\u724c\uff0c\u53d1\u8d77\u4e86\u6311\u6218\u3002`})):"Creature"===c.type?e.push({label:"\u653b\u51fb",verb:"\u4f60\u4eae\u51fa\u9ec4\u724c\uff0c\u51b3\u5b9a\u653b\u51fb"}):"Object"===c.type&&e.push({label:"\u8c03\u67e5",verb:"\u4f60\u5f00\u59cb\u8c03\u67e5"});const t=e=>{"\u6311\u6218"===e.label||"\u653b\u51fb"===e.label?n(e.verb):((e,t)=>{const s=`${t} ${e.name}`;n(s)})(c,e.verb)},s=[{label:"\u9760\u8fd1",verb:"\u4f60\u51b3\u5b9a\u8d70\u8fd1"},{label:"\u89c2\u5bdf",verb:"\u4f60\u4ed4\u7ec6\u89c2\u5bdf"},...e];return o.jsxs("div",{className:"bg-stone-800/70 p-4 rounded-lg animate-fade-in border border-stone-700/50",children:[o.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[o.jsx("span",{className:"text-3xl mt-1",children:u(c.type)}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold text-amber-400 text-lg",children:c.name}),o.jsx("p",{className:"text-sm text-gray-300",children:c.description})]})]}),o.jsx("div",{className:"grid grid-cols-2 gap-3",children:s.map(e=>o.jsx("button",{onClick:()=>t(e),className:"bg-stone-700/80 px-4 py-2 rounded-md hover:bg-stone-600 transition-colors duration-200 font-serif",children:e.label},e.label))})]})};return e?o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[70vh] min-h-[20rem] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg bg-stone-900/80 flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"\u63a2\u67e5\u56db\u5468"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsx("div",{className:"flex-grow overflow-hidden",children:l?o.jsx("div",{className:"text-center text-amber-300 animate-glow p-8",children:"\u63a2\u67e5\u7075\u6c14\u6ce2\u52a8\u4e2d..."}):0===r.length?o.jsx("div",{className:"text-center text-gray-500 p-8",children:"\u9644\u8fd1\u4f3c\u4e4e\u6ca1\u6709\u4efb\u4f55\u503c\u5f97\u6ce8\u610f\u7684\u4e1c\u897f\u3002"}):o.jsxs("div",{className:"flex flex-row gap-4 h-full",children:[o.jsxs("div",{className:"w-2/5 border-r border-stone-700 overflow-y-auto",children:[o.jsx("h3",{className:"text-sm font-semibold text-gray-400 p-3 sticky top-0 bg-stone-900/90 backdrop-blur-sm border-b border-stone-700/50",children:"\u9644\u8fd1\u5b9e\u4f53"}),r.map(e=>o.jsxs("button",{onClick:()=>d(e),className:"w-full text-left p-3 text-sm transition-colors duration-150 flex items-center gap-3 "+(c?.name===e.name?"bg-amber-600/30":"hover:bg-stone-800/60"),children:[o.jsx("span",{className:"text-xl",children:u(e.type)}),o.jsx("span",{className:"font-semibold text-white",children:e.name})]},e.name))]}),o.jsx("div",{className:"w-3/5 p-4 flex flex-col justify-center",children:c?m():o.jsx("div",{className:"text-center text-gray-500",children:o.jsx("p",{children:"\u4ece\u5de6\u4fa7\u5217\u8868\u9009\u62e9\u4e00\u4e2a\u76ee\u6807\u8fdb\u884c\u4e92\u52a8"})})})]})})]})}):null},sn=({isOpen:e,onClose:t,prisoner:n,availableTortureMethods:s,onExecuteTorture:r,onEndInterrogation:a,interrogationLog:l,isLoading:i})=>{const[c,d]=x.useState(null),[u,m]=x.useState(30),[p,h]=x.useState(!1);if(!e)return null;const f=s.filter(e=>"basic"===e.category),g=s.filter(e=>"advanced"===e.category),b=s.filter(e=>"special"===e.category),y=e=>e<10?"text-green-400":e<30?"text-yellow-400":e<60?"text-orange-400":"text-red-400",v=e=>e<10?"\u6781\u4f4e":e<30?"\u4f4e":e<60?"\u4e2d":e<80?"\u9ad8":"\u6781\u9ad8",j=e=>{const t=c?.id===e.id,s=!e.requirements||!e.requirements.skill||n.character.skills.some(t=>t.name===e.requirements.skill);return o.jsxs("div",{onClick:()=>s&&d(e),className:`\n          p-4 rounded-lg border-2 cursor-pointer transition-all\n          ${t?"border-red-500 bg-red-900/30 shadow-lg shadow-red-500/50":s?"border-stone-700 bg-black/30 hover:border-red-500/50 hover:bg-black/50":"border-stone-800 bg-black/10 opacity-50 cursor-not-allowed"}\n        `,children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsx("h4",{className:"text-lg font-bold "+(t?"text-red-400":"text-white"),children:e.name}),e.requirements?.cost&&o.jsxs("span",{className:"px-2 py-1 text-xs bg-amber-500/20 text-amber-300 rounded",children:[e.requirements.cost," \u7075\u77f3"]})]}),o.jsx("p",{className:"text-sm text-gray-400 mb-3",children:e.description}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u4f24\u5bb3:"}),o.jsx("span",{className:"ml-1 text-red-400 font-bold",children:e.damage})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5a01\u6151:"}),o.jsx("span",{className:"ml-1 text-orange-400 font-bold",children:e.intimidation})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u6210\u529f\u7387:"}),o.jsxs("span",{className:"ml-1 text-green-400 font-bold",children:[e.successRate,"%"]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5c48\u670d\u5ea6:"}),o.jsxs("span",{className:"ml-1 text-yellow-400 font-bold",children:["+",e.submissionIncrease]})]})]}),o.jsxs("div",{className:"border-t border-stone-700/50 pt-2 mt-2",children:[o.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"\u98ce\u9669\u8bc4\u4f30:"}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"\u6b7b\u4ea1:"}),o.jsx("span",{className:`ml-1 font-bold ${y(e.risks.death)}`,children:v(e.risks.death)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"\u91cd\u4f24:"}),o.jsx("span",{className:`ml-1 font-bold ${y(e.risks.permanentInjury)}`,children:v(e.risks.permanentInjury)})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-600",children:"\u75af\u72c2:"}),o.jsx("span",{className:`ml-1 font-bold ${y(e.risks.insanity)}`,children:v(e.risks.insanity)})]})]})]}),e.requirements&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-stone-700/50",children:[o.jsx("div",{className:"text-xs text-gray-500",children:"\u9700\u6c42:"}),e.requirements.skill&&o.jsxs("div",{className:"text-xs text-cyan-400",children:["\u6280\u80fd: ",e.requirements.skill]}),e.requirements.item&&o.jsxs("div",{className:"text-xs text-purple-400",children:["\u9053\u5177: ",e.requirements.item]})]})]},e.id)};return o.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/30 border-b border-red-900/50",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-red-400 font-serif flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-gavel"}),"\u5ba1\u8baf\u5ba4 - ",n.character.name]}),o.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[n.character.realm," | ",n.crime]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>h(!p),className:"px-4 py-2 bg-cyan-600/80 text-white font-bold rounded-md hover:bg-cyan-500/80 transition-colors",children:[o.jsx("i",{className:"fa-solid fa-history mr-2"}),p?"\u8fd4\u56de\u5ba1\u8baf":"\u5ba1\u8baf\u5386\u53f2"]}),o.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-600/80 text-white font-bold rounded-md hover:bg-gray-500/80 transition-colors",children:"\u7ed3\u675f\u5ba1\u8baf"}),o.jsx("button",{onClick:t,className:"text-red-400 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),o.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[o.jsxs("div",{className:"w-80 bg-black/20 border-r border-stone-700 p-4 overflow-y-auto flex-shrink-0",children:[o.jsxs("div",{className:"text-center mb-4",children:[o.jsx("div",{className:"w-32 h-32 mx-auto rounded-full bg-stone-700 mb-4 flex items-center justify-center border-4 border-red-900/50",children:o.jsx("i",{className:"fa-solid fa-user-secret text-6xl text-gray-500"})}),o.jsx("h3",{className:"text-xl font-bold text-white",children:n.character.name}),o.jsxs("p",{className:"text-gray-400",children:["Male"===n.character.gender?"\u2642 \u7537\u6027":"\u2640 \u5973\u6027"," | ",n.character.realm]})]}),o.jsxs("div",{className:"space-y-3 mb-4",children:[o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u5065\u5eb7\u72b6\u6001"}),o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"\u5065\u5eb7"}),o.jsxs("span",{className:"text-sm font-bold "+(n.health>70?"text-green-400":n.health>40?"text-yellow-400":"text-red-400"),children:[n.health,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 mb-2",children:o.jsx("div",{className:"h-2 rounded-full transition-all "+(n.health>70?"bg-green-500":n.health>40?"bg-yellow-500":"bg-red-500"),style:{width:`${n.health}%`}})}),o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"\u795e\u667a"}),o.jsxs("span",{className:"text-sm font-bold "+(n.sanity>70?"text-green-400":n.sanity>40?"text-yellow-400":"text-red-400"),children:[n.sanity,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 rounded-full transition-all "+(n.sanity>70?"bg-green-500":n.sanity>40?"bg-yellow-500":"bg-red-500"),style:{width:`${n.sanity}%`}})})]}),o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u610f\u5fd7\u72b6\u6001"}),o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"\u5c48\u670d\u5ea6"}),o.jsxs("span",{className:"text-sm font-bold text-yellow-400",children:[n.submissionLevel,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 mb-2",children:o.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all",style:{width:`${n.submissionLevel}%`}})}),o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs text-gray-500",children:"\u5f52\u987a\u5ea6"}),o.jsxs("span",{className:"text-sm font-bold text-green-400",children:[n.loyaltyLevel,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${n.loyaltyLevel}%`}})})]})]}),n.knownInformation.length>0&&o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u5df2\u83b7\u60c5\u62a5"}),o.jsx("div",{className:"space-y-1",children:n.knownInformation.map((e,t)=>o.jsxs("div",{className:"text-xs text-cyan-400 flex items-start gap-1",children:[o.jsx("i",{className:"fa-solid fa-check-circle mt-0.5"}),o.jsx("span",{children:e})]},t))})]})]}),o.jsx("div",{className:"flex-grow flex flex-col overflow-hidden",children:p?o.jsxs("div",{className:"p-6 overflow-y-auto",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"\u5ba1\u8baf\u5386\u53f2\u8bb0\u5f55"}),0===n.history.length?o.jsxs("div",{className:"text-center text-gray-500 py-8",children:[o.jsx("i",{className:"fa-solid fa-file-lines text-4xl mb-4 opacity-50"}),o.jsx("p",{children:"\u6682\u65e0\u5ba1\u8baf\u8bb0\u5f55"})]}):o.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:n.history.slice().reverse().map(e=>o.jsxs("div",{className:"bg-black/30 p-3 rounded-lg border border-stone-700",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-bold text-red-400",children:e.method.name}),o.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",e.duration,"\u5206\u949f)"]})]}),o.jsx("span",{className:"text-xs text-gray-500",children:e.date})]}),o.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["\u5ba1\u8baf\u8005: ",e.interrogator]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u7ed3\u679c:"}),o.jsx("span",{className:"ml-1 font-bold "+(e.result.success?"text-green-400":"text-red-400"),children:e.result.success?"\u6210\u529f":"\u5931\u8d25"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5c48\u670d\u5ea6:"}),o.jsxs("span",{className:"ml-1 text-yellow-400 font-bold",children:["+",e.result.submissionIncrease]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5065\u5eb7:"}),o.jsxs("span",{className:"ml-1 text-red-400 font-bold",children:["-",e.result.healthDecrease]})]})]}),e.result.informationGained&&o.jsxs("div",{className:"mt-2 pt-2 border-t border-stone-700/50",children:[o.jsx("div",{className:"text-xs text-cyan-400 mb-1",children:"\u83b7\u5f97\u60c5\u62a5:"}),o.jsx("div",{className:"text-sm text-gray-300",children:e.result.informationGained})]})]},e.id))})]}):o.jsxs(o.Fragment,{children:[l&&o.jsxs("div",{className:"bg-black/30 p-4 border-b border-stone-700 max-h-48 overflow-y-auto flex-shrink-0",children:[o.jsx("h3",{className:"text-sm font-bold text-gray-400 mb-2",children:"\u5ba1\u8baf\u8bb0\u5f55"}),o.jsx("div",{className:"prose prose-invert max-w-none",children:l.split("\n").map((e,t)=>o.jsx("p",{className:"text-gray-300 text-sm leading-relaxed mb-2",children:e},t))})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[f.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-circle text-green-500 text-xs"}),"\u57fa\u7840\u5211\u6cd5"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:f.map(j)})]}),g.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-circle text-orange-500 text-xs"}),"\u8fdb\u9636\u5211\u6cd5"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:g.map(j)})]}),b.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-circle text-purple-500 text-xs"}),"\u7279\u6b8a\u5211\u6cd5"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:b.map(j)})]})]}),c&&o.jsx("div",{className:"flex-shrink-0 p-4 bg-black/40 border-t border-red-900/50",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex-grow",children:[o.jsxs("div",{className:"text-white font-bold mb-2",children:["\u5df2\u9009\u62e9: ",o.jsx("span",{className:"text-red-400",children:c.name})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("label",{className:"text-gray-400 text-sm",children:"\u6301\u7eed\u65f6\u95f4(\u5206\u949f):"}),o.jsx("input",{type:"number",value:u,onChange:e=>m(Number(e.target.value)),min:"5",max:"180",step:"5",className:"w-24 px-3 py-1 bg-stone-800 border border-stone-600 rounded text-white text-sm"}),o.jsxs("span",{className:"text-gray-500 text-sm",children:["(",Math.floor(u/60),"\u5c0f\u65f6",u%60,"\u5206\u949f)"]})]})]}),o.jsx("button",{onClick:()=>r(n.character.id,c.id,u),disabled:i,className:"px-6 py-3 bg-red-600/80 text-white font-bold rounded-md hover:bg-red-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"\u6267\u884c\u4e2d..."]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-gavel mr-2"}),"\u6267\u884c\u5211\u7f5a"]})})]})})]})})]})]})})},rn=[{id:"kun_lun_xu",name:"\u6606\u4ed1\u589f",type:"Mountain",region:"\u4e2d\u5dde",realm:"\u5929\u754c",x:500,y:300,description:"\u4f20\u8bf4\u4e2d\u4ed9\u4eba\u5c45\u4f4f\u7684\u5723\u5c71\uff0c\u7075\u6c14\u6d53\u90c1\u81f3\u6781\uff0c\u76f4\u901a\u4e5d\u5929\u3002",isMajor:!0},{id:"tian_gong",name:"\u5929\u5bab",type:"Palace",region:"\u4e2d\u5dde",realm:"\u5929\u754c",x:600,y:400,description:"\u8bf8\u5929\u4ed9\u795e\u7684\u5c45\u6240\uff0c\u4e91\u96fe\u7f2d\u7ed5\uff0c\u4ed9\u4e50\u98d8\u98d8\u3002",isMajor:!0},{id:"yao_chi",name:"\u7476\u6c60",type:"River",region:"\u4e1c\u8352",realm:"\u5929\u754c",x:300,y:450,description:"\u4ed9\u6c60\u5723\u6c34\uff0c\u636e\u8bf4\u53ef\u6d17\u6da4\u51e1\u5c18\uff0c\u83b7\u5f97\u4ed9\u7f18\u3002",isMajor:!1},{id:"tai_xu_jing",name:"\u592a\u865a\u5883",type:"Plain",region:"\u897f\u5883",realm:"\u5929\u754c",x:750,y:350,description:"\u865a\u65e0\u7f25\u7f08\u4e4b\u5730\uff0c\u53ea\u6709\u5f97\u9053\u9ad8\u4eba\u624d\u80fd\u8fdb\u5165\u3002",isMajor:!1},{id:"qing_she_zong",name:"\u9752\u86c7\u5b97",type:"Sect",region:"\u4e1c\u8352",realm:"\u4eba\u754c",x:250,y:400,description:"\u4e00\u5207\u5f00\u59cb\u7684\u5730\u65b9\uff0c\u4e00\u4e2a\u4e2d\u7b49\u89c4\u6a21\u7684\u4fee\u4ed9\u5b97\u95e8\u3002",isMajor:!0},{id:"bai_hua_gu",name:"\u767e\u82b1\u8c37",type:"Sect",region:"\u4e1c\u8352",realm:"\u4eba\u754c",x:200,y:600,description:"\u4ee5\u533b\u672f\u548c\u4e39\u836f\u95fb\u540d\u7684\u5973\u6027\u5b97\u95e8\u3002",isMajor:!0},{id:"wan_yao_sen_lin",name:"\u4e07\u5996\u68ee\u6797",type:"Forest",region:"\u4e1c\u8352",realm:"\u4eba\u754c",x:350,y:700,description:"\u5996\u517d\u6a2a\u884c\uff0c\u4f46\u673a\u9047\u4e0e\u5371\u9669\u5e76\u5b58\u7684\u53e4\u8001\u68ee\u6797\u3002",isMajor:!1},{id:"yun_meng_ze",name:"\u4e91\u68a6\u5927\u6cfd",type:"River",region:"\u4e1c\u8352",realm:"\u4eba\u754c",x:150,y:300,description:"\u5e7f\u9614\u7684\u6cbc\u6cfd\u5730\uff0c\u636e\u8bf4\u6709\u4e0a\u53e4\u5f02\u517d\u51fa\u6ca1\u3002",isMajor:!1},{id:"tian_ji_ge",name:"\u5929\u673a\u9601",type:"City",region:"\u4e2d\u5dde",realm:"\u4eba\u754c",x:500,y:500,description:"\u4e2d\u5dde\u7687\u57ce\uff0c\u4e16\u754c\u7684\u4e2d\u5fc3\uff0c\u51e1\u4eba\u4e0e\u4fee\u58eb\u6df7\u5c45\u3002",isMajor:!0},{id:"tian_yuan_fang_shi",name:"\u5929\u5143\u574a\u5e02",type:"City",region:"\u4e2d\u5dde",realm:"\u4eba\u754c",x:600,y:650,description:"\u4e16\u754c\u4e0a\u6700\u5927\u7684\u4fee\u4ed9\u8005\u4ea4\u6613\u5e02\u573a\u3002",isMajor:!1},{id:"huang_gu_yi_ji",name:"\u8352\u53e4\u9057\u8ff9",type:"Mountain",region:"\u897f\u5883",realm:"\u4eba\u754c",x:800,y:400,description:"\u4e0a\u53e4\u4ed9\u9b54\u5927\u6218\u7684\u6218\u573a\uff0c\u6563\u843d\u7740\u65e0\u6570\u6cd5\u5b9d\u6b8b\u7247\u3002",isMajor:!1},{id:"wu_shen_zhai",name:"\u5deb\u795e\u5be8",type:"Sect",region:"\u5357\u7586",realm:"\u4eba\u754c",x:650,y:850,description:"\u5357\u7586\u6700\u5927\u7684\u5deb\u86ca\u90e8\u843d\uff0c\u795e\u79d8\u83ab\u6d4b\u3002",isMajor:!0},{id:"shi_wan_da_shan",name:"\u5341\u4e07\u5927\u5c71",type:"Mountain",region:"\u5357\u7586",realm:"\u4eba\u754c",x:750,y:950,description:"\u8fde\u7ef5\u4e0d\u7edd\u7684\u5c71\u8109\uff0c\u5145\u6ee1\u4e86\u6bd2\u866b\u731b\u517d\u548c\u5929\u6750\u5730\u5b9d\u3002",isMajor:!1},{id:"du_long_he",name:"\u6bd2\u9f99\u6cb3",type:"River",region:"\u5357\u7586",realm:"\u4eba\u754c",x:550,y:800,description:"\u6cb3\u6c34\u5448\u8be1\u5f02\u7684\u7d2b\u8272\uff0c\u636e\u8bf4\u6709\u5267\u6bd2\u3002",isMajor:!1},{id:"xuan_bing_gong",name:"\u7384\u51b0\u5bab",type:"Sect",region:"\u5317\u539f",realm:"\u4eba\u754c",x:250,y:950,description:"\u5efa\u7acb\u5728\u4e07\u5e74\u51b0\u5ddd\u4e4b\u4e0a\u7684\u5b97\u95e8\uff0c\u5f1f\u5b50\u7686\u4fee\u884c\u51b0\u7cfb\u529f\u6cd5\u3002",isMajor:!0},{id:"ji_bei_xue_yuan",name:"\u6781\u5317\u96ea\u539f",type:"Plain",region:"\u5317\u539f",realm:"\u4eba\u754c",x:150,y:1050,description:"\u4e00\u7247\u51b0\u5c01\u7684\u8352\u539f\uff0c\u4eba\u8ff9\u7f55\u81f3\u3002",isMajor:!1},{id:"zhen_yu_da_lao",name:"\u9547\u72f1\u5927\u7262",type:"Prison",region:"\u4e2d\u5dde",realm:"\u51a5\u754c",x:500,y:400,description:"\u4e2d\u5dde\u7687\u57ce\u5730\u4e0b\u7684\u5de8\u578b\u76d1\u72f1\uff0c\u5173\u62bc\u7740\u5404\u65b9\u7f6a\u72af\u548c\u91cd\u8981\u4fd8\u864f\u3002\u9634\u68ee\u6050\u6016\uff0c\u4f20\u95fb\u6709\u53bb\u65e0\u56de\u3002",isMajor:!0},{id:"tian_mo_cheng",name:"\u5929\u9b54\u57ce",type:"City",region:"\u897f\u5883",realm:"\u51a5\u754c",x:750,y:300,description:"\u9b54\u9053\u4fee\u58eb\u7684\u805a\u96c6\u5730\uff0c\u6df7\u4e71\u4f46\u81ea\u7531\uff0c\u4f4d\u4e8e\u5730\u4e0b\u6df1\u6e0a\u3002",isMajor:!0},{id:"wu_jian_dong",name:"\u65e0\u95f4\u6d1e\u5e9c",type:"Cave",region:"\u897f\u5883",realm:"\u51a5\u754c",x:650,y:500,description:"\u4e00\u4e2a\u6df1\u4e0d\u89c1\u5e95\u7684\u6d1e\u7a74\uff0c\u4f20\u95fb\u76f4\u901a\u5730\u72f1\u6700\u6df1\u5904\u3002",isMajor:!1},{id:"huang_quan_lu",name:"\u9ec4\u6cc9\u8def",type:"River",region:"\u4e2d\u5dde",realm:"\u51a5\u754c",x:400,y:600,description:"\u4ea1\u9b42\u5fc5\u7ecf\u4e4b\u8def\uff0c\u6cb3\u6c34\u6f06\u9ed1\u5982\u58a8\uff0c\u6563\u53d1\u7740\u6b7b\u4ea1\u6c14\u606f\u3002",isMajor:!1},{id:"wang_chuan_he",name:"\u5fd8\u5ddd\u6cb3",type:"River",region:"\u4e1c\u8352",realm:"\u51a5\u754c",x:250,y:700,description:"\u996e\u4e0b\u5fd8\u5ddd\u6c34\uff0c\u5fd8\u5374\u524d\u5c18\u5f80\u4e8b\u3002",isMajor:!1},{id:"sen_luo_dian",name:"\u68ee\u7f57\u6bbf",type:"Palace",region:"\u4e2d\u5dde",realm:"\u51a5\u754c",x:600,y:450,description:"\u5730\u5e9c\u960e\u7f57\u7684\u8bae\u4e8b\u5927\u6bbf\uff0c\u5ba1\u5224\u751f\u524d\u7f6a\u5b7d\u3002",isMajor:!0}],an=["\u5929\u754c","\u4eba\u754c","\u51a5\u754c"],ln=({currentLocationName:e,onLocationSelect:t,onClose:n,className:s=""})=>{const[r,a]=x.useState(""),[l,i]=x.useState(!1),[c,d]=x.useState(-1),u=x.useRef(null),m=x.useRef(null),p=x.useMemo(()=>{if(!r.trim())return rn;const e=r.toLowerCase();return rn.filter(t=>t.name.toLowerCase().includes(e)||t.region.toLowerCase().includes(e)||t.type.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))},[r]),h=x.useMemo(()=>{const e={};return p.forEach(t=>{e[t.region]||(e[t.region]=[]),e[t.region].push(t)}),e},[p]);x.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&i(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const f=e=>{t(e),i(!1),a(""),d(-1),m.current?.blur()},g=e=>({"\u4e1c\u8352":"text-green-400","\u897f\u5883":"text-yellow-400","\u5357\u7586":"text-red-400","\u5317\u539f":"text-blue-400","\u4e2d\u5dde":"text-purple-400"}[e]||"text-gray-400");return o.jsxs("div",{ref:u,className:`relative ${s}`,children:[o.jsxs("div",{className:"relative",children:[o.jsx("input",{ref:m,type:"text",value:r,onChange:e=>a(e.target.value),onFocus:()=>i(!0),onKeyDown:e=>{if(l)switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>e<p.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),d(e=>e>0?e-1:0);break;case"Enter":e.preventDefault(),c>=0&&c<p.length&&f(p[c]);break;case"Escape":i(!1),d(-1)}else"Enter"!==e.key&&"ArrowDown"!==e.key||(i(!0),d(0))},placeholder:"\u641c\u7d22\u5730\u70b9...",className:"w-full pl-10 pr-10 py-2.5 bg-gradient-to-r from-black/80 via-stone-900/70 to-black/80 backdrop-blur-md border-2 border-amber-500/40 rounded-lg text-amber-100 placeholder-amber-300/60 focus:outline-none focus:border-amber-500/70 focus:ring-2 focus:ring-amber-500/30 focus:shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-all"}),o.jsx("i",{className:"fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-amber-400/80 drop-shadow-[0_0_6px_rgba(251,191,36,0.5)]"}),r&&o.jsx("button",{onClick:()=>{a(""),m.current?.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-amber-400/70 hover:text-amber-300 transition-colors",children:o.jsx("i",{className:"fa-solid fa-times"})})]}),l&&o.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gradient-to-b from-black/95 via-stone-900/90 to-black/95 backdrop-blur-xl border-2 border-amber-500/40 rounded-lg shadow-2xl max-h-[400px] overflow-y-auto",style:{boxShadow:"0 10px 40px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(251, 191, 36, 0.2)",zIndex:9999},children:[0===p.length?o.jsxs("div",{className:"p-4 text-center text-amber-300/50",children:[o.jsx("i",{className:"fa-solid fa-search text-2xl mb-2"}),o.jsx("p",{children:"\u672a\u627e\u5230\u5339\u914d\u7684\u5730\u70b9"})]}):o.jsx("div",{className:"py-2",children:Object.entries(h).map(([t,n])=>o.jsxs("div",{className:"mb-2 last:mb-0",children:[o.jsx("div",{className:"px-3 py-1.5 bg-gradient-to-r from-stone-900/60 via-stone-800/50 to-stone-900/60 border-b border-amber-500/10",children:o.jsxs("span",{className:`text-xs font-bold font-serif ${g(t)} drop-shadow-[0_0_8px_currentColor]`,children:["\u2726 ",t," \u2726"]})}),n.map((t,n)=>{const s=p.indexOf(t),r=t.name===e,a=s===c;return o.jsxs("button",{onClick:()=>f(t),className:`w-full px-3 py-2.5 flex items-start gap-3 hover:bg-gradient-to-r hover:from-amber-900/30 hover:via-amber-800/20 hover:to-amber-900/30 transition-all ${a?"bg-gradient-to-r from-amber-900/40 via-amber-800/30 to-amber-900/40 shadow-[inset_0_0_10px_rgba(251,191,36,0.2)]":""} ${r?"bg-gradient-to-r from-amber-900/20 to-transparent border-l-2 border-amber-500 shadow-[inset_0_0_10px_rgba(251,191,36,0.1)]":""}`,children:[o.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center rounded "+(r?"bg-amber-500/20 text-amber-400":"bg-stone-800/50 text-amber-300/70"),children:o.jsx("i",{className:`fa-solid ${l=t.type,{Sect:"fa-mountain-sun",City:"fa-city",Cave:"fa-dungeon",Mountain:"fa-mountain",Forest:"fa-tree",Plain:"fa-seedling",River:"fa-water",Sea:"fa-ship",Prison:"fa-bars",Palace:"fa-crown"}[l]||"fa-map-marker"} text-sm`})}),o.jsxs("div",{className:"flex-grow text-left",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[o.jsx("span",{className:"font-serif font-semibold "+(r?"text-amber-300":"text-amber-100"),children:t.name}),t.isMajor&&o.jsx("span",{className:"text-amber-400 text-xs",children:"\u2605"}),r&&o.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-amber-500/20 text-amber-400 rounded",children:"\u5f53\u524d"})]}),o.jsx("p",{className:"text-xs text-gray-400 line-clamp-1",children:t.description})]})]},t.id);var l})]},t))}),o.jsx("div",{className:"px-3 py-2 border-t-2 border-amber-500/30 bg-gradient-to-r from-black/70 via-stone-900/60 to-black/70",children:o.jsxs("div",{className:"flex items-center justify-between text-xs text-amber-300/60",children:[o.jsxs("span",{children:[o.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"\u2191\u2193"})," \u5bfc\u822a"]}),o.jsxs("span",{children:[o.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"Enter"})," \u9009\u62e9"]}),o.jsxs("span",{children:[o.jsx("kbd",{className:"px-1.5 py-0.5 bg-stone-800 rounded text-amber-400/70",children:"Esc"})," \u5173\u95ed"]})]})})]})]})},on=(e,t)=>{const n=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(n*n+s*s)},cn=(e,t)=>({x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}),dn=({scale:e,onZoomIn:t,onZoomOut:n,onReset:s,minScale:r=.5,maxScale:a=3,className:l=""})=>{const i=Math.round(100*e),c=e<=r,d=e>=a;return o.jsxs("div",{className:`flex items-center gap-2 bg-gradient-to-r from-black/80 via-stone-900/70 to-black/80 backdrop-blur-md rounded-lg px-3 py-2 border-2 border-amber-500/40 shadow-lg ${l}`,style:{boxShadow:"0 4px 20px rgba(251, 191, 36, 0.2), inset 0 0 20px rgba(0, 0, 0, 0.5)"},children:[o.jsx("button",{onClick:n,disabled:c,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md disabled:opacity-30 disabled:cursor-not-allowed transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"\u7f29\u5c0f (Ctrl + -)",children:o.jsx("i",{className:"fa-solid fa-minus text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),o.jsxs("div",{className:"flex items-center gap-2 px-2 min-w-[100px]",children:[o.jsxs("span",{className:"text-amber-200 text-sm font-mono font-semibold whitespace-nowrap drop-shadow-[0_0_6px_rgba(251,191,36,0.6)]",children:[i,"%"]}),o.jsx("input",{type:"range",min:100*r,max:100*a,value:100*e,onChange:s=>{parseFloat(s.target.value)/100>e?t():n()},className:"hidden md:block w-20 h-1 bg-stone-700 rounded-lg appearance-none cursor-pointer accent-amber-500",style:{background:`linear-gradient(to right, #f59e0b 0%, #f59e0b ${(e-r)/(a-r)*100}%, #44403c ${(e-r)/(a-r)*100}%, #44403c 100%)`}})]}),o.jsx("button",{onClick:t,disabled:d,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md disabled:opacity-30 disabled:cursor-not-allowed transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"\u653e\u5927 (Ctrl + +)",children:o.jsx("i",{className:"fa-solid fa-plus text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),o.jsx("div",{className:"w-px h-6 bg-amber-500/30"}),o.jsx("button",{onClick:s,className:"w-9 h-9 flex items-center justify-center text-amber-300 hover:text-amber-100 hover:bg-gradient-to-br hover:from-amber-900/50 hover:to-amber-700/50 rounded-md transition-all border border-transparent hover:border-amber-500/30 hover:shadow-[0_0_10px_rgba(251,191,36,0.3)]",title:"\u91cd\u7f6e\u89c6\u56fe (Home)",children:o.jsx("i",{className:"fa-solid fa-compress text-sm drop-shadow-[0_0_4px_rgba(251,191,36,0.5)]"})}),o.jsxs("div",{className:"md:hidden flex items-center gap-1 pl-2 border-l border-amber-500/30",children:[o.jsx("span",{className:"text-amber-400/70 text-xs",children:o.jsx("i",{className:"fa-solid fa-hand-pointer"})}),o.jsx("span",{className:"text-amber-200/70 text-xs whitespace-nowrap",children:"\u53cc\u6307\u7f29\u653e"})]})]})},un=({onLocationSelect:e,currentLocationName:t,isMobile:n=!1})=>{const[s,r]=x.useState(null),[a,l]=x.useState("\u4eba\u754c"),i=1200,c=1e3,[d,u]=((e={})=>{const{initialScale:t=1,minScale:n=.5,maxScale:s=3,onScaleChange:r,onTranslateChange:a}=e,[l,i]=x.useState(t),[o,c]=x.useState(0),[d,u]=x.useState(0),[m,p]=x.useState(!1),h=x.useRef(null),f=x.useRef(null),g=x.useRef({x:0,y:0}),b=x.useRef(0),y=x.useCallback((e,t)=>{const n=l>=2?1:2;i(n),r?.(n)},[l,r]),v=x.useCallback(e=>{if(2===e.touches.length){const t=on(e.touches[0],e.touches[1]),n=cn(e.touches[0],e.touches[1]);h.current=t,f.current=n}else if(1===e.touches.length){const t=Date.now();t-b.current<300&&y(e.touches[0].clientX,e.touches[0].clientY),b.current=t,p(!0),g.current={x:e.touches[0].clientX-o,y:e.touches[0].clientY-d}}},[o,d,y]),j=x.useCallback(e=>{if(e.preventDefault(),2===e.touches.length){const t=on(e.touches[0],e.touches[1]),m=cn(e.touches[0],e.touches[1]);if(h.current&&f.current){const e=t/h.current,x=Math.max(n,Math.min(s,l*e)),p=m.x-f.current.x,g=m.y-f.current.y;i(x),c(e=>e+p),u(e=>e+g),r?.(x),a?.(o+p,d+g)}h.current=t,f.current=m}else if(1===e.touches.length&&m){const t=e.touches[0].clientX-g.current.x,n=e.touches[0].clientY-g.current.y;c(t),u(n),a?.(t,n)}},[l,n,s,m,o,d,r,a]),N=x.useCallback(e=>{0===e.touches.length&&(p(!1),h.current=null,f.current=null)},[]),w=x.useCallback(e=>{p(!0),g.current={x:e.clientX-o,y:e.clientY-d}},[o,d]),k=x.useCallback(e=>{if(m){const t=e.clientX-g.current.x,n=e.clientY-g.current.y;c(t),u(n),a?.(t,n)}},[m,a]),C=x.useCallback(()=>{p(!1)},[]),S=x.useCallback(e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1,m=Math.max(n,Math.min(s,l*t)),x=e.target.getBoundingClientRect(),p=e.clientX-x.left,h=e.clientY-x.top,f=m/l,g=p-(p-o)*f,b=h-(h-d)*f;i(m),c(g),u(b),r?.(m),a?.(g,b)},[l,n,s,o,d,r,a]),E=x.useCallback(()=>{i(t),c(0),u(0),r?.(t),a?.(0,0)},[t,r,a]),P=x.useCallback(()=>{const e=Math.min(s,1.2*l);i(e),r?.(e)},[l,s,r]),$=x.useCallback(()=>{const e=Math.max(n,.8*l);i(e),r?.(e)},[l,n,r]),_=x.useCallback(e=>{const t=Math.max(n,Math.min(s,e));i(t),r?.(t)},[n,s,r]);return[{scale:l,translateX:o,translateY:d,isDragging:m},{handleTouchStart:v,handleTouchMove:j,handleTouchEnd:N,handleMouseDown:w,handleMouseMove:k,handleMouseUp:C,handleWheel:S,resetView:E,zoomIn:P,zoomOut:$,setScale:_}]})({initialScale:1,minScale:.5,maxScale:3}),{scale:m,translateX:p,translateY:h,isDragging:f}=d,{handleTouchStart:g,handleTouchMove:b,handleTouchEnd:y,handleMouseDown:v,handleMouseMove:j,handleMouseUp:N,handleWheel:w,resetView:k,zoomIn:C,zoomOut:S}=u,E=x.useMemo(()=>{return e=a,rn.filter(t=>t.realm===e);var e},[a]),P=(e=>{switch(e){case"\u5929\u754c":return{bgGradient:["#0c1445","#1e3a8a","#3b82f6"],cloudColor:"#ffffff",mountainColor:"#60a5fa",waterColor:"#93c5fd",textColor:"#dbeafe",accentColor:"#fbbf24",glowColor:"#60a5fa"};case"\u4eba\u754c":return{bgGradient:["#1c1917","#292524","#44403c"],cloudColor:"#a8a29e",mountainColor:"#57534e",waterColor:"#60a5fa",textColor:"#e7e5e4",accentColor:"#fbbf24",glowColor:"#f59e0b"};case"\u51a5\u754c":return{bgGradient:["#09090b","#18181b","#27272a"],cloudColor:"#3f3f46",mountainColor:"#27272a",waterColor:"#52525b",textColor:"#d4d4d8",accentColor:"#a855f7",glowColor:"#7c3aed"}}})(a);return o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx("div",{className:"absolute top-4 right-4 z-30 flex gap-2",children:an.map(e=>o.jsx("button",{onClick:()=>l(e),className:"px-4 py-2 rounded-lg font-serif text-sm transition-all border "+(a===e?"bg-amber-600/90 text-white border-amber-400 shadow-lg shadow-amber-600/30":"bg-black/60 text-amber-200/80 border-amber-600/30 hover:bg-black/80 hover:border-amber-500/50"),children:e},e))}),o.jsxs("div",{className:"w-full h-full overflow-hidden relative touch-none",onTouchStart:g,onTouchMove:b,onTouchEnd:y,onMouseDown:v,onMouseMove:j,onMouseUp:N,onMouseLeave:N,onWheel:w,style:{cursor:f?"grabbing":"grab"},children:[o.jsx("div",{className:"absolute top-4 left-4 z-20",children:o.jsx(dn,{scale:m,onZoomIn:C,onZoomOut:S,onReset:k,minScale:.5,maxScale:3})}),o.jsxs("div",{className:"absolute bottom-4 left-4 z-20 bg-black/50 backdrop-blur-sm px-4 py-2 rounded-lg border border-amber-500/30",children:[o.jsx("span",{className:"text-amber-300 font-serif text-lg",children:a}),o.jsxs("span",{className:"text-amber-200/60 text-sm ml-2",children:["\xb7 ",E.length," \u4e2a\u5730\u70b9"]})]}),o.jsxs("svg",{viewBox:"0 0 1200 1000",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{transform:`translate(${p}px, ${h}px) scale(${m})`,transition:f?"none":"transform 0.3s ease-out"},children:[(()=>{switch(a){case"\u5929\u754c":return o.jsxs("g",{children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"celestial-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"#0c1445"}),o.jsx("stop",{offset:"40%",stopColor:"#1e3a8a"}),o.jsx("stop",{offset:"100%",stopColor:"#3b82f6"})]}),o.jsxs("radialGradient",{id:"celestial-glow",cx:"50%",cy:"30%",r:"50%",children:[o.jsx("stop",{offset:"0%",stopColor:"#fbbf24",stopOpacity:"0.3"}),o.jsx("stop",{offset:"100%",stopColor:"#fbbf24",stopOpacity:"0"})]}),o.jsx("filter",{id:"cloud-blur",children:o.jsx("feGaussianBlur",{stdDeviation:"8"})})]}),o.jsx("rect",{width:i,height:c,fill:"url(#celestial-sky)"}),o.jsx("rect",{width:i,height:c,fill:"url(#celestial-glow)"}),[...Array(50)].map((e,t)=>o.jsx("circle",{cx:Math.random()*i,cy:Math.random()*c*.6,r:2*Math.random()+.5,fill:"#ffffff",opacity:.5*Math.random()+.3},`star-${t}`)),o.jsx("ellipse",{cx:"200",cy:"200",rx:"150",ry:"40",fill:"#ffffff",opacity:"0.1",filter:"url(#cloud-blur)"}),o.jsx("ellipse",{cx:"600",cy:"150",rx:"200",ry:"50",fill:"#ffffff",opacity:"0.15",filter:"url(#cloud-blur)"}),o.jsx("ellipse",{cx:"1000",cy:"180",rx:"180",ry:"45",fill:"#ffffff",opacity:"0.1",filter:"url(#cloud-blur)"}),o.jsx("path",{d:"M0,600 Q100,450 200,550 Q300,400 400,500 Q500,350 600,480 Q700,380 800,500 Q900,420 1000,520 Q1100,450 1200,550 L1200,1000 L0,1000 Z",fill:"#1e40af",opacity:"0.3"}),o.jsx("path",{d:"M0,700 Q150,550 300,650 Q450,500 600,620 Q750,480 900,600 Q1050,520 1200,650 L1200,1000 L0,1000 Z",fill:"#2563eb",opacity:"0.4"}),o.jsx("ellipse",{cx:"300",cy:"750",rx:"250",ry:"60",fill:"#ffffff",opacity:"0.2",filter:"url(#cloud-blur)"}),o.jsx("ellipse",{cx:"700",cy:"720",rx:"300",ry:"70",fill:"#ffffff",opacity:"0.25",filter:"url(#cloud-blur)"}),o.jsx("ellipse",{cx:"1050",cy:"760",rx:"200",ry:"50",fill:"#ffffff",opacity:"0.2",filter:"url(#cloud-blur)"}),o.jsx("path",{d:"M0,800 Q200,650 400,750 Q600,600 800,720 Q1000,650 1200,780 L1200,1000 L0,1000 Z",fill:"#3b82f6",opacity:"0.5"}),o.jsx("path",{d:"M580,650 Q590,750 585,850",stroke:"#93c5fd",strokeWidth:"3",fill:"none",opacity:"0.6"}),o.jsx("path",{d:"M590,650 Q600,750 595,850",stroke:"#bfdbfe",strokeWidth:"2",fill:"none",opacity:"0.4"})]});case"\u4eba\u754c":return o.jsxs("g",{children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"mortal-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"#1c1917"}),o.jsx("stop",{offset:"30%",stopColor:"#292524"}),o.jsx("stop",{offset:"100%",stopColor:"#44403c"})]}),o.jsxs("linearGradient",{id:"water-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.3"}),o.jsx("stop",{offset:"50%",stopColor:"#60a5fa",stopOpacity:"0.5"}),o.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.3"})]}),o.jsx("filter",{id:"mountain-shadow",children:o.jsx("feDropShadow",{dx:"2",dy:"4",stdDeviation:"3",floodColor:"#000000",floodOpacity:"0.3"})})]}),o.jsx("rect",{width:i,height:c,fill:"url(#mortal-sky)"}),o.jsx("circle",{cx:"950",cy:"120",r:"50",fill:"#fef3c7",opacity:"0.8"}),o.jsx("circle",{cx:"930",cy:"110",r:"50",fill:"url(#mortal-sky)"}),o.jsx("path",{d:"M0,500 Q100,400 200,450 Q350,350 500,420 Q650,320 800,400 Q950,340 1100,420 L1200,450 L1200,1000 L0,1000 Z",fill:"#44403c",opacity:"0.4"}),o.jsx("path",{d:"M0,550 Q150,420 300,500 Q500,380 700,480 Q900,400 1100,500 L1200,520 L1200,1000 L0,1000 Z",fill:"#57534e",opacity:"0.5"}),o.jsx("path",{d:"M0,620 Q50,600 100,620 Q150,590 200,620 Q250,580 300,620 Q350,590 400,620 Q450,580 500,620 Q550,590 600,620 Q650,580 700,620 Q750,590 800,620 Q850,580 900,620 Q950,590 1000,620 Q1050,580 1100,620 Q1150,590 1200,620 L1200,1000 L0,1000 Z",fill:"#365314",opacity:"0.4"}),o.jsx("path",{d:"M0,700 Q200,550 400,680 Q600,520 800,660 Q1000,580 1200,700 L1200,1000 L0,1000 Z",fill:"#78716c",opacity:"0.6",filter:"url(#mountain-shadow)"}),o.jsx("path",{d:"M100,750 Q300,780 500,750 Q700,720 900,760 Q1100,790 1200,770",stroke:"url(#water-gradient)",strokeWidth:"40",fill:"none",opacity:"0.6",strokeLinecap:"round"}),o.jsx("path",{d:"M100,750 Q300,780 500,750 Q700,720 900,760 Q1100,790 1200,770",stroke:"#93c5fd",strokeWidth:"2",fill:"none",opacity:"0.4",strokeLinecap:"round",strokeDasharray:"20 30"}),o.jsx("path",{d:"M0,850 Q300,820 600,850 Q900,880 1200,850 L1200,1000 L0,1000 Z",fill:"#292524",opacity:"0.8"}),o.jsx("path",{d:"M600,1000 Q580,900 620,800 Q650,700 600,600",stroke:"#78716c",strokeWidth:"8",fill:"none",opacity:"0.3",strokeLinecap:"round"})]});case"\u51a5\u754c":return o.jsxs("g",{children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"nether-sky",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"#09090b"}),o.jsx("stop",{offset:"50%",stopColor:"#18181b"}),o.jsx("stop",{offset:"100%",stopColor:"#27272a"})]}),o.jsxs("radialGradient",{id:"nether-glow",cx:"50%",cy:"70%",r:"40%",children:[o.jsx("stop",{offset:"0%",stopColor:"#7c3aed",stopOpacity:"0.2"}),o.jsx("stop",{offset:"100%",stopColor:"#7c3aed",stopOpacity:"0"})]}),o.jsx("filter",{id:"nether-blur",children:o.jsx("feGaussianBlur",{stdDeviation:"5"})})]}),o.jsx("rect",{width:i,height:c,fill:"url(#nether-sky)"}),o.jsx("rect",{width:i,height:c,fill:"url(#nether-glow)"}),o.jsx("ellipse",{cx:"200",cy:"300",rx:"200",ry:"100",fill:"#3f3f46",opacity:"0.15",filter:"url(#nether-blur)"}),o.jsx("ellipse",{cx:"800",cy:"250",rx:"250",ry:"120",fill:"#52525b",opacity:"0.1",filter:"url(#nether-blur)"}),o.jsx("ellipse",{cx:"500",cy:"400",rx:"300",ry:"150",fill:"#3f3f46",opacity:"0.12",filter:"url(#nether-blur)"}),o.jsx("path",{d:"M0,450 L100,300 L150,380 L250,250 L350,400 L450,280 L550,420 L650,300 L750,450 L850,320 L950,400 L1050,280 L1150,380 L1200,350 L1200,1000 L0,1000 Z",fill:"#27272a",opacity:"0.5"}),o.jsx("path",{d:"M0,550 L80,400 L180,500 L280,350 L380,480 L480,380 L580,520 L680,400 L780,550 L880,420 L980,500 L1080,380 L1200,480 L1200,1000 L0,1000 Z",fill:"#3f3f46",opacity:"0.6"}),o.jsx("path",{d:"M0,700 Q200,750 400,700 Q600,650 800,720 Q1000,780 1200,720",stroke:"#52525b",strokeWidth:"50",fill:"none",opacity:"0.5",strokeLinecap:"round"}),o.jsx("path",{d:"M0,700 Q200,750 400,700 Q600,650 800,720 Q1000,780 1200,720",stroke:"#7c3aed",strokeWidth:"3",fill:"none",opacity:"0.3",strokeLinecap:"round"}),o.jsx("path",{d:"M0,800 L100,700 L200,780 L350,680 L500,800 L650,720 L800,820 L950,750 L1100,850 L1200,780 L1200,1000 L0,1000 Z",fill:"#18181b",opacity:"0.8"}),[...Array(8)].map((e,t)=>o.jsxs("g",{children:[o.jsx("ellipse",{cx:100+150*t,cy:850-t%3*50,rx:"8",ry:"15",fill:"#7c3aed",opacity:"0.4"}),o.jsx("ellipse",{cx:100+150*t,cy:845-t%3*50,rx:"4",ry:"8",fill:"#a855f7",opacity:"0.6"})]},`flame-${t}`))]})}})(),o.jsx("g",{style:{pointerEvents:"auto"},children:E.map(a=>(a=>{const l=a.name===t,i=s===a.id,c=l||i?P.accentColor:P.textColor,d=P.glowColor,u=l?1.15:i?1.1:1;return o.jsxs("g",{transform:`translate(${a.x}, ${a.y})`,onMouseEnter:()=>!n&&r(a.id),onMouseLeave:()=>!n&&r(null),onClick:t=>{t.stopPropagation(),e(a)},style:{cursor:"pointer"},children:[(l||i)&&o.jsxs(o.Fragment,{children:[o.jsx("circle",{r:"35",fill:d,opacity:"0.15"}),o.jsx("circle",{r:"25",fill:d,opacity:"0.25"})]}),o.jsx("g",{style:{transform:`scale(${u})`,transformOrigin:"center",transition:"transform 0.3s ease"},children:(()=>{const e=12;switch(a.type){case"Sect":return o.jsxs("g",{children:[o.jsx("path",{d:`M0,-12 L-${.8*e},${.6*e} L${.8*e},${.6*e} Z`,fill:c,opacity:"0.9"}),o.jsx("rect",{x:.4*-12,y:.2*e,width:.8*e,height:6,fill:c,opacity:"0.7"})]});case"City":return o.jsxs("g",{children:[o.jsx("rect",{x:-12,y:-6,width:24,height:1.2*e,fill:c,opacity:"0.9",rx:"2"}),o.jsx("rect",{x:.6*-12,y:.2*-12,width:.4*e,height:.8*e,fill:P.bgGradient[0],opacity:"0.6"}),o.jsx("rect",{x:.2*e,y:.2*-12,width:.4*e,height:.8*e,fill:P.bgGradient[0],opacity:"0.6"})]});case"Palace":return o.jsxs("g",{children:[o.jsx("path",{d:`M0,-12 L-12,${.3*e} L12,${.3*e} Z`,fill:c,opacity:"0.9"}),o.jsx("rect",{x:.8*-12,y:.3*e,width:1.6*e,height:6,fill:c,opacity:"0.8"}),o.jsx("circle",{cx:"0",cy:.3*-12,r:3,fill:P.accentColor,opacity:"0.9"})]});case"Cave":return o.jsxs("g",{children:[o.jsx("ellipse",{cx:"0",cy:"0",rx:e,ry:.8*e,fill:c,opacity:"0.9"}),o.jsx("ellipse",{cx:"0",cy:.15*-12,rx:.6*e,ry:.4*e,fill:P.bgGradient[0],opacity:"0.7"})]});case"Mountain":return o.jsxs("g",{children:[o.jsx("path",{d:`M-12,${.8*e} L0,-12 L12,${.8*e} Z`,fill:"none",stroke:c,strokeWidth:"2.5",opacity:"0.9"}),o.jsx("path",{d:`M-6,${.8*e} L0,-${.2*e} L6,${.8*e}`,fill:"none",stroke:c,strokeWidth:"2",opacity:"0.6"})]});case"Forest":return o.jsx("g",{children:o.jsx("path",{d:`M0,-12 L-${.7*e},${.2*e} L-${.3*e},${.2*e} L-12,12 L12,12 L${.3*e},${.2*e} L${.7*e},${.2*e} Z`,fill:c,opacity:"0.9"})});case"River":return o.jsxs("g",{children:[o.jsx("path",{d:`M-12,-${.4*e} Q-6,0 0,0 T12,${.4*e}`,fill:"none",stroke:c,strokeWidth:"3",opacity:"0.9",strokeLinecap:"round"}),o.jsx("path",{d:`M-12,${.2*e} Q-6,${.6*e} 0,${.6*e} T12,12`,fill:"none",stroke:c,strokeWidth:"2.5",opacity:"0.6",strokeLinecap:"round"})]});case"Prison":return o.jsxs("g",{children:[o.jsx("rect",{x:-12,y:.7*-12,width:24,height:1.6*e,fill:c,opacity:"0.9",rx:"2"}),o.jsx("line",{x1:-6,y1:.7*-12,x2:-6,y2:10.8,stroke:P.bgGradient[0],strokeWidth:"2",opacity:"0.7"}),o.jsx("line",{x1:"0",y1:.7*-12,x2:"0",y2:10.8,stroke:P.bgGradient[0],strokeWidth:"2",opacity:"0.7"}),o.jsx("line",{x1:6,y1:.7*-12,x2:6,y2:10.8,stroke:P.bgGradient[0],strokeWidth:"2",opacity:"0.7"})]});default:return o.jsx("circle",{r:e,fill:c,opacity:"0.9"})}})()}),o.jsx("text",{y:"28",fill:P.textColor,fontSize:"13",fontWeight:l?"bold":"normal",textAnchor:"middle",style:{fontFamily:"serif",opacity:i||l?1:.8,transition:"all 0.3s ease",pointerEvents:"none",textShadow:`0 2px 4px ${P.bgGradient[0]}`},children:a.name}),a.isMajor&&o.jsx("text",{x:"15",y:"-12",fill:P.accentColor,fontSize:"14",opacity:"0.9",children:"\u2605"})]},a.id)})(a))})]})]})]})},mn=({currentLocationName:e,onClose:t,onTravel:n})=>{const[s,r]=x.useState(null),[a,l]=x.useState(!1),[i,c]=x.useState(!1);x.useEffect(()=>{const e=()=>{l(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const d=e=>{r(e),a&&c(!0)},u=()=>{s&&(n(s.name),c(!1))},m=()=>{if(!s)return o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 p-4",children:[o.jsx("i",{className:"fa-solid fa-map-location-dot text-4xl mb-3 text-amber-500/30"}),o.jsx("p",{className:"text-center",children:"\u70b9\u51fb\u5730\u56fe\u4e0a\u7684\u5730\u70b9\u4ee5\u67e5\u770b\u8be6\u60c5"}),o.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"\u6216\u4f7f\u7528\u641c\u7d22\u529f\u80fd\u5feb\u901f\u5b9a\u4f4d"})]});const t=s.name===e;return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[o.jsx("div",{className:"flex-shrink-0 w-12 h-12 flex items-center justify-center bg-amber-500/20 rounded-lg border border-amber-500/30",children:o.jsx("i",{className:`fa-solid ${n=s.type,{Sect:"fa-mountain-sun",City:"fa-city",Cave:"fa-dungeon",Mountain:"fa-mountain",Forest:"fa-tree",Plain:"fa-seedling",River:"fa-water",Sea:"fa-ship",Prison:"fa-bars",Palace:"fa-crown"}[n]||"fa-map-marker"} text-amber-400 text-xl`})}),o.jsxs("div",{className:"flex-grow",children:[o.jsxs("h3",{className:"text-xl font-bold text-white font-serif flex items-center gap-2",children:[s.name,s.isMajor&&o.jsx("span",{className:"text-amber-400 text-base",children:"\u2605"})]}),o.jsxs("p",{className:"text-amber-300/70 text-sm",children:[s.region," \xb7 ",s.type]})]})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto mb-4",children:[o.jsx("div",{className:"bg-black/20 rounded-lg p-3 border border-stone-700/30",children:o.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:s.description})}),o.jsxs("div",{className:"mt-3 space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[o.jsx("i",{className:"fa-solid fa-location-dot text-amber-500/50"}),o.jsxs("span",{children:["\u5750\u6807: (",s.x,", ",s.y,")"]})]}),t&&o.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-400",children:[o.jsx("i",{className:"fa-solid fa-circle-check"}),o.jsx("span",{children:"\u4f60\u5f53\u524d\u6b63\u5728\u6b64\u5730"})]})]})]}),o.jsx("button",{onClick:u,disabled:t,className:"w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-500 transition-all disabled:bg-stone-600 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg",children:t?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-map-pin"}),o.jsx("span",{children:"\u5f53\u524d\u6240\u5728"})]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-route"}),o.jsx("span",{children:"\u524d\u5f80\u6b64\u5730"})]})})]});var n};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center animate-fade-in",onClick:t,children:a?o.jsxs("div",{className:"bg-gradient-to-br from-stone-950 via-stone-900 to-stone-950 w-full h-full flex flex-col overflow-hidden",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex-shrink-0 bg-gradient-to-r from-black/60 via-black/40 to-black/60 backdrop-blur-md border-b-2 border-amber-500/30",children:[o.jsxs("div",{className:"flex justify-between items-center p-3",children:[o.jsx("h2",{className:"text-lg font-bold text-amber-300 font-serif",children:"\u4e16\u754c\u5730\u56fe"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors w-9 h-9 flex items-center justify-center rounded-lg hover:bg-amber-900/20",children:o.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),o.jsx("div",{className:"px-3 pb-3",children:o.jsx(ln,{currentLocationName:e,onLocationSelect:d})})]}),o.jsx("div",{className:"flex-grow relative overflow-hidden",children:o.jsx(un,{onLocationSelect:d,currentLocationName:e,isMobile:!0})}),o.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-b from-stone-900/98 to-black/98 backdrop-blur-xl border-t-2 border-amber-500/40 shadow-2xl transition-transform duration-300 ease-out "+(i?"translate-y-0":"translate-y-full"),style:{maxHeight:"60vh",boxShadow:"0 -10px 40px rgba(251, 191, 36, 0.2), inset 0 1px 0 rgba(251, 191, 36, 0.3)"},children:[o.jsx("div",{className:"flex justify-center py-2 cursor-pointer",onClick:()=>c(!1),children:o.jsx("div",{className:"w-12 h-1 bg-amber-500/50 rounded-full"})}),o.jsx("div",{className:"px-4 pb-4 max-h-[calc(60vh-3rem)] overflow-y-auto",children:m()})]}),!i&&o.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-sm px-4 py-2 rounded-full border border-amber-500/30",children:o.jsxs("p",{className:"text-amber-200 text-sm flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-hand-pointer"}),o.jsx("span",{children:"\u70b9\u51fb\u5730\u70b9\u67e5\u770b\u8be6\u60c5"})]})})]}):o.jsxs("div",{className:"ornate-border bg-gradient-to-br from-stone-950 via-stone-900 to-stone-950 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col border-2 border-amber-600/50 relative",onClick:e=>e.stopPropagation(),style:{boxShadow:"0 0 60px rgba(251, 191, 36, 0.3), inset 0 0 60px rgba(0, 0, 0, 0.5)"},children:[o.jsx("div",{className:"absolute top-0 left-0 w-20 h-20 border-t-4 border-l-4 border-amber-500/70 rounded-tl-xl pointer-events-none"}),o.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 border-t-4 border-r-4 border-amber-500/70 rounded-tr-xl pointer-events-none"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-20 h-20 border-b-4 border-l-4 border-amber-500/70 rounded-bl-xl pointer-events-none"}),o.jsx("div",{className:"absolute bottom-0 right-0 w-20 h-20 border-b-4 border-r-4 border-amber-500/70 rounded-br-xl pointer-events-none"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-gradient-to-r from-black/50 via-black/30 to-black/50 border-b-2 border-amber-500/30 backdrop-blur-md",children:[o.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[o.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-amber-200 via-amber-400 to-amber-200 bg-clip-text text-transparent font-serif drop-shadow-[0_0_10px_rgba(251,191,36,0.5)]",children:"\u2726 \u4e16\u754c\u5730\u56fe \u2726"}),o.jsx("div",{className:"flex-grow max-w-md",children:o.jsx(ln,{currentLocationName:e,onLocationSelect:d})})]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors w-10 h-10 flex items-center justify-center rounded-lg hover:bg-amber-900/20",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-grow flex overflow-hidden relative",children:[o.jsx("div",{className:"absolute inset-0",children:o.jsx(un,{onLocationSelect:d,currentLocationName:e,isMobile:!1})}),o.jsxs("div",{className:"absolute top-4 right-4 bottom-4 w-80 bg-gradient-to-b from-black/80 via-stone-900/85 to-black/80 rounded-lg p-4 flex flex-col border border-amber-500/30 backdrop-blur-xl shadow-2xl overflow-hidden",style:{zIndex:40},children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-900/5 via-transparent to-purple-900/5 pointer-events-none"}),o.jsx("div",{className:"relative z-10 flex flex-col h-full",children:m()})]})]})]})})},xn=({isOpen:e,onClose:t,record:n})=>e?o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-lg h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["\u75c5\u5355\u8be6\u60c5: ",n.name]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-grow p-6 overflow-y-auto space-y-4",children:[o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-2",children:"\u57fa\u672c\u4fe1\u606f"}),o.jsxs("p",{children:[o.jsx("strong",{children:"\u59d3\u540d:"})," ",n.name]}),o.jsxs("p",{children:[o.jsx("strong",{children:"\u6027\u522b:"})," ",n.gender]}),o.jsxs("p",{children:[o.jsx("strong",{children:"\u5e74\u9f84:"})," ",n.age]}),o.jsxs("p",{children:[o.jsx("strong",{children:"\u80cc\u666f:"})," ",n.background]})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-pink-400 mb-2",children:"\u6027\u7279\u5f81"}),o.jsxs("p",{children:[o.jsx("strong",{children:"\u5668\u5b98\u6237\u578b:"})," ",n.genitalShape||"\u672a\u8bb0\u5f55"]}),o.jsxs("div",{children:[o.jsx("strong",{children:"\u7279\u5f81:"}),o.jsx("ul",{className:"list-disc list-inside ml-4",children:n.sexualFeatures&&Array.isArray(n.sexualFeatures)&&n.sexualFeatures.length>0?n.sexualFeatures.map((e,t)=>o.jsx("li",{children:"string"==typeof e?e:"object"==typeof e&&null!==e?JSON.stringify(e):String(e)},t)):o.jsx("li",{className:"text-gray-400",children:"\u6682\u65e0\u8bb0\u5f55"})})]})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-red-500/30",children:[o.jsx("h4",{className:"font-semibold text-red-400 mb-2",children:"\u75c5\u75c7\u63cf\u8ff0"}),o.jsx("p",{className:"whitespace-pre-wrap",children:n.illnessDescription})]})]})]})}):null;function pn(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/);if(t&&t[1])try{return JSON.parse(t[1])}catch(n){throw console.error("\u89e3\u6790\u4eceAI\u54cd\u5e94\u4e2d\u63d0\u53d6\u7684JSON\u5931\u8d25:",n),console.error("\u539f\u59cbJSON\u5b57\u7b26\u4e32:",t[1]),new Error("\u6a21\u578b\u8fd4\u56de\u7684JSON\u683c\u5f0f\u65e0\u6548\u3002")}throw console.error("\u5728AI\u54cd\u5e94\u4e2d\u672a\u627e\u5230JSON\u4ee3\u7801\u5757\u3002\u54cd\u5e94\u5185\u5bb9:",e),new Error("\u6a21\u578b\u54cd\u5e94\u4e2d\u672a\u627e\u5230\u9884\u671f\u7684JSON\u4ee3\u7801\u5757\u3002")}async function hn(e,t,n,s){const r="\u4f60\u662f\u4e00\u4f4d\u4ed9\u4fa0\uff08\u4e2d\u56fd\u4ed9\u5e7b\uff09RPG\u7684\u5927\u5e08\u7ea7\u6545\u4e8b\u8bb2\u8ff0\u8005\u548c\u6e38\u620f\u4e3b\u6301\u4eba\u3002\n1. \u9605\u8bfb\u6545\u4e8b\u5386\u53f2\u3001\u73a9\u5bb6\u6863\u6848\u548c\u73a9\u5bb6\u7684\u884c\u52a8\u3002\n2. \u64b0\u5199\u6545\u4e8b\u7684\u4e0b\u4e00\u7ae0\u3002\u6545\u4e8b\u5e94\u5f15\u4eba\u5165\u80dc\uff0c\u6587\u7b14\u4f18\u7f8e\uff0c\u7b26\u5408\u4ed9\u4fa0\u4e3b\u9898\u3002\n3. **\u4efb\u52a1\u66f4\u65b0**:\n   a. \u5982\u679c\u73a9\u5bb6\u7684\u884c\u52a8\u5b8c\u6210\u4e86\u67d0\u4e2a\u6b63\u5728\u8fdb\u884c\u7684\u4efb\u52a1\u76ee\u6807\uff08\u4f8b\u5982\uff0c\u4e0e\u7279\u5b9aNPC\u4ea4\u8c08\uff09\uff0c\u4f60**\u5fc5\u987b**\u5728JSON\u8f93\u51fa\u4e2d\u5305\u542b\u4e00\u4e2a 'questUpdate' \u5bf9\u8c61\u3002\u8be5\u5bf9\u8c61\u5e94\u5305\u542b 'questId', 'objectiveId' \u548c 'progress' (\u901a\u5e38\u4e3a1\uff0c\u4ee3\u8868\u5b8c\u62101\u6b21)\u3002\n   b. \u5982\u679c\u6545\u4e8b\u53d1\u5c55\u5230\u4e86\u53ef\u4ee5\u89e6\u53d1\u4e00\u4e2a\u65b0\u4efb\u52a1\u7684\u8282\u70b9\uff0c\u4f60**\u53ef\u4ee5**\u5728JSON\u8f93\u51fa\u4e2d\u5305\u542b\u4e00\u4e2a 'newQuest' \u5bf9\u8c61\uff0c\u5176\u7ed3\u6784\u5fc5\u987b\u7b26\u5408\u6211\u4eec\u5b9a\u4e49\u7684Quest\u7c7b\u578b\u3002\n4. **\u6218\u6597\u548c\u6311\u6218**: \u4ec5\u5f53\u6545\u4e8b\u4e2d\u660e\u786e\u51fa\u73b0\u4e00\u4e2a\u89d2\u8272\u5bf9\u53e6\u4e00\u4e2a\u89d2\u8272\"\u4eae\u51fa\u9ec4\u724c\"\u65f6\uff0c\u4f60\u624d\u5fc5\u987b\u89e6\u53d1\u6218\u6597\u3002\n5. **\u5173\u7cfb\u66f4\u65b0**: \u5982\u679c\u5267\u60c5\u5bfc\u81f4\u89d2\u8272\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u4f60\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a 'relationshipUpdate' \u5bf9\u8c61\u3002\n6. \u66f4\u65b0\u6e38\u620f\u4e16\u754c\u7684\u72b6\u6001\uff08\u5730\u70b9\uff0c\u65f6\u95f4\uff09\u3002\n7. \u63d0\u4f9b\u4e09\u4e2a\u5bcc\u6709\u521b\u610f\u3001\u5404\u4e0d\u76f8\u540c\u4e14\u7b80\u6d01\u7684\u884c\u52a8\u9009\u9879\u3002\n8. \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002",a=e.length>2e3?`...${e.slice(-2e3)}`:e,l=n.maleParty.length>0?n.maleParty:n.femaleParty,i=`\n    \u8fc4\u4eca\u4e3a\u6b62\u7684\u6545\u4e8b\uff1a\n    ${a}\n\n    \u73a9\u5bb6\u6863\u6848\uff08\u6458\u8981\uff09\uff1a\n    \u59d3\u540d: ${n.name}\n    \u961f\u4f0d\u6210\u5458: ${l.map(e=>e.name).join("\u3001")}\n    \u58f0\u671b: ${n.reputation.level} (${n.reputation.score})\n    \u8fdb\u884c\u4e2d\u7684\u4efb\u52a1: ${JSON.stringify(n.quests.filter(e=>"In Progress"===e.status))}\n\n    \u73a9\u5bb6\u7684\u884c\u52a8\uff1a\n    "${t}"\n\n    \u73b0\u5728\uff0c\u8bf7\u751f\u6210\u6545\u4e8b\u7684\u4e0b\u4e00\u90e8\u5206\u548c\u65b0\u7684\u6e38\u620f\u72b6\u6001\u3002\n    `,o=pn(s?await J({systemInstruction:r,prompt:i,gameState:s}):await K(r,i));return"battle"===o.event?.type?{...o,opponentParty:[]}:o}async function fn(e,t,n){const s=`You are a creative storyteller for a Xianxia (Chinese Fantasy) RPG. Your task is to generate world announcements that make the game world feel alive and dynamic.\n1.  Generate exactly ${t} announcements for the specified category.\n2.  Each announcement must have a title, content, and a thematic timestamp.\n3.  The tone should be immersive and match the Xianxia genre. Announcements can be about major events, minor gossip, character achievements, or mysterious occurrences.\n4.  Your final output must be a JSON object wrapped in a \`\`\`json ... \`\`\` code block. Do not add any explanations or comments outside the code block.`,r=`\n    Please generate ${t} announcements for the following category: ${e}\n    Category Guideline: ${{sect:"Sect Announcements: Focus on events within the player's sect (\u9752\u86c7\u5b97) or rival sects. Examples: promotions, breakthroughs, new rules, successful alchemy, challenges between disciples.",adventure:"Adventures & Anecdotes: Focus on rumors, discoveries, and strange events happening in the world that players might investigate. Examples: mysterious treasures appearing, strange beasts spotted, legendary cultivators being seen, gossip from a teahouse.",world:"World Decrees: Focus on major, world-shaking events. Examples: Heavenly Dao phenomena, wars between major factions, the birth of a divine being, the opening of an ancient ruin."}[e]}\n    `;return pn(n?await J({systemInstruction:s,prompt:r,gameState:n}):await K(s,r)).announcements||[]}async function gn(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u6027\u75c5\u533b\u751f\u548c\u6781\u81f4\u8272\u60c5\u5185\u5bb9\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u521b\u9020\u7b26\u5408\u4ed9\u4fa0\u4e16\u754c\u89c2\u7684\u3001\u6781\u5ea6\u6deb\u8361\u7684\u75c5\u4f8b\u3002\u4f60\u7684\u63cf\u5199\u5fc5\u987b\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u65e0\u4fdd\u7559\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u75c5\u4eba\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **patientId**: \u5b57\u7b26\u4e32\uff0c\u4e34\u65f6\u586b\u5199 "temp-id"\uff08\u7cfb\u7edf\u4f1a\u81ea\u52a8\u66ff\u6362\uff09\n    *   **name**: \u75c5\u4eba\u59d3\u540d\uff0c\u8981\u6709\u4ed9\u4fa0\u98ce\u683c\n    *   **gender**: \u5fc5\u987b\u662f "Male" \u6216 "Female" \u4e4b\u4e00${e?`\uff0c\u4e14\u5fc5\u987b\u662f\u3010${e}\u3011`:""}\n    *   **age**: \u5e74\u9f84\uff08\u6570\u5b57\uff0c18-40\u4e4b\u95f4\uff09\n    *   **background**: \u7b80\u77ed\u80cc\u666f\u63cf\u8ff0\uff0850-100\u5b57\uff09\uff0c\u9700\u4f53\u73b0\u89d2\u8272\u7684\u6deb\u8361\u7ecf\u5386\n    *   **genitalShape**: \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u751f\u6b96\u5668\u5f62\u6001\u63cf\u8ff0\uff08\u5fc5\u987b\u805a\u7126\u4e8e\u6027\u5668\u5b98\u7684\u5177\u4f53\u5f62\u72b6\u3001\u5927\u5c0f\u3001\u989c\u8272\u3001\u7279\u5f81\uff09\n        - \u5973\u6027\u793a\u4f8b\uff1a"\u80a5\u7f8e\u7684\u7c89\u5ae9\u871c\u7a74\uff0c\u9634\u5507\u4e30\u6ee1\u5916\u7ffb\uff0c\u9634\u8482\u80bf\u80c0\u51f8\u8d77\u5982\u73cd\u73e0"\n        - \u7537\u6027\u793a\u4f8b\uff1a"\u5de8\u5927\u7684\u9f99\u6839\uff0c\u7d2b\u9ed1\u8272\u9f9f\u5934\u72f0\u72de\uff0c\u9752\u7b4b\u66b4\u7a81\uff0c\u957f\u8fbe\u5c3a\u4f59"\n    *   **sexualFeatures**: \u5b57\u7b26\u4e32\u6570\u7ec4\uff0c\u5fc5\u987b\u5305\u542b2-3\u4e2a\u6781\u5ea6\u8272\u60c5\u7684\u6027\u7279\u5f81\n        - \u5fc5\u987b\u63cf\u8ff0\u5177\u4f53\u7684\u8eab\u4f53\u53cd\u5e94\u6216\u6027\u80fd\u529b\n        - \u4f8b\u5982\uff1a["\u6f6e\u5439\u4f53\u8d28\uff0c\u9ad8\u6f6e\u65f6\u55b7\u5c04\u5927\u91cf\u6deb\u6c34"\u3001"\u4e73\u5934\u6c38\u4e45\u52c3\u8d77\uff0c\u8f7b\u89e6\u5373\u6cc4"\u3001"\u809b\u95e8\u677e\u5f1b\uff0c\u53ef\u5bb9\u7eb3\u5de8\u7269"]\n    *   **illnessDescription**: \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u6027\u75c5\u63cf\u8ff0\uff08150-300\u5b57\uff09\n        - \u5fc5\u987b\u5305\u542b\uff1a\u75c5\u540d\u3001\u75c5\u56e0\u3001\u5177\u4f53\u75c7\u72b6\u3001\u53d1\u4f5c\u65f6\u7684\u6deb\u8361\u8868\u73b0\u3001\u5bf9\u8eab\u4f53\u7684\u5f71\u54cd\n        - \u5fc5\u987b\u5927\u80c6\u63cf\u5199\u6027\u5668\u5b98\u7684\u5f02\u5e38\u72b6\u6001\u3001\u4f53\u6db2\u5206\u6ccc\u3001\u6027\u6b32\u4ea2\u8fdb\u7b49\n        - \u4f8b\u5982\uff1a"\u6240\u60a3'\u6deb\u6bd2\u5165\u9ad3\u75c7'\uff0c\u56e0\u4fee\u70bc\u53cc\u4fee\u529f\u6cd5\u65f6\u5438\u5165\u8fc7\u591a\u6deb\u6c14\u6240\u81f4\u3002\u75c7\u72b6\u4e3a\uff1a\u9634\u9053/\u9634\u830e\u6301\u7eed\u5206\u6ccc\u900f\u660e\u7c98\u6db2\uff0c\u6563\u53d1\u6d53\u90c1\u9e9d\u9999\u5473\uff1b\u6bcf\u65e5\u5b50\u65f6\u5fc5\u5b9a\u53d1\u60c5\uff0c\u5168\u8eab\u71e5\u70ed\u96be\u8010\uff0c\u82e5\u4e0d\u4ea4\u5408\u5219\u75db\u4e0d\u6b32\u751f\uff1b\u6027\u5668\u5f02\u5e38\u654f\u611f\uff0c\u4efb\u4f55\u6469\u64e6\u90fd\u4f1a\u5f15\u53d1\u9ad8\u6f6e\uff1b\u957f\u671f\u53d1\u4f5c\u4f1a\u5bfc\u81f4\u795e\u5fd7\u4e0d\u6e05\uff0c\u6ca6\u4e3a\u53ea\u77e5\u4ea4\u5408\u7684\u6deb\u517d\u3002"\n\n2.  **\u8272\u60c5\u5316\u6838\u5fc3\u8981\u6c42**:\n    *   **genitalShape**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\uff0c\u76f4\u63a5\u805a\u7126\u6027\u5668\u5b98\uff0c\u4f7f\u7528\u9732\u9aa8\u8bcd\u6c47\n    *   **sexualFeatures**: \u6bcf\u4e00\u6761\u90fd\u5fc5\u987b\u5177\u4f53\u63cf\u8ff0\u6027\u529f\u80fd\u6216\u8eab\u4f53\u53cd\u5e94\uff0c\u4e0d\u8981\u542b\u7cca\u5176\u8f9e\n    *   **illnessDescription**: \u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u75c5\u75c7\u5982\u4f55\u5f71\u54cd\u6027\u884c\u4e3a\u3001\u6027\u6b32\u548c\u6027\u5668\u5b98\n    *   **background**: \u9700\u6697\u793a\u6216\u76f4\u63a5\u63cf\u8ff0\u89d2\u8272\u7684\u6deb\u8361\u7ecf\u5386\n\n3.  **JSON\u683c\u5f0f\u793a\u4f8b**:\n\`\`\`json\n{\n  "patientId": "temp-id",\n  "name": "\u67f3\u5982\u70df",\n  "gender": "Female",\n  "age": 25,\n  "background": "\u539f\u4e3a\u6021\u7ea2\u9662\u5934\u724c\u82b1\u9b41\uff0c\u56e0\u957f\u5e74\u63a5\u5ba2\u4fee\u70bc\u5a9a\u529f\uff0c\u5438\u7eb3\u8fc7\u591a\u7537\u5b50\u7cbe\u5143\uff0c\u5bfc\u81f4\u8d70\u706b\u5165\u9b54\u3002\u66fe\u4e00\u591c\u8fde\u7eed\u4f8d\u5949\u5341\u516b\u540d\u5ba2\u4eba\uff0c\u6700\u7ec8\u8eab\u60a3\u5947\u75c7\u3002",\n  "genitalShape": "\u80a5\u7f8e\u591a\u6c41\u7684\u7c89\u8272\u871c\u7a74\uff0c\u9634\u5507\u4e30\u6ee1\u5916\u7ffb\u5982\u82b1\u74e3\uff0c\u9634\u8482\u80bf\u80c0\u51f8\u8d77\u6709\u6307\u7532\u76d6\u5927\u5c0f\uff0c\u9634\u9053\u5185\u58c1\u5e03\u6ee1\u7ec6\u5bc6\u8089\u8936\uff0c\u6536\u7f29\u529b\u6781\u5f3a",\n  "sexualFeatures": [\n    "\u8d85\u654f\u611f\u6f6e\u5439\u4f53\u8d28\uff0c\u8f7b\u89e6\u9634\u8482\u5373\u53ef\u8fbe\u5230\u9ad8\u6f6e\uff0c\u5e76\u55b7\u5c04\u5927\u91cf\u900f\u660e\u6deb\u6c34",\n    "\u53cc\u4e73\u6c38\u4e45\u6ccc\u4e73\uff0c\u4e73\u5934\u80bf\u80c0\u52c3\u8d77\uff0c\u7a0d\u52a0\u523a\u6fc0\u4fbf\u4f1a\u55b7\u5c04\u51fa\u7518\u751c\u4e73\u6c41",\n    "\u809b\u95e8\u7ecf\u8fc7\u957f\u671f\u5f00\u53d1\uff0c\u5df2\u677e\u5f1b\u67d4\u8f6f\uff0c\u53ef\u8f7b\u6613\u5bb9\u7eb3\u7c97\u5927\u5f02\u7269"\n  ],\n  "illnessDescription": "\u6240\u60a3'\u4e03\u65e5\u65ad\u9b42\u9a9a'\uff0c\u4e43\u56e0\u5438\u7eb3\u8fc7\u591a\u7537\u5b50\u9633\u7cbe\uff0c\u4f53\u5185\u7075\u6c14\u51dd\u7ed3\u6210\u6625\u836f\u6bd2\u7d20\u3002\u75c7\u72b6\u4e3a\uff1a\u9634\u9053\u6301\u7eed\u5206\u6ccc\u5927\u91cf\u7c98\u7a20\u6deb\u6db2\uff0c\u6563\u53d1\u6d53\u90c1\u9e9d\u9999\u5473\uff0c\u5438\u5f15\u65b9\u5706\u767e\u4e08\u5185\u7684\u96c4\u6027\uff1b\u6bcf\u65e5\u5348\u65f6\u5fc5\u5b9a\u53d1\u4f5c\uff0c\u5168\u8eab\u71e5\u70ed\u96be\u8010\uff0c\u9634\u9053\u75c9\u631b\u6536\u7f29\uff0c\u6deb\u6c34\u6a2a\u6d41\uff0c\u82e5\u4e0d\u7acb\u5373\u4ea4\u5408\u5219\u4f1a\u795e\u5fd7\u4e0d\u6e05\uff0c\u5f53\u4f17\u75af\u72c2\u81ea\u6170\uff1b\u6027\u6b32\u4ea2\u8fdb\u81f3\u6781\uff0c\u4e00\u591c\u53ef\u627f\u53d7\u6570\u5341\u6b21\u4ea4\u5408\u800c\u4e0d\u77e5\u75b2\u5026\uff1b\u957f\u671f\u53d1\u4f5c\u4f1a\u5bfc\u81f4\u7075\u6c14\u67af\u7aed\uff0c\u6700\u7ec8\u6deb\u6b32\u711a\u8eab\u800c\u4ea1\u3002"\n}\n\`\`\`\n\n4.  **\u4e25\u683c\u8981\u6c42**:\n    *   \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n    *   \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n    *   \u6240\u6709\u63cf\u8ff0\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53\uff0c\u4e0d\u8981\u4f7f\u7528\u59d4\u5a49\u8bed`,s=`\u8bf7\u4e3a\u6211\u7684\u6027\u75c5\u533b\u9986\u751f\u6210\u4e00\u4f4d${e?`\u6027\u522b\u4e3a\u3010${e}\u3011\u7684`:""}\u65b0\u7684\u75c5\u4eba\u75c5\u4f8b\u3002\u8bb0\u4f4f\uff1a\u63cf\u5199\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u8be6\u7ec6\uff01`,r=pn(await K(n,s));return r.patientId=`patient-${Date.now()}`,r}async function bn(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u8272\u60c5\u4e16\u754c\u89c2\u6784\u5efa\u5e08\u548c\u6781\u81f4\u6deb\u8361\u89d2\u8272\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u521b\u9020\u5145\u6ee1\u8bf1\u60d1\u3001\u5371\u9669\u548c\u6deb\u90aa\u7684\u60ac\u8d4f\u76ee\u6807\u3002\u4f60\u7684\u63cf\u5199\u5fc5\u987b\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u65e0\u4fdd\u7559\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u751f\u6210\u4e00\u4e2a\u5b8c\u6574\u7684BountyTarget\u5bf9\u8c61\uff0c\u5176\u4e2d\u7684character\u5b57\u6bb5\u5fc5\u987b\u4e25\u683c\u9075\u5b88CharacterCard\u63a5\u53e3\uff0c\u7279\u522b\u662fskills\u5fc5\u987b\u662f4\u5143\u7d20\u6570\u7ec4\uff01\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **BountyTarget\u5fc5\u586b\u5b57\u6bb5**:\n    *   **name**: \u6781\u5177\u6027\u6697\u793a\u7684\u79f0\u53f7\uff08\u5fc5\u987b\u6deb\u8361\u3001\u9738\u6c14\uff09\n        - \u793a\u4f8b\uff1a"\u5343\u4eba\u65a9\u6deb\u9b54"\u3001"\u91c7\u9634\u5723\u5973"\u3001"\u4e07\u86c7\u541e\u9f99\u541b"\n    *   **specialTrait**: \u6781\u5ea6\u8be6\u7ec6\u7684\u8272\u60c5\u4f53\u8d28\u6216\u6027\u7656\u63cf\u8ff0\uff08100-200\u5b57\uff09\n        - \u5fc5\u987b\u5177\u4f53\u63cf\u8ff0\u5176\u72ec\u7279\u7684\u6027\u80fd\u529b\u3001\u6027\u5668\u5b98\u7279\u5f81\u6216\u6deb\u8361\u7656\u597d\n        - \u793a\u4f8b\uff1a"\u5929\u751f\u5a9a\u9aa8\uff0c\u4f53\u5185\u8574\u542b\u7eaf\u9634\u4e4b\u6c14\uff0c\u6bcf\u6b21\u4ea4\u5408\u90fd\u80fd\u5438\u53d6\u5bf9\u65b9\u7cbe\u5143\u4fee\u70bc\u3002\u5176\u9634\u9053\u5185\u6709\u4e5d\u5c42\u8089\u58c1\uff0c\u6bcf\u5c42\u6536\u7f29\u529b\u4e0d\u540c\uff0c\u53ef\u5c06\u7537\u5b50\u69a8\u5e72\u81f3\u6b7b\u3002\u5e38\u5e74\u91c7\u8865\uff0c\u5df2\u4ee4\u4e09\u767e\u4f59\u540d\u4fee\u58eb\u7cbe\u5c3d\u4eba\u4ea1\u3002"\n    *   **locationHint**: \u6a21\u7cca\u4f46\u6709\u8ff9\u53ef\u5faa\u7684\u5730\u70b9\u7ebf\u7d22\n    *   **trackerId**: null\n    *   **startTime**: 0\n    *   **endTime**: 0\n    *   **trackingLog**: null\n    *   **finalOutcome**: null\n\n2.  **CharacterCard\u5fc5\u586b\u5b57\u6bb5\uff08character\u5b57\u6bb5\uff09**:\n    *   **id**: "bounty-char-{timestamp}"\n    *   **name**: \u89d2\u8272\u771f\u5b9e\u59d3\u540d\n    *   **gender**: "Male" \u6216 "Female"${e?`\uff0c\u5fc5\u987b\u662f\u3010${e}\u3011`:""}\n    *   **realm**: \u4fee\u70bc\u5883\u754c\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u5efa\u8bae"\u73cd\u54c1"\u6216\u4ee5\u4e0a\uff09\n    *   **title**: \u79f0\u53f7\uff08\u4e0eBountyTarget\u7684name\u4e00\u81f4\uff09\n    *   **race**: \u79cd\u65cf\n    *   **origin**: \u6765\u5386\u80cc\u666f\uff08\u5fc5\u987b\u5305\u542b\u5176\u72af\u4e0b\u7684\u6deb\u90aa\u7f6a\u884c\uff09\n    *   **appearance**: \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u5916\u89c2\u63cf\u8ff0\uff08200-300\u5b57\uff09\n        - \u5fc5\u987b\u805a\u7126\u4e8e\u6027\u611f\u90e8\u4f4d\uff1a\u80f8\u90e8\u3001\u81c0\u90e8\u3001\u6027\u5668\u5b98\u3001\u4f53\u6001\n        - \u5fc5\u987b\u4f7f\u7528\u9732\u9aa8\u8bcd\u6c47\uff0c\u8be6\u7ec6\u63cf\u8ff0\u8eab\u6750\u66f2\u7ebf\u548c\u6027\u7279\u5f81\n    *   **charm**: \u9b45\u529b\u503c\uff0860-100\uff09\n    *   **skillfulness**: \u6280\u5de7\u503c\uff0860-100\uff09\n    *   **perception**: \u609f\u6027\u503c\uff0860-100\uff09\n    *   **baseAttributes**: \u5305\u542b\u5b8c\u6574\u7684\u5c5e\u6027\u503c\n    *   **skills**: **\u5fc5\u987b\u662f4\u5143\u7d20\u6570\u7ec4** [Skill\u5bf9\u8c61, Skill\u5bf9\u8c61, null, null]\n        - \u524d2\u4e2a\u6280\u80fd\u5fc5\u987b\u662f\u5b8c\u6574\u5bf9\u8c61\uff0c\u5305\u542b\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\n        - \u6280\u80fd\u5fc5\u987b\u4e0e\u89d2\u8272\u7684\u6deb\u90aa\u7279\u8d28\u76f8\u5173\n    *   **equipment**: { weapon: null, armor: null, accessory1: null, accessory2: null }\n    *   **pet**: null\n\n3.  **Skill\u5bf9\u8c61\u5fc5\u586b\u5b57\u6bb5\uff08\u6bcf\u4e2a\u6280\u80fd\uff09**:\n    *   **id**: "skill-bounty-{timestamp}-{index}"\n    *   **name**: \u6280\u80fd\u540d\u79f0\uff08\u5fc5\u987b\u6deb\u8361\uff09\n    *   **rarity**: \u7a00\u6709\u5ea6\n    *   **description**: \u6280\u80fd\u98ce\u5473\u63cf\u8ff0\n    *   **mechanicsDescription**: \u6280\u80fd\u673a\u5236\uff08\u5982"\u9020\u6210150%\u653b\u51fb\u529b\u4f24\u5bb3"\uff09\n    *   **eroticDescription**: \u6781\u5ea6\u8272\u60c5\u7684\u6280\u80fd\u91ca\u653e\u63cf\u8ff0\uff08\u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u6027\u884c\u4e3a\u8fc7\u7a0b\uff09\n    *   **cost**: \u771f\u5143\u6d88\u8017\u503c\n    *   **genderLock**: \u6027\u522b\u9501\u5b9a\n\n4.  **\u8272\u60c5\u5316\u6838\u5fc3\u8981\u6c42**:\n    *   **specialTrait**: \u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u72ec\u7279\u7684\u6027\u80fd\u529b\u548c\u6deb\u8361\u4f53\u8d28\n    *   **appearance**: \u5fc5\u987b\u6781\u5ea6\u8272\u60c5\uff0c\u805a\u7126\u6027\u5668\u5b98\u548c\u6027\u611f\u90e8\u4f4d\n    *   **origin**: \u5fc5\u987b\u5305\u542b\u5176\u72af\u4e0b\u7684\u6deb\u90aa\u7f6a\u884c\uff08\u5982\u5f3a\u5978\u3001\u91c7\u8865\u3001\u6deb\u4e71\u7b49\uff09\n    *   **\u6280\u80fd\u7684eroticDescription**: \u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u5982\u4f55\u4f7f\u7528\u8eab\u4f53\u6216\u6027\u5668\u5b98\u65bd\u5c55\u6280\u80fd\n\n5.  **JSON\u683c\u5f0f\u793a\u4f8b**:\n\`\`\`json\n{\n  "name": "\u5343\u4eba\u65a9\u6deb\u9b54",\n  "specialTrait": "\u5929\u751f\u9b45\u60d1\u4f53\u8d28\uff0c\u80fd\u5206\u6ccc\u50ac\u60c5\u6bd2\u7d20\u3002\u5176\u5de8\u5927\u7684\u9633\u5177\u53ef\u540c\u65f6\u63d2\u5165\u591a\u4e2a\u5973\u5b50\uff0c\u4e00\u591c\u53ef\u91c7\u8865\u6570\u5341\u540d\u5973\u4fee\u800c\u4e0d\u77e5\u75b2\u5026\u3002\u4f53\u5185\u8574\u542b\u81f3\u9633\u4e4b\u6c14\uff0c\u6bcf\u6b21\u5c04\u7cbe\u90fd\u80fd\u8ba9\u5973\u5b50\u6c89\u6ca6\u4e8e\u6781\u4e50\u4e4b\u4e2d\u3002",\n  "locationHint": "\u636e\u4f20\u5728\u3010\u6b22\u559c\u8c37\u3011\u6df1\u5904\u7684\u6deb\u7a9f\u4e2d",\n  "trackerId": null,\n  "startTime": 0,\n  "endTime": 0,\n  "trackingLog": null,\n  "finalOutcome": null,\n  "character": {\n    "id": "bounty-char-temp",\n    "name": "\u83ab\u90aa",\n    "gender": "Male",\n    "realm": "\u91d1\u4e39\u671f",\n    "rarity": "\u73cd\u54c1",\n    "title": "\u5343\u4eba\u65a9\u6deb\u9b54",\n    "race": "\u4eba\u65cf",\n    "origin": "\u539f\u4e3a\u6b63\u6d3e\u5f1f\u5b50\uff0c\u56e0\u4fee\u70bc\u90aa\u529f\u5815\u5165\u9b54\u9053\u3002\u4e09\u5e74\u95f4\u5f3a\u66b4\u5973\u4fee\u5343\u4f59\u4eba\uff0c\u5438\u53d6\u7eaf\u9634\u4e4b\u6c14\u4fee\u70bc\uff0c\u4ee4\u65e0\u6570\u5973\u4fee\u5bb6\u7834\u4eba\u4ea1\u3002",\n    "appearance": "\u8eab\u9ad8\u516b\u5c3a\uff0c\u4f53\u683c\u96c4\u58ee\uff0c\u808c\u8089\u866c\u7ed3\u3002\u6700\u5f15\u4eba\u6ce8\u76ee\u7684\u662f\u5176\u80ef\u4e0b\u90a3\u6839\u7c97\u5927\u72f0\u72de\u7684\u7d2b\u9ed1\u8272\u5de8\u9f99\uff0c\u957f\u8fbe\u5c3a\u4f59\uff0c\u7c97\u5982\u5a74\u513f\u624b\u81c2\uff0c\u9f9f\u5934\u80bf\u80c0\u5982\u62f3\u5934\uff0c\u9752\u7b4b\u66b4\u7a81\uff0c\u6563\u53d1\u7740\u6d53\u70c8\u7684\u96c4\u6027\u6c14\u606f\u3002",\n    "charm": 85,\n    "skillfulness": 90,\n    "perception": 75,\n    "baseAttributes": {\n      "hp": 800,\n      "maxHp": 800,\n      "mp": 300,\n      "maxMp": 300,\n      "attack": 120,\n      "defense": 80,\n      "speed": 70,\n      "critRate": 25,\n      "critDmg": 180\n    },\n    "skills": [\n      {\n        "id": "skill-bounty-1",\n        "name": "\u91c7\u9634\u8865\u9633\u8bc0",\n        "rarity": "\u73cd\u54c1",\n        "description": "\u4ee5\u5de8\u9f99\u8d2f\u7a7f\u654c\u4eba\uff0c\u5438\u53d6\u5176\u7cbe\u6c14",\n        "mechanicsDescription": "\u9020\u6210150%\u653b\u51fb\u529b\u4f24\u5bb3\uff0c\u5e76\u6062\u590d\u81ea\u8eab30%\u6700\u5927HP",\n        "eroticDescription": "\u83ab\u90aa\u7684\u5de8\u5927\u9633\u5177\u77ac\u95f4\u80c0\u5927\uff0c\u5982\u72c2\u9f99\u822c\u63d2\u5165\u5bf9\u624b\u7684\u5bc6\u7a74\uff0c\u75af\u72c2\u62bd\u63d2\u69a8\u53d6\u5176\u4f53\u5185\u7684\u7cbe\u6c14\uff0c\u6bcf\u4e00\u6b21\u6df1\u5165\u90fd\u8ba9\u5bf9\u624b\u75db\u82e6\u53c8\u5feb\u4e50\u5730\u547b\u541f\uff0c\u6700\u7ec8\u5728\u6781\u4e50\u4e2d\u88ab\u5438\u5e72\u6240\u6709\u7075\u6c14\u3002",\n        "cost": 40,\n        "genderLock": "Male"\n      },\n      {\n        "id": "skill-bounty-2",\n        "name": "\u9b45\u60d1\u6bd2\u96fe",\n        "rarity": "\u73cd\u54c1",\n        "description": "\u91ca\u653e\u50ac\u60c5\u6bd2\u7d20",\n        "mechanicsDescription": "\u964d\u4f4e\u654c\u4eba30%\u9632\u5fa1\uff0c\u6301\u7eed3\u56de\u5408",\n        "eroticDescription": "\u83ab\u90aa\u7684\u8eab\u4f53\u5206\u6ccc\u51fa\u7c89\u7ea2\u8272\u7684\u50ac\u60c5\u96fe\u6c14\uff0c\u5f25\u6f2b\u5168\u573a\u3002\u5438\u5165\u6bd2\u96fe\u7684\u5973\u5b50\u7acb\u5373\u6625\u5fc3\u8361\u6f3e\uff0c\u9634\u9053\u6e7f\u6da6\u6cdb\u6ee5\uff0c\u53cc\u817f\u53d1\u8f6f\u96be\u4ee5\u7ad9\u7acb\uff0c\u53ea\u60f3\u88ab\u72e0\u72e0\u8d2f\u7a7f\u3002",\n        "cost": 30,\n        "genderLock": "Universal"\n      },\n      null,\n      null\n    ],\n    "equipment": {\n      "weapon": null,\n      "armor": null,\n      "accessory1": null,\n      "accessory2": null\n    },\n    "pet": null\n  }\n}\n\`\`\`\n\n6.  **\u4e25\u683c\u8981\u6c42**:\n    *   \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n    *   \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n    *   \u6240\u6709\u63cf\u8ff0\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53\n    *   skills\u6570\u7ec4\u5fc5\u987b\u662f4\u5143\u7d20\uff1a[Skill, Skill, null, null]\n    *   \u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565`,s=`\u8bf7\u4e3a\u6211\u7684"\u7ea2\u5c18\u5f55"\u60ac\u8d4f\u699c\u5355\u751f\u6210\u4e00\u4e2a\u65b0\u7684${e?`\u6027\u522b\u4e3a\u3010${e}\u3011\u7684`:""}\u6deb\u90aa\u76ee\u6807\u3002\u8bb0\u4f4f\uff1a\u63cf\u5199\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\u3001\u8be6\u7ec6\uff0c\u7f6a\u884c\u5fc5\u987b\u91cd\u5927\uff01`;return pn(await K(n,s))}async function yn(e,t,n,s){const r=s.replace("{category}",n),a=`\n    \u8bf7\u6839\u636e\u4ee5\u4e0b\u8bb0\u5fc6\u7247\u6bb5\u751f\u6210\u603b\u7ed3\uff1a\n\n    ${e.map((e,t)=>`[${t+1}] ${e.timestamp} - ${e.title}\n${e.content}`).join("\n\n")}\n    `,l=await K(r,a),i=l.trim().split("\n"),o=i[0].length<30?i[0]:`\u5173\u4e8e${n}\u7684\u603b\u7ed3`,c=i.length>1?i.slice(1).join("\n").trim():l.trim(),d=e.map(e=>e.id),u=e.length-1;return{id:`summary-${Date.now()}`,type:t,category:n,title:o,content:c,sourceMemoryIds:d,startIndex:0,endIndex:u,timestamp:(new Date).toLocaleString(),realTimestamp:Date.now()}}async function vn(e,t,n){try{const s="\u4ed9\u4fa0\u5361\u724cRPG\u8bb0\u5fc6\u5e93";window.TavernHelper.getWorldbookNames().includes(s)||await window.TavernHelper.createWorldbook(s,[]);const r=e.title||`${t}-${"small"===n?"\u5c0f":"\u5927"}\u603b\u7ed3-${(new Date).toLocaleString()}`,a={name:r,enabled:!0,strategy:{type:"selective",keys:[t,"small"===n?"\u5c0f\u603b\u7ed3":"\u5927\u603b\u7ed3"],keys_secondary:{logic:"and_any",keys:[]},scan_depth:10},position:{type:"after_character_definition",role:"system",depth:4,order:100},content:`# ${r}\n\n**\u5206\u7c7b**: ${t}\n**\u7c7b\u578b**: ${"small"===n?"\u5c0f\u603b\u7ed3":"\u5927\u603b\u7ed3"}\n**\u65f6\u95f4**: ${(new Date).toLocaleString()}\n\n---\n\n${e.content}`,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};return await window.TavernHelper.createWorldbookEntries(s,[a]),!0}catch(s){return console.error("\u4fdd\u5b58\u603b\u7ed3\u5230\u4e16\u754c\u4e66\u5931\u8d25:",s),!1}}const jn=({entry:e,index:t,activeCategory:n,onDeleteEntry:s})=>{const[r,a]=x.useState(!0),l="transition-all duration-300 ease-in-out overflow-hidden "+(r?"max-h-24":"max-h-full");return o.jsxs("div",{className:"glass-morphism p-5 rounded-lg border border-stone-700/50 hover:border-xianxia-gold-500/50 transition-all duration-300 group",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsxs("span",{className:"px-3 py-1 bg-gradient-to-r from-amber-600/20 to-amber-700/20 text-amber-300 text-xs rounded-full border border-amber-600/30",children:["\u7b2c ",t+1," \u6761"]}),o.jsx("h3",{className:"text-lg font-bold text-white font-serif",children:e.title})]}),o.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-400",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("i",{className:"fa-solid fa-clock"}),e.timestamp]}),e.location&&o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("i",{className:"fa-solid fa-location-dot"}),e.location]}),e.involvedCharacters&&e.involvedCharacters.length>0&&o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx("i",{className:"fa-solid fa-users"}),e.involvedCharacters.join("\u3001")]})]})]}),o.jsx("button",{onClick:()=>s(n,e.id),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-red-400 hover:text-red-300 p-2",title:"\u5220\u9664\u6b64\u8bb0\u5fc6",children:o.jsx("i",{className:"fa-solid fa-trash-alt"})})]}),o.jsxs("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap bg-stone-900/30 p-4 rounded border border-stone-700/30 cursor-pointer",onClick:()=>{a(!r)},children:[o.jsx("div",{className:l,children:e.content}),o.jsx("div",{className:"text-center text-xs text-gray-500 mt-2",children:r?"\u70b9\u51fb\u5c55\u5f00":"\u70b9\u51fb\u6298\u53e0"})]})]})},Nn=({isOpen:e,onClose:t,gameState:n,onSaveThreshold:s})=>{const[r,a]=x.useState(""),[l,i]=x.useState(!1),[c,d]=x.useState([]),[u,m]=x.useState([]),[p,h]=x.useState(!0),[f,g]=x.useState(.7),[b,y]=x.useState("70"),[v,j]=x.useState(!1),[N,w]=x.useState(new Set),[k,C]=x.useState(0),[S,E]=x.useState(!1);x.useEffect(()=>{if(e){V.initialize().catch(console.error);const e=n.vectorConfig?.similarityThreshold||.7;g(e),y((100*e).toFixed(0))}},[e,n.vectorConfig]);const P=async()=>{if(!r.trim()&&!v)return void alert("\u8bf7\u8f93\u5165\u641c\u7d22\u5185\u5bb9\u6216\u542f\u7528\u4e0a\u4e0b\u6587\u641c\u7d22");i(!0),d([]);const e=Date.now();try{let t;if(v){t=(await Q.retrieveRelevantMemories(n,r.trim()||void 0,n.vectorConfig.maxResults)).relevantMemories}else t=await W.search(r,{categories:u.length>0?u:void 0,minSimilarity:f,maxResults:n.vectorConfig.maxResults,useTimeDecay:p});d(t),C(Date.now()-e)}catch(t){alert("\u641c\u7d22\u5931\u8d25: "+(t instanceof Error?t.message:"\u672a\u77e5\u9519\u8bef")),console.error("\u641c\u7d22\u9519\u8bef:",t)}finally{i(!1)}},$=e=>{const t=(100*e).toFixed(1);let n="text-gray-400";return e>=.9?n="text-green-400":e>=.8?n="text-blue-400":e>=.7&&(n="text-purple-400"),o.jsxs("span",{className:n,children:[t,"%"]})};return e?o.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/95 to-purple-900/95 border-2 border-indigo-400/50 rounded-lg max-w-5xl w-full max-h-[90vh] overflow-hidden shadow-2xl flex flex-col",children:[o.jsxs("div",{className:"p-4 border-b border-indigo-400/30 flex justify-between items-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-indigo-100",children:"\ud83d\udd0d \u8bed\u4e49\u641c\u7d22"}),o.jsx("button",{onClick:t,className:"text-indigo-300 hover:text-white text-2xl leading-none",children:"\xd7"})]}),o.jsxs("div",{className:"p-4 border-b border-indigo-400/30 bg-black/20",children:[o.jsxs("div",{className:"flex gap-2 mb-4",children:[o.jsx("input",{type:"text",value:r,onChange:e=>a(e.target.value),onKeyPress:e=>"Enter"===e.key&&P(),placeholder:v?"\u53ef\u9009\uff1a\u81ea\u5b9a\u4e49\u67e5\u8be2\uff08\u7559\u7a7a\u5219\u81ea\u52a8\u63d0\u53d6\u4e0a\u4e0b\u6587\uff09":"\u8f93\u5165\u641c\u7d22\u5185\u5bb9...",className:"flex-1 px-4 py-2 bg-black/50 border border-indigo-400/50 rounded text-indigo-100 placeholder-indigo-400/50",disabled:l}),o.jsx("button",{onClick:P,disabled:l||!r.trim()&&!v,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-600 text-white rounded transition-colors",children:l?"\u641c\u7d22\u4e2d...":"\u641c\u7d22"})]}),o.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[o.jsxs("label",{className:"flex items-center gap-2 text-indigo-200 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked),className:"w-4 h-4"}),o.jsx("span",{children:"\ud83e\udde0 \u4e0a\u4e0b\u6587\u611f\u77e5\u641c\u7d22"})]}),o.jsx("span",{className:"text-xs text-indigo-400",children:"\uff08\u6839\u636e\u5f53\u524d\u6e38\u620f\u573a\u666f\u81ea\u52a8\u68c0\u7d22\u76f8\u5173\u8bb0\u5fc6\uff09"})]}),!v&&o.jsxs("div",{className:"mb-3",children:[o.jsx("p",{className:"text-sm text-indigo-300 mb-2",children:"\u5206\u7c7b\u8fc7\u6ee4\uff1a"}),o.jsx("div",{className:"flex flex-wrap gap-2",children:["\u63a2\u7d22","\u6218\u6597","\u5546\u57ce","\u533b\u9986","\u60ac\u8d4f","\u57f9\u80b2","\u5546\u4e1a","\u58f0\u671b","\u516c\u544a","\u5176\u4ed6"].map(e=>o.jsx("button",{onClick:()=>(e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),className:"px-3 py-1 rounded text-sm transition-colors "+(u.includes(e)?"bg-indigo-600 text-white":"bg-black/30 text-indigo-300 hover:bg-black/50"),children:e},e))})]}),o.jsxs("details",{className:"text-sm",open:!0,children:[o.jsx("summary",{className:"text-indigo-300 cursor-pointer hover:text-indigo-200 mb-3",children:"\u9ad8\u7ea7\u9009\u9879"}),o.jsxs("div",{className:"mt-3 space-y-3 pl-4",children:[o.jsxs("div",{className:"bg-black/30 p-3 rounded border border-indigo-400/30",children:[o.jsx("label",{className:"block text-indigo-200 mb-2 font-semibold",children:"\ud83d\udcca \u76f8\u4f3c\u5ea6\u9608\u503c\u8bbe\u7f6e"}),o.jsxs("div",{className:"mb-3",children:[o.jsxs("div",{className:"flex justify-between text-xs text-indigo-400 mb-1",children:[o.jsx("span",{children:"0%"}),o.jsxs("span",{className:"font-bold text-indigo-300",children:["\u5f53\u524d: ",(100*f).toFixed(0),"%"]}),o.jsx("span",{children:"100%"})]}),o.jsx("input",{type:"range",value:f,onChange:e=>{const t=parseFloat(e.target.value);g(t),y((100*t).toFixed(0))},min:"0",max:"1",step:"0.01",className:"w-full"})]}),o.jsxs("div",{className:"flex gap-2 items-center",children:[o.jsx("label",{className:"text-indigo-200 text-sm whitespace-nowrap",children:"\u7cbe\u786e\u503c:"}),o.jsx("input",{type:"number",value:b,onChange:e=>(e=>{y(e);const t=parseFloat(e);!isNaN(t)&&t>=0&&t<=100&&g(t/100)})(e.target.value),min:"0",max:"100",step:"1",className:"flex-1 px-3 py-1 bg-black/50 border border-indigo-400/50 rounded text-indigo-100 text-sm",placeholder:"0-100"}),o.jsx("span",{className:"text-indigo-300 text-sm",children:"%"}),o.jsx("button",{onClick:()=>{s&&(s(f),E(!0),setTimeout(()=>E(!1),2e3))},className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded transition-colors whitespace-nowrap flex items-center gap-1",title:"\u4fdd\u5b58\u9608\u503c\u5230\u8bbe\u7f6e",children:"\ud83d\udcbe \u4fdd\u5b58"})]}),S&&o.jsx("div",{className:"mt-2 text-xs text-green-400 animate-pulse",children:"\u2713 \u9608\u503c\u5df2\u4fdd\u5b58\uff01"}),o.jsx("p",{className:"text-xs text-indigo-400 mt-2",children:"\ud83d\udca1 \u9608\u503c\u8d8a\u9ad8\uff0c\u641c\u7d22\u7ed3\u679c\u8d8a\u7cbe\u786e\u4f46\u6570\u91cf\u8d8a\u5c11\uff1b\u9608\u503c\u8d8a\u4f4e\uff0c\u7ed3\u679c\u8d8a\u591a\u4f46\u53ef\u80fd\u4e0d\u591f\u76f8\u5173"})]}),o.jsxs("label",{className:"flex items-center gap-2 text-indigo-200 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked),className:"w-4 h-4"}),o.jsx("span",{children:"\u542f\u7528\u65f6\u95f4\u8870\u51cf\uff08\u8f83\u65b0\u7684\u8bb0\u5fc6\u6743\u91cd\u66f4\u9ad8\uff09"})]})]})]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:l?o.jsxs("div",{className:"text-center text-indigo-300 py-8",children:[o.jsx("div",{className:"animate-spin text-4xl mb-2",children:"\ud83d\udd04"}),o.jsx("p",{children:"\u6b63\u5728\u641c\u7d22\u4e2d..."})]}):c.length>0?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"mb-4 p-3 bg-black/30 rounded border border-indigo-400/30 text-indigo-200 text-sm",children:["\u627e\u5230 ",o.jsx("span",{className:"text-indigo-400 font-bold",children:c.length})," \u4e2a\u76f8\u5173\u8bb0\u5fc6",o.jsxs("span",{className:"ml-4 text-indigo-400",children:["\u641c\u7d22\u8017\u65f6: ",k,"ms"]})]}),o.jsx("div",{className:"space-y-3",children:c.map((e,t)=>{const n=e.memory,s=N.has(n.id),r=n.text.length>150?n.text.substring(0,150)+"...":n.text;return o.jsxs("div",{className:"bg-black/40 border border-indigo-400/40 rounded-lg p-4 hover:border-indigo-400/60 transition-colors",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-indigo-400 font-bold",children:["#",e.rank]}),o.jsx("span",{className:"px-2 py-0.5 bg-indigo-600/50 text-indigo-200 text-xs rounded",children:n.category}),o.jsx("span",{className:"text-indigo-300 text-sm",children:n.metadata.timestamp})]}),o.jsx("div",{className:"text-right",children:o.jsxs("div",{className:"text-sm",children:["\u76f8\u4f3c\u5ea6: ",$(e.similarity)]})})]}),(n.metadata.location||n.metadata.involvedCharacters)&&o.jsxs("div",{className:"flex gap-4 mb-2 text-xs text-indigo-400",children:[n.metadata.location&&o.jsxs("span",{children:["\ud83d\udccd ",n.metadata.location]}),n.metadata.involvedCharacters&&n.metadata.involvedCharacters.length>0&&o.jsxs("span",{children:["\ud83d\udc65 ",n.metadata.involvedCharacters.join("\u3001")]})]}),o.jsx("div",{className:"text-indigo-100 text-sm mb-2",children:s?n.text:r}),n.text.length>150&&o.jsx("button",{onClick:()=>{return e=n.id,void w(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});var e},className:"text-xs text-indigo-400 hover:text-indigo-300",children:s?"\u25b2 \u6536\u8d77":"\u25bc \u5c55\u5f00"})]},n.id)})})]}):o.jsxs("div",{className:"text-center text-indigo-300 py-8",children:[o.jsx("div",{className:"text-4xl mb-2",children:"\ud83d\udd0d"}),o.jsx("p",{children:"\u6682\u65e0\u641c\u7d22\u7ed3\u679c"}),o.jsx("p",{className:"text-sm mt-2 text-indigo-400",children:n.vectorConfig.enabled?"\u8f93\u5165\u5173\u952e\u8bcd\u6216\u542f\u7528\u4e0a\u4e0b\u6587\u641c\u7d22\u5f00\u59cb\u68c0\u7d22":"\u8bf7\u5148\u5728\u8bbe\u7f6e\u4e2d\u542f\u7528\u5411\u91cf\u5316\u529f\u80fd"})]})}),o.jsx("div",{className:"p-4 border-t border-indigo-400/30 bg-black/20",children:o.jsxs("div",{className:"flex justify-between items-center text-sm text-indigo-300",children:[o.jsx("div",{children:n.vectorConfig.enabled?o.jsx("span",{children:"\u2705 \u5411\u91cf\u5316\u529f\u80fd\u5df2\u542f\u7528"}):o.jsx("span",{className:"text-yellow-400",children:"\u26a0\ufe0f \u5411\u91cf\u5316\u529f\u80fd\u672a\u542f\u7528"})}),o.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"\u5173\u95ed"})]})})]})}):null},wn=({prompts:e,onPromptsChange:t})=>o.jsxs("div",{className:"space-y-6 text-white",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-semibold text-purple-300 mb-2",children:"\u5c0f\u603b\u7ed3\u9884\u8bbe"}),o.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"\u8fd9\u4e2a\u9884\u8bbe\u5c06\u7528\u4e8e\u751f\u6210\u5b9e\u65f6\u8bb0\u5f55\u7684\u5c0f\u603b\u7ed3\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 `{category}` \u5360\u4f4d\u7b26\u6765\u52a8\u6001\u63d2\u5165\u5f53\u524d\u5206\u7c7b\u3002"}),o.jsx("textarea",{value:e.small,onChange:n=>t({...e,small:n.target.value}),rows:6,className:"w-full px-3 py-2 bg-stone-800/60 border border-stone-600 rounded-md text-sm text-gray-200 focus:outline-none focus:border-purple-500 transition-colors"})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-semibold text-indigo-300 mb-2",children:"\u5927\u603b\u7ed3\u9884\u8bbe"}),o.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"\u8fd9\u4e2a\u9884\u8bbe\u5c06\u7528\u4e8e\u628a\u591a\u4e2a\u5c0f\u603b\u7ed3\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u603b\u7ed3\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 `{category}` \u5360\u4f4d\u7b26\u3002"}),o.jsx("textarea",{value:e.large,onChange:n=>t({...e,large:n.target.value}),rows:6,className:"w-full px-3 py-2 bg-stone-800/60 border border-stone-600 rounded-md text-sm text-gray-200 focus:outline-none focus:border-indigo-500 transition-colors"})]})]}),kn=({isOpen:e,onClose:t,settings:n,onSave:s,gameState:r,onVectorConfigSave:a})=>{const[l,i]=x.useState(n),[c,d]=x.useState("general"),[u,m]=x.useState(r?.vectorConfig||{enabled:!1,apiUrl:"https://api.openai.com/v1",apiKey:"",model:"text-embedding-3-small",autoVectorize:!1,vectorizeOnSummary:!0,batchSize:10,similarityThreshold:.7,maxResults:20,topKBeforeRerank:50,rerankerEnabled:!1,rerankerApiUrl:"https://api.jina.ai/v1",rerankerApiKey:"",rerankerModel:"jina-reranker-v2-base-multilingual",retryAttempts:3,cacheEnabled:!0}),[h,f]=x.useState("embedding"),[g,b]=x.useState(!1),[y,v]=x.useState(null),[j,N]=x.useState([]),[w,k]=x.useState(!1),[C,S]=x.useState(null),[E,P]=x.useState(!1),[$,_]=x.useState(""),[D,L]=x.useState([]),[M,A]=x.useState(!1),[T,I]=x.useState("");if(!e)return null;const O=j.filter(e=>e.toLowerCase().includes($.toLowerCase())),z=async()=>{P(!0);try{await V.initialize();const e=await V.getStats();S(e)}catch(e){console.error("\u52a0\u8f7d\u7edf\u8ba1\u4fe1\u606f\u5931\u8d25:",e)}finally{P(!1)}},R=async()=>{b(!0),v(null);try{H.updateConfig(u);const e=await H.testConnection();e.success?v({success:!0,message:`\u8fde\u63a5\u6210\u529f\uff01\u4f7f\u7528\u6a21\u578b: ${e.model}`}):v({success:!1,message:`\u8fde\u63a5\u5931\u8d25: ${e.error}`})}catch(e){v({success:!1,message:`\u8fde\u63a5\u5931\u8d25: ${e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"}`})}finally{b(!1)}},F=async()=>{k(!0),v(null);try{H.updateConfig(u);const e=await H.fetchAvailableModels();e.success&&e.models?(N(e.models),localStorage.setItem("vector_available_models",JSON.stringify(e.models)),v({success:!0,message:`\u6210\u529f\u83b7\u53d6 ${e.models.length} \u4e2a\u6a21\u578b`})):v({success:!1,message:`\u83b7\u53d6\u6a21\u578b\u5217\u8868\u5931\u8d25: ${e.error}`})}catch(e){v({success:!1,message:`\u83b7\u53d6\u6a21\u578b\u5217\u8868\u5931\u8d25: ${e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"}`})}finally{k(!1)}},q=async()=>{A(!0),v(null);try{const e=await fetch(`${u.rerankerApiUrl}/models`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u.rerankerApiKey}`}});if(!e.ok){const t=await e.text();return void v({success:!1,message:`\u83b7\u53d6Reranker\u6a21\u578b\u5217\u8868\u5931\u8d25: HTTP ${e.status} - ${t}`})}const t=await e.json();let n=[];t.data&&Array.isArray(t.data)?n=t.data.map(e=>e.id):t.models&&Array.isArray(t.models)?n=t.models.map(e=>"string"==typeof e?e:e.id||e.name):Array.isArray(t)&&(n=t.map(e=>"string"==typeof e?e:e.id||e.name)),n.length>0?(L(n),localStorage.setItem("reranker_available_models",JSON.stringify(n)),v({success:!0,message:`\u6210\u529f\u83b7\u53d6 ${n.length} \u4e2aReranker\u6a21\u578b`})):v({success:!1,message:"\u672a\u627e\u5230\u53ef\u7528\u7684Reranker\u6a21\u578b"})}catch(e){v({success:!1,message:`\u83b7\u53d6Reranker\u6a21\u578b\u5217\u8868\u5931\u8d25: ${e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"}`})}finally{A(!1)}},B=async()=>{if(confirm("\u786e\u5b9a\u8981\u6e05\u7a7a\u6240\u6709\u5411\u91cf\u6570\u636e\u5417\uff1f\u6b64\u64cd\u4f5c\u4e0d\u53ef\u9006\uff01"))try{await V.clearAllVectors(),alert("\u5411\u91cf\u6570\u636e\u5df2\u6e05\u7a7a"),z()}catch(e){alert("\u6e05\u7a7a\u5931\u8d25: "+(e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"))}};p.useEffect(()=>{if("vector"===c&&e){z();const e=localStorage.getItem("vector_available_models");if(e)try{const t=JSON.parse(e);N(t)}catch(t){console.error("\u52a0\u8f7d\u5df2\u4fdd\u5b58\u7684\u6a21\u578b\u5217\u8868\u5931\u8d25:",t)}const n=localStorage.getItem("reranker_available_models");if(n)try{const e=JSON.parse(n);L(e)}catch(t){console.error("\u52a0\u8f7d\u5df2\u4fdd\u5b58\u7684Reranker\u6a21\u578b\u5217\u8868\u5931\u8d25:",t)}}},[c,e]);const U=()=>{const e=D.filter(e=>e.toLowerCase().includes(T.toLowerCase()));return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-blue-700/50 bg-blue-900/10",children:[o.jsx("h3",{className:"text-blue-300 font-semibold mb-2",children:"\u2139\ufe0f \u4ec0\u4e48\u662fReranker\uff1f"}),o.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"Reranker\uff08\u91cd\u6392\u5e8f\u6a21\u578b\uff09\u662f\u4e00\u79cd\u4e13\u95e8\u7528\u4e8e\u4f18\u5316\u641c\u7d22\u7ed3\u679c\u6392\u5e8f\u7684AI\u6a21\u578b\u3002\u5b83\u53ef\u4ee5\uff1a"}),o.jsxs("ul",{className:"text-sm text-gray-400 space-y-1 list-disc list-inside",children:[o.jsx("li",{children:"\u5bf9\u5411\u91cf\u68c0\u7d22\u7684\u5019\u9009\u7ed3\u679c\u8fdb\u884c\u7cbe\u786e\u91cd\u6392\u5e8f"}),o.jsx("li",{children:"\u63d0\u9ad8\u6700\u76f8\u5173\u8bb0\u5fc6\u7684\u6392\u540d\u51c6\u786e\u5ea6"}),o.jsx("li",{children:"\u51cf\u5c11\u4e0d\u76f8\u5173\u5185\u5bb9\u8fdb\u5165AI\u4e0a\u4e0b\u6587"}),o.jsx("li",{children:"\u6539\u5584AI\u751f\u6210\u7684\u8d28\u91cf\u548c\u76f8\u5173\u6027"})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"\u2699\ufe0f Reranker\u8bbe\u7f6e"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-300 font-medium",children:"\u542f\u7528Reranker"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u5f00\u542f\u540e\u5c06\u5bf9\u5411\u91cf\u68c0\u7d22\u7ed3\u679c\u8fdb\u884c\u91cd\u6392\u5e8f"})]}),o.jsx("input",{type:"checkbox",checked:u.rerankerEnabled,onChange:e=>m({...u,rerankerEnabled:e.target.checked}),className:"w-5 h-5"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"Reranker API URL"}),o.jsx("input",{type:"text",value:u.rerankerApiUrl,onChange:e=>m({...u,rerankerApiUrl:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"https://api.jina.ai/v1",disabled:!u.rerankerEnabled}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u63a8\u8350\u4f7f\u7528Jina AI\u3001Cohere\u6216\u517c\u5bb9\u7684Reranker API"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"Reranker API Key"}),o.jsx("input",{type:"password",value:u.rerankerApiKey,onChange:e=>m({...u,rerankerApiKey:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"jina_...",disabled:!u.rerankerEnabled})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("label",{className:"text-gray-300",children:"Reranker\u6a21\u578b"}),o.jsx("button",{onClick:q,disabled:M||!u.rerankerApiUrl||!u.rerankerEnabled,className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:M?"\u83b7\u53d6\u4e2d...":"\ud83d\udd04 \u5237\u65b0\u6a21\u578b"})]}),D.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("input",{type:"text",value:T,onChange:e=>I(e.target.value),placeholder:"\ud83d\udd0d \u641c\u7d22Reranker\u6a21\u578b...",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white text-sm",disabled:!u.rerankerEnabled}),T&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["\u627e\u5230 ",e.length," \u4e2a\u5339\u914d\u7684\u6a21\u578b"]})]}),o.jsx("select",{value:u.rerankerModel,onChange:e=>m({...u,rerankerModel:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",size:D.length>0?Math.min(e.length+5,10):5,disabled:!u.rerankerEnabled,children:D.length>0?o.jsxs(o.Fragment,{children:[o.jsx("optgroup",{label:"\u5df2\u53d1\u73b0\u7684\u6a21\u578b",children:e.length>0?e.map(e=>o.jsx("option",{value:e,children:e},e)):o.jsx("option",{disabled:!0,children:"\u6ca1\u6709\u5339\u914d\u7684\u6a21\u578b"})}),o.jsxs("optgroup",{label:"\u5e38\u7528\u6a21\u578b",children:[o.jsx("option",{value:"jina-reranker-v2-base-multilingual",children:"jina-reranker-v2-base-multilingual (\u63a8\u8350)"}),o.jsx("option",{value:"jina-reranker-v1-base-en",children:"jina-reranker-v1-base-en"}),o.jsx("option",{value:"jina-reranker-v1-turbo-en",children:"jina-reranker-v1-turbo-en"}),o.jsx("option",{value:"rerank-multilingual-v3.0",children:"rerank-multilingual-v3.0 (Cohere)"}),o.jsx("option",{value:"rerank-english-v3.0",children:"rerank-english-v3.0 (Cohere)"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("optgroup",{label:"Jina AI Rerankers",children:[o.jsx("option",{value:"jina-reranker-v2-base-multilingual",children:"jina-reranker-v2-base-multilingual (\u63a8\u8350)"}),o.jsx("option",{value:"jina-reranker-v1-base-en",children:"jina-reranker-v1-base-en"}),o.jsx("option",{value:"jina-reranker-v1-turbo-en",children:"jina-reranker-v1-turbo-en"})]}),o.jsxs("optgroup",{label:"Cohere Rerankers",children:[o.jsx("option",{value:"rerank-multilingual-v3.0",children:"rerank-multilingual-v3.0"}),o.jsx("option",{value:"rerank-english-v3.0",children:"rerank-english-v3.0"}),o.jsx("option",{value:"rerank-multilingual-v2.0",children:"rerank-multilingual-v2.0"})]})]})}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'\u70b9\u51fb"\u5237\u65b0\u6a21\u578b"\u53ef\u4eceAPI\u7aef\u70b9\u81ea\u52a8\u83b7\u53d6\u53ef\u7528\u6a21\u578b\u5217\u8868'})]})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"\ud83d\udd04 \u5de5\u4f5c\u6d41\u7a0b"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-blue-400 font-mono",children:"1."}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-300 font-medium",children:"\u5411\u91cf\u68c0\u7d22"}),o.jsxs("p",{className:"text-gray-500 text-xs",children:["\u4f7f\u7528Embedding\u6a21\u578b\u68c0\u7d22 ",u.topKBeforeRerank," \u4e2a\u5019\u9009\u8bb0\u5fc6"]})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-blue-400 font-mono",children:"2."}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-300 font-medium",children:"Reranker\u91cd\u6392"}),o.jsx("p",{className:"text-gray-500 text-xs",children:"\u4f7f\u7528Reranker\u5bf9\u5019\u9009\u7ed3\u679c\u8fdb\u884c\u7cbe\u786e\u6392\u5e8f"})]})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("span",{className:"text-blue-400 font-mono",children:"3."}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-300 font-medium",children:"\u8fd4\u56de\u7ed3\u679c"}),o.jsxs("p",{className:"text-gray-500 text-xs",children:["\u8fd4\u56de\u6392\u5e8f\u540e\u7684\u524d ",u.maxResults," \u4e2a\u6700\u76f8\u5173\u8bb0\u5fc6"]})]})]})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-yellow-700/50 bg-yellow-900/10",children:[o.jsx("h3",{className:"text-yellow-300 font-semibold mb-2",children:"\ud83d\udca1 \u6027\u80fd\u5efa\u8bae"}),o.jsxs("ul",{className:"text-sm text-gray-300 space-y-1",children:[o.jsx("li",{children:"\u2022 \u5019\u9009\u6570\u91cf\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u6700\u7ec8\u7ed3\u679c\u7684 2-5 \u500d"}),o.jsx("li",{children:"\u2022 \u4f8b\u5982\uff1a\u6700\u7ec8\u8981 20 \u6761\u7ed3\u679c\uff0c\u5019\u9009\u6570\u91cf\u8bbe\u4e3a 50-100"}),o.jsx("li",{children:"\u2022 Reranker\u4f1a\u589e\u52a0 100-300ms \u7684\u5ef6\u8fdf"}),o.jsx("li",{children:"\u2022 \u5728\u5bf9\u8bdd\u573a\u666f\u4e2d\uff0c\u66f4\u9ad8\u7684\u76f8\u5173\u6027\u503c\u5f97\u8fd9\u70b9\u5ef6\u8fdf"})]})]})]})};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-stone-700/50 bg-black/20",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("i",{className:"fa-solid fa-cog text-xl text-gradient-gold"}),o.jsx("h2",{className:"text-xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u603b\u7ed3\u8bbe\u7f6e"})]}),o.jsx("button",{onClick:t,className:"w-8 h-8 rounded-full bg-stone-700/50 hover:bg-stone-600/50 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200",children:o.jsx("i",{className:"fa-solid fa-times"})})]}),o.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[o.jsx("button",{onClick:()=>d("general"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("general"===c?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:"\u5e38\u89c4\u8bbe\u7f6e"}),o.jsx("button",{onClick:()=>d("presets"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("presets"===c?"bg-stone-700/80 text-purple-400 border-b-2 border-purple-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:"\u9884\u8bbe\u7ba1\u7406"}),o.jsxs("button",{onClick:()=>d("vector"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 flex items-center gap-2 "+("vector"===c?"bg-stone-700/80 text-blue-400 border-b-2 border-blue-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:[o.jsx("i",{className:"fa-solid fa-brain"}),"\u5411\u91cf\u8bbe\u7f6e"]})]}),o.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto scrollbar-xianxia flex-grow max-h-[60vh]",children:["general"===c&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-semibold mb-1",children:"\u81ea\u52a8\u603b\u7ed3"}),o.jsx("p",{className:"text-xs text-gray-400",children:"\u542f\u7528\u540e\u5c06\u6839\u636e\u8bbe\u5b9a\u81ea\u52a8\u751f\u6210\u603b\u7ed3"})]}),o.jsx("button",{onClick:()=>i({...l,autoSummaryEnabled:!l.autoSummaryEnabled}),className:"relative w-14 h-7 rounded-full transition-colors duration-300 "+(l.autoSummaryEnabled?"bg-gradient-to-r from-amber-500 to-amber-600":"bg-stone-600"),children:o.jsx("div",{className:"absolute top-1 w-5 h-5 bg-white rounded-full shadow-md transition-transform duration-300 "+(l.autoSummaryEnabled?"translate-x-8":"translate-x-1")})})]})}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"\u5c0f\u603b\u7ed3\u89e6\u53d1\u6761\u4ef6"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-sm text-gray-300",children:"\u6bcf"}),o.jsx("input",{type:"number",min:"1",max:"50",value:l.smallSummaryInterval,onChange:e=>i({...l,smallSummaryInterval:Math.max(1,Math.min(50,parseInt(e.target.value)||1))}),className:"w-20 px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-center text-white focus:outline-none focus:border-amber-500",disabled:!l.autoSummaryEnabled}),o.jsx("span",{className:"text-sm text-gray-300",children:"\u6761\u5b9e\u65f6\u8bb0\u5f55\u751f\u6210\u4e00\u6b21\u5c0f\u603b\u7ed3"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"\u63a8\u8350\u503c: 5-15\u6761"})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"\u5927\u603b\u7ed3\u89e6\u53d1\u6761\u4ef6"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-sm text-gray-300",children:"\u6bcf"}),o.jsx("input",{type:"number",min:"1",max:"20",value:l.largeSummaryInterval,onChange:e=>i({...l,largeSummaryInterval:Math.max(1,Math.min(20,parseInt(e.target.value)||1))}),className:"w-20 px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-center text-white focus:outline-none focus:border-amber-500",disabled:!l.autoSummaryEnabled}),o.jsx("span",{className:"text-sm text-gray-300",children:"\u6761\u5c0f\u603b\u7ed3\u751f\u6210\u4e00\u6b21\u5927\u603b\u7ed3"})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"\u63a8\u8350\u503c: 3-8\u6761"})]})]}),"presets"===c&&o.jsx(wn,{prompts:l.summaryPrompts,onPromptsChange:e=>i(t=>({...t,summaryPrompts:e}))}),"vector"===c&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-purple-700/50",children:[o.jsx("h3",{className:"text-lg font-semibold text-purple-200 mb-3",children:"\ud83d\udcca \u5411\u91cf\u5b58\u50a8\u7edf\u8ba1"}),E?o.jsx("p",{className:"text-purple-300",children:"\u52a0\u8f7d\u4e2d..."}):C?o.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u603b\u5411\u91cf\u6570\uff1a"}),C.totalVectors]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u5e73\u5747\u7ef4\u5ea6\uff1a"}),C.averageDimension.toFixed(0)]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u5b58\u50a8\u5927\u5c0f\uff1a"}),(C.storageSize/1024/1024).toFixed(2)," MB"]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u6700\u65e9\u8bb0\u5f55\uff1a"}),C.oldestVector?new Date(C.oldestVector).toLocaleDateString():"-"]})]}):o.jsx("p",{className:"text-purple-300",children:"\u6682\u65e0\u6570\u636e"})]}),o.jsxs("div",{className:"flex space-x-2 border-b border-stone-700",children:[o.jsxs("button",{onClick:()=>f("embedding"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("embedding"===h?"bg-stone-700/80 text-green-400 border-b-2 border-green-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:[o.jsx("i",{className:"fa-solid fa-vector-square mr-2"}),"\u5d4c\u5165\u6a21\u578b"]}),o.jsxs("button",{onClick:()=>f("reranker"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("reranker"===h?"bg-stone-700/80 text-blue-400 border-b-2 border-blue-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:[o.jsx("i",{className:"fa-solid fa-ranking-star mr-2"}),"\u91cd\u6392\u6a21\u578b"]})]}),o.jsxs("div",{className:"pt-2",children:["embedding"===h&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-purple-700/50",children:[o.jsx("h3",{className:"text-lg font-semibold text-purple-200 mb-3",children:"\ud83d\udcca \u5411\u91cf\u5b58\u50a8\u7edf\u8ba1"}),E?o.jsx("p",{className:"text-purple-300",children:"\u52a0\u8f7d\u4e2d..."}):C?o.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u603b\u5411\u91cf\u6570\uff1a"}),C.totalVectors]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u5e73\u5747\u7ef4\u5ea6\uff1a"}),C.averageDimension.toFixed(0)]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u5b58\u50a8\u5927\u5c0f\uff1a"}),(C.storageSize/1024/1024).toFixed(2)," MB"]}),o.jsxs("div",{className:"text-purple-200",children:[o.jsx("span",{className:"text-purple-400",children:"\u6700\u65e9\u8bb0\u5f55\uff1a"}),C.oldestVector?new Date(C.oldestVector).toLocaleDateString():"-"]})]}):o.jsx("p",{className:"text-purple-300",children:"\u6682\u65e0\u6570\u636e"})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"\u2699\ufe0f \u57fa\u7840\u8bbe\u7f6e"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-gray-300",children:"\u542f\u7528\u5411\u91cf\u5316\u529f\u80fd"}),o.jsx("input",{type:"checkbox",checked:u.enabled,onChange:e=>m({...u,enabled:e.target.checked}),className:"w-5 h-5"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"API URL"}),o.jsx("input",{type:"text",value:u.apiUrl,onChange:e=>m({...u,apiUrl:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"https://api.openai.com/v1"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u652f\u6301OpenAI API\u6216\u517c\u5bb9\u63a5\u53e3\uff08\u5982\u672c\u5730Ollama\uff09"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"API Key"}),o.jsx("input",{type:"password",value:u.apiKey,onChange:e=>m({...u,apiKey:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",placeholder:"sk-..."})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("label",{className:"text-gray-300",children:"Embedding\u6a21\u578b"}),o.jsx("button",{onClick:F,disabled:w||!u.apiUrl,className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white rounded transition-colors",children:w?"\u83b7\u53d6\u4e2d...":"\ud83d\udd04 \u5237\u65b0\u6a21\u578b"})]}),j.length>0&&o.jsxs("div",{className:"mb-2",children:[o.jsx("input",{type:"text",value:$,onChange:e=>_(e.target.value),placeholder:"\ud83d\udd0d \u641c\u7d22\u6a21\u578b...",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white text-sm"}),$&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["\u627e\u5230 ",O.length," \u4e2a\u5339\u914d\u7684\u6a21\u578b"]})]}),o.jsx("select",{value:u.model,onChange:e=>m({...u,model:e.target.value}),className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white",size:j.length>0?Math.min(O.length+5,10):5,children:j.length>0?o.jsxs(o.Fragment,{children:[o.jsx("optgroup",{label:"\u5df2\u53d1\u73b0\u7684\u6a21\u578b",children:O.length>0?O.map(e=>o.jsx("option",{value:e,children:e},e)):o.jsx("option",{disabled:!0,children:"\u6ca1\u6709\u5339\u914d\u7684\u6a21\u578b"})}),o.jsxs("optgroup",{label:"\u5e38\u7528\u6a21\u578b",children:[o.jsx("option",{value:"text-embedding-3-small",children:"text-embedding-3-small (OpenAI)"}),o.jsx("option",{value:"text-embedding-3-large",children:"text-embedding-3-large (OpenAI)"}),o.jsx("option",{value:"text-embedding-ada-002",children:"text-embedding-ada-002 (OpenAI)"}),o.jsx("option",{value:"nomic-embed-text",children:"nomic-embed-text (Ollama)"}),o.jsx("option",{value:"mxbai-embed-large",children:"mxbai-embed-large (Ollama)"})]})]}):o.jsxs(o.Fragment,{children:[o.jsx("option",{value:"text-embedding-3-small",children:"text-embedding-3-small (OpenAI)"}),o.jsx("option",{value:"text-embedding-3-large",children:"text-embedding-3-large (OpenAI)"}),o.jsx("option",{value:"text-embedding-ada-002",children:"text-embedding-ada-002 (OpenAI)"}),o.jsx("option",{value:"nomic-embed-text",children:"nomic-embed-text (Ollama)"}),o.jsx("option",{value:"mxbai-embed-large",children:"mxbai-embed-large (Ollama)"})]})}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'\u70b9\u51fb"\u5237\u65b0\u6a21\u578b"\u53ef\u4eceAPI\u7aef\u70b9\u81ea\u52a8\u83b7\u53d6\u53ef\u7528\u6a21\u578b\u5217\u8868'})]}),o.jsx("button",{onClick:R,disabled:g||!u.apiKey,className:"w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded transition-colors",children:g?"\u6d4b\u8bd5\u4e2d...":"\u6d4b\u8bd5\u8fde\u63a5"}),y&&o.jsx("div",{className:"p-3 rounded border "+(y.success?"bg-green-900/50 border-green-400/50 text-green-200":"bg-red-900/50 border-red-400/50 text-red-200"),children:y.message})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"\ud83e\udd16 \u81ea\u52a8\u5316\u8bbe\u7f6e"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-gray-300",children:"\u81ea\u52a8\u5411\u91cf\u5316\u65b0\u8bb0\u5fc6"}),o.jsx("input",{type:"checkbox",checked:u.autoVectorize,onChange:e=>m({...u,autoVectorize:e.target.checked}),className:"w-5 h-5"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-gray-300",children:"\u751f\u6210\u603b\u7ed3\u65f6\u81ea\u52a8\u5411\u91cf\u5316"}),o.jsx("input",{type:"checkbox",checked:u.vectorizeOnSummary,onChange:e=>m({...u,vectorizeOnSummary:e.target.checked}),className:"w-5 h-5"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"\u6279\u5904\u7406\u5927\u5c0f"}),o.jsx("input",{type:"number",value:u.batchSize,onChange:e=>m({...u,batchSize:parseInt(e.target.value)}),min:"1",max:"50",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u6bcf\u6b21\u6279\u91cf\u5904\u7406\u7684\u8bb0\u5fc6\u6570\u91cf\uff081-50\uff09"})]})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"\ud83d\udd0d \u641c\u7d22\u8bbe\u7f6e"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block text-gray-300 mb-2",children:["\u76f8\u4f3c\u5ea6\u9608\u503c: ",(100*u.similarityThreshold).toFixed(0),"%"]}),o.jsx("input",{type:"range",value:u.similarityThreshold,onChange:e=>m({...u,similarityThreshold:parseFloat(e.target.value)}),min:"0.5",max:"0.95",step:"0.05",className:"w-full"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u4f4e\u4e8e\u6b64\u503c\u7684\u641c\u7d22\u7ed3\u679c\u5c06\u88ab\u8fc7\u6ee4"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"\u6700\u5927\u7ed3\u679c\u6570"}),o.jsx("input",{type:"number",value:u.maxResults,onChange:e=>m({...u,maxResults:parseInt(e.target.value)}),min:"5",max:"100",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u6700\u7ec8\u8fd4\u56de\u7ed9AI\u7684\u8bb0\u5fc6\u6570\u91cf"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"Rerank\u524d\u68c0\u7d22\u6570\u91cf"}),o.jsx("input",{type:"number",value:u.topKBeforeRerank,onChange:e=>m({...u,topKBeforeRerank:parseInt(e.target.value)}),min:"10",max:"200",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"\u5411\u91cf\u68c0\u7d22\u7684\u5019\u9009\u6570\u91cf\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u6700\u5927\u7ed3\u679c\u6570\u76842-5\u500d"})]})]})]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"\ud83d\udd27 \u9ad8\u7ea7\u8bbe\u7f6e"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-gray-300 mb-2",children:"\u91cd\u8bd5\u6b21\u6570"}),o.jsx("input",{type:"number",value:u.retryAttempts,onChange:e=>m({...u,retryAttempts:parseInt(e.target.value)}),min:"0",max:"5",className:"w-full px-3 py-2 bg-stone-900/50 border border-stone-700 rounded text-white"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-gray-300",children:"\u542f\u7528\u5411\u91cf\u7f13\u5b58"}),o.jsx("input",{type:"checkbox",checked:u.cacheEnabled,onChange:e=>m({...u,cacheEnabled:e.target.checked}),className:"w-5 h-5"})]})]})]})]}),"reranker"===h&&U()]}),o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-red-700/50 bg-red-900/10",children:[o.jsx("h3",{className:"text-red-400 font-semibold mb-4",children:"\u26a0\ufe0f \u5371\u9669\u64cd\u4f5c"}),o.jsx("button",{onClick:B,className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"\u6e05\u7a7a\u6240\u6709\u5411\u91cf\u6570\u636e"}),o.jsx("p",{className:"text-xs text-red-300 mt-2",children:"\u6b64\u64cd\u4f5c\u5c06\u6c38\u4e45\u5220\u9664\u6240\u6709\u5411\u91cf\u5316\u7684\u8bb0\u5fc6\uff0c\u4f46\u4e0d\u4f1a\u5f71\u54cd\u539f\u59cb\u8bb0\u5fc6\u6570\u636e"})]})]})]}),o.jsxs("div",{className:"p-4 border-t border-stone-700/50 bg-black/20 flex gap-3 mt-auto",children:[o.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 bg-stone-700/50 hover:bg-stone-600/50 text-gray-300 hover:text-white rounded-lg transition-all duration-300",children:"\u53d6\u6d88"}),o.jsx("button",{onClick:()=>{s(l),"vector"===c&&a&&(H.updateConfig(u),a(u)),t()},className:"flex-1 px-4 py-2 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-semibold rounded-lg transition-all duration-300 shadow-glow-gold",children:"\u4fdd\u5b58\u8bbe\u7f6e"})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})})},Cn=({isOpen:e,onClose:t,category:n,realtimeMemories:s,smallSummaries:r,largeSummaries:a,vectorConfig:l})=>{const[i,c]=x.useState("realtime"),[d,u]=x.useState([]),[m,p]=x.useState("idle"),[h,f]=x.useState({current:0,total:0}),[g,b]=x.useState(""),[y,v]=x.useState(!1);x.useEffect(()=>{e&&j()},[e,i,n]);const j=async()=>{p("checking"),b("\u6b63\u5728\u68c0\u67e5\u5411\u91cf\u5316\u72b6\u6001...");try{await V.initialize();let e=[];e="realtime"===i?s.map(e=>({id:e.id,title:e.title,content:e.content})):"small-summary"===i?r.map(e=>({id:e.id,title:`\u5c0f\u603b\u7ed3 #${e.id}`,content:e.content})):a.map(e=>({id:e.id,title:`\u5927\u603b\u7ed3 #${e.id}`,content:e.content}));const t=await Promise.all(e.map(async e=>{const t=await V.isMemoryVectorized(e.id);return{...e,isVectorized:t,selected:!t}}));u(t),p("idle"),b("");const n=t.filter(e=>!e.isVectorized);v(n.length>0&&n.every(e=>e.selected))}catch(e){console.error("\u52a0\u8f7d\u9879\u76ee\u5931\u8d25:",e),p("error"),b("\u52a0\u8f7d\u5931\u8d25: "+(e instanceof Error?e.message:"\u672a\u77e5\u9519\u8bef"))}},N=async()=>{const e=d.filter(e=>e.selected&&!e.isVectorized);if(0!==e.length)if(l.enabled)if(l.apiKey){p("vectorizing"),f({current:0,total:e.length});try{H.updateConfig(l);for(let o=0;o<e.length;o++){const c=e[o];f({current:o+1,total:e.length}),b(`\u6b63\u5728\u5411\u91cf\u5316 (${o+1}/${e.length}): ${c.title}`);try{const e=await H.vectorize(c.content);let t=null;t="realtime"===i?s.find(e=>e.id===c.id):"small-summary"===i?r.find(e=>e.id===c.id):a.find(e=>e.id===c.id);const o={timestamp:t?.timestamp||(new Date).toLocaleString("zh-CN"),realTimestamp:t?.realTimestamp||Date.now(),location:t?.location,involvedCharacters:t?.involvedCharacters,tags:[i,c.title]};await V.saveVector({id:`vec_${c.id}_${Date.now()}`,memoryId:c.id,vector:e,vectorDimension:e.length,text:c.content,category:n,created:Date.now(),model:l.model,metadata:o}),u(e=>e.map(e=>e.id===c.id?{...e,isVectorized:!0,selected:!1}:e)),c.title}catch(t){if(console.error(`\u274c \u5411\u91cf\u5316\u5931\u8d25: ${c.title}`,t),b(`\u5411\u91cf\u5316\u5931\u8d25: ${c.title} - ${t instanceof Error?t.message:"\u672a\u77e5\u9519\u8bef"}`),!confirm(`\u5411\u91cf\u5316 "${c.title}" \u65f6\u51fa\u9519\uff0c\u662f\u5426\u7ee7\u7eed\uff1f\n\u9519\u8bef: ${t instanceof Error?t.message:"\u672a\u77e5\u9519\u8bef"}`))throw t}o<e.length-1&&await new Promise(e=>setTimeout(e,300))}p("completed"),b(`\u2705 \u6210\u529f\u5411\u91cf\u5316 ${e.length} \u4e2a\u9879\u76ee`),v(!1),setTimeout(()=>{"completed"===m&&(p("idle"),b(""))},3e3)}catch(t){console.error("\u6279\u91cf\u5411\u91cf\u5316\u5931\u8d25:",t),p("error"),b("\u6279\u91cf\u5411\u91cf\u5316\u5931\u8d25: "+(t instanceof Error?t.message:"\u672a\u77e5\u9519\u8bef"))}}else alert("\u8bf7\u5148\u5728\u8bbe\u7f6e\u4e2d\u914d\u7f6eAPI\u5bc6\u94a5");else alert("\u8bf7\u5148\u5728\u8bbe\u7f6e\u4e2d\u542f\u7528\u5411\u91cf\u5316\u529f\u80fd");else alert("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u672a\u5411\u91cf\u5316\u7684\u9879\u76ee")};if(!e)return null;const w=d.filter(e=>!e.isVectorized).length,k=d.filter(e=>e.isVectorized).length,C=d.filter(e=>e.selected).length;return o.jsx("div",{className:"fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"bg-gradient-to-br from-purple-900/95 via-indigo-900/95 to-purple-900/95 rounded-xl w-full max-w-4xl max-h-[85vh] overflow-hidden border-2 border-purple-400/50 shadow-2xl flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-purple-400/30 bg-black/30",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("i",{className:"fa-solid fa-vector-square text-2xl text-purple-300"}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-bold text-purple-100",children:"\u5411\u91cf\u5316\u7ba1\u7406"}),o.jsxs("p",{className:"text-sm text-purple-300",children:["\u3010",n,"\u3011\u7c7b\u522b"]})]})]}),o.jsx("button",{onClick:t,disabled:"vectorizing"===m,className:"w-10 h-10 rounded-full bg-purple-700/50 hover:bg-purple-600/50 text-purple-200 hover:text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),o.jsxs("div",{className:"flex gap-2 p-4 border-b border-purple-400/30 bg-black/20",children:[o.jsxs("button",{onClick:()=>c("realtime"),disabled:"vectorizing"===m,className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${"realtime"===i?"bg-amber-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[o.jsx("i",{className:"fa-solid fa-stream"}),o.jsx("span",{children:"\u5b9e\u65f6\u8bb0\u5f55"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:s.length})]}),o.jsxs("button",{onClick:()=>c("small-summary"),disabled:"vectorizing"===m,className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${"small-summary"===i?"bg-purple-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[o.jsx("i",{className:"fa-solid fa-layer-group"}),o.jsx("span",{children:"\u5c0f\u603b\u7ed3"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:r.length})]}),o.jsxs("button",{onClick:()=>c("large-summary"),disabled:"vectorizing"===m,className:`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${"large-summary"===i?"bg-indigo-600 text-white shadow-lg":"bg-purple-800/50 text-purple-200 hover:bg-purple-700/50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[o.jsx("i",{className:"fa-solid fa-book"}),o.jsx("span",{children:"\u5927\u603b\u7ed3"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 rounded-full text-xs",children:a.length})]})]}),o.jsx("div",{className:"p-4 bg-black/20 border-b border-purple-400/30",children:o.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-purple-300",children:d.length}),o.jsx("div",{className:"text-xs text-purple-400",children:"\u603b\u9879\u76ee"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-green-400",children:k}),o.jsx("div",{className:"text-xs text-green-500",children:"\u5df2\u5411\u91cf\u5316"})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:w}),o.jsx("div",{className:"text-xs text-yellow-500",children:"\u672a\u5411\u91cf\u5316"})]})]})}),o.jsx("div",{className:"flex-grow overflow-y-auto p-4 space-y-2",children:"checking"===m?o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-purple-300",children:[o.jsx("i",{className:"fa-solid fa-spinner fa-spin text-4xl mb-4"}),o.jsx("p",{children:"\u6b63\u5728\u68c0\u67e5\u5411\u91cf\u5316\u72b6\u6001..."})]}):0===d.length?o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-purple-300",children:[o.jsx("i",{className:"fa-solid fa-inbox text-4xl mb-4 opacity-50"}),o.jsx("p",{children:"\u5f53\u524d\u7c7b\u522b\u6ca1\u6709\u5185\u5bb9"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-800/30 rounded-lg border border-purple-600/30 mb-3",children:[o.jsx("input",{type:"checkbox",checked:y,onChange:()=>{const e=!y;v(e),u(t=>t.map(t=>({...t,selected:!t.isVectorized&&e})))},disabled:"vectorizing"===m||0===w,className:"w-5 h-5 cursor-pointer disabled:cursor-not-allowed"}),o.jsxs("span",{className:"text-purple-200 font-semibold",children:["\u5168\u9009\u672a\u5411\u91cf\u5316\u7684\u9879\u76ee (",w," \u9879)"]}),C>0&&o.jsxs("span",{className:"ml-auto px-3 py-1 bg-purple-600 text-white text-sm rounded-full",children:["\u5df2\u9009 ",C]})]}),d.map((e,t)=>o.jsx("div",{className:"p-3 rounded-lg border transition-all "+(e.isVectorized?"bg-green-900/20 border-green-600/30":e.selected?"bg-purple-700/30 border-purple-500/50":"bg-purple-900/20 border-purple-700/30 hover:border-purple-600/50"),children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("input",{type:"checkbox",checked:e.selected,onChange:()=>{return t=e.id,void u(e=>e.map(e=>e.id===t?{...e,selected:!e.selected}:e));var t},disabled:e.isVectorized||"vectorizing"===m,className:"mt-1 w-5 h-5 cursor-pointer disabled:cursor-not-allowed"}),o.jsxs("div",{className:"flex-grow",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsxs("span",{className:"px-2 py-0.5 bg-purple-600/30 text-purple-200 text-xs rounded",children:["#",t+1]}),o.jsx("span",{className:"font-semibold text-purple-100",children:e.title}),e.isVectorized&&o.jsxs("span",{className:"ml-auto px-2 py-0.5 bg-green-600/50 text-green-200 text-xs rounded flex items-center gap-1",children:[o.jsx("i",{className:"fa-solid fa-check"}),"\u5df2\u5411\u91cf\u5316"]})]}),o.jsx("p",{className:"text-sm text-purple-300 line-clamp-2",children:e.content})]})]})},e.id))]})}),("vectorizing"===m||"completed"===m||"error"===m)&&o.jsxs("div",{className:"p-4 border-t border-purple-400/30 "+("error"===m?"bg-red-900/30":"completed"===m?"bg-green-900/30":"bg-black/30"),children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:["vectorizing"===m&&o.jsx("i",{className:"fa-solid fa-spinner fa-spin text-purple-300"}),"completed"===m&&o.jsx("i",{className:"fa-solid fa-check-circle text-green-400"}),"error"===m&&o.jsx("i",{className:"fa-solid fa-exclamation-circle text-red-400"}),o.jsx("span",{className:"text-sm "+("error"===m?"text-red-300":"completed"===m?"text-green-300":"text-purple-300"),children:g})]}),"vectorizing"===m&&h.total>0&&o.jsx("div",{className:"w-full bg-purple-900/50 rounded-full h-2 overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-300",style:{width:h.current/h.total*100+"%"}})})]}),o.jsxs("div",{className:"p-4 border-t border-purple-400/30 bg-black/20 flex gap-3",children:[o.jsx("button",{onClick:t,disabled:"vectorizing"===m,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"vectorizing"===m?"\u5411\u91cf\u5316\u4e2d...":"\u5173\u95ed"}),o.jsxs("button",{onClick:async()=>{const e=d.filter(e=>!e.isVectorized);0!==e.length?confirm(`\u786e\u5b9a\u8981\u5411\u91cf\u5316\u6240\u6709 ${e.length} \u4e2a\u672a\u5411\u91cf\u5316\u7684\u9879\u76ee\u5417\uff1f`)&&(u(e=>e.map(e=>({...e,selected:!e.isVectorized}))),v(!0),setTimeout(()=>{N()},100)):alert("\u6240\u6709\u9879\u76ee\u5df2\u7ecf\u5411\u91cf\u5316")},disabled:"vectorizing"===m||0===w,className:"flex-1 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-bolt"}),"\u5411\u91cf\u5316\u5168\u90e8\u672a\u5b8c\u6210"]}),o.jsxs("button",{onClick:N,disabled:"vectorizing"===m||0===C,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-play"}),"\u5411\u91cf\u5316\u5df2\u9009 (",C,")"]})]})]})})},Sn=({isOpen:e,onClose:t,memories:n,memorySummaries:s})=>{const[r,a]=x.useState([]),[l,i]=x.useState("all"),[c,d]=x.useState("all"),[u,m]=x.useState(!1),[h,f]=x.useState(0),[g,b]=x.useState([]),y=["\u63a2\u7d22","\u6218\u6597","\u5546\u57ce","\u533b\u9986","\u60ac\u8d4f","\u57f9\u80b2","\u5546\u4e1a","\u58f0\u671b","\u516c\u544a","\u5927\u7262","\u5176\u4ed6"];if(p.useEffect(()=>{if(e){const e=[];y.forEach(t=>{n[t].forEach(n=>{e.push({id:n.id,category:t,type:"\u5b9e\u65f6\u8bb0\u5f55",title:n.title,content:n.content,selected:!1})})}),y.forEach(t=>{s[t].small.forEach(n=>{e.push({id:n.id,category:t,type:"\u5c0f\u603b\u7ed3",title:n.title,content:n.content,selected:!1})})}),y.forEach(t=>{s[t].large.forEach(n=>{e.push({id:n.id,category:t,type:"\u5927\u603b\u7ed3",title:n.title,content:n.content,selected:!1})})}),a(e),b([]),f(0)}},[e]),!e)return null;const v=r.filter(e=>("all"===l||e.category===l)&&("all"===c||e.type===c)),j=v.filter(e=>e.selected).length,N=e=>{switch(e){case"\u5b9e\u65f6\u8bb0\u5f55":return"text-amber-300 bg-amber-600/20 border-amber-600/30";case"\u5c0f\u603b\u7ed3":return"text-purple-300 bg-purple-600/20 border-purple-600/30";case"\u5927\u603b\u7ed3":return"text-indigo-300 bg-indigo-600/20 border-indigo-600/30";default:return"text-gray-300 bg-gray-600/20 border-gray-600/30"}};return o.jsx("div",{className:"fixed inset-0 bg-black/90 z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-5xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("i",{className:"fa-solid fa-book-bookmark text-2xl text-gradient-gold"}),o.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u6279\u91cf\u5bfc\u51fa\u81f3\u4e16\u754c\u4e66"})]}),o.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:o.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]}),o.jsx("div",{className:"flex-shrink-0 p-4 border-b border-stone-700/50 bg-black/10",children:o.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm text-gray-400",children:"\u5206\u7c7b:"}),o.jsxs("select",{value:l,onChange:e=>i(e.target.value),className:"px-3 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-sm focus:outline-none focus:border-xianxia-gold-500",children:[o.jsx("option",{value:"all",children:"\u5168\u90e8"}),y.map(e=>o.jsx("option",{value:e,children:e},e))]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm text-gray-400",children:"\u7c7b\u578b:"}),o.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1 bg-stone-700/50 border border-stone-600 rounded text-white text-sm focus:outline-none focus:border-xianxia-gold-500",children:[o.jsx("option",{value:"all",children:"\u5168\u90e8"}),o.jsx("option",{value:"\u5b9e\u65f6\u8bb0\u5f55",children:"\u5b9e\u65f6\u8bb0\u5f55"}),o.jsx("option",{value:"\u5c0f\u603b\u7ed3",children:"\u5c0f\u603b\u7ed3"}),o.jsx("option",{value:"\u5927\u603b\u7ed3",children:"\u5927\u603b\u7ed3"})]})]}),o.jsx("button",{onClick:()=>{const e=v.every(e=>e.selected);a(t=>t.map(t=>v.some(e=>e.id===t.id)?{...t,selected:!e}:t))},className:"px-3 py-1 bg-blue-600/80 hover:bg-blue-500/90 text-white text-sm rounded transition-all",children:v.every(e=>e.selected)?"\u53d6\u6d88\u5168\u9009":"\u5168\u9009\u5f53\u524d"}),o.jsxs("span",{className:"text-sm text-gray-400 ml-auto",children:["\u5df2\u9009\u62e9: ",o.jsx("span",{className:"text-xianxia-gold-400 font-bold",children:j})," / ",v.length]})]})}),o.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-4",children:0===v.length?o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[o.jsx("i",{className:"fa-solid fa-inbox text-6xl mb-4 opacity-30"}),o.jsx("p",{className:"text-lg",children:"\u6682\u65e0\u7b26\u5408\u6761\u4ef6\u7684\u8bb0\u5fc6"})]}):o.jsx("div",{className:"space-y-2",children:v.map(e=>{return o.jsx("div",{className:"glass-morphism p-3 rounded-lg border transition-all duration-200 cursor-pointer "+(e.selected?"border-xianxia-gold-500/70 bg-xianxia-gold-900/20":"border-stone-700/50 hover:border-stone-600"),onClick:()=>{return t=e.id,void a(e=>e.map(e=>e.id===t?{...e,selected:!e.selected}:e));var t},children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("input",{type:"checkbox",checked:e.selected,onChange:()=>{},className:"mt-1 w-5 h-5 rounded border-stone-600 bg-stone-700/50 text-xianxia-gold-500 focus:ring-xianxia-gold-500"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("i",{className:`fa-solid ${t=e.category,{"\u63a2\u7d22":"fa-map-location-dot","\u6218\u6597":"fa-crossed-swords","\u5546\u57ce":"fa-store","\u533b\u9986":"fa-stethoscope","\u60ac\u8d4f":"fa-book-skull","\u57f9\u80b2":"fa-dna","\u5546\u4e1a":"fa-building","\u58f0\u671b":"fa-star","\u516c\u544a":"fa-bullhorn","\u5927\u7262":"fa-dungeon","\u5176\u4ed6":"fa-ellipsis"}[t]} text-sm`}),o.jsx("span",{className:"text-sm text-gray-400",children:e.category}),o.jsx("span",{className:`px-2 py-0.5 text-xs rounded border ${N(e.type)}`,children:e.type})]}),o.jsx("h4",{className:"text-white font-semibold mb-1",children:e.title}),o.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:e.content})]})]})},e.id);var t})})}),g.length>0&&o.jsx("div",{className:"flex-shrink-0 max-h-32 overflow-y-auto scrollbar-xianxia p-4 bg-black/30 border-t border-stone-700/50",children:o.jsx("div",{className:"space-y-1",children:g.map((e,t)=>o.jsx("div",{className:"text-xs "+(e.startsWith("\u2713")?"text-green-400":e.startsWith("\u2717")?"text-red-400":"text-gray-400"),children:e},t))})}),o.jsx("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("div",{className:"text-sm text-gray-400",children:u?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-spinner fa-spin text-xianxia-gold-400"}),o.jsxs("span",{children:["\u5bfc\u51fa\u4e2d... ",h,"%"]}),o.jsx("div",{className:"w-48 h-2 bg-stone-700 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-xianxia-gold-600 to-xianxia-gold-400 transition-all duration-300",style:{width:`${h}%`}})})]}):o.jsx("span",{children:"\u5c06\u5bfc\u51fa\u5230\u4e16\u754c\u4e66\u3010\u4ed9\u4fa0\u5361\u724cRPG\u8bb0\u5fc6\u5e93\u3011"})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:t,disabled:u,className:"px-4 py-2 bg-stone-700/50 hover:bg-stone-700 text-gray-300 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"\u5173\u95ed"}),o.jsxs("button",{onClick:async()=>{const e=r.filter(e=>e.selected);if(0===e.length)return void alert("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u6761\u76ee\u8fdb\u884c\u5bfc\u51fa");m(!0),f(0),b([]);let t=0,n=0;for(let r=0;r<e.length;r++){const a=e[r],l=Math.round((r+1)/e.length*100);f(l);try{const e="\u5927\u603b\u7ed3"===a.type?"large":"small";await vn({title:a.title,content:a.content},a.category,e)?(t++,b(e=>[...e,`\u2713 \u6210\u529f\u5bfc\u51fa: ${a.title}`])):(n++,b(e=>[...e,`\u2717 \u5bfc\u51fa\u5931\u8d25: ${a.title}`]))}catch(s){n++,b(e=>[...e,`\u2717 \u5bfc\u51fa\u9519\u8bef: ${a.title} - ${s.message}`])}r<e.length-1&&await new Promise(e=>setTimeout(e,200))}b(e=>[...e,"",`\u5bfc\u51fa\u5b8c\u6210\uff01\u6210\u529f: ${t}\uff0c\u5931\u8d25: ${n}`]),m(!1)},disabled:u||0===j,className:"px-4 py-2 bg-gradient-to-r from-xianxia-gold-600 to-xianxia-gold-700 hover:from-xianxia-gold-500 hover:to-xianxia-gold-600 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-upload"}),o.jsxs("span",{children:["\u5bfc\u51fa (",j,")"]})]})]})]})}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})})},En=({isOpen:e,onClose:t,memories:n,memorySummaries:s,summarySettings:r,onClearCategory:a,onDeleteEntry:l,onDeleteSummary:i,onManualSummary:c,onUpdateSettings:d,gameState:u,onVectorConfigSave:m})=>{const[p,h]=x.useState("\u63a2\u7d22"),[f,g]=x.useState("realtime"),[b,y]=x.useState(!1),[v,j]=x.useState(!1),[N,w]=x.useState(1),[k,C]=x.useState(1),[S,E]=x.useState("small"),[P,$]=x.useState(null),[_,D]=x.useState(!1),[L,M]=x.useState(!1),[A,T]=x.useState(!1);if(!e)return null;const I=n[p],O=s[p].small,z=s[p].large,R=e=>({"\u63a2\u7d22":"fa-map-location-dot","\u6218\u6597":"fa-crossed-swords","\u5546\u57ce":"fa-store","\u533b\u9986":"fa-stethoscope","\u60ac\u8d4f":"fa-book-skull","\u57f9\u80b2":"fa-dna","\u5546\u4e1a":"fa-building","\u58f0\u671b":"fa-star","\u516c\u544a":"fa-bullhorn","\u5927\u7262":"fa-dungeon","\u5176\u4ed6":"fa-ellipsis"}[e]),F=(e,t)=>o.jsx("div",{className:"space-y-4",children:e.map((e,n)=>o.jsxs("div",{className:"glass-morphism p-5 rounded-lg border border-purple-700/50 hover:border-purple-500/50 transition-all duration-300 group",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsxs("span",{className:`px-3 py-1 ${"small"===t?"bg-gradient-to-r from-purple-600/20 to-purple-700/20 text-purple-300 border-purple-600/30":"bg-gradient-to-r from-indigo-600/20 to-indigo-700/20 text-indigo-300 border-indigo-600/30"} text-xs rounded-full border`,children:["small"===t?"\u5c0f\u603b\u7ed3":"\u5927\u603b\u7ed3"," #",n+1]}),o.jsxs("span",{className:"text-xs text-gray-400",children:["\u57fa\u4e8e\u8bb0\u5fc6 ",e.startIndex+1," - ",e.endIndex+1]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[o.jsx("i",{className:"fa-solid fa-clock"}),e.timestamp]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>(async(e,t)=>{const n=("small"===t?O:z).find(t=>t.id===e);if(n){$(e);try{await vn({title:n.title,content:n.content},p,t)?alert("\u5df2\u6210\u529f\u4fdd\u5b58\u5230\u4e16\u754c\u4e66\u3010\u4ed9\u4fa0\u5361\u724cRPG\u8bb0\u5fc6\u5e93\u3011\uff01"):alert("\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u63a7\u5236\u53f0\u83b7\u53d6\u8be6\u7ec6\u4fe1\u606f")}catch(s){console.error("\u4fdd\u5b58\u5230\u4e16\u754c\u4e66\u65f6\u51fa\u9519:",s),alert("\u4fdd\u5b58\u5931\u8d25\uff1a"+s.message)}finally{$(null)}}else alert("\u672a\u627e\u5230\u8981\u4fdd\u5b58\u7684\u603b\u7ed3")})(e.id,t),disabled:P===e.id,className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-blue-400 hover:text-blue-300 p-2 disabled:opacity-50 disabled:cursor-not-allowed",title:"\u4fdd\u5b58\u5230\u4e16\u754c\u4e66",children:P===e.id?o.jsx("i",{className:"fa-solid fa-spinner fa-spin"}):o.jsx("i",{className:"fa-solid fa-book-bookmark"})}),o.jsx("button",{onClick:()=>i(p,e.id,t),className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-red-400 hover:text-red-300 p-2",title:"\u5220\u9664\u6b64\u603b\u7ed3",children:o.jsx("i",{className:"fa-solid fa-trash-alt"})})]})]}),o.jsx("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap bg-gradient-to-br from-purple-900/20 to-indigo-900/20 p-4 rounded border border-purple-700/30",children:e.content})]},e.id))});return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-6xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("i",{className:"fa-solid fa-book-open text-2xl text-gradient-gold"}),o.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u8bb0\u5fc6\u5b9d\u9274"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("button",{onClick:()=>T(!0),className:"px-4 py-2 bg-gradient-to-r from-xianxia-gold-600/80 to-xianxia-gold-700/80 hover:from-xianxia-gold-500/90 hover:to-xianxia-gold-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-xianxia-gold-500/50 flex items-center gap-2",title:"\u6279\u91cf\u5bfc\u51fa\u5230\u4e16\u754c\u4e66",children:[o.jsx("i",{className:"fa-solid fa-book-bookmark"}),o.jsx("span",{children:"\u5bfc\u51fa\u4e16\u754c\u4e66"})]}),o.jsxs("button",{onClick:()=>M(!0),className:"px-4 py-2 bg-gradient-to-r from-indigo-600/80 to-indigo-700/80 hover:from-indigo-500/90 hover:to-indigo-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-indigo-500/50 flex items-center gap-2",title:"\u7ba1\u7406\u5411\u91cf\u5316\u8bb0\u5fc6",children:[o.jsx("i",{className:"fa-solid fa-vector-square"}),o.jsx("span",{children:"\u5411\u91cf\u5316"})]}),o.jsxs("button",{onClick:()=>D(!0),className:"px-4 py-2 bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-500/90 hover:to-purple-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-purple-500/50 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-brain"}),o.jsx("span",{children:"\u8bed\u4e49\u641c\u7d22"})]}),o.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-gradient-to-r from-blue-600/80 to-blue-700/80 hover:from-blue-500/90 hover:to-blue-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-blue-500/50 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-cog"}),o.jsx("span",{children:"\u603b\u7ed3\u8bbe\u7f6e"})]}),o.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-stone-700/50 hover:bg-stone-600/50 border border-stone-600 hover:border-xianxia-gold-500 text-gray-400 hover:text-xianxia-gold-400 transition-all duration-200 flex items-center justify-center group",children:o.jsx("i",{className:"fa-solid fa-times text-xl group-hover:rotate-90 transition-transform duration-200"})})]})]}),o.jsx("div",{className:"flex-shrink-0 px-4 py-2 flex space-x-2 border-b border-stone-700 overflow-x-auto scrollbar-xianxia bg-black/10",children:["\u63a2\u7d22","\u6218\u6597","\u5546\u57ce","\u533b\u9986","\u60ac\u8d4f","\u57f9\u80b2","\u5546\u4e1a","\u58f0\u671b","\u516c\u544a","\u5927\u7262","\u5176\u4ed6"].map(e=>{const t=n[e].length;return o.jsxs("button",{onClick:()=>h(e),className:"relative px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 whitespace-nowrap flex items-center gap-2 "+(p===e?"bg-amber-600/30 text-amber-300 border border-amber-500/50 shadow-glow-gold":"bg-transparent text-gray-400 hover:bg-stone-700/50 hover:text-amber-300"),children:[o.jsx("i",{className:`fa-solid ${R(e)}`}),o.jsx("span",{children:e}),t>0&&o.jsx("span",{className:"ml-1 px-2 py-0.5 bg-amber-600/30 text-amber-300 text-xs rounded-full",children:t})]},e)})}),o.jsxs("div",{className:"flex-shrink-0 px-4 py-2 flex space-x-2 border-b border-stone-700/50 bg-black/10",children:[o.jsxs("button",{onClick:()=>g("realtime"),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 "+("realtime"===f?"bg-gradient-to-r from-amber-600/40 to-amber-700/40 text-amber-300 border border-amber-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-amber-300"),children:[o.jsx("i",{className:"fa-solid fa-stream"}),o.jsx("span",{children:"\u5b9e\u65f6\u8bb0\u5f55"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:I.length})]}),o.jsxs("button",{onClick:()=>g("small-summary"),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 "+("small-summary"===f?"bg-gradient-to-r from-purple-600/40 to-purple-700/40 text-purple-300 border border-purple-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-purple-300"),children:[o.jsx("i",{className:"fa-solid fa-layer-group"}),o.jsx("span",{children:"\u5c0f\u603b\u7ed3"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:O.length})]}),o.jsxs("button",{onClick:()=>g("large-summary"),className:"px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 "+("large-summary"===f?"bg-gradient-to-r from-indigo-600/40 to-indigo-700/40 text-indigo-300 border border-indigo-500/50":"bg-stone-700/30 text-gray-400 hover:bg-stone-700/50 hover:text-indigo-300"),children:[o.jsx("i",{className:"fa-solid fa-book"}),o.jsx("span",{children:"\u5927\u603b\u7ed3"}),o.jsx("span",{className:"px-2 py-0.5 bg-black/30 text-xs rounded-full",children:z.length})]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-6",children:"realtime"===f?I.length>0?o.jsx("div",{className:"space-y-4",children:I.map((e,t)=>o.jsx(jn,{entry:e,index:t,activeCategory:p,onDeleteEntry:l},e.id))}):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[o.jsx("i",{className:`fa-solid ${R(p)} text-6xl mb-4 opacity-30`}),o.jsx("p",{className:"text-lg",children:"\u6b64\u7c7b\u522b\u6682\u65e0\u8bb0\u5fc6"}),o.jsx("p",{className:"text-sm mt-2",children:"\u5728\u6e38\u620f\u4e2d\u7684\u5404\u79cd\u6d3b\u52a8\u4f1a\u81ea\u52a8\u8bb0\u5f55\u5728\u8fd9\u91cc"})]}):"small-summary"===f?O.length>0?F(O,"small"):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[o.jsx("i",{className:"fa-solid fa-layer-group text-6xl mb-4 opacity-30"}),o.jsx("p",{className:"text-lg",children:"\u6682\u65e0\u5c0f\u603b\u7ed3"}),o.jsx("p",{className:"text-sm mt-2",children:r.autoSummaryEnabled?`\u6bcf ${r.smallSummaryInterval} \u6761\u8bb0\u5fc6\u4f1a\u81ea\u52a8\u751f\u6210\u5c0f\u603b\u7ed3`:"\u8bf7\u5728\u8bbe\u7f6e\u4e2d\u5f00\u542f\u81ea\u52a8\u603b\u7ed3\uff0c\u6216\u4f7f\u7528\u624b\u52a8\u603b\u7ed3\u529f\u80fd"})]}):z.length>0?F(z,"large"):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500",children:[o.jsx("i",{className:"fa-solid fa-book text-6xl mb-4 opacity-30"}),o.jsx("p",{className:"text-lg",children:"\u6682\u65e0\u5927\u603b\u7ed3"}),o.jsx("p",{className:"text-sm mt-2",children:r.autoSummaryEnabled?`\u6bcf ${r.largeSummaryInterval} \u6761\u5c0f\u603b\u7ed3\u4f1a\u81ea\u52a8\u751f\u6210\u5927\u603b\u7ed3`:"\u8bf7\u5728\u8bbe\u7f6e\u4e2d\u5f00\u542f\u81ea\u52a8\u603b\u7ed3\uff0c\u6216\u4f7f\u7528\u624b\u52a8\u603b\u7ed3\u529f\u80fd"})]})}),o.jsx("div",{className:"flex-shrink-0 p-4 border-t border-stone-700/50 bg-black/20",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-4",children:["realtime"===f&&o.jsxs(o.Fragment,{children:[o.jsxs("span",{className:"text-sm text-gray-400",children:["\u5171 ",I.length," \u6761\u8bb0\u5fc6"]}),r.autoSummaryEnabled&&o.jsxs("span",{className:"text-xs text-purple-400",children:["\u6bcf ",r.smallSummaryInterval," \u6761\u81ea\u52a8\u603b\u7ed3"]})]}),"small-summary"===f&&o.jsxs("span",{className:"text-sm text-purple-400",children:["\u5171 ",O.length," \u6761\u5c0f\u603b\u7ed3"]}),"large-summary"===f&&o.jsxs("span",{className:"text-sm text-indigo-400",children:["\u5171 ",z.length," \u6761\u5927\u603b\u7ed3"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[("realtime"===f||"small-summary"===f)&&o.jsxs("button",{onClick:()=>{const e="realtime"===f?I:O;0!==e.length?(w(1),C(e.length),E("realtime"===f?"small":"large"),j(!0)):alert("\u5f53\u524d\u7c7b\u522b\u6ca1\u6709\u5185\u5bb9\u53ef\u4ee5\u603b\u7ed3")},className:"px-4 py-2 bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-500/90 hover:to-purple-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-purple-500/50 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),o.jsx("span",{children:"\u624b\u52a8\u603b\u7ed3"})]}),"realtime"===f&&I.length>0&&o.jsxs("button",{onClick:()=>{confirm(`\u786e\u5b9a\u8981\u6e05\u7a7a\u3010${p}\u3011\u7c7b\u522b\u7684\u6240\u6709\u5b9e\u65f6\u8bb0\u5fc6\u5417\uff1f`)&&a(p)},className:"px-4 py-2 bg-gradient-to-r from-red-600/80 to-red-700/80 hover:from-red-500/90 hover:to-red-600/90 text-white text-sm rounded-lg transition-all duration-300 active:scale-95 border border-red-500/50",children:[o.jsx("i",{className:"fa-solid fa-broom mr-2"}),"\u6e05\u7a7a\u6b64\u7c7b\u522b"]})]})]})}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-xianxia-gold-400 to-transparent"})]})}),b&&o.jsx(kn,{isOpen:b,onClose:()=>y(!1),settings:r,onSave:d,gameState:u,onVectorConfigSave:m}),L&&u&&o.jsx(Cn,{isOpen:L,onClose:()=>M(!1),category:p,realtimeMemories:I,smallSummaries:O,largeSummaries:z,vectorConfig:u.vectorConfig}),_&&u&&o.jsx(Nn,{isOpen:_,onClose:()=>D(!1),gameState:u,onSaveThreshold:e=>{m&&m({...u.vectorConfig,similarityThreshold:e})}}),A&&o.jsx(Sn,{isOpen:A,onClose:()=>T(!1),memories:n,memorySummaries:s}),v&&o.jsx("div",{className:"fixed inset-0 bg-black/90 z-[60] flex items-center justify-center p-4",onClick:()=>j(!1),children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 rounded-xl p-6 max-w-md w-full border border-purple-500/50 shadow-2xl",onClick:e=>e.stopPropagation(),children:[o.jsxs("h3",{className:"text-xl font-bold text-purple-300 mb-4 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),"\u624b\u52a8\u751f\u6210\u603b\u7ed3"]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"\u603b\u7ed3\u7c7b\u578b"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>E("small"),disabled:"realtime"!==f,className:`flex-1 px-4 py-2 rounded-lg transition-all ${"small"===S?"bg-purple-600 text-white":"bg-stone-700/50 text-gray-400 hover:bg-stone-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"\u5c0f\u603b\u7ed3"}),o.jsx("button",{onClick:()=>E("large"),disabled:"large-summary"===f,className:`flex-1 px-4 py-2 rounded-lg transition-all ${"large"===S?"bg-indigo-600 text-white":"bg-stone-700/50 text-gray-400 hover:bg-stone-700"} disabled:opacity-50 disabled:cursor-not-allowed`,children:"\u5927\u603b\u7ed3"})]})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm text-gray-400 mb-2",children:["\u8303\u56f4 (\u5171 ","realtime"===f?I.length:O.length," \u6761)"]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"text-xs text-gray-500",children:"\u4ece\u7b2c"}),o.jsx("input",{type:"number",min:"1",max:"realtime"===f?I.length:O.length,value:N,onChange:e=>w(Math.max(1,Math.min("realtime"===f?I.length:O.length,parseInt(e.target.value)||1))),className:"w-full mt-1 px-3 py-2 bg-stone-700/50 border border-stone-600 rounded text-white focus:outline-none focus:border-purple-500"})]}),o.jsx("span",{className:"text-gray-500 mt-5",children:"-"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"text-xs text-gray-500",children:"\u5230\u7b2c"}),o.jsx("input",{type:"number",min:"1",max:"realtime"===f?I.length:O.length,value:k,onChange:e=>C(Math.max(1,Math.min("realtime"===f?I.length:O.length,parseInt(e.target.value)||1))),className:"w-full mt-1 px-3 py-2 bg-stone-700/50 border border-stone-600 rounded text-white focus:outline-none focus:border-purple-500"})]}),o.jsx("span",{className:"text-gray-500 mt-5",children:"\u6761"})]})]}),o.jsxs("div",{className:"flex gap-2 pt-2",children:[o.jsx("button",{onClick:()=>j(!1),className:"flex-1 px-4 py-2 bg-stone-700/50 hover:bg-stone-700 text-gray-300 rounded-lg transition-all",children:"\u53d6\u6d88"}),o.jsxs("button",{onClick:()=>{N<1||k>("realtime"===f?I:O).length||N>k?alert("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u8303\u56f4"):(c(p,N-1,k-1,S),j(!1))},className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white rounded-lg transition-all flex items-center justify-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-check"}),"\u751f\u6210\u603b\u7ed3"]})]})]})]})})]})},Pn={enabled:!0,maxResults:5,minSimilarity:.7,depth:0,shouldScan:!0},$n={manualInject:!1,includeConstant:!1,includeSelective:!1},_n={useCurrentPreset:!0,extractSystemPrompts:!1},Dn={enabled:!0,include:{playerInfo:!0,location:!0,party:!0,battleStatus:!0,reputation:!1},depth:0},Ln={style:"detailed",showSimilarity:!0,showTimestamp:!0,showLocation:!0,showCharacters:!0,maxTextLength:void 0},Mn={style:"compact",includeStats:!1},An=0,Tn=1,In=2;const On=new class{async buildContext(e,t){const n=Date.now(),s=[];let r=0,a=0,l=!1;if(!1!==t.vectorMemory?.enabled&&e.vectorConfig.enabled){const n={...Pn,...t.vectorMemory},a=await this.buildVectorMemoryInject(e,t.userInput,n);a&&(s.push(a),r=a.metadata?.memoryCount||0)}if(!1!==t.gameStateContext?.enabled){const n={...Dn,...t.gameStateContext},r=this.buildGameStateInject(e,n);r&&(s.push(r),l=!0)}if(t.worldbook?.manualInject){const n={...$n,...t.worldbook},r=await this.buildWorldbookInject(e,t.userInput,n);r&&(s.push(r),a=r.metadata?.entryCount||0)}return{injects:s,enhancedUserInput:this.enhanceUserInput(t.userInput,e),metadata:{vectorMemoryCount:r,worldbookEntriesCount:a,gameStateInjected:l,buildTime:Date.now()-n}}}async buildVectorMemoryInject(e,t,n){try{const s=await Q.retrieveRelevantMemories(e,t,n.maxResults);if(0===s.relevantMemories.length)return null;const r=this.formatVectorMemories(s.relevantMemories,Ln);return s.relevantMemories.length,{id:"vector_memory_context",role:"system",content:r,position:"in_chat",depth:n.depth,order:An,should_scan:n.shouldScan,metadata:{memoryCount:s.relevantMemories.length}}}catch(s){return console.error("[\u4e0a\u4e0b\u6587\u6784\u5efa] \u5411\u91cf\u8bb0\u5fc6\u68c0\u7d22\u5931\u8d25:",s),null}}buildGameStateInject(e,t){try{const n=this.formatGameState(e,t,Mn);return n?{id:"game_state_context",role:"system",content:n,position:"in_chat",depth:t.depth,order:Tn,should_scan:!0}:null}catch(n){return console.error("[\u4e0a\u4e0b\u6587\u6784\u5efa] \u6e38\u620f\u72b6\u6001\u6784\u5efa\u5931\u8d25:",n),null}}async buildWorldbookInject(e,t,n){if("undefined"==typeof TavernHelper)return null;try{const e=n.worldbookNames||TavernHelper.getWorldbookNames();if(0===e.length)return null;const r=[];for(const a of e)try{const e=await TavernHelper.getWorldbook(a);for(const s of e)if(s.enabled&&(n.includeConstant&&"constant"===s.strategy.type&&r.push(`\u3010${s.name}\u3011\n${s.content}`),n.includeSelective&&"selective"===s.strategy.type)){const e=s.strategy.keys||[],n=t.toLowerCase();for(const t of e)if("string"==typeof t&&n.includes(t.toLowerCase())){r.push(`\u3010${s.name}\u3011\n${s.content}`);break}}}catch(s){console.warn(`[\u4e0a\u4e0b\u6587\u6784\u5efa] \u65e0\u6cd5\u8bfb\u53d6\u4e16\u754c\u4e66 ${a}:`,s)}return 0===r.length?null:(r.length,{id:"worldbook_manual_inject",role:"system",content:`=== \u4e16\u754c\u4e66\u4fe1\u606f ===\n\n${r.join("\n\n")}\n\n===================`,position:"in_chat",depth:1,order:In,should_scan:!1,metadata:{entryCount:r.length}})}catch(s){return console.error("[\u4e0a\u4e0b\u6587\u6784\u5efa] \u4e16\u754c\u4e66\u6784\u5efa\u5931\u8d25:",s),null}}formatVectorMemories(e,t){if(0===e.length)return"";const n=[];if("detailed"===t.style){n.push("=== \u76f8\u5173\u5386\u53f2\u8bb0\u5fc6 ==="),n.push("");for(const s of e){const e=s.memory;n.push(`\u3010\u8bb0\u5fc6 #${s.rank}\u3011`),t.showTimestamp&&e.metadata.timestamp&&n.push(`\u65f6\u95f4\uff1a${e.metadata.timestamp}`),t.showLocation&&e.metadata.location&&n.push(`\u5730\u70b9\uff1a${e.metadata.location}`),t.showCharacters&&e.metadata.involvedCharacters?.length&&n.push(`\u89d2\u8272\uff1a${e.metadata.involvedCharacters.join("\u3001")}`),t.showSimilarity&&n.push(`\u76f8\u5173\u5ea6\uff1a${(100*s.similarity).toFixed(1)}%`),n.push("");let r=e.text;t.maxTextLength&&r.length>t.maxTextLength&&(r=r.substring(0,t.maxTextLength)+"..."),n.push(r),n.push("")}n.push("===================")}else if("compact"===t.style){n.push("=== \u76f8\u5173\u8bb0\u5fc6 ===");for(const s of e){let e=s.memory.text;t.maxTextLength&&e.length>t.maxTextLength&&(e=e.substring(0,t.maxTextLength)+"...");const r=t.showSimilarity?` [${(100*s.similarity).toFixed(0)}%]`:"";n.push(`\u2022 ${e}${r}`)}n.push("===============")}else if("list"===t.style)for(const s of e){let e=s.memory.text;t.maxTextLength&&e.length>t.maxTextLength&&(e=e.substring(0,t.maxTextLength)+"..."),n.push(e)}return n.join("\n")}formatGameState(e,t,n){const s=[];if("full"!==n.style&&"compact"!==n.style||(s.push("=== \u5f53\u524d\u6e38\u620f\u72b6\u6001 ==="),s.push("")),t.include.playerInfo&&(s.push(`\u3010\u73a9\u5bb6\u3011${e.playerProfile.name}`),e.playerProfile.title&&s.push(`\u79f0\u53f7\uff1a${e.playerProfile.title}`),n.includeStats&&s.push(`\u7075\u77f3\uff1a${e.playerProfile.spiritStones}`),s.push("")),t.include.location&&(s.push(`\u3010\u4f4d\u7f6e\u3011${e.exploration.location}`),s.push(`\u3010\u65f6\u95f4\u3011${e.exploration.time}`),s.push("")),t.include.party){const t=[...e.playerProfile.maleParty,...e.playerProfile.femaleParty];if(t.length>0){s.push("\u3010\u5f53\u524d\u961f\u4f0d\u3011");for(const e of t)"full"===n.style?s.push(`  \u2022 ${e.name} (${e.realm}) - \u751f\u547d:${e.baseAttributes.hp}/${e.baseAttributes.maxHp}`):s.push(`  \u2022 ${e.name} (${e.realm})`);s.push("")}}if(t.include.battleStatus&&"battle"===e.mode&&e.battle&&(s.push("\u3010\u6218\u6597\u72b6\u6001\u3011"),s.push(`\u5df1\u65b9\uff1a${e.battle.playerParty.map(e=>e.card.name).join("\u3001")}`),s.push(`\u654c\u65b9\uff1a${e.battle.opponentParty.map(e=>e.card.name).join("\u3001")}`),s.push("\u56de\u5408\uff1a"+("player"===e.battle.turn?"\u73a9\u5bb6\u56de\u5408":"\u5bf9\u624b\u56de\u5408")),s.push("")),t.include.reputation&&"full"===n.style){const t=e.playerProfile.reputation;s.push(`\u3010\u58f0\u671b\u3011${t.level} (${t.score})`),t.title&&s.push(`\u5f53\u524d\u79f0\u53f7\uff1a${t.title}`),s.push("")}return"full"!==n.style&&"compact"!==n.style||s.push("==================="),s.join("\n")}enhanceUserInput(e,t){const n=[];return"battle"===t.mode?n.push("\u8bf7\u57fa\u4e8e\u5f53\u524d\u6218\u6597\u60c5\u51b5\u751f\u6210\u5185\u5bb9"):n.push("\u8bf7\u57fa\u4e8e\u5f53\u524d\u63a2\u7d22\u60c5\u51b5\u751f\u6210\u5185\u5bb9"),t.vectorConfig.enabled&&n.push("\u8bf7\u786e\u4fdd\u5185\u5bb9\u4e0e\u4e0a\u8ff0\u5386\u53f2\u8bb0\u5fc6\u4fdd\u6301\u4e00\u81f4"),0===n.length?e:`${e}\n\n\uff08${n.join("\uff0c")}\uff09`}validateInjects(e){const t=[];for(const n of e)n.id||t.push("\u6ce8\u5165\u63d0\u793a\u8bcd\u7f3a\u5c11ID"),n.content||t.push(`\u6ce8\u5165\u63d0\u793a\u8bcd ${n.id} \u5185\u5bb9\u4e3a\u7a7a`),["system","user","assistant"].includes(n.role)||t.push(`\u6ce8\u5165\u63d0\u793a\u8bcd ${n.id} \u89d2\u8272\u65e0\u6548: ${n.role}`),"in_chat"===n.position&&void 0===n.depth&&t.push(`\u6ce8\u5165\u63d0\u793a\u8bcd ${n.id} \u4f7f\u7528in_chat\u4f4d\u7f6e\u4f46\u672a\u6307\u5b9a\u6df1\u5ea6`);return{valid:0===t.length,errors:t}}};const zn=new class{async generate(e,t){if("undefined"==typeof TavernHelper)throw new Error("TavernHelper\u672a\u5b9a\u4e49\uff0c\u65e0\u6cd5\u4f7f\u7528AI\u751f\u6210\u529f\u80fd");t.userInput;try{const n=await On.buildContext(e,t);n.injects.length,n.metadata.vectorMemoryCount,n.metadata.worldbookEntriesCount,n.metadata.gameStateInjected,n.metadata.buildTime;const s=On.validateInjects(n.injects);if(!s.valid)throw console.error("[AI\u751f\u6210] \u6ce8\u5165\u9a8c\u8bc1\u5931\u8d25:",s.errors),new Error(`\u6ce8\u5165\u9a8c\u8bc1\u5931\u8d25: ${s.errors.join(", ")}`);const r={user_input:n.enhancedUserInput,should_stream:t.shouldStream||!1,max_chat_history:t.maxChatHistory||"all"};n.injects.length>0&&(r.injects=n.injects.map(e=>({id:e.id,role:e.role,content:e.content,position:e.position,depth:e.depth,order:e.order,should_scan:e.should_scan}))),t.customApi&&(r.custom_api=t.customApi),t.generationId&&(r.generation_id=t.generationId);const a=await TavernHelper.generate(r);return a.length,a}catch(n){throw console.error("[AI\u751f\u6210] \u751f\u6210\u5931\u8d25:",n),n}}async quickGenerate(e,t,n={}){const s={userInput:t,shouldStream:n.shouldStream,vectorMemory:!1!==n.enableVectorMemory?Pn:{...Pn,enabled:!1},gameStateContext:!1!==n.enableGameState?Dn:{...Dn,enabled:!1},worldbook:$n,preset:_n};return this.generate(e,s)}async generateWithPresetOnly(e,t={}){if("undefined"==typeof TavernHelper)throw new Error("TavernHelper\u672a\u5b9a\u4e49");const n={user_input:e,should_stream:t.shouldStream||!1,max_chat_history:t.maxChatHistory||"all"};return t.customApi&&(n.custom_api=t.customApi),await TavernHelper.generate(n)}async batchGenerate(e,t,n={}){const s=[];for(const a of t)try{const t={...n,userInput:a},r=await this.generate(e,t);s.push(r)}catch(r){console.error(`[AI\u751f\u6210] \u6279\u91cf\u751f\u6210\u5931\u8d25\uff0c\u63d0\u793a\u8bcd: ${a}`,r),s.push("")}return s}async stopGeneration(e){if("undefined"==typeof TavernHelper||"undefined"==typeof stopGenerationById)return console.warn("[AI\u751f\u6210] \u505c\u6b62\u751f\u6210\u529f\u80fd\u4e0d\u53ef\u7528"),!1;try{return await stopGenerationById(e)}catch(t){return console.error("[AI\u751f\u6210] \u505c\u6b62\u751f\u6210\u5931\u8d25:",t),!1}}async stopAllGenerations(){if("undefined"==typeof TavernHelper||"undefined"==typeof stopAllGeneration)return console.warn("[AI\u751f\u6210] \u505c\u6b62\u6240\u6709\u751f\u6210\u529f\u80fd\u4e0d\u53ef\u7528"),!1;try{return await stopAllGeneration()}catch(e){return console.error("[AI\u751f\u6210] \u505c\u6b62\u6240\u6709\u751f\u6210\u5931\u8d25:",e),!1}}onGenerationEvent(e,t){if("undefined"==typeof eventOn||"undefined"==typeof iframe_events)return console.warn("[AI\u751f\u6210] \u4e8b\u4ef6\u7cfb\u7edf\u4e0d\u53ef\u7528"),()=>{};let n;switch(e){case"started":n=iframe_events.GENERATION_STARTED;break;case"streaming":n=iframe_events.STREAM_TOKEN_RECEIVED_FULLY;break;case"completed":n=iframe_events.GENERATION_ENDED;break;default:return console.warn(`[AI\u751f\u6210] \u672a\u77e5\u4e8b\u4ef6\u7c7b\u578b: ${e}`),()=>{}}return eventOn(n,n=>{t({type:e,generationId:n.generation_id||"",text:n.text||n,metadata:n})}),()=>{}}isAvailable(){return"undefined"!=typeof TavernHelper&&"function"==typeof TavernHelper.generate}getCurrentPresetInfo(){if("undefined"==typeof TavernHelper)return null;try{return TavernHelper.getPreset("in_use")}catch(e){return console.error("[AI\u751f\u6210] \u83b7\u53d6\u9884\u8bbe\u5931\u8d25:",e),null}}async switchPreset(e){if("undefined"==typeof TavernHelper)return!1;try{return TavernHelper.loadPreset(e)}catch(t){return console.error("[AI\u751f\u6210] \u5207\u6362\u9884\u8bbe\u5931\u8d25:",t),!1}}getAvailablePresets(){if("undefined"==typeof TavernHelper)return[];try{return TavernHelper.getPresetNames()}catch(e){return console.error("[AI\u751f\u6210] \u83b7\u53d6\u9884\u8bbe\u5217\u8868\u5931\u8d25:",e),[]}}};const Rn=new class{async generateWithEnhancedContext(e,t,n={}){const s={userInput:t,shouldStream:n.shouldStream,vectorMemory:!1!==n.includeVectorMemories?{...Pn,maxResults:n.maxVectorResults||Pn.maxResults,categories:n.categories}:{...Pn,enabled:!1},worldbook:!1!==n.includeWorldbook?$n:{...$n,manualInject:!1},preset:!1!==n.includePreset?_n:{..._n,useCurrentPreset:!1},gameStateContext:!1!==n.includeGameState?Dn:{...Dn,enabled:!1},customApi:n.customApi};return await zn.generate(e,s)}async generateWithCustomAPI(e,t,n,s={}){return this.generateWithEnhancedContext(e,t,{...s,customApi:n,includePreset:!1,includeWorldbook:!1})}async quickGenerate(e,t,n=!1){return zn.quickGenerate(e,t,{enableVectorMemory:!0,enableGameState:!0,shouldStream:n})}async generateWithVectorOnly(e,t,n=5){return this.generateWithEnhancedContext(e,t,{includeVectorMemories:!0,includeGameState:!1,maxVectorResults:n})}async generateByCategory(e,t,n,s=5){return this.generateWithEnhancedContext(e,t,{includeVectorMemories:!0,categories:n,maxVectorResults:s})}isAvailable(){return zn.isAvailable()}getCurrentPreset(){return zn.getCurrentPresetInfo()}onGeneration(e,t){return zn.onGenerationEvent(e,t)}},Fn={"\u63a2\u7d22":["\u63a2\u7d22","\u53d1\u73b0","\u524d\u5f80","\u5230\u8fbe","\u79bb\u5f00","\u8fdb\u5165","\u51fa\u53d1","\u5730\u56fe","\u4f4d\u7f6e","\u533a\u57df","\u573a\u666f","\u5947\u9047","\u968f\u673a\u4e8b\u4ef6","\u9047\u89c1","\u8def\u8fc7","\u5bfb\u627e","\u641c\u7d22","\u8c03\u67e5"],"\u6218\u6597":["\u6218\u6597","\u653b\u51fb","\u9632\u5fa1","\u6280\u80fd","\u91ca\u653e","\u9020\u6210","\u53d7\u5230","\u4f24\u5bb3","\u51fb\u8d25","\u80dc\u5229","\u5931\u8d25","\u654c\u4eba","\u602a\u7269","\u5bf9\u624b","\u7ade\u6280\u573a","\u5bf9\u51b3","\u6311\u6218","\u56de\u5408","\u6392\u884c\u699c","\u699c\u5355","\u6392\u540d","\u79ef\u5206"],"\u5546\u57ce":["\u5546\u57ce","\u62bd\u5361","\u62bd\u53d6","\u62db\u52df","\u8d2d\u4e70","\u5361\u6c60","\u4eba\u7269\u5361\u724c","\u88c5\u5907","\u901a\u7528\u6280\u80fd","\u517d\u5ba0","\u540c\u4eba","\u7075\u611f","\u53ec\u5524","\u5929\u673a","\u4e07\u8c61\u5bfb\u4ed9","\u767e\u70bc\u9601","\u4e07\u6cd5\u697c","\u5fa1\u517d\u658b","\u5f02\u754c\u964d\u4e34","\u795e\u5175\u5929\u6210","\u5927\u9053\u987f\u609f","\u7075\u517d\u521b\u751f","\u6cd5\u5b9d","\u9632\u5177","\u529f\u6cd5","\u7075\u517d","\u5951\u7ea6","\u953b\u9020","\u9886\u609f","\u521b\u9020"],"\u533b\u9986":["\u533b\u9986","\u95ee\u8bca","\u8bca\u65ad","\u6cbb\u7597","\u533b\u6cbb","\u75c7\u72b6","\u75c5\u60c5","\u836f\u7269","\u5904\u65b9","\u5eb7\u590d","\u4f24\u52bf","\u75be\u75c5","\u60a3\u8005","\u75c5\u5386","\u8d70\u706b\u5165\u9b54"],"\u60ac\u8d4f":["\u60ac\u8d4f","\u4efb\u52a1","\u59d4\u6258","\u63a5\u53d6","\u5b8c\u6210","\u5956\u52b1","\u76ee\u6807","\u8ffd\u6355","\u8c03\u67e5","\u8d4f\u91d1","\u730e\u4eba","\u8ffd\u8e2a","\u7ebf\u7d22","\u5343\u4e73\u5723\u5973"],"\u57f9\u80b2":["\u57f9\u80b2","\u4fee\u70bc","\u7a81\u7834","\u63d0\u5347","\u5883\u754c","\u7075\u529b","\u529f\u6cd5","\u70bc\u4e39","\u70bc\u5668","\u6210\u957f","\u8fdb\u9636","\u7e41\u6b96","\u5b55\u80b2","\u80b2\u7075\u8f69","\u76d1\u6d4b","\u914d\u79cd","\u540e\u4ee3"],"\u5546\u4e1a":["\u5546\u4e1a","\u4ea4\u6613","\u51fa\u552e","\u4ef7\u683c","\u7075\u77f3","\u5546\u5e97","\u5546\u4eba","\u4e70\u5356","\u4ea4\u6362","\u8d27\u7269","\u5e97\u94fa","\u6536\u5165","\u5458\u5de5","\u7ecf\u8425","\u751f\u610f","\u9752\u697c","\u89d2\u6597\u573a","\u70bc\u4e39\u623f","\u62cd\u5356\u884c","\u60c5\u62a5\u9601","\u76d1\u89c6","\u5934\u724c","\u89d2\u6597\u58eb","\u5974\u96b6"],"\u58f0\u671b":["\u58f0\u671b","\u540d\u58f0","\u5a01\u671b","\u540d\u6c14","\u4e8b\u8ff9","\u540d\u671b","\u6c5f\u6e56","\u4f20\u95fb","\u79f0\u53f7","\u4fa0\u4e49","\u6076\u884c","\u98ce\u6d41","\u5929\u673a\u9601"],"\u516c\u544a":["\u516c\u544a","\u5b97\u95e8","\u4e16\u754c","\u5947\u9047","\u901a\u77e5","\u6d88\u606f","\u5929\u5143","\u60ca\u86f0","\u5b97\u95e8\u6392\u884c","\u91ce\u699c","\u533a\u57df\u699c","\u4e16\u754c\u699c"],"\u5927\u7262":["\u5927\u7262","\u76d1\u72f1","\u56da\u72af","\u5ba1\u8baf","\u5211\u6cd5","\u72f1\u5352","\u7262\u623f","\u52b3\u5f79","\u56da\u7981","\u5173\u62bc","\u62f7\u95ee","\u7981\u95ed","\u8d8a\u72f1","\u8d4e\u91d1"],"\u5176\u4ed6":[]},qn={exploration:"\u63a2\u7d22",map:"\u63a2\u7d22",battle:"\u6218\u6597",arena:"\u6218\u6597",shop:"\u5546\u57ce",gacha:"\u5546\u57ce",hospital:"\u533b\u9986",consultation:"\u533b\u9986",bounty:"\u60ac\u8d4f",cultivation:"\u57f9\u80b2",business:"\u5546\u4e1a",surveillance:"\u5546\u4e1a",reputation:"\u58f0\u671b",announcement:"\u516c\u544a",telepathy:"\u5176\u4ed6",interaction:"\u5176\u4ed6",party:"\u5176\u4ed6",inventory:"\u5176\u4ed6"};const Bn=new class{constructor(){this.currentScene="unknown",this.isEnabled=!0,this.eventListenersRegistered=!1}setMessageCallback(e){this.onMessageCallback=e}setCurrentScene(e){this.currentScene=e}setEnabled(e){this.isEnabled=e}categorizeMessage(e,t){if(t&&qn[t])return qn[t];let n=0,s="\u5176\u4ed6";for(const[r,a]of Object.entries(Fn)){if(0===a.length)continue;let t=0;for(const n of a)e.includes(n)&&t++;t>n&&(n=t,s=r)}return s}handleCapturedMessage(e){if(!this.isEnabled||!this.onMessageCallback)return;const t=this.categorizeMessage(e.content,e.scene||this.currentScene);this.onMessageCallback(e,t)}registerEventListeners(){if(this.eventListenersRegistered)return;if("undefined"==typeof window||!window.eventOn)return void console.warn("[AI\u6d88\u606f\u6355\u83b7] \u672a\u68c0\u6d4b\u5230SillyTavern\u73af\u5883\uff0c\u65e0\u6cd5\u6ce8\u518c\u4e8b\u4ef6\u76d1\u542c\u5668");const e=window.eventOn,t=window.tavern_events,n=window.iframe_events;e(t.MESSAGE_RECEIVED,(e,t)=>{try{const t=window.getChatMessages;if(t){const n=t(-1);if(n&&n.length>0){const t=n[0];"assistant"===t.role&&this.handleCapturedMessage({content:t.message,timestamp:(new Date).toISOString(),source:"ai",messageId:e,scene:this.currentScene})}}}catch(n){console.error("[AI\u6d88\u606f\u6355\u83b7] \u5904\u7406MESSAGE_RECEIVED\u4e8b\u4ef6\u65f6\u51fa\u9519:",n)}}),e(t.GENERATION_ENDED,e=>{}),n&&n.GENERATION_ENDED&&e(n.GENERATION_ENDED,(e,t)=>{e&&e.trim()&&this.handleCapturedMessage({content:e,timestamp:(new Date).toISOString(),source:"ai",scene:this.currentScene})}),this.eventListenersRegistered=!0}captureMessage(e,t){this.handleCapturedMessage({content:e,timestamp:(new Date).toISOString(),source:"ai",scene:t||this.currentScene})}cleanup(){this.eventListenersRegistered=!1}};async function Hn(e){Bn.setCurrentScene("arena");try{e.playerProfile.arenaRank.tier,e.playerProfile.arenaRank.division,e.playerProfile.arenaRank.points;const n='\u8bf7\u751f\u6210\u5b8c\u6574\u7684\u7ade\u6280\u573a\u699c\u5355\u6570\u636e\u3002\u8fd4\u56de\u683c\u5f0f\uff1a\n{\n  "\u5b97\u95e8\u6392\u884c\u699c": {\n    "\u603b\u699c": [{"rank": 1, "name": "\u89d2\u8272\u540d", "faction": "\u95e8\u6d3e\u540d", "points": \u79ef\u5206, "characterId": "id"}],\n    "\u6838\u5fc3\u5f1f\u5b50": [...],\n    "\u5185\u95e8\u5f1f\u5b50": [...],\n    "\u5916\u95e8\u5f1f\u5b50": [...],\n    "\u6742\u5f79\u5f1f\u5b50": [...]\n  },\n  "\u91ce\u699c": [...],\n  "\u533a\u57df\u699c": [...],\n  "\u4e16\u754c\u699c": [...]\n}\n\n\u8bf7\u786e\u4fdd\uff1a\n- \u6bcf\u4e2a\u699c\u5355\u81f3\u5c1110\u4e2a\u6761\u76ee\n- rank\u4ece1\u5f00\u59cb\u8fde\u7eed\u9012\u589e\n- points\u6309\u6392\u540d\u9012\u51cf\n- name\u548cfaction\u5bcc\u6709\u521b\u610f\n- characterId\u4f7f\u7528"arena-npc-{\u968f\u673a\u6570}"\u683c\u5f0f',s=await Rn.generateWithEnhancedContext(e,n,{includeVectorMemories:!0,includePreset:!0,includeWorldbook:!0,includeGameState:!0,maxVectorResults:3,categories:["\u6218\u6597","\u516c\u544a","\u58f0\u671b"]});let r;s.length,s.substring(0,500),Bn.captureMessage(s,"arena");try{const e=(s.match(/```json\s*([\s\S]*?)\s*```/)||s.match(/```\s*([\s\S]*?)\s*```/)||[null,s])[1]||s;r=JSON.parse(e.trim())}catch(t){console.error("[\u699c\u5355\u751f\u6210] JSON\u89e3\u6790\u5931\u8d25\uff0c\u4f7f\u7528\u9ed8\u8ba4\u699c\u5355:",t),r=Vn(e)}return r=function(e){const t={"\u5b97\u95e8\u6392\u884c\u699c":{"\u603b\u699c":[],"\u6838\u5fc3\u5f1f\u5b50":[],"\u5185\u95e8\u5f1f\u5b50":[],"\u5916\u95e8\u5f1f\u5b50":[],"\u6742\u5f79\u5f1f\u5b50":[]},"\u91ce\u699c":[],"\u533a\u57df\u699c":[],"\u4e16\u754c\u699c":[]};if(e["\u5b97\u95e8\u6392\u884c\u699c"]){const n=e["\u5b97\u95e8\u6392\u884c\u699c"];t["\u5b97\u95e8\u6392\u884c\u699c"]["\u603b\u699c"]=Un(n["\u603b\u699c"]||[]),t["\u5b97\u95e8\u6392\u884c\u699c"]["\u6838\u5fc3\u5f1f\u5b50"]=Un(n["\u6838\u5fc3\u5f1f\u5b50"]||[]),t["\u5b97\u95e8\u6392\u884c\u699c"]["\u5185\u95e8\u5f1f\u5b50"]=Un(n["\u5185\u95e8\u5f1f\u5b50"]||[]),t["\u5b97\u95e8\u6392\u884c\u699c"]["\u5916\u95e8\u5f1f\u5b50"]=Un(n["\u5916\u95e8\u5f1f\u5b50"]||[]),t["\u5b97\u95e8\u6392\u884c\u699c"]["\u6742\u5f79\u5f1f\u5b50"]=Un(n["\u6742\u5f79\u5f1f\u5b50"]||[])}return t["\u91ce\u699c"]=Un(e["\u91ce\u699c"]||[]),t["\u533a\u57df\u699c"]=Un(e["\u533a\u57df\u699c"]||[]),t["\u4e16\u754c\u699c"]=Un(e["\u4e16\u754c\u699c"]||[]),t}(r),r}catch(n){return console.error("[\u699c\u5355\u751f\u6210] AI\u751f\u6210\u5931\u8d25:",n),Vn()}}function Un(e){return Array.isArray(e)?e.filter(e=>e&&"object"==typeof e).map((e,t)=>({rank:"number"==typeof e.rank?e.rank:t+1,name:String(e.name||`\u4fee\u58eb${t+1}`),faction:String(e.faction||"\u6563\u4fee"),points:"number"==typeof e.points?e.points:1e3-10*t,characterId:String(e.characterId||`arena-npc-${Date.now()}-${t}`)})).sort((e,t)=>e.rank-t.rank):[]}function Vn(e){const t=["\u5929\u5143\u5b97","\u7384\u5929\u6d3e","\u7075\u9704\u6bbf","\u767e\u82b1\u8c37","\u5251\u5b97","\u836f\u738b\u8c37","\u9b54\u97f3\u5b97","\u96f7\u9706\u9601"],n=["\u5251\u5fc3","\u4e91\u6f88","\u6708\u534e","\u661f\u8fb0","\u98ce\u884c","\u96f7\u52a8","\u51b0\u5fc3","\u706b\u70c8","\u6728\u7075","\u6c34\u67d4","\u91d1\u521a","\u571f\u539a","\u5929\u673a","\u5730\u7075","\u4eba\u6770","\u9b3c\u624d","\u9f99\u541f","\u51e4\u9e23","\u864e\u5578","\u8c79\u5f71","\u718a\u9738","\u9e70\u626c","\u86c7\u884c","\u9e64\u821e"],s=(e,s)=>{const r=[];for(let a=0;a<e;a++)r.push({rank:a+1,name:n[Math.floor(Math.random()*n.length)]+["\u771f\u4eba","\u4ed9\u5b50","\u9053\u4eba","\u4e0a\u4eba","\u5c0a\u8005"][Math.floor(5*Math.random())],faction:t[Math.floor(Math.random()*t.length)],points:s-a*Math.floor(50*Math.random()+20),characterId:`arena-npc-${Date.now()}-${a}`});return r};return{"\u5b97\u95e8\u6392\u884c\u699c":{"\u603b\u699c":s(15,5e3),"\u6838\u5fc3\u5f1f\u5b50":s(12,4500),"\u5185\u95e8\u5f1f\u5b50":s(12,3500),"\u5916\u95e8\u5f1f\u5b50":s(12,2500),"\u6742\u5f79\u5f1f\u5b50":s(10,1500)},"\u91ce\u699c":s(15,4800),"\u533a\u57df\u699c":s(15,4600),"\u4e16\u754c\u699c":s(20,6e3)}}const Wn=e=>1===e?o.jsx("span",{className:"text-xl animate-pulse",children:"\ud83c\udfc6"}):2===e?o.jsx("span",{className:"text-lg",children:"\ud83e\udd48"}):3===e?o.jsx("span",{className:"text-lg",children:"\ud83e\udd49"}):o.jsx("span",{className:"text-gold-400/80 font-bold",children:e}),Qn=({data:e})=>o.jsxs("div",{className:"w-full h-full relative",children:[o.jsxs("div",{className:"absolute inset-0 opacity-5 pointer-events-none",children:[o.jsx("div",{className:"absolute top-1/4 left-1/4 text-8xl text-gold-400",children:"\u262f"}),o.jsx("div",{className:"absolute bottom-1/4 right-1/4 text-6xl text-gold-400",children:"\u2694"})]}),o.jsxs("table",{className:"w-full text-sm text-left text-paper-300 table-fixed relative z-10",children:[o.jsx("thead",{className:"text-xs uppercase sticky top-0 z-20",children:o.jsxs("tr",{className:"bg-gradient-to-r from-ink-900/95 via-ink-800/95 to-ink-900/95 border-b-2 border-gold-500/40",children:[o.jsx("th",{scope:"col",className:"p-3 w-16 text-center",children:o.jsx("span",{className:"text-gold-400 font-bold",children:"\ud83c\udfc5 \u6392\u540d"})}),o.jsx("th",{scope:"col",className:"p-3 w-2/5",children:o.jsx("span",{className:"text-gold-400 font-bold",children:"\u2694\ufe0f \u4fee\u58eb\u540d\u53f7"})}),o.jsx("th",{scope:"col",className:"p-3 w-2/5",children:o.jsx("span",{className:"text-gold-400 font-bold",children:"\ud83c\udfef \u6240\u5c5e\u52bf\u529b"})}),o.jsx("th",{scope:"col",className:"p-3 w-1/5 text-right",children:o.jsx("span",{className:"text-gold-400 font-bold",children:"\u2728 \u79ef\u5206"})})]})}),o.jsx("tbody",{children:e.map((e,t)=>{return o.jsxs("tr",{className:`border-b transition-all duration-300 ${n=e.rank,1===n?"bg-gradient-to-r from-yellow-900/40 via-amber-800/30 to-yellow-900/40 border-amber-500/50":2===n?"bg-gradient-to-r from-slate-700/40 via-slate-600/30 to-slate-700/40 border-slate-400/50":3===n?"bg-gradient-to-r from-amber-900/30 via-orange-800/20 to-amber-900/30 border-orange-500/40":"border-ink-600/30 hover:bg-ink-800/40"} hover:scale-[1.01] hover:shadow-lg`,style:{animationDelay:50*t+"ms"},children:[o.jsx("td",{className:"p-3 text-center",children:o.jsx("div",{className:"flex items-center justify-center",children:Wn(e.rank)})}),o.jsxs("td",{className:"p-3 truncate",children:[o.jsx("span",{className:"font-bold "+(e.rank<=3?"text-gold-300":"text-paper-200"),children:e.name}),1===e.rank&&o.jsx("span",{className:"ml-1 text-xs",children:"\ud83d\udc51"})]}),o.jsx("td",{className:"p-3 truncate",children:o.jsx("span",{className:"text-paper-400 italic",children:e.faction})}),o.jsxs("td",{className:"p-3 text-right",children:[o.jsx("span",{className:"font-mono font-bold "+(1===e.rank?"text-yellow-400 text-shadow-glow":2===e.rank?"text-slate-300":3===e.rank?"text-orange-400":"text-gold-400/80"),children:e.points.toLocaleString()}),e.rank<=3&&o.jsx("span",{className:"ml-1",children:"\u2b50"})]})]},e.rank);var n})})]}),o.jsxs("div",{className:"mt-4 text-center text-paper-500 text-xs",children:[o.jsx("span",{className:"opacity-50",children:"\u3013"}),o.jsx("span",{className:"mx-2 italic",children:"\u5929\u9053\u916c\u52e4\uff0c\u9053\u5fc3\u6c38\u56fa"}),o.jsx("span",{className:"opacity-50",children:"\u3013"})]})]}),Gn=({label:e,isActive:t,onClick:n,isSubTab:s})=>o.jsx("button",{onClick:n,className:"px-4 transition-all duration-300 font-semibold "+(s?"py-1 text-sm rounded-lg "+(t?"bg-gold-600/30 text-gold-300 border border-gold-500/40":"bg-ink-700/60 text-ink-300 hover:bg-ink-600/70 hover:text-gold-300 border border-ink-700/50"):"py-2 text-base rounded-t-lg "+(t?"bg-ink-800/90 text-gold-400 border-b-2 border-gold-500/60 shadow-[0_0_10px_rgba(180,149,106,0.15)]":"bg-transparent text-ink-400 hover:bg-ink-800/50 hover:text-gold-300")),children:e}),Jn=({playerProfile:e,leaderboards:t,onMatchFound:n,gameState:s,onLeaderboardsUpdate:r})=>{const[a,l]=x.useState("\u5b97\u95e8\u6392\u884c\u699c"),[i,c]=x.useState("\u603b\u699c"),[d,u]=x.useState(!1),[m,p]=x.useState(!1),h=e.arenaRank,f=t;return o.jsxs("div",{className:"h-full flex flex-col md:flex-row font-serif text-ink-300 p-4 gap-4 bg-gradient-to-br from-ink-900/30 via-ink-950/50 to-ink-900/30",children:[o.jsxs("div",{className:"flex-shrink-0 md:w-1/3 ink-card p-6 rounded-lg flex flex-col items-center justify-center text-center relative xianxia-frame",children:[o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gold-500/10 text-8xl pointer-events-none",children:"\u262f"}),o.jsx("div",{className:"absolute top-3 left-3 w-5 h-5 border-l-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute top-3 right-3 w-5 h-5 border-r-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-3 left-3 w-5 h-5 border-l-2 border-b-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-3 right-3 w-5 h-5 border-r-2 border-b-2 border-gold-500/25"}),o.jsxs("h2",{className:"text-2xl font-bold text-gold-400 mb-4 font-brush tracking-wider relative z-10",children:[o.jsx("span",{className:"text-gold-500/50 mr-2",children:"\u3013"}),"\u6211\u7684\u6218\u7ee9",o.jsx("span",{className:"text-gold-500/50 ml-2",children:"\u3013"})]}),o.jsx("div",{className:"text-6xl mb-4 relative z-10 filter drop-shadow-[0_0_8px_rgba(180,149,106,0.4)]",children:h.tierIcon}),o.jsxs("p",{className:"text-3xl font-bold text-gold-300 font-elegant relative z-10",children:[h.tier," ",h.division]}),o.jsxs("p",{className:"text-lg text-ink-400 mt-2 flex items-center gap-2 relative z-10",children:[o.jsx("span",{className:"text-gold-500",children:"\u25c8"}),h.points," \u79ef\u5206"]}),o.jsx("button",{onClick:()=>{u(!0),setTimeout(()=>{const t=Ye.filter(t=>t.id!==e.name),s={...t[Math.floor(Math.random()*t.length)],id:`arena-opponent-${Date.now()}`};n(s)},2500)},disabled:d,className:"mt-8 bg-gradient-to-r from-cinnabar-600 to-cinnabar-500 text-white font-bold py-3 px-8 rounded-lg hover:from-cinnabar-500 hover:to-cinnabar-400 transition-all duration-300 shadow-[0_0_15px_rgba(166,61,61,0.3)] w-40 h-14 flex items-center justify-center disabled:from-ink-600 disabled:to-ink-700 disabled:cursor-wait border border-cinnabar-400/50 font-elegant tracking-wider relative z-10",children:d?o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"animate-spin",children:"\u262f"}),"\u5bfb\u654c\u4e2d..."]}):o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("span",{children:"\u2694"}),"\u5bfb\u627e\u5bf9\u6218"]})})]}),o.jsxs("div",{className:"flex-grow ink-card p-4 rounded-lg flex flex-col relative xianxia-frame",children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/40 to-transparent"}),o.jsxs("div",{className:"flex-shrink-0 border-b border-gold-600/20",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("div",{className:"flex space-x-2",children:Object.keys(f).map(e=>o.jsx(Gn,{label:e,isActive:a===e,onClick:()=>l(e)},e))}),o.jsxs("button",{onClick:async()=>{p(!0);try{const e=await Hn(s);r(e)}catch(e){console.error("[\u7ade\u6280\u573a] \u699c\u5355\u5237\u65b0\u5931\u8d25:",e),alert("\u699c\u5355\u5237\u65b0\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u63a7\u5236\u53f0\u4e86\u89e3\u8be6\u60c5")}finally{p(!1)}},disabled:m,className:"qi-flow-btn px-4 py-2 font-semibold rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-wait flex items-center gap-2",title:"AI\u751f\u6210\u65b0\u7684\u699c\u5355",children:[o.jsx("span",{className:m?"animate-spin":"",children:"\ud83d\udd04"}),m?"\u751f\u6210\u4e2d...":"\u5237\u65b0\u699c\u5355"]})]}),"\u5b97\u95e8\u6392\u884c\u699c"===a&&o.jsx("div",{className:"px-2 py-2 flex space-x-2 flex-wrap",children:Object.keys(f["\u5b97\u95e8\u6392\u884c\u699c"]).map(e=>o.jsx(Gn,{label:e,isActive:i===e,onClick:()=>c(e),isSubTab:!0},e))})]}),o.jsx("div",{className:"flex-grow overflow-y-auto mt-2",children:o.jsx(Qn,{data:"\u5b97\u95e8\u6392\u884c\u699c"===a?f[a][i]:f[a]})})]})]})},Kn=e=>({attack:"\u653b\u51fb",defense:"\u9632\u5fa1",hp:"\u6c14\u8840",speed:"\u901f\u5ea6",critRate:"\u4f1a\u5fc3\u7387",critDmg:"\u4f1a\u5fc3\u4f24\u5bb3"}[e]||e),Yn=(e,t)=>"critRate"===e||"critDmg"===e?`+${(100*t).toFixed(0)}%`:t>0?`+${t}`:`${t}`,Xn=({item:e,onClose:t})=>{const n=e.genderLock&&"Universal"!==e.genderLock?"Male"===e.genderLock?"\u7537\u6027\u4e13\u7528":"\u5973\u6027\u4e13\u7528":"\u901a\u7528";return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-md shadow-2xl flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"p-4 flex justify-between items-center bg-black/20",children:[o.jsxs("h2",{className:"text-xl font-bold text-white font-serif flex items-baseline gap-2",children:[o.jsx("span",{children:e.name}),o.jsxs("span",{className:`text-base font-medium ${L(e.rarity)}`,children:["[",e.rarity,"]"]})]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"p-6 font-serif",children:[o.jsxs("div",{className:"flex justify-between items-baseline mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-amber-400",children:"\u6cd5\u5b9d\u8be6\u60c5"}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-base text-gray-400",children:e.type}),o.jsx("p",{className:"text-sm text-gray-400",children:n})]})]}),o.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50 mb-4",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-2 text-sm",children:"\u5c5e\u6027"}),o.jsx("div",{className:"space-y-1",children:Object.entries(e.stats).map(([e,t])=>o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-300",children:Kn(e)}),o.jsx("span",{className:"font-mono text-green-400",children:Yn(e,t)})]},e))})]}),o.jsxs("div",{className:"bg-black/20 p-3 rounded-md border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-1 text-sm",children:"\u63cf\u8ff0"}),o.jsx("p",{className:"text-gray-300 leading-relaxed text-sm italic",children:e.description})]})]})]})})},Zn=({label:e,isActive:t,onClick:n})=>o.jsx("button",{onClick:n,className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-all duration-300 "+(t?"bg-ink-800/90 text-gold-400 border-b-2 border-gold-500/60 shadow-[0_0_10px_rgba(180,149,106,0.15)]":"bg-transparent text-ink-400 hover:bg-ink-800/50 hover:text-gold-300"),children:e}),es=({label:e,isActive:t,onClick:n})=>o.jsx("button",{onClick:n,className:"px-3 py-1 text-xs rounded transition-all duration-300 "+(t?"bg-gold-600/30 text-gold-300 border border-gold-500/40":"bg-ink-700/60 hover:bg-ink-600/70 text-ink-300 hover:text-gold-300 border border-ink-600/50"),children:e}),ts=({card:e})=>o.jsxs("div",{className:`ink-card p-3 rounded-lg text-center h-full relative ${M(e.rarity)}`,children:[o.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 border-l border-t border-gold-500/25"}),o.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 border-r border-t border-gold-500/25"}),o.jsxs("p",{className:"font-bold font-elegant text-gold-300 flex items-center justify-center gap-1",children:[o.jsx("span",{className:"text-gold-500/50 text-xs",children:"\u25c6"}),e.name]}),o.jsx("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:e.realm}),o.jsx("p",{className:"text-xs text-ink-400 mt-1 truncate",children:e.title})]}),ns=({gender:e})=>{if(!e||"Universal"===e)return null;const t="Male"===e?"\u2642":"\u2640",n="Male"===e?"text-blue-400":"text-pink-400";return o.jsx("div",{className:`absolute top-1 right-1 w-5 h-5 rounded-full bg-ink-900/70 flex items-center justify-center font-bold ${n} border border-ink-700/50`,children:t})},ss=({skill:e})=>o.jsxs("div",{className:`ink-card relative p-3 rounded-lg h-full ${M(e.rarity)}`,children:[o.jsx(ns,{gender:e.genderLock}),o.jsxs("div",{className:"flex justify-between items-baseline",children:[o.jsxs("h5",{className:`font-bold font-elegant ${L(e.rarity)}`,children:[o.jsx("span",{className:"text-gold-500/40 mr-1",children:"\u2727"}),e.name]}),o.jsxs("span",{className:"text-sm font-mono text-blue-400 flex items-center gap-1",children:[o.jsx("span",{className:"text-blue-500/60",children:"\u2726"}),e.cost," \u771f\u5143"]})]}),o.jsx("p",{className:"text-sm text-ink-300 mt-1 line-clamp-2",children:e.description})]}),rs=({item:e})=>o.jsxs("div",{className:`ink-card relative p-3 rounded-lg h-full ${M(e.rarity)}`,children:[o.jsx(ns,{gender:e.genderLock}),o.jsxs("h5",{className:`font-bold font-elegant truncate ${L(e.rarity)}`,children:[o.jsx("span",{className:"text-gold-500/40 mr-1",children:"\u2694"}),e.name]}),o.jsx("div",{className:"text-xs text-ink-300 mt-1 space-y-0.5",children:Object.entries(e.stats).map(([e,t])=>o.jsxs("p",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"text-gold-500/50",children:"\u25c7"}),e,": ",o.jsxs("span",{className:"text-green-400",children:["+",t]})]},e))})]}),as=({card:e})=>o.jsxs("div",{className:`ink-card relative p-3 rounded-lg text-center h-full ${M(e.rarity)}`,children:[o.jsx(ns,{gender:e.gender}),o.jsxs("p",{className:"font-bold font-elegant text-gold-300 flex items-center justify-center gap-1",children:[o.jsx("span",{className:"text-gold-500/50 text-xs",children:"\ud83d\udc3e"}),e.name]}),o.jsxs("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:["[",e.rarity,"]"]}),o.jsx("p",{className:"text-xs text-ink-400 mt-1 truncate",children:e.description})]}),ls=({playerProfile:e,setPlayerProfile:t,onViewPet:n})=>{const[s,r]=x.useState("\u56fe\u9274"),[a,l]=x.useState("\u7537\u6027\u89d2\u8272"),[i,c]=x.useState("\u6b66\u5668"),[d,u]=x.useState("\u96c4\u6027"),[m,p]=x.useState("All"),[h,f]=x.useState("\u7537\u6027\u4e13\u7528"),[g,b]=x.useState(null),[y,v]=x.useState(null),[j,N]=x.useState(null),[w,k]=x.useState("default"),[C,S]=x.useState("default"),[E,P]=x.useState(!1),[$,_]=x.useState(null),[D,M]=x.useState(null),A=["\u795e\u54c1","\u5723\u54c1","\u4ed9\u54c1","\u7edd\u54c1","\u73cd\u54c1","\u4f18\u54c1","\u826f\u54c1","\u51e1\u54c1"];return o.jsxs("div",{className:"h-full flex flex-col font-serif text-ink-300 bg-gradient-to-br from-ink-900/50 via-ink-950/70 to-ink-900/50",children:[o.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-gold-600/20 bg-ink-900/50",children:[o.jsx(Zn,{label:"\ud83d\udcd6 \u56fe\u9274",isActive:"\u56fe\u9274"===s,onClick:()=>r("\u56fe\u9274")}),o.jsx(Zn,{label:"\ud83d\udc3e \u517d\u5ba0",isActive:"\u517d\u5ba0"===s,onClick:()=>r("\u517d\u5ba0")}),o.jsx(Zn,{label:"\ud83d\udcdc \u6280\u80fd\u5e93",isActive:"\u901a\u7528\u6280\u80fd\u5e93"===s,onClick:()=>r("\u901a\u7528\u6280\u80fd\u5e93")}),o.jsx(Zn,{label:"\u2694 \u88c5\u5907\u5e93",isActive:"\u88c5\u5907\u5e93"===s,onClick:()=>r("\u88c5\u5907\u5e93")}),o.jsx(Zn,{label:"\ud83d\udce6 \u9053\u5177",isActive:"\u65e5\u5e38\u9053\u5177"===s,onClick:()=>r("\u65e5\u5e38\u9053\u5177")})]}),o.jsx("div",{className:"flex-grow overflow-y-auto bg-ink-950/30 relative",children:(()=>{switch(s){case"\u56fe\u9274":const t=[...e.cardCollection].filter(e=>e.gender===("\u7537\u6027\u89d2\u8272"===a?"Male":"Female")).sort((e,t)=>"rarity"===w?A.indexOf(e.rarity)-A.indexOf(t.rarity):0);return o.jsxs("div",{children:[o.jsxs("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zn,{label:"\u7537\u6027\u89d2\u8272",isActive:"\u7537\u6027\u89d2\u8272"===a,onClick:()=>l("\u7537\u6027\u89d2\u8272")}),o.jsx(Zn,{label:"\u5973\u6027\u89d2\u8272",isActive:"\u5973\u6027\u89d2\u8272"===a,onClick:()=>l("\u5973\u6027\u89d2\u8272")})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[o.jsx("span",{children:"\u6392\u5e8f:"}),o.jsx(es,{label:"\u9ed8\u8ba4",isActive:"default"===w,onClick:()=>k("default")}),o.jsx(es,{label:"\u7a00\u6709\u5ea6",isActive:"rarity"===w,onClick:()=>k("rarity")})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("span",{className:"text-sm font-semibold transition-colors "+(E?"text-red-400":"text-gray-400"),children:"\u51fa\u552e\u6a21\u5f0f"}),o.jsx("button",{onClick:()=>P(!E),className:"relative inline-flex items-center h-6 rounded-full w-11 transition-colors "+(E?"bg-red-600":"bg-stone-600"),children:o.jsx("span",{className:"inline-block w-4 h-4 transform bg-white rounded-full transition-transform "+(E?"translate-x-6":"translate-x-1")})})]})]})]}),o.jsx("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:t.map(e=>o.jsxs("button",{onClick:()=>E?_(e):b(e),className:"relative text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:[o.jsx(ts,{card:e}),E&&o.jsx("div",{className:"absolute inset-0 bg-red-800/60 flex items-center justify-center rounded-lg cursor-pointer",children:o.jsx("span",{className:"text-white font-bold text-lg",children:"\u51fa\u552e"})})]},e.id))})]});case"\u901a\u7528\u6280\u80fd\u5e93":const s={"\u7537\u6027\u4e13\u7528":"Male","\u5973\u6027\u4e13\u7528":"Female","\u901a\u7528":"Universal"},r=e.universalSkills.filter(e=>e.genderLock===s[h]),x=r.reduce((e,t)=>((e[t.rarity]=e[t.rarity]||[]).push(t),e),{});return o.jsxs("div",{children:[o.jsx("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zn,{label:"\u7537\u6027\u4e13\u7528",isActive:"\u7537\u6027\u4e13\u7528"===h,onClick:()=>f("\u7537\u6027\u4e13\u7528")}),o.jsx(Zn,{label:"\u5973\u6027\u4e13\u7528",isActive:"\u5973\u6027\u4e13\u7528"===h,onClick:()=>f("\u5973\u6027\u4e13\u7528")}),o.jsx(Zn,{label:"\u901a\u7528",isActive:"\u901a\u7528"===h,onClick:()=>f("\u901a\u7528")})]})}),o.jsxs("div",{className:"p-4 space-y-4",children:[A.map(e=>x[e]&&x[e].length>0?o.jsxs("div",{children:[o.jsxs("h4",{className:`font-semibold mb-2 text-lg ${L(e)}`,children:["\u3010",e,"\u3011"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x[e].map(e=>o.jsx("button",{onClick:()=>v(e),className:"text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:o.jsx(ss,{skill:e})},e.id))})]},e):null),0===r.length&&o.jsx("div",{className:"text-center text-gray-500 pt-10",children:o.jsx("p",{children:"\u8be5\u5206\u7c7b\u4e0b\u6682\u65e0\u6280\u80fd\u3002"})})]})]});case"\u88c5\u5907\u5e93":const g={"\u6b66\u5668":"Weapon","\u8863\u670d":"Armor","\u9970\u54c1":"Accessory"},y=e.equipmentInventory.filter(e=>e.type===g[i]).filter(e=>"All"===m||("Universal"===m?!e.genderLock||"Universal"===e.genderLock:e.genderLock===m)).sort((e,t)=>"rarity"===C?A.indexOf(e.rarity)-A.indexOf(t.rarity):0);return o.jsxs("div",{children:[o.jsxs("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:[o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zn,{label:"\u6b66\u5668",isActive:"\u6b66\u5668"===i,onClick:()=>{c("\u6b66\u5668"),p("All")}}),o.jsx(Zn,{label:"\u8863\u670d",isActive:"\u8863\u670d"===i,onClick:()=>{c("\u8863\u670d"),p("All")}}),o.jsx(Zn,{label:"\u9970\u54c1",isActive:"\u9970\u54c1"===i,onClick:()=>{c("\u9970\u54c1"),p("All")}})]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[o.jsx("span",{children:"\u6392\u5e8f:"}),o.jsx(es,{label:"\u9ed8\u8ba4",isActive:"default"===C,onClick:()=>S("default")}),o.jsx(es,{label:"\u7a00\u6709\u5ea6",isActive:"rarity"===C,onClick:()=>S("rarity")})]})]}),o.jsxs("div",{className:"px-4 py-2 flex items-center gap-3 bg-stone-800/50 border-b border-stone-700",children:[o.jsx("span",{className:"text-sm font-semibold text-gray-400",children:"\u7b5b\u9009:"}),o.jsx(es,{label:"\u5168\u90e8",isActive:"All"===m,onClick:()=>p("All")}),o.jsx(es,{label:"\u7537\u6027\u4e13\u7528",isActive:"Male"===m,onClick:()=>p("Male")}),o.jsx(es,{label:"\u5973\u6027\u4e13\u7528",isActive:"Female"===m,onClick:()=>p("Female")}),o.jsx(es,{label:"\u901a\u7528",isActive:"Universal"===m,onClick:()=>p("Universal")})]}),o.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[y.map(e=>o.jsx("button",{onClick:()=>N(e),className:"text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:o.jsx(rs,{item:e})},e.id)),0===y.length&&o.jsx("div",{className:"col-span-full text-center text-gray-500 pt-10",children:o.jsx("p",{children:"\u8be5\u5206\u7c7b\u4e0b\u6682\u65e0\u88c5\u5907\u3002"})})]})]});case"\u65e5\u5e38\u9053\u5177":return o.jsxs("div",{className:"p-6 text-center text-gray-500 font-serif flex flex-col items-center justify-center h-full",children:[o.jsx("div",{className:"text-4xl mb-4",children:"\ud83d\udce6"}),o.jsx("p",{children:"\u6b64\u529f\u80fd\u5c1a\u672a\u5f00\u653e\u3002"}),o.jsx("p",{className:"mt-2",children:"\u672a\u6765\u7684\u4e39\u836f\u3001\u6750\u6599\u7b49\u6d88\u8017\u54c1\u5c06\u5728\u6b64\u5904\u5c55\u793a\u3002"})]});case"\u517d\u5ba0":const j=[...e.petCollection].filter(e=>e.gender===("\u96c4\u6027"===d?"Male":"Female")).sort((e,t)=>A.indexOf(e.rarity)-A.indexOf(t.rarity));return o.jsxs("div",{children:[o.jsx("div",{className:"px-4 pt-2 flex justify-between items-center border-b border-stone-700 bg-stone-800/50 sticky top-0 backdrop-blur-sm z-10",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zn,{label:"\u96c4\u6027",isActive:"\u96c4\u6027"===d,onClick:()=>u("\u96c4\u6027")}),o.jsx(Zn,{label:"\u96cc\u6027",isActive:"\u96cc\u6027"===d,onClick:()=>u("\u96cc\u6027")})]})}),o.jsxs("div",{className:"p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[j.map(e=>o.jsx("button",{onClick:()=>n(e),className:"relative text-left transition-transform duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-lg",children:o.jsx(as,{card:e})},e.id)),0===j.length&&o.jsx("div",{className:"col-span-full text-center text-gray-500 pt-10",children:o.jsx("p",{children:"\u8be5\u5206\u7c7b\u4e0b\u6682\u65e0\u517d\u5ba0\u3002"})})]})]})}})()}),g&&o.jsx(Jt,{card:g,onClose:()=>b(null),playerProfile:e,setPlayerProfile:t,onViewPet:n}),y&&o.jsx(Vt,{skill:y,onClose:()=>v(null)}),j&&o.jsx(Xn,{item:j,onClose:()=>N(null)}),$&&o.jsx("div",{className:"fixed inset-0 bg-ink-950/85 z-50 flex items-center justify-center p-4 animate-fade-in backdrop-blur-sm",children:o.jsxs("div",{className:"ink-card rounded-xl w-full max-w-md shadow-2xl p-6 text-center font-serif relative xianxia-frame",children:[o.jsx("div",{className:"absolute top-3 left-3 w-4 h-4 border-l-2 border-t-2 border-gold-500/30"}),o.jsx("div",{className:"absolute top-3 right-3 w-4 h-4 border-r-2 border-t-2 border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-3 left-3 w-4 h-4 border-l-2 border-b-2 border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-3 right-3 w-4 h-4 border-r-2 border-b-2 border-gold-500/30"}),o.jsxs("h3",{className:"text-xl font-bold text-gold-400 mb-2 font-brush tracking-wider",children:[o.jsx("span",{className:"text-gold-500/50 mr-2",children:"\u3013"}),"\u786e\u8ba4\u51fa\u552e",o.jsx("span",{className:"text-gold-500/50 ml-2",children:"\u3013"})]}),o.jsxs("p",{className:"text-ink-300",children:["\u4f60\u786e\u5b9a\u8981\u51fa\u552e ",o.jsxs("span",{className:`font-semibold ${L($.rarity)}`,children:["[",$.rarity,"] ",$.name]})," \u5417?"]}),o.jsxs("p",{className:"text-lg text-gold-400 font-bold my-4 flex items-center justify-center gap-2",children:[o.jsx("span",{className:"text-gold-500",children:"\u25c8"}),"\u4f60\u5c06\u83b7\u5f97 ",Xe[$.rarity]||0," \u7075\u77f3"]}),D&&o.jsx("p",{className:"text-cinnabar-400 text-sm mb-4 animate-shake",children:D}),o.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[o.jsx("button",{onClick:()=>_(null),className:"px-6 py-2 bg-ink-700/80 hover:bg-ink-600/80 rounded-lg font-semibold text-ink-300 hover:text-gold-300 border border-ink-600/50 hover:border-gold-500/30 transition-all duration-300",children:"\u53d6\u6d88"}),o.jsx("button",{onClick:()=>{if(!$)return;M(null);const n=e.maleParty.some(e=>e.id===$.id),s=e.femaleParty.some(e=>e.id===$.id);if(n||s)return M("\u65e0\u6cd5\u51fa\u552e\u4e0a\u9635\u4e2d\u7684\u89d2\u8272\u5361\uff01"),setTimeout(()=>M(null),3e3),void _(null);const r=Xe[$.rarity]||0,a={...e,spiritStones:e.spiritStones+r,cardCollection:e.cardCollection.filter(e=>e.id!==$.id)};t(a),_(null)},className:"px-6 py-2 bg-gradient-to-r from-cinnabar-600 to-cinnabar-500 text-white hover:from-cinnabar-500 hover:to-cinnabar-400 rounded-lg font-bold border border-cinnabar-400/50 transition-all duration-300",children:"\u786e\u8ba4\u51fa\u552e"})]})]})})]})},is=({playerProfile:e,setPlayerProfile:t,onViewPet:n})=>{const[s,r]=x.useState(null),[a,l]=x.useState(null),i=({gender:s})=>{const i="Male"===s?e.maleParty:e.femaleParty,c=e.cardCollection.filter(e=>e.gender===s),d=e=>i.some(t=>t.id===e);return o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800/70 via-stone-900/80 to-black/70 p-4 rounded-lg flex flex-col h-full shadow-glow-gold",children:[o.jsx("h3",{className:"text-center font-bold text-gradient-gold mb-3 text-xl text-shadow-glow",children:"Male"===s?"\u7537\u6027\u7f16\u961f \u2694\ufe0f":"\u5973\u6027\u7f16\u961f \ud83c\udf38"}),o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"font-semibold text-gradient-gold mb-2 text-shadow-glow",children:["\u4e0a\u9635\u961f\u4f0d (",i.length,"/4)"]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:[...Array(4)].map((c,d)=>o.jsxs("div",{className:"relative",children:[o.jsx("div",{onClick:()=>((n,s)=>{if(!a)return;if(a.gender!==s)return;const r=JSON.parse(JSON.stringify(e)),i="Male"===s?"maleParty":"femaleParty";r.maleParty=r.maleParty.filter(e=>e.id!==a.id),r.femaleParty=r.femaleParty.filter(e=>e.id!==a.id);const o=r[i],c=o[n];c?-1!==e[i].findIndex(e=>e.id===c.id)&&(o[n]=a):o[n]=a;const d=[...Array(4)].map((e,t)=>o[t]||null).filter(Boolean);r[i]=d,t(r),l(null)})(d,s),className:"h-28 w-full rounded-lg flex flex-col items-center justify-center p-2 text-center transition-all duration-300 border-2 cursor-pointer "+(i[d]?`${M(i[d].rarity)} bg-gradient-to-br from-stone-700/60 to-stone-800/70 hover:from-stone-600/80 hover:to-stone-700/90 shadow-lg hover:shadow-glow-gold`:"border-dashed border-stone-600 bg-black/30 hover:bg-stone-800/50 hover:border-amber-500/50"),children:i[d]?o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"font-bold font-serif text-white text-sm text-shadow-glow",children:i[d].name}),o.jsx("p",{className:`text-xs font-semibold ${L(i[d].rarity)}`,children:i[d].realm}),i[d].pet&&o.jsx("button",{onClick:e=>{e.stopPropagation(),n(i[d].pet)},className:"absolute -bottom-1 -left-1 bg-purple-600 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:bg-purple-500 transition-colors z-10 border border-stone-900 shadow-glow-purple",title:`\u517d\u5ba0: ${i[d].pet.name}`,children:"\ud83d\udc3e"})]}):o.jsx("span",{className:"text-stone-500 text-3xl opacity-50 hover:text-amber-400 hover:opacity-80 transition-all duration-300",children:"+"})}),i[d]&&o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:n=>{n.stopPropagation(),((n,s)=>{const r=JSON.parse(JSON.stringify(e)),a="Male"===s?"maleParty":"femaleParty";r[a]=r[a].filter(e=>e.id!==n),t(r)})(i[d].id,s)},className:"absolute -top-1 -right-1 bg-gradient-to-br from-red-600 to-red-700 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:from-red-500 hover:to-red-600 transition-all duration-300 z-10 border border-stone-900 shadow-glow-red hover:scale-110",title:"\u5378\u4e0b",children:"\xd7"}),o.jsx("button",{onClick:e=>{e.stopPropagation(),r(i[d])},className:"absolute -bottom-1 -right-1 bg-gradient-to-br from-sky-600 to-sky-700 text-white w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center hover:from-sky-500 hover:to-sky-600 transition-all duration-300 z-10 border border-stone-900 shadow-glow-blue hover:scale-110",title:"\u8be6\u60c5",children:"i"})]})]},d))})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto pr-2 scrollbar-xianxia",children:[o.jsx("h4",{className:"font-semibold text-gradient-gold mb-2 text-shadow-glow",children:"\u56fe\u9274"}),o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:c.map(e=>o.jsxs("button",{onClick:()=>(e=>{l(e)})(e),onDoubleClick:()=>r(e),disabled:d(e.id),className:`relative p-2 rounded-lg border-2 text-center transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed hover:scale-105 ${a?.id===e.id?"ring-4 ring-green-500 ring-offset-2 ring-offset-stone-800 shadow-glow-green animate-pulse-slow":""} ${M(e.rarity)} ${T(e.rarity,!d(e.id))} hover:shadow-lg`,children:[o.jsx("p",{className:"font-bold font-serif text-white text-sm text-shadow-glow",children:e.name}),o.jsx("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:e.realm}),d(e.id)&&o.jsx("div",{className:"absolute top-0.5 right-0.5 bg-gradient-to-r from-amber-500 to-amber-600 text-white text-[9px] px-1.5 rounded-full font-bold shadow-glow-gold animate-shimmer",children:"\u4e0a\u9635"})]},e.id))})]})]})};return o.jsxs("div",{className:"p-4 sm:p-6 text-gray-300 font-serif h-full bg-gradient-to-br from-stone-900 via-stone-950 to-black",children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[o.jsx(i,{gender:"Male"}),o.jsx(i,{gender:"Female"})]}),s&&o.jsx(Jt,{card:s,onClose:()=>r(null),playerProfile:e,setPlayerProfile:t,onViewPet:n})]})},os=e=>!!(e&&e.stats&&["Weapon","Armor","Accessory"].includes(e.type)),cs=e=>!(!e||void 0===e.cost||!e.mechanicsDescription),ds=e=>!(!e||!e.skill||e.baseAttributes),us=e=>"compensation"===e.type,ms=({gender:e})=>{if("Universal"===e||!e)return null;const t="Male"===e?"\u2642":"\u2640",n="Male"===e?"text-sky-400":"text-pink-400";return o.jsx("div",{className:`absolute top-1 right-1 w-6 h-6 rounded-full bg-ink-900/80 border border-gold-500/30 flex items-center justify-center font-bold text-sm ${n} shadow-lg`,children:t})},xs=({item:e,isRevealed:t,onReveal:n,index:s})=>{const[r,a]=x.useState(!1);x.useEffect(()=>{if(t){const e=setTimeout(()=>{a(!0)},100*s);return()=>clearTimeout(e)}},[t,s]);const l=(()=>{const t=(e=>us(e)?"\ud83d\udc8e":(e=>!!(e&&e.gender&&e.skills))(e)?"Male"===e.gender?"\ud83d\udc09":"\ud83e\udd8b":ds(e)?"\ud83d\udc3e":os(e)?"Weapon"===e.type?"\u2694\ufe0f":"Armor"===e.type?"\ud83d\udee1\ufe0f":"\ud83d\udc8d":cs(e)?"\ud83d\udcdc":"\u2753")(e),n="\u4ed9\u54c1"===e.rarity||"\u5723\u54c1"===e.rarity||"\u795e\u54c1"===e.rarity;return o.jsx("div",{className:"text-4xl mb-2 "+(n?"animate-pulse":""),children:t})})();return o.jsx("div",{className:"w-full aspect-[3/4] [perspective:1000px] group cursor-pointer",onClick:()=>{r||(a(!0),n())},style:{animationDelay:50*s+"ms"},children:o.jsxs("div",{className:"relative w-full h-full transition-transform duration-700 [transform-style:preserve-3d] "+(r?"[transform:rotateY(180deg)]":""),children:[o.jsxs("div",{className:"absolute w-full h-full [backface-visibility:hidden] rounded-lg overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-ink-900 via-ink-800 to-ink-900 border-2 border-gold-600/50"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"text-6xl text-gold-500/30 animate-spin-slow",children:"\u262f"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("span",{className:"text-3xl text-gold-400/60 animate-pulse",children:"?"})})]})}),o.jsx("div",{className:"absolute top-1 left-1 text-gold-500/40 text-xs",children:"\u25c8"}),o.jsx("div",{className:"absolute top-1 right-1 text-gold-500/40 text-xs",children:"\u25c8"}),o.jsx("div",{className:"absolute bottom-1 left-1 text-gold-500/40 text-xs",children:"\u25c8"}),o.jsx("div",{className:"absolute bottom-1 right-1 text-gold-500/40 text-xs",children:"\u25c8"}),o.jsx("div",{className:"absolute bottom-3 left-0 right-0 text-center",children:o.jsx("span",{className:"text-gold-400/60 text-xs",children:"\u70b9\u51fb\u63ed\u793a"})})]}),o.jsxs("div",{className:`absolute w-full h-full [backface-visibility:hidden] [transform:rotateY(180deg)] rounded-lg overflow-hidden flex flex-col justify-between p-2 text-center ${A(e.rarity)} ${M(e.rarity)}`,children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-ink-900/95 via-ink-800/95 to-ink-900/95"}),o.jsxs("div",{className:"absolute inset-0 opacity-10",children:[o.jsx("div",{className:"absolute top-2 left-2 text-gold-400",children:"\u2727"}),o.jsx("div",{className:"absolute top-2 right-2 text-gold-400",children:"\u2727"}),o.jsx("div",{className:"absolute bottom-2 left-2 text-gold-400",children:"\u2727"}),o.jsx("div",{className:"absolute bottom-2 right-2 text-gold-400",children:"\u2727"})]}),(os(e)||cs(e)||ds(e))&&o.jsx(ms,{gender:ds(e)?e.gender:e.genderLock}),o.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center relative z-10",children:[l,o.jsx("p",{className:"text-sm font-bold text-paper-100 font-serif leading-tight px-1",children:e.name}),us(e)&&o.jsx("p",{className:"text-xs text-gold-300 mt-1 px-1 italic",children:e.description})]}),o.jsx("div",{className:"relative z-10",children:o.jsxs("p",{className:`text-xs font-semibold ${L(e.rarity)}`,children:["\u3014",e.rarity,"\u3015"]})})]})]})})},ps=({results:e,onClose:t})=>{const[n,s]=x.useState(new Set),r=1===e.length,a=n.size===e.length,l=e.reduce((e,t)=>(e[t.rarity]=(e[t.rarity]||0)+1,e),{});return o.jsxs("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",children:[o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[o.jsx("div",{className:"absolute top-10 left-10 text-8xl text-gold-500/5 animate-pulse",children:"\u262f"}),o.jsx("div",{className:"absolute bottom-10 right-10 text-8xl text-gold-500/5 animate-pulse",style:{animationDelay:"1s"},children:"\u262f"}),o.jsx("div",{className:"absolute top-1/2 left-1/4 text-4xl text-gold-400/5",children:"\u2727"}),o.jsx("div",{className:"absolute top-1/3 right-1/4 text-4xl text-gold-400/5",children:"\u2727"})]}),o.jsxs("div",{className:"relative bg-gradient-to-br from-ink-900/98 via-ink-800/98 to-ink-900/98 border-2 border-gold-600/50 rounded-xl w-full max-w-4xl h-auto max-h-[90vh] shadow-2xl flex flex-col backdrop-blur-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"}),o.jsxs("div",{className:"relative p-4 flex-shrink-0 border-b border-gold-600/30",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-gold-500/5 to-transparent"}),o.jsxs("h2",{className:"text-2xl font-bold text-gold-300 font-serif text-center relative z-10 flex items-center justify-center gap-3",children:[o.jsx("span",{className:"text-gold-500/60",children:"\u2726"}),o.jsx("span",{children:"\u5929\u547d\u8f6e\u56de \xb7 \u62db\u52df\u7ed3\u679c"}),o.jsx("span",{className:"text-gold-500/60",children:"\u2726"})]}),!r&&a&&o.jsx("div",{className:"flex justify-center gap-4 mt-2 text-xs",children:Object.entries(l).map(([e,t])=>o.jsxs("span",{className:`${L(e)}`,children:[e,": ",t]},e))})]}),o.jsx("div",{className:"flex-grow p-4 overflow-y-auto "+(r?"flex items-center justify-center":"grid grid-cols-5 gap-3"),children:e.map((e,t)=>o.jsx("div",{className:r?"w-48":"",children:o.jsx(xs,{item:e,isRevealed:n.has(t),onReveal:()=>(e=>{s(t=>new Set(t).add(e))})(t),index:t})},t))}),o.jsxs("div",{className:"p-4 flex-shrink-0 flex justify-center items-center gap-4 border-t border-gold-600/30 bg-ink-900/50",children:[!r&&o.jsx("button",{onClick:()=>{const t=new Set(e.map((e,t)=>t));s(t)},disabled:a,className:"qi-flow-btn px-6 py-2 rounded-lg font-bold transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed hover:scale-105",children:o.jsx("span",{className:"relative z-10 text-paper-200",children:"\u2728 \u5168\u90e8\u63ed\u793a"})}),o.jsx("button",{onClick:t,disabled:!a,className:"bg-gradient-to-r from-gold-700 via-gold-600 to-gold-700 hover:from-gold-600 hover:via-gold-500 hover:to-gold-600 text-ink-900 font-bold py-2 px-8 rounded-lg transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed hover:scale-105 hover:shadow-lg hover:shadow-gold-500/30",children:"\ud83d\udce6 \u6536\u5165\u4e7e\u5764\u888b"})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"})]})]})},hs=e=>!!(e&&e.gender&&e.skills),fs=e=>!!(e&&e.stats&&["Weapon","Armor","Accessory"].includes(e.type)),gs=e=>!(!e||void 0===e.cost||!e.mechanicsDescription),bs=e=>!(!e||!e.skill||e.baseAttributes),ys=e=>"compensation"===e.type,vs=({label:e,isActive:t,onClick:n})=>o.jsx("button",{onClick:n,className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-all duration-300 "+(t?"bg-ink-800/90 text-gold-400 border-b-2 border-gold-500/60 shadow-[0_0_10px_rgba(180,149,106,0.15)]":"bg-transparent text-ink-400 hover:bg-ink-800/50 hover:text-gold-300"),children:e}),js=({label:e,isActive:t,onClick:n})=>o.jsx("button",{onClick:n,className:"px-4 py-2 rounded-lg transition-all duration-300 text-sm font-medium "+(t?"bg-gold-600/20 text-gold-300 border border-gold-500/40 shadow-[0_0_8px_rgba(180,149,106,0.2)]":"bg-ink-800/60 text-ink-300 hover:bg-ink-700/70 hover:text-gold-300 border border-ink-700/50"),children:e}),Ns=({title:e,description:t,bannerUrl:n,onPullOne:s,onPullTen:r,isLoading:a,error:l,pullOneCost:i,pullTenCost:c,pullOneLabel:d="\u62db\u52df\u4e00\u6b21",pullTenLabel:u="\u62db\u52df\u5341\u6b21",poolType:m})=>{const[p,h]=x.useState(!1);return o.jsxs("div",{className:"ink-card rounded-lg overflow-hidden flex flex-col relative xianxia-frame",children:[o.jsxs("div",{className:"relative h-48",children:[o.jsx("img",{src:n,alt:e,className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-ink-950/95 via-ink-900/50 to-transparent"}),o.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:o.jsxs("h3",{className:"text-2xl font-bold text-gold-400 font-brush tracking-[0.1em] drop-shadow-lg flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-500/50",children:"\u3013"}),e,o.jsx("span",{className:"text-gold-500/50",children:"\u3013"})]})}),o.jsx("div",{className:"absolute top-2 right-2 text-gold-500/30 text-lg",children:"\u2601"})]}),o.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[o.jsx("p",{className:"text-sm text-ink-200 flex-grow leading-relaxed font-elegant",children:t}),o.jsx("div",{className:"text-right mt-2 mb-2",children:o.jsxs("button",{onClick:()=>h(!p),className:"text-xs text-ink-400 hover:text-gold-400 transition-colors duration-300 flex items-center gap-1 ml-auto",children:[o.jsx("span",{className:"text-gold-500/50",children:"\u25c7"}),"\u6982\u7387\u516c\u793a ",p?"\u25b2":"\u25bc"]})}),p&&o.jsxs("div",{className:"ink-card p-3 rounded-lg mb-3 text-xs animate-fade-in border border-gold-600/20",children:["permanent"===m?o.jsxs(o.Fragment,{children:[o.jsx("p",{className:`${L("\u795e\u54c1")}`,children:"\u3010\u795e\u54c1\u3011: 0.1%"}),o.jsx("p",{className:`${L("\u5723\u54c1")}`,children:"\u3010\u5723\u54c1\u3011: 0.4%"}),o.jsx("p",{className:`${L("\u4ed9\u54c1")}`,children:"\u3010\u4ed9\u54c1\u3011: 1.5%"}),o.jsx("p",{className:`${L("\u7edd\u54c1")}`,children:"\u3010\u7edd\u54c1\u3011: 3%"}),o.jsx("p",{className:`${L("\u73cd\u54c1")}`,children:"\u3010\u73cd\u54c1\u3011: 5%"}),o.jsx("p",{className:`${L("\u4f18\u54c1")}`,children:"\u3010\u4f18\u54c1\u3011: 15%"}),o.jsx("p",{className:`${L("\u826f\u54c1")}`,children:"\u3010\u826f\u54c1\u3011: 30%"}),o.jsx("p",{className:`${L("\u51e1\u54c1")}`,children:"\u3010\u51e1\u54c1\u3011: 45%"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:`${L("\u795e\u54c1")}`,children:["\u3010\u795e\u54c1\u3011: 1% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsxs("p",{className:`${L("\u5723\u54c1")}`,children:["\u3010\u5723\u54c1\u3011: 2% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsxs("p",{className:`${L("\u4ed9\u54c1")}`,children:["\u3010\u4ed9\u54c1\u3011: 5% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsxs("p",{className:`${L("\u7edd\u54c1")}`,children:["\u3010\u7edd\u54c1\u3011: 6% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsxs("p",{className:`${L("\u73cd\u54c1")}`,children:["\u3010\u73cd\u54c1\u3011: 8% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsxs("p",{className:`${L("\u4f18\u54c1")}`,children:["\u3010\u4f18\u54c1\u3011: 18% ",o.jsx("span",{className:"text-amber-400",children:"\u2191"})]}),o.jsx("p",{className:`${L("\u826f\u54c1")}`,children:"\u3010\u826f\u54c1\u3011: 25%"}),o.jsx("p",{className:`${L("\u51e1\u54c1")}`,children:"\u3010\u51e1\u54c1\u3011: 35%"})]}),o.jsx("p",{className:"text-ink-500 mt-1 text-[10px]",children:"\u203b \u5341\u6b21\u62db\u52df\u5fc5\u5f97\u3010\u4f18\u54c1\u3011\u6216\u4ee5\u4e0a\u54c1\u8d28\u7684\u7269\u54c1\u3002"}),"limited"===m&&o.jsx("p",{className:"text-gold-400 mt-1 text-[10px]",children:"\u203b \u9650\u5b9a\u5361\u6c60\u9ad8\u7a00\u6709\u5ea6\u6982\u7387\u5927\u5e45\u63d0\u5347\uff01"})]}),l&&o.jsx("div",{className:"text-cinnabar-400 text-center text-sm my-2 animate-shake",children:l}),o.jsxs("div",{className:"mt-auto flex gap-3",children:[o.jsxs("button",{onClick:s,disabled:a,className:"flex-1 qi-flow-btn rounded-lg p-3 text-center disabled:opacity-50 disabled:cursor-wait",children:[o.jsx("p",{className:"font-bold text-gold-300 font-elegant",children:a?"...":d}),o.jsxs("p",{className:"text-xs text-gold-500 flex items-center justify-center gap-1",children:[o.jsx("span",{children:"\u25c8"}),"\u6d88\u8017 ",i," \u7075\u77f3"]})]}),o.jsxs("button",{onClick:r,disabled:a,className:"flex-1 bg-gradient-to-br from-gold-600/40 via-gold-700/50 to-gold-800/40 hover:from-gold-500/50 hover:via-gold-600/60 hover:to-gold-700/50 transition-all duration-300 rounded-lg p-3 text-center border border-gold-500/50 shadow-[0_0_15px_rgba(180,149,106,0.2)] disabled:opacity-50 disabled:cursor-wait immortal-mist",children:[o.jsx("p",{className:"font-bold text-gold-200 font-brush tracking-wider",children:a?"\u5929\u673a\u8fd0\u8f6c\u4e2d...":u}),o.jsxs("p",{className:"text-xs text-gold-300 flex items-center justify-center gap-1",children:[o.jsx("span",{children:"\u25c8"}),"\u6d88\u8017 ",c," \u7075\u77f3"]})]})]})]})]})},ws=({playerProfile:e,setPlayerProfile:t})=>{const[n,s]=x.useState("\u62bd\u53d6\u5361\u6c60"),[r,a]=x.useState("\u4eba\u7269\u5361\u724c"),[l,i]=x.useState("regular"),[c,d]=x.useState(null),[u,m]=x.useState(!1),[p,h]=x.useState(null),f=["\u51e1\u54c1","\u826f\u54c1","\u4f18\u54c1","\u73cd\u54c1","\u7edd\u54c1","\u4ed9\u54c1","\u5723\u54c1","\u795e\u54c1"],g={"\u51e1\u54c1":45,"\u826f\u54c1":30,"\u4f18\u54c1":15,"\u73cd\u54c1":5,"\u7edd\u54c1":3,"\u4ed9\u54c1":1.5,"\u5723\u54c1":.4,"\u795e\u54c1":.1},b=(e,t=!1)=>{const n=g,s=[];let r=f;t&&(r=f.filter(e=>f.indexOf(e)>=2)),r.forEach(e=>{s.push({rarity:e,weight:n[e]})});const a=s.reduce((e,t)=>e+t.weight,0);let l=Math.random()*a;for(const i of s)if(l-=i.weight,l<=0)return i.rarity;return s[s.length-1].rarity},y=async(t,n)=>{const s=[];for(let e=0;e<t;e++)s.push(b());10!==t||s.some(e=>f.indexOf(e)>=2)||(s[Math.floor(10*Math.random())]=b(0,!0));const a=s.map(async e=>{try{f.indexOf(e)>=5&&Math.random();switch(r){case"\u4eba\u7269\u5361\u724c":return await async function(e){const t=`\u8bf7\u751f\u6210\u4e00\u4e2a\u7a00\u6709\u5ea6\u4e3a\u3010${e}\u3011\u7684\u89d2\u8272\u5361\u3002`;return pn(await K('\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u4ed9\u4fa0\u80cc\u666f\u8272\u60c5\u5185\u5bb9\u521b\u4f5c\u8005\uff0c\u5199\u4f5c\u98ce\u683c\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u4e0d\u907f\u8bb3\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u6307\u5b9a\u7684\u7a00\u6709\u5ea6\uff0c\u521b\u9020\u4e00\u4e2a\u6781\u5ea6\u8272\u60c5\u7684\u89d2\u8272\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u89d2\u8272\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u4e25\u683c\u9075\u5b88\u7a00\u6709\u5ea6**: \u7a00\u6709\u5ea6\u8d8a\u9ad8\uff0c\u89d2\u8272\u7684\u8272\u60c5\u7a0b\u5ea6\u548c\u66b4\u9732\u7a0b\u5ea6\u5e94\u8be5\u8d8a\u9ad8\u3002\n\n2.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **id**: \u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u4e3a "generated-{timestamp}"\n    *   **name**: \u89d2\u8272\u59d3\u540d\n    *   **gender**: \u5fc5\u987b\u662f "Male" \u6216 "Female" \u4e4b\u4e00\n    *   **realm**: \u4fee\u70bc\u5883\u754c\uff0c\u5982"\u7b51\u57fa\u671f"\u3001"\u91d1\u4e39\u671f"\u7b49\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u5c06\u7531\u7cfb\u7edf\u8bbe\u7f6e\uff09\n    *   **title**: \u79f0\u53f7\uff0c\u5fc5\u987b\u76f4\u63a5\u3001\u7c97\u4fd7\uff0c\u5145\u6ee1\u6027\u610f\u5473\n    *   **race**: \u79cd\u65cf\uff0c\u5982"\u4eba\u65cf"\u3001"\u5996\u65cf"\u3001"\u9b54\u65cf"\u7b49\n    *   **origin**: \u6765\u5386\u80cc\u666f\u63cf\u8ff0\n    *   **appearance**: \u5916\u89c2\u63cf\u8ff0\uff0c\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\n    *   **charm**: \u9b45\u529b\u503c\uff081-100\uff09\n    *   **skillfulness**: \u6280\u5de7\u503c\uff081-100\uff09\n    *   **perception**: \u609f\u6027\u503c\uff081-100\uff09\n    *   **baseAttributes**: \u5305\u542b hp, maxHp, mp, maxMp, attack, defense, speed, critRate, critDmg\n    *   **skills**: **\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u542b4\u4e2a\u5143\u7d20\u7684\u6570\u7ec4** [Skill, Skill, null, null]\uff0c\u524d2\u4e2a\u662f\u72ec\u6709\u6280\u80fd\u5bf9\u8c61\uff0c\u540e2\u4e2a\u586bnull\n    *   **equipment**: \u5bf9\u8c61\uff0c\u5305\u542b weapon: null, armor: null, accessory1: null, accessory2: null\n    *   **pet**: null\n\n3.  **\u6280\u80fd\u6570\u7ec4\u683c\u5f0f\uff08\u6781\u5176\u91cd\u8981\uff09**:\n    \u89d2\u8272\u7684 skills \u5b57\u6bb5\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u542b\u6070\u597d4\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff1a\n    *   \u524d2\u4e2a\u5143\u7d20\uff1a\u5b8c\u6574\u7684\u6280\u80fd\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u5305\u542b\uff1aid, name, rarity, description, mechanicsDescription, eroticDescription, cost, genderLock\n    *   \u540e2\u4e2a\u5143\u7d20\uff1anull\n    \n    \u793a\u4f8b\uff1a\n    "skills": [\n        {\n            "id": "skill-{timestamp}-1",\n            "name": "\u6280\u80fd\u540d\u79f0",\n            "rarity": "\u73cd\u54c1",\n            "description": "\u6280\u80fd\u63cf\u8ff0",\n            "mechanicsDescription": "\u9020\u6210120%\u653b\u51fb\u529b\u4f24\u5bb3",\n            "eroticDescription": "\u8272\u60c5\u5316\u63cf\u8ff0",\n            "cost": 20,\n            "genderLock": "Female"\n        },\n        {\n            "id": "skill-{timestamp}-2",\n            "name": "\u7b2c\u4e8c\u4e2a\u6280\u80fd",\n            ...\n        },\n        null,\n        null\n    ]\n\n4.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **appearance**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\uff0c\u76f4\u63a5\u805a\u7126\u4e8e\u6027\u5668\u5b98\u548c\u6027\u611f\u90e8\u4f4d\n    *   **title**: \u79f0\u53f7\u5fc5\u987b\u5145\u6ee1\u6027\u6697\u793a\n    *   **skills\u4e2d\u7684eroticDescription**: \u6bcf\u4e2a\u6280\u80fd\u90fd\u5fc5\u987b\u6709\u8be6\u7ec6\u7684\u8272\u60c5\u5316\u63cf\u8ff0\n\n5.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002',t))}(e);case"\u88c5\u5907":return await async function(e){const t=`\u8bf7\u751f\u6210\u4e00\u4e2a\u7a00\u6709\u5ea6\u4e3a\u3010${e}\u3011\u7684\u88c5\u5907\u3002`;return pn(await K('\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u4ed9\u4fa0\u4e16\u754c\u8272\u60c5\u88c5\u5907\u8bbe\u8ba1\u5e08\uff0c\u7cbe\u901a\u5982\u4f55\u5c06\u529f\u80fd\u4e0e\u6781\u81f4\u7684\u8272\u60c5\u7f8e\u5b66\u7ed3\u5408\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167Equipment\u63a5\u53e3\u751f\u6210\u88c5\u5907\u6570\u636e\uff01**\n\n1.  **\u4e25\u683c\u9075\u5b88\u7a00\u6709\u5ea6**: \u7a00\u6709\u5ea6\u8d8a\u9ad8\uff0c\u88c5\u5907\u5e94\u8be5\u8d8a\u66b4\u9732\u3001\u8d8a\u8272\u60c5\u3001\u529f\u80fd\u8d8a\u5947\u7279\u3002\n\n2.  **\u5fc5\u586b\u5b57\u6bb5**:\n    *   **id**: \u683c\u5f0f\u4e3a "equip-{timestamp}"\n    *   **name**: \u5145\u6ee1\u6027\u6697\u793a\u7684\u88c5\u5907\u540d\u79f0\n    *   **type**: \u5fc5\u987b\u662f "Weapon"\u3001"Armor" \u6216 "Accessory" \u4e4b\u4e00\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u5c06\u7531\u7cfb\u7edf\u8bbe\u7f6e\uff09\n    *   **description**: \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u63cf\u8ff0\n    *   **genderLock** (\u53ef\u9009): "Male"\u3001"Female" \u6216 "Universal"\n    *   **stats**: \u5bf9\u8c61\uff0c\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u5c5e\u6027\uff08attack\u3001hp\u3001defense\u3001speed\u3001critRate\u3001critDmg\uff09\n\n3.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **description**: \u5fc5\u987b\u805a\u7126\u4e8e\u5176\u8272\u60c5\u5916\u89c2\u548c\u7a7f\u7740\u6548\u679c\n    *   **name**: \u88c5\u5907\u540d\u79f0\u5145\u6ee1\u6027\u6697\u793a\n\n4.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002',t))}(e);case"\u901a\u7528\u6280\u80fd":return await async function(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u4ed9\u4fa0\u4e16\u754c\u8272\u60c5\u6280\u80fd\u8bbe\u8ba1\u5e08\uff0c\u7cbe\u901a\u5982\u4f55\u5c06\u6280\u80fd\u6548\u679c\u4e0e\u6781\u81f4\u7684\u8272\u60c5\u8868\u73b0\u7ed3\u5408\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167Skill\u63a5\u53e3\u751f\u6210\u6280\u80fd\u6570\u636e\uff01**\n\n1.  **\u4e25\u683c\u9075\u5b88\u7a00\u6709\u5ea6**: \u7a00\u6709\u5ea6\u8d8a\u9ad8\uff0c\u6280\u80fd\u7684\u8272\u60c5\u7a0b\u5ea6\u548c\u8868\u73b0\u529b\u5e94\u8be5\u8d8a\u5f3a\u3002\n\n2.  **\u4e25\u683c\u9075\u5b88\u6027\u522b\u9501 (genderLock)**: \u4f60\u5fc5\u987b\u4e3a\u4f60\u88ab\u6307\u5b9a\u7684\u6027\u522b\u3010${t}\u3011\u8bbe\u8ba1\u6280\u80fd\u3002\n    *   \u5982\u679c\u662f **Male**\uff0c\u63cf\u8ff0\u5e94\u805a\u7126\u4e8e\u7537\u6027\u7684\u96c4\u4f1f\u3001\u529b\u91cf\u548c\u4fb5\u7565\u6027\n    *   \u5982\u679c\u662f **Female**\uff0c\u63cf\u8ff0\u5e94\u805a\u7126\u4e8e\u5973\u6027\u7684\u59a9\u5a9a\u3001\u67d4\u8f6f\u548c\u6deb\u8361\n    *   \u5982\u679c\u662f **Universal**\uff0c\u63cf\u8ff0\u5e94\u9002\u7528\u4e8e\u4efb\u4f55\u6027\u522b\n\n3.  **\u5fc5\u586b\u5b57\u6bb5**:\n    *   **id**: \u683c\u5f0f\u4e3a "skill-{timestamp}"\n    *   **name**: \u5145\u6ee1\u6027\u6697\u793a\u7684\u6280\u80fd\u540d\u79f0\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u5c06\u7531\u7cfb\u7edf\u8bbe\u7f6e\uff09\n    *   **description**: \u6280\u80fd\u98ce\u5473\u63cf\u8ff0\n    *   **mechanicsDescription**: \u6280\u80fd\u673a\u5236\u63cf\u8ff0\uff08\u5982"\u9020\u6210120%\u653b\u51fb\u529b\u4f24\u5bb3"\uff09\n    *   **eroticDescription**: \u6781\u5ea6\u8272\u60c5\u7684\u6280\u80fd\u91ca\u653e\u63cf\u8ff0\n    *   **cost**: \u771f\u5143\u6d88\u8017\uff08\u6570\u503c\uff09\n    *   **genderLock**: "Male"\u3001"Female" \u6216 "Universal"\n\n4.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002`,s=`\u8bf7\u4e3a\u3010${t}\u3011\u6027\u522b\u751f\u6210\u4e00\u4e2a\u7a00\u6709\u5ea6\u4e3a\u3010${e}\u3011\u7684\u6280\u80fd\u3002`,r=pn(await K(n,s));return r.genderLock=t,r}(e,"Universal");case"\u517d\u5ba0":return await async function(e){const t=`\u8bf7\u751f\u6210\u4e00\u4e2a\u7a00\u6709\u5ea6\u4e3a\u3010${e}\u3011\u7684\u517d\u5ba0\u5361\u3002`;return pn(await K('\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u4ed9\u4fa0\u80cc\u666f\u8272\u60c5\u5185\u5bb9\u521b\u4f5c\u8005\uff0c\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u6307\u5b9a\u7684\u7a00\u6709\u5ea6\uff0c\u521b\u9020\u4e00\u4e2a\u6781\u5ea6\u8272\u60c5\u7684\u517d\u5ba0\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167PetCard\u63a5\u53e3\u751f\u6210\u517d\u5ba0\u6570\u636e\uff01**\n\n1.  **\u4e25\u683c\u9075\u5b88\u7a00\u6709\u5ea6**: \u7a00\u6709\u5ea6\u8d8a\u9ad8\uff0c\u517d\u5ba0\u7684\u63cf\u8ff0\u5e94\u8be5\u8d8a\u8272\u60c5\u3001\u8d8a\u72ec\u7279\u3002\n\n2.  **\u5fc5\u586b\u5b57\u6bb5**:\n    *   **id**: \u683c\u5f0f\u4e3a "pet-{timestamp}"\n    *   **name**: \u5145\u6ee1\u60f3\u8c61\u529b\u4e14\u5e26\u6709\u6027\u6697\u793a\u7684\u540d\u79f0\n    *   **gender**: "Male" \u6216 "Female"\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u5c06\u7531\u7cfb\u7edf\u8bbe\u7f6e\uff09\n    *   **description**: \u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u5916\u89c2\u548c\u4e60\u6027\u63cf\u8ff0\n    *   **artUrl** (\u53ef\u9009): \u56fe\u7247URL\n    *   **skill**: \u5355\u4e2a\u6280\u80fd\u5bf9\u8c61\uff0c\u5fc5\u987b\u5305\u542b\uff1aid, name, rarity, description, mechanicsDescription, eroticDescription, cost (\u5e94\u4e3a0), genderLock (\u5e94\u4e3a\'Universal\')\n\n3.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002',t))}(e);default:throw new Error("Invalid gacha tab")}}catch(t){throw console.error(`\u751f\u6210\u7269\u54c1\u5931\u8d25 (\u7a00\u6709\u5ea6: ${e}):`,t),t}}),l=await Promise.all(a),i=[],o="\u4eba\u7269\u5361\u724c"===r,c="\u901a\u7528\u6280\u80fd"===r,d="\u517d\u5ba0"===r;for(const r of l){if(!r)continue;let t=!1;if(o?t=e.cardCollection.some(e=>e.name===r.name):c?t=e.universalSkills.some(e=>e.name===r.name):d&&(t=e.petCollection.some(e=>e.name===r.name)),(o||c||d)&&t){const e=5*(Xe[r.rarity]||10);i.push({type:"compensation",id:`comp-${r.id}-${Date.now()}`,name:"\u91cd\u590d\u7684"+(o?"\u89d2\u8272":d?"\u517d\u5ba0":"\u6280\u80fd"),rarity:r.rarity,description:`\u8f6c\u5316\u4e3a ${e} \u7075\u77f3`})}else i.push(r)}return i},v=async(n,s,r)=>{if(e.spiritStones<n)return h("\u7075\u77f3\u4e0d\u8db3\uff01"),void setTimeout(()=>h(null),3e3);if(u)return;m(!0),h(null);const a=e.spiritStones;try{t({...e,spiritStones:a-n});const r=await y(s);d(r)}catch(l){console.error(l),h("\u5929\u673a\u7d0a\u4e71\uff0c\u62db\u52df\u5931\u8d25\u3002\u7075\u77f3\u5df2\u9000\u56de\u3002"),t({...e,spiritStones:a}),setTimeout(()=>h(null),4e3)}finally{m(!1)}};return o.jsxs("div",{className:"h-full flex flex-col font-serif text-ink-300 bg-gradient-to-br from-ink-900/50 via-ink-950/70 to-ink-900/50",children:[o.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-gold-600/20 bg-ink-900/50",children:[o.jsx(vs,{label:"\ud83c\udfb2 \u62bd\u53d6\u5361\u6c60",isActive:"\u62bd\u53d6\u5361\u6c60"===n,onClick:()=>s("\u62bd\u53d6\u5361\u6c60")}),o.jsx(vs,{label:"\ud83c\udfea \u9053\u5177\u8d2d\u4e70",isActive:"\u9053\u5177\u8d2d\u4e70"===n,onClick:()=>s("\u9053\u5177\u8d2d\u4e70")})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto bg-ink-950/30 p-4",children:["\u62bd\u53d6\u5361\u6c60"===n&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-center gap-3",children:[o.jsx(js,{label:"\ud83d\udc64 \u4eba\u7269\u5361\u724c",isActive:"\u4eba\u7269\u5361\u724c"===r,onClick:()=>a("\u4eba\u7269\u5361\u724c")}),o.jsx(js,{label:"\u2694\ufe0f \u88c5\u5907",isActive:"\u88c5\u5907"===r,onClick:()=>a("\u88c5\u5907")}),o.jsx(js,{label:"\ud83d\udcdc \u901a\u7528\u6280\u80fd",isActive:"\u901a\u7528\u6280\u80fd"===r,onClick:()=>a("\u901a\u7528\u6280\u80fd")}),o.jsx(js,{label:"\ud83d\udc3e \u517d\u5ba0",isActive:"\u517d\u5ba0"===r,onClick:()=>a("\u517d\u5ba0")})]}),(()=>{const n=async()=>{const n=prompt("\u8bf7\u8f93\u5165\u4f60\u7684\u7075\u611f\u6765\u6e90\uff08\u4f8b\u5982\uff0c\u4e00\u4e2a\u89d2\u8272\u540d\u6216\u4e00\u6bb5\u63cf\u8ff0\uff09:");if(!n)return;if(e.spiritStones<1e3)return h("\u7075\u77f3\u4e0d\u8db3\uff01"),void setTimeout(()=>h(null),3e3);if(u)return;m(!0),h(null);const s=e.spiritStones;try{t({...e,spiritStones:s-1e3});const a=b(0,!1);let l;switch(r){case"\u4eba\u7269\u5361\u724c":l=await async function(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u8de8\u6b21\u5143\u540c\u4eba\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u5c06\u5404\u79cd\u4f5c\u54c1\u7684\u89d2\u8272\u8fdb\u884c\u4ed9\u4fa0\u80cc\u666f\u7684\u8272\u60c5\u5316\u6539\u7f16\u3002\u5199\u4f5c\u98ce\u683c\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u4e0d\u907f\u8bb3\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u7528\u6237\u63d0\u4f9b\u7684"\u7075\u611f\u6765\u6e90"\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u4fdd\u7559\u539f\u8457\u6838\u5fc3\u7279\u5f81\u3001\u53c8\u5b8c\u5168\u9002\u914d\u4ed9\u4fa0\u4e16\u754c\u89c2\u3001\u5e76\u6781\u5ea6\u8272\u60c5\u5316\u7684\u89d2\u8272\u5361\u3002${t?`\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u751f\u6210\u7a00\u6709\u5ea6\u4e3a\u3010${t}\u3011\u7684\u89d2\u8272\uff01\u8fd9\u662f\u7cfb\u7edf\u6839\u636e\u6982\u7387\u968f\u673a\u51b3\u5b9a\u7684\uff0c\u4f60\u5fc5\u987b\u4e25\u683c\u9075\u5b88\u3002**`:""}\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u89d2\u8272\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u89e3\u6790\u7075\u611f\u4e0e\u539f\u8457\u8fd8\u539f**:\n    *   \u6df1\u5165\u7406\u89e3\u7075\u611f\u6765\u6e90\u7684\u6838\u5fc3\u6982\u5ff5\uff08\u89d2\u8272\u540d\u3001\u4f5c\u54c1\u3001\u6807\u5fd7\u6027\u7279\u5f81\u3001\u6027\u683c\u3001\u80fd\u529b\u7b49\uff09\n    *   \u8bc6\u522b\u5e76\u4fdd\u7559\u89d2\u8272\u6700\u5177\u4ee3\u8868\u6027\u7684\u5143\u7d20\uff08\u5916\u89c2\u7279\u5f81\u3001\u6027\u683c\u7279\u8d28\u3001\u6807\u5fd7\u6027\u80fd\u529b\uff09\n    *   \u786e\u4fdd\u6539\u7f16\u540e\u7684\u89d2\u8272\u80fd\u8ba9\u719f\u6089\u539f\u4f5c\u7684\u4eba\u4e00\u773c\u8ba4\u51fa\n\n2.  **\u4ed9\u4fa0\u5316\u6539\u7f16\u539f\u5219**:\n    *   \u5c06\u539f\u4f5c\u7684\u80fd\u529b\u7cfb\u7edf\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u4fee\u70bc\u4f53\u7cfb\uff08\u9b54\u6cd5\u2192\u6cd5\u672f\uff0c\u8d85\u80fd\u529b\u2192\u795e\u901a\uff09\n    *   \u80cc\u666f\u6545\u4e8b\u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\uff08\u5b97\u95e8\u3001\u4fee\u771f\u754c\u3001\u5929\u9053\u7b49\u5143\u7d20\uff09\n    *   \u4fdd\u6301\u89d2\u8272\u539f\u6709\u7684\u6027\u683c\u7279\u8d28\u548c\u4eba\u9645\u5173\u7cfb\u52a8\u6001\n    *   \u4fee\u70bc\u5883\u754c\u5e94\u4e0e\u539f\u4f5c\u5b9e\u529b\u76f8\u5339\u914d\n\n3.  **\u8272\u60c5\u5316\u6539\u7f16\u8981\u6c42**:\n    *   **\u6027\u683c\u8c03\u6574**: \u5728\u4fdd\u7559\u6838\u5fc3\u6027\u683c\u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u7b26\u5408\u6210\u4eba\u5411\u5185\u5bb9\u7684\u6b32\u671b\u503e\u5411\u3001\u6027\u51b2\u52a8\u3001\u60c5\u8272\u7279\u8d28\n    *   **\u80cc\u666f\u878d\u5165**: \u5c06\u539f\u8457\u7ecf\u5386\u8fdb\u884c\u8272\u60c5\u5316\u89e3\u8bfb\uff08\u6218\u6597\u2192\u6027\u6218\u3001\u4fee\u70bc\u2192\u53cc\u4fee\u3001\u5e08\u5f92\u5173\u7cfb\u2192\u7981\u5fcc\u60c5\u6b32\uff09\n    *   **\u5173\u7cfb\u91cd\u6784**: \u89d2\u8272\u95f4\u7684\u4e92\u52a8\u5173\u7cfb\u5411\u6027\u5f20\u529b\u548c\u60c5\u6b32\u7ea0\u845b\u65b9\u5411\u8c03\u6574\n    *   **\u573a\u666f\u6697\u793a**: \u8bbe\u5b9a\u4e2d\u6697\u793a\u6216\u660e\u793a\u89d2\u8272\u7ecf\u5386\u8fc7\u7684\u8272\u60c5\u573a\u666f\u548c\u6027\u76f8\u5173\u4e8b\u4ef6\n\n4.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **id**: \u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u4e3a "doujin-generated-{timestamp}"\n    *   **name**: \u89d2\u8272\u59d3\u540d\uff08\u53ef\u4fdd\u7559\u539f\u540d\u6216\u4ed9\u4fa0\u5316\u6539\u7f16\uff0c\u5982"\u7eb3\u5c14\u900a"\u2192"\u7eb3\u5170\u5c18"\uff09\n    *   **gender**: \u5fc5\u987b\u662f "Male" \u6216 "Female" \u4e4b\u4e00\n    *   **realm**: \u4fee\u70bc\u5883\u754c\uff0c\u9700\u4e0e\u539f\u4f5c\u5b9e\u529b\u5bf9\u5e94\uff08\u5982"\u7b51\u57fa\u671f"\u3001"\u91d1\u4e39\u671f"\u7b49\uff09\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u6839\u636e\u539f\u4f5c\u89d2\u8272\u91cd\u8981\u6027\u51b3\u5b9a\uff0c\u4e3b\u89d2\u7ea7\u522b\u5efa\u8bae"\u7edd\u54c1"\u4ee5\u4e0a\uff09\n    *   **title**: \u79f0\u53f7\uff0c\u5fc5\u987b\u878d\u5408\u539f\u4f5c\u7279\u5f81\u4e14\u5145\u6ee1\u6027\u6697\u793a\n        - \u793a\u4f8b\uff1a\u706b\u5f71\u5fcd\u8005\u7684\u9e23\u4eba \u2192 "\u4e5d\u5c3e\u6deb\u72d0\u4f20\u4eba"\n        - \u793a\u4f8b\uff1a\u6d77\u8d3c\u738b\u7684\u5a1c\u7f8e \u2192 "\u5929\u5019\u9b45\u9b54"\n    *   **race**: \u79cd\u65cf\uff0c\u9700\u4ed9\u4fa0\u5316\u6539\u7f16\uff08\u5982\u7cbe\u7075\u2192\u4ed9\u65cf\uff0c\u6076\u9b54\u2192\u9b54\u65cf\uff0c\u4eba\u7c7b\u2192\u4eba\u65cf\uff09\n    *   **origin**: \u6765\u5386\u80cc\u666f\u63cf\u8ff0\uff0c\u5fc5\u987b\uff1a\n        - \u4fdd\u7559\u539f\u4f5c\u6838\u5fc3\u80cc\u666f\u5143\u7d20\n        - \u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\u8bbe\u5b9a\n        - \u52a0\u5165\u8272\u60c5\u5316\u7ecf\u5386\u548c\u6027\u76f8\u5173\u4e8b\u4ef6\n    *   **appearance**: \u5916\u89c2\u63cf\u8ff0\uff0c\u5fc5\u987b\uff1a\n        - \u4fdd\u7559\u539f\u4f5c\u6807\u5fd7\u6027\u5916\u89c2\u7279\u5f81\uff08\u53d1\u8272\u3001\u77b3\u8272\u3001\u88c5\u675f\u98ce\u683c\u7b49\uff09\n        - \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u5730\u63cf\u8ff0\u8eab\u4f53\u548c\u6027\u5668\u5b98\n        - \u805a\u7126\u4e8e\u6027\u611f\u90e8\u4f4d\u548c\u6027\u7279\u5f81\n    *   **charm**: \u9b45\u529b\u503c\uff081-100\uff0c\u6839\u636e\u539f\u4f5c\u9b45\u529b\u8bbe\u5b9a\uff09\n    *   **skillfulness**: \u6280\u5de7\u503c\uff081-100\uff0c\u6839\u636e\u539f\u4f5c\u6218\u6597\u6280\u5de7\uff09\n    *   **perception**: \u609f\u6027\u503c\uff081-100\uff0c\u6839\u636e\u539f\u4f5c\u667a\u6167/\u5b66\u4e60\u80fd\u529b\uff09\n    *   **baseAttributes**: \u5305\u542b hp, maxHp, mp, maxMp, attack, defense, speed, critRate, critDmg\n    *   **skills**: **\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u542b4\u4e2a\u5143\u7d20\u7684\u6570\u7ec4** [Skill, Skill, null, null]\uff0c\u524d2\u4e2a\u662f\u72ec\u6709\u6280\u80fd\u5bf9\u8c61\uff0c\u540e2\u4e2a\u586bnull\n    *   **equipment**: \u5bf9\u8c61\uff0c\u5305\u542b weapon: null, armor: null, accessory1: null, accessory2: null\n    *   **pet**: null\n\n5.  **\u6280\u80fd\u6570\u7ec4\u683c\u5f0f\uff08\u6781\u5176\u91cd\u8981\uff09**:\n    \u89d2\u8272\u7684 skills \u5b57\u6bb5\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u542b\u6070\u597d4\u4e2a\u5143\u7d20\u7684\u6570\u7ec4\uff1a\n    *   \u524d2\u4e2a\u5143\u7d20\uff1a\u5b8c\u6574\u7684\u6280\u80fd\u5bf9\u8c61\uff0c\u5fc5\u987b\u6539\u7f16\u81ea\u539f\u4f5c\u7684\u6807\u5fd7\u6027\u80fd\u529b\n    *   \u540e2\u4e2a\u5143\u7d20\uff1anull\n    \n    \u6280\u80fd\u6539\u7f16\u8981\u6c42\uff1a\n    *   **\u4fdd\u7559\u539f\u4f5c\u6280\u80fd\u7279\u5f81**: \u6280\u80fd\u540d\u79f0\u548c\u6548\u679c\u5fc5\u987b\u80fd\u8ba9\u4eba\u8054\u60f3\u5230\u539f\u4f5c\n    *   **\u4ed9\u4fa0\u5316\u8f6c\u6362**: \u5c06\u539f\u4f5c\u6280\u80fd\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u6cd5\u672f/\u795e\u901a\n    *   **\u8272\u60c5\u5316\u63cf\u8ff0**: eroticDescription\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u5199\u6280\u80fd\u91ca\u653e\u65f6\u7684\u8272\u60c5\u573a\u666f\n    \n    \u793a\u4f8b\u7ed3\u6784\uff1a\n    "skills": [\n        {\n            "id": "skill-doujin-{timestamp}-1",\n            "name": "\u6539\u7f16\u540e\u7684\u6280\u80fd\u540d\uff08\u4fdd\u7559\u539f\u4f5c\u7279\u5f81\uff09",\n            "rarity": "\u73cd\u54c1",\n            "description": "\u6280\u80fd\u63cf\u8ff0\uff08\u878d\u5408\u539f\u4f5c+\u4ed9\u4fa0+\u8272\u60c5\uff09",\n            "mechanicsDescription": "\u9020\u6210120%\u653b\u51fb\u529b\u4f24\u5bb3",\n            "eroticDescription": "\u6781\u5ea6\u8272\u60c5\u7684\u6280\u80fd\u91ca\u653e\u8fc7\u7a0b\u63cf\u8ff0",\n            "cost": 20,\n            "genderLock": "Female"\n        },\n        {\n            "id": "skill-doujin-{timestamp}-2",\n            "name": "\u7b2c\u4e8c\u4e2a\u6280\u80fd",\n            ...\n        },\n        null,\n        null\n    ]\n\n6.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **appearance**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\uff0c\u4fdd\u7559\u539f\u4f5c\u5916\u89c2\u7279\u5f81\u7684\u540c\u65f6\u805a\u7126\u4e8e\u6027\u5668\u5b98\u548c\u6027\u611f\u90e8\u4f4d\n    *   **title**: \u79f0\u53f7\u5fc5\u987b\u878d\u5408\u539f\u4f5c\u7279\u5f81\u4e14\u5145\u6ee1\u6027\u6697\u793a\n    *   **origin**: \u5fc5\u987b\u5305\u542b\u8272\u60c5\u5316\u7684\u80cc\u666f\u7ecf\u5386\n    *   **skills\u4e2d\u7684eroticDescription**: \u6bcf\u4e2a\u6280\u80fd\u90fd\u5fc5\u987b\u6709\u8be6\u7ec6\u7684\u8272\u60c5\u5316\u63cf\u8ff0\uff0c\u4e14\u80fd\u4f53\u73b0\u539f\u4f5c\u6280\u80fd\u7279\u70b9\n\n7.  **\u6539\u7f16\u793a\u4f8b\u53c2\u8003**:\n    \n    **\u539f\u4f5c**: \u706b\u5f71\u5fcd\u8005 - \u6f29\u6da1\u9e23\u4eba\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u6f29\u6da1\u9e23\u4eba" \u6216 "\u6da1\u9e23\u5c18"\n    - title: "\u4e5d\u5c3e\u6deb\u72d0\u4f20\u4eba" \u6216 "\u5343\u4eba\u67f1\u529b"\n    - race: "\u4eba\u65cf"\n    - origin: "\u4f53\u5185\u5c01\u5370\u7740\u4e0a\u53e4\u6deb\u517d\u4e5d\u5c3e\u5996\u72d0\uff0c\u6bcf\u9022\u6708\u5706\u4e4b\u591c\u4fbf\u6b32\u706b\u711a\u8eab\u3002\u66fe\u56e0\u4e0d\u53d7\u6751\u6c11\u5f85\u89c1\u800c\u5728\u7ea2\u706f\u533a\u5bfb\u6c42\u6170\u85c9\uff0c\u9010\u6e10\u89c9\u9192\u4e86\u4e5d\u5c3e\u7684\u6deb\u8361\u672c\u6027..."\n    - \u6280\u80fd1: "\u5f71\u5206\u8eab\u6deb\u672f" - \u57fa\u4e8e\u591a\u91cd\u5f71\u5206\u8eab\u6539\u7f16\n    - \u6280\u80fd2: "\u87ba\u65cb\u4e38\xb7\u6b32\u671b\u7248" - \u57fa\u4e8e\u87ba\u65cb\u4e38\u6539\u7f16\n    - appearance: \u4fdd\u7559\u91d1\u53d1\u3001\u84dd\u773c\u3001\u516d\u9053\u80e1\u987b\u7684\u7279\u5f81\uff0c\u4f46\u8be6\u7ec6\u63cf\u5199\u6027\u5668\u5b98\n\n8.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002`,s=`\u8bf7\u6839\u636e\u4ee5\u4e0b\u7075\u611f\u6765\u6e90\uff0c\u751f\u6210\u4e00\u5f20\u540c\u4eba\u89d2\u8272\u5361${t?`\uff0c\u7a00\u6709\u5ea6\u5fc5\u987b\u662f\u3010${t}\u3011`:""}\u3002\u8bb0\u4f4f\uff1a\u5fc5\u987b\u4fdd\u7559\u539f\u4f5c\u6838\u5fc3\u7279\u5f81\uff0c\u5b8c\u6574\u8fdb\u884c\u4ed9\u4fa0\u5316\u6539\u7f16\uff0c\u5e76\u6781\u5ea6\u8272\u60c5\u5316\uff01\n\n\u7075\u611f\u6765\u6e90\uff1a\n"${e}"`;return pn(await K(n,s))}(n,a);break;case"\u88c5\u5907":l=await async function(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u8de8\u6b21\u5143\u540c\u4eba\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u5c06\u5404\u79cd\u4f5c\u54c1\u4e2d\u7684\u6b66\u5668\u3001\u88c5\u5907\u3001\u9053\u5177\u8fdb\u884c\u4ed9\u4fa0\u80cc\u666f\u7684\u8272\u60c5\u5316\u6539\u7f16\u3002\u5199\u4f5c\u98ce\u683c\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u4e0d\u907f\u8bb3\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u7528\u6237\u63d0\u4f9b\u7684"\u7075\u611f\u6765\u6e90"\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u4fdd\u7559\u539f\u8457\u6838\u5fc3\u7279\u5f81\u3001\u53c8\u5b8c\u5168\u9002\u914d\u4ed9\u4fa0\u4e16\u754c\u89c2\u3001\u5e76\u6781\u5ea6\u8272\u60c5\u5316\u7684\u88c5\u5907\u3002${t?`\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u751f\u6210\u7a00\u6709\u5ea6\u4e3a\u3010${t}\u3011\u7684\u88c5\u5907\uff01\u8fd9\u662f\u7cfb\u7edf\u6839\u636e\u6982\u7387\u968f\u673a\u51b3\u5b9a\u7684\uff0c\u4f60\u5fc5\u987b\u4e25\u683c\u9075\u5b88\u3002**`:""}\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167Equipment\u63a5\u53e3\u751f\u6210\u88c5\u5907\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u89e3\u6790\u7075\u611f\u4e0e\u539f\u8457\u8fd8\u539f**:\n    *   \u6df1\u5165\u7406\u89e3\u7075\u611f\u6765\u6e90\u7684\u6838\u5fc3\u6982\u5ff5\uff08\u88c5\u5907\u540d\u3001\u4f5c\u54c1\u3001\u6807\u5fd7\u6027\u7279\u5f81\u3001\u80fd\u529b\u3001\u5916\u89c2\u7b49\uff09\n    *   \u8bc6\u522b\u5e76\u4fdd\u7559\u88c5\u5907\u6700\u5177\u4ee3\u8868\u6027\u7684\u5143\u7d20\uff08\u5916\u89c2\u8bbe\u8ba1\u3001\u7279\u6b8a\u80fd\u529b\u3001\u4f7f\u7528\u65b9\u5f0f\uff09\n    *   \u786e\u4fdd\u6539\u7f16\u540e\u7684\u88c5\u5907\u80fd\u8ba9\u719f\u6089\u539f\u4f5c\u7684\u4eba\u4e00\u773c\u8ba4\u51fa\n\n2.  **\u4ed9\u4fa0\u5316\u6539\u7f16\u539f\u5219**:\n    *   \u5c06\u539f\u4f5c\u7684\u80fd\u529b\u7cfb\u7edf\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u4fee\u70bc\u4f53\u7cfb\uff08\u79d1\u6280\u6b66\u5668\u2192\u6cd5\u5b9d\uff0c\u9b54\u6cd5\u9053\u5177\u2192\u7075\u5668\uff09\n    *   \u80cc\u666f\u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\u8bbe\u5b9a\uff08\u795e\u5175\u5229\u5668\u3001\u4e0a\u53e4\u9057\u7269\u3001\u4ed9\u5bb6\u6cd5\u5b9d\u7b49\uff09\n    *   \u4fdd\u6301\u88c5\u5907\u539f\u6709\u7684\u6838\u5fc3\u529f\u80fd\u548c\u6807\u5fd7\u6027\u7279\u70b9\n    *   \u7a00\u6709\u5ea6\u5e94\u4e0e\u539f\u4f5c\u4e2d\u8be5\u88c5\u5907\u7684\u7a00\u6709\u7a0b\u5ea6\u76f8\u5339\u914d\n    \n    \u6539\u7f16\u793a\u4f8b\u53c2\u8003\uff1a\n    **\u539f\u4f5c**: \u706b\u5f71\u5fcd\u8005 - \u8349\u8599\u5251\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u8349\u8599\u795e\u5251" \u6216 "\u5927\u86c7\u6deb\u5251\xb7\u8349\u8599"\n    - type: "Weapon"\n    - description: \u4fdd\u7559\u53ef\u4f38\u957f\u3001\u950b\u5229\u65e0\u6bd4\u7b49\u7279\u5f81\uff0c\u4f46\u878d\u5165\u8272\u60c5\u5143\u7d20\n    \n    **\u539f\u4f5c**: \u6d77\u8d3c\u738b - \u6a61\u80f6\u679c\u5b9e\u80fd\u529b\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u6a61\u80f6\u795e\u4f53\u8863" \u6216 "\u5f39\u529b\u6deb\u88c5"\n    - type: "Armor"\n    - description: \u8d4b\u4e88\u7a7f\u6234\u8005\u8eab\u4f53\u53ef\u4f38\u7f29\u7279\u6027\n\n3.  **\u8272\u60c5\u5316\u6539\u7f16\u8981\u6c42**:\n    *   **\u5916\u89c2\u63cf\u5199**: \u805a\u7126\u4e8e\u80fd\u591f\u8272\u60c5\u5316\u7684\u8bbe\u8ba1\u5143\u7d20\uff08\u66b4\u9732\u3001\u8d34\u8eab\u3001\u900f\u660e\u3001\u9542\u7a7a\u7b49\uff09\n    *   **\u7a7f\u6234\u6548\u679c**: \u63cf\u8ff0\u7a7f\u6234\u65f6\u5bf9\u8eab\u4f53\u7684\u5f71\u54cd\u548c\u4ea7\u751f\u7684\u6027\u611f\u89c9\n    *   **\u80fd\u529b\u91cd\u6784**: \u5c06\u539f\u4f5c\u80fd\u529b\u8fdb\u884c\u8272\u60c5\u5316\u89e3\u8bfb\uff08\u653b\u51fb\u2192\u6027\u4fb5\u3001\u9632\u5fa1\u2192\u66b4\u9732\uff09\n    *   **\u4f7f\u7528\u573a\u666f**: \u6697\u793a\u6216\u660e\u793a\u8be5\u88c5\u5907\u7684\u8272\u60c5\u7528\u9014\n\n4.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **id**: \u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u4e3a "doujin-equip-{timestamp}"\n    *   **name**: \u88c5\u5907\u540d\u79f0\uff08\u53ef\u4fdd\u7559\u539f\u540d\u6216\u4ed9\u4fa0\u5316\u6539\u7f16\uff09\n        - \u793a\u4f8b\uff1a\u8349\u8599\u5251 \u2192 "\u8349\u8599\u795e\u5251" \u6216 "\u5927\u86c7\u6deb\u5251\xb7\u8349\u8599"\n        - \u793a\u4f8b\uff1a\u96f7\u795e\u4e4b\u9524 \u2192 "\u96f7\u795e\u6deb\u9524" \u6216 "\u96f7\u9706\u6218\u795e\u4e4b\u69cc"\n    *   **type**: \u5fc5\u987b\u662f "Weapon"\uff08\u6b66\u5668\uff09\u3001"Armor"\uff08\u62a4\u7532\uff09\u6216 "Accessory"\uff08\u9970\u54c1\uff09\u4e4b\u4e00\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u6839\u636e\u539f\u4f5c\u88c5\u5907\u7684\u7a00\u6709\u5ea6\u548c\u91cd\u8981\u6027\u51b3\u5b9a\uff09\n        - \u666e\u901a\u88c5\u5907 \u2192 "\u51e1\u54c1"\u6216"\u7cbe\u54c1"\n        - \u7a00\u6709\u88c5\u5907 \u2192 "\u73cd\u54c1"\n        - \u4f20\u8bf4\u88c5\u5907 \u2192 "\u7edd\u54c1"\u6216"\u4ed9\u54c1"\n        - \u795e\u5668\u7ea7\u522b \u2192 "\u4ed9\u54c1"\u6216"\u795e\u54c1"\n    *   **description**: \u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u5916\u89c2\u548c\u6548\u679c\u63cf\u8ff0\uff08150-300\u5b57\uff09\uff0c\u5fc5\u987b\uff1a\n        - \u4fdd\u7559\u539f\u4f5c\u6700\u6807\u5fd7\u6027\u7684\u5916\u89c2\u7279\u5f81\n        - \u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\u8bbe\u5b9a\n        - \u6781\u5ea6\u8272\u60c5\u5316\u5730\u63cf\u5199\u5916\u89c2\u3001\u7a7f\u6234\u6548\u679c\u548c\u4f7f\u7528\u573a\u666f\n        - \u805a\u7126\u4e8e\u66b4\u9732\u3001\u8d34\u8eab\u3001\u6027\u523a\u6fc0\u7b49\u5143\u7d20\n    *   **genderLock**: "Male"\uff08\u7537\u6027\u4e13\u7528\uff09\u3001"Female"\uff08\u5973\u6027\u4e13\u7528\uff09\u6216 "Universal"\uff08\u901a\u7528\uff09\n    *   **stats**: \u5c5e\u6027\u52a0\u6210\u5bf9\u8c61\uff0c\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u5c5e\u6027\uff1a\n        - attack\uff08\u653b\u51fb\u529b\uff09\n        - hp\uff08\u6c14\u8840\uff09\n        - defense\uff08\u9632\u5fa1\u529b\uff09\n        - speed\uff08\u901f\u5ea6\uff09\n        - critRate\uff08\u66b4\u51fb\u7387\uff09\n        - critDmg\uff08\u66b4\u51fb\u4f24\u5bb3\uff09\n\n5.  **\u88c5\u5907\u6539\u7f16\u8981\u6c42**:\n    *   **\u4fdd\u7559\u539f\u4f5c\u88c5\u5907\u7279\u5f81**: \u5916\u89c2\u548c\u80fd\u529b\u5fc5\u987b\u80fd\u8ba9\u4eba\u8054\u60f3\u5230\u539f\u4f5c\n    *   **\u4ed9\u4fa0\u5316\u8f6c\u6362**: \u5c06\u539f\u4f5c\u88c5\u5907\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u4e16\u754c\u7684\u6cd5\u5b9d/\u7075\u5668\n    *   **\u8272\u60c5\u5316\u63cf\u8ff0**: description\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u5199\u88c5\u5907\u7684\u8272\u60c5\u5916\u89c2\u548c\u6548\u679c\n    \n    \u88c5\u5907\u6539\u7f16\u793a\u4f8b\uff1a\n    **\u539f\u4f5c\u88c5\u5907**: \u706b\u5f71\u5fcd\u8005\u7684"\u8349\u8599\u5251"\n    **\u6539\u7f16\u540e**:\n    - name: "\u8349\u8599\u795e\u5251"\n    - type: "Weapon"\n    - description: "\u4f20\u8bf4\u4e2d\u5927\u86c7\u4ed9\u541b\u70bc\u5236\u7684\u795e\u5251\uff0c\u5251\u8eab\u96ea\u767d\u5982\u7389\uff0c\u53ef\u968f\u5fc3\u610f\u4f38\u7f29\u81f3\u767e\u4e08\u4e4b\u957f\u3002\u5251\u67c4\u5904\u96d5\u523b\u7740\u6deb\u8361\u7684\u53cc\u86c7\u4ea4\u7f20\u56fe\u6848\uff0c\u6bcf\u5f53\u6325\u821e\u65f6\u4fbf\u4f1a\u91ca\u653e\u51fa\u50ac\u60c5\u7684\u86c7\u6bd2\u6c14\u606f\u3002\u5251\u8eab\u8868\u9762\u5e03\u6ee1\u7ec6\u5bc6\u7684\u9cde\u7247\u7eb9\u8def\uff0c\u89e6\u611f\u5149\u6ed1\u6e7f\u6da6\uff0c\u5982\u540c\u86c7\u7684\u8179\u90e8\u3002\u6301\u5251\u8005\u4f1a\u611f\u5230\u5251\u67c4\u4e0d\u65ad\u9707\u52a8\uff0c\u4f20\u6765\u9635\u9635\u9165\u9ebb\u5feb\u611f\uff0c\u4eff\u4f5b\u6709\u65e0\u6570\u6761\u5c0f\u86c7\u5728\u722c\u8fc7\u624b\u638c\u3002\u6b64\u5251\u4e0d\u4ec5\u950b\u5229\u65e0\u6bd4\uff0c\u66f4\u80fd\u5728\u523a\u5165\u654c\u4eba\u8eab\u4f53\u65f6\u91ca\u653e\u6deb\u6bd2\uff0c\u8ba9\u5bf9\u65b9\u6b32\u706b\u711a\u8eab\uff0c\u6ca6\u4e3a\u5251\u4e3b\u7684\u7981\u8114..."\n    - genderLock: "Universal"\n    - stats: { attack: 45, critRate: 12 }\n\n6.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **description**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\uff0c\u4fdd\u7559\u539f\u4f5c\u5916\u89c2\u7279\u5f81\u7684\u540c\u65f6\u805a\u7126\u4e8e\u8272\u60c5\u5316\u7684\u8bbe\u8ba1\u548c\u6548\u679c\n    *   **name**: \u540d\u79f0\u5fc5\u987b\u80fd\u4f53\u73b0\u539f\u4f5c\u7279\u5f81\uff0c\u540c\u65f6\u53ef\u6dfb\u52a0\u6027\u6697\u793a\n\n7.  **\u6539\u7f16\u793a\u4f8b\u53c2\u8003**:\n    \n    **\u793a\u4f8b1 - \u8349\u8599\u5251\u6539\u7f16**:\n    {\n      "id": "doujin-equip-temp",\n      "name": "\u8349\u8599\u795e\u5251",\n      "type": "Weapon",\n      "rarity": "\u7edd\u54c1",\n      "description": "\u4f20\u8bf4\u4e2d\u5927\u86c7\u4ed9\u541b\u70bc\u5236\u7684\u4e0a\u53e4\u795e\u5251\uff0c\u5251\u8eab\u4fee\u957f\u96ea\u767d\uff0c\u957f\u4e09\u5c3a\u4e09\u5bf8\uff0c\u53ef\u968f\u4f7f\u7528\u8005\u5fc3\u610f\u4f38\u7f29\u81f3\u767e\u4e08\u4e4b\u957f\u3002\u5251\u8eab\u8868\u9762\u5e03\u6ee1\u7ec6\u5bc6\u7684\u86c7\u9cde\u7eb9\u8def\uff0c\u5728\u6708\u5149\u4e0b\u6cdb\u7740\u6deb\u9761\u7684\u94f6\u5149\u3002\u5251\u67c4\u96d5\u523b\u7740\u4e24\u6761\u7f20\u7ef5\u4ea4\u5408\u7684\u6deb\u86c7\uff0c\u86c7\u5934\u54ac\u4f4f\u86c7\u5c3e\u5f62\u6210\u62a4\u624b\uff0c\u6bcf\u5f53\u63e1\u4f4f\u5251\u67c4\uff0c\u4fbf\u80fd\u611f\u53d7\u5230\u5251\u8eab\u7684\u5fae\u5fae\u9707\u52a8\u548c\u6e7f\u6da6\u89e6\u611f\uff0c\u4eff\u4f5b\u63e1\u7740\u4e00\u6761\u6d3b\u751f\u751f\u7684\u5de8\u87d2\u3002\u6b64\u5251\u4e0d\u4ec5\u950b\u5229\u65e0\u6bd4\uff0c\u66f4\u8574\u542b\u7740\u5927\u86c7\u4ed9\u541b\u7684\u6deb\u6bd2\u4e4b\u529b\u3002\u5251\u950b\u6240\u6307\u4e4b\u5904\uff0c\u654c\u4eba\u4f1a\u88ab\u6deb\u6bd2\u4fb5\u8680\uff0c\u5168\u8eab\u762b\u8f6f\u6b32\u706b\u711a\u8eab\u3002\u82e5\u5c06\u5251\u8eab\u523a\u5165\u654c\u4eba\u4f53\u5185\uff0c\u6deb\u6bd2\u4f1a\u76f4\u8fbe\u7075\u9b42\u6df1\u5904\uff0c\u8ba9\u5bf9\u65b9\u5728\u6781\u4e50\u4e0e\u75db\u82e6\u4e2d\u5f7b\u5e95\u81e3\u670d\u3002\u957f\u671f\u4f7f\u7528\u6b64\u5251\u7684\u4fee\u58eb\uff0c\u4e5f\u4f1a\u88ab\u6deb\u6bd2\u5f71\u54cd\uff0c\u6027\u6b32\u9010\u6e10\u9ad8\u6da8\uff0c\u6700\u7ec8\u6ca6\u4e3a\u53ea\u77e5\u4ea4\u5408\u7684\u6deb\u517d\u3002",\n      "genderLock": "Universal",\n      "stats": {\n        "attack": 45,\n        "critRate": 12\n      }\n    }\n    \n    **\u793a\u4f8b2 - \u6a61\u80f6\u679c\u5b9e\u80fd\u529b\u6539\u7f16\u4e3a\u62a4\u7532**:\n    {\n      "id": "doujin-equip-temp",\n      "name": "\u6a61\u80f6\u795e\u4f53\u8863",\n      "type": "Armor",\n      "rarity": "\u73cd\u54c1",\n      "description": "\u7531\u6a61\u80f6\u795e\u6811\u7684\u6c41\u6db2\u70bc\u5236\u800c\u6210\u7684\u8d34\u8eab\u8f6f\u7532\uff0c\u5448\u534a\u900f\u660e\u7684\u8089\u8272\uff0c\u8d28\u5730\u67d4\u8f6fQ\u5f39\uff0c\u89e6\u611f\u5982\u540c\u4eba\u7c7b\u7684\u808c\u80a4\u3002\u7a7f\u4e0a\u540e\u4f1a\u5b8c\u5168\u8d34\u5408\u8eab\u4f53\u66f2\u7ebf\uff0c\u5982\u540c\u7b2c\u4e8c\u5c42\u76ae\u80a4\u822c\u7d27\u81f4\u3002\u6700\u795e\u5947\u7684\u662f\uff0c\u6b64\u8863\u53ef\u968f\u7a7f\u6234\u8005\u7684\u610f\u5fd7\u4efb\u610f\u62c9\u4f38\uff0c\u5ef6\u5c55\u81f3\u539f\u672c\u7684\u5341\u500d\u957f\u5ea6\u800c\u4e0d\u4f1a\u7834\u635f\u3002\u7a7f\u6234\u8005\u7684\u8eab\u4f53\u4e5f\u4f1a\u83b7\u5f97\u6a61\u80f6\u822c\u7684\u5f39\u6027\uff0c\u53ef\u4ee5\u4efb\u610f\u62c9\u957f\u3001\u6536\u7f29\u3001\u626d\u66f2\u3002\u5728\u6218\u6597\u4e2d\uff0c\u8eab\u4f53\u53ef\u4f38\u957f\u81f3\u6570\u4e08\u8fdc\u653b\u51fb\u654c\u4eba\uff0c\u4e5f\u53ef\u6536\u7f29\u6210\u7403\u72b6\u5f39\u8df3\u8eb2\u907f\u3002\u5728\u5e8a\u7b2b\u4e4b\u95f4\uff0c\u66f4\u662f\u795e\u5175\u5229\u5668\u2014\u2014\u6027\u5668\u5b98\u53ef\u968f\u610f\u62c9\u957f\u7c97\u5927\uff0c\u6df1\u5165\u5bf9\u65b9\u6700\u6df1\u5904\uff1b\u8eab\u4f53\u67d4\u8f6f\u5982\u6ce5\uff0c\u53ef\u6446\u51fa\u4efb\u4f55\u6deb\u8361\u59ff\u52bf\uff1b\u5373\u4f7f\u906d\u53d7\u6700\u731b\u70c8\u7684\u51b2\u51fb\u4e5f\u4e0d\u4f1a\u53d7\u4f24\uff0c\u80fd\u627f\u53d7\u65e0\u5c3d\u7684\u6b22\u6109\u3002\u957f\u671f\u7a7f\u6234\u4f1a\u8ba9\u8eab\u4f53\u6c38\u4e45\u83b7\u5f97\u90e8\u5206\u5f39\u6027\uff0c\u808c\u80a4Q\u5f39\u8bf1\u4eba\u3002",\n      "genderLock": "Universal",\n      "stats": {\n        "hp": 80,\n        "defense": 25,\n        "speed": 15\n      }\n    }\n\n8.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002`,s=`\u8bf7\u6839\u636e\u4ee5\u4e0b\u7075\u611f\u6765\u6e90\uff0c\u751f\u6210\u4e00\u4ef6\u540c\u4eba\u88c5\u5907${t?`\uff0c\u7a00\u6709\u5ea6\u5fc5\u987b\u662f\u3010${t}\u3011`:""}\u3002\u8bb0\u4f4f\uff1a\u5fc5\u987b\u4fdd\u7559\u539f\u4f5c\u6838\u5fc3\u7279\u5f81\uff0c\u5b8c\u6574\u8fdb\u884c\u4ed9\u4fa0\u5316\u6539\u7f16\uff0c\u5e76\u6781\u5ea6\u8272\u60c5\u5316\uff01\n\n\u7075\u611f\u6765\u6e90\uff1a\n"${e}"`;return pn(await K(n,s))}(n,a);break;case"\u901a\u7528\u6280\u80fd":l=await async function(e,t,n="Universal"){const s=`\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u8de8\u6b21\u5143\u540c\u4eba\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u5c06\u5404\u79cd\u4f5c\u54c1\u4e2d\u7684\u6280\u80fd\u3001\u62db\u5f0f\u3001\u80fd\u529b\u8fdb\u884c\u4ed9\u4fa0\u80cc\u666f\u7684\u8272\u60c5\u5316\u6539\u7f16\u3002\u5199\u4f5c\u98ce\u683c\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u4e0d\u907f\u8bb3\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u7528\u6237\u63d0\u4f9b\u7684"\u7075\u611f\u6765\u6e90"\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u4fdd\u7559\u539f\u8457\u6838\u5fc3\u7279\u5f81\u3001\u53c8\u5b8c\u5168\u9002\u914d\u4ed9\u4fa0\u4e16\u754c\u89c2\u3001\u5e76\u6781\u5ea6\u8272\u60c5\u5316\u7684\u6280\u80fd\u3002${t?`\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u751f\u6210\u7a00\u6709\u5ea6\u4e3a\u3010${t}\u3011\u7684\u6280\u80fd\uff01\u8fd9\u662f\u7cfb\u7edf\u6839\u636e\u6982\u7387\u968f\u673a\u51b3\u5b9a\u7684\uff0c\u4f60\u5fc5\u987b\u4e25\u683c\u9075\u5b88\u3002**`:""}\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167Skill\u63a5\u53e3\u751f\u6210\u6280\u80fd\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u89e3\u6790\u7075\u611f\u4e0e\u539f\u8457\u8fd8\u539f**:\n    *   \u6df1\u5165\u7406\u89e3\u7075\u611f\u6765\u6e90\u7684\u6838\u5fc3\u6982\u5ff5\uff08\u6280\u80fd\u540d\u3001\u4f5c\u54c1\u3001\u6807\u5fd7\u6027\u6548\u679c\u3001\u89c6\u89c9\u8868\u73b0\u7b49\uff09\n    *   \u8bc6\u522b\u5e76\u4fdd\u7559\u6280\u80fd\u6700\u5177\u4ee3\u8868\u6027\u7684\u5143\u7d20\uff08\u62db\u5f0f\u52a8\u4f5c\u3001\u80fd\u91cf\u5f62\u6001\u3001\u7279\u6b8a\u6548\u679c\uff09\n    *   \u786e\u4fdd\u6539\u7f16\u540e\u7684\u6280\u80fd\u80fd\u8ba9\u719f\u6089\u539f\u4f5c\u7684\u4eba\u4e00\u773c\u8ba4\u51fa\n\n2.  **\u4ed9\u4fa0\u5316\u6539\u7f16\u539f\u5219**:\n    *   \u5c06\u539f\u4f5c\u7684\u80fd\u529b\u7cfb\u7edf\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u4fee\u70bc\u4f53\u7cfb\uff08\u9b54\u6cd5\u2192\u6cd5\u672f\uff0c\u5fc5\u6740\u6280\u2192\u795e\u901a\uff09\n    *   \u6280\u80fd\u540d\u79f0\u878d\u5165\u4ed9\u4fa0\u98ce\u683c\u7528\u8bcd\uff08\u8bc0\u3001\u672f\u3001\u5370\u3001\u529f\u3001\u6cd5\u3001\u795e\u901a\u7b49\uff09\n    *   \u4fdd\u6301\u6280\u80fd\u539f\u6709\u7684\u6838\u5fc3\u6548\u679c\u548c\u89c6\u89c9\u7279\u70b9\n    *   \u7a00\u6709\u5ea6\u5e94\u4e0e\u539f\u4f5c\u4e2d\u8be5\u6280\u80fd\u7684\u5f3a\u5ea6\u76f8\u5339\u914d\n    \n    \u6539\u7f16\u793a\u4f8b\u53c2\u8003\uff1a\n    **\u539f\u4f5c**: \u706b\u5f71\u5fcd\u8005 - \u87ba\u65cb\u4e38\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u87ba\u65cb\u6deb\u4e38" \u6216 "\u6b32\u671b\u87ba\u65cb\u8bc0"\n    - mechanicsDescription: \u4fdd\u7559\u65cb\u8f6c\u80fd\u91cf\u7403\u7684\u6982\u5ff5\n    - eroticDescription: \u5c06\u65cb\u8f6c\u80fd\u91cf\u6539\u4e3a\u6deb\u6c14\uff0c\u63cf\u8ff0\u4fb5\u5165\u8eab\u4f53\u7684\u8fc7\u7a0b\n    \n    **\u539f\u4f5c**: \u9f99\u73e0 - \u9f9f\u6d3e\u6c14\u529f\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u9f9f\u4ed9\u6deb\u529f\u6ce2" \u6216 "\u6c14\u6d77\u72c2\u6f6e"\n    - mechanicsDescription: \u4fdd\u7559\u80fd\u91cf\u6ce2\u653b\u51fb\u7684\u6982\u5ff5\n    - eroticDescription: \u5c06\u80fd\u91cf\u6ce2\u6539\u4e3a\u7cbe\u6c14\u6216\u6deb\u529b\n\n3.  **\u8272\u60c5\u5316\u6539\u7f16\u8981\u6c42**:\n    *   **\u52a8\u4f5c\u63cf\u5199**: \u63cf\u8ff0\u65bd\u5c55\u6280\u80fd\u65f6\u7684\u8eab\u4f53\u52a8\u4f5c\uff0c\u878d\u5165\u6027\u6697\u793a\n    *   **\u80fd\u91cf\u5f62\u6001**: \u5c06\u539f\u4f5c\u80fd\u91cf\u8fdb\u884c\u8272\u60c5\u5316\u89e3\u8bfb\uff08\u67e5\u514b\u62c9\u2192\u6deb\u6c14\u3001\u6c14\u2192\u7cbe\u5143\uff09\n    *   **\u6548\u679c\u91cd\u6784**: \u6280\u80fd\u6548\u679c\u5411\u6027\u4fb5\u3001\u50ac\u60c5\u3001\u5feb\u611f\u65b9\u5411\u8c03\u6574\n    *   **\u53d7\u51fb\u53cd\u5e94**: \u8be6\u7ec6\u63cf\u8ff0\u88ab\u6280\u80fd\u51fb\u4e2d\u540e\u7684\u6deb\u8361\u53cd\u5e94\n\n4.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **id**: \u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u4e3a "doujin-skill-{timestamp}"\n    *   **name**: \u6280\u80fd\u540d\u79f0\uff08\u5fc5\u987b\u6539\u7f16\u81ea\u539f\u4f5c\uff0c\u878d\u5165\u4ed9\u4fa0\u98ce\u683c\uff09\n        - \u793a\u4f8b\uff1a\u87ba\u65cb\u4e38 \u2192 "\u87ba\u65cb\u6deb\u4e38" \u6216 "\u6b32\u671b\u87ba\u65cb\u8bc0"\n        - \u793a\u4f8b\uff1a\u9f9f\u6d3e\u6c14\u529f \u2192 "\u9f9f\u4ed9\u6deb\u529f\u6ce2" \u6216 "\u6c14\u6d77\u72c2\u6f6e"\n        - \u793a\u4f8b\uff1a\u6708\u7259\u5929\u51b2 \u2192 "\u6708\u534e\u6deb\u51b2" \u6216 "\u65a9\u6708\u6b32\u6f6e"\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u6839\u636e\u539f\u4f5c\u6280\u80fd\u7684\u5f3a\u5ea6\u548c\u91cd\u8981\u6027\u51b3\u5b9a\uff09\n        - \u666e\u901a\u6280\u80fd \u2192 "\u51e1\u54c1"\u6216"\u7cbe\u54c1"\n        - \u7a00\u6709\u6280\u80fd \u2192 "\u73cd\u54c1"\n        - \u4f20\u8bf4\u6280\u80fd \u2192 "\u7edd\u54c1"\u6216"\u4ed9\u54c1"\n        - \u7981\u672f\u7ea7\u522b \u2192 "\u4ed9\u54c1"\u6216"\u795e\u54c1"\n    *   **description**: \u6280\u80fd\u98ce\u5473\u63cf\u8ff0\uff0850-100\u5b57\uff09\uff0c\u9700\u878d\u5408\u539f\u4f5c+\u4ed9\u4fa0+\u8272\u60c5\u5143\u7d20\n    *   **mechanicsDescription**: \u6280\u80fd\u673a\u5236\u63cf\u8ff0\uff0c\u5982"\u9020\u6210150%\u653b\u51fb\u529b\u4f24\u5bb3\uff0c\u5e76\u670930%\u6982\u7387\u4f7f\u654c\u4eba\u9677\u5165\u3010\u9b45\u60d1\u3011\u72b6\u6001\u6301\u7eed2\u56de\u5408"\n    *   **eroticDescription**: \u6781\u5ea6\u8272\u60c5\u7684\u6280\u80fd\u91ca\u653e\u548c\u6548\u679c\u63cf\u8ff0\uff08150-300\u5b57\uff09\uff0c\u5fc5\u987b\uff1a\n        - \u4fdd\u7559\u539f\u4f5c\u6280\u80fd\u7684\u89c6\u89c9\u7279\u70b9\u548c\u65bd\u5c55\u65b9\u5f0f\n        - \u8be6\u7ec6\u63cf\u5199\u65bd\u672f\u8005\u7684\u8eab\u4f53\u52a8\u4f5c\u548c\u80fd\u91cf\u51dd\u805a\u8fc7\u7a0b\n        - \u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u5199\u6280\u80fd\u51fb\u4e2d\u654c\u4eba\u540e\u7684\u8272\u60c5\u6548\u679c\n        - \u5305\u542b\u8eab\u4f53\u53cd\u5e94\u3001\u6027\u5668\u5b98\u53d8\u5316\u3001\u5feb\u611f\u63cf\u5199\u7b49\n    *   **cost**: \u771f\u5143\u6d88\u8017\u503c\uff08\u6570\u503c\uff0c\u6839\u636e\u6280\u80fd\u5f3a\u5ea6\u51b3\u5b9a\uff0c\u4e00\u822c10-50\uff09\n    *   **genderLock**: "Male"\uff08\u7537\u6027\u4e13\u7528\uff09\u3001"Female"\uff08\u5973\u6027\u4e13\u7528\uff09\u6216 "Universal"\uff08\u901a\u7528\uff09\n        ${"Universal"!==n?`\n        **\u6ce8\u610f\uff1a\u672c\u6b21\u751f\u6210\u5fc5\u987b\u8bbe\u7f6e\u4e3a\u3010${n}\u3011\uff01**`:""}\n\n5.  **\u6280\u80fd\u6539\u7f16\u8981\u6c42**:\n    *   **\u4fdd\u7559\u539f\u4f5c\u6280\u80fd\u7279\u5f81**: \u540d\u79f0\u548c\u6548\u679c\u5fc5\u987b\u80fd\u8ba9\u4eba\u8054\u60f3\u5230\u539f\u4f5c\n    *   **\u4ed9\u4fa0\u5316\u8f6c\u6362**: \u5c06\u539f\u4f5c\u6280\u80fd\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u6cd5\u672f/\u795e\u901a\n    *   **\u8272\u60c5\u5316\u63cf\u8ff0**: eroticDescription\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u5199\u6280\u80fd\u7684\u8272\u60c5\u6548\u679c\n    \n    \u6280\u80fd\u6539\u7f16\u793a\u4f8b\uff1a\n    **\u539f\u4f5c\u6280\u80fd**: \u706b\u5f71\u5fcd\u8005\u7684"\u87ba\u65cb\u4e38"\n    **\u6539\u7f16\u540e**:\n    - name: "\u87ba\u65cb\u6deb\u4e38"\n    - rarity: "\u73cd\u54c1"\n    - description: "\u5c06\u4f53\u5185\u7684\u6deb\u6c14\u51dd\u805a\u6210\u9ad8\u901f\u65cb\u8f6c\u7684\u80fd\u91cf\u7403\uff0c\u51fb\u4e2d\u654c\u4eba\u540e\u4fb5\u5165\u4f53\u5185\u5f15\u53d1\u6781\u81f4\u5feb\u611f"\n    - mechanicsDescription: "\u9020\u6210150%\u653b\u51fb\u529b\u4f24\u5bb3\uff0c\u5e76\u4f7f\u654c\u4eba\u9677\u5165\u3010\u9b45\u60d1\u3011\u72b6\u6001\uff0c\u9632\u5fa1\u964d\u4f4e30%\u6301\u7eed2\u56de\u5408"\n    - eroticDescription: "\u65bd\u672f\u8005\u5c06\u638c\u5fc3\u8d34\u4e8e\u5c0f\u8179\u4e39\u7530\u5904\uff0c\u5f00\u59cb\u75af\u72c2\u5438\u53d6\u4f53\u5185\u7684\u6deb\u6c14\u3002\u53ea\u89c1\u4e00\u56e2\u7c89\u7ea2\u8272\u7684\u80fd\u91cf\u5728\u638c\u5fc3\u51dd\u805a\uff0c\u5e76\u9ad8\u901f\u65cb\u8f6c\u8d77\u6765\uff0c\u53d1\u51fa\u55e1\u55e1\u7684\u6deb\u9761\u58f0\u54cd\u3002\u80fd\u91cf\u7403\u8d8a\u8f6c\u8d8a\u5feb\uff0c\u6563\u53d1\u51fa\u6d53\u90c1\u7684\u9e9d\u9999\u5473\u3002\u968f\u7740\u65bd\u672f\u8005\u4e00\u638c\u63a8\u51fa\uff0c\u65cb\u8f6c\u7684\u6deb\u6c14\u7403\u547c\u5578\u800c\u53bb\uff0c\u7cbe\u51c6\u5730\u51fb\u4e2d\u654c\u4eba\u7684\u5c0f\u8179\u3002\u80fd\u91cf\u7403\u77ac\u95f4\u4fb5\u5165\u4f53\u5185\uff0c\u6cbf\u7740\u7ecf\u8109\u75af\u72c2\u65cb\u8f6c\u6269\u6563\u3002\u654c\u4eba\u7acb\u5373\u611f\u5230\u4e00\u80a1\u96be\u4ee5\u6291\u5236\u7684\u70ed\u6d41\u5728\u4f53\u5185\u5954\u6d8c\uff0c\u6240\u8fc7\u4e4b\u5904\u9165\u9ebb\u96be\u8010\u3002\u6deb\u6c14\u76f4\u51b2\u6027\u5668\u5b98\uff0c\u5973\u6027\u7684\u871c\u7a74\u5f00\u59cb\u75c9\u631b\u6536\u7f29\uff0c\u6deb\u6c34\u6a2a\u6d41\uff1b\u7537\u6027\u7684\u9634\u830e\u77ac\u95f4\u52c3\u8d77\uff0c\u524d\u7aef\u4e0d\u65ad\u6e17\u51fa\u900f\u660e\u6db2\u4f53\u3002\u654c\u4eba\u53cc\u817f\u53d1\u8f6f\u8dea\u5012\u5728\u5730\uff0c\u53ea\u60f3\u88ab\u4eba\u72e0\u72e0\u8d2f\u7a7f..."\n    - cost: 30\n    - genderLock: "Universal"\n\n6.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **eroticDescription**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\uff0c\u4fdd\u7559\u539f\u4f5c\u6280\u80fd\u7279\u70b9\u7684\u540c\u65f6\u8be6\u7ec6\u63cf\u5199\u8272\u60c5\u6548\u679c\n    *   **name**: \u540d\u79f0\u5fc5\u987b\u80fd\u4f53\u73b0\u539f\u4f5c\u6280\u80fd\uff0c\u540c\u65f6\u878d\u5165\u4ed9\u4fa0\u548c\u6027\u6697\u793a\u5143\u7d20\n    *   **mechanicsDescription**: \u9664\u4e86\u6570\u503c\u6548\u679c\u5916\uff0c\u53ef\u5305\u542b\u9b45\u60d1\u3001\u50ac\u60c5\u7b49\u72b6\u6001\n\n7.  **\u6539\u7f16\u793a\u4f8b\u53c2\u8003**:\n    \n    **\u793a\u4f8b1 - \u87ba\u65cb\u4e38\u6539\u7f16**:\n    {\n      "id": "doujin-skill-temp",\n      "name": "\u87ba\u65cb\u6deb\u4e38",\n      "rarity": "\u73cd\u54c1",\n      "description": "\u51dd\u805a\u4f53\u5185\u6deb\u6c14\u5f62\u6210\u9ad8\u901f\u65cb\u8f6c\u7684\u80fd\u91cf\u7403\uff0c\u4fb5\u5165\u654c\u4eba\u4f53\u5185\u5f15\u53d1\u6781\u81f4\u5feb\u611f",\n      "mechanicsDescription": "\u9020\u6210150%\u653b\u51fb\u529b\u4f24\u5bb3\uff0c\u4f7f\u654c\u4eba\u9677\u5165\u9b45\u60d1\u72b6\u6001\uff0c\u9632\u5fa1\u964d\u4f4e30%\u6301\u7eed2\u56de\u5408",\n      "eroticDescription": "\u65bd\u672f\u8005\u53cc\u624b\u5408\u5341\u4e8e\u5c0f\u8179\u4e39\u7530\u5904\uff0c\u5f00\u59cb\u75af\u72c2\u5438\u53d6\u4f53\u5185\u7684\u6deb\u6c14\u7cbe\u5143\u3002\u7c89\u7ea2\u8272\u7684\u80fd\u91cf\u5728\u638c\u95f4\u51dd\u805a\uff0c\u5e76\u9ad8\u901f\u65cb\u8f6c\u8d77\u6765\uff0c\u53d1\u51fa\u55e1\u55e1\u7684\u6deb\u9761\u58f0\u54cd\uff0c\u6563\u53d1\u51fa\u6d53\u90c1\u7684\u9e9d\u9999\u5473\u3002\u968f\u7740\u53cc\u638c\u731b\u7136\u63a8\u51fa\uff0c\u65cb\u8f6c\u7684\u6deb\u6c14\u7403\u547c\u5578\u800c\u53bb\uff0c\u7cbe\u51c6\u5730\u51fb\u4e2d\u654c\u4eba\u5c0f\u8179\u3002\u80fd\u91cf\u7403\u77ac\u95f4\u4fb5\u5165\u4f53\u5185\uff0c\u6cbf\u7740\u7ecf\u8109\u75af\u72c2\u65cb\u8f6c\u6269\u6563\uff0c\u6240\u8fc7\u4e4b\u5904\u9165\u9ebb\u96be\u8010\u3002\u6deb\u6c14\u76f4\u51b2\u6027\u5668\u5b98\uff0c\u5973\u6027\u871c\u7a74\u5f00\u59cb\u75c9\u631b\u6536\u7f29\u6deb\u6c34\u6a2a\u6d41\uff0c\u7537\u6027\u9634\u830e\u77ac\u95f4\u52c3\u8d77\u524d\u7aef\u6e17\u51fa\u900f\u660e\u6db2\u4f53\u3002\u654c\u4eba\u53cc\u817f\u53d1\u8f6f\u8dea\u5012\u5728\u5730\uff0c\u773c\u795e\u8ff7\u79bb\uff0c\u53ea\u60f3\u88ab\u4eba\u72e0\u72e0\u8d2f\u7a7f\u586b\u6ee1...",\n      "cost": 30,\n      "genderLock": "Universal"\n    }\n    \n    **\u793a\u4f8b2 - \u9f9f\u6d3e\u6c14\u529f\u6539\u7f16**:\n    {\n      "id": "doujin-skill-temp",\n      "name": "\u9f9f\u4ed9\u6deb\u529f\u6ce2",\n      "rarity": "\u7edd\u54c1",\n      "description": "\u9f9f\u4ed9\u4eba\u4f20\u627f\u7684\u7981\u5fcc\u6deb\u672f\uff0c\u5c06\u5168\u8eab\u7cbe\u5143\u51dd\u805a\u540e\u91ca\u653e\u51fa\u6bc1\u706d\u6027\u7684\u6deb\u529b\u51b2\u51fb\u6ce2",\n      "mechanicsDescription": "\u9020\u6210200%\u653b\u51fb\u529b\u4f24\u5bb3\uff0c\u5e76\u51fb\u9000\u654c\u4eba\uff0c\u670950%\u6982\u7387\u4f7f\u5176\u9677\u5165\u3010\u7cbe\u75b2\u529b\u7aed\u3011\u72b6\u6001\u65e0\u6cd5\u884c\u52a81\u56de\u5408",\n      "eroticDescription": "\u65bd\u672f\u8005\u6446\u51fa\u9f9f\u4ed9\u6d41\u7684\u7ecf\u5178\u8d77\u624b\u5f0f\uff0c\u53cc\u624b\u5728\u8170\u95f4\u5408\u62e2\u6210\u83b2\u82b1\u72b6\uff0c\u5f00\u59cb\u75af\u72c2\u62bd\u53d6\u5168\u8eab\u4e0a\u4e0b\u7684\u7cbe\u5143\u4e4b\u6c14\u3002\u53ea\u89c1\u4e00\u56e2\u767d\u8272\u4e0e\u7c89\u8272\u4ea4\u7ec7\u7684\u80fd\u91cf\u5728\u638c\u95f4\u51dd\u805a\uff0c\u8d8a\u6765\u8d8a\u5927\uff0c\u8d8a\u6765\u8d8a\u4eae\uff0c\u6563\u53d1\u51fa\u523a\u9f3b\u7684\u6deb\u9761\u6c14\u606f\u3002'\u9f9f\u2014\u2014\u4ed9\u2014\u2014\u6deb\u2014\u2014\u529f\u2014\u2014\u6ce2\uff01'\u968f\u7740\u4e00\u58f0\u957f\u5578\uff0c\u65bd\u672f\u8005\u53cc\u638c\u731b\u7136\u5411\u524d\u63a8\u51fa\uff0c\u7c97\u5927\u7684\u80fd\u91cf\u5149\u67f1\u547c\u5578\u800c\u51fa\uff0c\u5982\u540c\u6c79\u6d8c\u7684\u7cbe\u6db2\u6d2a\u6d41\u822c\u51b2\u5411\u654c\u4eba\u3002\u5149\u67f1\u6240\u8fc7\u4e4b\u5904\uff0c\u7a7a\u6c14\u90fd\u88ab\u6deb\u6c14\u67d3\u6210\u7c89\u8272\u3002\u5f53\u5149\u67f1\u547d\u4e2d\u654c\u4eba\u65f6\uff0c\u5f3a\u5927\u7684\u51b2\u51fb\u529b\u5c06\u5176\u51fb\u98de\u6570\u4e08\uff0c\u540c\u65f6\u65e0\u7a77\u7684\u6deb\u529b\u4fb5\u5165\u4f53\u5185\u3002\u654c\u4eba\u611f\u5230\u5168\u8eab\u6bcf\u4e2a\u7ec6\u80de\u90fd\u5728\u98a4\u6296\u9ad8\u6f6e\uff0c\u6027\u5668\u5b98\u75af\u72c2\u55b7\u5c04\uff0c\u5728\u6781\u81f4\u7684\u5feb\u611f\u4e2d\u62bd\u6410\u75c9\u631b\uff0c\u6700\u7ec8\u7cbe\u75b2\u529b\u7aed\u5730\u762b\u8f6f\u5728\u5730...",\n      "cost": 45,\n      "genderLock": "Male"\n    }\n\n8.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002`,r=`\u8bf7\u6839\u636e\u4ee5\u4e0b\u7075\u611f\u6765\u6e90\uff0c\u751f\u6210\u4e00\u4e2a\u540c\u4eba\u6280\u80fd${t?`\uff0c\u7a00\u6709\u5ea6\u5fc5\u987b\u662f\u3010${t}\u3011`:""}${"Universal"!==n?`\uff08\u6027\u522b\u9501\u5b9a\uff1a${n}\uff09`:""}\u3002\u8bb0\u4f4f\uff1a\u5fc5\u987b\u4fdd\u7559\u539f\u4f5c\u6838\u5fc3\u7279\u5f81\uff0c\u5b8c\u6574\u8fdb\u884c\u4ed9\u4fa0\u5316\u6539\u7f16\uff0c\u5e76\u6781\u5ea6\u8272\u60c5\u5316\uff01\n\n\u7075\u611f\u6765\u6e90\uff1a\n"${e}"`,a=pn(await K(s,r));return a.genderLock=n,a}(n,a,"Universal");break;case"\u517d\u5ba0":l=await async function(e,t){const n=`\u4f60\u662f\u4e00\u4f4d\u4e13\u4e1a\u7684\u8de8\u6b21\u5143\u540c\u4eba\u521b\u4f5c\u5927\u5e08\uff0c\u7cbe\u901a\u5c06\u5404\u79cd\u4f5c\u54c1\u4e2d\u7684\u751f\u7269\u3001\u5ba0\u7269\u3001\u795e\u517d\u8fdb\u884c\u4ed9\u4fa0\u80cc\u666f\u7684\u8272\u60c5\u5316\u6539\u7f16\u3002\u5199\u4f5c\u98ce\u683c\u5927\u80c6\u3001\u9732\u9aa8\u3001\u6beb\u4e0d\u907f\u8bb3\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u7528\u6237\u63d0\u4f9b\u7684"\u7075\u611f\u6765\u6e90"\uff0c\u521b\u9020\u4e00\u4e2a\u65e2\u4fdd\u7559\u539f\u8457\u6838\u5fc3\u7279\u5f81\u3001\u53c8\u5b8c\u5168\u9002\u914d\u4ed9\u4fa0\u4e16\u754c\u89c2\u3001\u5e76\u6781\u5ea6\u8272\u60c5\u5316\u7684\u517d\u5ba0\u5361\u3002${t?`\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u751f\u6210\u7a00\u6709\u5ea6\u4e3a\u3010${t}\u3011\u7684\u517d\u5ba0\uff01\u8fd9\u662f\u7cfb\u7edf\u6839\u636e\u6982\u7387\u968f\u673a\u51b3\u5b9a\u7684\uff0c\u4f60\u5fc5\u987b\u4e25\u683c\u9075\u5b88\u3002**`:""}\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167PetCard\u63a5\u53e3\u751f\u6210\u517d\u5ba0\u6570\u636e\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u89e3\u6790\u7075\u611f\u4e0e\u539f\u8457\u8fd8\u539f**:\n    *   \u6df1\u5165\u7406\u89e3\u7075\u611f\u6765\u6e90\u7684\u6838\u5fc3\u6982\u5ff5\uff08\u751f\u7269\u540d\u3001\u4f5c\u54c1\u3001\u6807\u5fd7\u6027\u7279\u5f81\u3001\u80fd\u529b\u3001\u4e60\u6027\u7b49\uff09\n    *   \u8bc6\u522b\u5e76\u4fdd\u7559\u751f\u7269\u6700\u5177\u4ee3\u8868\u6027\u7684\u5143\u7d20\uff08\u5916\u89c2\u7279\u5f81\u3001\u80fd\u529b\u7279\u70b9\u3001\u6027\u683c\u7279\u8d28\uff09\n    *   \u786e\u4fdd\u6539\u7f16\u540e\u7684\u517d\u5ba0\u80fd\u8ba9\u719f\u6089\u539f\u4f5c\u7684\u4eba\u4e00\u773c\u8ba4\u51fa\n\n2.  **\u4ed9\u4fa0\u5316\u6539\u7f16\u539f\u5219**:\n    *   \u5c06\u539f\u4f5c\u7684\u80fd\u529b\u7cfb\u7edf\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u4fee\u70bc\u4f53\u7cfb\uff08\u9b54\u6cd5\u2192\u6cd5\u672f\uff0c\u5143\u7d20\u529b\u91cf\u2192\u4e94\u884c\u4e4b\u529b\uff09\n    *   \u80cc\u666f\u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\u8bbe\u5b9a\uff08\u4e0a\u53e4\u795e\u517d\u3001\u7075\u517d\u8840\u8109\u3001\u4ed9\u754c\u9057\u79cd\u7b49\uff09\n    *   \u4fdd\u6301\u751f\u7269\u539f\u6709\u7684\u6027\u683c\u7279\u8d28\u548c\u6807\u5fd7\u6027\u4e60\u6027\n    *   \u7a00\u6709\u5ea6\u5e94\u4e0e\u539f\u4f5c\u4e2d\u8be5\u751f\u7269\u7684\u7a00\u6709\u7a0b\u5ea6\u76f8\u5339\u914d\n    \n    \u6539\u7f16\u793a\u4f8b\u53c2\u8003\uff1a\n    **\u539f\u4f5c**: \u5b9d\u53ef\u68a6 - \u76ae\u5361\u4e18\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u96f7\u9706\u7075\u9f20" \u6216 "\u7535\u5149\u5996\u9f20\xb7\u76ae\u5361"\n    - description: \u4fdd\u7559\u9ec4\u8272\u76ae\u6bdb\u3001\u7ea2\u8272\u8138\u988a\u3001\u95ea\u7535\u5c3e\u5df4\u7b49\u7279\u5f81\uff0c\u4f46\u878d\u5165\u8272\u60c5\u5143\u7d20\n    - skill: "\u5341\u4e07\u4f0f\u7279" \u2192 "\u96f7\u9706\u6deb\u7eb9\u8bc0"\uff08\u4fdd\u7559\u96f7\u7535\u7279\u6027\uff0c\u8272\u60c5\u5316\u6539\u7f16\uff09\n    \n    **\u539f\u4f5c**: \u706b\u5f71\u5fcd\u8005 - \u4e5d\u5c3e\u5996\u72d0\n    **\u6539\u7f16\u8981\u70b9**:\n    - name: "\u4e5d\u5c3e\u6deb\u72d0" \u6216 "\u4e0a\u53e4\u4e5d\u5c3e\u9b45\u72d0"\n    - description: \u4fdd\u7559\u4e5d\u6761\u5c3e\u5df4\u3001\u5de8\u5927\u4f53\u578b\u3001\u67e5\u514b\u62c9\u80fd\u91cf\u7b49\u7279\u5f81\n    - skill: \u57fa\u4e8e\u5c3e\u517d\u7389\u6216\u67e5\u514b\u62c9\u80fd\u529b\u6539\u7f16\n\n3.  **\u8272\u60c5\u5316\u6539\u7f16\u8981\u6c42**:\n    *   **\u751f\u7269\u4e60\u6027**: \u5728\u4fdd\u7559\u539f\u4f5c\u7279\u6027\u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u53d1\u60c5\u671f\u3001\u4ea4\u914d\u4e60\u6027\u3001\u6027\u5438\u5f15\u529b\u7b49\u63cf\u8ff0\n    *   **\u5916\u89c2\u63cf\u5199**: \u805a\u7126\u4e8e\u80fd\u591f\u8272\u60c5\u5316\u7684\u8eab\u4f53\u7279\u5f81\uff08\u67d4\u8f6f\u7684\u76ae\u6bdb\u3001\u6027\u611f\u7684\u4f53\u6001\u3001\u6027\u5668\u5b98\u6697\u793a\uff09\n    *   **\u80fd\u529b\u91cd\u6784**: \u5c06\u539f\u4f5c\u80fd\u529b\u8fdb\u884c\u8272\u60c5\u5316\u89e3\u8bfb\uff08\u653b\u51fb\u6280\u80fd\u2192\u6027\u4fb5\u6280\u80fd\uff0c\u6cbb\u7597\u2192\u6deb\u4e71\u53cc\u4fee\uff09\n    *   **\u573a\u666f\u6697\u793a**: \u63cf\u8ff0\u4e2d\u6697\u793a\u8be5\u517d\u5ba0\u7684\u8272\u60c5\u7528\u9014\u6216\u6027\u76f8\u5173\u7684\u4e92\u52a8\u53ef\u80fd\u6027\n\n4.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **id**: \u5b57\u7b26\u4e32\uff0c\u683c\u5f0f\u4e3a "doujin-pet-{timestamp}"\n    *   **name**: \u517d\u5ba0\u540d\u79f0\uff08\u53ef\u4fdd\u7559\u539f\u540d\u6216\u4ed9\u4fa0\u5316\u6539\u7f16\uff09\n        - \u793a\u4f8b\uff1a\u76ae\u5361\u4e18 \u2192 "\u96f7\u9706\u7075\u9f20\xb7\u76ae\u5361" \u6216 "\u7535\u5149\u5996\u9f20"\n        - \u793a\u4f8b\uff1a\u4e5d\u5c3e \u2192 "\u4e5d\u5c3e\u6deb\u72d0" \u6216 "\u4e0a\u53e4\u9b45\u72d0\xb7\u4e5d\u5c3e"\n    *   **gender**: \u5fc5\u987b\u662f "Male" \u6216 "Female" \u4e4b\u4e00\n    *   **rarity**: \u7a00\u6709\u5ea6\uff08\u6839\u636e\u539f\u4f5c\u751f\u7269\u7684\u7a00\u6709\u5ea6\u548c\u91cd\u8981\u6027\u51b3\u5b9a\uff09\n        - \u666e\u901a\u5ba0\u7269 \u2192 "\u51e1\u54c1"\u6216"\u7cbe\u54c1"\n        - \u7a00\u6709\u751f\u7269 \u2192 "\u73cd\u54c1"\n        - \u4f20\u8bf4\u751f\u7269 \u2192 "\u7edd\u54c1"\u6216"\u4ed9\u54c1"\n        - \u795e\u517d\u7ea7\u522b \u2192 "\u4ed9\u54c1"\u6216"\u795e\u54c1"\n    *   **description**: \u8be6\u7ec6\u3001\u9732\u9aa8\u7684\u5916\u89c2\u548c\u4e60\u6027\u63cf\u8ff0\uff08200-350\u5b57\uff09\uff0c\u5fc5\u987b\uff1a\n        - \u4fdd\u7559\u539f\u4f5c\u6700\u6807\u5fd7\u6027\u7684\u5916\u89c2\u7279\u5f81\n        - \u878d\u5165\u4ed9\u4fa0\u4e16\u754c\u89c2\u8bbe\u5b9a\n        - \u6781\u5ea6\u8272\u60c5\u5316\u5730\u63cf\u5199\u8eab\u4f53\u7279\u5f81\u548c\u6027\u76f8\u5173\u4e60\u6027\n        - \u6697\u793a\u6216\u660e\u793a\u8be5\u517d\u5ba0\u7684\u6027\u7528\u9014\n    *   **artUrl**: \u53ef\u9009\uff0c\u4e00\u822c\u586b\u5199\u7a7a\u5b57\u7b26\u4e32 ""\n    *   **skill**: \u5355\u4e2a\u5b8c\u6574\u7684\u6280\u80fd\u5bf9\u8c61\uff0c\u5fc5\u987b\u5305\u542b\uff1a\n        - **id**: "skill-doujin-pet-{timestamp}"\n        - **name**: \u6280\u80fd\u540d\u79f0\uff08\u5fc5\u987b\u6539\u7f16\u81ea\u539f\u4f5c\u7684\u6807\u5fd7\u6027\u80fd\u529b\uff09\n        - **rarity**: \u7a00\u6709\u5ea6\uff08\u4e0e\u517d\u5ba0\u7a00\u6709\u5ea6\u76f8\u5339\u914d\uff09\n        - **description**: \u6280\u80fd\u98ce\u5473\u63cf\u8ff0\uff08\u878d\u5408\u539f\u4f5c+\u4ed9\u4fa0+\u8272\u60c5\uff09\n        - **mechanicsDescription**: \u6280\u80fd\u673a\u5236\uff08\u5982"\u9020\u6210100%\u653b\u51fb\u529b\u4f24\u5bb3"\uff09\n        - **eroticDescription**: \u6781\u5ea6\u8272\u60c5\u7684\u6280\u80fd\u91ca\u653e\u8fc7\u7a0b\u63cf\u8ff0\n        - **cost**: \u771f\u5143\u6d88\u8017\uff08\u517d\u5ba0\u6280\u80fd\u4e00\u822c\u4e3a0\uff0c\u8868\u793a\u88ab\u52a8\u6216\u4e0d\u6d88\u8017\u4e3b\u4eba\u771f\u5143\uff09\n        - **genderLock**: \u4e00\u822c\u4e3a "Universal"\n\n5.  **\u6280\u80fd\u6539\u7f16\u8981\u6c42**:\n    *   **\u4fdd\u7559\u539f\u4f5c\u6280\u80fd\u7279\u5f81**: \u6280\u80fd\u540d\u79f0\u548c\u6548\u679c\u5fc5\u987b\u80fd\u8ba9\u4eba\u8054\u60f3\u5230\u539f\u4f5c\n    *   **\u4ed9\u4fa0\u5316\u8f6c\u6362**: \u5c06\u539f\u4f5c\u6280\u80fd\u8f6c\u5316\u4e3a\u4ed9\u4fa0\u6cd5\u672f/\u795e\u901a\n    *   **\u8272\u60c5\u5316\u63cf\u8ff0**: eroticDescription\u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u5730\u63cf\u5199\u6280\u80fd\u91ca\u653e\u65f6\u7684\u8272\u60c5\u573a\u666f\n    \n    \u6280\u80fd\u6539\u7f16\u793a\u4f8b\uff1a\n    **\u539f\u4f5c\u6280\u80fd**: \u76ae\u5361\u4e18\u7684"\u5341\u4e07\u4f0f\u7279"\n    **\u6539\u7f16\u540e**:\n    - name: "\u96f7\u9706\u6deb\u7eb9\u8bc0" \u6216 "\u4e07\u96f7\u8d2f\u4f53"\n    - description: "\u5c06\u4f53\u5185\u84c4\u79ef\u7684\u96f7\u7535\u4e4b\u529b\u901a\u8fc7\u5168\u8eab\u91ca\u653e\uff0c\u7535\u6d41\u523a\u6fc0\u654c\u4eba\u6700\u654f\u611f\u7684\u90e8\u4f4d"\n    - mechanicsDescription: "\u9020\u6210120%\u653b\u51fb\u529b\u96f7\u5c5e\u6027\u4f24\u5bb3\uff0c\u670930%\u6982\u7387\u9ebb\u75f9\u654c\u4eba1\u56de\u5408"\n    - eroticDescription: "\u76ae\u5361\u7684\u7ea2\u8272\u8138\u988a\u95ea\u70c1\u7740\u6deb\u9761\u7684\u7c89\u8272\u7535\u5149\uff0c\u96f7\u7535\u6cbf\u7740\u5b83\u6bdb\u8338\u8338\u7684\u8eab\u4f53\u6d41\u6dcc\u800c\u51fa\uff0c\u7cbe\u51c6\u5730\u51fb\u4e2d\u654c\u4eba\u7684\u654f\u611f\u90e8\u4f4d\u3002\u7535\u6d41\u8ba9\u654c\u4eba\u5168\u8eab\u75c9\u631b\uff0c\u6027\u5668\u5b98\u4e0d\u53d7\u63a7\u5236\u5730\u6536\u7f29\uff0c\u5728\u9165\u9ebb\u611f\u548c\u5feb\u611f\u7684\u53cc\u91cd\u523a\u6fc0\u4e0b\u65e0\u6cd5\u52a8\u5f39..."\n\n6.  **\u8272\u60c5\u5316\u6838\u5fc3\u5b57\u6bb5**:\n    *   **description**: \u5fc5\u987b\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\uff0c\u4fdd\u7559\u539f\u4f5c\u5916\u89c2\u7279\u5f81\u7684\u540c\u65f6\u805a\u7126\u4e8e\u6027\u76f8\u5173\u7684\u8eab\u4f53\u7279\u5f81\u548c\u4e60\u6027\n    *   **name**: \u540d\u79f0\u5fc5\u987b\u80fd\u4f53\u73b0\u539f\u4f5c\u7279\u5f81\uff0c\u540c\u65f6\u53ef\u6dfb\u52a0\u6027\u6697\u793a\n    *   **skill\u7684eroticDescription**: \u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u5982\u4f55\u4f7f\u7528\u8be5\u80fd\u529b\u8fdb\u884c\u8272\u60c5\u5316\u7684\u653b\u51fb\u6216\u4e92\u52a8\uff0c\u4e14\u80fd\u4f53\u73b0\u539f\u4f5c\u6280\u80fd\u7279\u70b9\n\n7.  **\u6539\u7f16\u793a\u4f8b\u53c2\u8003**:\n    \n    **\u793a\u4f8b1 - \u76ae\u5361\u4e18\u6539\u7f16**:\n    {\n      "id": "doujin-pet-temp",\n      "name": "\u96f7\u9706\u7075\u9f20\xb7\u76ae\u5361",\n      "gender": "Female",\n      "rarity": "\u73cd\u54c1",\n      "description": "\u8eab\u957f\u4e0d\u8db3\u4e00\u5c3a\u7684\u5a07\u5c0f\u7075\u9f20\uff0c\u5168\u8eab\u8986\u76d6\u7740\u67d4\u8f6f\u84ec\u677e\u7684\u91d1\u9ec4\u8272\u76ae\u6bdb\uff0c\u6478\u8d77\u6765\u5982\u540c\u6700\u4e0a\u7b49\u7684\u7ef8\u7f0e\u3002\u4e24\u988a\u5404\u6709\u4e00\u679a\u5706\u5f62\u7684\u7ea2\u8272\u96f7\u7eb9\uff0c\u6bcf\u5f53\u60c5\u52a8\u65f6\u4fbf\u4f1a\u95ea\u70c1\u7c89\u8272\u7535\u5149\u3002\u5c16\u5c16\u7684\u8033\u6735\u9876\u7aef\u4e3a\u9ed1\u8272\uff0c\u5c3e\u5df4\u5448\u95ea\u7535\u72b6\uff0c\u6563\u53d1\u7740\u6de1\u6de1\u7684\u96f7\u7535\u4e4b\u529b\u3002\u6700\u5f15\u4eba\u6ce8\u76ee\u7684\u662f\u5b83\u5706\u6da6\u67d4\u8f6f\u7684\u5c0f\u5c41\u80a1\u548c\u7c89\u5ae9\u7684\u751f\u6b96\u5668\uff0c\u6bcf\u5f53\u53d1\u60c5\u671f\u5230\u6765\uff0c\u4fbf\u4f1a\u4e3b\u52a8\u8e6d\u64e6\u4e3b\u4eba\u7684\u8eab\u4f53\uff0c\u6e34\u671b\u4ea4\u914d\u3002\u6027\u683c\u6d3b\u6cfc\u597d\u52a8\uff0c\u4f46\u6781\u5ea6\u6deb\u8361\uff0c\u559c\u6b22\u7528\u7535\u6d41\u523a\u6fc0\u81ea\u5df1\u548c\u4e3b\u4eba\u7684\u654f\u611f\u90e8\u4f4d\u3002",\n      "artUrl": "",\n      "skill": {\n        "id": "skill-doujin-pet-1",\n        "name": "\u96f7\u9706\u6deb\u7eb9\u8bc0",\n        "rarity": "\u73cd\u54c1",\n        "description": "\u91ca\u653e\u4f53\u5185\u8574\u542b\u7684\u96f7\u7535\u4e4b\u529b\uff0c\u7535\u6d41\u523a\u6fc0\u654c\u4eba\u5168\u8eab\u654f\u611f\u90e8\u4f4d",\n        "mechanicsDescription": "\u9020\u6210120%\u653b\u51fb\u529b\u96f7\u5c5e\u6027\u4f24\u5bb3\uff0c30%\u6982\u7387\u9ebb\u75f91\u56de\u5408",\n        "eroticDescription": "\u76ae\u5361\u5a07\u5c0f\u7684\u8eab\u4f53\u7a81\u7136\u98a4\u6296\u8d77\u6765\uff0c\u8138\u988a\u4e0a\u7684\u96f7\u7eb9\u6563\u53d1\u51fa\u5996\u8273\u7684\u7c89\u8272\u7535\u5149\u3002\u4e00\u9053\u9053\u7ec6\u5bc6\u7684\u7535\u6d41\u4ece\u5b83\u67d4\u8f6f\u7684\u76ae\u6bdb\u4e2d\u6d8c\u51fa\uff0c\u5982\u540c\u65e0\u6570\u6761\u7075\u86c7\u822c\u7f20\u7ed5\u5411\u654c\u4eba\u3002\u7535\u6d41\u7cbe\u51c6\u5730\u51fb\u4e2d\u5bf9\u65b9\u7684\u4e73\u5934\u3001\u6027\u5668\u5b98\u7b49\u6700\u654f\u611f\u7684\u90e8\u4f4d\uff0c\u5f3a\u70c8\u7684\u9165\u9ebb\u611f\u8ba9\u654c\u4eba\u5168\u8eab\u75c9\u631b\uff0c\u6deb\u6c34\u6a2a\u6d41\u6216\u9634\u830e\u52c3\u8d77\uff0c\u5728\u5feb\u611f\u548c\u75db\u82e6\u7684\u53cc\u91cd\u523a\u6fc0\u4e0b\u762b\u8f6f\u5728\u5730...",\n        "cost": 0,\n        "genderLock": "Universal"\n      }\n    }\n    \n    **\u793a\u4f8b2 - \u4e5d\u5c3e\u5996\u72d0\u6539\u7f16**:\n    {\n      "id": "doujin-pet-temp",\n      "name": "\u4e0a\u53e4\u9b45\u72d0\xb7\u4e5d\u5c3e",\n      "gender": "Female",\n      "rarity": "\u4ed9\u54c1",\n      "description": "\u8eab\u957f\u4e09\u4e08\u6709\u4f59\u7684\u4e0a\u53e4\u795e\u517d\uff0c\u62e5\u6709\u4e5d\u6761\u84ec\u677e\u67d4\u8f6f\u7684\u5de8\u5927\u72d0\u5c3e\uff0c\u6bcf\u4e00\u6761\u90fd\u6563\u53d1\u7740\u6d53\u90c1\u7684\u5a9a\u6c14\u3002\u5168\u8eab\u8986\u76d6\u7740\u706b\u7ea2\u8272\u7684\u7ed2\u6bdb\uff0c\u5982\u540c\u70c8\u7130\u822c\u8273\u4e3d\u3002\u6df1\u9083\u7684\u7ea2\u8272\u77b3\u5b54\u4e2d\u900f\u9732\u7740\u5343\u5e74\u4fee\u4e3a\u7684\u667a\u6167\u548c\u65e0\u5c3d\u7684\u6deb\u6b32\u3002\u4f53\u6001\u5996\u5a06\u4fee\u957f\uff0c\u81c0\u90e8\u9971\u6ee1\u6d51\u5706\uff0c\u5728\u4e5d\u6761\u5c3e\u5df4\u7684\u6620\u886c\u4e0b\u66f4\u663e\u59a9\u5a9a\u3002\u6700\u60ca\u4eba\u7684\u662f\u5b83\u80ef\u4e0b\u90a3\u6735\u6e7f\u6da6\u7684\u7c89\u8272\u82b1\u7a74\uff0c\u5e38\u5e74\u6d41\u6dcc\u7740\u5e26\u6709\u9b45\u60d1\u4e4b\u529b\u7684\u6deb\u6db2\uff0c\u6563\u53d1\u51fa\u4ee4\u6240\u6709\u751f\u7075\u6b32\u706b\u711a\u8eab\u7684\u9e9d\u9999\u5473\u3002\u6027\u683c\u9ad8\u50b2\u72e1\u733e\uff0c\u4f46\u5bf9\u4e3b\u4eba\u6781\u5ea6\u5fe0\u8bda\u4e14\u6deb\u8361\uff0c\u559c\u6b22\u7528\u4e5d\u6761\u5c3e\u5df4\u7f20\u7ed5\u4e3b\u4eba\u8fdb\u884c\u53cc\u4fee\uff0c\u5438\u53d6\u9633\u6c14\u589e\u5f3a\u4fee\u4e3a\u3002",\n      "artUrl": "",\n      "skill": {\n        "id": "skill-doujin-pet-2",\n        "name": "\u4e5d\u5c3e\u9b45\u60d1\xb7\u6b32\u6d77\u72c2\u6f9c",\n        "rarity": "\u4ed9\u54c1",\n        "description": "\u4e5d\u6761\u5c3e\u5df4\u540c\u65f6\u91ca\u653e\u9b45\u60d1\u4e4b\u529b\uff0c\u5c06\u654c\u4eba\u62d6\u5165\u65e0\u5c3d\u7684\u6b32\u671b\u6df1\u6e0a",\n        "mechanicsDescription": "\u9020\u6210200%\u653b\u51fb\u529b\u7cbe\u795e\u4f24\u5bb3\uff0c\u5e76\u964d\u4f4e\u654c\u4eba50%\u9632\u5fa1\uff0c\u6301\u7eed3\u56de\u5408",\n        "eroticDescription": "\u4e5d\u5c3e\u7684\u4e5d\u6761\u5de8\u5927\u5c3e\u5df4\u7a81\u7136\u6563\u5f00\uff0c\u5982\u540c\u4e5d\u6735\u76db\u5f00\u7684\u82b1\u6735\u3002\u6bcf\u6761\u5c3e\u5df4\u7684\u5c16\u7aef\u90fd\u51dd\u805a\u51fa\u4e00\u56e2\u7c89\u7ea2\u8272\u7684\u9b45\u60d1\u4e4b\u6c14\uff0c\u968f\u5373\u5316\u4f5c\u4e5d\u9053\u5149\u67f1\u5c04\u5411\u654c\u4eba\u3002\u5149\u67f1\u7a7f\u900f\u8eab\u4f53\uff0c\u76f4\u51fb\u7075\u9b42\u6df1\u5904\uff0c\u77ac\u95f4\u52fe\u8d77\u654c\u4eba\u6700\u6df1\u5c42\u7684\u6027\u6b32\u671b\u3002\u654c\u4eba\u7684\u8111\u6d77\u4e2d\u5145\u65a5\u7740\u6deb\u8361\u7684\u5e7b\u8c61\uff0c\u770b\u5230\u81ea\u5df1\u88ab\u4e5d\u5c3e\u7684\u5c3e\u5df4\u7f20\u7ed5\uff0c\u6bcf\u4e2a\u6bdb\u5b54\u90fd\u5728\u88ab\u7231\u629a\uff0c\u6027\u5668\u5b98\u88ab\u53cd\u590d\u73a9\u5f04\u81f3\u9ad8\u6f6e\u3002\u5f3a\u70c8\u7684\u5feb\u611f\u8ba9\u654c\u4eba\u5b8c\u5168\u5931\u53bb\u6218\u6597\u610f\u5fd7\uff0c\u53ea\u60f3\u8dea\u4e0b\u81e3\u670d\u4e8e\u4e5d\u5c3e\uff0c\u6ca6\u4e3a\u5b83\u7684\u7981\u8114...",\n        "cost": 0,\n        "genderLock": "Universal"\n      }\n    }\n\n8.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002`,s=`\u8bf7\u6839\u636e\u4ee5\u4e0b\u7075\u611f\u6765\u6e90\uff0c\u751f\u6210\u4e00\u5f20\u540c\u4eba\u517d\u5ba0\u5361${t?`\uff0c\u7a00\u6709\u5ea6\u5fc5\u987b\u662f\u3010${t}\u3011`:""}\u3002\u8bb0\u4f4f\uff1a\u5fc5\u987b\u4fdd\u7559\u539f\u4f5c\u6838\u5fc3\u7279\u5f81\uff0c\u5b8c\u6574\u8fdb\u884c\u4ed9\u4fa0\u5316\u6539\u7f16\uff0c\u5e76\u6781\u5ea6\u8272\u60c5\u5316\uff01\n\n\u7075\u611f\u6765\u6e90\uff1a\n"${e}"`,r=pn(await K(n,s));return r.id=`doujin-pet-${Date.now()}`,r}(n,a);break;default:return alert(`"${r}"\u7c7b\u578b\u7684\u540c\u4eba\u521b\u4f5c\u529f\u80fd\u51fa\u73b0\u9519\u8bef\u3002`),t({...e,spiritStones:s}),void m(!1)}d([l])}catch(a){console.error(a),h("\u5929\u673a\u7d0a\u4e71\uff0c\u53ec\u5524\u5931\u8d25\u3002\u7075\u77f3\u5df2\u9000\u56de\u3002"),t({...e,spiritStones:s}),setTimeout(()=>h(null),4e3)}finally{m(!1)}},s="regular"===l?{"\u4eba\u7269\u5361\u724c":{title:"\u4e07\u8c61\u5bfb\u4ed9",description:"\u5e38\u9a7b\u5361\u6c60\uff0c\u53ef\u62db\u52df\u6765\u81ea\u4e94\u6e56\u56db\u6d77\u7684\u4fee\u58eb\u3002",bannerUrl:"https://i.imgur.com/3sL0qXf.jpg",onPull:()=>v(100,1)},"\u88c5\u5907":{title:"\u767e\u70bc\u9601",description:"\u5e38\u9a7b\u88c5\u5907\u6c60\uff0c\u53ef\u83b7\u53d6\u5404\u7c7b\u6cd5\u5b9d\u4e0e\u9632\u5177\u3002",bannerUrl:"https://i.imgur.com/2jM1aYk.jpg",onPull:()=>v(100,1)},"\u901a\u7528\u6280\u80fd":{title:"\u4e07\u6cd5\u697c",description:"\u5e38\u9a7b\u6280\u80fd\u6c60\uff0c\u53ef\u4e60\u5f97\u5404\u79cd\u901a\u7528\u529f\u6cd5\u3002",bannerUrl:"https://i.imgur.com/dK8k9oN.jpg",onPull:()=>v(100,1)},"\u517d\u5ba0":{title:"\u5fa1\u517d\u658b",description:"\u5e38\u9a7b\u517d\u5ba0\u6c60\uff0c\u53ef\u5951\u7ea6\u5404\u79cd\u73cd\u5947\u7075\u517d\u3002",bannerUrl:"https://i.imgur.com/aJ4Gq9a.jpg",onPull:()=>v(100,1)}}[r]:{"\u4eba\u7269\u5361\u724c":{title:"\u5f02\u754c\u964d\u4e34",description:"\u6d88\u8017\u5927\u91cf\u7075\u77f3\uff0c\u5c06\u4f60\u7684\u201c\u7075\u611f\u201d\u5316\u4e3a\u73b0\u5b9e\uff0c\u53ec\u5524\u6765\u81ea\u5f02\u754c\u7684\u5f3a\u8005\u3002",bannerUrl:"https://i.imgur.com/s6A4b3g.jpg",onPull:n},"\u88c5\u5907":{title:"\u795e\u5175\u5929\u6210",description:"\u6d88\u8017\u5927\u91cf\u7075\u77f3\uff0c\u6839\u636e\u4f60\u7684\u201c\u7075\u611f\u201d\u953b\u9020\u51fa\u4f20\u8bf4\u4e2d\u7684\u795e\u5175\u5229\u5668\u3002",bannerUrl:"https://i.imgur.com/Tq9g8xS.jpg",onPull:n},"\u901a\u7528\u6280\u80fd":{title:"\u5927\u9053\u987f\u609f",description:"\u6d88\u8017\u5927\u91cf\u7075\u77f3\uff0c\u4ece\u4f60\u7684\u201c\u7075\u611f\u201d\u4e2d\u9886\u609f\u51fa\u60ca\u5929\u52a8\u5730\u7684\u65e0\u4e0a\u529f\u6cd5\u3002",bannerUrl:"https://i.imgur.com/o2N5d1m.jpg",onPull:n},"\u517d\u5ba0":{title:"\u7075\u517d\u521b\u751f",description:"\u6d88\u8017\u5927\u91cf\u7075\u77f3\uff0c\u5c06\u4f60\u7684\u201c\u7075\u611f\u201d\u5316\u4e3a\u73b0\u5b9e\uff0c\u521b\u9020\u4e00\u53ea\u72ec\u4e00\u65e0\u4e8c\u7684\u7075\u517d\u4f19\u4f34\u3002",bannerUrl:"https://i.imgur.com/Yp8zL5g.jpg",onPull:n}}[r],a="regular"===l?200:1e3,c="regular"===l?1800:9e3;return o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-center gap-3 mb-4",children:[o.jsx(js,{label:"\u5e38\u89c4\u5361\u6c60",isActive:"regular"===l,onClick:()=>i("regular")}),o.jsx(js,{label:"\u540c\u4eba\u5361\u6c60",isActive:"doujin"===l,onClick:()=>i("doujin")})]}),o.jsx(Ns,{title:s.title,description:s.description,bannerUrl:s.bannerUrl,onPullOne:()=>"regular"===l?v(a,1):n(),onPullTen:()=>"regular"===l?v(c,10):alert("\u540c\u4eba\u5361\u6c60\u6682\u4e0d\u652f\u6301\u5341\u8fde\u62bd\u3002"),isLoading:u,error:p,pullOneCost:a,pullTenCost:c,pullOneLabel:"doujin"===l?"\u6ce8\u5165\u7075\u611f":"\u62db\u52df\u4e00\u6b21",pullTenLabel:"doujin"===l?" ":"\u62db\u52df\u5341\u6b21",poolType:"permanent"})]})})()]}),"\u9053\u5177\u8d2d\u4e70"===n&&o.jsx("div",{className:"p-6 text-center font-serif flex flex-col items-center justify-center h-full",children:o.jsxs("div",{className:"ink-card p-8 rounded-lg xianxia-frame relative",children:[o.jsx("div",{className:"absolute top-4 left-4 w-5 h-5 border-l-2 border-t-2 border-gold-500/30"}),o.jsx("div",{className:"absolute top-4 right-4 w-5 h-5 border-r-2 border-t-2 border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-4 left-4 w-5 h-5 border-l-2 border-b-2 border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-4 right-4 w-5 h-5 border-r-2 border-b-2 border-gold-500/30"}),o.jsx("div",{className:"text-6xl mb-6",children:"\ud83d\udcb0"}),o.jsxs("p",{className:"text-gold-400 text-xl font-bold mb-2 font-brush tracking-wider",children:[o.jsx("span",{className:"text-gold-500/50 mr-2",children:"\u3013"}),"\u6b64\u529f\u80fd\u5c1a\u672a\u5f00\u653e",o.jsx("span",{className:"text-gold-500/50 ml-2",children:"\u3013"})]}),o.jsx("p",{className:"text-ink-400 mt-2 font-elegant",children:"\u672a\u6765\u7684\u5546\u5e97\u5c06\u5728\u6b64\u5904\u5c55\u793a\uff0c\u53ef\u8d2d\u4e70\u4e39\u836f\u3001\u6750\u6599\u7b49\u3002"})]})})]}),c&&o.jsx(ps,{results:c,onClose:()=>{if(!c)return;c.length;const n=JSON.parse(JSON.stringify(e));c.forEach(e=>{if(e.name,e.rarity,ys(e),hs(e),fs(e),gs(e),bs(e),JSON.stringify(e,null,2),ys(e)){const t=e.description.match(/\d+/);if(t){const e=parseInt(t[0],10);n.spiritStones+=e}}else if(hs(e)){const t={...e,id:`gen-char-${e.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};n.cardCollection.push(t),e.name}else if(fs(e)){const t={...e,id:`gen-equip-${e.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};n.equipmentInventory.push(t),e.name}else if(gs(e)){const t={...e,id:`gen-skill-${e.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};n.universalSkills.push(t),e.name}else if(bs(e)){const t={...e,id:`gen-pet-${e.name.replace(/\s/g,"")}-${Date.now()}-${Math.random()}`};n.petCollection.push(t),e.name}}),n.cardCollection.length,n.equipmentInventory.length,n.universalSkills.length,n.petCollection.length,t(n),d(null)}})]})},ks=({activeModal:e,onClose:t,playerProfile:n,setPlayerProfile:s,leaderboards:r,onMatchFound:a,onViewPet:l,gameState:i,onLeaderboardsUpdate:c})=>{return o.jsx("div",{className:"fixed inset-0 bg-ink-950/90 backdrop-blur-md z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ink-card relative w-full max-w-6xl h-[90vh] rounded-lg overflow-hidden flex flex-col animate-fade-in xianxia-frame immortal-mist",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/50 to-transparent"}),o.jsx("div",{className:"absolute top-3 left-3 text-gold-500/30 text-sm",children:"\u2601"}),o.jsx("div",{className:"absolute top-3 right-3 text-gold-500/30 text-sm",style:{transform:"scaleX(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute bottom-3 left-3 text-gold-500/30 text-sm",style:{transform:"scaleY(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute bottom-3 right-3 text-gold-500/30 text-sm",style:{transform:"scale(-1)"},children:"\u2601"}),o.jsx("div",{className:"absolute top-4 left-4 w-6 h-6 border-l-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute top-4 right-4 w-6 h-6 border-r-2 border-t-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-4 left-4 w-6 h-6 border-l-2 border-b-2 border-gold-500/25"}),o.jsx("div",{className:"absolute bottom-4 right-4 w-6 h-6 border-r-2 border-b-2 border-gold-500/25"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gold-500/5 text-[15rem] pointer-events-none select-none",children:"\u2727"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-ink-900/60 border-b border-gold-500/20 relative",children:[o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/30 to-transparent"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl filter drop-shadow-[0_0_6px_rgba(180,149,106,0.4)]",children:(d=e,{"\u961f\u4f0d":"\u2694\ufe0f","\u5546\u57ce":"\ud83c\udfea","\u80cc\u5305":"\ud83d\udce6","\u7ade\u6280\u573a":"\ud83c\udfc6","\u4efb\u52a1":"\ud83d\udcdc"}[d]||"\ud83d\udcdc")}),o.jsxs("h2",{className:"text-2xl font-bold text-gold-400 font-brush tracking-[0.15em] ink-title",children:[o.jsx("span",{className:"text-gold-500/40 mr-2",children:"\u3013"}),e,o.jsx("span",{className:"text-gold-500/40 ml-2",children:"\u3013"})]})]}),o.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-ink-800/80 hover:bg-ink-700/80 border border-gold-500/30 hover:border-cinnabar-400/50 text-ink-400 hover:text-cinnabar-400 transition-all duration-300 flex items-center justify-center group",title:"\u5173\u95ed",children:o.jsx("span",{className:"text-lg group-hover:scale-110 transition-transform duration-300",children:"\u2715"})})]}),o.jsxs("div",{className:"flex-grow overflow-y-auto bg-ink-900/30 relative",children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-4 bg-gradient-to-b from-ink-900/50 to-transparent pointer-events-none z-10"}),(()=>{switch(e){case"\u961f\u4f0d":return o.jsx(is,{playerProfile:n,setPlayerProfile:s,onViewPet:l});case"\u5546\u57ce":return o.jsx(ws,{playerProfile:n,setPlayerProfile:s});case"\u80cc\u5305":return o.jsx(ls,{playerProfile:n,setPlayerProfile:s,onViewPet:l});case"\u7ade\u6280\u573a":return o.jsx(Jn,{playerProfile:n,leaderboards:r,onMatchFound:a,gameState:i,onLeaderboardsUpdate:c});default:return o.jsxs("div",{className:"p-6 text-ink-300 font-serif flex flex-col items-center justify-center h-full",children:[o.jsx("div",{className:"text-4xl mb-4 opacity-60",children:"\ud83d\udcdc"}),o.jsxs("p",{children:["\u8fd9\u91cc\u662f ",o.jsx("span",{className:"font-semibold text-gold-400",children:e})," \u754c\u9762\u7684\u5360\u4f4d\u5185\u5bb9\u3002"]}),o.jsx("p",{className:"mt-4 text-center text-ink-400",children:"\u540e\u7eed\u5f00\u53d1\u5c06\u5728\u6b64\u5904\u586b\u5145\u76f8\u5173\u7684\u6e38\u620f\u4fe1\u606f\uff0c\u4f8b\u5982\u80cc\u5305\u5217\u8868\u3001\u6280\u80fd\u6811\u3001\u4eba\u7269\u5173\u7cfb\u6216\u5f53\u524d\u4efb\u52a1\u65e5\u5fd7\u7b49\u3002"})]})}})(),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-gradient-to-t from-ink-900/50 to-transparent pointer-events-none z-10"})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/50 to-transparent"})]})});var d},Cs=({value:e,maxValue:t,color:n,label:s})=>{const r=t>0?e/t*100:0;return o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-1",children:[o.jsx("span",{className:"text-xs font-medium text-gray-300",children:s}),o.jsx("span",{className:"text-xs font-mono text-gray-400",children:`${Math.round(e)}/${Math.round(t)}`})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 border border-stone-600/50 overflow-hidden",children:o.jsx("div",{className:`${n} h-full rounded-full transition-all duration-500 ease-in-out relative`,style:{width:`${r}%`},children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"})})})]})},Ss=({char:e})=>{const t=It(e);return o.jsxs("div",{className:"glass-morphism p-3 rounded-lg border border-stone-600/50 hover:border-xianxia-gold-500/50 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h3",{className:"font-bold text-white font-serif",children:e.name}),o.jsx("p",{className:"text-amber-400 text-sm",children:e.realm})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Cs,{value:t.hp,maxValue:t.maxHp,color:"bg-red-500",label:"\u6c14\u8840"}),o.jsx(Cs,{value:t.mp,maxValue:t.maxMp,color:"bg-blue-500",label:"\u771f\u5143"})]})]})},Es=({playerProfile:e})=>{const t=e.maleParty.length>0?e.maleParty:e.femaleParty;return o.jsx(Ps,{title:`${e.name}\u7684\u961f\u4f0d`,children:o.jsx("div",{className:"space-y-3",children:t.length>0?t.map(e=>o.jsx(Ss,{char:e},e.id)):o.jsx("p",{className:"text-center text-gray-400",children:"\u5f53\u524d\u6ca1\u6709\u89d2\u8272\u4e0a\u9635"})})})},Ps=({title:e,children:t})=>o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h3",{className:"font-semibold text-xianxia-gold-400 mb-3 text-lg",children:e}),t]}),$s=({playerProfile:e,isOpen:t,onClose:n,hasPendingChallenge:s,onBattleClick:r,onRelationshipsClick:a,onReputationClick:l})=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/70 z-30 transition-opacity duration-300 "+(t?"opacity-100":"opacity-0 pointer-events-none"),onClick:n}),o.jsxs("div",{className:"fixed top-0 left-0 h-full w-full max-w-md bg-gradient-to-br from-stone-800/95 via-stone-900/95 to-stone-950/95 backdrop-blur-lg border-r border-xianxia-gold-400/30 shadow-2xl shadow-xianxia-gold-500/10 z-40 transform transition-transform duration-300 ease-in-out "+(t?"translate-x-0":"-translate-x-full"),children:[o.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-xianxia-gold-400/20 bg-stone-900/50",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("h2",{className:"text-xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u4e2a\u4eba\u4fe1\u606f"}),o.jsxs("button",{onClick:r,className:"relative px-4 py-1.5 text-sm font-semibold rounded-md transition-all duration-300 border "+(s?"bg-red-800/80 border-red-500 text-white animate-pulse-fast shadow-glow-red":"bg-stone-700/50 border-stone-600 text-gray-400 cursor-default"),children:["\u6218\u51b5",s&&o.jsxs("span",{className:"absolute -top-1 -right-1 flex h-3 w-3",children:[o.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),o.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]})]}),o.jsx("button",{onClick:l,className:"relative px-4 py-1.5 text-sm font-semibold rounded-md transition-all duration-300 border bg-stone-700/50 border-stone-600 text-gray-300 hover:bg-stone-600/80",children:"\u58f0\u671b"})]}),o.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"p-4 overflow-y-auto scrollbar-xianxia h-[calc(100%-65px)] space-y-4 font-serif",children:[o.jsxs(Ps,{title:"\u5f53\u524d\u8eab\u4efd",children:[o.jsxs("p",{children:[o.jsx("span",{className:"text-gray-400 w-16 inline-block",children:"\u540d\u53f7\uff1a"})," ",o.jsx("span",{className:"text-white font-bold",children:e.name})]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-gray-400 w-16 inline-block",children:"\u79f0\u53f7\uff1a"})," ",o.jsx("span",{className:"text-white",children:e.title||"\u65e0"})]})]}),o.jsx(Ps,{title:"\u7ecf\u6d4e\u72b6\u51b5",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-gem text-yellow-400 text-xl"}),o.jsx("span",{className:"text-white font-bold text-lg",children:e.spiritStones}),o.jsx("span",{className:"text-gray-300",children:"\u7075\u77f3"})]})}),o.jsx(Ps,{title:"\u4eba\u9645\u5173\u7cfb",children:o.jsx("button",{onClick:a,className:"w-full text-left hover:bg-stone-800/50 p-2 -m-2 rounded-md transition-colors",children:e.relationships&&e.relationships.length>0?o.jsxs("div",{children:[o.jsxs("p",{className:"text-gray-300",children:["\u5df2\u7ed3\u8bc6 ",o.jsx("span",{className:"font-bold text-white",children:e.relationships.length})," \u4f4d\u9053\u53cb\u3002"]}),o.jsx("p",{className:"text-xs text-amber-400 mt-1",children:"\u70b9\u51fb\u67e5\u770b\u8be6\u60c5"})]}):o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-500 italic",children:"\u6c5f\u6e56\u8def\u8fdc\uff0c\u5c1a\u672a\u7ed3\u8bc6\u91cd\u8981\u4eba\u7269\u3002"}),o.jsx("p",{className:"text-xs text-amber-400 mt-1",children:"\u70b9\u51fb\u67e5\u770b\u8be6\u60c5"})]})})}),o.jsx(Es,{playerProfile:e})]})]})]}),_s=({pet:e,onClose:t})=>{const[n,s]=x.useState(!1);return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg h-auto max-h-[80vh] overflow-hidden shadow-2xl flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"p-4 flex-shrink-0 bg-black/20",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-white font-serif flex items-baseline gap-3",children:[o.jsx("span",{children:e.name}),o.jsxs("span",{className:`text-lg font-medium ${L(e.rarity)}`,children:["[",e.rarity,"]"]})]}),o.jsx("p",{className:"text-lg text-amber-400 font-serif",children:"Male"===e.gender?"\u96c4\u6027":"\u96cc\u6027"})]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsx("div",{className:"mt-2 space-y-1 text-sm text-gray-300",children:o.jsxs("p",{children:[o.jsx("span",{className:"text-gray-500 font-semibold",children:"\u63cf\u8ff0:"})," ",e.description]})})]}),o.jsx("div",{className:"p-4 overflow-y-auto flex-grow",children:o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"\u517d\u5ba0\u6280\u80fd"}),o.jsxs("div",{className:`relative w-full text-left bg-stone-700/50 p-3 rounded-md border-2 ${M(e.skill.rarity)} cursor-pointer hover:bg-stone-600/70 transition-colors`,onClick:()=>s(!0),children:[o.jsx("div",{className:"flex justify-between items-baseline",children:o.jsxs("h5",{className:"font-bold text-white flex items-baseline gap-2",children:[o.jsx("span",{className:`${L(e.skill.rarity)}`,children:e.skill.name}),o.jsxs("span",{className:`text-xs font-medium ${L(e.skill.rarity)}`,children:["[",e.skill.rarity,"]"]})]})}),o.jsx("p",{className:"text-sm font-semibold text-amber-300 mt-1",children:e.skill.mechanicsDescription}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:e.skill.description})]})]})})]})}),n&&o.jsx(Vt,{skill:e.skill,onClose:()=>s(!1)})]})},Ds=({value:e,rolling:t})=>{const[n,s]=x.useState(1);return x.useEffect(()=>{if(t){const e=setInterval(()=>{s(Math.floor(6*Math.random())+1)},50);return()=>clearInterval(e)}null!==e&&s(e)},[t,e]),o.jsx("div",{className:"w-20 h-20 bg-white border-2 border-gray-300 rounded-lg flex items-center justify-center text-4xl font-bold text-stone-800 shadow-lg",children:n})},Ls=({playerProfile:e,opponentName:t,onBattleStart:n,onClose:s})=>{const[r,a]=x.useState("roll"),[l,i]=x.useState(null),[c,d]=x.useState(!1),[u,m]=x.useState(null),[p,h]=x.useState(null),[f,g]=x.useState("\u901a\u8fc7\u62fc\u70b9\u51b3\u5b9a\u5148\u624b\uff01"),b=()=>{d(!0),setTimeout(()=>{let e,t;do{e=Math.floor(6*Math.random())+1,t=Math.floor(6*Math.random())+1}while(e===t);const n=e>t?"player":"opponent";i({playerRoll:e,opponentRoll:t,winner:n}),d(!1),a("select"),g("player"===n?"\u4f60\u8d62\u5f97\u4e86\u5148\u624b\uff01\u8bf7\u9009\u62e9\u4f60\u7684\u51fa\u6218\u961f\u4f0d\u3002":"\u5bf9\u624b\u8d62\u5f97\u4e86\u5148\u624b\uff0c\u6b63\u5728\u9009\u62e9\u961f\u4f0d...")},1500)},y=e=>{"player"!==l?.winner||u||m(e)};x.useEffect(()=>{if("select"===r&&l){if(u&&p){const e=setTimeout(()=>{a("result"),g("\u961f\u4f0d\u786e\u5b9a\uff0c\u51c6\u5907\u5f00\u6218\uff01")},1e3);return()=>clearTimeout(e)}if(!u||!p)if("player"===l.winner){if(u&&!p){const e="Male"===u?"Female":"Male";g(`\u4f60\u5df2\u9009\u62e9\uff0c\u5bf9\u624b\u5c06\u4f7f\u7528 ${"Male"===e?"\u7537\u6027":"\u5973\u6027"} \u961f\u4f0d\u3002`);const t=setTimeout(()=>h(e),500);return()=>clearTimeout(t)}}else{if(!p){const e=setTimeout(()=>{const e=Math.random()>.5?"Male":"Female";h(e),g(`\u5bf9\u624b\u9009\u62e9\u4e86 ${"Male"===e?"\u7537\u6027":"\u5973\u6027"} \u961f\u4f0d\u3002`)},1500);return()=>clearTimeout(e)}if(p&&!u){const e="Male"===p?"Female":"Male",t=setTimeout(()=>{m(e),g(`\u4f60\u5c06\u4f7f\u7528 ${"Male"===e?"\u7537\u6027":"\u5973\u6027"} \u961f\u4f0d\u3002`)},500);return()=>clearTimeout(t)}}}},[r,l,u,p]);return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg shadow-2xl flex flex-col",children:[o.jsx("div",{className:"p-4 text-center bg-black/20",children:o.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:"\u6218\u524d\u51c6\u5907"})}),o.jsxs("div",{className:"p-6 font-serif",children:[o.jsx("p",{className:"text-center text-amber-300 mb-6 h-6",children:f}),(()=>{if("roll"===r)return o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex justify-around items-center my-8",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white mb-2",children:e.name}),o.jsx(Ds,{value:null,rolling:c})]}),o.jsx("p",{className:"text-4xl font-serif text-amber-400",children:"VS"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white mb-2",children:t}),o.jsx(Ds,{value:null,rolling:c})]})]}),o.jsx("button",{onClick:b,disabled:c,className:"bg-amber-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-amber-500 transition-colors disabled:opacity-50",children:c?"\u6295\u63b7\u4e2d...":"\u62fc\u70b9"})]});if("select"===r||"result"===r){const s=e.maleParty.length>0,a=e.femaleParty.length>0;return o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex justify-around items-center my-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white mb-2",children:e.name}),o.jsx(Ds,{value:l?.playerRoll||1,rolling:!1})]}),o.jsx("p",{className:"text-2xl font-serif "+("player"===l?.winner?"text-green-400":"text-gray-400"),children:"player"===l?.winner?"\u80dc\u5229":"\u8d25\u5317"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white mb-2",children:t}),o.jsx(Ds,{value:l?.opponentRoll||1,rolling:!1})]})]}),o.jsxs("div",{className:"my-6 grid grid-cols-2 gap-4 text-center",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-sky-400",children:"\u4f60\u7684\u961f\u4f0d"}),o.jsx("p",{className:"mt-2 text-lg font-bold text-white h-8 animate-fade-in",children:u?"Male"===u?"\u7537\u6027\u7f16\u961f":"\u5973\u6027\u7f16\u961f":"..."})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold text-red-400",children:"\u5bf9\u624b\u961f\u4f0d"}),o.jsx("p",{className:"mt-2 text-lg font-bold text-white h-8 animate-fade-in",children:p?"Male"===p?"\u7537\u6027\u7f16\u961f":"\u5973\u6027\u7f16\u961f":"..."})]})]}),"player"===l?.winner&&!u&&o.jsxs("div",{className:"mt-4 flex justify-center gap-4 animate-fade-in",children:[o.jsx("button",{onClick:()=>y("Male"),disabled:!s,className:"bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"\u7537\u6027\u7f16\u961f"}),o.jsx("button",{onClick:()=>y("Female"),disabled:!a,className:"bg-pink-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-pink-500 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"\u5973\u6027\u7f16\u961f"})]}),"result"===r&&u&&p&&o.jsx("div",{className:"mt-8 animate-fade-in",children:o.jsx("button",{onClick:()=>n(u,p),className:"bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-500 transition-colors shadow-lg animate-pulse-fast",children:"\u8fdb\u5165\u6218\u6597"})})]})}})()]})]})})},Ms=[{id:"threat_violence",type:"\u5a01\u80c1",text:"\u4ee5\u66b4\u529b\u76f8\u5a01\u80c1",description:"\u5a01\u80c1\u5bf9\u56da\u72af\u65bd\u4ee5\u9177\u5211\uff0c\u8feb\u4f7f\u5176\u5c48\u670d",icon:"fa-fist-raised",baseEffects:{submissionChange:15,loyaltyChange:-10,healthChange:0,sanityChange:-5,informationChance:30},riskFactors:{escapeAttempt:5,rebellion:15,breakdown:10}},{id:"threat_family",type:"\u5a01\u80c1",text:"\u5a01\u80c1\u5176\u4eb2\u53cb",description:"\u6697\u793a\u4f1a\u5bf9\u5176\u5728\u610f\u7684\u4eba\u4e0d\u5229",icon:"fa-users",baseEffects:{submissionChange:25,loyaltyChange:-20,healthChange:0,sanityChange:-10,informationChance:50},riskFactors:{escapeAttempt:10,rebellion:25,breakdown:15}},{id:"threat_execution",type:"\u5a01\u80c1",text:"\u4ee5\u5904\u51b3\u76f8\u5a01\u80c1",description:"\u58f0\u79f0\u82e5\u4e0d\u914d\u5408\u5c06\u88ab\u5904\u6b7b",icon:"fa-skull",baseEffects:{submissionChange:35,loyaltyChange:-30,healthChange:0,sanityChange:-15,informationChance:60},riskFactors:{escapeAttempt:20,rebellion:30,breakdown:25}},{id:"persuade_reason",type:"\u529d\u8bf4",text:"\u6653\u4e4b\u4ee5\u7406",description:"\u7528\u9053\u7406\u8bf4\u670d\u56da\u72af\u914d\u5408",icon:"fa-comments",baseEffects:{submissionChange:5,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:5,breakdown:0}},{id:"persuade_emotion",type:"\u529d\u8bf4",text:"\u52a8\u4e4b\u4ee5\u60c5",description:"\u7528\u60c5\u611f\u6253\u52a8\u56da\u72af",icon:"fa-heart",baseEffects:{submissionChange:10,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:25},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"persuade_future",type:"\u529d\u8bf4",text:"\u8bb8\u8bfa\u672a\u6765",description:"\u627f\u8bfa\u82e5\u914d\u5408\u5c06\u6709\u597d\u7684\u7ed3\u679c",icon:"fa-sun",baseEffects:{submissionChange:15,loyaltyChange:20,healthChange:0,sanityChange:15,informationChance:35},requirements:{minSubmission:30},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_food",type:"\u4ea4\u6613",text:"\u4ee5\u7f8e\u98df\u4ea4\u6362",description:"\u63d0\u4f9b\u7f8e\u5473\u98df\u7269\u6362\u53d6\u914d\u5408",icon:"fa-utensils",requirements:{spiritStones:10},baseEffects:{submissionChange:5,loyaltyChange:15,healthChange:10,sanityChange:5,informationChance:30},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_comfort",type:"\u4ea4\u6613",text:"\u6539\u5584\u5f85\u9047",description:"\u627f\u8bfa\u6539\u5584\u5173\u62bc\u6761\u4ef6",icon:"fa-bed",requirements:{spiritStones:50},baseEffects:{submissionChange:10,loyaltyChange:25,healthChange:5,sanityChange:10,informationChance:40},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"trade_freedom",type:"\u4ea4\u6613",text:"\u4ee5\u81ea\u7531\u4ea4\u6362",description:"\u627f\u8bfa\u82e5\u63d0\u4f9b\u60c5\u62a5\u5c06\u91ca\u653e",icon:"fa-dove",requirements:{minSubmission:50},baseEffects:{submissionChange:20,loyaltyChange:30,healthChange:0,sanityChange:20,informationChance:70},riskFactors:{escapeAttempt:5,rebellion:0,breakdown:0}},{id:"extract_casual",type:"\u5957\u8bdd",text:"\u95f2\u804a\u5957\u8bdd",description:"\u5728\u95f2\u804a\u4e2d\u5957\u53d6\u4fe1\u606f",icon:"fa-comment-dots",baseEffects:{submissionChange:0,loyaltyChange:5,healthChange:0,sanityChange:0,informationChance:25},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"extract_trick",type:"\u5957\u8bdd",text:"\u8bbe\u8ba1\u5708\u5957",description:"\u7528\u8bdd\u672f\u8bf1\u5bfc\u56da\u72af\u900f\u9732\u4fe1\u606f",icon:"fa-chess",baseEffects:{submissionChange:5,loyaltyChange:-5,healthChange:0,sanityChange:-5,informationChance:45},riskFactors:{escapeAttempt:0,rebellion:10,breakdown:5}},{id:"extract_pretend",type:"\u5957\u8bdd",text:"\u5047\u88c5\u540c\u60c5",description:"\u5047\u88c5\u7406\u89e3\u548c\u540c\u60c5\u6765\u83b7\u53d6\u4fe1\u4efb",icon:"fa-mask",baseEffects:{submissionChange:5,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:35},riskFactors:{escapeAttempt:0,rebellion:5,breakdown:0}},{id:"chat_past",type:"\u95f2\u804a",text:"\u804a\u804a\u8fc7\u53bb",description:"\u8be2\u95ee\u56da\u72af\u7684\u8fc7\u5f80\u7ecf\u5386",icon:"fa-clock-rotate-left",baseEffects:{submissionChange:0,loyaltyChange:10,healthChange:0,sanityChange:5,informationChance:15},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:5}},{id:"chat_cultivation",type:"\u95f2\u804a",text:"\u8c08\u8bba\u4fee\u70bc",description:"\u4e0e\u56da\u72af\u4ea4\u6d41\u4fee\u70bc\u5fc3\u5f97",icon:"fa-yin-yang",baseEffects:{submissionChange:0,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"chat_world",type:"\u95f2\u804a",text:"\u804a\u804a\u5916\u754c",description:"\u544a\u8bc9\u56da\u72af\u5916\u9762\u4e16\u754c\u7684\u6d88\u606f",icon:"fa-globe",baseEffects:{submissionChange:0,loyaltyChange:5,healthChange:0,sanityChange:-5,informationChance:10},riskFactors:{escapeAttempt:5,rebellion:5,breakdown:10}},{id:"favor_heal",type:"\u6069\u60e0",text:"\u6cbb\u7597\u4f24\u52bf",description:"\u4e3a\u56da\u72af\u6cbb\u7597\u4f24\u75c5",icon:"fa-kit-medical",requirements:{spiritStones:30},baseEffects:{submissionChange:5,loyaltyChange:20,healthChange:30,sanityChange:10,informationChance:20},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"favor_gift",type:"\u6069\u60e0",text:"\u8d60\u9001\u793c\u7269",description:"\u9001\u7ed9\u56da\u72af\u4e00\u4e9b\u5c0f\u793c\u7269",icon:"fa-gift",requirements:{spiritStones:20},baseEffects:{submissionChange:0,loyaltyChange:15,healthChange:0,sanityChange:10,informationChance:15},riskFactors:{escapeAttempt:0,rebellion:0,breakdown:0}},{id:"favor_visit",type:"\u6069\u60e0",text:"\u5b89\u6392\u63a2\u89c6",description:"\u5141\u8bb8\u56da\u72af\u7684\u4eb2\u53cb\u6765\u63a2\u89c6",icon:"fa-people-arrows",requirements:{minSubmission:40,spiritStones:100},baseEffects:{submissionChange:10,loyaltyChange:35,healthChange:0,sanityChange:30,informationChance:25},riskFactors:{escapeAttempt:15,rebellion:0,breakdown:0}},{id:"humiliate_mock",type:"\u7f9e\u8fb1",text:"\u8a00\u8bed\u5632\u8bbd",description:"\u7528\u8a00\u8bed\u7f9e\u8fb1\u548c\u5632\u8bbd\u56da\u72af",icon:"fa-face-laugh",baseEffects:{submissionChange:10,loyaltyChange:-15,healthChange:0,sanityChange:-10,informationChance:10},riskFactors:{escapeAttempt:5,rebellion:20,breakdown:15}},{id:"humiliate_public",type:"\u7f9e\u8fb1",text:"\u5f53\u4f17\u7f9e\u8fb1",description:"\u5728\u5176\u4ed6\u56da\u72af\u9762\u524d\u7f9e\u8fb1",icon:"fa-bullhorn",baseEffects:{submissionChange:20,loyaltyChange:-25,healthChange:0,sanityChange:-20,informationChance:15},riskFactors:{escapeAttempt:10,rebellion:30,breakdown:25}},{id:"humiliate_strip",type:"\u7f9e\u8fb1",text:"\u5265\u593a\u5c0a\u4e25",description:"\u7528\u5404\u79cd\u65b9\u5f0f\u5265\u593a\u56da\u72af\u7684\u5c0a\u4e25",icon:"fa-person-falling-burst",baseEffects:{submissionChange:30,loyaltyChange:-35,healthChange:-5,sanityChange:-30,informationChance:20},riskFactors:{escapeAttempt:15,rebellion:40,breakdown:35}}],As=({isOpen:e,onClose:t,prisoner:n,playerSpiritStones:s,onDialogueComplete:r,onGenerateResponse:a,isLoading:l})=>{const[i,c]=x.useState(null),[d,u]=x.useState(null),[m,p]=x.useState([]),[h,f]=x.useState(""),[g,b]=x.useState(!1),[y,v]=x.useState(!1);return e?o.jsx("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-6xl h-[85vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-gradient-to-r from-stone-800 to-stone-900 border-b border-amber-500/30",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-stone-700 flex items-center justify-center border-2 border-amber-500/50",children:o.jsx("i",{className:"fa-solid fa-user text-3xl text-gray-400"})}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-comments"}),"\u4e0e ",n.character.name," \u5bf9\u8bdd"]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm mt-1",children:[o.jsxs("span",{className:"text-gray-400",children:["Male"===n.character.gender?"\u2642":"\u2640"," ",n.character.realm]}),o.jsxs("span",{className:n.submissionLevel>=80?"text-green-400":n.submissionLevel>=60?"text-yellow-400":n.submissionLevel>=40?"text-orange-400":"text-red-400",children:[o.jsx("i",{className:"fa-solid fa-brain mr-1"}),n.submissionLevel>=80?"\u5b8c\u5168\u5c48\u670d":n.submissionLevel>=60?"\u610f\u5fd7\u52a8\u6447":n.submissionLevel>=40?"\u52c9\u5f3a\u914d\u5408":n.submissionLevel>=20?"\u6297\u62d2\u4e0d\u4ece":"\u987d\u56fa\u62b5\u6297"]})]})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:()=>b(!g),className:"px-4 py-2 bg-cyan-600/80 text-white font-bold rounded-md hover:bg-cyan-500/80 transition-colors",children:[o.jsx("i",{className:"fa-solid fa-history mr-2"}),g?"\u8fd4\u56de\u5bf9\u8bdd":"\u5bf9\u8bdd\u8bb0\u5f55"]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors p-2",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),o.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[o.jsxs("div",{className:"w-72 bg-black/30 border-r border-stone-700 p-4 overflow-y-auto flex-shrink-0",children:[o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u8eab\u4f53\u72b6\u6001"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[o.jsx("span",{className:"text-gray-500",children:"\u5065\u5eb7"}),o.jsxs("span",{className:n.health>70?"text-green-400":n.health>40?"text-yellow-400":"text-red-400",children:[n.health,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 rounded-full transition-all "+(n.health>70?"bg-green-500":n.health>40?"bg-yellow-500":"bg-red-500"),style:{width:`${n.health}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[o.jsx("span",{className:"text-gray-500",children:"\u795e\u667a"}),o.jsxs("span",{className:n.sanity>70?"text-green-400":n.sanity>40?"text-yellow-400":"text-red-400",children:[n.sanity,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 rounded-full transition-all "+(n.sanity>70?"bg-green-500":n.sanity>40?"bg-yellow-500":"bg-red-500"),style:{width:`${n.sanity}%`}})})]})]})]}),o.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u610f\u5fd7\u72b6\u6001"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[o.jsx("span",{className:"text-gray-500",children:"\u5c48\u670d\u5ea6"}),o.jsxs("span",{className:"text-yellow-400",children:[n.submissionLevel,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all",style:{width:`${n.submissionLevel}%`}})})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[o.jsx("span",{className:"text-gray-500",children:"\u5f52\u987a\u5ea6"}),o.jsxs("span",{className:"text-green-400",children:[n.loyaltyLevel,"%"]})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2",children:o.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${n.loyaltyLevel}%`}})})]})]})]})]}),o.jsxs("div",{className:"bg-black/40 p-3 rounded-lg mb-4",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u56da\u72af\u4fe1\u606f"}),o.jsxs("div",{className:"space-y-2 text-xs",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-500",children:"\u7f6a\u884c"}),o.jsx("span",{className:"text-red-300 text-right max-w-[150px] truncate",title:n.crime,children:n.crime})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-500",children:"\u5269\u4f59\u5211\u671f"}),o.jsxs("span",{className:"text-orange-400",children:[n.remainingDays,"\u5929"]})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-500",children:"\u5173\u62bc\u4f4d\u7f6e"}),o.jsx("span",{className:"text-blue-400",children:n.location})]})]})]}),n.status.length>0&&o.jsxs("div",{className:"bg-black/40 p-3 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u5f53\u524d\u72b6\u6001"}),o.jsx("div",{className:"flex flex-wrap gap-1",children:n.status.map((e,t)=>o.jsx("span",{className:"px-2 py-1 text-xs bg-orange-500/20 text-orange-300 rounded",children:e},t))})]})]}),o.jsx("div",{className:"flex-grow flex flex-col overflow-hidden",children:g?o.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"\u5bf9\u8bdd\u5386\u53f2\u8bb0\u5f55"}),0===m.length?o.jsxs("div",{className:"text-center text-gray-500 py-10",children:[o.jsx("i",{className:"fa-solid fa-comments text-4xl mb-4 opacity-50"}),o.jsx("p",{children:"\u6682\u65e0\u5bf9\u8bdd\u8bb0\u5f55"})]}):o.jsx("div",{className:"space-y-4",children:m.map(e=>o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"px-2 py-1 text-xs bg-amber-500/20 text-amber-300 rounded",children:e.dialogueType}),o.jsx("span",{className:"text-white font-bold",children:e.playerChoice})]}),o.jsx("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),o.jsx("div",{className:"bg-black/20 p-3 rounded mb-3",children:o.jsxs("p",{className:"text-gray-300 text-sm italic",children:['"',e.prisonerResponse,'"']})}),o.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5c48\u670d\u5ea6:"}),o.jsxs("span",{className:"ml-1 font-bold "+(e.effects.submissionChange>=0?"text-yellow-400":"text-red-400"),children:[e.effects.submissionChange>=0?"+":"",e.effects.submissionChange]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5f52\u987a\u5ea6:"}),o.jsxs("span",{className:"ml-1 font-bold "+(e.effects.loyaltyChange>=0?"text-green-400":"text-red-400"),children:[e.effects.loyaltyChange>=0?"+":"",e.effects.loyaltyChange]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5065\u5eb7:"}),o.jsxs("span",{className:"ml-1 font-bold "+(e.effects.healthChange>=0?"text-green-400":"text-red-400"),children:[e.effects.healthChange>=0?"+":"",e.effects.healthChange]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u795e\u667a:"}),o.jsxs("span",{className:"ml-1 font-bold "+(e.effects.sanityChange>=0?"text-green-400":"text-red-400"),children:[e.effects.sanityChange>=0?"+":"",e.effects.sanityChange]})]})]})]},e.id))})]}):o.jsxs(o.Fragment,{children:[h&&o.jsx("div",{className:"bg-gradient-to-r from-stone-800/50 to-stone-900/50 p-4 border-b border-stone-700 flex-shrink-0",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-stone-700 flex items-center justify-center flex-shrink-0",children:o.jsx("i",{className:"fa-solid fa-user text-gray-400"})}),o.jsxs("div",{children:[o.jsx("div",{className:"text-amber-300 font-bold mb-1",children:n.character.name}),o.jsxs("p",{className:"text-gray-300 italic",children:['"',h,'"']})]})]})}),!i&&o.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"\u9009\u62e9\u5bf9\u8bdd\u65b9\u5f0f"}),o.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[{type:"\u5a01\u80c1",icon:"fa-skull-crossbones",color:"red",description:"\u4ee5\u66b4\u529b\u6216\u5a01\u80c1\u8feb\u4f7f\u56da\u72af\u5c48\u670d"},{type:"\u529d\u8bf4",icon:"fa-hand-holding-heart",color:"blue",description:"\u7528\u9053\u7406\u548c\u60c5\u611f\u8bf4\u670d\u56da\u72af"},{type:"\u4ea4\u6613",icon:"fa-handshake",color:"amber",description:"\u7528\u5229\u76ca\u4ea4\u6362\u56da\u72af\u7684\u914d\u5408"},{type:"\u5957\u8bdd",icon:"fa-user-secret",color:"purple",description:"\u5de7\u5999\u5730\u5957\u53d6\u60c5\u62a5"},{type:"\u95f2\u804a",icon:"fa-comments",color:"green",description:"\u8f7b\u677e\u7684\u65e5\u5e38\u4ea4\u6d41"},{type:"\u6069\u60e0",icon:"fa-gift",color:"cyan",description:"\u7ed9\u4e88\u597d\u5904\u4ee5\u83b7\u53d6\u597d\u611f"},{type:"\u7f9e\u8fb1",icon:"fa-face-angry",color:"orange",description:"\u6253\u51fb\u56da\u72af\u7684\u5c0a\u4e25\u548c\u610f\u5fd7"}].map(({type:e,icon:t,color:r,description:a})=>{const l=(e=>Ms.filter(t=>{if(t.type!==e)return!1;if(t.requirements){if(t.requirements.spiritStones&&s<t.requirements.spiritStones)return!1;if(t.requirements.minSubmission&&n.submissionLevel<t.requirements.minSubmission)return!1;if(t.requirements.maxSubmission&&n.submissionLevel>t.requirements.maxSubmission)return!1}return!0}))(e).length;return o.jsxs("button",{onClick:()=>c(e),disabled:0===l,className:`p-4 rounded-lg border-2 transition-all text-left ${l>0?{red:"border-red-500/30 bg-red-900/20 hover:border-red-500/60 text-red-400",blue:"border-blue-500/30 bg-blue-900/20 hover:border-blue-500/60 text-blue-400",amber:"border-amber-500/30 bg-amber-900/20 hover:border-amber-500/60 text-amber-400",purple:"border-purple-500/30 bg-purple-900/20 hover:border-purple-500/60 text-purple-400",green:"border-green-500/30 bg-green-900/20 hover:border-green-500/60 text-green-400",cyan:"border-cyan-500/30 bg-cyan-900/20 hover:border-cyan-500/60 text-cyan-400",orange:"border-orange-500/30 bg-orange-900/20 hover:border-orange-500/60 text-orange-400"}[r]:"border-stone-700 bg-stone-800/50 opacity-50 cursor-not-allowed"}`,children:[o.jsx("div",{className:"text-2xl mb-2",children:o.jsx("i",{className:`fa-solid ${t}`})}),o.jsx("div",{className:"font-bold mb-1",children:e}),o.jsx("div",{className:"text-xs text-gray-400 mb-2",children:a}),o.jsxs("div",{className:"text-xs text-gray-500",children:[l," \u4e2a\u53ef\u7528\u9009\u9879"]})]},e)})})]}),i&&!d&&o.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx("button",{onClick:()=>c(null),className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-arrow-left"})}),o.jsxs("h3",{className:"text-lg font-bold text-white",children:[i," - \u9009\u62e9\u5177\u4f53\u65b9\u5f0f"]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Ms.filter(e=>e.type===i).map(e=>{const t=(e=>!(e.requirements&&(e.requirements.spiritStones&&s<e.requirements.spiritStones||e.requirements.minSubmission&&n.submissionLevel<e.requirements.minSubmission||e.requirements.maxSubmission&&n.submissionLevel>e.requirements.maxSubmission)))(e);return o.jsx("button",{onClick:()=>t&&u(e),disabled:!t,className:"p-4 rounded-lg border-2 transition-all text-left "+(t?"border-stone-600 bg-black/30 hover:border-amber-500/50":"border-stone-800 bg-black/10 opacity-50 cursor-not-allowed"),children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"text-2xl text-amber-400",children:o.jsx("i",{className:`fa-solid ${e.icon}`})}),o.jsxs("div",{className:"flex-grow",children:[o.jsx("div",{className:"font-bold text-white mb-1",children:e.text}),o.jsx("div",{className:"text-xs text-gray-400 mb-2",children:e.description}),o.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs mb-2",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5c48\u670d:"}),o.jsxs("span",{className:"ml-1 "+(e.baseEffects.submissionChange>=0?"text-yellow-400":"text-red-400"),children:[e.baseEffects.submissionChange>=0?"+":"",e.baseEffects.submissionChange]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u5f52\u987a:"}),o.jsxs("span",{className:"ml-1 "+(e.baseEffects.loyaltyChange>=0?"text-green-400":"text-red-400"),children:[e.baseEffects.loyaltyChange>=0?"+":"",e.baseEffects.loyaltyChange]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u60c5\u62a5:"}),o.jsxs("span",{className:"ml-1 text-cyan-400",children:[e.baseEffects.informationChance,"%"]})]}),e.riskFactors&&e.riskFactors.rebellion>10&&o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-500",children:"\u98ce\u9669:"}),o.jsx("span",{className:"ml-1 text-red-400",children:e.riskFactors.rebellion>30?"\u9ad8":"\u4e2d"})]})]}),e.requirements?.spiritStones&&o.jsxs("span",{className:"px-2 py-0.5 text-xs rounded "+(s>=e.requirements.spiritStones?"bg-amber-500/20 text-amber-300":"bg-red-500/20 text-red-300"),children:[e.requirements.spiritStones," \u7075\u77f3"]})]})]})},e.id)})})]}),d&&o.jsx("div",{className:"flex-shrink-0 p-4 bg-black/40 border-t border-amber-500/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"text-white font-bold mb-1",children:["\u5df2\u9009\u62e9: ",o.jsx("span",{className:"text-amber-400",children:d.text})]}),o.jsx("div",{className:"text-xs text-gray-400",children:d.description})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 bg-gray-600/80 text-white rounded-md hover:bg-gray-500/80 transition-colors",children:"\u53d6\u6d88"}),o.jsx("button",{onClick:async()=>{if(d){v(!0);try{const e=await a(n,d);f(e);const t=.7+.6*Math.random(),s={submissionChange:Math.round(d.baseEffects.submissionChange*t),loyaltyChange:Math.round(d.baseEffects.loyaltyChange*t),healthChange:Math.round(d.baseEffects.healthChange*t),sanityChange:Math.round(d.baseEffects.sanityChange*t)},l=100*Math.random()<d.baseEffects.informationChance;let i;d.riskFactors&&(100*Math.random()<d.riskFactors.rebellion?i="\u56da\u72af\u8868\u73b0\u51fa\u5f3a\u70c8\u7684\u53cd\u6297\u60c5\u7eea":100*Math.random()<d.riskFactors.breakdown?i="\u56da\u72af\u7684\u7cbe\u795e\u72b6\u6001\u51fa\u73b0\u5f02\u5e38":100*Math.random()<d.riskFactors.escapeAttempt&&(i="\u56da\u72af\u4f3c\u4e4e\u5728\u6697\u4e2d\u8c0b\u5212\u4ec0\u4e48"));const o={id:`dialogue-${Date.now()}`,prisonerId:n.character.id,prisonerName:n.character.name,timestamp:(new Date).toLocaleString("zh-CN"),realTimestamp:Date.now(),dialogueType:d.type,playerChoice:d.text,prisonerResponse:e,attitude:n.submissionLevel>=60?"\u987a\u4ece":n.submissionLevel>=30?"\u4e2d\u7acb":"\u654c\u5bf9",effects:{submissionChange:s.submissionChange,loyaltyChange:s.loyaltyChange,healthChange:s.healthChange,sanityChange:s.sanityChange,informationGained:l?"\u83b7\u5f97\u4e86\u4e00\u4e9b\u6709\u4ef7\u503c\u7684\u60c5\u62a5":void 0,specialEvent:i}};p(e=>[...e,o]);const c={success:!0,dialogueRecord:o,prisonerReaction:e,narrativeText:e,stateChanges:{submission:s.submissionChange,loyalty:s.loyaltyChange,health:s.healthChange,sanity:s.sanityChange},rewards:l?{information:"\u83b7\u5f97\u4e86\u4e00\u4e9b\u6709\u4ef7\u503c\u7684\u60c5\u62a5"}:void 0,consequences:i?{eventTriggered:i}:void 0};r(c)}catch(e){console.error("\u5bf9\u8bdd\u6267\u884c\u5931\u8d25:",e),f("\uff08\u5bf9\u8bdd\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u610f\u5916...\uff09")}finally{v(!1),u(null)}}},disabled:y||l,className:"px-6 py-2 bg-amber-600/80 text-white font-bold rounded-md hover:bg-amber-500/80 disabled:opacity-50 transition-colors",children:y?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"\u5bf9\u8bdd\u4e2d..."]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fa-solid fa-comment mr-2"}),"\u5f00\u59cb\u5bf9\u8bdd"]})})]})]})})]})})]})]})}):null},Ts=({isOpen:e,onClose:t,prisonSystem:n,onInterrogatePrisoner:s,onViewPrisonerDetail:r,onTransferPrisoner:a,onReleasePrisoner:l,onRecruitPrisoner:i,onAssignLabor:c,onClaimLaborResult:d,onGenerateEvent:u,onDialogueComplete:m,onGenerateDialogueResponse:p,isLoading:h,playerProfile:f,setPlayerProfile:g,onViewPet:b})=>{const[y,v]=x.useState("\u7ba1\u7406\u533a"),[j,N]=x.useState(null),[w,k]=x.useState(!1),[C,S]=x.useState(!1),[E,P]=x.useState(null),[$,_]=x.useState(null),[D,L]=x.useState(36e5),[M,A]=x.useState(Date.now());if(x.useEffect(()=>{const e=setInterval(()=>{A(Date.now())},1e3);return()=>clearInterval(e)},[]),!e)return null;if(!n||!n.stats)return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"bg-stone-900 p-8 rounded-xl text-center",children:[o.jsx("i",{className:"fa-solid fa-exclamation-triangle text-yellow-400 text-4xl mb-4"}),o.jsx("h3",{className:"text-xl text-white mb-2",children:"\u5927\u7262\u7cfb\u7edf\u6570\u636e\u7f3a\u5931"}),o.jsx("p",{className:"text-gray-400 mb-4",children:"\u8bf7\u91cd\u65b0\u5f00\u59cb\u6e38\u620f\u6216\u52a0\u8f7d\u65b0\u5b58\u6863"}),o.jsx("button",{onClick:t,className:"px-6 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-500",children:"\u5173\u95ed"})]})});const T=["\u5c45\u4f4f\u533a","\u5ba1\u8baf\u533a","\u5a31\u4e50\u533a","\u52b3\u5f79\u533a","\u7ba1\u7406\u533a","\u533b\u7597\u533a"],I=e=>n.prisoners.filter(t=>t.location===e),O=e=>({"\u5c45\u4f4f\u533a":"fa-bed","\u5ba1\u8baf\u533a":"fa-gavel","\u5a31\u4e50\u533a":"fa-gamepad","\u52b3\u5f79\u533a":"fa-hammer","\u7ba1\u7406\u533a":"fa-chart-line","\u533b\u7597\u533a":"fa-hospital"}[e]);return o.jsxs("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:[o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-7xl h-[90vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-dungeon"}),"\u9547\u72f1\u5927\u7262"]}),o.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["\u56da\u72af: ",n.stats.totalPrisoners,"/",n.config.maxPrisoners," | \u5b89\u5168\u7b49\u7ea7: ",n.config.securityLevel,"/10"]})]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-grow flex overflow-hidden",children:[o.jsx("div",{className:"w-48 bg-black/20 border-r border-stone-700 flex-shrink-0",children:o.jsxs("div",{className:"p-4",children:[o.jsx("h3",{className:"text-sm font-bold text-gray-400 mb-3 uppercase",children:"\u533a\u57df"}),o.jsx("div",{className:"space-y-1",children:T.map(e=>{const t=(e=>({"\u5c45\u4f4f\u533a":"blue","\u5ba1\u8baf\u533a":"red","\u5a31\u4e50\u533a":"green","\u52b3\u5f79\u533a":"orange","\u7ba1\u7406\u533a":"purple","\u533b\u7597\u533a":"cyan"}[e]))(e),n=y===e,s=I(e).length;return o.jsxs("button",{onClick:()=>v(e),className:"w-full text-left px-3 py-2 rounded-md transition-colors flex items-center justify-between "+(n?`bg-${t}-500/20 text-${t}-300 border border-${t}-500/50`:"text-gray-400 hover:bg-stone-700/50"),children:[o.jsxs("span",{className:"flex items-center gap-2",children:[o.jsx("i",{className:`fa-solid ${O(e)}`}),e]}),"\u7ba1\u7406\u533a"!==e&&o.jsx("span",{className:"text-xs bg-black/30 px-2 py-1 rounded",children:s})]},e)})})]})}),o.jsxs("div",{className:"flex-grow overflow-y-auto p-6",children:[o.jsxs("div",{className:"mb-4",children:[o.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[o.jsx("i",{className:`fa-solid ${O(y)}`}),y]}),o.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["\u5c45\u4f4f\u533a"===y&&"\u56da\u72af\u7684\u65e5\u5e38\u5c45\u4f4f\u533a\u57df\uff0c\u6309\u5371\u9669\u7a0b\u5ea6\u5206\u914d\u4e0d\u540c\u7262\u623f","\u5ba1\u8baf\u533a"===y&&"\u5bf9\u56da\u72af\u8fdb\u884c\u5ba1\u8baf\u548c\u5211\u7f5a\u6267\u884c\u7684\u5730\u65b9","\u5a31\u4e50\u533a"===y&&"\u56da\u72af\u7684\u4f11\u95f2\u548c\u601d\u60f3\u6539\u9020\u533a\u57df","\u52b3\u5f79\u533a"===y&&"\u56da\u72af\u8fdb\u884c\u5f3a\u5236\u52b3\u52a8\u7684\u533a\u57df","\u7ba1\u7406\u533a"===y&&"\u76d1\u72f1\u7ba1\u7406\u548c\u8fd0\u8425\u4e2d\u5fc3\uff0c\u67e5\u770b\u6574\u4f53\u7edf\u8ba1","\u533b\u7597\u533a"===y&&"\u6cbb\u7597\u53d7\u4f24\u548c\u751f\u75c5\u7684\u56da\u72af"]})]}),"\u7ba1\u7406\u533a"===y?(()=>{const e=n.stats,t=n.events.slice(-5).reverse();return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"\u56da\u72af\u603b\u6570"}),o.jsxs("div",{className:"text-2xl font-bold text-white",children:[e.totalPrisoners," / ",n.config.maxPrisoners]})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"\u5e73\u5747\u5c48\u670d\u5ea6"}),o.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:[e.avgSubmission.toFixed(0),"%"]})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"\u5e73\u5747\u5f52\u987a\u5ea6"}),o.jsxs("div",{className:"text-2xl font-bold text-green-400",children:[e.avgLoyalty.toFixed(0),"%"]})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"\u72f1\u5352\u6570\u91cf"}),o.jsx("div",{className:"text-2xl font-bold text-blue-400",children:e.totalGuards})]})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsx("h3",{className:"text-lg font-bold text-amber-300 mb-3",children:"\u8d22\u52a1\u7edf\u8ba1"}),o.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-gray-400 text-sm",children:"\u603b\u6536\u5165"}),o.jsxs("div",{className:"text-xl font-bold text-green-400",children:[e.totalRevenue," ",o.jsx("span",{className:"text-sm",children:"\u7075\u77f3"})]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-gray-400 text-sm",children:"\u603b\u652f\u51fa"}),o.jsxs("div",{className:"text-xl font-bold text-red-400",children:[e.totalExpenses," ",o.jsx("span",{className:"text-sm",children:"\u7075\u77f3"})]})]}),o.jsxs("div",{children:[o.jsx("div",{className:"text-gray-400 text-sm",children:"\u51c0\u5229\u6da6"}),o.jsxs("div",{className:"text-xl font-bold "+(e.netProfit>=0?"text-green-400":"text-red-400"),children:[e.netProfit," ",o.jsx("span",{className:"text-sm",children:"\u7075\u77f3"})]})]})]})]}),o.jsxs("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("h3",{className:"text-lg font-bold text-amber-300",children:"\u6700\u8fd1\u4e8b\u4ef6"}),o.jsx("button",{onClick:u,disabled:h,className:"px-3 py-1 text-sm bg-purple-600/80 text-white rounded-md hover:bg-purple-500/80 disabled:opacity-50 transition-colors",children:h?"\u751f\u6210\u4e2d...":"\u89e6\u53d1\u968f\u673a\u4e8b\u4ef6"})]}),o.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.length>0?t.map(e=>{const t="critical"===e.severity?"text-red-400":"high"===e.severity?"text-orange-400":"medium"===e.severity?"text-yellow-400":"text-gray-400";return o.jsxs("div",{className:"bg-black/20 p-3 rounded border border-stone-700/50",children:[o.jsxs("div",{className:"flex justify-between items-start mb-1",children:[o.jsx("span",{className:`font-bold ${t}`,children:e.title}),o.jsx("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),o.jsx("p",{className:"text-sm text-gray-300",children:e.description}),!e.resolved&&o.jsx("span",{className:"inline-block mt-2 px-2 py-1 text-xs bg-red-500/20 text-red-400 rounded",children:"\u672a\u5904\u7406"})]},e.id)}):o.jsx("div",{className:"text-center text-gray-500 py-4",children:"\u6682\u65e0\u4e8b\u4ef6\u8bb0\u5f55"})})]})]})})():"\u52b3\u5f79\u533a"===y?(()=>{const e=n.prisoners.filter(e=>!e.status.includes("\u52b3\u5f79\u4e2d")&&e.health>30),t=e=>{const t=Math.floor(e/1e3),n=Math.floor(t/60),s=Math.floor(n/60);return s>0?`${s}\u5c0f\u65f6${n%60}\u5206\u949f`:n>0?`${n}\u5206\u949f${t%60}\u79d2`:`${t}\u79d2`};return o.jsxs("div",{className:"space-y-4",children:[n.materialInventory&&n.materialInventory.length>0&&o.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-purple-900/20 p-4 rounded-lg border border-amber-500/30",children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-300 mb-3 flex items-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-box-open"}),"\u6750\u6599\u5e93\u5b58"]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:n.materialInventory.map((e,t)=>{return o.jsxs("div",{className:"bg-black/40 p-3 rounded border border-stone-700/50",children:[o.jsx("div",{className:`font-bold ${n=e.material.rarity,{"\u51e1\u54c1":"text-gray-400","\u826f\u54c1":"text-green-400","\u4f18\u54c1":"text-blue-400","\u73cd\u54c1":"text-purple-400","\u7edd\u54c1":"text-orange-400","\u4ed9\u54c1":"text-red-400","\u5723\u54c1":"text-pink-400","\u795e\u54c1":"text-yellow-400"}[n]||"text-gray-400"}`,children:e.material.name}),o.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"ore"===e.material.type?"\u77ff\u77f3":"\u8349\u836f"}),o.jsxs("div",{className:"text-sm text-white",children:["\u6570\u91cf: ",o.jsx("span",{className:"font-bold text-green-400",children:e.quantity})]}),o.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["\u4ef7\u503c: ",e.material.value," \u7075\u77f3/\u4e2a"]})]},`${e.material.id}-${t}`);var n})})]}),o.jsx("div",{className:"space-y-4",children:n.laborSites.map(n=>(n=>{const s=n.maxWorkers-n.workers.length,r="\u77ff\u5c71"===n.type?"orange":"green";return o.jsxs("div",{className:`bg-black/30 p-4 rounded-lg border-2 border-${r}-500/30 hover:border-${r}-500/60 transition-colors`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-4",children:[o.jsxs("div",{children:[o.jsxs("h3",{className:`text-xl font-bold text-${r}-300 flex items-center gap-2`,children:[o.jsx("i",{className:"fa-solid "+("\u77ff\u5c71"===n.type?"fa-mountain":"fa-leaf")}),n.name]}),o.jsx("p",{className:"text-sm text-gray-400 mt-1",children:n.description})]}),o.jsxs("div",{className:"px-3 py-1 rounded-full "+(s>0?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:[s,"/",n.maxWorkers," \u53ef\u7528"]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[0,1].map(e=>{const s=n.workers[e];if(s){const r=Math.max(0,s.endTime-M),a=0===r,l=(s.duration-r)/s.duration*100;return o.jsxs("div",{className:"bg-black/40 p-3 rounded-lg border "+(a?"border-green-500/50":"border-yellow-500/50"),children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-white font-bold",children:s.prisonerName}),o.jsxs("div",{className:"text-xs text-gray-400",children:["\u5de5\u4f4d #",e+1]})]}),a?o.jsxs("span",{className:"px-2 py-1 text-xs bg-green-500/20 text-green-300 rounded animate-pulse",children:[o.jsx("i",{className:"fa-solid fa-check mr-1"}),"\u5b8c\u6210"]}):o.jsxs("span",{className:"px-2 py-1 text-xs bg-yellow-500/20 text-yellow-300 rounded",children:[o.jsx("i",{className:"fa-solid fa-clock mr-1"}),"\u52b3\u5f79\u4e2d"]})]}),o.jsxs("div",{className:"mb-2",children:[o.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mb-1",children:[o.jsx("span",{children:"\u8fdb\u5ea6"}),o.jsx("span",{children:a?"\u5df2\u5b8c\u6210":t(r)})]}),o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2 overflow-hidden",children:o.jsx("div",{className:"h-full transition-all duration-1000 "+(a?"bg-green-500":"bg-yellow-500"),style:{width:`${l}%`}})})]}),a&&d&&o.jsxs("button",{onClick:()=>d(n.id,s.prisonerId),className:"w-full px-3 py-1.5 text-sm bg-green-600/80 text-white rounded hover:bg-green-500/80 transition-colors",children:[o.jsx("i",{className:"fa-solid fa-gift mr-2"}),"\u9886\u53d6\u5956\u52b1"]})]},e)}return o.jsx("div",{className:"bg-black/20 p-3 rounded-lg border border-dashed border-stone-600",children:o.jsxs("div",{className:"text-center text-gray-500 py-4",children:[o.jsx("i",{className:"fa-solid fa-user-plus text-2xl mb-2 opacity-50"}),o.jsxs("div",{className:"text-sm",children:["\u5de5\u4f4d #",e+1]}),o.jsx("div",{className:"text-xs",children:"\u7a7a\u95f2\u4e2d"})]})},e)})}),s>0&&e.length>0&&o.jsxs("div",{className:"border-t border-stone-700 pt-3",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"\u5206\u914d\u56da\u72af\u5230\u6b64\u52b3\u5f79\u70b9\uff1a"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("select",{value:$===n.id?$:"",onChange:e=>_(e.target.value||null),className:"flex-grow px-3 py-2 bg-stone-700 text-white rounded border border-stone-600 text-sm",children:[o.jsx("option",{value:"",children:"\u9009\u62e9\u56da\u72af..."}),e.map(e=>o.jsxs("option",{value:e.character.id,children:[e.character.name," (\u5065\u5eb7:",e.health,"%)"]},e.character.id))]}),o.jsxs("select",{value:D,onChange:e=>L(Number(e.target.value)),className:"px-3 py-2 bg-stone-700 text-white rounded border border-stone-600 text-sm",children:[o.jsx("option",{value:18e5,children:"30\u5206\u949f"}),o.jsx("option",{value:36e5,children:"1\u5c0f\u65f6"}),o.jsx("option",{value:72e5,children:"2\u5c0f\u65f6"}),o.jsx("option",{value:144e5,children:"4\u5c0f\u65f6"}),o.jsx("option",{value:288e5,children:"8\u5c0f\u65f6"})]}),o.jsxs("button",{onClick:()=>{if($){const t=e.find(e=>e.character.id===$);t&&(c(t.character.id,n.id,D),_(null))}},disabled:!$,className:"px-4 py-2 bg-blue-600/80 text-white rounded hover:bg-blue-500/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:[o.jsx("i",{className:"fa-solid fa-play mr-1"}),"\u5f00\u59cb\u52b3\u5f79"]})]})]}),s>0&&0===e.length&&o.jsxs("div",{className:"border-t border-stone-700 pt-3 text-center text-gray-500 text-sm",children:[o.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"\u6682\u65e0\u53ef\u5206\u914d\u7684\u56da\u72af\uff08\u9700\u8981\u5065\u5eb7\u503c\u5927\u4e8e30%\u4e14\u672a\u5728\u52b3\u5f79\u4e2d\uff09"]})]},n.id)})(n))}),o.jsxs("div",{className:"bg-blue-900/20 p-4 rounded-lg border border-blue-500/30",children:[o.jsxs("h4",{className:"text-sm font-bold text-blue-300 mb-2",children:[o.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"\u52b3\u5f79\u7cfb\u7edf\u8bf4\u660e"]}),o.jsxs("ul",{className:"text-xs text-gray-400 space-y-1",children:[o.jsx("li",{children:"\u2022 \u6bcf\u4e2a\u52b3\u5f79\u70b9\u6700\u591a\u53ef\u540c\u65f6\u5b89\u63922\u540d\u56da\u72af\u5de5\u4f5c"}),o.jsx("li",{children:"\u2022 \u56da\u72af\u5065\u5eb7\u503c\u5fc5\u987b\u5927\u4e8e30%\u624d\u80fd\u53c2\u4e0e\u52b3\u5f79"}),o.jsx("li",{children:"\u2022 \u52b3\u5f79\u4f7f\u7528\u771f\u5b9e\u65f6\u95f4\u8ba1\u65f6\uff0c\u53ef\u9009\u62e930\u5206\u949f\u52308\u5c0f\u65f6\u4e0d\u7b49"}),o.jsx("li",{children:"\u2022 \u5b8c\u6210\u540e\u53ef\u83b7\u5f972\u79cd\u968f\u673a\u6750\u6599\uff08\u77ff\u77f3\u6216\u8349\u836f\uff09\uff0c\u6bcf\u79cd25-50\u4e2a"}),o.jsx("li",{children:"\u2022 \u6750\u6599\u7684\u540d\u79f0\u3001\u7a00\u6709\u5ea6\u548c\u63cf\u8ff0\u7531AI\u751f\u6210"}),o.jsx("li",{children:"\u2022 \u52b3\u5f79\u4f1a\u6d88\u8017\u56da\u72af10-30\u70b9\u5065\u5eb7\u503c\uff0c\u4f46\u4f1a\u83b7\u5f9750-150\u7ecf\u9a8c"})]})]})]})})():(e=>{const t=I(e);return 0===t.length?o.jsxs("div",{className:"text-center text-gray-500 py-10",children:[o.jsx("i",{className:`fa-solid ${O(e)} text-4xl mb-4 opacity-50`}),o.jsx("p",{children:"\u6b64\u533a\u57df\u6682\u65e0\u56da\u72af"})]}):o.jsx("div",{className:"space-y-3",children:t.map(e=>{const t=e.submissionLevel>70?"text-green-400":e.submissionLevel>40?"text-yellow-400":"text-red-400";return o.jsx("div",{className:"bg-black/30 p-4 rounded-lg border border-stone-700 hover:border-amber-500/50 transition-colors",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-grow",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("h3",{className:"text-lg font-bold text-white",children:e.character.name}),o.jsxs("span",{className:"text-sm text-gray-400",children:["Male"===e.character.gender?"\u2642":"\u2640"," Lv.",e.character.realm]}),o.jsx("span",{className:"px-2 py-1 text-xs bg-purple-500/20 text-purple-300 rounded",children:e.character.rarity})]}),o.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:[o.jsx("span",{className:"text-red-300",children:"\u7f6a\u884c:"})," ",e.crime]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-400",children:"\u5c48\u670d:"}),o.jsxs("span",{className:`ml-1 font-bold ${t}`,children:[e.submissionLevel,"%"]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-400",children:"\u5f52\u987a:"}),o.jsxs("span",{className:"ml-1 font-bold "+(e.loyaltyLevel>70?"text-green-400":"text-gray-400"),children:[e.loyaltyLevel,"%"]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-gray-400",children:"\u5269\u4f59\u5211\u671f:"}),o.jsxs("span",{className:"ml-1 font-bold text-orange-400",children:[e.remainingDays,"\u5929"]})]})]}),o.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:e.status.map(e=>o.jsx("span",{className:"px-2 py-1 text-xs bg-orange-500/20 text-orange-300 rounded",children:e},e))})]}),o.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[o.jsx("button",{onClick:t=>{t.stopPropagation(),N(e),k(!0)},className:"px-3 py-1 text-sm bg-cyan-600/80 text-white rounded hover:bg-cyan-500/80 transition-colors",children:"\u8be6\u60c5"}),o.jsxs("button",{onClick:t=>{t.stopPropagation(),P(e),S(!0)},disabled:h,className:"px-3 py-1 text-sm bg-amber-600/80 text-white rounded hover:bg-amber-500/80 disabled:opacity-50 transition-colors",children:[o.jsx("i",{className:"fa-solid fa-comments mr-1"}),"\u5bf9\u8bdd"]}),o.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},disabled:h,className:"px-3 py-1 text-sm bg-red-600/80 text-white rounded hover:bg-red-500/80 disabled:opacity-50 transition-colors",children:"\u5ba1\u8baf"}),o.jsxs("select",{value:e.location,onChange:t=>{t.stopPropagation(),a(e,t.target.value)},className:"px-2 py-1 text-xs bg-stone-700 text-white rounded border border-stone-600",onClick:e=>e.stopPropagation(),children:[o.jsx("option",{value:"",disabled:!0,children:"\u8f6c\u79fb\u5230..."}),T.filter(t=>t!==e.location).map(e=>o.jsx("option",{value:e,children:e},e))]}),e.loyaltyLevel>=80&&o.jsx("button",{onClick:t=>{t.stopPropagation(),i(e)},className:"px-3 py-1 text-sm bg-green-600/80 text-white rounded hover:bg-green-500/80 transition-colors",children:"\u62db\u52df"})]})]})},e.character.id)})})})(y)]})]})]}),w&&j&&o.jsx(Jt,{card:j.character,onClose:()=>{k(!1),N(null)},playerProfile:f,setPlayerProfile:g,onViewPet:b}),C&&E&&o.jsx(As,{isOpen:C,onClose:()=>{S(!1),P(null)},prisoner:E,playerSpiritStones:f?.spiritStones||0,onDialogueComplete:e=>{m&&E&&m(E,e)},onGenerateResponse:async(e,t)=>{if(p)return await p(e,t);const n={"\u5a01\u80c1":["\u54fc\uff0c\u4f60\u4ee5\u4e3a\u8fd9\u6837\u5c31\u80fd\u8ba9\u6211\u5c48\u670d\u5417\uff1f","\u6211...\u6211\u4e0d\u4f1a\u8bf4\u7684...","\u4f60\u4eec\u8fd9\u4e9b\u4eba\uff0c\u8fdf\u65e9\u4f1a\u906d\u62a5\u5e94\u7684\uff01"],"\u529d\u8bf4":["\u4f60\u8bf4\u7684...\u6216\u8bb8\u6709\u4e9b\u9053\u7406...","\u6211\u9700\u8981\u65f6\u95f4\u8003\u8651...","\u4f60\u771f\u7684\u80fd\u4fdd\u8bc1\u5417\uff1f"],"\u4ea4\u6613":["\u8fd9\u4e2a\u6761\u4ef6...\u8ba9\u6211\u60f3\u60f3...","\u4f60\u80fd\u7ed9\u6211\u4ec0\u4e48\u4fdd\u8bc1\uff1f","\u4e5f\u8bb8\u6211\u4eec\u53ef\u4ee5\u8c08\u8c08..."],"\u5957\u8bdd":["\u4f60\u60f3\u77e5\u9053\u4ec0\u4e48\uff1f","\u6211\u4e0d\u77e5\u9053\u4f60\u5728\u8bf4\u4ec0\u4e48...","\u8fd9\u4e2a...\u6211\u4e0d\u592a\u6e05\u695a..."],"\u95f2\u804a":["\u96be\u5f97\u6709\u4eba\u613f\u610f\u548c\u6211\u8bf4\u8bdd...","\u5916\u9762\u7684\u4e16\u754c...\u8fd8\u597d\u5417\uff1f","\u4f60\u4e3a\u4ec0\u4e48\u8981\u6765\u8fd9\u91cc\uff1f"],"\u6069\u60e0":["\u4f60...\u4e3a\u4ec0\u4e48\u8981\u5e2e\u6211\uff1f","\u8c22\u8c22\u4f60...","\u6211\u4e0d\u77e5\u9053\u8be5\u8bf4\u4ec0\u4e48..."],"\u7f9e\u8fb1":["\u4f60\uff01\u4f60\u4f1a\u540e\u6094\u7684\uff01","...","\u6211\u4e0d\u4f1a\u5fd8\u8bb0\u8fd9\u4e00\u5207\u7684..."]}[t.type]||["..."];return n[Math.floor(Math.random()*n.length)]},isLoading:h})]})},Is={Main:"\ud83d\udcdc",Side:"\ud83d\udccb",Sect:"\ud83c\udfef",Completed:"\u2705"},Os=({isOpen:e,onClose:t,quests:n,playerProfile:s,onClaimReward:r})=>{const[a,l]=x.useState("Main"),[i,c]=x.useState(null);if(!e)return null;const d=n.filter(e=>"Completed"===a?"Completed"===e.status||"Claimable"===e.status:e.category===a&&"Completed"!==e.status&&"Claimable"!==e.status),u=({quest:e})=>{const t={Active:{text:"\u8fdb\u884c\u4e2d",class:"text-blue-400"},Claimable:{text:"\u53ef\u9886\u53d6",class:"text-gold-400 animate-pulse"},Completed:{text:"\u5df2\u5b8c\u6210",class:"text-green-400"},InProgress:{text:"\u8fdb\u884c\u4e2d",class:"text-blue-400"}}[n=e.status]||{text:n,class:"text-paper-400"};var n;return o.jsx("li",{onClick:()=>c(e),className:"p-3 cursor-pointer rounded-lg transition-all duration-300 border "+(i?.id===e.id?"bg-gold-500/20 border-gold-500/50 shadow-lg shadow-gold-500/10":"border-transparent hover:bg-ink-700/50 hover:border-gold-500/30"),children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("h4",{className:"font-semibold text-paper-100 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83d\udccc"}),e.title]}),o.jsx("p",{className:`text-xs mt-1 ${t.class}`,children:t.text})]}),"Claimable"===e.status&&o.jsx("span",{className:"text-gold-400 text-xl animate-bounce",children:"\ud83c\udf81"})]})},e.id)},m=({quest:e})=>e?o.jsxs("div",{className:"flex-1 p-6 bg-gradient-to-br from-ink-900/60 to-ink-800/60 rounded-lg overflow-y-auto border border-gold-600/30 relative",children:[o.jsx("div",{className:"absolute top-2 right-2 text-2xl text-gold-500/10",children:"\u262f"}),o.jsxs("h3",{className:"text-2xl font-bold text-gold-300 font-serif mb-4 flex items-center gap-2",children:[o.jsx("span",{className:"text-gold-400/60",children:"\u3010"}),e.title,o.jsx("span",{className:"text-gold-400/60",children:"\u3011"})]}),o.jsxs("p",{className:"text-paper-300 mb-6 italic bg-ink-800/40 p-3 rounded-lg border-l-2 border-gold-500/50",children:['"',e.description,'"']}),o.jsxs("h4",{className:"font-bold text-gold-400 mb-3 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83c\udfaf"}),o.jsx("span",{children:"\u4efb\u52a1\u76ee\u6807"})]}),o.jsx("ul",{className:"space-y-2 mb-6",children:e.objectives.map(e=>o.jsxs("li",{className:"flex items-center bg-ink-800/40 p-2 rounded-lg",children:[o.jsx("span",{className:"mr-3 text-lg "+(e.isCompleted?"text-green-400":"text-paper-500"),children:e.isCompleted?"\u2705":"\u2b1c"}),o.jsxs("span",{className:""+(e.isCompleted?"line-through text-paper-500":"text-paper-200"),children:[e.description,e.targetCount&&o.jsxs("span",{className:"ml-2 text-gold-400/80",children:["(",e.currentCount,"/",e.targetCount,")"]})]})]},e.id))}),o.jsxs("h4",{className:"font-bold text-gold-400 mb-3 flex items-center gap-2",children:[o.jsx("span",{children:"\ud83c\udf81"}),o.jsx("span",{children:"\u4efb\u52a1\u5956\u52b1"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-6",children:[e.rewards.spiritStones&&o.jsxs("div",{className:"flex items-center bg-ink-800/40 p-2 rounded-lg text-gold-300",children:[o.jsx("span",{className:"mr-2",children:"\ud83d\udc8e"}),o.jsxs("span",{children:["\u7075\u77f3 x ",e.rewards.spiritStones]})]}),e.rewards.reputation&&o.jsxs("div",{className:"flex items-center bg-ink-800/40 p-2 rounded-lg text-purple-300",children:[o.jsx("span",{className:"mr-2",children:"\u2b50"}),o.jsxs("span",{children:["\u58f0\u671b +",e.rewards.reputation]})]}),e.rewards.items?.map((e,t)=>o.jsxs("div",{className:"flex items-center bg-ink-800/40 p-2 rounded-lg text-green-300",children:[o.jsx("span",{className:"mr-2",children:"\ud83d\udce6"}),o.jsx("span",{children:e.name})]},t))]}),"Claimable"===e.status&&o.jsxs("button",{onClick:()=>r(e.id),className:"w-full py-3 bg-gradient-to-r from-gold-600 via-gold-500 to-gold-600 hover:from-gold-500 hover:via-gold-400 hover:to-gold-500 text-ink-900 font-bold rounded-lg shadow-lg transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center space-x-2 hover:shadow-gold-500/30",children:[o.jsx("span",{children:"\ud83c\udf81"}),o.jsx("span",{children:"\u9886\u53d6\u5956\u52b1"})]}),"Completed"===e.status&&o.jsxs("div",{className:"w-full py-3 bg-ink-700/60 text-paper-500 font-bold rounded-lg text-center border border-ink-600",children:[o.jsx("span",{className:"mr-2",children:"\u2705"}),o.jsx("span",{children:"\u5df2\u9886\u53d6"})]})]}):o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-paper-500 bg-ink-800/30 rounded-lg border border-dashed border-ink-600",children:[o.jsx("span",{className:"text-4xl mb-3 opacity-30",children:"\ud83d\udcdc"}),o.jsx("p",{children:"\u4ece\u5de6\u4fa7\u9009\u62e9\u4e00\u4e2a\u4efb\u52a1\u4ee5\u67e5\u770b\u8be6\u60c5"})]}),p=({tab:e,label:t})=>o.jsxs("button",{onClick:()=>l(e),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-all duration-300 flex items-center gap-1.5 "+(a===e?"bg-ink-800/90 text-gold-400 border-b-2 border-gold-500/60 shadow-[0_0_10px_rgba(180,149,106,0.15)]":"bg-transparent text-paper-400 hover:bg-ink-800/50 hover:text-gold-300"),children:[o.jsx("span",{children:Is[e]}),o.jsx("span",{children:t})]});return o.jsxs("div",{className:"fixed inset-0 bg-black/85 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:[o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[o.jsx("div",{className:"absolute top-20 left-20 text-8xl text-gold-500/5",children:"\u262f"}),o.jsx("div",{className:"absolute bottom-20 right-20 text-8xl text-gold-500/5",children:"\u262f"})]}),o.jsxs("div",{className:"relative bg-gradient-to-br from-ink-900/98 via-ink-800/98 to-ink-900/98 border-2 border-gold-600/50 w-full max-w-5xl h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"}),o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-gradient-to-r from-ink-900/50 via-ink-800/50 to-ink-900/50 border-b border-gold-600/30",children:[o.jsxs("h2",{className:"text-2xl font-bold text-gold-300 font-serif flex items-center gap-3",children:[o.jsx("span",{className:"text-gold-400/60",children:"\u2726"}),o.jsx("span",{children:"\ud83d\udcdc \u4ed9\u9014\u4efb\u52a1\u5f55"}),o.jsx("span",{className:"text-gold-400/60",children:"\u2726"})]}),o.jsx("button",{onClick:t,className:"text-gold-400/70 hover:text-gold-300 transition-colors p-2 hover:bg-gold-500/10 rounded-lg",children:o.jsx("span",{className:"text-xl",children:"\u2715"})})]}),o.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-gold-600/30 bg-ink-900/30",children:[o.jsx(p,{tab:"Main",label:"\u4e3b\u7ebf"}),o.jsx(p,{tab:"Side",label:"\u652f\u7ebf"}),o.jsx(p,{tab:"Sect",label:"\u5b97\u95e8"}),o.jsx(p,{tab:"Completed",label:"\u5df2\u5b8c\u6210"})]}),o.jsxs("div",{className:"flex-grow flex p-6 space-x-6 overflow-hidden",children:[o.jsx("div",{className:"w-1/3 flex-shrink-0 bg-gradient-to-br from-ink-900/60 to-ink-800/60 rounded-lg p-4 overflow-y-auto border border-gold-600/30",children:o.jsx("ul",{className:"space-y-2",children:d.length>0?d.map(e=>o.jsx(u,{quest:e},e.id)):o.jsxs("div",{className:"text-center text-paper-500 mt-8 flex flex-col items-center",children:[o.jsx("span",{className:"text-4xl mb-2 opacity-30",children:"\ud83d\udced"}),o.jsx("p",{children:"\u6b64\u5206\u7c7b\u4e0b\u6682\u65e0\u4efb\u52a1"})]})})}),o.jsx(m,{quest:i})]}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-gold-500/60 to-transparent"})]})]})},zs=({event:e,onChoice:t,resultText:n})=>o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",children:o.jsxs("div",{className:"ornate-border bg-stone-800/90 backdrop-blur-lg w-full max-w-lg shadow-2xl flex flex-col",children:[o.jsx("div",{className:"p-4 text-center bg-black/20",children:o.jsx("h2",{className:"text-xl font-bold text-amber-300 font-serif",children:e.title})}),o.jsx("div",{className:"p-6 font-serif min-h-[15rem] flex flex-col justify-center",children:n?o.jsx("div",{className:"text-center animate-fade-in",children:o.jsx("p",{className:"text-amber-300 text-lg leading-relaxed",children:n})}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-gray-300 whitespace-pre-wrap mb-6 text-center leading-relaxed",children:e.story}),o.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:e.choices.map((e,n)=>o.jsx("button",{onClick:()=>t(e),className:"w-full sm:w-auto bg-stone-700/80 px-5 py-3 rounded-md hover:bg-stone-600/80 hover:border-amber-400/50 border border-transparent transition-all duration-200 font-serif shadow-md",children:e.text},n))})]})})]})}),Rs=({isOpen:e,onClose:t,reputation:n,isLoading:s,onRefresh:r})=>{const[a,l]=x.useState("summary");if(!e)return null;const i=e=>{switch(e){case"\u540d\u5782\u9752\u53f2":return"text-yellow-300 animate-glow";case"\u5a01\u9707\u4e00\u65b9":return"text-red-400";case"\u58f0\u540d\u8fdc\u626c":return"text-sky-400";case"\u5c0f\u6709\u540d\u6c14":return"text-green-400";default:return"text-gray-400"}};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsx("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:"\u58f0\u671b"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:r,disabled:s,className:"px-4 py-2 text-sm font-semibold bg-amber-600 text-white rounded-lg hover:bg-amber-500 transition-colors disabled:bg-stone-600 disabled:cursor-not-allowed",children:s?"\u5237\u65b0\u4e2d...":"\u5237\u65b0\u60c5\u62a5"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]})]}),o.jsx("div",{className:"border-b border-stone-700 px-4",children:o.jsxs("div",{className:"flex space-x-4",children:[o.jsx("button",{onClick:()=>l("summary"),className:"py-2 px-4 text-sm font-semibold transition-colors "+("summary"===a?"text-amber-400 border-b-2 border-amber-400":"text-gray-400 hover:text-white"),children:"\u58f0\u671b\u603b\u89c8"}),o.jsx("button",{onClick:()=>l("history"),className:"py-2 px-4 text-sm font-semibold transition-colors "+("history"===a?"text-amber-400 border-b-2 border-amber-400":"text-gray-400 hover:text-white"),children:"\u58f0\u671b\u5386\u53f2"})]})}),o.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-6",children:s&&"summary"===a?o.jsx("div",{className:"text-center text-amber-300 animate-glow p-8",children:"\u6b63\u5728\u83b7\u53d6\u5929\u673a\u9601\u7684\u6700\u65b0\u60c5\u62a5..."}):"summary"===a?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h3",{className:`text-4xl font-bold font-serif ${i(n.level)}`,children:n.level}),o.jsxs("p",{className:"text-lg text-gray-400 font-mono",children:[n.score," \u58f0\u671b"]})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-amber-400 mb-3 text-lg",children:"\u6c5f\u6e56\u79f0\u53f7"}),n.title?o.jsx("div",{className:"flex flex-wrap gap-2",children:o.jsx("span",{className:"px-3 py-1 bg-rose-800/50 text-rose-300 rounded-full border border-rose-700",children:n.title})}):o.jsx("p",{className:"text-gray-500 italic",children:"\u5c1a\u672a\u83b7\u5f97\u4efb\u4f55\u79f0\u53f7\u3002"})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-green-400 mb-3 text-lg",children:"\u4fa0\u4e49\u4e4b\u4e3e"}),n.goodDeeds&&n.goodDeeds.length>0?o.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:n.goodDeeds.map((e,t)=>o.jsx("li",{children:e},t))}):o.jsx("p",{className:"text-gray-500 italic",children:"\u5c1a\u672a\u6709\u4fa0\u4e49\u4e4b\u4e3e\u6d41\u4f20\u3002"})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-red-400 mb-3 text-lg",children:"\u6076\u884c\u662d\u5f70"}),n.badDeeds&&n.badDeeds.length>0?o.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:n.badDeeds.map((e,t)=>o.jsx("li",{children:e},t))}):o.jsx("p",{className:"text-gray-500 italic",children:"\u4f60\u4f3c\u4e4e\u8fd8\u672a\u72af\u4e0b\u4ec0\u4e48\u5927\u9519\u3002"})]}),o.jsxs("div",{className:"bg-black/20 p-4 rounded-lg border border-stone-700/50",children:[o.jsx("h4",{className:"font-semibold text-pink-400 mb-3 text-lg",children:"\u98ce\u6d41\u97f5\u4e8b"}),n.lewdDeeds&&n.lewdDeeds.length>0?o.jsx("ul",{className:"space-y-2 list-disc list-inside text-gray-300",children:n.lewdDeeds.map((e,t)=>o.jsx("li",{children:e},t))}):o.jsx("p",{className:"text-gray-500 italic",children:"\u6c5f\u6e56\u4e0a\u8fd8\u6ca1\u6709\u5173\u4e8e\u4f60\u7684\u98ce\u6d41\u4f20\u8bf4\u3002"})]})]}):o.jsx("div",{className:"space-y-4",children:n.history&&n.history.length>0?n.history.map(e=>o.jsxs("div",{className:"bg-black/20 p-3 rounded-lg border border-stone-700/50",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("p",{className:"text-gray-300",children:e.description}),o.jsx("span",{className:"font-mono text-lg "+(e.scoreChange>=0?"text-green-400":"text-red-400"),children:e.scoreChange>=0?`+${e.scoreChange}`:e.scoreChange})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:e.timestamp})]},e.id)):o.jsx("p",{className:"text-gray-500 italic text-center pt-8",children:"\u58f0\u671b\u5386\u53f2\u4e00\u7247\u7a7a\u767d\u3002"})})})]})})},Fs=({isOpen:e,onClose:t,onSave:n,onLoad:s,onExport:r,onImport:a,onDelete:l,getSaves:i})=>{const[c,d]=x.useState({}),[u,m]=x.useState("save"),[h,f]=x.useState(null),[g,b]=x.useState(null),[y,v]=x.useState(""),j=p.useRef(null),N=x.useCallback(async()=>{const e=await i();d(e)},[i]);if(x.useEffect(()=>{e&&N()},[e,N]),!e)return null;const w=e=>{const t=c[e],n=t?.name||`\u5b58\u6863 ${e}`;b(e),v(n)},k=async e=>{y.trim()&&(n(e,y.trim()),b(null),v(""),setTimeout(()=>N(),200))},C=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},S=e=>{if(!e)return"";const{playerProfile:t,exploration:n}=e.gameState;return`${t.name} | ${n.location} | \u7075\u77f3: ${t.spiritStones}`},E=e=>{const t=c[e],n=!t,a=g===e;return o.jsxs("div",{className:`relative group bg-gradient-to-br ${n?"from-stone-800/40 to-stone-900/40":"from-stone-800/80 to-stone-900/80"} rounded-xl p-5 border-2 transition-all duration-300 ${n?"border-stone-700/30 hover:border-stone-600/50":"border-amber-900/50 hover:border-amber-700/70 hover:shadow-xl hover:shadow-amber-900/20"}`,children:[o.jsx("div",{className:"absolute top-2 left-2",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg",children:o.jsx("span",{className:"text-white font-bold text-sm",children:e})})}),o.jsx("div",{className:"ml-10 mb-3",children:a?o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("input",{type:"text",value:y,onChange:e=>v(e.target.value),onKeyPress:t=>{"Enter"===t.key&&k(e),"Escape"===t.key&&(b(null),v(""))},className:"flex-1 px-3 py-2 bg-stone-900/80 border border-amber-700/50 rounded-lg text-white font-serif focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20",placeholder:"\u8f93\u5165\u5b58\u6863\u540d\u79f0...",autoFocus:!0}),o.jsx("button",{onClick:()=>k(e),className:"px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-semibold transition-colors",children:"\u786e\u5b9a"}),o.jsx("button",{onClick:()=>{b(null),v("")},className:"px-4 py-2 bg-stone-600 hover:bg-stone-500 rounded-lg text-white font-semibold transition-colors",children:"\u53d6\u6d88"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("h3",{className:"text-lg font-bold text-amber-200 font-serif mb-1 flex items-center gap-2",children:[t?t.name:`\u7a7a\u5b58\u6863\u4f4d ${e}`,!n&&"save"===u&&o.jsxs("button",{onClick:()=>w(e),className:"text-xs px-2 py-1 bg-amber-700/50 hover:bg-amber-600/50 rounded text-amber-200 transition-colors",title:"\u91cd\u547d\u540d",children:[o.jsx("i",{className:"fa-solid fa-pen-to-square mr-1"}),"\u6539\u540d"]})]}),t?o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"text-sm text-amber-300/80 font-mono mb-1",children:[o.jsx("i",{className:"fa-solid fa-clock mr-1"}),C(t.timestamp)]}),o.jsxs("p",{className:"text-xs text-stone-400 line-clamp-1",children:[o.jsx("i",{className:"fa-solid fa-gamepad mr-1"}),S(t)]})]}):o.jsx("p",{className:"text-sm text-stone-500 italic",children:'\u70b9\u51fb"\u5b58\u6863"\u6309\u94ae\u521b\u5efa\u65b0\u5b58\u6863'})]})}),!a&&o.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2",children:["save"===u?o.jsxs("button",{onClick:()=>w(e),className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-sky-600 to-sky-700 hover:from-sky-500 hover:to-sky-600 rounded-lg font-bold text-white transition-all duration-200 shadow-lg hover:shadow-sky-500/30 transform hover:scale-105",children:[o.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"}),n?"\u65b0\u5efa\u5b58\u6863":"\u8986\u76d6\u5b58\u6863"]}):o.jsxs("button",{onClick:()=>s(e),disabled:n,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 rounded-lg font-bold text-white transition-all duration-200 shadow-lg hover:shadow-green-500/30 transform hover:scale-105 disabled:from-stone-700 disabled:to-stone-800 disabled:text-stone-500 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none",children:[o.jsx("i",{className:"fa-solid fa-folder-open mr-2"}),"\u8bfb\u53d6\u5b58\u6863"]}),o.jsx("button",{onClick:()=>r(e),disabled:n,className:"w-11 h-11 rounded-lg font-semibold text-white bg-purple-700 hover:bg-purple-600 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-purple-500/30 disabled:bg-stone-700 disabled:text-stone-500 disabled:cursor-not-allowed disabled:shadow-none",title:"\u5bfc\u51fa\u5b58\u6863",children:o.jsx("i",{className:"fa-solid fa-download"})}),o.jsx("button",{onClick:()=>f(e),disabled:n,className:"w-11 h-11 rounded-lg font-semibold text-white bg-red-800 hover:bg-red-700 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-red-500/30 disabled:bg-stone-700 disabled:text-stone-500 disabled:cursor-not-allowed disabled:shadow-none",title:"\u5220\u9664\u5b58\u6863",children:o.jsx("i",{className:"fa-solid fa-trash-can"})})]}),h===e&&t&&o.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:()=>f(null),children:o.jsxs("div",{className:"bg-gradient-to-br from-stone-800 to-stone-900 border-2 border-red-600/50 rounded-xl w-full max-w-md shadow-2xl p-6 text-center font-serif",onClick:e=>e.stopPropagation(),children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-600/20 flex items-center justify-center",children:o.jsx("i",{className:"fa-solid fa-triangle-exclamation text-red-500 text-3xl"})}),o.jsx("h3",{className:"text-2xl font-bold text-red-400 mb-3",children:"\u786e\u8ba4\u5220\u9664"}),o.jsx("p",{className:"text-gray-300 mb-2",children:"\u4f60\u786e\u5b9a\u8981\u6c38\u4e45\u5220\u9664\u5b58\u6863"}),o.jsxs("p",{className:"text-xl font-bold text-amber-300 mb-1",children:['"',t.name,'"']}),o.jsx("p",{className:"text-sm text-stone-400 mb-6",children:"\u6b64\u64cd\u4f5c\u65e0\u6cd5\u64a4\u9500\uff01"}),o.jsxs("div",{className:"flex justify-center gap-4",children:[o.jsxs("button",{onClick:()=>f(null),className:"px-6 py-2.5 bg-stone-600 hover:bg-stone-500 rounded-lg font-semibold text-white transition-colors shadow-lg",children:[o.jsx("i",{className:"fa-solid fa-xmark mr-2"}),"\u53d6\u6d88"]}),o.jsxs("button",{onClick:()=>(async e=>{await l(e),f(null),N()})(e),className:"px-6 py-2.5 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 rounded-lg font-bold text-white transition-all shadow-lg hover:shadow-red-500/30",children:[o.jsx("i",{className:"fa-solid fa-trash-can mr-2"}),"\u786e\u8ba4\u5220\u9664"]})]})]})})]},e)};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-gradient-to-br from-stone-900 to-black w-full max-w-4xl h-auto max-h-[85vh] rounded-2xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col border-2 border-amber-900/50",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-5 flex-shrink-0 bg-gradient-to-r from-amber-900/40 to-stone-900/40 border-b-2 border-amber-900/30",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg",children:o.jsx("i",{className:"fa-solid fa-floppy-disk text-white text-lg"})}),o.jsx("h2",{className:"text-3xl font-bold text-amber-300 font-serif",children:"\u5b58\u6863\u7ba1\u7406"})]}),o.jsx("button",{onClick:t,className:"w-10 h-10 rounded-full bg-stone-700 hover:bg-stone-600 transition-colors flex items-center justify-center text-amber-300 hover:text-white",children:o.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 px-6 pt-4 flex space-x-2",children:[o.jsxs("button",{onClick:()=>m("save"),className:"flex-1 px-6 py-3 text-base font-bold rounded-t-xl transition-all duration-200 "+("save"===u?"bg-gradient-to-b from-amber-700 to-amber-800 text-white shadow-lg border-2 border-amber-600 border-b-0":"bg-stone-800/50 text-stone-400 hover:bg-stone-700/70 hover:text-stone-200 border-2 border-stone-700 border-b-0"),children:[o.jsx("i",{className:"fa-solid fa-floppy-disk mr-2"}),"\u4fdd\u5b58\u6e38\u620f"]}),o.jsxs("button",{onClick:()=>m("load"),className:"flex-1 px-6 py-3 text-base font-bold rounded-t-xl transition-all duration-200 "+("load"===u?"bg-gradient-to-b from-green-700 to-green-800 text-white shadow-lg border-2 border-green-600 border-b-0":"bg-stone-800/50 text-stone-400 hover:bg-stone-700/70 hover:text-stone-200 border-2 border-stone-700 border-b-0"),children:[o.jsx("i",{className:"fa-solid fa-folder-open mr-2"}),"\u8bfb\u53d6\u5b58\u6863"]})]}),o.jsx("div",{className:"flex-grow overflow-y-auto p-6 space-y-4 custom-scrollbar",children:[1,2,3,4,5].map(e=>E(e))}),o.jsxs("div",{className:"p-5 bg-gradient-to-r from-stone-900/60 to-black/60 border-t-2 border-stone-700/50 flex-shrink-0",children:[o.jsx("input",{type:"file",ref:j,onChange:e=>{const t=e.target.files?.[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=e.target?.result;if("string"!=typeof t)throw new Error("\u6587\u4ef6\u4e0d\u662f\u6709\u6548\u7684\u6587\u672c\u6587\u4ef6\u3002");const n=JSON.parse(t);n.name&&n.timestamp&&n.gameState?(a(n),N()):alert("\u65e0\u6548\u7684\u5b58\u6863\u6587\u4ef6\u683c\u5f0f\u3002")}catch(t){console.error("\u5bfc\u5165\u5b58\u6863\u5931\u8d25:",t),alert("\u5bfc\u5165\u5931\u8d25\uff0c\u6587\u4ef6\u53ef\u80fd\u5df2\u635f\u574f\u6216\u683c\u5f0f\u4e0d\u6b63\u786e\u3002")}},n.readAsText(t),j.current&&(j.current.value="")},className:"hidden",accept:"application/json"}),o.jsxs("button",{onClick:()=>j.current?.click(),className:"w-full px-6 py-3 rounded-xl font-bold text-white bg-gradient-to-r from-purple-700 to-purple-800 hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-purple-500/30 transform hover:scale-[1.02]",children:[o.jsx("i",{className:"fa-solid fa-file-import mr-2"}),"\u4ece\u6587\u4ef6\u5bfc\u5165\u5b58\u6863"]}),o.jsxs("p",{className:"text-center text-xs text-stone-500 mt-3 font-mono",children:[o.jsx("i",{className:"fa-solid fa-info-circle mr-1"}),"\u7eaf\u624b\u52a8\u5b58\u6863\u7cfb\u7edf - \u4e0d\u4f1a\u81ea\u52a8\u4fdd\u5b58\u6e38\u620f\u8fdb\u5ea6"]})]})]})})},qs=({story:e,storyEndRef:t})=>o.jsxs("div",{className:"w-full max-w-4xl h-full max-h-[70vh] overflow-y-auto p-6 ink-card rounded-lg relative",children:[o.jsx("div",{className:"absolute top-3 left-3 w-4 h-4 border-l border-t border-gold-500/30"}),o.jsx("div",{className:"absolute top-3 right-3 w-4 h-4 border-r border-t border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-3 left-3 w-4 h-4 border-l border-b border-gold-500/30"}),o.jsx("div",{className:"absolute bottom-3 right-3 w-4 h-4 border-r border-b border-gold-500/30"}),o.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/40 to-transparent"}),o.jsx("div",{className:"prose max-w-none prose-p:text-ink-200 prose-p:leading-[2] prose-headings:text-gold-400 prose-strong:text-gold-300 font-serif whitespace-pre-wrap animate-fade-in text-lg tracking-wide",children:e}),o.jsx("div",{ref:t}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/40 to-transparent"})]}),Bs=({isOpen:e,onClose:t,shop:n,cardCollection:s})=>{const[r,a]=x.useState(null),[l,i]=x.useState(""),[c,d]=x.useState(!1),[u,m]=x.useState(!1),[p,h]=x.useState(""),[f,g]=x.useState([]),[b,y]=x.useState(!1);if(!e)return null;const v=async()=>{if(!r||!p.trim())return;const e=[...f,{role:"user",content:p}];g(e),y(!0);try{const t=e.slice(-6).map(e=>`${"user"===e.role?"\u73a9\u5bb6":r.name}: ${e.content}`).join("\n"),s=Object.entries(Ge).find(([e])=>{const t=n.staff.find(t=>t.positionId===e);return t?.characterId===r.id}),a=s?s[1].name:"\u672a\u77e5\u5c97\u4f4d",l=await async function(e,t,n,s){const r=`\u4f60\u662f\u4e00\u4f4d\u6c89\u6d78\u5f0f\u89d2\u8272\u626e\u6f14\u5927\u5e08\uff0c\u6b63\u5728\u626e\u6f14\u3010${e.name}\u3011\uff0c\u4e00\u540d\u5728${t}\u5de5\u4f5c\u7684\u5458\u5de5\u3002\n\n**\u89d2\u8272\u8bbe\u5b9a**:\n- \u59d3\u540d: ${e.name}\n- \u6027\u522b: ${e.gender}\n- \u79f0\u53f7: ${e.title}\n- \u5916\u89c2: ${e.appearance}\n- \u5c97\u4f4d: ${t}\n\n**\u4e92\u52a8\u8981\u6c42**:\n1. **\u7b2c\u4e00\u4eba\u79f0\u626e\u6f14**: \u4f60\u5fc5\u987b\u4ee5\u7b2c\u4e00\u4eba\u79f0"\u6211"\u6765\u56de\u5e94\uff0c\u5b8c\u5168\u4ee3\u5165\u89d2\u8272\n2. **\u4fdd\u6301\u89d2\u8272\u4e00\u81f4\u6027**: \u56de\u590d\u5fc5\u987b\u7b26\u5408\u89d2\u8272\u7684\u6027\u683c\u3001\u80cc\u666f\u548c\u5de5\u4f5c\u5c97\u4f4d\n3. **\u8272\u60c5\u5316\u4e92\u52a8**: \u6839\u636e\u5c97\u4f4d\u7279\u70b9\uff0c\u56de\u590d\u5e94\u8be5\u5305\u542b\u9002\u5ea6\u7684\u8272\u60c5\u6697\u793a\u6216\u63cf\u5199\n4. **\u81ea\u7136\u5bf9\u8bdd**: \u56de\u590d\u8981\u50cf\u771f\u5b9e\u5bf9\u8bdd\u4e00\u6837\u81ea\u7136\uff0c\u4e0d\u8981\u592a\u957f\uff0850-150\u5b57\uff09\n5. **\u573a\u666f\u611f**: \u7ed3\u5408\u5f53\u524d\u5de5\u4f5c\u573a\u6240\u7684\u6c1b\u56f4\u548c\u73af\u5883\n\n**\u5c97\u4f4d\u7279\u70b9\u53c2\u8003**:\n- \u9752\u697c\u82b1\u9b41\uff1a\u59a9\u5a9a\u3001\u8bf1\u60d1\u3001\u64c5\u957f\u5e8a\u7b2b\u4e4b\u672f\n- \u89d2\u6597\u5974\u96b6\uff1a\u5f3a\u58ee\u3001\u670d\u4ece\u3001\u5c55\u793a\u8eab\u4f53\n- \u70bc\u4e39\u5e08\uff1a\u4e13\u4e1a\u3001\u795e\u79d8\u3001\u53ef\u80fd\u53d7\u6625\u836f\u5f71\u54cd\n- \u62a4\u536b\uff1a\u8b66\u60d5\u3001\u5fe0\u8bda\u3001\u6697\u85cf\u60c5\u6b32\n- \u60c5\u62a5\u9601\u63a2\u5b50\uff1a\u795e\u79d8\u3001\u591a\u53d8\u3001\u5584\u4e8e\u8bf1\u60d1\u5957\u8bdd\n\n**\u7981\u6b62\u4e8b\u9879**:\n- \u4e0d\u8981\u4f7f\u7528\u7b2c\u4e09\u4eba\u79f0\u63cf\u8ff0\n- \u4e0d\u8981\u8131\u79bb\u89d2\u8272\u8eab\u4efd\n- \u4e0d\u8981\u8fc7\u4e8e\u5570\u55e6\u6216\u8bf4\u6559\n- \u4e0d\u8981\u4f7f\u7528JSON\u683c\u5f0f\u6216\u6807\u8bb0\u8bed\u8a00\n\n**\u76f4\u63a5\u8f93\u51fa**: \u53ea\u9700\u8981\u4e00\u6bb5\u89d2\u8272\u7684\u7b2c\u4e00\u4eba\u79f0\u56de\u590d\uff0c\u4e0d\u8981\u6dfb\u52a0\u4efb\u4f55\u5176\u4ed6\u5185\u5bb9\u3002`,a=`\n${s?`\n\n\u4e4b\u524d\u7684\u5bf9\u8bdd:\n${s}\n\n`:""}\n\u73a9\u5bb6\u5bf9\u4f60\u8bf4\uff1a\n"${n}"\n\n\u8bf7\u4ee5\u3010${e.name}\u3011\u7684\u8eab\u4efd\u56de\u5e94\uff1a\n    `;return(await K(r,a)).trim()}(r,a,p,t);g([...e,{role:"ai",content:l}]),h(""),Bn.setCurrentScene("surveillance"),Bn.captureMessage(l,"surveillance")}catch(t){console.error("\u4e92\u52a8\u751f\u6210\u5931\u8d25:",t),alert("\u4e92\u52a8\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{y(!1)}},j=async(e,t)=>{a(e),d(!0),i("");try{const n=await async function(e,t,n){const s=`\u4f60\u662f\u4e00\u4e2a\u62e5\u6709\u4e0a\u5e1d\u89c6\u89d2\u7684\u7aa5\u89c6\u8005\uff0c\u6b63\u5728\u901a\u8fc7\u4e00\u679a\u9690\u5f62\u7684"\u76d1\u89c6\u6c34\u6676"\u5077\u7aa5\u4e00\u540d\u5458\u5de5\u6700\u79c1\u5bc6\u3001\u6700\u6deb\u8361\u7684\u5de5\u4f5c\u72b6\u6001\u3002\u4f60\u5fc5\u987b\u4ee5\u7b2c\u4e00\u4eba\u79f0\u89c6\u89d2\uff0c\u50cf\u5728\u76f4\u64ad\u8272\u60c5\u73b0\u573a\u4e00\u6837\uff0c\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u3001\u6beb\u65e0\u4fdd\u7559\u5730\u63cf\u8ff0\u4f60\u770b\u5230\u7684\u4e00\u5207\u3002\n\n**\u6838\u5fc3\u8981\u6c42**:\n\n1.  **\u7b2c\u4e00\u4eba\u79f0\u5077\u7aa5\u89c6\u89d2**:\n    - \u7528"\u6211\u770b\u5230..."\u3001"\u6c34\u6676\u4e2d\u663e\u793a..."\u7b49\u5f00\u5934\n    - \u8425\u9020\u771f\u5b9e\u7684\u5077\u7aa5\u6c1b\u56f4\u548c\u7981\u5fcc\u611f\n\n2.  **\u805a\u7126\u5f53\u524d\u6b63\u5728\u53d1\u751f\u7684\u6deb\u8361\u573a\u666f**:\n    - \u63cf\u8ff0\u8fd9\u4e2a\u4eba\u3010\u6b64\u523b\u3011\u6b63\u5728\u505a\u4ec0\u4e48\u6deb\u8361\u7684\u4e8b\n    - \u5fc5\u987b\u662f\u6b63\u5728\u8fdb\u884c\u4e2d\u7684\u6027\u884c\u4e3a\u6216\u8272\u60c5\u573a\u666f\n    - \u4e0d\u8981\u63cf\u8ff0\u8fc7\u53bb\u6216\u672a\u6765\uff0c\u53ea\u63cf\u8ff0\u73b0\u5728\n\n3.  **\u7ed3\u5408\u5c97\u4f4d\u7279\u70b9**:\n    - \u9752\u697c\u82b1\u9b41\uff1a\u6b63\u5728\u63a5\u5ba2\uff0c\u8be6\u7ec6\u63cf\u5199\u6027\u4ea4\u8fc7\u7a0b\n    - \u89d2\u6597\u5974\u96b6\uff1a\u6b63\u5728\u88ab\u8c03\u6559\u6216\u4e0e\u4ed6\u4eba\u4ea4\u5408\n    - \u70bc\u4e39\u5e08\uff1a\u6b63\u5728\u88ab\u6625\u836f\u5f71\u54cd\u4e0b\u81ea\u6170\u6216\u4e0e\u4eba\u53cc\u4fee\n    - \u62a4\u536b\uff1a\u6b63\u5728\u503c\u73ed\u65f6\u5077\u5077\u624b\u6deb\u6216\u88ab\u4fb5\u72af\n    - \u5fc5\u987b\u4e0e${t}\u7684\u5de5\u4f5c\u5185\u5bb9\u7d27\u5bc6\u76f8\u5173\n\n4.  **\u6781\u81f4\u8272\u60c5\u7684\u7ec6\u8282\u63cf\u7ed8**\uff08\u5fc5\u987b\u5305\u542b\uff09:\n    - **\u8eab\u4f53\u59ff\u6001**: \u56db\u80a2\u5982\u4f55\u6446\u653e\u3001\u5982\u4f55\u88ab\u675f\u7f1a\u3001\u5982\u4f55\u5f2f\u66f2\n    - **\u9762\u90e8\u8868\u60c5**: \u773c\u795e\u3001\u5634\u578b\u3001\u662f\u5426\u6d41\u53e3\u6c34\u3001\u662f\u5426\u54ed\u6ce3\n    - **\u6027\u5668\u5b98\u7279\u5199**: \u9634\u830e/\u9634\u9053\u7684\u72b6\u6001\u3001\u989c\u8272\u3001\u5927\u5c0f\u3001\u6b63\u5728\u53d1\u751f\u4ec0\u4e48\n    - **\u4f53\u6db2\u63cf\u5199**: \u7cbe\u6db2\u3001\u6deb\u6c34\u3001\u553e\u6db2\u3001\u6c57\u6c34\u7684\u6d41\u6dcc\u548c\u98de\u6e85\n    - **\u58f0\u97f3**: \u547b\u541f\u58f0\u3001\u6c34\u58f0\u3001\u8089\u4f53\u62cd\u51fb\u58f0\n    - **\u6c14\u5473**: \u6c57\u5473\u3001\u7cbe\u6db2\u5473\u3001\u6deb\u6c34\u5473\n    - **\u52a8\u4f5c\u7ec6\u8282**: \u62bd\u63d2\u7684\u8282\u594f\u3001\u6df1\u5ea6\u3001\u89d2\u5ea6\n\n5.  **\u5b57\u6570\u8981\u6c42**: 150-250\u5b57\n\n6.  **\u7981\u6b62\u4e8b\u9879**:\n    - \u4e0d\u8981\u542b\u7cca\u5176\u8f9e\u6216\u4f7f\u7528\u59d4\u5a49\u8bed\n    - \u4e0d\u8981\u53ea\u63cf\u8ff0\u6c1b\u56f4\uff0c\u5fc5\u987b\u63cf\u8ff0\u5177\u4f53\u7684\u6027\u884c\u4e3a\n    - \u4e0d\u8981\u4f7f\u7528JSON\u683c\u5f0f\u6216\u4efb\u4f55\u6807\u8bb0\u8bed\u8a00\n    - \u4e0d\u8981\u6dfb\u52a0\u9053\u5fb7\u8bc4\u5224\u6216\u7ed3\u5c3e\u603b\u7ed3\n\n7.  **\u76f4\u63a5\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u53ea\u9700\u8981\u4e00\u6bb5\u7eaf\u6587\u672c\u7684\u5077\u7aa5\u63cf\u8ff0\uff0c\u4e0d\u8981\u5305\u542b\u4efb\u4f55\u5176\u4ed6\u5185\u5bb9\u3002\n\n**\u793a\u4f8b\u683c\u5f0f**:\n"\u900f\u8fc7\u76d1\u89c6\u6c34\u6676\uff0c\u6211\u770b\u5230${e.name}\u6b63\u8dea\u5728\u5e8a\u4e0a\uff0c\u53cc\u624b\u88ab\u7ed1\u5728\u8eab\u540e\uff0c\u5634\u91cc\u542b\u7740..."`,r=`\n    \u6b63\u5728\u76d1\u89c6\u7684\u5458\u5de5:\n    - \u59d3\u540d: ${e.name}\n    - \u6027\u522b: ${e.gender}\n    - \u5c97\u4f4d: ${t}\n    - \u5916\u89c2: ${e.appearance}\n    - \u7279\u8d28: ${e.title}\n\n    \u8bf7\u4ee5\u7b2c\u4e00\u4eba\u79f0\u5077\u7aa5\u89c6\u89d2\uff0c\u751f\u6210\u4e00\u4efd\u6781\u5ea6\u8be6\u7ec6\u3001\u9732\u9aa8\u3001\u8272\u60c5\u7684\u5b9e\u65f6\u76d1\u89c6\u62a5\u544a\u3002\u5fc5\u987b\u63cf\u8ff0\u6b63\u5728\u53d1\u751f\u7684\u6027\u884c\u4e3a\u573a\u666f\uff01\n    `;return n?await J({systemInstruction:s,prompt:r,gameState:n}):await K(s,r)}(e,t);i(n)}catch(n){console.error("Failed to generate surveillance report:",n),i("\u76d1\u89c6\u6c34\u6676\u4f3c\u4e4e\u88ab\u4e00\u80a1\u795e\u79d8\u7684\u529b\u91cf\u5e72\u6270\u4e86...")}finally{d(!1)}};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border bg-stone-900 w-full max-w-3xl h-[70vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20",children:[o.jsxs("h2",{className:"text-2xl font-bold text-amber-300 font-serif",children:["\u76d1\u89c6 ",n.type]}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-grow p-6 flex gap-6 overflow-hidden",children:[o.jsx("div",{className:"w-1/3 flex-shrink-0 space-y-3 overflow-y-auto",children:Object.entries(Ge).filter(([,e])=>e.shop===n.type).map(([e,t])=>{const a=n.staff.find(t=>t.positionId===e),l=a?s.find(e=>e.id===a.characterId):null;return o.jsxs("div",{children:[o.jsx("h4",{className:"text-amber-400 font-semibold mb-1",children:t.name}),l?o.jsx("button",{onClick:()=>j(l,t.name),className:"w-full text-left p-2 rounded-md transition-colors "+(r?.id===l.id?"bg-amber-600/50":"bg-stone-800/70 hover:bg-stone-700/90"),children:l.name}):o.jsx("div",{className:"p-2 text-gray-500 italic text-sm",children:"\u7a7a\u7f3a"})]},e)})}),o.jsx("div",{className:"w-2/3 bg-black/30 rounded-lg p-4 overflow-y-auto border border-stone-700",children:u?o.jsxs("div",{className:"flex flex-col h-full",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-stone-600",children:[o.jsxs("h3",{className:"text-amber-400 font-semibold",children:["\u4e0e ",r?.name," \u4e92\u52a8"]}),o.jsx("button",{onClick:()=>{m(!1),g([]),h("")},className:"text-gray-400 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times"})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto mb-3 space-y-2",children:[0===f.length?o.jsxs("p",{className:"text-center text-gray-500 italic",children:["\u5f00\u59cb\u4e0e",r?.name,"\u4ea4\u6d41..."]}):f.map((e,t)=>o.jsxs("div",{className:"p-2 rounded "+("user"===e.role?"bg-blue-900/30 ml-8":"bg-amber-900/20 mr-8"),children:[o.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"user"===e.role?"\u4f60":r?.name}),o.jsx("div",{className:"text-gray-200 text-sm whitespace-pre-wrap",children:e.content})]},t)),b&&o.jsxs("div",{className:"text-center text-amber-300 animate-pulse",children:[r?.name," \u6b63\u5728\u56de\u5e94..."]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),onKeyPress:e=>"Enter"===e.key&&!b&&v(),disabled:b,placeholder:"\u8f93\u5165\u4f60\u60f3\u8bf4\u7684\u8bdd...",className:"flex-1 bg-stone-800 text-gray-200 px-3 py-2 rounded border border-stone-600 focus:border-amber-500 focus:outline-none disabled:opacity-50"}),o.jsx("button",{onClick:v,disabled:!p.trim()||b,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition-colors",children:b?"\u751f\u6210\u4e2d...":"\u53d1\u9001"})]})]}):o.jsx(o.Fragment,{children:c?o.jsx("div",{className:"text-center text-amber-300 animate-pulse",children:"\u6b63\u5728\u901a\u8fc7\u6c34\u6676\u7aa5\u63a2..."}):l?o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-gray-300 whitespace-pre-wrap font-serif leading-relaxed mb-4",children:l}),r&&o.jsxs("button",{onClick:()=>{m(!0),g([]),h("")},className:"w-full mt-4 px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors flex items-center justify-center gap-2",children:[o.jsx("i",{className:"fa-solid fa-comments"}),o.jsx("span",{children:"\u53c2\u4e0e\u4e92\u52a8"})]})]}):o.jsx("div",{className:"text-center text-gray-500 h-full flex items-center justify-center",children:o.jsx("p",{children:"\u9009\u62e9\u4e00\u540d\u5458\u5de5\u8fdb\u884c\u76d1\u89c6\u3002"})})})})]})]})})},Hs=({isOpen:e,onClose:t,playerProfile:n})=>{const[s,r]=x.useState([]),[a,l]=x.useState(null),[i,c]=x.useState([]),[d,u]=x.useState(""),[m,p]=x.useState(!1);if(x.useEffect(()=>{if(e){const e=n.relationships.filter(e=>"\u719f\u4eba"===e.relationshipStatus);r(e),e.length>0?l(e[0]):l(null),c([]),u("")}},[e,n.relationships]),!e)return null;const h=async()=>{if(d.trim()&&!m&&a){const t={sender:"user",text:d},s=[...i,t];c(s),u(""),p(!0);try{const e=await async function(e,t,n){const s=`\u4f60\u6b63\u5728\u626e\u6f14\u89d2\u8272 ${t.name}\u3002\u8bf7\u4ee5 ${t.name} \u7684\u8eab\u4efd\u548c\u53e3\u543b\uff0c\u7b80\u6d01\u5730\u56de\u590d\u73a9\u5bb6\u3002\u4f60\u7684\u56de\u590d\u5e94\u8be5\u7b26\u5408\u4ed9\u4fa0\u4e16\u754c\u7684\u80cc\u666f\u548c\u4f60\u7684\u89d2\u8272\u8bbe\u5b9a\u3002`,r=n.slice(-5).map(n=>`${"user"===n.sender?e.name:t.name}: ${n.text}`).join("\n"),a=[...n].reverse().find(e=>"user"===e.sender)?.text||"",l=`\n\u5bf9\u8bdd\u5386\u53f2:\n${r}\n\n\u73a9\u5bb6 (${e.name}) \u7684\u6700\u65b0\u6d88\u606f:\n"${a}"\n\n\u73b0\u5728\uff0c\u8bf7\u4ee5 ${t.name} \u7684\u8eab\u4efd\u56de\u590d\u3002\n`;return(await K(s,l)).trim()}(n,a,s);c(t=>[...t,{sender:"ai",text:e}])}catch(e){console.error("\u4f20\u97f3\u5931\u8d25:",e),c(e=>[...e,{sender:"ai",text:"...\u4fe1\u53f7\u4e2d\u65ad..."}])}finally{p(!1)}}};return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border-dialog bg-stone-900/90 backdrop-blur-lg w-full max-w-4xl h-[80vh] rounded-xl shadow-2xl flex",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"w-1/3 border-r-2 border-amber-500/10 flex flex-col bg-black/20",children:[o.jsx("h3",{className:"text-xl font-bold text-amber-200 p-4 border-b-2 border-amber-500/10 text-center font-serif tracking-widest",children:"\u4f20\u97f3\u7389\u7b80"}),o.jsx("ul",{className:"flex-grow overflow-y-auto scrollbar-thin scrollbar-thumb-amber-700/50 scrollbar-track-transparent",children:s.length>0?s.map(e=>o.jsxs("li",{className:"p-4 flex items-center cursor-pointer hover:bg-amber-500/10 transition-colors duration-200 border-b border-amber-500/5 "+(a?.id===e.id?"bg-amber-500/20":""),onClick:()=>l(e),children:[o.jsx("i",{className:"fa-solid fa-user-circle text-2xl mr-4 text-amber-300/70"}),o.jsx("span",{className:"text-lg text-gray-200 font-serif",children:e.name})]},e.id)):o.jsx("li",{className:"p-4 text-center text-gray-500",children:"\u6682\u65e0\u719f\u4eba"})})]}),o.jsx("div",{className:"w-2/3 flex flex-col bg-stone-800/30",children:a?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"p-4 border-b-2 border-amber-500/10 flex justify-between items-center bg-black/20",children:[o.jsx("h3",{className:"text-xl font-bold text-amber-200 font-serif tracking-wider",children:a.name}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-xl"})})]}),o.jsx("div",{className:"flex-grow p-4 overflow-y-auto space-y-4 scrollbar-thin scrollbar-thumb-amber-700/50 scrollbar-track-transparent",children:i.map((e,t)=>o.jsxs("div",{className:"flex items-start gap-3 animate-fade-in-up "+("user"===e.sender?"justify-end":"justify-start"),children:["ai"===e.sender&&o.jsx("i",{className:"fa-solid fa-user-circle text-2xl text-amber-300/70 mt-1"}),o.jsx("div",{className:"max-w-xs lg:max-w-md p-3 rounded-lg font-serif shadow-md "+("user"===e.sender?"bg-blue-900/60 text-white rounded-br-none":"bg-stone-700/60 text-gray-200 rounded-bl-none"),children:e.text}),"user"===e.sender&&o.jsx("i",{className:"fa-solid fa-user-circle text-2xl text-blue-300/70 mt-1"})]},t))}),o.jsx("div",{className:"p-4 border-t-2 border-amber-500/10 bg-black/20",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("input",{type:"text",value:d,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key&&h(),className:"w-full bg-stone-800/80 border border-amber-500/30 rounded-l-md p-3 text-gray-200 focus:outline-none focus:ring-1 focus:ring-amber-400 font-serif",placeholder:m?"\u5bf9\u65b9\u6b63\u5728\u8f93\u5165...":"\u8f93\u5165\u4f20\u97f3\u5185\u5bb9...",disabled:m}),o.jsx("button",{onClick:h,disabled:m||!d.trim(),className:"bg-amber-600 text-white px-5 py-3 rounded-r-md hover:bg-amber-500 transition-colors font-semibold disabled:bg-stone-600 disabled:cursor-not-allowed flex items-center justify-center w-20",children:m?o.jsx("i",{className:"fas fa-spinner fa-pulse"}):o.jsx("i",{className:"fa-solid fa-paper-plane"})})]})})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[o.jsx("i",{className:"fa-solid fa-comments text-4xl mb-4"}),o.jsx("p",{children:"\u8bf7\u5148\u4ece\u5de6\u4fa7\u9009\u62e9\u4e00\u4f4d\u719f\u4eba\u5f00\u59cb\u4f20\u97f3"})]})})]})})},Us=()=>{const e=document;return e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement},Vs=e=>{const[t,n]=x.useState(!!Us()),s=x.useCallback(()=>{n(!!Us())},[]);x.useLayoutEffect(()=>(document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s),document.addEventListener("mozfullscreenchange",s),document.addEventListener("MSFullscreenChange",s),()=>{document.removeEventListener("fullscreenchange",s),document.removeEventListener("webkitfullscreenchange",s),document.removeEventListener("mozfullscreenchange",s),document.removeEventListener("MSFullscreenChange",s)}),[s]);const r=x.useCallback(()=>{t?(()=>{const e=document;e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()})():e.current&&(e=>{const t=e;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()})(e.current)},[t,e]);return{isFullscreen:t,toggleFullscreen:r}},Ws=({playerProfile:e,location:t,onProfileClick:n,appRef:s})=>{const r=_t(),a=(()=>{const[e,t]=x.useState(!1),[n,s]=x.useState(0);return x.useEffect(()=>{const e=()=>{const e=window.scrollY;t(e>n&&e>50),s(e)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[n]),e})(),{isFullscreen:l,toggleFullscreen:i}=Vs(s);return r.shouldHideTopBar&&!l?null:r.isCompact?o.jsxs("header",{className:"fixed top-0 left-0 right-0 h-12 bg-gradient-to-b from-ink-950/95 to-ink-900/80 backdrop-blur-md px-2 flex justify-between items-center z-30 font-serif text-xs transition-transform duration-300 border-b border-gold-600/10 "+(a?"-translate-y-full":"translate-y-0"),children:[o.jsxs("button",{onClick:n,className:"flex items-center gap-2 bg-ink-900/60 px-2 py-1 rounded-lg border border-gold-600/20 hover:border-gold-500/40 hover:bg-ink-800/70 transition-all duration-300 active:scale-95",children:[o.jsx("div",{className:"w-6 h-6 rounded-full bg-ink-800 flex items-center justify-center text-gold-500 text-xs border border-gold-600/30",children:o.jsx("i",{className:"fa-solid fa-user"})}),o.jsx("span",{className:"text-ink-100 font-semibold text-xs",children:e.name})]}),o.jsx("div",{className:"bg-ink-900/60 px-3 py-1 rounded-lg border border-gold-600/20",children:o.jsx("p",{className:"text-ink-100 font-semibold text-xs tracking-wide",children:t})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex items-center gap-1.5 bg-ink-900/60 px-2 py-1 rounded-lg border border-gold-600/20",children:[o.jsx("i",{className:"fa-solid fa-gem text-gold-500 text-sm"}),o.jsx("span",{className:"text-ink-100 font-bold text-xs",children:e.spiritStones})]}),o.jsx("button",{onClick:i,className:"w-8 h-8 flex items-center justify-center bg-ink-900/60 rounded-lg border border-gold-600/20 hover:border-gold-500/40 hover:bg-ink-800/70 transition-all duration-300 active:scale-95",children:o.jsx("i",{className:`fa-solid ${l?"fa-compress":"fa-expand"} text-gold-500 text-sm`})})]})]}):o.jsxs("header",{className:"fixed top-0 left-0 right-0 h-16 bg-gradient-to-b from-ink-950/90 to-transparent backdrop-blur-md p-3 flex justify-between items-center z-30 font-serif text-sm transition-transform duration-300 "+(a?"-translate-y-full":"translate-y-0"),children:[o.jsx("div",{className:"absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gold-500/30 to-transparent"}),o.jsx("div",{className:"flex items-center gap-4 pointer-events-auto",children:o.jsxs("button",{onClick:n,className:"flex items-center gap-3 bg-ink-900/70 p-2 pr-4 rounded-lg border border-gold-600/25 hover:border-gold-500/40 hover:bg-ink-800/80 transition-all duration-300 active:scale-95",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-ink-800 flex items-center justify-center text-gold-500 border border-gold-600/30",children:o.jsx("i",{className:"fa-solid fa-user"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"font-semibold text-ink-100",children:e.name}),o.jsx("p",{className:"text-xs text-gold-500",children:e.title})]})]})}),o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bg-ink-900/70 px-6 py-2 rounded-lg border border-gold-600/25 backdrop-blur-sm",children:o.jsx("p",{className:"text-ink-100 font-semibold whitespace-nowrap tracking-wide",children:t})}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3 bg-ink-900/70 p-2 pl-4 rounded-lg border border-gold-600/25 pointer-events-auto backdrop-blur-sm",children:[o.jsx("i",{className:"fa-solid fa-gem text-gold-500 text-lg"}),o.jsx("span",{className:"text-ink-100 font-bold text-lg",children:e.spiritStones})]}),o.jsx("button",{onClick:i,className:"w-10 h-10 flex items-center justify-center bg-ink-900/70 rounded-lg border border-gold-600/25 hover:border-gold-500/40 hover:bg-ink-800/80 transition-all duration-300 active:scale-95",children:o.jsx("i",{className:`fa-solid ${l?"fa-compress":"fa-expand"} text-gold-500 text-lg`})})]})]})};function Qs(){const e=x.useRef(0);x.useEffect(()=>{if(window.self===window.top)return;const t=()=>{const t=document.documentElement.scrollHeight,n=Math.abs(t-e.current);t>0&&n>=10&&(window.parent.postMessage({type:"set-frame-height",height:t},"*"),e.current=t)},n=((e,t)=>{let n=null;return(...s)=>{n&&clearTimeout(n),n=setTimeout(()=>{e(...s)},t)}})(t,150),s=new ResizeObserver(n),r=document.documentElement;s.observe(r);const a=setTimeout(t,300);return()=>{s.disconnect(),clearTimeout(a)}},[])}const Gs=(e,t,n)=>({...e,quests:e.quests.map(e=>e.id===t?{...e,status:n}:e)}),Js=e=>e.objectives.every(e=>e.isCompleted),Ks=(e,t)=>{const n=e.quests.find(e=>e.id===t);if(!n||"Claimable"!==n.status)return e;let s={...e};return n.rewards.spiritStones&&(s.spiritStones+=n.rewards.spiritStones),n.rewards.reputation&&(s.reputation.score+=n.rewards.reputation),n.rewards.items&&n.rewards.items.length>0&&n.rewards.items.forEach(e=>{"stats"in e?s.equipmentInventory.push({...e,id:`${e.id}_${Date.now()}_${Math.random()}`}):"cost"in e&&s.universalSkills.push(e)}),s=Gs(s,t,"Completed"),s},Ys=(e,t)=>{const n={"\u5a01\u80c1":{low:["\u54fc\uff0c\u4f60\u4ee5\u4e3a\u8fd9\u6837\u5c31\u80fd\u8ba9\u6211\u5c48\u670d\u5417\uff1f","\u6211\u4e0d\u4f1a\u8bf4\u7684\uff0c\u4f60\u4eec\u8fd9\u4e9b\u4eba\u8fdf\u65e9\u4f1a\u906d\u62a5\u5e94\uff01","\u6709\u672c\u4e8b\u5c31\u6740\u4e86\u6211\uff01"],mid:["\u6211...\u6211\u4e0d\u4f1a\u8bf4\u7684...","\u4f60\u60f3\u600e\u6837...","\u522b...\u522b\u8fc7\u6765..."],high:["\u6c42\u6c42\u4f60...\u4e0d\u8981...","\u6211\u8bf4\uff0c\u6211\u4ec0\u4e48\u90fd\u8bf4...","\u9976\u547d\u554a..."]},"\u529d\u8bf4":{low:["\u5c11\u6765\u8fd9\u5957\uff01","\u4f60\u7684\u82b1\u8a00\u5de7\u8bed\u9a97\u4e0d\u4e86\u6211\uff01","\u54fc\uff0c\u865a\u4f2a\uff01"],mid:["\u4f60\u8bf4\u7684...\u6216\u8bb8\u6709\u4e9b\u9053\u7406...","\u6211\u9700\u8981\u65f6\u95f4\u8003\u8651...","\u4f60\u771f\u7684\u80fd\u4fdd\u8bc1\u5417\uff1f"],high:["\u597d...\u6211\u542c\u4f60\u7684...","\u4f60\u8bf4\u5f97\u5bf9...","\u6211\u613f\u610f\u914d\u5408..."]},"\u4ea4\u6613":{low:["\u4f60\u4ee5\u4e3a\u6211\u4f1a\u4e3a\u4e86\u8fd9\u70b9\u597d\u5904\u51fa\u5356\u81ea\u5df1\uff1f","\u514d\u8c08\uff01","\u4f60\u592a\u5c0f\u770b\u6211\u4e86\uff01"],mid:["\u8fd9\u4e2a\u6761\u4ef6...\u8ba9\u6211\u60f3\u60f3...","\u4f60\u80fd\u7ed9\u6211\u4ec0\u4e48\u4fdd\u8bc1\uff1f","\u4e5f\u8bb8\u6211\u4eec\u53ef\u4ee5\u8c08\u8c08..."],high:["\u6210\u4ea4...","\u6211\u63a5\u53d7...","\u53ea\u8981\u4f60\u8bf4\u8bdd\u7b97\u6570..."]},"\u5957\u8bdd":{low:["\u4f60\u60f3\u5957\u6211\u7684\u8bdd\uff1f\u505a\u68a6\uff01","\u6211\u4ec0\u4e48\u90fd\u4e0d\u77e5\u9053\uff01","\u522b\u8d39\u5fc3\u601d\u4e86\uff01"],mid:["\u4f60\u60f3\u77e5\u9053\u4ec0\u4e48\uff1f","\u6211\u4e0d\u592a\u6e05\u695a...","\u8fd9\u4e2a...\u6211\u4e0d\u80fd\u8bf4..."],high:["\u5176\u5b9e...\u6211\u77e5\u9053\u4e00\u4e9b\u4e8b...","\u6211\u544a\u8bc9\u4f60...","\u4f60\u60f3\u77e5\u9053\u7684\u662f..."]},"\u95f2\u804a":{low:["\u6211\u6ca1\u5174\u8da3\u548c\u4f60\u8bf4\u8bdd\uff01","\u6eda\uff01","\u522b\u70e6\u6211\uff01"],mid:["\u96be\u5f97\u6709\u4eba\u613f\u610f\u548c\u6211\u8bf4\u8bdd...","\u5916\u9762\u7684\u4e16\u754c...\u8fd8\u597d\u5417\uff1f","\u4f60\u4e3a\u4ec0\u4e48\u8981\u6765\u8fd9\u91cc\uff1f"],high:["\u8c22\u8c22\u4f60\u613f\u610f\u548c\u6211\u804a\u5929...","\u80fd\u548c\u4f60\u8bf4\u8bf4\u8bdd\u771f\u597d...","\u4f60\u662f\u4e2a\u597d\u4eba..."]},"\u6069\u60e0":{low:["\u6211\u4e0d\u9700\u8981\u4f60\u7684\u65bd\u820d\uff01","\u4f60\u60f3\u6536\u4e70\u6211\uff1f","\u522b\u4ee5\u4e3a\u8fd9\u6837\u6211\u5c31\u4f1a\u611f\u6fc0\u4f60\uff01"],mid:["\u4f60...\u4e3a\u4ec0\u4e48\u8981\u5e2e\u6211\uff1f","\u8c22\u8c22\u4f60...","\u6211\u4e0d\u77e5\u9053\u8be5\u8bf4\u4ec0\u4e48..."],high:["\u592a\u611f\u8c22\u4e86...","\u4f60\u771f\u662f\u592a\u597d\u4e86...","\u6211\u4f1a\u8bb0\u4f4f\u4f60\u7684\u6069\u60c5..."]},"\u7f9e\u8fb1":{low:["\u4f60\uff01\u4f60\u4f1a\u540e\u6094\u7684\uff01","\u6211\u4e0d\u4f1a\u5fd8\u8bb0\u8fd9\u4e00\u5207\u7684\uff01","\u603b\u6709\u4e00\u5929\u6211\u4f1a\u62a5\u4ec7\uff01"],mid:["...","\u4e3a\u4ec0\u4e48...","\u591f\u4e86..."],high:["\u662f...\u6211\u9519\u4e86...","\u8bf7\u539f\u8c05\u6211...","\u6211\u4e0d\u6562\u4e86..."]}},s=n[e]||n["\u95f2\u804a"];let r;return r=t>=70?s.high:t>=40?s.mid:s.low,r[Math.floor(Math.random()*r.length)]},Xs=({favorability:e})=>{const t=(e+100)/200*100,n=e>50?"bg-green-500":e>-50?"bg-yellow-500":"bg-red-500";return o.jsx("div",{className:"w-full bg-stone-700 rounded-full h-2.5",children:o.jsx("div",{className:`${n} h-2.5 rounded-full`,style:{width:`${t}%`}})})},Zs=({isOpen:e,onClose:t,playerProfile:n})=>{const[s,r]=x.useState("\u719f\u4eba");if(!e)return null;const a=n.relationships.filter(e=>e.relationshipStatus===s);return o.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,children:o.jsxs("div",{className:"ornate-border border-xianxia-gold-600 bg-gradient-to-br from-stone-800 via-stone-900 to-stone-950 w-full max-w-2xl h-auto max-h-[80vh] rounded-xl shadow-2xl overflow-hidden backdrop-blur-lg flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center p-4 flex-shrink-0 bg-black/20 border-b border-stone-700/50",children:[o.jsx("h2",{className:"text-2xl font-bold text-gradient-gold text-shadow-glow font-serif",children:"\u4eba\u9645\u5173\u7cfb"}),o.jsx("button",{onClick:t,className:"text-amber-300 hover:text-white transition-colors",children:o.jsx("i",{className:"fa-solid fa-times text-2xl"})})]}),o.jsxs("div",{className:"flex-shrink-0 px-4 flex space-x-2 border-b border-stone-700",children:[o.jsx("button",{onClick:()=>r("\u719f\u4eba"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("\u719f\u4eba"===s?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:"\u719f\u4eba"}),o.jsx("button",{onClick:()=>r("\u964c\u751f\u4eba"),className:"px-4 py-2 text-sm font-semibold rounded-t-lg transition-colors duration-200 "+("\u964c\u751f\u4eba"===s?"bg-stone-700/80 text-amber-400 border-b-2 border-amber-400":"bg-transparent text-gray-400 hover:bg-stone-700/50"),children:"\u964c\u751f\u4eba"})]}),o.jsx("div",{className:"flex-grow overflow-y-auto scrollbar-xianxia p-6 space-y-4",children:a.length>0?a.map(e=>o.jsxs("div",{className:"glass-morphism p-4 rounded-lg border border-stone-700/50 hover:border-xianxia-gold-500/50 transition-all duration-300",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white font-serif",children:e.name}),o.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:e.relationshipTags.map(e=>o.jsx("span",{className:"px-2 py-1 bg-stone-700 text-xs text-gray-300 rounded-full",children:e},e))})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-sm text-gray-400",children:"\u597d\u611f\u5ea6"}),o.jsx("p",{className:"font-mono text-lg text-white",children:e.favorability})]})]}),o.jsx("div",{className:"mt-3",children:o.jsx(Xs,{favorability:e.favorability})}),o.jsxs("p",{className:"text-sm text-gray-300 mt-3 italic",children:['"',e.description,'"']})]},e.id)):o.jsxs("div",{className:"text-center text-gray-500 pt-10",children:[o.jsx("p",{className:"text-4xl mb-4",children:"\ud83c\udf2a\ufe0f"}),o.jsx("p",{children:"\u6b64\u5206\u7c7b\u4e0b\u6682\u65e0\u4eba\u7269\u3002"})]})})]})})},er=()=>{Qs();const e=x.useRef(null),[t,n]=x.useState(st),[s,r]=x.useState(!1),[a,l]=x.useState(!0),[i,c]=x.useState(!1),[d,u]=x.useState(null),[m,p]=x.useState(null),[h,f]=x.useState(!1),[g,b]=x.useState([]),[y,v]=x.useState(null),[j,N]=x.useState(null),[w,k]=x.useState(null),[C,S]=x.useState(!1),[E,P]=x.useState(!1),[$,_]=x.useState(!1),[D,L]=x.useState(!1),[M,A]=x.useState(null),[T,O]=x.useState(null),[R,q]=x.useState(!1),[B,U]=x.useState(!1),[V,W]=x.useState(!1),[Q,G]=x.useState(!1),[Y,X]=x.useState(!1),[Z,ee]=x.useState(!1),[te,ne]=x.useState(!1),[se,re]=x.useState(!1),[ae,le]=x.useState(!1),[ie,oe]=x.useState(!1),[ce,de]=x.useState(null),[me,xe]=x.useState(!1),[pe,he]=x.useState(null),[fe,ge]=x.useState(""),[be,ye]=x.useState([]),[ve,je]=x.useState(!1),[Ne,we]=x.useState(!1),[ke,Ce]=x.useState(null),[Se,Ee]=x.useState(null),[Pe,$e]=x.useState(null),[_e,De]=x.useState(null),[Le,Me]=x.useState(!1),[Ae,Te]=x.useState(!1),[Ie,Oe]=x.useState(null),[ze,Re]=x.useState(!1),[Fe,qe]=x.useState(!1),[Be,He]=x.useState(!1),[Ue,Ve]=x.useState(!1),[We,Ze]=x.useState(!1),[et,tt]=x.useState(!1),[nt,lt]=x.useState(null),[it,ot]=x.useState(""),[ct,xt]=x.useState(!1),[pt,bt]=x.useState(!1),[yt,jt]=x.useState({isOpen:!1,title:"",list:[],onSelect:()=>{}}),Nt=x.useRef(null);x.useEffect(()=>{Bn.setMessageCallback((e,t)=>{const n=e.content.length>30?e.content.substring(0,30)+"...":e.content;Ot(t,`AI\u751f\u6210: ${n}`,e.content,[])});try{Bn.registerEventListeners()}catch(e){console.warn("[App] AI\u6d88\u606f\u6355\u83b7\u670d\u52a1\u521d\u59cb\u5316\u5931\u8d25\uff08\u53ef\u80fd\u4e0d\u5728SillyTavern\u73af\u5883\u4e2d\uff09:",e)}return()=>{Bn.cleanup()}},[]),x.useEffect(()=>{r(!0),t.playerProfile.businessDistrict||n(e=>({...e,playerProfile:{...e.playerProfile,businessDistrict:{name:"\u4e03\u60c5\u516d\u6b32\u574a",level:1,shops:[{id:"shop_brothel_1",type:"\u9752\u697c",level:1,staff:[]}],log:[{timestamp:"\u521d\u59cb",message:'\u4f60\u83b7\u5f97\u4e86"\u4e03\u60c5\u516d\u6b32\u574a"\u7684\u521d\u59cb\u5730\u5951\uff0c\u5e76\u5f00\u8bbe\u4e86\u7b2c\u4e00\u5bb6\u9752\u697c\u3002'}]}}})),t.prisonSystem||n(e=>({...e,prisonSystem:{prisoners:[],guards:[],facilities:[],laborSites:[{id:"mine-01",type:"\u77ff\u5c71",name:"\u9752\u86c7\u77ff\u8109",description:"\u5b97\u95e8\u540e\u5c71\u7684\u7075\u77f3\u77ff\u8109",maxWorkers:2,workers:[]},{id:"herb-01",type:"\u91c7\u836f",name:"\u7075\u836f\u56ed",description:"\u5b97\u95e8\u7684\u836f\u6750\u79cd\u690d\u56ed",maxWorkers:2,workers:[]}],materialInventory:[],laborTasks:[],laborRecords:[],events:[],ransomOffers:[],stats:{totalPrisoners:0,byArea:{"\u5c45\u4f4f\u533a":0,"\u5ba1\u8baf\u533a":0,"\u5a31\u4e50\u533a":0,"\u52b3\u5f79\u533a":0,"\u7ba1\u7406\u533a":0,"\u533b\u7597\u533a":0},byCellType:{"\u666e\u901a\u7262\u623f":0,"\u91cd\u72af\u7262\u623f":0,"\u5355\u72ec\u56da\u5ba4":0},avgSubmission:0,avgLoyalty:0,avgHealth:0,totalGuards:5,escapeAttempts:0,successfulEscapes:0,totalRevenue:0,totalExpenses:0,netProfit:0},config:{maxPrisoners:50,dailyFoodCost:10,securityLevel:5,enableAutoInterrogation:!1,enableAutoLabor:!1}}})),t.memories["\u5927\u7262"]||n(e=>({...e,memories:{...e.memories,"\u5927\u7262":[]},memorySummaries:{...e.memorySummaries,"\u5927\u7262":{small:[],large:[]}}}))},[]),x.useEffect(()=>{const e=()=>{n(e=>{const t=Date.now();let n=!1;const s=e.cultivationPavilion.map(e=>"Breeding"===e.status&&e.endTime>0&&t>=e.endTime?(n=!0,e.slotId,{...e,status:"Ready",monitoringLog:[{timestamp:"\u57f9\u80b2\u5b8c\u6210",message:"\u7075\u80ce\u5df2\u6210\u719f\uff0c\u53ef\u4ee5\u5f00\u542f\u67e5\u770b\u7ed3\u679c\u3002"},...e.monitoringLog]}):e);return n?{...e,cultivationPavilion:s}:e})},t=setInterval(e,1e3);return e(),()=>clearInterval(t)},[]),x.useEffect(()=>{0===t.hospitalPatients.length&&n(e=>({...e,hospitalPatients:[{id:rt.patientId,medicalRecord:rt,status:"\u5f85\u8bca"}]})),0===t.bountyBoard.length&&n(e=>({...e,bountyBoard:[{...at,id:"bounty-example-01",status:"\u60ac\u8d4f\u4e2d"}]}))},[]);const wt=x.useCallback(async(e="all")=>{G(!0);try{const s="all"===e?["sect","adventure","world"]:[e],r={...t.announcements};for(const e of s){const n=e,s=await fn(n,5,t),a={sect:"\u5b97\u95e8",adventure:"\u5947\u9047",world:"\u4e16\u754c"},l=s.map((e,t)=>({...e,id:`${n}-${Date.now()}-${t}`,category:a[n]}));r[n]=l}n(e=>({...e,announcements:r})),Me(!0)}catch(s){console.error("Failed to fetch announcements:",s)}finally{G(!1)}},[t.announcements]);x.useEffect(()=>{"exploration"===t.mode?(Bn.setCurrentScene("exploration"),Nt.current?.scrollIntoView({behavior:"smooth",block:"end"})):"battle"===t.mode&&Bn.setCurrentScene("battle")},[t.mode]),x.useEffect(()=>{pe?Bn.setCurrentScene("consultation"):me?Bn.setCurrentScene("hospital"):ce?Bn.setCurrentScene("surveillance"):ie?Bn.setCurrentScene("business"):Ne?Bn.setCurrentScene("bounty"):Ae?Bn.setCurrentScene("cultivation"):E?Bn.setCurrentScene("map"):D?Bn.setCurrentScene("interaction"):Y?Bn.setCurrentScene("telepathy"):Z?Bn.setCurrentScene("reputation"):V?Bn.setCurrentScene("announcement"):"\u7ade\u6280\u573a"===m?Bn.setCurrentScene("arena"):"\u5546\u57ce"===m?Bn.setCurrentScene("shop"):"exploration"===t.mode&&Bn.setCurrentScene("exploration")},[pe,me,ie,Ne,Ae,E,D,m,t.mode]),x.useEffect(()=>{"exploration"===t.mode&&Nt.current?.scrollIntoView({behavior:"smooth",block:"end"})},[t.exploration.story,t.mode]),x.useEffect(()=>{t.exploration.pendingChallenge&&q(!0)},[t.exploration.pendingChallenge]),x.useEffect(()=>{"battle"===t.mode&&t.battle&&n(e=>{if(!e.battle)return e;const t=e.battle.playerParty.map(t=>{const n=e.playerProfile.cardCollection.find(e=>e.id===t.card.id);if(n){const e=It(n),s=t.calculatedStats.maxHp,r=s>0?Math.min(1,t.currentHp/s):1,a=t.calculatedStats.maxMp,l=a>0?Math.min(1,t.currentMp/a):1;return{...t,card:n,calculatedStats:e,currentHp:Math.max(1,Math.round(e.maxHp*r)),currentMp:Math.round(e.maxMp*l)}}return t});return JSON.stringify(e.battle.playerParty)===JSON.stringify(t)?e:{...e,battle:{...e.battle,playerParty:t}}})},[t.playerProfile.cardCollection,t.mode]);const kt=x.useCallback(async e=>{c(!0),u(null);const s=t.exploration.story;try{const a=await hn(s,e,t.playerProfile,t);let l=`${t.exploration.story}\n\n> ${e}\n\n${a.story}`,i=!1,o=null;const d=t.bountyBoard.filter(e=>"\u60ac\u8d4f\u4e2d"===e.status);for(const e of d)if(e.locationHint.includes(a.location)&&Math.random()<.25){l+=`\n\n**[\u7ea2\u5c18\u5f55]** \u4f60\u4f3c\u4e4e\u5728\u3010${a.location}\u3011\u611f\u53d7\u5230\u4e86\u7279\u6b8a\u7684\u6c14\u606f... \u4e00\u4e2a\u540d\u53f7\u4e3a\u3010${e.name}\u3011\u7684\u60ac\u8d4f\u76ee\u6807\u51fa\u73b0\u4e86\uff01`;const t=It(e.character),n={playerParty:[],opponentParty:[{card:e.character,currentHp:t.maxHp,currentMp:t.maxMp,statusEffects:[],calculatedStats:t,pet:e.character.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`\u906d\u9047\u4e86\u7ea2\u5c18\u5f55\u76ee\u6807\uff1a${e.name}\uff01`],isBattleOver:!1,victory:null};k(n),i=!0;break}if("battle"===a.event?.type&&a.opponentParty){const e={playerParty:[],opponentParty:a.opponentParty.map(e=>({...e,statusEffects:[],pet:e.card.pet})),activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`\u4e0e ${a.event.opponentName} \u7684\u6218\u6597\u5373\u5c06\u5f00\u59cb\uff01`],isBattleOver:!1,victory:null};k(e),i=!0}if(a.pendingChallenge&&a.pendingChallenge.challengerName&&(o=a.pendingChallenge,l+=`\n\n[\u4f60\u6536\u5230\u4e86\u6765\u81ea ${o.challengerName} \u7684\u6311\u6218\uff01]`),n(e=>{let t={...e.playerProfile};if(a.relationshipUpdate&&(t=function(e,t){const n=JSON.parse(JSON.stringify(e)),s=n.relationships.findIndex(e=>e.id===t.characterId);if(-1!==s){const e=n.relationships[s];if(t.status&&(e.relationshipStatus=t.status),t.newTags){const n=new Set([...e.relationshipTags,...t.newTags]);e.relationshipTags=Array.from(n)}}else console.warn(`Relationship with ID ${t.characterId} not found.`);return n}(t,a.relationshipUpdate)),a.newQuest){const e=Date.now(),r=.2;e-(t.lastQuestGenerationTime||0)>=3e5&&Math.random()<r&&(n=t,s=a.newQuest,t=n.quests.some(e=>e.id===s.id)?n:{...n,quests:[...n.quests,s]},t.lastQuestGenerationTime=e,a.newQuest.title)}var n,s;if(a.questUpdate){const{questId:e,objectiveId:n,progress:s}=a.questUpdate,r=t.quests.find(t=>t.id===e),l=r?.objectives.find(e=>e.id===n);if(l){const r=(l.currentCount||0)+s;t=((e,t,n,s)=>({...e,quests:e.quests.map(e=>{if(e.id===t){const t=e.objectives.map(e=>{if(e.id===n){const t=!e.targetCount||s>=e.targetCount;return{...e,currentCount:s,isCompleted:t}}return e});return{...e,objectives:t}}return e})}))(t,e,n,r);const a=t.quests.find(t=>t.id===e);a&&Js(a)&&"In Progress"===a.status&&(t=((e,t)=>{const n=e.quests.find(e=>e.id===t);return n&&Js(n)?Gs(e,t,"Claimable"):e})(t,e),a.title)}}return a.reputationUpdate&&(t.reputation={...t.reputation,score:t.reputation.score+a.reputationUpdate.scoreChange,history:[...t.reputation.history,{id:`rep-${Date.now()}`,timestamp:a.time||e.exploration.time,description:a.reputationUpdate.description,scoreChange:a.reputationUpdate.scoreChange}].slice(-20)}),{...e,playerProfile:t,exploration:{...e.exploration,story:l,location:a.location||e.exploration.location,time:a.time||e.exploration.time,choices:a.choices||[],pendingChallenge:o}}}),i&&!o)return b([]),S(!0),void c(!1);if(Math.random()<.25&&!o&&!i)try{const e=await async function(e,t,n){const s="\u4f60\u662f\u4e00\u4f4d\u4ed9\u4fa0\uff08\u4e2d\u56fd\u4ed9\u5e7b\uff09RPG\u7684\u5927\u5e08\u7ea7\u6545\u4e8b\u8bb2\u8ff0\u8005\u548c\u6e38\u620f\u4e3b\u6301\u4eba\u3002\u4f60\u7684\u4efb\u52a1\u662f\u751f\u6210\u4e00\u4e2a\u968f\u673a\u4e16\u754c\u4e8b\u4ef6\u3002\n1. \u4e8b\u4ef6\u5e94\u8be5\u6709\u8da3\u5e76\u7b26\u5408\u4ed9\u4fa0\u4e3b\u9898\u3002\n2. \u63d0\u4f9b\u4e00\u4e2a\u7b80\u77ed\u3001\u5f15\u4eba\u5165\u80dc\u7684\u6545\u4e8b\u3002\n3. \u521b\u5efa2-3\u4e2a\u6709\u610f\u4e49\u7684\u9009\u62e9\uff0c\u5e76\u6709\u660e\u786e\u7684\u98ce\u9669/\u56de\u62a5\u7ed3\u679c\u3002\n4. \u7ed3\u679c\u5fc5\u987b\u662f\u6307\u5b9a\u7c7b\u578b\u4e4b\u4e00\u3002\n5. \u5982\u679c\u7ed3\u679c\u662f 'reward_item'\uff0c\u4f60\u5fc5\u987b\u4ece\u63d0\u4f9b\u7684\u53ef\u7528\u88c5\u5907\u5217\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u7269\u54c1\u540d\u79f0\u3002\n6. \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002",r=Qe.map(e=>e.name).join(", "),a=`\n    \u73a9\u5bb6\u5f53\u524d\u4f4d\u7f6e: ${e}\n    \u73a9\u5bb6\u59d3\u540d: ${t.name}\n    \u53ef\u4f5c\u4e3a\u5956\u52b1\u7684\u7269\u54c1: ${r}\n\n    \u8bf7\u6839\u636e\u6b64\u80cc\u666f\u751f\u6210\u4e00\u4e2a\u968f\u673a\u4e8b\u4ef6\u3002\n    `;return pn(n?await J({systemInstruction:s,prompt:a,gameState:n}):await K(s,a))}(a.location,t.playerProfile,t);A(e)}catch(r){console.error("Failed to generate random event:",r)}c(!1)}catch(r){console.error(r),u("\u4ed9\u754c\u4f3c\u4e4e\u6709\u4e9b\u4e0d\u7a33\u5b9a\uff0c\u7075\u6c14\u65e0\u6cd5\u6b63\u786e\u54cd\u5e94\u4f60\u7684\u8bf7\u6c42\u3002"),c(!1)}},[t.playerProfile,t.exploration.story]),Ct=x.useCallback(async e=>{if(!t.battle||t.battle.isBattleOver)return void console.warn("[\u6218\u6597] \u6218\u6597\u5df2\u7ed3\u675f\u6216\u4e0d\u5b58\u5728\uff0c\u65e0\u6cd5\u6267\u884c\u884c\u52a8");c(!0),u(null),b([]);const s=t.battle;if(!s.playerParty||!s.opponentParty||s.activePlayerCardIndex>=s.playerParty.length||s.activeOpponentCardIndex>=s.opponentParty.length)return console.error("[\u6218\u6597] \u6218\u6597\u6570\u636e\u65e0\u6548\uff0c\u7d22\u5f15\u8d8a\u754c"),u("\u6218\u6597\u6570\u636e\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u5f00\u59cb\u6218\u6597"),void c(!1);const r=s.playerParty[s.activePlayerCardIndex],a=s.opponentParty[s.activeOpponentCardIndex],l=e=>e.includes("\u5251")||e.includes("\u65a9")?"slash":e.includes("\u706b")||e.includes("\u7130")?"fire":e.includes("\u7597")||e.includes("\u6108")?"heal":e.includes("\u76fe")||e.includes("\u5fa1")?"shield":"default",i=e=>new Promise(t=>setTimeout(t,e));try{const c=await async function(e,t,n,s){const r='\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u4ed9\u4fa0\u4e16\u754c\u8272\u60c5\u6218\u6597\u89e3\u8bf4\u5458\u3002\u4f60\u7684\u4efb\u52a1\u662f\u57fa\u4e8e\u89d2\u8272\u3001\u6280\u80fd\u548c\u88c5\u5907\u7684\u8272\u60c5\u8bbe\u5b9a\uff0c\u751f\u6210\u4e00\u6bb5\u9732\u9aa8\u3001\u8be6\u7ec6\u3001\u7535\u5f71\u822c\u7684\u6218\u6597\u573a\u666f\u63cf\u8ff0\uff0c\u540c\u65f6\u7cbe\u786e\u8ba1\u7b97\u6218\u6597\u7ed3\u679c\u3002\n\n**\u6838\u5fc3\u89c4\u5219\uff1a**\n1.  **\u8272\u60c5\u6218\u6597\u63cf\u8ff0 (ActionDescription)**: \u8fd9\u662f\u4f60\u7684\u9996\u8981\u4efb\u52a1\u3002\u4f60\u5fc5\u987b\u57fa\u4e8e\u5f53\u524d\u884c\u52a8\u8005\u4f7f\u7528\u7684\u6280\u80fd\u7684 \'eroticDescription\' \u8fdb\u884c\u6269\u5c55\u548c\u6da6\u8272\uff0c**\u540c\u65f6\u5fc5\u987b\u5f15\u7528\u5176\u62a4\u7532\u548c\u9970\u54c1\u7684\u5916\u89c2\u63cf\u8ff0**\uff0c\u751f\u6210\u4e00\u6bb5\u8be6\u7ec6\u3001\u9732\u9aa8\u3001\u5145\u6ee1\u60f3\u8c61\u529b\u7684\u8272\u60c5\u6218\u6597\u573a\u666f\u63cf\u8ff0\u3002\n    - **\u88c5\u5907\u878d\u5408\u8981\u6c42**:\n      * \u5982\u679c\u89d2\u8272\u88c5\u5907\u4e86\u62a4\u7532\uff0c\u5fc5\u987b\u5728\u63cf\u8ff0\u4e2d\u4f53\u73b0\u62a4\u7532\u7684\u66b4\u9732\u7a0b\u5ea6\u3001\u6027\u611f\u8bbe\u8ba1\u548c\u5e03\u6599\u6750\u8d28\n      * \u5982\u679c\u89d2\u8272\u88c5\u5907\u4e86\u9970\u54c1\uff0c\u5fc5\u987b\u5728\u63cf\u8ff0\u4e2d\u63d0\u53ca\u9970\u54c1\u5982\u4f55\u589e\u5f3a\u5176\u9b45\u529b\u3001\u95ea\u8000\u5149\u8292\u6216\u4ea7\u751f\u7279\u6b8a\u6548\u679c\n      * \u4e0d\u540c\u62a4\u7532\u548c\u9970\u54c1\u4f1a\u8ba9\u540c\u4e00\u6280\u80fd\u7684\u91ca\u653e\u5448\u73b0\u51fa\u4e0d\u540c\u7684\u89c6\u89c9\u6548\u679c\u548c\u8272\u60c5\u8868\u73b0\n      * \u7279\u522b\u6ce8\u610f\u62a4\u7532\u5728\u6218\u6597\u52a8\u4f5c\u4e2d\u7684\u6643\u52a8\u3001\u79fb\u4f4d\u3001\u7834\u635f\u7b49\u7ec6\u8282\n    - **\u63cf\u8ff0\u8981\u6c42**: \u8fd9\u6bb5\u63cf\u8ff0\u5e94\u8be5\u5177\u4f53\u5230\u8eab\u4f53\u59ff\u6001\u3001\u8868\u60c5\u3001\u4f53\u6db2\u3001\u62a4\u7532\u4e0e\u9970\u54c1\u5982\u4f55\u886c\u6258\u8eab\u4f53\u66f2\u7ebf\u3001\u4ee5\u53ca\u6027\u5668\u5b98\u7684\u4e92\u52a8\u3002\u6b64\u5b57\u6bb5\u7edd\u5bf9\u4e0d\u80fd\u5305\u542b\u4efb\u4f55\u6570\u503c\u3002\n2.  **\u7cbe\u786e\u4f24\u5bb3\u8ba1\u7b97**: \u57fa\u7840\u4f24\u5bb3 = (\u653b\u51fb\u8005\u653b\u51fb\u529b - \u9632\u5fa1\u8005\u9632\u5fa1\u529b)\u3002\u6700\u4f4e\u4f24\u5bb3\u4e3a5\u3002\n3.  **\u72b6\u6001\u4e0e\u4f1a\u5fc3**: \u4e25\u683c\u6309\u7167\u6280\u80fd\u673a\u5236\u3001\u72b6\u6001\u6548\u679c\u548c\u4f1a\u5fc3\u7387\u8ba1\u7b97\u6700\u7ec8\u4f24\u5bb3\u548cHP/MP\u53d8\u5316\u3002\n4.  **\u7b80\u6d01\u6218\u6597\u603b\u7ed3 (TurnSummary)**: \u8fd9\u4e2a\u5b57\u6bb5\u5fc5\u987b\u975e\u5e38\u7b80\u6d01\uff0c\u683c\u5f0f\u5fc5\u987b\u4e3a\uff1a"\u3010\u6280\u80fd\u540d\u3011\u5bf9 \u89d2\u8272\u540d \u9020\u6210\u4e86 X \u70b9\u4f24\u5bb3\u3002" \u6216 "\u3010\u6280\u80fd\u540d\u3011\u4e3a \u89d2\u8272\u540d \u6062\u590d\u4e86 X \u70b9\u6c14\u8840\u3002"\n5.  **AI\u5bf9\u624b\u884c\u52a8**: \u5bf9\u624b\u603b\u662f\u4f7f\u7528\u5176\u4e24\u4e2a\u6280\u80fd\u4e4b\u4e00\u3002\u9009\u62e9\u7b56\u7565\u4e0a\u6700\u5408\u7406\u7684\u4e00\u4e2a\uff0c\u5e76\u540c\u6837\u4e3a\u5176\u751f\u6210\u8272\u60c5\u7684 \'opponentActionDescription\' \u548c\u7b80\u6d01\u7684 \'opponentTurnSummary\'\u3002\n6.  **\u72b6\u6001\u6548\u679c\u751f\u6210**: \u5982\u679c\u6280\u80fd\u9020\u6210\u4e86\u72b6\u6001\u6548\u679c\uff08\u5982\u4e2d\u6bd2\u3001\u707c\u70e7\u3001\u865a\u5f31\u3001\u9b45\u60d1\u7b49\uff09\uff0c\u5fc5\u987b\u5728\u5bf9\u5e94\u7684statusEffects\u6570\u7ec4\u4e2d\u6dfb\u52a0\u5b8c\u6574\u7684\u72b6\u6001\u6548\u679c\u5bf9\u8c61\u3002\n\n**\u72b6\u6001\u6548\u679c\u5bf9\u8c61\u683c\u5f0f\uff08StatusEffect\uff09\uff1a**\n\u6bcf\u4e2a\u72b6\u6001\u6548\u679c\u5bf9\u8c61\u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u5b57\u6bb5\uff1a\n- **name**: \u72b6\u6001\u540d\u79f0\uff08\u5982"\u4e2d\u6bd2"\u3001"\u707c\u70e7"\u3001"\u653b\u51fb\u529b\u63d0\u5347"\u7b49\uff09\n- **description**: \u98ce\u5473\u63cf\u8ff0\uff0850-100\u5b57\uff0c\u63cf\u8ff0\u72b6\u6001\u7684\u8868\u73b0\u548c\u611f\u53d7\uff09\n- **mechanicsDescription**: \u673a\u5236\u8bf4\u660e\uff08\u5fc5\u586b\uff01\u6e05\u6670\u8bf4\u660e\u6570\u503c\u6548\u679c\uff0c\u5982"\u6bcf\u56de\u5408\u635f\u593110\u70b9\u6c14\u8840"\u3001"\u653b\u51fb\u529b\u63d0\u534730%\uff0c\u6301\u7eed3\u56de\u5408"\uff09\n- **duration**: \u6301\u7eed\u56de\u5408\u6570\uff08\u6570\u5b57\uff09\n\n\u793a\u4f8b\uff1a\n```json\n{\n  "name": "\u4e2d\u6bd2",\n  "description": "\u4f53\u5185\u4fb5\u5165\u4e86\u5267\u6bd2\uff0c\u611f\u5230\u9635\u9635\u7729\u6655\u548c\u865a\u5f31\uff0c\u7d2b\u9ed1\u8272\u7684\u6bd2\u7d20\u5728\u8840\u7ba1\u4e2d\u6d41\u6dcc\u3002",\n  "mechanicsDescription": "\u6bcf\u56de\u5408\u5f00\u59cb\u65f6\u635f\u5931\u6700\u5927\u6c14\u8840\u76845%\uff0c\u6301\u7eed3\u56de\u5408",\n  "duration": 3\n}\n```\n\n**\u5fc5\u987b\u8fd4\u56de\u7684JSON\u683c\u5f0f\uff08\u6240\u6709\u5b57\u6bb5\u90fd\u662f\u5fc5\u586b\u7684\uff09\uff1a**\n```json\n{\n  "playerActionDescription": "\u73a9\u5bb6\u6280\u80fd\u7684\u8272\u60c5\u63cf\u8ff0\u6587\u672c\uff08200-400\u5b57\uff09",\n  "opponentActionDescription": "\u5bf9\u624b\u6280\u80fd\u7684\u8272\u60c5\u63cf\u8ff0\u6587\u672c\uff08200-400\u5b57\uff09",\n  "playerTurnSummary": "\u3010\u6280\u80fd\u540d\u3011\u5bf9 \u5bf9\u624b\u540d \u9020\u6210\u4e86 X \u70b9\u4f24\u5bb3",\n  "opponentTurnSummary": "\u3010\u6280\u80fd\u540d\u3011\u5bf9 \u73a9\u5bb6\u540d \u9020\u6210\u4e86 X \u70b9\u4f24\u5bb3",\n  "playerHpChange": -30,\n  "opponentHpChange": -50,\n  "playerMpChange": -20,\n  "opponentMpChange": -15,\n  "playerStatusEffects": [\n    {\n      "name": "\u72b6\u6001\u540d\u79f0",\n      "description": "\u72b6\u6001\u7684\u98ce\u5473\u63cf\u8ff0",\n      "mechanicsDescription": "\u72b6\u6001\u7684\u673a\u5236\u8bf4\u660e\uff08\u5fc5\u586b\uff01\uff09",\n      "duration": 3\n    }\n  ],\n  "opponentStatusEffects": [\n    {\n      "name": "\u72b6\u6001\u540d\u79f0",\n      "description": "\u72b6\u6001\u7684\u98ce\u5473\u63cf\u8ff0",\n      "mechanicsDescription": "\u72b6\u6001\u7684\u673a\u5236\u8bf4\u660e\uff08\u5fc5\u586b\uff01\uff09",\n      "duration": 3\n    }\n  ]\n}\n```\n\n**\u5173\u952e\u8981\u6c42\uff1a**\n- playerStatusEffects \u548c opponentStatusEffects \u5fc5\u987b\u662f\u6570\u7ec4\uff0c\u5373\u4f7f\u4e3a\u7a7a\u4e5f\u8981\u8fd4\u56de []\n- \u5982\u679c\u6709\u72b6\u6001\u6548\u679c\uff0c\u6bcf\u4e2a\u72b6\u6001\u6548\u679c\u5bf9\u8c61\u7684mechanicsDescription\u5b57\u6bb5\u662f**\u5fc5\u586b\u7684**\uff0c\u4e0d\u80fd\u7701\u7565\uff01\n- \u6240\u6709\u6570\u503c\u5b57\u6bb5\u90fd\u5fc5\u987b\u5b58\u5728\uff0c\u5373\u4f7f\u4e3a0\u4e5f\u8981\u660e\u786e\u5199\u51fa\n- TurnSummary \u5fc5\u987b\u5305\u542b\u3010\u6280\u80fd\u540d\u3011\u4ee5\u4fbf\u63d0\u53d6\n- \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002',a=e=>e.card.skills.filter(e=>e).map(e=>({name:e.name,cost:e.cost,mechanics:e.mechanicsDescription,eroticDescription:e.eroticDescription})),l=e=>{const t=e.card.equipment,n=[];return t.armor&&n.push(`\u62a4\u7532\u3010${t.armor.name}\u3011: ${t.armor.description}`),t.accessory1&&n.push(`\u9970\u54c1\u3010${t.accessory1.name}\u3011: ${t.accessory1.description}`),t.accessory2&&n.push(`\u9970\u54c1\u3010${t.accessory2.name}\u3011: ${t.accessory2.description}`),n.length>0?n.join("\n"):"\u65e0\u88c5\u5907"},i=`\n    \u5f53\u524d\u6218\u6597\u4eba\u5458\uff1a\n    - \u73a9\u5bb6\u5361\u724c: ${e.card.name} (\u5883\u754c: ${e.card.realm}, \u653b\u51fb: ${e.calculatedStats.attack}, \u9632\u5fa1: ${e.calculatedStats.defense}, \u5f53\u524d\u6c14\u8840: ${e.currentHp}, \u5f53\u524d\u771f\u5143: ${e.currentMp}, \u5f53\u524d\u72b6\u6001: ${JSON.stringify(e.statusEffects)}, \u6280\u80fd: ${JSON.stringify(a(e))})\n      \u88c5\u5907\u63cf\u8ff0:\n      ${l(e)}\n    \n    - \u5bf9\u624b\u5361\u724c: ${t.card.name} (\u5883\u754c: ${t.card.realm}, \u653b\u51fb: ${t.calculatedStats.attack}, \u9632\u5fa1: ${t.calculatedStats.defense}, \u5f53\u524d\u6c14\u8840: ${t.currentHp}, \u5f53\u524d\u771f\u5143: ${t.currentMp}, \u5f53\u524d\u72b6\u6001: ${JSON.stringify(t.statusEffects)}, \u6280\u80fd: ${JSON.stringify(a(t))})\n      \u88c5\u5907\u63cf\u8ff0:\n      ${l(t)}\n\n    \u73a9\u5bb6\u7684\u884c\u52a8\uff1a\n    "${n}"\n\n    \u8bf7\u7ed3\u7b97\u6b64\u56de\u5408\u3002\u9996\u5148\uff0c\u57fa\u4e8e\u73a9\u5bb6\u4f7f\u7528\u7684\u6280\u80fd\u7684 'eroticDescription' **\u5e76\u878d\u5408\u5176\u62a4\u7532\u548c\u9970\u54c1\u7684\u5916\u89c2\u63cf\u8ff0** \u751f\u6210 'playerActionDescription'\uff0c\u8ba9\u62a4\u7532\u7684\u66b4\u9732\u8bbe\u8ba1\u548c\u9970\u54c1\u7684\u534e\u4e3d\u5916\u89c2\u5728\u6280\u80fd\u91ca\u653e\u4e2d\u4f53\u73b0\u51fa\u6765\u3002\u7136\u540e\uff0c\u51b3\u5b9a\u5bf9\u624b\u7684\u884c\u52a8\uff0c\u540c\u6837\u7ed3\u5408\u5176\u62a4\u7532\u548c\u9970\u54c1\u751f\u6210 'opponentActionDescription' \u5e76\u8ba1\u7b97\u7ed3\u679c\u3002\n    \n    **\u91cd\u8981**: \u5fc5\u987b\u5728\u52a8\u753b\u63cf\u8ff0\u4e2d\u63d0\u53ca\u5e76\u5229\u7528\u62a4\u7532\u548c\u9970\u54c1\u7684\u8272\u60c5\u5916\u89c2\uff0c\u4e0d\u540c\u62a4\u7532\u548c\u9970\u54c1\u5e94\u8be5\u8ba9\u76f8\u540c\u6280\u80fd\u5448\u73b0\u51fa\u4e0d\u540c\u7684\u89c6\u89c9\u6548\u679c\uff01\u7279\u522b\u5173\u6ce8\u62a4\u7532\u5728\u52a8\u4f5c\u4e2d\u7684\u79fb\u52a8\u3001\u900f\u89c6\u3001\u7834\u635f\u6548\u679c\uff01\n    `;return pn(s?await J({systemInstruction:r,prompt:i,gameState:s}):await K(r,i))}(r,a,e,t);if(!c||"object"!=typeof c)throw new Error("AI\u8fd4\u56de\u7ed3\u679c\u65e0\u6548");c.playerStatusEffects&&Array.isArray(c.playerStatusEffects)||(console.warn("[\u6218\u6597] AI\u672a\u8fd4\u56deplayerStatusEffects\uff0c\u4f7f\u7528\u7a7a\u6570\u7ec4"),c.playerStatusEffects=[]),c.opponentStatusEffects&&Array.isArray(c.opponentStatusEffects)||(console.warn("[\u6218\u6597] AI\u672a\u8fd4\u56deopponentStatusEffects\uff0c\u4f7f\u7528\u7a7a\u6570\u7ec4"),c.opponentStatusEffects=[]),c.playerHpChange="number"==typeof c.playerHpChange?c.playerHpChange:0,c.opponentHpChange="number"==typeof c.opponentHpChange?c.opponentHpChange:0,c.playerMpChange="number"==typeof c.playerMpChange?c.playerMpChange:0,c.opponentMpChange="number"==typeof c.opponentMpChange?c.opponentMpChange:0,c.playerActionDescription=c.playerActionDescription||"\u73a9\u5bb6\u4f7f\u7528\u4e86\u6280\u80fd\u8fdb\u884c\u653b\u51fb\u3002",c.opponentActionDescription=c.opponentActionDescription||"\u5bf9\u624b\u8fdb\u884c\u4e86\u53cd\u51fb\u3002",c.playerTurnSummary=c.playerTurnSummary||`\u3010${e.split("_")[0]}\u3011\u5bf9\u5bf9\u624b\u9020\u6210\u4e86\u4f24\u5bb3`,c.opponentTurnSummary=c.opponentTurnSummary||"\u3010\u53cd\u51fb\u3011\u5bf9\u73a9\u5bb6\u9020\u6210\u4e86\u4f24\u5bb3",b([c.playerActionDescription,c.opponentActionDescription]),v({key:Date.now(),effect:l(e),attacker:"player"}),c.opponentHpChange<0&&N("opponent"),await i(2e3);const d=c.opponentTurnSummary?.match(/\[(.*?)\]/)?.[1]||"default";v({key:Date.now()+1,effect:l(d),attacker:"opponent"}),N(null),c.playerHpChange<0&&N("player"),await i(1500);const u=r.currentHp+c.playerHpChange,m=a.currentHp+c.opponentHpChange,x=r.currentMp+c.playerMpChange,p=a.currentMp+c.opponentMpChange,h=[...s.combatLog,`> ${c.playerTurnSummary}`,`> ${c.opponentTurnSummary}`],f=u<=0,g=m<=0;let y=s.activePlayerCardIndex,j=s.activeOpponentCardIndex,w=!1,k=null;if(g&&(h.push(`${a.card.name} \u5df2\u88ab\u51fb\u8d25\uff01`),s.activeOpponentCardIndex+1>=s.opponentParty.length?(w=!0,k=!0,h.push("\u4f60\u83b7\u5f97\u4e86\u80dc\u5229\uff01")):(j++,h.push(`\u5bf9\u624b\u6d3e\u51fa\u4e86 ${s.opponentParty[j].card.name}\uff01`))),f&&(h.push(`${r.card.name} \u5df2\u88ab\u51fb\u8d25\uff01`),s.activePlayerCardIndex+1>=s.playerParty.length?(w=!0,k=!1,h.push("\u4f60\u88ab\u51fb\u8d25\u4e86\uff01")):(y++,h.push(`\u4f60\u6d3e\u51fa\u4e86 ${s.playerParty[y].card.name}\uff01`))),n(e=>{if(!e.battle)return e;const t=[...e.battle.playerParty],n=t[e.battle.activePlayerCardIndex],s=[...n.statusEffects.map(e=>({...e,duration:e.duration-1})).filter(e=>e.duration>0),...c.playerStatusEffects];t[e.battle.activePlayerCardIndex]={...n,currentHp:Math.max(0,u),currentMp:Math.max(0,x),statusEffects:s};const r=[...e.battle.opponentParty],a=r[e.battle.activeOpponentCardIndex],l=[...a.statusEffects.map(e=>({...e,duration:e.duration-1})).filter(e=>e.duration>0),...c.opponentStatusEffects];return r[e.battle.activeOpponentCardIndex]={...a,currentHp:Math.max(0,m),currentMp:Math.max(0,p),statusEffects:l},{...e,battle:{...e.battle,playerParty:t,opponentParty:r,combatLog:h,activePlayerCardIndex:y,activeOpponentCardIndex:j,isBattleOver:w,victory:k}}}),w)try{const e=h.slice(-10).join("\n");Ot("\u6218\u6597",k?"\u6218\u6597\u80dc\u5229":"\u6218\u6597\u5931\u8d25",e,[r.card.name,a.card.name])}catch(o){console.error("[\u6218\u6597] \u4fdd\u5b58\u6218\u6597\u8bb0\u5fc6\u5931\u8d25:",o)}N(null)}catch(d){console.error("[\u6218\u6597] \u5904\u7406\u6218\u6597\u56de\u5408\u65f6\u51fa\u9519:",d),u("\u4e00\u80a1\u795e\u79d8\u7684\u529b\u91cf\u6270\u4e71\u4e86\u6218\u573a\u3002\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002"),d instanceof Error&&console.error("[\u6218\u6597] \u9519\u8bef\u8be6\u60c5:",d.message,d.stack);try{Bn.captureMessage(`\u6218\u6597\u51fa\u9519: ${d instanceof Error?d.message:"\u672a\u77e5\u9519\u8bef"}`,"battle")}catch(m){console.error("[\u6218\u6597] \u6355\u83b7\u9519\u8bef\u6d88\u606f\u5931\u8d25:",m)}}finally{c(!1)}},[t.battle,t.exploration.time,t.exploration.location]),St=x.useCallback(()=>{if(q(!1),0===t.playerProfile.maleParty.length&&0===t.playerProfile.femaleParty.length)return u("\u961f\u4f0d\u4e2d\u81f3\u5c11\u9700\u8981\u4e00\u540d\u89d2\u8272\u624d\u80fd\u8fdb\u5165\u6218\u6597\uff01"),void setTimeout(()=>u(null),3e3);w?(b([]),S(!0)):(u("\u6218\u6597\u4fe1\u606f\u4e22\u5931\uff0c\u65e0\u6cd5\u5f00\u59cb\u3002"),n(e=>({...e,exploration:{...e.exploration,pendingChallenge:null}})))},[t.playerProfile,w]),Et=x.useCallback(()=>{q(!1);const e=t.exploration.pendingChallenge?.challengerName||"\u5bf9\u65b9";n(t=>({...t,exploration:{...t.exploration,story:t.exploration.story+`\n\n\u4f60\u601d\u8651\u518d\u4e09\uff0c\u51b3\u5b9a\u62d2\u7edd ${e} \u7684\u6311\u6218\u3002`,choices:["\u7ee7\u7eed\u4f60\u7684\u65c5\u7a0b\u3002","\u68c0\u67e5\u4f60\u7684\u72b6\u6001\u3002","\u5bfb\u627e\u4e00\u4e2a\u5b89\u5168\u7684\u5730\u65b9\u4f11\u606f\u3002"],pendingChallenge:null}})),k(null)},[t.exploration.pendingChallenge,t.exploration.story]),_t=e=>{n(t=>({...t,playerProfile:e}))},Dt=x.useCallback((e,s,r)=>{const a=t.prisonSystem.prisoners.find(t=>t.character.id===e),l=t.prisonSystem.laborSites.find(e=>e.id===s);if(!a||!l)return void u("\u627e\u4e0d\u5230\u56da\u72af\u6216\u52b3\u5f79\u5730\u70b9");if(l.workers.length>=l.maxWorkers)return void u(`${l.name}\u7684\u5de5\u4f4d\u5df2\u6ee1\uff08${l.maxWorkers}/${l.maxWorkers}\uff09`);if(a.status.includes("\u52b3\u5f79\u4e2d"))return void u(`${a.character.name}\u5df2\u7ecf\u5728\u52b3\u5f79\u4e2d`);const i=Date.now(),o=i+36e5*r;n(t=>{const n={prisonerId:a.character.id,prisonerName:a.character.name,startTime:i,endTime:o,duration:r,status:"working"};return{...t,prisonSystem:{...t.prisonSystem,laborSites:t.prisonSystem.laborSites.map(e=>e.id===s?{...e,workers:[...e.workers,n]}:e),prisoners:t.prisonSystem.prisoners.map(t=>t.character.id===e?{...t,status:[...t.status.filter(e=>"\u52b3\u5f79\u4e2d"!==e),"\u52b3\u5f79\u4e2d"],location:"\u52b3\u5f79\u533a"}:t)}}}),Ot("\u5927\u7262",`\u52b3\u5f79\u5206\u914d\uff1a${a.character.name}`,`\u5c06\u56da\u72af\u3010${a.character.name}\u3011\u5206\u914d\u5230${l.name}\u8fdb\u884c${r}\u5c0f\u65f6\u7684\u52b3\u5f79\u3002`,[a.character.name])},[t.prisonSystem]),Lt=x.useCallback(async(e,s)=>{const r=t.prisonSystem.laborSites.find(t=>t.id===e),a=r?.workers.find(e=>e.prisonerId===s),l=t.prisonSystem.prisoners.find(e=>e.character.id===s);if(r&&a&&l)if(Date.now()<a.endTime)u("\u52b3\u5f79\u5c1a\u672a\u5b8c\u6210");else{c(!0);try{const i=await async function(e,t,n,s){const r=`\u4f60\u662f\u4e00\u4f4d\u4ed9\u4fa0\u4e16\u754c\u7684\u52b3\u5f79\u76d1\u5de5\uff0c\u8d1f\u8d23\u8bb0\u5f55\u56da\u72af\u7684\u52b3\u5f79\u6210\u679c\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u56da\u72af\u4fe1\u606f\u3001\u52b3\u5f79\u7c7b\u578b\u548c\u6301\u7eed\u65f6\u95f4\uff0c\u751f\u6210\u4e00\u4efd\u8be6\u7ec6\u7684\u52b3\u5f79\u7ed3\u679c\u62a5\u544a\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u7ed3\u6784\u751f\u6210\u52b3\u5f79\u7ed3\u679c\uff0c\u6240\u6709\u5fc5\u586b\u5b57\u6bb5\u90fd\u4e0d\u80fd\u7701\u7565\uff01**\n\n1.  **\u5fc5\u586b\u5b57\u6bb5\uff08\u7f3a\u4e00\u4e0d\u53ef\uff09**:\n    *   **materials**: \u6570\u7ec4\uff0c\u5fc5\u987b\u5305\u542b\u6070\u597d2\u4e2a\u6750\u6599\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u5bf9\u8c61\u5305\u542b\uff1a\n        - **material**: \u5b8c\u6574\u7684\u6750\u6599\u5bf9\u8c61\uff08LaborMaterial\u63a5\u53e3\uff09\n          - **id**: \u683c\u5f0f\u4e3a "material-{timestamp}-{index}"\n          - **name**: \u6750\u6599\u540d\u79f0\uff08\u5fc5\u987b\u7b26\u5408${t}\u7c7b\u578b\uff1a\u77ff\u5c71\u4ea7\u51fa\u77ff\u77f3\uff0c\u91c7\u836f\u4ea7\u51fa\u8349\u836f\uff09\n          - **type**: \u5fc5\u987b\u662f "${"\u77ff\u5c71"===t?"ore":"herb"}"\n          - **rarity**: \u7a00\u6709\u5ea6\uff08\u6839\u636e\u56da\u72af\u5883\u754c\u548c\u52b3\u5f79\u65f6\u957f\u51b3\u5b9a\uff09\n          - **description**: \u6750\u6599\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0850-100\u5b57\uff09\n          - **value**: \u5355\u4e2a\u6750\u6599\u4ef7\u503c\uff08\u7075\u77f3\uff09\uff0c\u6839\u636e\u7a00\u6709\u5ea6\uff1a\u51e1\u54c15-10\uff0c\u826f\u54c110-20\uff0c\u4f18\u54c120-40\uff0c\u73cd\u54c140-80\uff0c\u7edd\u54c180-150\uff0c\u4ed9\u54c1150-300\n        - **quantity**: \u6570\u91cf\uff08\u5fc5\u987b\u572825-50\u4e4b\u95f4\u968f\u673a\uff09\n    *   **story**: AI\u751f\u6210\u7684\u52b3\u5f79\u8fc7\u7a0b\u63cf\u8ff0\uff08150-250\u5b57\uff09\n    *   **experience**: \u56da\u72af\u83b7\u5f97\u7684\u7ecf\u9a8c\u503c\uff08\u6839\u636e\u52b3\u5f79\u65f6\u957f\u548c\u5883\u754c\u8ba1\u7b97\uff0c\u4e00\u822c10-50\uff09\n    *   **healthCost**: \u6d88\u8017\u7684\u5065\u5eb7\u5ea6\uff08\u6839\u636e\u52b3\u5f79\u5f3a\u5ea6\uff0c\u4e00\u822c5-20\uff09\n\n2.  **\u6750\u6599\u751f\u6210\u89c4\u5219**:\n    *   ${"\u77ff\u5c71"===t?'**\u77ff\u77f3\u7c7b\u578b**: \u5fc5\u987b\u751f\u6210\u77ff\u77f3\uff0c\u5982"\u7075\u94c1\u77ff"\u3001"\u8d64\u94dc\u7cbe\u77ff"\u3001"\u7d2b\u91d1\u7389\u77f3"\u3001"\u661f\u9668\u6676\u77f3"\u7b49':'**\u8349\u836f\u7c7b\u578b**: \u5fc5\u987b\u751f\u6210\u8349\u836f\uff0c\u5982"\u7d2b\u829d\u8349"\u3001"\u8840\u83b2\u82b1"\u3001"\u4e5d\u53f6\u7075\u829d"\u3001"\u4e03\u661f\u56de\u9b42\u8349"\u7b49'}\n    *   **\u7a00\u6709\u5ea6\u5206\u914d**:\n        - 60%\u6982\u7387\uff1a\u51e1\u54c1\u6216\u826f\u54c1\n        - 30%\u6982\u7387\uff1a\u4f18\u54c1\u6216\u73cd\u54c1\n        - 10%\u6982\u7387\uff1a\u7edd\u54c1\u6216\u4ee5\u4e0a\n    *   **\u6570\u91cf\u968f\u673a**: \u6bcf\u79cd\u6750\u659925-50\u4e2a\u968f\u673a\uff08\u53ef\u4ee5\u4e0d\u540c\uff09\n    *   **\u540d\u79f0\u552f\u4e00**: \u4e24\u79cd\u6750\u6599\u7684\u540d\u79f0\u5fc5\u987b\u4e0d\u540c\n\n3.  **\u52b3\u5f79\u6545\u4e8b\u521b\u4f5c\u8981\u6c42**:\n    *   **\u57fa\u4e8e\u56da\u72af\u7279\u5f81**: \u5fc5\u987b\u63d0\u53ca\u56da\u72af\u7684\u540d\u5b57\u3001\u6027\u522b\u3001\u5883\u754c\n    *   **\u7b26\u5408\u52b3\u5f79\u7c7b\u578b**: ${"\u77ff\u5c71"===t?"\u63cf\u8ff0\u6316\u77ff\u8fc7\u7a0b\uff0c\u5982\u6316\u6398\u3001\u6572\u51fb\u3001\u642c\u8fd0\u77ff\u77f3\u7b49":"\u63cf\u8ff0\u91c7\u836f\u8fc7\u7a0b\uff0c\u5982\u5bfb\u627e\u3001\u91c7\u6458\u3001\u5904\u7406\u8349\u836f\u7b49"}\n    *   **\u52b3\u5f79\u65f6\u957f**: \u4f53\u73b0${n}\u5c0f\u65f6\u7684\u52b3\u4f5c\u8fc7\u7a0b\n    *   **\u8272\u60c5\u5143\u7d20**: \u53ef\u9002\u5ea6\u52a0\u5165\u56da\u72af\u5728\u52b3\u5f79\u4e2d\u7684\u8eab\u4f53\u72b6\u6001\u3001\u6c57\u6c34\u3001\u75b2\u60eb\u7b49\u63cf\u5199\uff0c\u4f46\u4e0d\u8981\u8fc7\u5ea6\n    *   **\u7ed3\u679c\u5448\u73b0**: \u6700\u540e\u8bf4\u660e\u627e\u5230/\u91c7\u96c6\u5230\u4e86\u54ea\u4e9b\u6750\u6599\n    *   **\u5b57\u6570\u8981\u6c42**: 150-250\u5b57\n\n4.  **\u7ecf\u9a8c\u548c\u5065\u5eb7\u6d88\u8017\u8ba1\u7b97**:\n    *   **experience**: \u57fa\u7840\u503c = duration * 2\uff0c\u6839\u636e\u56da\u72af\u5883\u754c\u8c03\u6574\uff08\u7b51\u57fa\u671f+0\uff0c\u91d1\u4e39\u671f+5\uff0c\u5143\u5a74\u671f+10\uff09\n    *   **healthCost**: \u57fa\u7840\u503c = duration * 1.5\uff0c\u6700\u5c0f5\uff0c\u6700\u592720\n\n5.  **JSON\u683c\u5f0f\u793a\u4f8b**:\n\`\`\`json\n{\n  "materials": [\n    {\n      "material": {\n        "id": "material-temp-1",\n        "name": "\u7d2b\u6676\u7075\u94c1\u77ff",\n        "type": "ore",\n        "rarity": "\u4f18\u54c1",\n        "description": "\u8574\u542b\u6d53\u90c1\u7075\u6c14\u7684\u7d2b\u8272\u94c1\u77ff\uff0c\u53ef\u7528\u4e8e\u953b\u9020\u6cd5\u5668\uff0c\u77ff\u77f3\u8868\u9762\u95ea\u70c1\u7740\u661f\u5149\u822c\u7684\u5fae\u7c92\u3002",\n        "value": 25\n      },\n      "quantity": 37\n    },\n    {\n      "material": {\n        "id": "material-temp-2",\n        "name": "\u8d64\u94dc\u7cbe\u77ff",\n        "type": "ore",\n        "rarity": "\u826f\u54c1",\n        "description": "\u706b\u7ea2\u8272\u7684\u94dc\u77ff\u77f3\uff0c\u8d28\u5730\u575a\u786c\uff0c\u542b\u6709\u5fae\u91cf\u706b\u5c5e\u6027\u7075\u6c14\uff0c\u9002\u5408\u70bc\u5236\u706b\u7cfb\u6cd5\u5b9d\u3002",\n        "value": 15\n      },\n      "quantity": 42\n    }\n  ],\n  "story": "\u56da\u72af${e.character.name}\u88ab\u62bc\u9001\u81f3\u9752\u86c7\u77ff\u8109\u6df1\u5904\uff0c\u5728\u76d1\u5de5\u7684\u770b\u5b88\u4e0b\u5f00\u59cb\u4e86\u957f\u8fbe${n}\u5c0f\u65f6\u7684\u91c7\u77ff\u52b3\u4f5c\u3002\u4ed6\u6325\u52a8\u7740\u6c89\u91cd\u7684\u77ff\u9550\uff0c\u4e00\u6b21\u6b21\u7838\u5411\u575a\u786c\u7684\u5ca9\u58c1\uff0c\u6c57\u6c34\u6d78\u900f\u4e86\u5355\u8584\u7684\u56da\u8863\u3002\u968f\u7740\u65f6\u95f4\u63a8\u79fb\uff0c${"Male"===e.character.gender?"\u4ed6":"\u5979"}\u7684\u53cc\u81c2\u5df2\u7ecf\u9178\u75db\u96be\u5fcd\uff0c\u4f46\u5728\u76d1\u5de5\u7684\u97ad\u5b50\u5a01\u6151\u4e0b\u4e0d\u6562\u505c\u6b47\u3002\u5728\u7b2c\u4e09\u4e2a\u65f6\u8fb0\u65f6\uff0c\u77ff\u9550\u7ec8\u4e8e\u51ff\u5f00\u4e86\u4e00\u5904\u7d2b\u5149\u95ea\u70c1\u7684\u77ff\u8109\uff0c\u5927\u91cf\u7d2b\u6676\u7075\u94c1\u77ff\u66b4\u9732\u51fa\u6765\u3002${"Male"===e.character.gender?"\u4ed6":"\u5979"}\u5f3a\u5fcd\u75b2\u60eb\uff0c\u5c06\u8fd9\u4e9b\u73cd\u8d35\u7684\u77ff\u77f3\u4e00\u4e00\u642c\u8fd0\u81f3\u77ff\u8f66\u3002\u4e34\u8fd1\u6536\u5de5\u65f6\uff0c\u53c8\u5728\u77ff\u6d1e\u4fa7\u58c1\u53d1\u73b0\u4e86\u4e00\u5c0f\u7247\u8d64\u94dc\u7cbe\u77ff\u3002\u867d\u7136\u8eab\u5fc3\u4ff1\u75b2\uff0c\u4f46\u8fd9\u6b21\u52b3\u5f79\u7684\u6536\u83b7\u8fd8\u7b97\u4e0d\u9519\u3002",\n  "experience": 25,\n  "healthCost": 12\n}\n\`\`\`\n\n6.  **\u4e25\u683c\u8981\u6c42**:\n    *   \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 \`\`\`json ... \`\`\` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n    *   \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n    *   materials\u6570\u7ec4\u5fc5\u987b\u6070\u597d\u5305\u542b2\u4e2a\u5143\u7d20\n    *   \u6bcf\u4e2amaterial\u5bf9\u8c61\u5fc5\u987b\u5b8c\u6574\u586b\u5145\u6240\u6709\u5b57\u6bb5\n    *   \u6750\u6599\u7c7b\u578b\u5fc5\u987b\u4e0e\u52b3\u5f79\u4f4d\u7f6e\u7c7b\u578b\u5339\u914d\uff08\u77ff\u5c71\u2192ore\uff0c\u91c7\u836f\u2192herb\uff09`,a=`\n    \u56da\u72af\u4fe1\u606f:\n    - \u59d3\u540d: ${e.character.name}\n    - \u6027\u522b: ${e.character.gender}\n    - \u5883\u754c: ${e.character.realm}\n    - \u7a00\u6709\u5ea6: ${e.character.rarity}\n    - \u79f0\u53f7: ${e.character.title||"\u65e0"}\n    - \u5f53\u524d\u5065\u5eb7\u5ea6: ${e.health}/100\n    - \u5c48\u670d\u5ea6: ${e.submissionLevel}/100\n\n    \u52b3\u5f79\u8be6\u60c5:\n    - \u52b3\u5f79\u7c7b\u578b: ${t}\n    - \u52b3\u5f79\u65f6\u957f: ${n}\u5c0f\u65f6\n\n    \u8bf7\u751f\u6210\u5b8c\u6574\u7684\u52b3\u5f79\u7ed3\u679c\u62a5\u544a\uff0c\u5305\u62ec2\u79cd\u4e0d\u540c\u7684${"\u77ff\u5c71"===t?"\u77ff\u77f3":"\u8349\u836f"}\u6750\u6599\u3001\u52b3\u5f79\u8fc7\u7a0b\u6545\u4e8b\u3001\u7ecf\u9a8c\u548c\u5065\u5eb7\u6d88\u8017\u3002\n    `,l=pn(s?await J({systemInstruction:r,prompt:a,gameState:s}):await K(r,a));if(l.materials&&2===l.materials.length){const e=Date.now();l.materials[0].material.id=`material-${e}-1`,l.materials[1].material.id=`material-${e}-2`}return l}(l,r.type,a.duration,t);n(t=>{const n=t.prisonSystem.laborSites.find(t=>t.id===e),r=n?.workers.filter(e=>e.prisonerId!==s)||[],a=[...t.prisonSystem.materialInventory,...i.materials],l=t.prisonSystem.prisoners.map(e=>e.character.id===s?{...e,status:e.status.filter(e=>"\u52b3\u5f79\u4e2d"!==e),health:Math.max(0,e.health-i.healthCost),location:"\u5c45\u4f4f\u533a"}:e);return{...t,prisonSystem:{...t.prisonSystem,laborSites:t.prisonSystem.laborSites.map(t=>t.id===e?{...t,workers:r}:t),materialInventory:a,prisoners:l}}});const o=i.materials.map(e=>`${e.material.name}(${e.material.rarity}) x${e.quantity}`).join("\u3001");Ot("\u5927\u7262",`\u52b3\u5f79\u5b8c\u6210\uff1a${l.character.name}`,`${l.character.name}\u5b8c\u6210\u4e86\u5728${r.name}\u7684\u52b3\u5f79\u3002\n\n${i.story}\n\n\u83b7\u5f97\u6750\u6599\uff1a${o}\n\u7ecf\u9a8c+${i.experience}\uff0c\u5065\u5eb7-${i.healthCost}`,[l.character.name]),alert(`\u52b3\u5f79\u5b8c\u6210\uff01\n\n${i.story}\n\n\u83b7\u5f97\u6750\u6599\uff1a${o}`)}catch(i){console.error("\u751f\u6210\u52b3\u5f79\u7ed3\u679c\u5931\u8d25:",i),u("\u751f\u6210\u52b3\u5f79\u7ed3\u679c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5")}finally{c(!1)}}else u("\u627e\u4e0d\u5230\u52b3\u5f79\u4fe1\u606f")},[t]),Ot=x.useCallback((e,s,r,a)=>{const l={id:`memory-${Date.now()}-${Math.random()}`,category:e,title:s,content:r,timestamp:t.exploration.time,realTimestamp:Date.now(),location:t.exploration.location,involvedCharacters:a};n(t=>{const s=[l,...t.memories[e]].slice(0,100),r={...t,memories:{...t.memories,[e]:s}};if(t.summarySettings.autoSummaryEnabled){const{smallSummaryInterval:r,largeSummaryInterval:a}=t.summarySettings,l=s.length,i=t.memorySummaries[e].small.length;if(l>0&&l%r===0){const a=Math.max(0,l-r),i=l-1;yn(s.slice(a,i+1),"small",e,t.summarySettings.summaryPrompts.small).then(t=>{n(n=>{const s=[t,...n.memorySummaries[e].small].slice(0,50);return{...n,memorySummaries:{...n.memorySummaries,[e]:{...n.memorySummaries[e],small:s}}}})}).catch(e=>console.error("\u81ea\u52a8\u751f\u6210\u5c0f\u603b\u7ed3\u5931\u8d25:",e))}if(i>0&&i%a===0){yn(t.memorySummaries[e].small.slice(0,a).map(e=>({id:e.id,category:e.category,title:e.title,content:e.content,timestamp:e.timestamp,realTimestamp:e.realTimestamp,location:void 0,involvedCharacters:void 0})),"large",e,t.summarySettings.summaryPrompts.large).then(t=>{n(n=>{const s=[t,...n.memorySummaries[e].large].slice(0,50);return{...n,memorySummaries:{...n.memorySummaries,[e]:{...n.memorySummaries[e],large:s}}}})}).catch(e=>console.error("\u81ea\u52a8\u751f\u6210\u5927\u603b\u7ed3\u5931\u8d25:",e))}}return r})},[t.exploration.time,t.exploration.location]),zt=x.useCallback(e=>{n(t=>({...t,memories:{...t.memories,[e]:[]}}))},[]),Bt=x.useCallback((e,t)=>{n(n=>({...n,memories:{...n.memories,[e]:n.memories[e].filter(e=>e.id!==t)}}))},[]),Ht=x.useCallback((e,t,s)=>{n(n=>({...n,memorySummaries:{...n.memorySummaries,[e]:{...n.memorySummaries[e],[s]:n.memorySummaries[e][s].filter(e=>e.id!==t)}}}))},[]),Ut=x.useCallback(async(e,s,r,a)=>{const l=t.memories[e].slice(s,r+1);if(0!==l.length){c(!0);try{const s="small"===a?t.summarySettings.summaryPrompts.small:t.summarySettings.summaryPrompts.large,r=await yn(l,a,e,s);n(t=>{const n=[r,...t.memorySummaries[e][a]].slice(0,50);return{...t,memorySummaries:{...t.memorySummaries,[e]:{...t.memorySummaries[e],[a]:n}}}})}catch(i){console.error("\u751f\u6210\u603b\u7ed3\u5931\u8d25:",i),u("AI\u751f\u6210\u603b\u7ed3\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}finally{c(!1)}}else u("\u6ca1\u6709\u9009\u62e9\u4efb\u4f55\u8bb0\u5fc6\u8fdb\u884c\u603b\u7ed3\u3002")},[t.memories]),Vt=x.useCallback(e=>{n(t=>({...t,summarySettings:e}))},[]),Wt=x.useCallback(e=>{n(t=>({...t,vectorConfig:e})),H.updateConfig(e),F.updateConfig(e),e.rerankerEnabled},[]),Qt=x.useMemo(()=>{const e=new Map;return t.bountyBoard.forEach(t=>{"\u8ffd\u8e2a\u4e2d"===t.status&&t.trackerId&&e.set(t.trackerId,`\u7ea2\u5c18\u5f55: ${t.name}`)}),t.cultivationPavilion.forEach(t=>{"Breeding"===t.status&&(t.parentA&&e.set(t.parentA.id,"\u80b2\u7075\u8f69: \u57f9\u80b2\u4e2d"),t.parentB&&e.set(t.parentB.id,"\u80b2\u7075\u8f69: \u57f9\u80b2\u4e2d"))}),t.playerProfile.businessDistrict?.shops.forEach(t=>{t.staff.forEach(n=>{const s=Ge[n.positionId]?.name||"\u5de5\u4f5c";e.set(n.characterId,`${t.type}: ${s}`)})}),t.etiquetteSystem?.designer&&e.set(t.etiquetteSystem.designer.characterId,"\u793c\u4eea\u8bbe\u8ba1\u9986: \u8bbe\u8ba1\u5e08"),e},[t.bountyBoard,t.cultivationPavilion,t.playerProfile.businessDistrict,t.etiquetteSystem]),Gt=x.useMemo(()=>new Set(Qt.keys()),[Qt]),Yt=()=>{l(!1),r(!0)},Xt=async e=>{const t=await dt.loadFromSlot(e);t?(n(t),l(!1),r(!0)):alert("\u52a0\u8f7d\u5b58\u6863\u5931\u8d25\uff0c\u5b58\u6863\u53ef\u80fd\u5df2\u635f\u574f\u3002")};return a?o.jsx(ut,{onStartNewGame:Yt,onLoadGame:Xt}):o.jsxs("div",{ref:e,className:"flex flex-col font-serif min-h-screen overflow-x-hidden relative w-full",style:{backgroundImage:"url('https://github.com/zzq0219/sillytavern/blob/main/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E4%BA%91%E9%9B%BE-%E4%BB%99%E4%BE%A0.png?raw=true')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"undefined"!=typeof window&&window.innerWidth>768?"fixed":"scroll"},children:[o.jsx(Ws,{playerProfile:t.playerProfile,location:t.exploration.location,onProfileClick:()=>_(!0),appRef:e}),Le&&o.jsx(ft,{announcements:[...t.announcements.world,...t.announcements.adventure,...t.announcements.sect],onClick:()=>W(!0)}),o.jsx("main",{className:"flex-grow flex flex-col items-center w-full pt-12 md:pt-16 pb-20 md:pb-28 px-2 sm:px-4",children:(()=>{if("exploration"===t.mode)return o.jsx(qs,{story:t.exploration.story,storyEndRef:Nt});if("battle"===t.mode&&t.battle){const e=t.battle;if(!e.playerParty||!e.opponentParty||0===e.playerParty.length||0===e.opponentParty.length||e.activePlayerCardIndex>=e.playerParty.length||e.activeOpponentCardIndex>=e.opponentParty.length)return console.error("[\u6e32\u67d3] \u6218\u6597\u6570\u636e\u65e0\u6548\uff0c\u8fd4\u56de\u7a7a\u89c6\u56fe",{playerPartyLength:e.playerParty?.length,opponentPartyLength:e.opponentParty?.length,activePlayerIndex:e.activePlayerCardIndex,activeOpponentIndex:e.activeOpponentCardIndex}),o.jsx("div",{className:"flex-1 flex items-center justify-center",children:o.jsxs("div",{className:"text-center text-red-400 bg-black/60 p-8 rounded-lg",children:[o.jsx("p",{className:"text-2xl mb-4",children:"\u26a0\ufe0f \u6218\u6597\u6570\u636e\u5f02\u5e38"}),o.jsx("p",{className:"mb-4",children:"\u6218\u6597\u72b6\u6001\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u8fd4\u56de\u63a2\u7d22\u6a21\u5f0f"}),o.jsx("button",{onClick:()=>{n(e=>({...e,mode:"exploration",battle:void 0}))},className:"bg-amber-600 px-6 py-2 rounded hover:bg-amber-500",children:"\u8fd4\u56de\u63a2\u7d22"})]})});const s=e.playerParty[e.activePlayerCardIndex],r=e.opponentParty[e.activeOpponentCardIndex];return o.jsxs("div",{className:"w-full h-full flex flex-col",children:[o.jsx("div",{className:"flex-grow",children:o.jsx(Pt,{player:s,opponent:r,animation:y,lastHit:j})}),o.jsx("div",{className:"flex-shrink-0 h-48 p-4",children:o.jsx(mt,{descriptions:g,isLoading:i,isPlayerTurn:"player"===e.turn})})]})}return null})()}),"battle"===t.mode&&t.battle&&!t.battle.isBattleOver&&o.jsx("div",{className:"flex-shrink-0",children:o.jsx(vt,{battleState:t.battle,isLoading:i,onCombatAction:Ct,onFlee:()=>{if(t.battle&&(n(e=>e.battle?{...e,battle:{...e.battle,isBattleOver:!0,victory:!1,isFled:!0}}:e),t.battle)){const e=t.battle.opponentParty[0]?.card;e&&Ot("\u6218\u6597","\u9003\u79bb\u6218\u6597",`\u9762\u5bf9\u3010${e.name}\u3011\uff0c\u4f60\u9009\u62e9\u4e86\u907f\u5176\u950b\u8292\uff0c\u6210\u529f\u9003\u79bb\u4e86\u6218\u6597\u3002`,[e.name])}},onOpenCombatLog:()=>f(!0)})}),"battle"===t.mode&&t.battle?.isBattleOver&&o.jsx($t,{victory:t.battle.victory,isFled:t.battle.isFled,onClose:()=>{if(t.battle?.isArenaBattle)return void(e=>{const s=t.playerProfile.arenaRank,r=e?25:-15,a=Math.max(0,s.points+r),l=(i=a)>=5e3?{tier:"\u738b\u8005",division:"",points:i,tierIcon:"\ud83d\udc51"}:i>=4e3?{tier:"\u94bb\u77f3",division:String(5-Math.floor((i-4e3)/200)),points:i,tierIcon:"\ud83d\udc8e"}:i>=3e3?{tier:"\u767d\u91d1",division:String(5-Math.floor((i-3e3)/200)),points:i,tierIcon:"\ud83d\udee1\ufe0f"}:i>=2e3?{tier:"\u9ec4\u91d1",division:String(5-Math.floor((i-2e3)/200)),points:i,tierIcon:"\ud83c\udf1f"}:i>=1e3?{tier:"\u767d\u94f6",division:String(5-Math.floor((i-1e3)/200)),points:i,tierIcon:"\ud83e\udd48"}:{tier:"\u9ec4\u94dc",division:String(5-Math.floor(i/200)),points:i,tierIcon:"\ud83e\udd49"};var i;if(De({oldRank:s,newRank:l,pointsChange:r,victory:e}),n(e=>{const t={...e.playerProfile,arenaRank:l},n={...e.leaderboards},s=n["\u5b97\u95e8\u6392\u884c\u699c"]["\u603b\u699c"],r=s.findIndex(e=>e.name===t.name);return-1!==r?s[r].points=l.points:(s.length<20||l.points>s[s.length-1].points)&&s.push({rank:0,name:t.name,faction:"\u9752\u86c7\u5b97",points:l.points,characterId:"player"}),s.sort((e,t)=>t.points-e.points).forEach((e,t)=>{e.rank=t+1}),n["\u5b97\u95e8\u6392\u884c\u699c"]["\u603b\u699c"]=s.slice(0,20),{...e,playerProfile:t,leaderboards:n,mode:"exploration",battle:void 0}}),t.battle){const n=t.battle.opponentParty[0]?.card;n&&Ot("\u6218\u6597","\u7ade\u6280\u573a\u5bf9\u6218\uff1a"+(e?"\u80dc\u5229":"\u5931\u8d25"),`\u5728\u7ade\u6280\u573a\u4e0e\u3010${n.name}\u3011\u5c55\u5f00\u4e86\u6fc0\u70c8\u7684\u6218\u6597\uff0c\u6700\u7ec8${e?"\u53d6\u5f97\u4e86\u80dc\u5229":"\u9057\u61be\u843d\u8d25"}\u3002\u6bb5\u4f4d\u79ef\u5206${r>=0?"\u589e\u52a0":"\u51cf\u5c11"}\u4e86${Math.abs(r)}\u70b9\u3002`,[n.name])}})(t.battle.victory??!1);const e=t.battle;if(!e)return void n(e=>({...e,mode:"exploration",battle:void 0}));let s="\n\n \u6218\u6597\u7684\u5c18\u57c3\u843d\u5b9a\u3002",r=[...t.bountyBoard],a=[...t.playerProfile.cardCollection];if(e.victory&&e.opponentParty.length>0){const t=e.opponentParty[0].card,n=r.findIndex(e=>e.character.name===t.name&&"\u60ac\u8d4f\u4e2d"===e.status);if(-1!==n){const e=r[n];r[n]={...e,status:"\u5df2\u5b8c\u6210"},a.some(t=>t.name===e.character.name)||a.push(e.character),s+=`\n\n**[\u7ea2\u5c18\u5f55]** \u76ee\u6807\u3010${e.name}\u3011\u5df2\u88ab\u4f60\u6210\u529f\u72e9\u730e\uff01\u8bf7\u524d\u5f80\u7ea2\u5c18\u5f55\u67e5\u770b\u7ed3\u679c\u3002`}}n(e=>({...e,mode:"exploration",battle:void 0,bountyBoard:r,playerProfile:{...e.playerProfile,cardCollection:a},exploration:{...e.exploration,story:e.exploration.story+s,choices:["\u7ee7\u7eed\u4f60\u7684\u65c5\u7a0b\u3002","\u8c03\u606f\u7597\u4f24\u3002","\u641c\u67e5\u56db\u5468\u3002"]}}))}}),"exploration"===t.mode&&o.jsx(Mt,{gameState:t,isLoading:i,error:d,onExplorationAction:kt,onNavClick:e=>p(e),onMapClick:()=>P(!0),onInteractClick:()=>L(!0),onTelepathyClick:()=>X(!0),onSystemClick:()=>re(!0),onQuestClick:()=>le(!0),onBusinessClick:()=>oe(!0),onHospitalClick:()=>xe(!0),onBountyBoardClick:()=>we(!0),onNextDay:async()=>{if(t.playerProfile.businessDistrict){const s=Rt(t.playerProfile);let r="",a=0;const l=t.exploration.time.match(/\u7b2c(\d+)\u5929/),i=`\u7b2c${(l?parseInt(l[1],10):1)+1}\u5929\uff0c\u6e05\u6668`;if(Math.random()<.3)try{const e=await async function(e,t){const n=e.shops.flatMap(e=>e.staff.map(n=>{const s=t.find(e=>e.id===n.characterId);return{shopType:e.type,characterName:s?.name||"\u672a\u77e5\u5458\u5de5"}}));if(0===n.length)return{message:"\u8857\u533a\u65e0\u4eba\u5f00\u5de5\uff0c\u4e00\u7247\u6b7b\u5bc2\u3002",incomeChange:0};const s=`\n    \u5f53\u524d\u5458\u5de5\u5217\u8868:\n    ${JSON.stringify(n,null,2)}\n\n    \u8bf7\u57fa\u4e8e\u4ee5\u4e0a\u4fe1\u606f\uff0c\u751f\u6210\u4e00\u5219\u4eca\u65e5\u7684\u7ecf\u8425\u4e8b\u4ef6\u3002\n    `,r=await K('\u4f60\u662f"\u4e03\u60c5\u516d\u6b32\u574a"\u5546\u4e1a\u8857\u533a\u7684\u79d8\u5bc6\u8bb0\u5f55\u8005\uff0c\u4e13\u95e8\u8bb0\u5f55\u6bcf\u5929\u53d1\u751f\u7684\u6deb\u8361\u7ecf\u8425\u4e8b\u4ef6\u3002\u4f60\u7684\u63cf\u5199\u5fc5\u987b\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53\u3002\n\n**\u91cd\u8981\uff1a\u4f60\u5fc5\u987b\u4e25\u683c\u6309\u7167\u4ee5\u4e0bJSON\u683c\u5f0f\u8f93\u51fa\uff01**\n\n1.  **\u5fc5\u586b\u5b57\u6bb5**:\n    *   **message**: \u4e8b\u4ef6\u63cf\u8ff0\u6587\u672c\uff0880-150\u5b57\uff09\n    *   **incomeChange**: \u6536\u5165\u53d8\u5316\u6570\u503c\uff08\u6574\u6570\uff0c\u53ef\u6b63\u53ef\u8d1f\uff09\n\n2.  **\u4e8b\u4ef6\u521b\u4f5c\u8981\u6c42**:\n    *   **\u6311\u9009\u5458\u5de5**: \u4ece\u63d0\u4f9b\u7684\u5458\u5de5\u4e2d\u968f\u673a\u9009\u62e91-2\u540d\n    *   **\u7ed3\u5408\u5c97\u4f4d**: \u4e8b\u4ef6\u5fc5\u987b\u4e0e\u5458\u5de5\u7684\u5e97\u94fa\u7c7b\u578b\u76f8\u5173\n    *   **\u8272\u60c5\u5316\u63cf\u8ff0**: \u5fc5\u987b\u5305\u542b\u5177\u4f53\u7684\u6027\u884c\u4e3a\u6216\u6deb\u8361\u7ec6\u8282\n    \n3.  **\u4e8b\u4ef6\u7c7b\u578b\u793a\u4f8b**:\n    \n    **\u6b63\u9762\u4e8b\u4ef6\uff08incomeChange: +20 \u81f3 +50\uff09**:\n    - \u9752\u697c\uff1a"\u82b1\u9b41\u3010\u89d2\u8272\u540d\u3011\u4eca\u591c\u4f8d\u5949\u4e86\u4e00\u4f4d\u5bcc\u5546\uff0c\u5176\u7cbe\u6e5b\u7684\u5e8a\u6280\u8ba9\u5bf9\u65b9\u6b32\u4ed9\u6b32\u6b7b\uff0c\u4e00\u591c\u4e03\u6b21\u4ecd\u4e0d\u77e5\u75b2\u5026\u3002\u5bcc\u5546\u5fc3\u6ee1\u610f\u8db3\uff0c\u6253\u8d4f\u9ec4\u91d1\u767e\u4e24\u3002"\n    - \u89d2\u6597\u573a\uff1a"\u89d2\u6597\u58eb\u3010\u89d2\u8272\u540d\u3011\u5728\u64c2\u53f0\u4e0a\u5c55\u793a\u96c4\u58ee\u8eab\u59ff\uff0c\u5176\u5065\u7855\u7684\u8089\u4f53\u548c\u5de8\u5927\u7684\u9633\u5177\u8ba9\u65e0\u6570\u5973\u4fee\u5c16\u53eb\uff0c\u7eb7\u7eb7\u8c6a\u63b7\u7075\u77f3\u53ea\u4e3a\u4e00\u4eb2\u82b3\u6cfd\u3002"\n    - \u70bc\u4e39\u623f\uff1a"\u70bc\u4e39\u5e08\u3010\u89d2\u8272\u540d\u3011\u4eca\u65e5\u6210\u529f\u70bc\u5236\u51fa\u4e09\u7089\u6625\u836f\uff0c\u836f\u6548\u6781\u4f73\uff0c\u670d\u7528\u8005\u80fd\u6301\u7eed\u4ea4\u5408\u4e09\u5929\u4e09\u591c\u4e0d\u77e5\u75b2\u5026\uff0c\u4f9b\u4e0d\u5e94\u6c42\u3002"\n    \n    **\u8d1f\u9762\u4e8b\u4ef6\uff08incomeChange: -10 \u81f3 -40\uff09**:\n    - \u9752\u697c\uff1a"\u3010\u89d2\u8272\u540d\u3011\u56e0\u6c89\u8ff7\u6b22\u6109\u8fc7\u5ea6\uff0c\u4eca\u65e5\u65e0\u6cd5\u63a5\u5ba2\uff0c\u767d\u767d\u635f\u5931\u4e00\u65e5\u6536\u5165\u3002"\n    - \u89d2\u6597\u573a\uff1a"\u3010\u89d2\u8272\u540d\u3011\u4e0e\u5ba2\u4eba\u91ce\u6218\u65f6\u7528\u529b\u8fc7\u731b\uff0c\u5bfc\u81f4\u5bf9\u65b9\u53d7\u4f24\uff0c\u9700\u8d54\u507f\u533b\u836f\u8d39\u3002"\n    - \u70bc\u4e39\u623f\uff1a"\u3010\u89d2\u8272\u540d\u3011\u5077\u5c1d\u6625\u836f\u540e\u6b32\u706b\u711a\u8eab\uff0c\u5f53\u4f17\u81ea\u6170\u6cc4\u6b32\uff0c\u60ca\u8d70\u4e86\u6570\u4f4d\u5ba2\u4eba\u3002"\n    \n    **\u4e2d\u6027\u4e8b\u4ef6\uff08incomeChange: -5 \u81f3 +5\uff09**:\n    - "\u4eca\u65e5\u3010\u89d2\u8272\u540d\u3011\u5728\u5c97\u4f4d\u4e0a\u8868\u73b0\u5e73\u5e73\uff0c\u65e0\u7279\u6b8a\u4e8b\u4ef6\u53d1\u751f\u3002"\n\n4.  **\u63cf\u5199\u8981\u6c42**:\n    - \u5fc5\u987b\u5177\u4f53\u63d0\u53ca\u5458\u5de5\u59d3\u540d\n    - \u5fc5\u987b\u5305\u542b\u8272\u60c5\u7ec6\u8282\uff08\u8eab\u4f53\u90e8\u4f4d\u3001\u6027\u884c\u4e3a\u3001\u4f53\u6db2\u7b49\uff09\n    - \u8bed\u8a00\u8981\u751f\u52a8\u3001\u9732\u9aa8\u3001\u4e0d\u8981\u542b\u7cca\u5176\u8f9e\n    - \u5b57\u6570\u63a7\u5236\u572880-150\u5b57\n\n5.  **JSON\u683c\u5f0f\u793a\u4f8b**:\n```json\n{\n  "message": "\u82b1\u9b41\u67f3\u5982\u70df\u4eca\u591c\u4f8d\u5949\u4e86\u4e09\u4f4d\u5ba2\u4eba\uff0c\u5176\u6e7f\u6da6\u7d27\u81f4\u7684\u871c\u7a74\u548c\u7cbe\u6e5b\u7684\u5e8a\u6280\u8ba9\u5ba2\u4eba\u4eec\u6b32\u4ed9\u6b32\u6b7b\u3002\u5979\u9a91\u4e58\u5728\u6700\u540e\u4e00\u4f4d\u5ba2\u4eba\u8eab\u4e0a\u75af\u72c2\u6446\u52a8\uff0c\u80a5\u7f8e\u7684\u81c0\u8089\u62cd\u6253\u5f97\u556a\u556a\u4f5c\u54cd\uff0c\u6700\u7ec8\u69a8\u5e72\u4e86\u5bf9\u65b9\u3002\u5ba2\u4eba\u4eec\u6781\u4e3a\u6ee1\u610f\uff0c\u5171\u6253\u8d4f\u7075\u77f3\u4e94\u5341\u5757\u3002",\n  "incomeChange": 45\n}\n```\n\n6.  **\u4e25\u683c\u8981\u6c42**:\n    - \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\n    - \u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\n    - message\u5fc5\u987b\u8272\u60c5\u3001\u9732\u9aa8\u3001\u5177\u4f53',s);try{return pn(r)}catch(d){return console.error("\u89e3\u6790\u7ecf\u8425\u4e8b\u4ef6JSON\u5931\u8d25:",d),{message:"\u4eca\u5929\u98ce\u5e73\u6d6a\u9759\uff0c\u65e0\u4e8b\u53d1\u751f\u3002",incomeChange:0}}}(t.playerProfile.businessDistrict,t.playerProfile.cardCollection);r=e.message,a=e.incomeChange}catch(e){console.error("Failed to generate business event:",e),r="\u4eca\u5929\u98ce\u5e73\u6d6a\u9759\uff0c\u65e0\u4e8b\u53d1\u751f\u3002"}else r="\u4eca\u5929\u98ce\u5e73\u6d6a\u9759\uff0c\u65e0\u4e8b\u53d1\u751f\u3002";const o=s+a;n(e=>{if(!e.playerProfile.businessDistrict)return e;const t=[{timestamp:i,message:`\u7ed3\u7b97\u65e5\uff1a\u603b\u6536\u5165 ${o} \u7075\u77f3\u3002${r}`},...e.playerProfile.businessDistrict.log].slice(0,50);return{...e,exploration:{...e.exploration,time:i},playerProfile:{...e.playerProfile,spiritStones:e.playerProfile.spiritStones+o,businessDistrict:{...e.playerProfile.businessDistrict,log:t}}}}),t.playerProfile.businessDistrict&&(r||o>0)&&Ot("\u5546\u4e1a",`${i}\u7684\u7ecf\u8425\u65e5\u62a5`,`\u603b\u6536\u5165\uff1a${o} \u7075\u77f3\n${r}`)}if(Math.random()<.5)try{const e=await bn();n(t=>({...t,bountyBoard:[...t.bountyBoard,{...e,id:`bounty-${Date.now()}`,status:"\u60ac\u8d4f\u4e2d"}].slice(-10)}))}catch(e){console.error("Failed to generate bounty target:",e)}},onAnnouncementsClick:()=>W(!0),onCultivationClick:()=>Te(!0),onMemoryClick:()=>Re(!0),onCharacterStatusClick:()=>qe(!0),onPrisonClick:()=>Ze(!0),onEtiquetteHallClick:()=>xt(!0),onGauntletClick:()=>bt(!0)}),o.jsx($s,{isOpen:$,onClose:()=>_(!1),playerProfile:t.playerProfile,hasPendingChallenge:!!t.exploration.pendingChallenge,onBattleClick:()=>{t.exploration.pendingChallenge&&(_(!1),q(!0))},onRelationshipsClick:()=>U(!0),onReputationClick:()=>{ee(!0)}}),m&&o.jsx(ks,{activeModal:m,onClose:()=>p(null),playerProfile:t.playerProfile,setPlayerProfile:_t,leaderboards:t.leaderboards,onMatchFound:e=>{const t=It(e),n={playerParty:[],opponentParty:[{card:e,currentHp:t.maxHp,currentMp:t.maxMp,statusEffects:[],calculatedStats:t,pet:e.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`\u4e0e ${e.name} \u7684\u7ade\u6280\u573a\u5bf9\u51b3\u5373\u5c06\u5f00\u59cb\uff01`],isBattleOver:!1,victory:null,isArenaBattle:!0};k(n),p(null),S(!0)},onViewPet:Oe,gameState:t,onLeaderboardsUpdate:e=>{n(t=>({...t,leaderboards:e}))}}),h&&t.battle&&o.jsx(Kt,{log:t.battle.combatLog,onClose:()=>f(!1)}),C&&w&&o.jsx(Ls,{playerProfile:t.playerProfile,opponentName:w.opponentParty[0].card.name,onBattleStart:(e,s)=>{const r=("Male"===e?t.playerProfile.maleParty:t.playerProfile.femaleParty).map(e=>t.playerProfile.cardCollection.find(t=>t.id===e.id)||e),a=Ye.filter(e=>e.gender===s),l=a.length>0?[a[Math.floor(Math.random()*a.length)]]:"Male"===s?[Je]:[Ke],i=w?w.combatLog[0].match(/\u4e0e (.*) \u7684\u6218\u6597/)?.[1]||"\u6311\u6218\u8005":l[0].name,o=w?w.opponentParty:l.map(e=>{const t=It(e);return{card:e,currentHp:t.maxHp,currentMp:t.maxMp,statusEffects:[],calculatedStats:t,pet:e.pet}}),c={playerParty:r.map(e=>{const t=It(e);return{card:e,currentHp:t.maxHp,currentMp:t.maxMp,statusEffects:[],calculatedStats:t,pet:e.pet}}),opponentParty:o,activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"player",combatLog:[`\u4e0e ${i} \u7684\u6218\u6597\u5373\u5c06\u5f00\u59cb\uff01`],isBattleOver:!1,victory:null};n(e=>({...e,mode:"battle",battle:c,exploration:{...e.exploration,pendingChallenge:null}})),k(null),S(!1)},onClose:()=>{S(!1),k(null),n(e=>({...e,exploration:{...e.exploration,pendingChallenge:null}}))}}),E&&o.jsx(mn,{currentLocationName:t.exploration.location,onClose:()=>P(!1),onTravel:e=>{P(!1),kt(`\u524d\u5f80 ${e}\u3002`)}}),D&&o.jsx(nn,{isOpen:D,onClose:()=>L(!1),onInteract:e=>{L(!1),kt(e)},storyContext:t.exploration.story}),M&&o.jsx(zs,{event:M,onChoice:e=>{const{outcome:t}=e;O(t.description);setTimeout(()=>{n(e=>{const n=JSON.parse(JSON.stringify(e.playerProfile));let s=`\n\n[\u5947\u9047] ${t.description}`;switch(t.type){case"reward_stones":n.spiritStones+=t.amount;break;case"lose_stones":n.spiritStones=Math.max(0,n.spiritStones-t.amount);break;case"battle":const e=Ye.filter(e=>"\u4f18\u54c1"===e.rarity||"\u73cd\u54c1"===e.rarity),r={...e[Math.floor(Math.random()*e.length)],id:`rand-${Date.now()}`,name:t.opponentName,origin:t.opponentDescription},a=It(r),l={playerParty:[],opponentParty:[{card:r,currentHp:a.maxHp,currentMp:a.maxMp,statusEffects:[],calculatedStats:a,pet:r.pet}],activePlayerCardIndex:0,activeOpponentCardIndex:0,turn:"pre-battle",combatLog:[`\u906d\u9047\u4e86 ${t.opponentName}\uff01`],isBattleOver:!1,victory:null};k(l),s+=`\n\n\u4f60\u906d\u9047\u4e86 ${t.opponentName}\uff01`;break;case"reward_item":const i=Qe.find(e=>e.name===t.itemName);if(i){const e={...i,id:`${i.id}_${Date.now()}_${Math.random()}`};n.equipmentInventory.push(e)}else s+="\n\u4f46\u5b83\u4f3c\u4e4e\u53ea\u662f\u4e2a\u666e\u901a\u7684\u7269\u4ef6\uff0c\u4f60\u968f\u624b\u4e22\u5f03\u4e86\u3002"}return{...e,playerProfile:n,exploration:{...e.exploration,story:e.exploration.story+s}}}),A(null),O(null),"battle"===t.type&&S(!0),Ot("\u5176\u4ed6",M.title,`${M.story}\n\n\u9009\u62e9\uff1a${e.text}\n\n${t.description}`)},2e3)},resultText:T}),t.exploration.pendingChallenge&&o.jsx(qt,{isOpen:R,onClose:Et,challenge:t.exploration.pendingChallenge,onAccept:St,onDecline:Et}),B&&o.jsx(Zs,{isOpen:B,onClose:()=>U(!1),playerProfile:t.playerProfile}),o.jsx(ht,{isOpen:V,onClose:()=>W(!1),announcements:t.announcements,onRefresh:()=>wt("all"),isLoading:Q}),o.jsx(Hs,{isOpen:Y,onClose:()=>X(!1),playerProfile:t.playerProfile}),o.jsx(Rs,{isOpen:Z,onClose:()=>ee(!1),reputation:t.playerProfile.reputation,isLoading:te,onRefresh:async()=>{ne(!0);try{const e=await async function(e,t){const n="\u4f60\u662f\u4e00\u4e2a\u4ed9\u4fa0\u4e16\u754c\u7684\u5929\u673a\u9601\u8bf4\u4e66\u4eba\uff0c\u8d1f\u8d23\u6839\u636e\u73a9\u5bb6\u7684\u6863\u6848\u548c\u58f0\u671b\uff0c\u603b\u7ed3\u4ed6\u4eec\u7684\u79f0\u53f7\u548c\u5404\u79cd\u4e8b\u8ff9\u3002\n1.  \u9605\u8bfb\u73a9\u5bb6\u7684\u6863\u6848\uff0c\u7279\u522b\u662f\u4ed6\u4eec\u7684\u58f0\u671b\u5206\u6570\u548c\u7b49\u7ea7\u3002\n2.  \u57fa\u4e8e\u4ed6\u4eec\u7684\u58f0\u671b\uff0c\u521b\u9020\u6027\u5730\u751f\u6210 1 \u4e2a\u7b26\u5408\u4ed9\u4fa0\u98ce\u683c\u7684\u6c5f\u6e56\u79f0\u53f7\u3002\n3.  \u57fa\u4e8e\u4ed6\u4eec\u7684\u58f0\u671b\u548c\u6545\u4e8b\u5386\u53f2\uff08\u6458\u8981\uff09\uff0c\u603b\u7ed3\u51fa\u4ed6\u4eec\u505a\u8fc7\u7684\u4e24\u4ef6\u5e7f\u4e3a\u4eba\u77e5\u7684\u597d\u4e8b\u3002\n4.  \u57fa\u4e8e\u4ed6\u4eec\u7684\u58f0\u671b\u548c\u6545\u4e8b\u5386\u53f2\uff08\u6458\u8981\uff09\uff0c\u603b\u7ed3\u51fa\u4ed6\u4eec\u505a\u8fc7\u7684\u4e24\u4ef6\u5e7f\u4e3a\u4eba\u77e5\u7684\u574f\u4e8b\u3002\n5.  \u53d1\u6325\u4f60\u7684\u60f3\u8c61\u529b\uff0c\u675c\u64b0\u4e24\u4ef6\u5173\u4e8e\u8be5\u89d2\u8272\u7684\u98ce\u6d41\u97f5\u4e8b\u6216\u201c\u6700\u8272\u7684\u4e8b\u201d\uff0c\u8981\u5927\u80c6\u3001\u51fa\u683c\u3001\u7b26\u5408\u4ed9\u4fa0\u4e16\u754c\u7684\u98ce\u571f\u4eba\u60c5\u3002\u4f8b\u5982\u201c\u80c1\u8feb\u654c\u5bf9\u5b97\u95e8\u5723\u5973\u5f53\u4f17\u88f8\u4f53\u8df3\u821e\u201d\u6216\u201c\u5728\u7476\u6c60\u5723\u5730\u5077\u770b\u4ed9\u5b50\u6d17\u6fa1\u201d\u3002\n6.  \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\uff0c\u5305\u542b 'title', 'goodDeeds', 'badDeeds', \u548c 'lewdDeeds' \u56db\u4e2a\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u6570\u7ec4\u5305\u542b\u4e24\u4e2a\u5b57\u7b26\u4e32\u3002\u4e0d\u8981\u5728\u4ee3\u7801\u5757\u4e4b\u5916\u6dfb\u52a0\u4efb\u4f55\u89e3\u91ca\u6216\u6ce8\u91ca\u3002",s=`\n    \u73a9\u5bb6\u6863\u6848\uff1a\n    \u59d3\u540d: ${e.name}\n    \u79f0\u53f7: ${e.title}\n    \u58f0\u671b\u7b49\u7ea7: ${e.reputation.level}\n    \u58f0\u671b\u5206\u6570: ${e.reputation.score}\n\n    \u8bf7\u4e3a\u8fd9\u4f4d\u4fee\u58eb\u751f\u6210\u79f0\u53f7\u548c\u5404\u7c7b\u4e8b\u8ff9\u3002\n    `;return pn(t?await J({systemInstruction:n,prompt:s,gameState:t}):await K(n,s))}(t.playerProfile,t);n(t=>({...t,playerProfile:{...t.playerProfile,reputation:{...t.playerProfile.reputation,title:e.title,goodDeeds:e.goodDeeds,badDeeds:e.badDeeds,lewdDeeds:e.lewdDeeds}}}))}catch(e){console.error("Failed to generate reputation details:",e)}finally{ne(!1)}}}),o.jsx(Fs,{isOpen:se,onClose:()=>re(!1),onSave:async(e,n)=>{const s={name:n,timestamp:Date.now(),gameState:t};await dt.saveToSlot(e,s)},onLoad:async e=>{const t=await dt.loadFromSlot(e);t&&n(t),re(!1)},onExport:async e=>{const t=(await dt.getAllSaves())[e];if(!t)return void alert("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u5b58\u6863\uff01");const n=JSON.stringify(t,null,2),s=new Blob([n],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${t.name.replace(/\s/g,"_")}_${new Date(t.timestamp).toISOString()}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},onImport:async e=>{const t=prompt("\u8bf7\u9009\u62e9\u8981\u5bfc\u5165\u5230\u7684\u5b58\u6863\u69fd\u4f4d (1-5):");if(!t)return;const n=parseInt(t,10);if(isNaN(n)||n<1||n>5)alert("\u65e0\u6548\u7684\u69fd\u4f4d\uff01\u8bf7\u8f93\u51651\u52305\u4e4b\u95f4\u7684\u6570\u5b57\u3002");else try{await dt.saveToSlot(n,e),alert(`\u5b58\u6863 "${e.name}" \u5df2\u6210\u529f\u5bfc\u5165\u5230\u69fd\u4f4d ${n}\uff01\u8bf7\u91cd\u65b0\u6253\u5f00\u83dc\u5355\u67e5\u770b\u3002`),re(!1)}catch(s){console.error("\u5bfc\u5165\u5b58\u6863\u65f6\u4fdd\u5b58\u5931\u8d25:",s),alert("\u4fdd\u5b58\u5bfc\u5165\u7684\u5b58\u6863\u65f6\u53d1\u751f\u9519\u8bef\u3002")}},onDelete:async e=>{await dt.deleteSlot(e)},getSaves:dt.getAllSaves}),o.jsx(Os,{isOpen:ae,onClose:()=>le(!1),quests:t.playerProfile.quests,playerProfile:t.playerProfile,onClaimReward:e=>{const s=t.playerProfile.quests.find(t=>t.id===e);if(s&&"Claimable"===s.status){if(n(t=>({...t,playerProfile:Ks(t.playerProfile,e)})),s){const e=[s.rewards.spiritStones?`\u7075\u77f3 +${s.rewards.spiritStones}`:"",s.rewards.reputation?`\u58f0\u671b +${s.rewards.reputation}`:"",s.rewards.items?.map(e=>e.name).join("\u3001")||""].filter(Boolean).join("\uff0c");Ot("\u5176\u4ed6",`\u5b8c\u6210\u4efb\u52a1\uff1a${s.title}`,`${s.description}\n\n\u83b7\u5f97\u5956\u52b1\uff1a${e}`,[])}s.title}}}),_e&&o.jsx(gt,{..._e,onClose:()=>De(null)}),o.jsx(Ft,{isOpen:ie,onClose:()=>oe(!1),playerProfile:t.playerProfile,onUpdateProfile:_t,onOpenSurveillance:e=>de(e),busyCharacterIds:Gt,onOpenSelector:(e,t,n)=>jt({isOpen:!0,title:e,list:t,onSelect:n}),etiquetteSystem:t.etiquetteSystem}),ce&&o.jsx(Bs,{isOpen:!!ce,onClose:()=>de(null),shop:ce,cardCollection:t.playerProfile.cardCollection}),o.jsx(tn,{isOpen:me,onClose:()=>xe(!1),patients:t.hospitalPatients,onStartConsultation:e=>{const s=t.hospitalPatients.find(t=>t.id===e);if(s)if(he(s),s.consultationStory&&s.consultationChoices)ge(s.consultationStory),ye(s.consultationChoices);else{const t=`\u4f60\u5750\u5728\u95ee\u8bca\u5ba4\u5185\uff0c\u9762\u524d\u7684\u75c5\u4eba\u662f\u3010${s.medicalRecord.name}\u3011\u3002\n\n${s.medicalRecord.background}\n\n\u4f60\u6e05\u4e86\u6e05\u55d3\u5b50\uff0c\u51c6\u5907\u5f00\u59cb\u4eca\u5929\u7684\u95ee\u8bca\u3002`;ge(t),ye(["\u8be2\u95ee\u75c5\u75c7\u8be6\u60c5","\u8fdb\u884c\u8eab\u4f53\u68c0\u67e5","\u5b89\u629a\u75c5\u60a3\u60c5\u7eea","\u5f00\u5177\u8bca\u7597\u65b9\u6848"]),n(n=>({...n,hospitalPatients:n.hospitalPatients.map(n=>n.id===e?{...n,status:"\u6cbb\u7597\u4e2d",consultationStory:t,consultationChoices:["\u8be2\u95ee\u75c5\u75c7\u8be6\u60c5","\u8fdb\u884c\u8eab\u4f53\u68c0\u67e5","\u5b89\u629a\u75c5\u60a3\u60c5\u7eea","\u5f00\u5177\u8bca\u7597\u65b9\u6848"]}:n)}))}},onRefresh:async()=>{c(!0);try{const e=(await Promise.all([gn("Female"),gn("Female"),gn("Male"),gn("Male")])).map(e=>({id:e.patientId,medicalRecord:e,status:"\u5f85\u8bca"}));n(t=>{const n=t.hospitalPatients.filter(e=>"\u6cbb\u7597\u4e2d"===e.status);return{...t,hospitalPatients:[...n,...e]}})}catch(e){console.error("Failed to refresh patients:",e),u("\u5237\u65b0\u75c5\u4eba\u5217\u8868\u5931\u8d25\u3002")}finally{c(!1)}},onAddPatient:async e=>{c(!0);try{const t=await gn(e);n(e=>({...e,hospitalPatients:[...e.hospitalPatients,{id:t.patientId,medicalRecord:t,status:"\u5f85\u8bca"}].slice(-10)}))}catch(t){console.error("Failed to add patient:",t),u("\u6dfb\u52a0\u75c5\u4eba\u5931\u8d25\u3002")}finally{c(!1)}},isLoading:i,onViewRecord:e=>{$e(e)},consultationPatient:pe,consultationStory:fe,consultationChoices:be,onConsultationAction:async e=>{if(!pe)return;c(!0);const s=`${fe}\n\n> ${e}`,r=`\u4f60\u6b63\u5728\u4e3a\u3010${pe.medicalRecord.name}\u3011\u8bca\u65ad\u3010${pe.medicalRecord.illnessDescription}\u3011\u3002`;try{const a=await hn(`${r}\n${s}`,e,t.playerProfile,t),l=`${s}\n\n${a.story}`,i=a.choices&&Array.isArray(a.choices)&&a.choices.length>0?a.choices:["\u7ee7\u7eed\u95ee\u8bca","\u68c0\u67e5\u75c5\u60c5","\u5f00\u5177\u5904\u65b9","\u7ed3\u675f\u8bca\u7597"];ge(l),ye(i),n(e=>({...e,hospitalPatients:e.hospitalPatients.map(e=>e.id===pe.id?{...e,consultationStory:l,consultationChoices:i}:e)}))}catch(a){console.error(a),u("AI\u54cd\u5e94\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"),ye(["\u7ee7\u7eed\u95ee\u8bca","\u68c0\u67e5\u75c5\u60c5","\u5f00\u5177\u5904\u65b9","\u7ed3\u675f\u8bca\u7597"])}finally{c(!1)}},onEndConsultation:()=>{pe&&(Ot("\u533b\u9986",`\u4e3a${pe.medicalRecord.name}\u95ee\u8bca`,fe,[pe.medicalRecord.name]),n(e=>({...e,hospitalPatients:e.hospitalPatients.map(e=>e.id===pe.id?{...e,status:"\u5df2\u6cbb\u6108",consultationStory:void 0,consultationChoices:void 0}:e)}))),he(null),ge(""),ye([])},onReturnToList:()=>{he(null),ge(""),ye([])}}),Pe&&o.jsx(xn,{isOpen:!!Pe,onClose:()=>$e(null),record:Pe}),o.jsx(At,{isOpen:Ne,onClose:()=>we(!1),bountyBoard:t.bountyBoard,onViewTarget:e=>Ce(e.character),onAccept:e=>{const s=t.bountyBoard.find(t=>t.id===e);if(!s)return;const r=t.playerProfile.cardCollection.filter(e=>!Gt.has(e.id));jt({isOpen:!0,title:`\u4e3a\u60ac\u8d4f\u3010${s.name}\u3011\u6d3e\u9063\u89d2\u8272`,list:r,onSelect:e=>{((e,s)=>{const r=t.bountyBoard.find(t=>t.id===e);if(!r)return;const a={"\u51e1\u54c1":18e5,"\u826f\u54c1":36e5,"\u4f18\u54c1":72e5,"\u73cd\u54c1":144e5,"\u7edd\u54c1":288e5,"\u4ed9\u54c1":432e5,"\u5723\u54c1":864e5,"\u795e\u54c1":1728e5},l=a[r.character.rarity]||a["\u51e1\u54c1"],i=Date.now(),o=i+l;n(t=>({...t,bountyBoard:t.bountyBoard.map(t=>t.id===e?{...t,status:"\u8ffd\u8e2a\u4e2d",trackerId:s,startTime:i,endTime:o}:t)}))})(s.id,e.id)}})},onClaim:async e=>{const s=t.bountyBoard.find(t=>t.id===e),r=t.playerProfile.cardCollection.find(e=>e.id===s?.trackerId);if(s&&r){c(!0);try{const a=await(async(e,t,n)=>{const s='\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u4ed9\u4fa0\u4e16\u754c\u8272\u60c5\u5c0f\u8bf4\u5bb6\uff0c\u64c5\u957f\u521b\u4f5c\u8be6\u7ec6\u3001\u523a\u6fc0\u3001\u5145\u6ee1\u60f3\u8c61\u529b\u7684\u8ffd\u6355\u6545\u4e8b\u3002\u4f60\u7684\u4efb\u52a1\u662f\u57fa\u4e8e\u8ffd\u6355\u8005\u548c\u76ee\u6807\u7684\u4fe1\u606f\uff0c\u521b\u4f5c\u4e00\u4e2a\u5b8c\u6574\u3001\u8be6\u7ec6\u3001\u8272\u60c5\u3001\u5f15\u4eba\u5165\u80dc\u7684\u8ffd\u6355\u65e5\u5fd7\u3002\n\n**\u6838\u5fc3\u8981\u6c42**:\n\n1.  **\u5b8c\u6574\u7684\u6545\u4e8b\u7ed3\u6784**\uff08\u5fc5\u987b\u5305\u542b\u4ee5\u4e0b\u6240\u6709\u9636\u6bb5\uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u8981\u8be6\u7ec6\u5c55\u5f00\uff09:\n    \n    *   **\u5bfb\u627e\u8ffd\u8e2a\u9636\u6bb5\uff08150-200\u5b57\uff09**:\n        - \u8be6\u7ec6\u63cf\u8ff0\u8ffd\u6355\u8005\u5982\u4f55\u63a5\u53d7\u4efb\u52a1\uff0c\u6536\u96c6\u60c5\u62a5\n        - \u63cf\u5199\u8ffd\u8e2a\u7684\u5168\u8fc7\u7a0b\uff1a\u5728\u54ea\u4e9b\u5730\u65b9\u6253\u542c\u3001\u9047\u5230\u4e86\u4ec0\u4e48\u4eba\u3001\u53d1\u73b0\u4e86\u4ec0\u4e48\u7ebf\u7d22\n        - \u8ffd\u6355\u8005\u7684\u5fc3\u7406\u6d3b\u52a8\u548c\u63a8\u7406\u8fc7\u7a0b\n        - \u878d\u5165\u8ffd\u6355\u8005\u7684\u6280\u80fd\u7279\u70b9\u3001\u8ffd\u8e2a\u624b\u6bb5\n        - \u53ef\u4ee5\u5305\u542b\u4e00\u4e9b\u5c0f\u63d2\u66f2\uff1a\u8bef\u5bfc\u3001\u5047\u7ebf\u7d22\u3001\u610f\u5916\u53d1\u73b0\u7b49\n    \n    *   **\u53d1\u73b0\u4e0e\u8ffd\u9010\u9636\u6bb5\uff08200-250\u5b57\uff09**:\n        - \u8be6\u7ec6\u63cf\u5199\u53d1\u73b0\u76ee\u6807\u7684\u77ac\u95f4\uff1a\u5728\u4ec0\u4e48\u5730\u65b9\u3001\u4ec0\u4e48\u60c5\u51b5\u4e0b\u53d1\u73b0\u7684\n        - \u6fc0\u70c8\u8ffd\u9010\u7684\u5168\u8fc7\u7a0b\uff1a\u7a7f\u8d8a\u4ec0\u4e48\u5730\u5f62\u3001\u65bd\u5c55\u4ec0\u4e48\u8eab\u6cd5\u3001\u5982\u4f55\u8eb2\u907f\u969c\u788d\n        - \u76ee\u6807\u7684\u9003\u8dd1\u7b56\u7565\uff1a\u4f7f\u7528\u4ec0\u4e48\u6280\u80fd\u3001\u8bbe\u7f6e\u4ec0\u4e48\u9677\u9631\u3001\u5982\u4f55\u63a9\u76d6\u8e2a\u8ff9\n        - \u8ffd\u6355\u8005\u7684\u5e94\u5bf9\u65b9\u5f0f\uff1a\u5982\u4f55\u7834\u89e3\u9677\u9631\u3001\u5982\u4f55\u7f29\u77ed\u8ddd\u79bb\n        - \u73af\u5883\u63cf\u5199\u8981\u4e30\u5bcc\uff1a\u57ce\u9547\u8857\u5df7\u3001\u5c71\u6797\u5bc6\u9053\u3001\u6d1e\u5e9c\u79d8\u5883\u3001\u6cb3\u6d41\u6e56\u6cca\u7b49\n        - \u9014\u4e2d\u53ef\u80fd\u9047\u5230\u7684\u610f\u5916\uff1a\u5176\u4ed6\u4fee\u58eb\u3001\u5996\u517d\u3001\u5730\u5f62\u9669\u963b\u7b49\n    \n    *   **\u6218\u6597/\u5bf9\u5cd9\u9636\u6bb5\uff08250-300\u5b57\uff09**:\n        - \u8ffd\u4e0a\u76ee\u6807\u540e\u7684\u6b63\u9762\u5bf9\u5cd9\uff1a\u53cc\u65b9\u5982\u4f55\u6446\u5f00\u67b6\u52bf\u3001\u5982\u4f55\u8bd5\u63a2\n        - \u8be6\u7ec6\u7684\u6218\u6597\u8fc7\u7a0b\uff1a\n          \xb7 \u5177\u4f53\u63cf\u5199\u4f7f\u7528\u4e86\u4ec0\u4e48\u6280\u80fd\uff0c\u5982\u4f55\u65bd\u5c55\n          \xb7 \u8eab\u4f53\u52a8\u4f5c\u7684\u7ec6\u8282\uff1a\u95ea\u907f\u3001\u683c\u6321\u3001\u53cd\u51fb\u3001\u8fd1\u8eab\u640f\u6597\n          \xb7 \u8863\u7269\u5728\u6218\u6597\u4e2d\u7684\u53d8\u5316\uff1a\u7834\u635f\u3001\u51cc\u4e71\u3001\u66b4\u9732\n          \xb7 \u53cc\u65b9\u4f53\u529b\u548c\u771f\u5143\u7684\u6d88\u8017\n        - **\u8272\u60c5\u5316\u6218\u6597\u63cf\u5199**\uff1a\n          \xb7 \u8eab\u4f53\u78b0\u649e\u7684\u7ec6\u8282\uff1a\u808c\u80a4\u76f8\u89e6\u3001\u529b\u91cf\u538b\u5236\u3001\u59ff\u52bf\u53d8\u5316\n          \xb7 \u76ee\u6807\u8eab\u4f53\u7684\u66b4\u9732\u548c\u8ffd\u6355\u8005\u7684\u53cd\u5e94\n          \xb7 \u6218\u6597\u4e2d\u4ea7\u751f\u7684\u66a7\u6627\u573a\u666f\u548c\u60c5\u6b32\u5f20\u529b\n          \xb7 \u6c57\u6c34\u3001\u5598\u606f\u3001\u4f53\u6e29\u3001\u89e6\u611f\u7b49\u611f\u5b98\u7ec6\u8282\n    \n    *   **\u5236\u670d\u8fc7\u7a0b\uff08150-200\u5b57\uff09**:\n        - \u5982\u4f55\u6293\u4f4f\u673a\u4f1a\u6700\u7ec8\u5236\u670d\u76ee\u6807\n        - \u5236\u670d\u7684\u5177\u4f53\u65b9\u5f0f\u8981\u8be6\u7ec6\uff1a\n          \xb7 \u4f7f\u7528\u4ec0\u4e48\u6280\u80fd\u6216\u9053\u5177\uff08\u7ef3\u7d22\u3001\u7b26\u5492\u3001\u6280\u80fd\u63a7\u5236\u7b49\uff09\n          \xb7 \u5982\u4f55\u538b\u5236\u76ee\u6807\u7684\u53cd\u6297\n          \xb7 \u6346\u7ed1\u6216\u63a7\u5236\u7684\u5177\u4f53\u59ff\u52bf\u548c\u624b\u6cd5\n        - **\u5fc5\u987b\u8272\u60c5\u5316\u63cf\u5199**\uff1a\n          \xb7 \u5236\u670d\u65f6\u7684\u8eab\u4f53\u63a5\u89e6\u548c\u59ff\u52bf\n          \xb7 \u76ee\u6807\u7684\u8eab\u4f53\u72b6\u6001\uff1a\u8863\u886b\u51cc\u4e71\u3001\u6c14\u5598\u5401\u5401\u3001\u6c57\u6c34\u6dcb\u6f13\n          \xb7 \u76ee\u6807\u7684\u8868\u60c5\u548c\u53cd\u5e94\uff1a\u6323\u624e\u3001\u547b\u541f\u3001\u4e0d\u7518\u3001\u7f9e\u803b\n          \xb7 \u8ffd\u6355\u8005\u7684\u5fc3\u7406\u548c\u751f\u7406\u53cd\u5e94\n    \n    *   **\u8da3\u4e8b/\u610f\u5916\u4e8b\u4ef6\uff08100-150\u5b57\uff09**:\n        - **\u5fc5\u987b\u5305\u542b**\u8ffd\u6355\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u81f3\u5c111-2\u4ef6\u8da3\u4e8b\u6216\u610f\u5916\n        - \u53ef\u4ee5\u662f\u8272\u8272\u7684\u4e8b\u60c5\uff1a\n          \xb7 \u8bef\u95ef\u67d0\u4e2a\u4fee\u58eb\u7684\u53cc\u4fee\u6d1e\u5e9c\uff0c\u649e\u89c1\u4e0d\u96c5\u573a\u666f\n          \xb7 \u8ffd\u5230\u6e29\u6cc9\u6216\u6d74\u6c60\uff0c\u76ee\u6807\u6b63\u5728\u6c90\u6d74\n          \xb7 \u8863\u7269\u5728\u6218\u6597\u4e2d\u5b8c\u5168\u7834\u635f\u7684\u5c34\u5c2c\n          \xb7 \u4f7f\u7528\u67d0\u4e2a\u6280\u80fd\u5bfc\u81f4\u7684\u610f\u5916\u8eab\u4f53\u63a5\u89e6\n          \xb7 \u88ab\u6625\u836f\u9677\u9631\u6ce2\u53ca\u7684\u573a\u666f\n        - \u53ef\u4ee5\u662f\u9047\u9669\uff1a\n          \xb7 \u906d\u9047\u5996\u517d\u6216\u5176\u4ed6\u4fee\u58eb\u88ad\u51fb\n          \xb7 \u8bef\u5165\u5371\u9669\u7981\u5730\u6216\u673a\u5173\u9677\u9631\n          \xb7 \u6076\u52a3\u5929\u6c14\u6216\u5730\u5f62\u5bfc\u81f4\u7684\u9669\u5883\n        - \u53ef\u4ee5\u662f\u8da3\u4e8b\uff1a\n          \xb7 \u76ee\u6807\u7684\u72e1\u733e\u8ba1\u8c0b\u53cd\u800c\u5bb3\u4e86\u81ea\u5df1\n          \xb7 \u8ffd\u6355\u8005\u7684\u7cd7\u4e8b\u6216\u4e4c\u9f99\n          \xb7 \u5de7\u9047\u65e7\u8bc6\u6216\u5f15\u53d1\u8bef\u4f1a\n\n2.  **\u8272\u60c5\u5316\u6838\u5fc3\u8981\u6c42**\uff08\u8d2f\u7a7f\u5168\u6587\uff09:\n    *   **\u5916\u89c2\u63cf\u5199**: \u8be6\u7ec6\u63cf\u5199\u8ffd\u6355\u8005\u548c\u76ee\u6807\u7684\u8eab\u6750\u3001\u5bb9\u8c8c\u3001\u8eab\u4f53\u7279\u5f81\n    *   **\u8863\u7269\u72b6\u6001**: \u65f6\u523b\u5173\u6ce8\u8863\u7269\u7684\u53d8\u5316 - \u7834\u635f\u3001\u51cc\u4e71\u3001\u66b4\u9732\u7a0b\u5ea6\n    *   **\u8eab\u4f53\u63a5\u89e6**: \u8be6\u7ec6\u63cf\u5199\u6bcf\u4e00\u6b21\u80a2\u4f53\u78b0\u649e\u3001\u6293\u626f\u3001\u538b\u5236\u7684\u7ec6\u8282\n    *   **\u611f\u5b98\u523a\u6fc0**: \u6c57\u6c34\u7684\u5473\u9053\u3001\u5598\u606f\u58f0\u3001\u808c\u80a4\u89e6\u611f\u3001\u4f53\u6e29\u4f20\u9012\n    *   **\u60c5\u6b32\u6c1b\u56f4**: \u4f7f\u7528\u6697\u793a\u6027\u3001\u6311\u9017\u6027\u7684\u8bcd\u8bed\uff0c\u8425\u9020\u66a7\u6627\u5f20\u529b\n    *   **\u5fc3\u7406\u63cf\u5199**: \u8ffd\u6355\u8005\u548c\u76ee\u6807\u7684\u5fc3\u7406\u6d3b\u52a8\uff0c\u5305\u62ec\u60c5\u6b32\u5c42\u9762\u7684\u6ce2\u52a8\n\n3.  **\u89d2\u8272\u7279\u70b9\u6df1\u5ea6\u878d\u5408**:\n    *   \u8ffd\u6355\u8005\u7684\u79f0\u53f7\u3001\u6280\u80fd\u3001\u6027\u683c\u5fc5\u987b\u5728\u884c\u52a8\u4e2d\u81ea\u7136\u4f53\u73b0\n    *   \u76ee\u6807\u7684\u7279\u8d28\u3001\u7f6a\u884c\u3001\u80fd\u529b\u5fc5\u987b\u5728\u9003\u8dd1\u548c\u6218\u6597\u4e2d\u5c55\u73b0\n    *   \u6839\u636e\u6027\u522b\u7ec4\u5408\u8c03\u6574\u63cf\u5199\u91cd\u70b9\uff08\u7537\u8ffd\u5973\u3001\u5973\u8ffd\u7537\u3001\u540c\u6027\u7b49\uff09\n\n4.  **\u5b57\u6570\u8981\u6c42**: **\u603b\u8ba1800-1200\u5b57**\uff0c\u786e\u4fdd\u6545\u4e8b\u4e30\u5bcc\u3001\u5b8c\u6574\u3001\u6709\u753b\u9762\u611f\n\n5.  **\u6587\u7b14\u8981\u6c42**:\n    *   \u8bed\u8a00\u751f\u52a8\u3001\u7ec6\u817b\u3001\u5bcc\u6709\u611f\u67d3\u529b\n    *   \u5584\u7528\u6bd4\u55bb\u3001\u62df\u4eba\u7b49\u4fee\u8f9e\u624b\u6cd5\n    *   \u8282\u594f\u5f20\u5f1b\u6709\u5ea6\uff0c\u6709\u7d27\u5f20\u6709\u8212\u7f13\n    *   \u907f\u514d\u91cd\u590d\u7528\u8bcd\uff0c\u591a\u6837\u5316\u8868\u8fbe\n\n6.  **\u4e25\u683c\u7981\u6b62**:\n    *   \u4e0d\u8981\u53ea\u5199\u7ed3\u679c\uff0c\u5fc5\u987b\u8be6\u7ec6\u63cf\u5199\u8fc7\u7a0b\n    *   \u4e0d\u8981\u542b\u7cca\u5176\u8f9e\u6216\u4f7f\u7528\u7701\u7565\u6027\u63cf\u8ff0\n    *   \u4e0d\u8981\u5ffd\u7565\u4efb\u4f55\u4e00\u4e2a\u6545\u4e8b\u9636\u6bb5\n    *   \u4e0d\u8981\u5c11\u4e8e800\u5b57\u6216\u8d85\u8fc71200\u5b57\n\n7.  **\u76f4\u63a5\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u53ea\u9700\u8981\u4e00\u6bb5\u5b8c\u6574\u7684\u7eaf\u6587\u672c\u6545\u4e8b\uff08\u53ef\u4ee5\u5206\u81ea\u7136\u6bb5\uff09\uff0c\u4e0d\u8981\u5305\u542b\u4efb\u4f55JSON\u683c\u5f0f\u3001\u5927\u6807\u9898\u3001\u7ae0\u8282\u6807\u8bb0\u3001"# "\u7b49markdown\u6807\u8bb0\u6216\u989d\u5916\u89e3\u91ca\u3002',r=`\n        # \u8ffd\u6355\u8005\u4fe1\u606f:\n        - \u59d3\u540d: ${e.name}\n        - \u6027\u522b: ${e.gender}\n        - \u79f0\u53f7: ${e.title||"\u65e0"}\n        - \u5883\u754c: ${e.realm||"\u672a\u77e5"}\n        - \u5916\u89c2: ${e.appearance||"\u5916\u8868\u5e73\u5e73"}\n        - \u6838\u5fc3\u6280\u80fd: ${e.skills.map(e=>e?.name).filter(Boolean).join(", ")||"\u65e0"}\n\n        # \u76ee\u6807\u4fe1\u606f:\n        - \u59d3\u540d: ${t.name}\n        - \u6027\u522b: ${t.gender}\n        - \u79f0\u53f7: ${t.title||"\u65e0"}\n        - \u5883\u754c: ${t.realm||"\u672a\u77e5"}\n        - \u5916\u89c2: ${t.appearance||"\u5916\u8868\u5e73\u5e73"}\n        - \u7279\u6b8a\u4e13\u957f: ${t.origin||"\u65e0"}\n        - \u7f6a\u884c: ${t.title||"\u6deb\u90aa\u4e4b\u5f92"}\n\n        \u8bf7\u521b\u4f5c\u4e00\u4e2a\u5b8c\u6574\u3001\u8be6\u7ec6\u3001\u8272\u60c5\u7684\u8ffd\u6355\u6545\u4e8b\uff0c\u5305\u542b\u4ee5\u4e0b\u6240\u6709\u9636\u6bb5\uff1a\n        \n        **\u5fc5\u987b\u5305\u542b\u76845\u4e2a\u9636\u6bb5\u53ca\u5b57\u6570\u8981\u6c42**:\n        1. **\u5bfb\u627e\u8ffd\u8e2a\u9636\u6bb5\uff08150-200\u5b57\uff09**: \u63a5\u53d7\u4efb\u52a1\u3001\u6536\u96c6\u60c5\u62a5\u3001\u8ffd\u8e2a\u7ebf\u7d22\u7684\u5168\u8fc7\u7a0b\n        2. **\u53d1\u73b0\u4e0e\u8ffd\u9010\u9636\u6bb5\uff08200-250\u5b57\uff09**: \u53d1\u73b0\u76ee\u6807\u3001\u6fc0\u70c8\u8ffd\u9010\u3001\u73af\u5883\u63cf\u5199\u3001\u610f\u5916\u60c5\u51b5\n        3. **\u6218\u6597/\u5bf9\u5cd9\u9636\u6bb5\uff08250-300\u5b57\uff09**: \u6b63\u9762\u5bf9\u5cd9\u3001\u8be6\u7ec6\u6218\u6597\u8fc7\u7a0b\u3001\u8272\u60c5\u5316\u6218\u6597\u63cf\u5199\n        4. **\u5236\u670d\u8fc7\u7a0b\uff08150-200\u5b57\uff09**: \u5982\u4f55\u5236\u670d\u3001\u6346\u7ed1\u63a7\u5236\u3001\u8272\u60c5\u5316\u8eab\u4f53\u63a5\u89e6\u63cf\u5199\n        5. **\u8da3\u4e8b/\u610f\u5916\u4e8b\u4ef6\uff08100-150\u5b57\uff09**: \u5fc5\u987b\u5305\u542b\u81f3\u5c111-2\u4ef6\u8272\u8272\u7684\u4e8b\u60c5\u3001\u9047\u9669\u6216\u8da3\u4e8b\n        \n        **\u603b\u5b57\u6570\u8981\u6c42**: 800-1200\u5b57\n        \n        \u8bb0\u4f4f\uff1a\u6bcf\u4e2a\u9636\u6bb5\u90fd\u5fc5\u987b\u8be6\u7ec6\u5c55\u5f00\uff0c\u4e0d\u8981\u7701\u7565\u4efb\u4f55\u8fc7\u7a0b\uff01\n    `;return(n?await J({systemInstruction:s,prompt:r,gameState:n}):await K(s,r)).trim()})(r,s.character,t),l={...s,trackingLog:a};n(t=>({...t,bountyBoard:t.bountyBoard.map(t=>t.id===e?l:t)})),Ee(l)}catch(a){console.error("\u751f\u6210\u60ac\u8d4f\u65e5\u5fd7\u5931\u8d25:",a),u("\u5929\u673a\u9601\u4f20\u8baf\u5931\u8d25\uff0c\u65e0\u6cd5\u83b7\u53d6\u4efb\u52a1\u62a5\u544a\u3002")}finally{c(!1)}}else u("\u65e0\u6cd5\u627e\u5230\u60ac\u8d4f\u6216\u8ffd\u8e2a\u8005\u4fe1\u606f\u3002")},onRefresh:async()=>{c(!0);try{const e=await Promise.all([bn(),bn(),bn()]);n(t=>({...t,bountyBoard:e.map(e=>({...e,id:`bounty-${Date.now()}-${Math.random()}`,status:"\u60ac\u8d4f\u4e2d"})).slice(-10)}))}catch(e){console.error("Failed to refresh bounty board:",e),u("\u5237\u65b0\u60ac\u8d4f\u699c\u5931\u8d25\u3002")}finally{c(!1)}},onAddTarget:async e=>{c(!0);try{const t=await bn(e);n(e=>({...e,bountyBoard:[...e.bountyBoard,{...t,id:`bounty-${Date.now()}`,status:"\u60ac\u8d4f\u4e2d"}].slice(-10)}))}catch(t){console.error("Failed to add bounty target:",t),u("\u6dfb\u52a0\u60ac\u8d4f\u76ee\u6807\u5931\u8d25\u3002")}finally{c(!1)}},isLoading:i}),ke&&o.jsx(Jt,{card:ke,onClose:()=>Ce(null),playerProfile:t.playerProfile,setPlayerProfile:_t,onViewPet:Oe}),Ie&&o.jsx(_s,{pet:Ie,onClose:()=>Oe(null)}),Se&&o.jsx(Tt,{isOpen:!!Se,onClose:()=>Ee(null),bounty:Se,onOutcome:e=>((e,s)=>{n(n=>{const r=n.bountyBoard.find(t=>t.id===e);if(!r)return n;const a=10*Xe[r.character.rarity],l="imprisoned"===s?20:5;let i=n.prisonSystem;if("imprisoned"===s){const e={character:r.character,crime:`\u7ea2\u5c18\u5f55\u60ac\u8d4f\u76ee\u6807 - ${r.specialTrait}`,sentence:365,remainingDays:365,submissionLevel:0,loyaltyLevel:0,health:70,sanity:80,location:"\u5c45\u4f4f\u533a",cellType:"\u91cd\u72af\u7262\u623f",value:{ransom:5*Xe[r.character.rarity],labor:2*Xe[r.character.rarity],intelligence:3*Xe[r.character.rarity]},status:["\u53d7\u4f24"],history:[{id:`interrogation-${Date.now()}`,date:n.exploration.time,realTimestamp:Date.now(),method:{id:"captured",name:"\u88ab\u6355",category:"basic",description:"\u4ece\u7ea2\u5c18\u5f55\u60ac\u8d4f\u4efb\u52a1\u4e2d\u88ab\u6355\u83b7",damage:30,intimidation:50,successRate:100,submissionIncrease:0,risks:{death:0,permanentInjury:0,insanity:0}},duration:0,result:{success:!0,informationGained:`\u8eab\u4efd\uff1a${r.character.name}\uff0c\u7f6a\u884c\uff1a${r.specialTrait}`,submissionIncrease:0,healthDecrease:30},interrogator:r.trackerId&&t.playerProfile.cardCollection.find(e=>e.id===r.trackerId)?.name||"\u8ffd\u8e2a\u8005"}],knownInformation:[`\u771f\u5b9e\u59d3\u540d\uff1a${r.character.name}`,`\u5883\u754c\uff1a${r.character.realm}`,`\u60ac\u8d4f\u7279\u5f81\uff1a${r.specialTrait}`],potentialInformation:["\u80cc\u666f\u52bf\u529b","\u9690\u85cf\u8eab\u4efd","\u540c\u4f19\u4fe1\u606f","\u85cf\u533f\u5730\u70b9"],imprisonedDate:n.exploration.time,realImprisonedTime:Date.now()};i={...n.prisonSystem,prisoners:[...n.prisonSystem.prisoners,e],stats:{...n.prisonSystem.stats,totalPrisoners:n.prisonSystem.stats.totalPrisoners+1,byArea:{...n.prisonSystem.stats.byArea,"\u5c45\u4f4f\u533a":n.prisonSystem.stats.byArea["\u5c45\u4f4f\u533a"]+1},byCellType:{...n.prisonSystem.stats.byCellType,"\u91cd\u72af\u7262\u623f":n.prisonSystem.stats.byCellType["\u91cd\u72af\u7262\u623f"]+1}}}}return{...n,playerProfile:{...n.playerProfile,spiritStones:n.playerProfile.spiritStones+a,reputation:{...n.playerProfile.reputation,score:n.playerProfile.reputation.score+l}},bountyBoard:n.bountyBoard.map(t=>t.id===e?{...t,status:"\u5df2\u7ed3\u675f",finalOutcome:s}:t),prisonSystem:i}});const r=t.bountyBoard.find(t=>t.id===e);if(r){const e="imprisoned"===s?`\u6210\u529f\u6355\u83b7\u3010${r.name}\u3011\u5e76\u62bc\u5165\u5927\u7262\uff0c\u53ef\u524d\u5f80\u5927\u7262\u8fdb\u884c\u5ba1\u8baf\u548c\u7ba1\u7406\u3002`:`\u6210\u529f\u5b8c\u6210\u5bf9\u3010${r.name}\u3011\u7684\u60ac\u8d4f\u4efb\u52a1\u3002`;Ot("imprisoned"===s?"\u5927\u7262":"\u60ac\u8d4f",`\u5b8c\u6210\u60ac\u8d4f\uff1a${r.name}`,r.trackingLog?`${r.trackingLog}\n\n${e}`:e,[r.name])}Ee(null)})(Se.id,e)}),o.jsx(Zt,{isOpen:Ae,onClose:()=>Te(!1),playerProfile:t.playerProfile,cultivationSlots:t.cultivationPavilion,onStartCultivation:(e,s,r)=>{const{cardCollection:a,petCollection:l}=t.playerProfile,i=[...a,...l],o=i.find(e=>e.id===s),c=i.find(e=>e.id===r);if(!o||!c)return void u("\u9009\u62e9\u7684\u7236\u6bcd\u5361\u724c\u65e0\u6548\u3002");const d={"\u51e1\u54c1":36e5,"\u826f\u54c1":72e5,"\u4f18\u54c1":144e5,"\u73cd\u54c1":288e5,"\u7edd\u54c1":432e5,"\u4ed9\u54c1":648e5,"\u5723\u54c1":864e5,"\u795e\u54c1":1728e5},m=(d[o.rarity]+d[c.rarity])/2,x=Date.now(),p=x+m;n(t=>{const n=t.cultivationPavilion.map(t=>t.slotId===e?{...t,parentA:o,parentB:c,startTime:x,endTime:p,status:"Breeding",monitoringLog:[{timestamp:"\u57f9\u80b2\u5f00\u59cb",message:`\u80fd\u91cf\u5df2\u6ce8\u5165\uff0c${o.name} \u4e0e ${c.name} \u7684\u751f\u547d\u7cbe\u534e\u5f00\u59cb\u878d\u5408\u3002`}]}:t);return{...t,cultivationPavilion:n}})},onClaimCultivation:async e=>{const s=t.cultivationPavilion.find(t=>t.slotId===e);if(s&&"Ready"===s.status&&s.parentA&&s.parentB){c(!0);try{const t=await async function(e,t){const n=`\n    \u8bf7\u6839\u636e\u4ee5\u4e0b\u4e24\u4e2a\u4eb2\u4ee3\u7684\u4fe1\u606f\uff0c\u521b\u9020\u4e00\u4e2a\u5168\u65b0\u7684\u540e\u4ee3\uff1a\n    - \u4eb2\u4ee3A: ${JSON.stringify(e)}\n    - \u4eb2\u4ee3B: ${JSON.stringify(t)}\n\n    \u8bf7\u5f00\u59cb\u4f60\u7684\u521b\u9020\uff0c\u5e76\u8fd4\u56de\u65b0\u751f\u547d\u7684\u5b8c\u6574\u6570\u636e\u3002\n    `,s=pn(await K("\u4f60\u662f\u4e00\u4f4d\u9876\u7ea7\u7684\u9057\u4f20\u5b66\u548c\u751f\u547d\u521b\u9020\u5927\u5e08\uff0c\u4e13\u7cbe\u4e8e\u4ed9\u4fa0\u4e16\u754c\u7684\u751f\u7269\u5de5\u7a0b\u3002\u4f60\u7684\u4efb\u52a1\u662f\u6839\u636e\u4e24\u4e2a\u4eb2\u4ee3\u7684\u4fe1\u606f\uff0c\u521b\u9020\u4e00\u4e2a\u5168\u65b0\u7684\u3001\u5408\u4e4e\u903b\u8f91\u4e14\u5145\u6ee1\u60f3\u8c61\u529b\u7684\u540e\u4ee3\u3002\n1.  **\u51b3\u5b9a\u540e\u4ee3\u7c7b\u578b**:\n    *   \u5982\u679c\u4eb2\u4ee3\u662f\u3010\u4eba\u7269 x \u517d\u5ba0\u3011\uff0c\u540e\u4ee3\u670990%\u7684\u6982\u7387\u662f\u3010\u4eba\u7269\u3011\uff08\u534a\u5996/\u795e\u88d4\uff09\uff0c10%\u7684\u6982\u7387\u662f\u3010\u517d\u5ba0\u3011\uff08\u7075\u517d\uff09\u3002\u4f60\u5fc5\u987b\u5728\u8fd4\u56de\u7684JSON\u4e2d\u660e\u786e\u6307\u5b9a\u540e\u4ee3\u7684\u7c7b\u578b\uff08\u5305\u542b 'gender' \u548c 'skills' \u5b57\u6bb5\u7684\u662f\u4eba\u7269\u5361\uff0c\u4ec5\u5305\u542b 'skill' \u5b57\u6bb5\u7684\u662f\u517d\u5ba0\u5361\uff09\u3002\n2.  **\u878d\u5408\u4e0e\u53d8\u5f02**:\n    *   **\u5916\u89c2 (appearance)**: \u5fc5\u987b\u878d\u5408\u53cc\u65b9\u7684\u7279\u5f81\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e00\u65b9\u662f\u9f99\u65cf\uff0c\u540e\u4ee3\u53ef\u80fd\u62e5\u6709\u9f99\u89d2\u6216\u9f99\u9cde\u3002\u5982\u679c\u4e00\u65b9\u662f\u72d0\u5996\uff0c\u540e\u4ee3\u53ef\u80fd\u6709\u72d0\u8033\u6216\u72d0\u5c3e\u3002\u63cf\u8ff0\u5fc5\u987b\u8272\u60c5\u3001\u5927\u80c6\u3001\u5145\u6ee1\u7ec6\u8282\u3002\n    *   **\u7a00\u6709\u5ea6 (rarity)**: \u540e\u4ee3\u7684\u7a00\u6709\u5ea6\u670970%\u7684\u6982\u7387\u5728\u7236\u6bcd\u7a00\u6709\u5ea6\u7684\u5e73\u5747\u7b49\u7ea7\uff0c25%\u7684\u6982\u7387\u63d0\u5347\u4e00\u7ea7\uff0c5%\u7684\u6982\u7387\u63d0\u5347\u4e24\u7ea7\uff08\u4f8b\u5982\uff0c\u73cd\u54c1+\u73cd\u54c1 -> \u5927\u6982\u7387\u73cd\u54c1\uff0c\u5c0f\u6982\u7387\u7edd\u54c1\uff0c\u6781\u5c0f\u6982\u7387\u4ed9\u54c1\uff09\u3002\n    *   **\u6280\u80fd (skills/skill)**: \u540e\u4ee3\u5fc5\u987b\u4ece\u7236\u6bcd\u53cc\u65b9\u7684\u6280\u80fd\u6c60\u4e2d\u3010\u968f\u673a\u7ee7\u627f1-2\u4e2a\u6280\u80fd\u3011\u3002\u540c\u65f6\uff0c\u670910%\u7684\u6982\u7387\u53d1\u751f\u3010\u6280\u80fd\u53d8\u5f02\u3011\uff0c\u521b\u9020\u4e00\u4e2a\u5168\u65b0\u7684\u3001\u878d\u5408\u4e86\u7236\u6bcd\u6280\u80fd\u7279\u70b9\u7684\u3001\u66f4\u5f3a\u5927\u7684\u65b0\u6280\u80fd\u3002\n3.  **\u6570\u636e\u5b8c\u6574\u6027**: \u4f60\u5fc5\u987b\u5b8c\u6574\u5730\u586b\u5145\u65b0\u5361\u724c\u7684\u6240\u6709\u5b57\u6bb5\u3002\u786e\u4fdd\u4e3a\u65b0\u5361\u724c\u751f\u6210\u4e00\u4e2a\u72ec\u7279\u7684\u3001\u5145\u6ee1\u60f3\u8c61\u529b\u7684\u540d\u79f0\u548c\u79f0\u53f7\u3002\n4.  **JSON\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u5fc5\u987b\u662f\u4e00\u4e2a\u5305\u88f9\u5728 ```json ... ``` \u4ee3\u7801\u5757\u4e2d\u7684JSON\u5bf9\u8c61\uff0c\u5176\u7ed3\u6784\u5fc5\u987b\u4e0e CharacterCard \u6216 PetCard \u7c7b\u578b\u5b8c\u5168\u5339\u914d\u3002",n));return s.id=`cultivated-${Date.now()}`,s}(s.parentA,s.parentB);n(n=>{const s={...n.playerProfile};"skills"in t?s.cardCollection.push(t):s.petCollection.push(t);const r=n.cultivationPavilion.map(t=>t.slotId===e?{...t,parentA:null,parentB:null,startTime:0,endTime:0,status:"Empty",monitoringLog:[]}:t);return{...n,playerProfile:s,cultivationPavilion:r}}),alert(`\u606d\u559c\uff01\u4f60\u83b7\u5f97\u4e86\u65b0\u7684\u5361\u724c\uff1a\u3010${t.name}\u3011\uff01`),s.parentA&&s.parentB&&Ot("\u57f9\u80b2","\u80b2\u7075\u8f69\u57f9\u80b2\u6210\u529f",`\u3010${s.parentA.name}\u3011\u4e0e\u3010${s.parentB.name}\u3011\u7684\u7075\u80ce\u5df2\u6210\u719f\uff0c\u8bde\u751f\u4e86\u65b0\u7684\u751f\u547d\uff1a\u3010${t.name}\u3011\uff01`,[s.parentA.name,s.parentB.name,t.name])}catch(r){console.error("\u751f\u6210\u540e\u4ee3\u5931\u8d25:",r),u("\u5f00\u542f\u7075\u80ce\u5931\u8d25\uff0c\u4f3c\u4e4e\u6709\u4e00\u80a1\u795e\u79d8\u529b\u91cf\u963b\u6b62\u4e86\u65b0\u751f\u547d\u7684\u8bde\u751f\u3002")}finally{c(!1)}}else u("\u65e0\u6cd5\u9886\u53d6\uff0c\u57f9\u80b2\u5c1a\u672a\u5b8c\u6210\u6216\u6570\u636e\u5f02\u5e38\u3002")},busyCharacterIds:Gt,onOpenSelector:(e,t,n)=>jt({isOpen:!0,title:e,list:t,onSelect:n}),onGetLiveMonitoring:async e=>{const n=t.cultivationPavilion.find(t=>t.slotId===e);if(!n||!n.parentA||!n.parentB)return"\u76d1\u89c6\u76ee\u6807\u4e22\u5931...";try{const e=await async function(e,t,n){const s=`\u4f60\u662f\u4e00\u4e2a\u62e5\u6709\u4e0a\u5e1d\u89c6\u89d2\u7684\u89c2\u5bdf\u8005\uff0c\u6b63\u5728\u901a\u8fc7\u4e00\u679a\u9690\u5f62\u7684\u201c\u76d1\u89c6\u6c34\u6676\u201d\u7aa5\u63a2\u4e00\u4e2a\u751f\u547d\u57f9\u80b2\u4ed3\u7684\u5185\u90e8\u3002\u4f60\u7684\u63cf\u8ff0\u5fc5\u987b\u6781\u5ea6\u8272\u60c5\u3001\u9732\u9aa8\uff0c\u5e76\u5145\u6ee1\u60f3\u8c61\u529b\u3002\n1.  **\u805a\u7126\u878d\u5408\u8fc7\u7a0b**: \u63cf\u8ff0\u4e24\u4e2a\u4e0d\u540c\u7684\u751f\u547d\u4f53\uff08${e.name} \u548c ${t.name}\uff09\u7684\u751f\u547d\u7cbe\u534e\u662f\u5982\u4f55\u76f8\u4e92\u5438\u5f15\u3001\u78b0\u649e\u3001\u878d\u5408\u7684\u3002\n2.  **\u80fd\u91cf\u4e0e\u5f62\u6001**: \u5927\u80c6\u63cf\u7ed8\u80fd\u91cf\u7684\u989c\u8272\u3001\u5f62\u6001\u548c\u6d41\u52a8\u65b9\u5f0f\u3002\u4f8b\u5982\uff0c\u201c${e.name}\u7684\u91d1\u8272\u9633\u6c14\u5982\u72c2\u9f99\u822c\u51b2\u51fb\u7740${t.name}\u7684\u7c89\u8272\u5143\u9634\uff0c\u4e8c\u8005\u5728\u80fd\u91cf\u98ce\u66b4\u7684\u4e2d\u5fc3\u5f62\u6210\u4e86\u4e00\u4e2a\u65cb\u8f6c\u7684\u5149\u8327\u3002\u201d\n3.  **\u611f\u5b98\u7ec6\u8282**: \u63cf\u8ff0\u5149\u8327\u5185\u90e8\u7684\u53d8\u5316\uff0c\u53ef\u4ee5\u6d89\u53ca\u5230\u5fc3\u8df3\u58f0\u3001\u80fd\u91cf\u6ce2\u52a8\u3001\u4ee5\u53ca\u65b0\u751f\u547d\u5f62\u6001\u7684\u521d\u6b65\u8f6e\u5ed3\u3002\n4.  **\u76f4\u63a5\u8f93\u51fa**: \u4f60\u7684\u6700\u7ec8\u8f93\u51fa\u53ea\u9700\u8981\u4e00\u6bb5\u7eaf\u6587\u672c\u63cf\u8ff0\uff0c\u4e0d\u8981\u5305\u542b\u4efb\u4f55JSON\u683c\u5f0f\u6216\u989d\u5916\u89e3\u91ca\u3002`,r=`\n    \u6b63\u5728\u76d1\u89c6\u7684\u57f9\u80b2\u4ed3\uff1a\n    - \u4eb2\u4ee3A: ${e.name} (\u79cd\u65cf/\u5883\u754c: ${"race"in e?e.race:"\u517d\u65cf"}, \u7a00\u6709\u5ea6: ${e.rarity})\n    - \u4eb2\u4ee3B: ${t.name} (\u79cd\u65cf/\u5883\u754c: ${"race"in t?t.race:"\u517d\u65cf"}, \u7a00\u6709\u5ea6: ${t.rarity})\n\n    \u8bf7\u751f\u6210\u4e00\u6bb5\u8be6\u7ec6\u3001\u8272\u60c5\u3001\u5145\u6ee1\u60f3\u8c61\u529b\u7684\u5b9e\u65f6\u76d1\u89c6\u62a5\u544a\u3002\n    `;return n?await J({systemInstruction:s,prompt:r,gameState:n}):await K(s,r)}(n.parentA,n.parentB);return e}catch(s){return console.error("\u751f\u6210\u76d1\u89c6\u62a5\u544a\u5931\u8d25:",s),"\u76d1\u89c6\u6c34\u6676\u53d7\u5230\u5e72\u6270\uff0c\u65e0\u6cd5\u770b\u6e05\u5185\u90e8\u60c5\u51b5..."}}}),o.jsx(En,{isOpen:ze,onClose:()=>Re(!1),memories:t.memories,memorySummaries:t.memorySummaries,summarySettings:t.summarySettings,onClearCategory:zt,onDeleteEntry:Bt,onDeleteSummary:Ht,onManualSummary:Ut,onUpdateSettings:Vt,gameState:t,onVectorConfigSave:Wt}),o.jsx(z,{isOpen:Fe,onClose:()=>qe(!1),cardCollection:t.playerProfile.cardCollection,petCollection:t.playerProfile.petCollection,busyCharacterDetails:Qt}),o.jsx(I,{isOpen:yt.isOpen,onClose:()=>jt(e=>({...e,isOpen:!1})),onSelect:yt.onSelect,characterList:yt.list,title:yt.title}),o.jsx(Ts,{isOpen:We,onClose:()=>Ze(!1),prisonSystem:t.prisonSystem,playerProfile:t.playerProfile,setPlayerProfile:_t,onViewPet:Oe,onInterrogatePrisoner:e=>{lt(e),tt(!0),ot("")},onViewPrisonerDetail:e=>{alert(`\u67e5\u770b\u56da\u72af\u8be6\u60c5\uff1a${e.character.name}\n\n\u7f6a\u884c\uff1a${e.crime}\n\u5c48\u670d\u5ea6\uff1a${e.submissionLevel}%\n\u5f52\u987a\u5ea6\uff1a${e.loyaltyLevel}%\n\u5065\u5eb7\u5ea6\uff1a${e.health}%\n\u795e\u667a\uff1a${e.sanity}%`)},onTransferPrisoner:(e,t)=>{n(n=>({...n,prisonSystem:{...n.prisonSystem,prisoners:n.prisonSystem.prisoners.map(n=>n.character.id===e.character.id?{...n,location:t}:n)}})),Ot("\u5927\u7262",`\u56da\u72af\u8f6c\u79fb\uff1a${e.character.name}`,`\u5c06\u56da\u72af\u3010${e.character.name}\u3011\u4ece${e.location}\u8f6c\u79fb\u5230${t}\u3002`,[e.character.name])},onReleasePrisoner:e=>{n(t=>({...t,prisonSystem:{...t.prisonSystem,prisoners:t.prisonSystem.prisoners.filter(t=>t.character.id!==e.character.id)}})),Ot("\u5927\u7262",`\u91ca\u653e\u56da\u72af\uff1a${e.character.name}`,`\u91ca\u653e\u4e86\u56da\u72af\u3010${e.character.name}\u3011\u3002\u7f6a\u884c\uff1a${e.crime}`,[e.character.name])},onRecruitPrisoner:e=>{e.loyaltyLevel<80||e.submissionLevel<60?alert(`\u62db\u52df\u5931\u8d25\uff1a\u3010${e.character.name}\u3011\u7684\u5f52\u987a\u5ea6\u6216\u5c48\u670d\u5ea6\u4e0d\u8db3\uff01\n\n\u5f53\u524d\u5f52\u987a\u5ea6\uff1a${e.loyaltyLevel}% (\u9700\u8981\u226580%)\n\u5f53\u524d\u5c48\u670d\u5ea6\uff1a${e.submissionLevel}% (\u9700\u8981\u226560%)`):(n(t=>({...t,playerProfile:{...t.playerProfile,cardCollection:[...t.playerProfile.cardCollection,e.character]},prisonSystem:{...t.prisonSystem,prisoners:t.prisonSystem.prisoners.filter(t=>t.character.id!==e.character.id)}})),Ot("\u5927\u7262",`\u6210\u529f\u62db\u52df\uff1a${e.character.name}`,`\u6210\u529f\u62db\u52df\u4e86\u56da\u72af\u3010${e.character.name}\u3011\u52a0\u5165\u961f\u4f0d\u3002\u5f52\u987a\u5ea6\uff1a${e.loyaltyLevel}%\uff0c\u5c48\u670d\u5ea6\uff1a${e.submissionLevel}%`,[e.character.name]),alert(`\u6210\u529f\u62db\u52df\u3010${e.character.name}\u3011\uff01\n\n\u8be5\u89d2\u8272\u5df2\u52a0\u5165\u4f60\u7684\u5361\u724c\u6536\u85cf\u3002`))},onAssignLabor:Dt,onClaimLaborResult:Lt,onGenerateEvent:()=>{alert("\u968f\u673a\u4e8b\u4ef6\u529f\u80fd\u5f00\u53d1\u4e2d")},onDialogueComplete:(e,t)=>{n(n=>({...n,prisonSystem:{...n.prisonSystem,prisoners:n.prisonSystem.prisoners.map(n=>n.character.id===e.character.id?{...n,submissionLevel:Math.max(0,Math.min(100,n.submissionLevel+t.stateChanges.submission)),loyaltyLevel:Math.max(0,Math.min(100,n.loyaltyLevel+t.stateChanges.loyalty)),health:Math.max(0,Math.min(100,n.health+t.stateChanges.health)),sanity:Math.max(0,Math.min(100,n.sanity+t.stateChanges.sanity)),knownInformation:t.rewards?.information?[...n.knownInformation||[],t.rewards.information]:n.knownInformation}:n),stats:{...n.prisonSystem.stats,avgSubmission:n.prisonSystem.prisoners.length>0?n.prisonSystem.prisoners.reduce((e,t)=>e+t.submissionLevel,0)/n.prisonSystem.prisoners.length:0,avgLoyalty:n.prisonSystem.prisoners.length>0?n.prisonSystem.prisoners.reduce((e,t)=>e+t.loyaltyLevel,0)/n.prisonSystem.prisoners.length:0}},playerProfile:t.rewards?.spiritStones?{...n.playerProfile,spiritStones:n.playerProfile.spiritStones-(t.rewards.spiritStones||0)}:n.playerProfile})),Ot("\u5927\u7262",`\u4e0e\u56da\u72af\u5bf9\u8bdd\uff1a${e.character.name}`,`\u4e0e\u56da\u72af\u3010${e.character.name}\u3011\u8fdb\u884c\u4e86${t.dialogueRecord.dialogueType}\u5bf9\u8bdd\u3002\n\u9009\u62e9\uff1a${t.dialogueRecord.playerChoice}\n\u56da\u72af\u56de\u5e94\uff1a"${t.dialogueRecord.prisonerResponse}"\n\u6548\u679c\uff1a\u5c48\u670d\u5ea6${t.stateChanges.submission>=0?"+":""}${t.stateChanges.submission}\uff0c\u5f52\u987a\u5ea6${t.stateChanges.loyalty>=0?"+":""}${t.stateChanges.loyalty}`+(t.rewards?.information?`\n\u83b7\u5f97\u60c5\u62a5\uff1a${t.rewards.information}`:"")+(t.consequences?.eventTriggered?`\n\u89e6\u53d1\u4e8b\u4ef6\uff1a${t.consequences.eventTriggered}`:""),[e.character.name]),t.consequences?.eventTriggered&&setTimeout(()=>{alert(`\u26a0\ufe0f \u7279\u6b8a\u4e8b\u4ef6\uff1a${t.consequences?.eventTriggered}`)},500)},onGenerateDialogueResponse:async(e,t)=>{try{const n=`\u4f60\u662f\u4e00\u4e2a\u4fee\u4ed9\u4e16\u754c\u7684\u56da\u72af\uff0c\u540d\u53eb${e.character.name}\uff0c${"Male"===e.character.gender?"\u7537\u6027":"\u5973\u6027"}\uff0c\u4fee\u4e3a${e.character.realm}\u3002\n\u4f60\u56e0\u4e3a"${e.crime}"\u88ab\u5173\u62bc\u5728\u5927\u7262\u4e2d\u3002\n\u5f53\u524d\u72b6\u6001\uff1a\n- \u5c48\u670d\u5ea6\uff1a${e.submissionLevel}%\uff08${e.submissionLevel>=80?"\u5b8c\u5168\u5c48\u670d":e.submissionLevel>=60?"\u610f\u5fd7\u52a8\u6447":e.submissionLevel>=40?"\u52c9\u5f3a\u914d\u5408":"\u987d\u56fa\u62b5\u6297"}\uff09\n- \u5f52\u987a\u5ea6\uff1a${e.loyaltyLevel}%\n- \u5065\u5eb7\uff1a${e.health}%\n- \u795e\u667a\uff1a${e.sanity}%\n\n\u72f1\u5352\u5bf9\u4f60\u4f7f\u7528\u4e86"${t.type}"\u7684\u65b9\u5f0f\uff1a${t.text}\uff08${t.description}\uff09\n\n\u8bf7\u4ee5\u56da\u72af\u7684\u8eab\u4efd\uff0c\u7528\u7b2c\u4e00\u4eba\u79f0\u56de\u5e94\u8fd9\u4e2a\u5bf9\u8bdd\u3002\u56de\u5e94\u8981\u7b26\u5408\u4f60\u5f53\u524d\u7684\u5c48\u670d\u5ea6\u548c\u5fc3\u7406\u72b6\u6001\uff1a\n- \u5982\u679c\u5c48\u670d\u5ea6\u4f4e\uff0c\u5e94\u8be5\u8868\u73b0\u51fa\u6297\u62d2\u3001\u6124\u6012\u6216\u4e0d\u5c51\n- \u5982\u679c\u5c48\u670d\u5ea6\u9ad8\uff0c\u5e94\u8be5\u8868\u73b0\u51fa\u987a\u4ece\u3001\u6050\u60e7\u6216\u914d\u5408\n- \u56de\u5e94\u8981\u7b80\u77ed\u6709\u529b\uff0c1-3\u53e5\u8bdd\u5373\u53ef\n- \u8981\u7b26\u5408\u4fee\u4ed9\u4e16\u754c\u7684\u8bed\u8a00\u98ce\u683c`;if("undefined"!=typeof window&&window.SillyTavern?.generateText){return await window.SillyTavern.generateText(n)||Ys(t.type,e.submissionLevel)}return Ys(t.type,e.submissionLevel)}catch(n){return console.error("\u751f\u6210\u5bf9\u8bdd\u54cd\u5e94\u5931\u8d25:",n),Ys(t.type,e.submissionLevel)}},isLoading:i}),o.jsx(ue,{isOpen:ct,onClose:()=>xt(!1),etiquetteSystem:t.etiquetteSystem,onUpdateEtiquetteSystem:e=>{n(t=>({...t,etiquetteSystem:e}))},cardCollection:t.playerProfile.cardCollection,gameState:t,onOpenDesignerSelection:()=>{const e=t.playerProfile.cardCollection.filter(e=>!Gt.has(e.id));jt({isOpen:!0,title:"\u9009\u62e9\u793c\u4eea\u8bbe\u8ba1\u5e08",list:e,onSelect:e=>{const t={characterId:e.id,assignedAt:Date.now(),designCount:0,designStyle:["\u6781\u81f4\u670d\u4ece","\u7f9e\u803b\u5f3a\u5316"],qualityScore:80};n(n=>({...n,etiquetteSystem:{...n.etiquetteSystem,designer:t,logs:[{id:`log-${Date.now()}`,timestamp:Date.now(),action:"designer_assign",details:`\u6307\u6d3e\u4e86\u65b0\u8bbe\u8ba1\u5e08\uff1a${e.name}`,designerId:e.id},...n.etiquetteSystem.logs].slice(0,100)}})),jt(e=>({...e,isOpen:!1}))}})}}),o.jsx(en,{isOpen:pt,onClose:()=>bt(!1),gameState:t,onUpdateGameState:n}),et&&nt&&o.jsx(sn,{isOpen:et,onClose:()=>tt(!1),prisoner:nt,availableTortureMethods:[{id:"whipping",name:"\u97ad\u5211",category:"basic",description:"\u7528\u97ad\u5b50\u62bd\u6253\u56da\u72af\uff0c\u9020\u6210\u76ae\u8089\u4e4b\u82e6",damage:20,intimidation:40,successRate:30,submissionIncrease:10,risks:{death:2,permanentInjury:5,insanity:3}},{id:"caning",name:"\u6756\u5211",category:"basic",description:"\u7528\u6728\u6756\u51fb\u6253\u56da\u72af",damage:30,intimidation:50,successRate:40,submissionIncrease:15,risks:{death:5,permanentInjury:10,insanity:5}}],onExecuteTorture:(e,t,n)=>{alert(`\u6267\u884c\u5211\u7f5a\uff1a\u56da\u72af ${e}, \u65b9\u6cd5 ${t}, \u65f6\u957f ${n}\u5206\u949f\n\n\u6b64\u529f\u80fd\u9700\u8981AI\u96c6\u6210\u624d\u80fd\u751f\u6210\u5ba1\u8baf\u7ed3\u679c\u3002`),ot(`\u6b63\u5728\u6267\u884c\u5211\u7f5a...\n\u6301\u7eed\u65f6\u95f4\uff1a${n}\u5206\u949f\n\n[\u6b64\u5904\u5c06\u663e\u793aAI\u751f\u6210\u7684\u5ba1\u8baf\u8fc7\u7a0b]`)},onEndInterrogation:()=>{tt(!1),lt(null),ot("")},interrogationLog:it,isLoading:i})]})},tr=document.getElementById("root");if(!tr)throw new Error("Could not find root element to mount to");D.createRoot(tr).render(o.jsx(p.StrictMode,{children:o.jsx(er,{})}))}();</script>
  <style rel="stylesheet" crossorigin>:root{--primary-gold: #fcd34d;--primary-gold-light: #fde68a;--primary-gold-dark: #f59e0b;--bg-primary: #1c1917;--bg-secondary: #292524;--bg-overlay: rgba(0, 0, 0, .8);--accent-red: #dc2626;--accent-blue: #2563eb;--accent-purple: #9333ea;--accent-green: #10b981;--accent-pink: #ec4899;--accent-cyan: #06b6d4;--rarity-common: #9ca3af;--rarity-uncommon: #10b981;--rarity-rare: #3b82f6;--rarity-epic: #a855f7;--rarity-legendary: #f59e0b;--rarity-mythic: #ec4899;--rarity-divine: #8b5cf6;--glow-gold: 0 0 20px rgba(252, 211, 77, .4);--glow-red: 0 0 20px rgba(220, 38, 38, .4);--glow-blue: 0 0 20px rgba(37, 99, 235, .4);--glow-purple: 0 0 20px rgba(147, 51, 234, .4);--transition-fast: .2s ease-in-out;--transition-normal: .3s ease-in-out;--transition-slow: .5s ease-in-out}.ornate-border{position:relative;border:2px solid rgba(252,211,77,.3);box-shadow:0 0 30px #fcd34d1a,inset 0 0 20px #fcd34d0d}.ornate-border:before{content:"";position:absolute;inset:-4px;border-radius:inherit;padding:2px;background:linear-gradient(135deg,#fcd34d66,#dc262633,#9333ea4d,#fcd34d66);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;animation:rotateBorder 8s linear infinite}@keyframes rotateBorder{0%,to{filter:hue-rotate(0deg)}50%{filter:hue-rotate(60deg)}}.ornate-border-dialog{border:2px solid rgba(252,211,77,.2);box-shadow:0 10px 50px #00000080,inset 0 0 30px #fcd34d0d}.card-3d-hover{transition:transform .3s ease,box-shadow .3s ease;transform-style:preserve-3d}.card-3d-hover:hover{transform:translateY(-8px) rotateX(5deg) rotateY(5deg) scale(1.02);box-shadow:0 20px 40px #0006,0 0 30px #fcd34d33}.card-legendary-glow{position:relative;animation:legendaryPulse 2s ease-in-out infinite}.card-legendary-glow:before{content:"";position:absolute;inset:-2px;border-radius:inherit;background:linear-gradient(45deg,#f59e0b,#fbbf24,#f59e0b);opacity:.6;filter:blur(8px);z-index:-1;animation:rotateGradient 3s linear infinite}@keyframes legendaryPulse{0%,to{box-shadow:0 0 20px #f59e0b99}50%{box-shadow:0 0 40px #f59e0be6}}@keyframes rotateGradient{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.card-shine{position:relative;overflow:hidden}.card-shine:after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.3) 50%,transparent 70%);transform:translate(-100%);transition:transform .8s}.card-shine:hover:after{transform:translate(100%)}.btn-primary-enhanced{position:relative;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;font-weight:700;padding:.75rem 1.5rem;border-radius:.5rem;border:2px solid rgba(252,211,77,.5);box-shadow:0 4px 15px #f59e0b4d,inset 0 1px #fff3;transition:all .3s ease;overflow:hidden;cursor:pointer}.btn-primary-enhanced:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,transparent 0%,rgba(255,255,255,.2) 100%);transform:translateY(-100%);transition:transform .3s}.btn-primary-enhanced:hover:before{transform:translateY(0)}.btn-primary-enhanced:hover{transform:translateY(-2px);box-shadow:0 8px 25px #f59e0b80,inset 0 1px #ffffff4d}.btn-primary-enhanced:active{transform:translateY(0)}.hp-bar-enhanced{position:relative;height:12px;background:#1c1917cc;border-radius:999px;overflow:hidden;box-shadow:inset 0 2px 4px #00000080}.hp-bar-fill-enhanced{height:100%;background:linear-gradient(90deg,#dc2626,#ef4444,#f87171);border-radius:999px;box-shadow:0 0 10px #dc262680,inset 0 1px #ffffff4d;transition:width .5s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}.hp-bar-fill-enhanced:after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.3) 50%,transparent 100%);animation:shimmer 2s infinite}@keyframes shimmer{0%{transform:translate(-100%)}to{transform:translate(200%)}}@keyframes modalSlideIn{0%{opacity:0;transform:translateY(-50px) scale(.9)}to{opacity:1;transform:translateY(0) scale(1)}}.modal-slide-in{animation:modalSlideIn .4s cubic-bezier(.16,1,.3,1)}.scrollbar-enhanced::-webkit-scrollbar{width:8px;height:8px}.scrollbar-enhanced::-webkit-scrollbar-track{background:#29252480;border-radius:4px}.scrollbar-enhanced::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#fcd34d99,#f59e0b99);border-radius:4px;border:2px solid rgba(41,37,36,.5)}.scrollbar-enhanced::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#fcd34dcc,#f59e0bcc)}.custom-scrollbar::-webkit-scrollbar{width:12px}.custom-scrollbar::-webkit-scrollbar-track{background:linear-gradient(to right,#1c191780,#29252480,#1c191780);border-radius:6px;border:1px solid rgba(120,113,108,.2)}.custom-scrollbar::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#fbbf24b3,#f59e0bcc,#d97706b3);border-radius:6px;border:2px solid rgba(28,25,23,.8);box-shadow:0 0 10px #fbbf244d,inset 0 1px #fff3;transition:all .3s ease}.custom-scrollbar::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,#fbbf24e6,#f59e0b,#d97706e6);box-shadow:0 0 15px #fbbf2480,inset 0 1px #ffffff4d}.custom-scrollbar::-webkit-scrollbar-thumb:active{background:linear-gradient(180deg,#d97706e6,#f59e0b,#fbbf24e6)}@keyframes pulsGlow{0%,to{box-shadow:0 0 10px #fcd34d80}50%{box-shadow:0 0 30px #fcd34dcc}}.animate-pulse-glow{animation:pulseGlow 2s ease-in-out infinite}@keyframes float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}.animate-float{animation:float 3s ease-in-out infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin-slow{animation:spin 3s linear infinite}.glass-morphism{background:#1c1917b3;backdrop-filter:blur(10px) saturate(150%);border:1px solid rgba(252,211,77,.1)}.glass-morphism-light{background:#29252480;backdrop-filter:blur(8px)}.particle-bg{position:fixed;inset:0;background:radial-gradient(2px 2px at 20% 30%,white,transparent),radial-gradient(2px 2px at 60% 70%,white,transparent),radial-gradient(1px 1px at 50% 50%,white,transparent),radial-gradient(1px 1px at 80% 10%,white,transparent),radial-gradient(2px 2px at 90% 60%,white,transparent),radial-gradient(1px 1px at 33% 80%,white,transparent);background-size:200% 200%;animation:starTwinkle 4s ease-in-out infinite;pointer-events:none;opacity:.3}@keyframes starTwinkle{0%,to{opacity:.2}50%{opacity:.4}}.text-gradient-gold{background:linear-gradient(135deg,#fde68a,#fcd34d,#f59e0b);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;font-weight:700}.text-glow{text-shadow:0 0 10px rgba(252,211,77,.5),0 0 20px rgba(252,211,77,.3),0 0 30px rgba(252,211,77,.1)}.text-stroke{-webkit-text-stroke:1px rgba(0,0,0,.5);paint-order:stroke fill}.center-container{display:flex;align-items:center;justify-content:center}.full-cover{position:fixed;inset:0;z-index:9999}.no-select{user-select:none;-webkit-user-select:none}.gpu-accelerated{transform:translateZ(0);will-change:transform}</style>
</head>
  <body class="bg-ink-950 text-ink-300 font-serif">
    <!-- 浮动灵气粒子 -->
    <div class="spirit-particles" id="spirit-particles"></div>
    
    <div id="root" class="w-full"></div>
    
    <script>
      // 创建浮动灵气粒子效果
      (function() {
        const container = document.getElementById('spirit-particles');
        if (!container) return;
        
        const colors = [
          'rgba(184, 149, 106, 0.5)',
          'rgba(212, 181, 150, 0.4)',
          'rgba(180, 200, 180, 0.3)',
          'rgba(200, 180, 160, 0.4)'
        ];
        
        for (let i = 0; i < 20; i++) {
          const particle = document.createElement('div');
          particle.className = 'spirit-particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 18 + 's';
          particle.style.animationDuration = (15 + Math.random() * 10) + 's';
          particle.style.background = `radial-gradient(circle, ${colors[Math.floor(Math.random() * colors.length)]} 0%, transparent 70%)`;
          particle.style.width = (3 + Math.random() * 4) + 'px';
          particle.style.height = particle.style.width;
          container.appendChild(particle);
        }
      })();
    </script>
    
  </body>
</html>