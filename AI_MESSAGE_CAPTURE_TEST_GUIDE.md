# AI消息捕获测试指南

## 测试目的
验证所有界面的AI生成消息都能被正确捕获并分类到记忆系统中。

## 已修复的问题

### 1. 声望界面 ✅
- **问题**: 生成的声望故事没有被正确分类
- **修复**: 在App.tsx中添加了`isReputationModalOpen`的场景设置
- **测试方法**: 打开声望界面，点击"查看事迹"生成故事，检查记忆中是否保存到【声望】分类

### 2. 传音界面 ✅
- **问题**: 传音对话没有被捕获
- **修复**: 在App.tsx中添加了`isTelepathyModalOpen`的场景设置
- **测试方法**: 打开传音界面，与角色对话，检查记忆中是否保存到【其他】分类

### 3. 监视功能 ✅
- **问题**: 商业监视报告没有被捕获
- **修复**: 在App.tsx中添加了`surveillanceTarget`的场景设置
- **测试方法**: 在商业界面选择员工并监视，检查记忆中是否保存到【商业】分类

### 4. 公告界面 ✅
- **问题**: 生成的公告没有被捕获
- **修复**: 在App.tsx中添加了`isAnnouncementModalOpen`的场景设置
- **测试方法**: 打开公告界面，检查生成的公告是否保存到【公告】分类

### 5. 关键词优化 ✅
- **修复**: 扩展了各分类的关键词列表，提高分类准确度
- **新增关键词示例**:
  - 商城: 百炼阁、万法楼、御兽斋、异界降临
  - 医馆: 病历、走火入魔
  - 悬赏: 线索、千乳圣女
  - 培育: 配种、后代
  - 商业: 监视、头牌、角斗士、奴隶
  - 声望: 侠义、恶行、风流、天机阁
  - 公告: 惊蛰、宗门排行

## 完整测试清单

### 探索相关 🗺️
- [ ] 点击"探索"按钮，查看生成的探索内容是否保存到【探索】
- [ ] 触发随机事件，查看事件描述是否保存到【探索】
- [ ] 在地图界面移动，查看描述是否保存到【探索】

### 战斗相关 ⚔️
- [ ] 发起战斗，查看战斗过程是否保存到【战斗】
- [ ] 进入竞技场，查看对决内容是否保存到【战斗】
- [ ] 使用技能，查看技能描述是否保存到【战斗】

### 商城相关 🛒
- [ ] 在"人物卡牌"抽卡，查看角色描述是否保存到【商城】
- [ ] 在"装备"抽取，查看装备描述是否保存到【商城】
- [ ] 在"通用技能"抽取，查看技能描述是否保存到【商城】
- [ ] 在"兽宠"抽取，查看宠物描述是否保存到【商城】
- [ ] 在"同人角色"抽取，查看角色描述是否保存到【商城】
- [ ] 在"同人兽宠"抽取，查看宠物描述是否保存到【商城】

### 医馆相关 🏥
- [ ] 问诊功能，查看患者描述是否保存到【医馆】
- [ ] 治疗过程，查看治疗描述是否保存到【医馆】
- [ ] 查看病历，确认是否保存到【医馆】

### 悬赏相关 📜
- [ ] 接取悬赏任务，查看目标描述是否保存到【悬赏】
- [ ] 完成悬赏，查看完成记录是否保存到【悬赏】
- [ ] 查看悬赏日志，确认内容保存到【悬赏】

### 培育相关 🌱
- [ ] 修炼功能，查看修炼结果是否保存到【培育】
- [ ] 配种功能，查看配种过程是否保存到【培育】
- [ ] 育灵轩监测，查看监测文本是否保存到【培育】

### 商业相关 💰
- [ ] 青楼经营，查看事件是否保存到【商业】
- [ ] 角斗场经营，查看事件是否保存到【商业】
- [ ] 炼丹房经营，查看事件是否保存到【商业】
- [ ] 拍卖行经营，查看事件是否保存到【商业】
- [ ] 情报阁经营，查看事件是否保存到【商业】
- [ ] **监视员工**，查看监视报告是否保存到【商业】 ⭐

### 声望相关 ⭐
- [ ] **打开声望界面**，点击"查看事迹"，查看生成的故事是否保存到【声望】 ⭐

### 公告相关 📢
- [ ] **打开公告界面**，查看生成的公告是否保存到【公告】 ⭐

### 其他功能 🔮
- [ ] **传音界面**，与角色对话，查看对话是否保存到【其他】 ⭐

## 测试方法

1. **打开记忆界面**: 在游戏中打开"记忆"功能
2. **切换分类**: 点击不同分类按钮（探索、战斗、商城等）
3. **查看内容**: 确认生成的AI消息是否正确保存在对应分类中
4. **检查时间**: 确认保存的时间戳是否正确

## 预期结果

- ✅ 所有AI生成的消息都应该被捕获
- ✅ 每条消息都应该被分类到正确的类别
- ✅ 消息内容应该完整，不丢失
- ✅ 时间戳应该准确
- ✅ 可以在记忆界面中查看和删除

## 问题报告

如果发现问题，请记录：
1. **界面名称**: 在哪个界面触发的
2. **操作步骤**: 具体做了什么操作
3. **预期结果**: 应该保存到哪个分类
4. **实际结果**: 实际保存到了哪里（或没有保存）
5. **消息内容**: AI生成的具体内容（部分即可）

## 技术说明

### 场景追踪机制
系统通过App.tsx中的状态变化来追踪当前场景：
```typescript
// 示例：声望界面场景设置
if (isReputationModalOpen) {
    aiMessageCapture.setCurrentScene('reputation');
}
```

### 分类算法
1. **场景优先**: 首先根据当前界面场景确定分类
2. **关键词匹配**: 如果场景未知，则根据消息内容中的关键词判断
3. **默认分类**: 如果都无法判断，归类到【其他】

### 关键文件
- [`App.tsx`](App.tsx:597-642) - 场景追踪逻辑
- [`services/aiMessageCapture.ts`](services/aiMessageCapture.ts) - 消息捕获服务
- [`components/MemoryModal.tsx`](components/MemoryModal.tsx) - 记忆界面
- [`types.ts`](types.ts:391) - 类型定义